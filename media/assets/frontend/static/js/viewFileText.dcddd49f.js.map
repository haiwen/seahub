{"version":3,"file":"static/js/viewFileText.dcddd49f.js","mappings":"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","sources":["view-file-text.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport PropTypes from 'prop-types';\nimport toaster from './components/toast';\nimport { gettext } from './utils/constants';\nimport FileView from './components/file-view/file-view';\nimport SeafileCodeMirror from './components/seafile-codemirror';\nimport FileViewTip from './components/file-view/file-view-tip';\nimport { seafileAPI } from './utils/seafile-api';\nimport { Utils } from './utils/utils';\n\nimport './css/text-file-view.css';\nconst {\n  err, fileExt, fileContent, repoID, filePath, fileName, canEditFile, username\n} = window.app.pageOptions;\n\nconst propTypes = {\n  updateContent: PropTypes.func.isRequired,\n  content: PropTypes.string.isRequired,\n};\n\nclass FileContent extends React.Component {\n  render() {\n    if (err) {\n      return <FileViewTip />;\n    }\n\n    return (\n      <div className=\"file-view-content flex-1 text-file-view\">\n        <SeafileCodeMirror\n          fileExt={fileExt}\n          value={this.props.content}\n          readOnly={!canEditFile}\n          onChange={this.props.updateContent}\n        />\n      </div>\n    );\n  }\n}\n\nFileContent.propTypes = propTypes;\n\nclass ViewFileText extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      content: fileContent,\n      needSave: false,\n      isSaving: false,\n      participants: [],\n    };\n    this.onSave=this.onSave.bind(this);\n    this.isParticipant = false;\n  }\n\n\n  updateContent = (value) => {\n    this.setState({\n      needSave: true,\n      content: value,\n    });\n  };\n\n  onSave () {\n    if (!this.isParticipant) {\n      this.addParticipant();\n    }\n    let dirPath = Utils.getDirName(filePath);\n    return (\n      seafileAPI.getUpdateLink(repoID, dirPath).then((res) => {\n        const uploadLink = res.data;\n        this.setState({\n          isSaving: true\n        });\n        return seafileAPI.updateFile(\n          uploadLink,\n          filePath,\n          fileName,\n          this.state.content\n        ).then(() => {\n          toaster.success(gettext('Successfully saved'), {\n            duration: 2\n          });\n          this.setState({\n            isSaving: false,\n            needSave: false\n          });\n        });\n      })\n    );\n  }\n\n  addParticipant = () => {\n    seafileAPI.addFileParticipants(repoID, filePath, [username]).then((res) => {\n      if (res.status === 200) {\n        this.isParticipant = true;\n        this.getParticipants();\n      }\n    });\n  };\n\n  getParticipants = () => {\n    seafileAPI.listFileParticipants(repoID, filePath).then((res) => {\n      const participants = res.data.participant_list;\n      this.setState({ participants: participants });\n      if (participants.length > 0) {\n        this.isParticipant = participants.every((participant) => {\n          return participant.email == username;\n        });\n      }\n    });\n  };\n\n  onParticipantsChange = () => {\n    this.getParticipants();\n  };\n\n  componentDidMount() {\n    this.getParticipants();\n  }\n\n  render() {\n    return (\n      <FileView\n        content={\n          <FileContent\n            content={this.state.content}\n            updateContent={this.updateContent}\n          />\n        }\n        isSaving={this.state.isSaving}\n        needSave={this.state.needSave}\n        onSave={this.onSave}\n        participants={this.state.participants}\n        onParticipantsChange={this.onParticipantsChange}\n      />\n    );\n  }\n}\n\nReactDom.render(<ViewFileText />, document.getElementById('wrapper'));\n"],"names":["_window$app$pageOptio","window","app","pageOptions","err","fileExt","fileContent","repoID","filePath","fileName","canEditFile","username","FileContent","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","_jsx","FileViewTip","className","children","SeafileCodeMirror","this","props","content","readOnly","onChange","updateContent","React","ViewFileText","_React$Component2","_super2","_this","call","setState","needSave","addParticipant","seafileAPI","addFileParticipants","then","res","status","isParticipant","getParticipants","listFileParticipants","participants","data","participant_list","length","every","participant","email","onParticipantsChange","state","isSaving","onSave","bind","_assertThisInitialized","_this2","dirPath","Utils","getDirName","getUpdateLink","uploadLink","updateFile","toaster","success","gettext","duration","FileView","ReactDom","document","getElementById"],"sourceRoot":""}