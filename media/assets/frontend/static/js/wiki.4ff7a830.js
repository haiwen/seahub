"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[747],{30426:function(e,t,n){n.d(t,{AE:function(){return l},SC:function(){return c},bg:function(){return a},cI:function(){return s}});var i=n(71843),o=n.n(i),r=n(30171),a="REACT_CONTEXTMENU_SHOW",s="REACT_CONTEXTMENU_HIDE";function d(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;"function"===typeof window.CustomEvent?n=new window.CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!0,t),i&&(i.dispatchEvent(n),o()(r.h,t))}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;d(a,o()({},e,{type:a}),t)}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;d(s,o()({},e,{type:s}),t)}},92161:function(e,t,n){var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(47313),d=n(18760),l=n(30426),c=n(30171),p=n(83854),h=n(46417),u=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).registerHandlers=function(){document.addEventListener("mousedown",o.handleOutsideClick),document.addEventListener("touchstart",o.handleOutsideClick),document.addEventListener("scroll",o.handleHide),document.addEventListener("contextmenu",o.handleHide),document.addEventListener("keydown",o.handleKeyNavigation),window.addEventListener("resize",o.handleHide)},o.unregisterHandlers=function(){document.removeEventListener("mousedown",o.handleOutsideClick),document.removeEventListener("touchstart",o.handleOutsideClick),document.removeEventListener("scroll",o.handleHide),document.removeEventListener("contextmenu",o.handleHide),document.removeEventListener("keydown",o.handleKeyNavigation),window.removeEventListener("resize",o.handleHide)},o.handleShow=function(e){if(e.detail.id===o.props.id){var t=e.detail.position,n=t.x,i=t.y,r=e.detail,a=r.currentObject,s=r.menuList;o.setState({isVisible:!0,x:n,y:i,currentObject:a,menuList:s}),o.registerHandlers(),(0,c._N)(o.props.onShowMenu,e)}},o.handleHide=function(e){!o.state.isVisible||e.detail&&e.detail.id&&e.detail.id!==o.props.id||(o.unregisterHandlers(),o.setState({isVisible:!1}),(0,c._N)(o.props.onHideMenu,e))},o.handleOutsideClick=function(e){o.menu.contains(e.target)||(0,l.SC)()},o.handleMouseLeave=function(e){e.preventDefault(),o.props.hideOnLeave&&(0,l.SC)()},o.handleContextMenu=function(e){o.handleHide(e)},o.handleKeyNavigation=function(e){!1!==o.state.isVisible&&(e.preventDefault(),o.hideMenu(e))},o.hideMenu=function(e){27!==e.keyCode&&13!==e.keyCode||(0,l.SC)()},o.getMenuPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={top:t,left:e};if(!o.menu)return n;var i=window,r=i.innerWidth,a=i.innerHeight,s=o.menu.getBoundingClientRect();return t+s.height>a&&(n.top-=s.height),e+s.width>r&&(n.left-=s.width),n.top<0&&(n.top=s.height<a?(a-s.height)/2:0),n.left<0&&(n.left=s.width<r?(r-s.width)/2:0),n},o.getRTLMenuPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={top:t,left:e};if(!o.menu)return n;var i=window,r=i.innerWidth,a=i.innerHeight,s=o.menu.getBoundingClientRect();return n.left=e-s.width,t+s.height>a&&(n.top-=s.height),n.left<0&&(n.left+=s.width),n.top<0&&(n.top=s.height<a?(a-s.height)/2:0),n.left+s.width>r&&(n.left=s.width<r?(r-s.width)/2:0),n},o.onMenuItemClick=function(e){e.stopPropagation();var t=p.c.getEventData(e,"operation"),n=o.state.currentObject;o.props.onMenuItemClick(t,n,e)},o.onContextMenu=function(e){e.stopPropagation()},o.state={x:0,y:0,isVisible:!1,currentObject:null,menuList:[]},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.listenId=d.Z.register(this.handleShow,this.handleHide)}},{key:"componentDidUpdate",value:function(){var e=this;if(this.state.isVisible){var t=window.requestAnimationFrame||setTimeout;t((function(){var n=e.state,i=n.x,o=n.y,r=e.props.rtl?e.getRTLMenuPosition(i,o):e.getMenuPosition(i,o),a=r.top,s=r.left;t((function(){e.menu&&(e.menu.style.top="".concat(a,"px"),e.menu.style.left="".concat(s,"px"),e.menu.style.opacity=1,e.menu.style.pointerEvents="auto")}))}))}else{if(!this.menu)return;this.menu.style.opacity=0,this.menu.style.pointerEvents="none"}}},{key:"componentWillUnmount",value:function(){this.listenId&&d.Z.unregister(this.listenId),this.unregisterHandlers()}},{key:"render",value:function(){var e=this;return(0,h.jsx)("div",{role:"menu",className:"seafile-contextmenu dropdown-menu",style:{position:"fixed",opacity:0,pointerEvents:"none",display:"block"},ref:function(t){e.menu=t},children:this.state.menuList.map((function(t,n){return"Divider"===t?(0,h.jsx)("div",{className:"seafile-divider dropdown-divider"},n):(0,h.jsx)("button",{className:"seafile-contextmenu-item dropdown-item","data-operation":t.key,onClick:e.onMenuItemClick,onContextMenu:e.onContextMenu,children:t.value},n)}))})}}]),n}(s.Component);t.Z=u},18760:function(e,t,n){var i=n(43144),o=n(15671),r=n(30426),a=n(30171),s=new((0,i.Z)((function e(){var t=this;(0,o.Z)(this,e),this.handleShowEvent=function(e){for(var n in t.callbacks)(0,a.Q$)(t.callbacks,n)&&t.callbacks[n].show(e)},this.handleHideEvent=function(e){for(var n in t.callbacks)(0,a.Q$)(t.callbacks,n)&&t.callbacks[n].hide(e)},this.register=function(e,n){var i=(0,a.EL)();return t.callbacks[i]={show:e,hide:n},i},this.unregister=function(e){e&&t.callbacks[e]&&delete t.callbacks[e]},this.callbacks={},a.Nq&&(window.addEventListener(r.bg,this.handleShowEvent),window.addEventListener(r.cI,this.handleHideEvent))})));t.Z=s},30171:function(e,t,n){function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return"function"===typeof e&&e.apply(void 0,n)}function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function r(){return Math.random().toString(36).substring(7)}n.d(t,{EL:function(){return r},Nq:function(){return s},Q$:function(){return o},_N:function(){return i},h:function(){return a}});var a={},s=Boolean("undefined"!==typeof window&&window.document&&window.document.createElement)},90299:function(e,t,n){var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(47313),d=n(18760),l=n(16614),c=n(25417),p=n(72611),h=n(57124),u=n(13380),f=n(61805),m=n(83854),v=n(46417),g=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).onShowMenu=function(){},o.onHideMenu=function(){o.state.isItemMenuShow&&(o.setState({isItemMenuShow:!1}),"function"===typeof o.props.unfreezeItem&&o.props.unfreezeItem())},o.onDropdownToggleKeyDown=function(e){"Enter"!=e.key&&"Space"!=e.key||o.onDropdownToggleClick(e)},o.onDropdownToggleClick=function(e){e.preventDefault(),e.stopPropagation(),o.toggleOperationMenu()},o.toggleOperationMenu=function(){o.setState({isItemMenuShow:!o.state.isItemMenuShow},(function(){o.state.isItemMenuShow&&"function"===typeof o.props.freezeItem?o.props.freezeItem():o.state.isItemMenuShow||"function"!==typeof o.props.unfreezeItem||o.props.unfreezeItem()}))},o.onMenuItemKeyDown=function(e){"Enter"!=e.key&&"Space"!=e.key||o.onMenuItemClick(e)},o.onMenuItemClick=function(e){var t=m.c.getEventData(e,"toggle"),n=o.props.item;o.props.onMenuItemClick(t,e,n)},o.state={menuList:[],isItemMenuShow:!1},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.props.isHandleContextMenuEvent&&(this.listenerId=d.Z.register(this.onShowMenu,this.onHideMenu));var e=this.props.item,t=this.props.getMenuList(e);this.setState({menuList:t})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.item;if(t.name!==this.props.item.name){var n=this.props.getMenuList(t);this.setState({menuList:n})}}},{key:"componentWillUnmount",value:function(){this.props.isHandleContextMenuEvent&&this.listenerId&&d.Z.unregister(this.listenerId)}},{key:"render",value:function(){var e=this,t=this.state.menuList,n=this.props,i=n.toggleClass,o=n.tagName;return i="sf-dropdown-toggle "+i,t.length?o&&"button"===o?(0,v.jsxs)(l.Z,{isOpen:this.state.isItemMenuShow,toggle:this.onDropdownToggleClick,children:[(0,v.jsx)(c.Z,{className:i,"data-toggle":"dropdown",title:(0,f.ih)("More operations"),"aria-label":(0,f.ih)("More operations"),"aria-expanded":this.state.isItemMenuShow,onKeyDown:this.onDropdownToggleKeyDown}),(0,v.jsx)(p.Z,{children:t.map((function(t,n){return"Divider"===t?(0,v.jsx)(h.Z,{divider:!0},n):(0,v.jsx)(h.Z,{"data-toggle":t.key,onClick:e.onMenuItemClick,onKeyDown:e.onMenuItemKeyDown,children:t.value},n)}))})]}):(0,v.jsxs)(u.Z,{isOpen:this.state.isItemMenuShow,toggle:this.onDropdownToggleClick,className:"vam",children:[(0,v.jsx)(c.Z,{tag:o||"i",role:"button",tabIndex:"0",className:i,title:(0,f.ih)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.isItemMenuShow,"aria-label":(0,f.ih)("More operations"),onKeyDown:this.onDropdownToggleKeyDown}),(0,v.jsx)(p.Z,{children:t.map((function(t,n){return"Divider"===t?(0,v.jsx)(h.Z,{divider:!0},n):(0,v.jsx)(h.Z,{"data-toggle":t.key,onClick:e.onMenuItemClick,onKeyDown:e.onMenuItemKeyDown,children:t.value},n)}))})]}):""}}]),n}(s.Component);g.defaultProps={isHandleContextMenuEvent:!0,toggleClass:"sf2-icon-caret-down"},t.Z=g},88376:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(1413),o=n(15671),r=n(43144),a=n(60136),s=n(29388),d=n(47313),l=n(95423),c=n(61805),p=n(83854),h=n(51282),u=n(46417),f=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).onLinkClick=function(e){r.props.onLinkClick(e)},r.changeInlineNode=function(e){var t,n,i=r.props.repoID;if("image"==e.type){if(t=e.data.src,new RegExp(c.xx+"/lib/"+i+"/file.*raw=1").test(t)){var o=t.indexOf("/file"),a=t.indexOf("?");n=t.substring(o+5,a)}else{if(!/^\.\.\/*/.test(t)&&!/^\.\/*/.test(t))return;var s=r.props.path,d=s.slice(0,s.lastIndexOf("/"))+"/"+t;n=p.c.pathNormalize(d)}e.data.src=c.xx+"/view-image-via-public-wiki/?slug="+c.oF+"&path="+n}else if("link"==e.type)if(t=e.url,p.c.isInternalFileLink(t,i))if(p.c.isInternalMarkdownLink(t,i)){var l=p.c.getPathFromInternalMarkdownLink(t,i);e.url=c.xx+"/published/"+c.oF+l}else e.url=t.replace(/(.*)lib\/([-0-9a-f]{36})\/file(.*)/g,(function(e,t,n,i){return"".concat(t,"d/").concat(c.lI,"/files/?p=").concat(i,"&dl=1")}));else if(p.c.isInternalDirLink(t,i)){var h=p.c.getPathFromInternalDirLink(t,i);e.url=c.xx+"/published/"+c.oF+h}return e},r.modifyValueBeforeRender=function(e){return p.c.changeMarkdownNodes(e,r.changeInlineNode)},r.renderMarkdown=function(){var e=r.props,t=e.isTOCShow,n=void 0===t||t,o=e.isWiki,a=e.markdownContent,s=(0,i.Z)({isShowOutline:n,mathJaxSource:"".concat(c.si,"js/mathjax/tex-svg.js"),value:a,scrollRef:r.scrollRef,onLinkClick:r.onLinkClick},o&&{beforeRenderCallback:r.modifyValueBeforeRender});return(0,u.jsx)(l.MarkdownViewer,(0,i.Z)({},s))},r.scrollRef=d.createRef(),r}return(0,r.Z)(n,[{key:"render",value:function(){if(this.props.isFileLoading)return(0,u.jsx)(h.Z,{});var e=this.props,t=e.isWiki,n=e.containerClassName,i="wiki-page-container ".concat(void 0===n?"":n),o="wiki-page-content ".concat(t?"":NaN);return(0,u.jsx)("div",{ref:this.scrollRef,className:i,children:(0,u.jsxs)("div",{className:o,children:[this.props.children,this.renderMarkdown(),(0,u.jsxs)("p",{id:"wiki-page-last-modified",children:[(0,c.ih)("Last modified by")," ",this.props.latestContributor,", ",(0,u.jsx)("span",{children:this.props.lastModified})]})]})})}}]),n}(d.Component);f.defaultProps={isWiki:!1};var m=f},20512:function(e,t,n){n.d(t,{Z:function(){return v}});var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(47313),d=n(39131),l=n(61805),c=n(90299),p=n(83854),h=n(46417),u=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;(0,i.Z)(this,n),(o=t.call(this,e)).onMouseEnter=function(){o.props.isItemFreezed||o.setState({isShowOperationMenu:!0,isHighlight:!0})},o.onMouseOver=function(){o.props.isItemFreezed||o.setState({isShowOperationMenu:!0,isHighlight:!0})},o.onMouseLeave=function(){o.props.isItemFreezed||o.setState({isShowOperationMenu:!1,isHighlight:!1})},o.onNodeClick=function(){var e=o.props.node.object;if(e.isDir())o.props.onNodeClick(o.props.node);else{var t=p.c.getUserPermission(e.permission),n=t.isCustomPermission,i=t.customPermission;if(n){var r=i.permission,a=r.preview,s=r.modify;if(!a&&!s)return}o.props.onNodeClick(o.props.node)}},o.onLoadToggle=function(e){e.stopPropagation();var t=o.props.node;t.isExpanded?o.props.onNodeCollapse(t):o.props.onNodeExpanded(t)},o.onNodeDragStart=function(e){if(p.c.isIEBrower()||!o.canDrag)return!1;o.props.onNodeDragStart(e,o.props.node)},o.onNodeDragEnter=function(e){if(p.c.isIEBrower()||!o.canDrag)return!1;"dir"===o.props.node.object.type&&o.setState({isNodeDropShow:!0}),o.props.onNodeDragEnter(e,o.props.node)},o.onNodeDragMove=function(e){if(p.c.isIEBrower()||!o.canDrag)return!1;o.props.onNodeDragMove(e)},o.onNodeDragLeave=function(e){if(p.c.isIEBrower()||!o.canDrag)return!1;o.setState({isNodeDropShow:!1}),o.props.onNodeDragLeave(e,o.props.node)},o.onNodeDrop=function(e){if(p.c.isIEBrower()||!o.canDrag)return!1;e.stopPropagation(),o.setState({isNodeDropShow:!1}),o.props.onNodeDrop(e,o.props.node)},o.unfreezeItem=function(){o.setState({isShowOperationMenu:!1}),o.props.unfreezeItem()},o.onMenuItemClick=function(e,t,n){o.props.onMenuItemClick(e,n)},o.onItemMouseDown=function(e){e.stopPropagation(),e.button},o.onItemContextMenu=function(e){o.handleContextClick(e)},o.handleContextClick=function(e){o.props.handleContextClick(e,o.props.node),o.setState({isShowOperationMenu:!1})},o.getNodeTypeAndIcon=function(){var e=o.props.node,t="",n="";if("dir"===e.object.type)t=(0,h.jsx)("i",{className:"far fa-folder"}),n="dir";else{var i=e.object.name.lastIndexOf(".");if(-1===i)t=(0,h.jsx)("i",{className:"far fa-file"}),n="file";else{var r=e.object.name.slice(i).toLowerCase();".png"===r||".jpg"===r||".jpeg"===r||".gif"===r||".bmp"===r?(t=(0,h.jsx)("i",{className:"far fa-image"}),n="image"):".md"===r||".markdown"===r?(t=(0,h.jsx)("i",{className:"far fa-file-alt"}),n="file"):(t=(0,h.jsx)("i",{className:"far fa-file"}),n="file")}}return{icon:t,type:n}},o.calculateMenuList=function(e){var t=d.Z.NEW_FOLDER,n=d.Z.NEW_FILE,i=d.Z.COPY,r=d.Z.MOVE,a=d.Z.RENAME,s=d.Z.DELETE,l=d.Z.OPEN_VIA_CLIENT,c=[a,s,i,r,l];"dir"===e.object.type&&(c=[t,n,i,r,a,s]);var h=o.props.userPerm,u=p.c.getUserPermission(h),f=u.isCustomPermission,m=u.customPermission;if(!f)return c;c=[];var v=m.permission,g=v.create,k=v.modify,w=v.delete,x=v.copy;return"dir"===e.object.type&&g&&c.push(t,n),x&&c.push(i),k&&c.push(r,a),w&&c.push(s),"dir"!==e.object.type&&c.push(l),c},o.renderChildren=function(){var e=o.props,t=e.node,i=e.paddingLeft;return t.hasChildren()?(0,h.jsx)("div",{className:"children",style:{paddingLeft:i},children:t.children.map((function(e){return(0,h.jsx)(n,{node:e,paddingLeft:i,userPerm:o.props.userPerm,currentPath:o.props.currentPath,isNodeMenuShow:o.props.isNodeMenuShow,isItemFreezed:o.props.isItemFreezed,onNodeClick:o.props.onNodeClick,onNodeCollapse:o.props.onNodeCollapse,onNodeExpanded:o.props.onNodeExpanded,freezeItem:o.props.freezeItem,onMenuItemClick:o.props.onMenuItemClick,unfreezeItem:o.unfreezeItem,onNodeDragStart:o.props.onNodeDragStart,onNodeDragMove:o.props.onNodeDragMove,onNodeDrop:o.props.onNodeDrop,onNodeDragEnter:o.props.onNodeDragEnter,onNodeDragLeave:o.props.onNodeDragLeave,handleContextClick:o.props.handleContextClick},e.path)}))}):""},o.state={isHighlight:!1,isShowOperationMenu:!1,isNodeDropShow:!1};var r=e.userPerm;o.canDrag="rw"===r;var a=p.c.getUserPermission(r),s=a.isCustomPermission,l=a.customPermission;if(s){var c=l.permission.modify;o.canDrag=c}return o}return(0,o.Z)(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.isItemFreezed||this.setState({isShowOperationMenu:!1,isHighlight:!1})}},{key:"render",value:function(){var e=this.props,t=e.currentPath,n=e.node,i=e.isNodeMenuShow,o=e.userPerm,r=this.getNodeTypeAndIcon(),a=r.type,s=r.icon,d=this.state.isHighlight?"tree-node-inner-hover ":"";n.path===t&&(d="tree-node-hight-light");var u=p.c.getUserPermission(o).isCustomPermission;return(0,h.jsxs)("div",{className:"tree-node",children:[(0,h.jsxs)("div",{type:a,className:"tree-node-inner text-nowrap ".concat(d," ").concat("/"===n.path?"hide":""," ").concat(this.state.isNodeDropShow?"tree-node-drop":""),title:n.object.name,onMouseEnter:this.onMouseEnter,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,onMouseDown:this.onItemMouseDown,onContextMenu:this.onItemContextMenu,onClick:this.onNodeClick,children:[(0,h.jsx)("div",{className:"tree-node-text",draggable:this.canDrag,onDragStart:this.onNodeDragStart,onDragEnter:this.onNodeDragEnter,onDragLeave:this.onNodeDragLeave,onDragOver:this.onNodeDragMove,onDrop:this.onNodeDrop,children:n.object.name}),(0,h.jsxs)("div",{className:"left-icon",children:["dir"===a&&(!n.isLoaded||n.isLoaded&&n.hasChildren())&&(0,h.jsx)("i",{className:"folder-toggle-icon fa ".concat(n.isExpanded?"fa-caret-down":"fa-caret-right"),onMouseDown:function(e){return e.stopPropagation()},onClick:this.onLoadToggle}),(0,h.jsx)("i",{className:"tree-node-icon",children:s})]}),i&&(0,h.jsx)("div",{className:"right-icon",children:("rw"===o||l.rd||u)&&this.state.isShowOperationMenu&&(0,h.jsx)(c.Z,{item:this.props.node,toggleClass:"fas fa-ellipsis-v",getMenuList:this.calculateMenuList,onMenuItemClick:this.onMenuItemClick,freezeItem:this.props.freezeItem,unfreezeItem:this.unfreezeItem})})]}),n.isExpanded&&this.renderChildren()]})}}]),n}(s.Component),f=n(92161),m=n(30426),v=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;(0,i.Z)(this,n),(o=t.call(this,e)).onItemMove=function(e,t,n,i){o.props.onItemMove(e,t,n,i)},o.onNodeDragStart=function(e,t){if(p.c.isIEBrower())return!1;var n={nodeDirent:t.object,nodeParentPath:t.parentNode.path,nodeRootPath:t.path};n=JSON.stringify(n),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("applicaiton/drag-item-info",n)},o.onNodeDragEnter=function(e,t){if(p.c.isIEBrower()||!o.canDrop)return!1;e.persist(),"tree-view tree "===e.target.className&&o.setState({isTreeViewDropTipShow:!0})},o.onNodeDragMove=function(e){if(p.c.isIEBrower()||!o.canDrop)return!1;e.preventDefault(),e.dataTransfer.dropEffect="move"},o.onNodeDragLeave=function(e,t){if(p.c.isIEBrower()||!o.canDrop)return!1;"tree-view tree tree-view-drop"===e.target.className&&o.setState({isTreeViewDropTipShow:!1})},o.onContainerClick=function(e){(0,m.SC)()},o.onNodeClick=function(e){(0,m.SC)(),o.props.onNodeClick(e)},o.onNodeDrop=function(e,t){if(p.c.isIEBrower()||!o.canDrop)return!1;if(!e.dataTransfer.files.length){var n=e.dataTransfer.getData("applicaiton/drag-item-info"),i=n=JSON.parse(n),r=i.nodeDirent,a=i.nodeParentPath,s=i.nodeRootPath,d=t;if(Array.isArray(n))return d?void o.onMoveItems(n,d,o.props.currentRepoInfo,d.path):("/"===n[0].nodeParentPath||o.props.onItemsMove(o.props.currentRepoInfo,"/"),void o.setState({isTreeViewDropTipShow:!1}));if(!d)return"/"===a||o.onItemMove(o.props.currentRepoInfo,r,"/",a),void o.setState({isTreeViewDropTipShow:!1});if("dir"===d.object.type&&a!==d.path&&(a!==d.parentNode.path||d.object.name!==r.name)){if("dir"===d.object.type&&"dir"===r.type)if(d.parentNode.path!==a)if(p.c.getPaths(d.path).includes(s))return;o.onItemMove(o.props.currentRepoInfo,r,d.path,a)}}},o.onMoveItems=function(e,t,n,i){var r=[],a=p.c.getPaths(i);(e.forEach((function(e){var t=e.nodeRootPath;r.push(t)})),"dir"===t.object.type)&&(r.some((function(e){return e===i}))||e[0].nodeParentPath&&e[0].nodeParentPath===t.path||r.some((function(e){return a.includes(e)}))||o.props.onItemsMove(n,i))},o.freezeItem=function(){o.setState({isItemFreezed:!0})},o.unfreezeItem=function(){o.setState({isItemFreezed:!1})},o.onMenuItemClick=function(e,t){o.props.onMenuItemClick(e,t),(0,m.SC)()},o.onMouseDown=function(e){e.stopPropagation(),e.button},o.onContextMenu=function(e){e.preventDefault();var t=o.props.currentRepoInfo;if("admin"!==t.permission&&"rw"!==t.permission)return"";o.handleContextClick(e)},o.handleContextClick=function(e,t){if(e.preventDefault(),e.stopPropagation(),o.props.isNodeMenuShow){var n=e.clientX||e.touches&&e.touches[0].pageX,i=e.clientY||e.touches&&e.touches[0].pageY;o.props.posX&&(n-=o.props.posX),o.props.posY&&(i-=o.props.posY),(0,m.SC)();var r=o.getMenuList(t),a={id:"tree-node-contextmenu",position:{x:n,y:i},target:e.target,currentObject:t,menuList:r};(0,m.AE)(a)}},o.getMenuList=function(e){var t=[],n=d.Z.NEW_FOLDER,i=d.Z.NEW_FILE,r=d.Z.COPY,a=d.Z.MOVE,s=d.Z.RENAME,l=d.Z.DELETE,c=d.Z.OPEN_VIA_CLIENT;if(!e)return[n,i];t="dir"===e.object.type?[n,i,r,a,s,l]:[s,l,r,a,c];var h=o.props.userPerm,u=p.c.getUserPermission(h),f=u.isCustomPermission,m=u.customPermission;if(!f)return t;t=[];var v=m.permission,g=v.create,k=v.modify,w=v.delete,x=v.copy;return e?("dir"===e.object.type&&g&&t.push(n,i),x&&t.push(r),k&&t.push(a,s),w&&t.push(l),"dir"!==e.object.type&&t.push(c),t):(g&&t.push(n,i),t)},o.onShowMenu=function(){o.freezeItem()},o.onHideMenu=function(){o.unfreezeItem()},o.state={isItemFreezed:!1,isTreeViewDropTipShow:!1};var r=e.userPerm;o.canDrop="rw"===r;var a=p.c.getUserPermission(r),s=a.isCustomPermission,l=a.customPermission;if(s){var c=l.permission.modify;o.canDrop=c}return o}return(0,o.Z)(n,[{key:"render",value:function(){return(0,h.jsxs)("div",{className:"tree-view tree ".concat(this.state.isTreeViewDropTipShow&&this.canDrop?"tree-view-drop":""),onDrop:this.onNodeDrop,onDragEnter:this.onNodeDragEnter,onDragLeave:this.onNodeDragLeave,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onClick:this.onContainerClick,children:[(0,h.jsx)(u,{userPerm:this.props.userPerm,node:this.props.treeData.root,currentPath:this.props.currentPath,paddingLeft:20,isNodeMenuShow:this.props.isNodeMenuShow,isItemFreezed:this.state.isItemFreezed,onNodeClick:this.onNodeClick,onMenuItemClick:this.props.onMenuItemClick,onNodeExpanded:this.props.onNodeExpanded,onNodeCollapse:this.props.onNodeCollapse,onNodeDragStart:this.onNodeDragStart,freezeItem:this.freezeItem,unfreezeItem:this.unfreezeItem,onNodeDragMove:this.onNodeDragMove,onNodeDrop:this.onNodeDrop,onNodeDragEnter:this.onNodeDragEnter,onNodeDragLeave:this.onNodeDragLeave,handleContextClick:this.handleContextClick}),(0,h.jsx)(f.Z,{id:"tree-node-contextmenu",onMenuItemClick:this.onMenuItemClick,onHideMenu:this.onHideMenu,onShowMenu:this.onShowMenu})]})}}]),n}(s.Component)},46689:function(e,t,n){var i=n(47313),o=n(1168),r=n(15671),a=n(43144),s=n(60136),d=n(29388),l=n(70816),c=n.n(l),p=n(66367),h=n.n(p),u=n(42995),f=n(83854),m=n(61805),v=n(4514),g=n(55668),k=n(70609),w=n(47809),x=n(93564),N=n(51282),C=n(20512),D=n(95423),M=function(){function e(t){var n=t.name,i=t.href,o=t.parentNode;(0,r.Z)(this,e),this.name=n,this.href=i,this.parentNode=o||null,this.children=[]}return(0,a.Z)(e,[{key:"setParent",value:function(e){this.parentNode=e}},{key:"addChildren",value:function(e){this.children=e}}]),e}(),L=function e(t,n){var i=t.name,o="/"===n?n+i:n+"/"+i;t.path=o,t.children.length>0&&t.children.forEach((function(t){e(t,o)}))},S=function(e){var t;if(e.children[1]&&"link"===e.children[1].type){var n=e.children[1],i=n.children[0],o=i?i.text:"";t=new M({name:o,href:n.url})}else if(e.children[0]){var r=e.children[0],a=r.text?r.text:"";t=new M({name:a,href:""})}else t=new M({name:"",href:""});return t},y=function e(t,n){var i=t.map((function(t){if(2!==t.children.length||"unordered_list"!==t.children[1].type&&"ordered_list"!==t.children[1].type)return t.children[0]&&"paragraph"===t.children[0].type?S(t.children[0]):new M({name:"",href:""});var n=t.children[0],i=S(n),o=t.children[1];return e(o.children,i)}));return n.addChildren(i),n},j=function(e){var t=new M({name:"",href:""});return e.forEach((function(e){"unordered_list"!==e.type&&"ordered_list"!==e.type||(t=y(e.children,t),L(t,"/"))})),t},I=n(46123),E=n.n(I),P=n(46417),b=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).toggleExpanded=function(){var e=i.state.expanded;i.setState({expanded:!e})},i.onLinkClick=function(e){e.preventDefault();var t=i.props.node,n=i.state.expanded;t.children&&t.children.length>0&&!n?i.setState({expanded:!n}):i.props.onLinkClick(t)},i.itemClick=function(){var e=i.props.node,t=i.state.expanded;e.children&&e.children.length>0&&i.setState({expanded:!t})},i.renderLink=function(e){var t=e.href,n=e.name,o=e.path,r=e.children,a=i.props.currentPath,s=E()("wiki-nav-content",{"no-children":!r||0===r.length,"wiki-nav-content-highlight":a===o});return t&&n?(0,P.jsx)("div",{className:s,children:(0,P.jsx)("a",{href:t,"data-path":o,onClick:i.onLinkClick,title:n,children:n})}):n?(0,P.jsx)("div",{className:s,onClick:i.itemClick,children:(0,P.jsx)("span",{title:n,children:n})}):null},i.state={expanded:!1},i}return(0,a.Z)(n,[{key:"render",value:function(){var e=this,t=this.props.node,i=this.state.expanded;return t.children.length>0?(0,P.jsxs)("div",{className:"pl-4 position-relative",children:[(0,P.jsx)("span",{className:"switch-btn",onClick:this.toggleExpanded,children:(0,P.jsx)("i",{className:"fa fa-caret-".concat(i?"down":"right")})}),this.renderLink(t),i&&t.children.map((function(t,i){return(0,P.jsx)(n,{node:t,currentPath:e.props.currentPath,onLinkClick:e.props.onLinkClick},i)}))]}):this.renderLink(t)}}]),n}(i.Component),Z=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).onLinkClick=function(e){var t=i.state.currentPath;e.path!==t&&(e.path&&i.setState({currentPath:e.path}),e.href&&i.props.onLinkClick(e.href))},i.changeInlineNode=function(e){var t;if("link"==e.type||"image"===e.type)if("image"==e.type&&m.O6){if(t=e.data.src,!new RegExp(m.xx+"/lib/"+m.Jv+"/file.*raw=1").test(t))return;var n=t.indexOf("/file"),i=t.indexOf("?"),o=t.substring(n+5,i);e.data.src=m.xx+"/view-image-via-public-wiki/?slug="+m.oF+"&path="+o}else if("link"==e.type){t=e.url;if(new RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/).test(t)){if(f.c.isInternalMarkdownLink(t,m.Jv)){var r=f.c.getPathFromInternalMarkdownLink(t,m.Jv);e.url=m.xx+"/published/"+m.oF+r}else if(f.c.isInternalDirLink(t,m.Jv)){var a=f.c.getPathFromInternalDirLink(t,m.Jv);e.url=m.xx+"/published/"+m.oF+a}}else t.startsWith("./")&&(t=t.slice(2)),e.url=m.xx+"/published/"+m.oF+"/"+t}return e},i.links=[],i.state={currentPath:"",treeRoot:{name:"",href:"",children:[],isRoot:!0}},i}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props.indexContent,t=(0,D.mdStringToSlate)(e),n=f.c.changeMarkdownNodes(t,this.changeInlineNode),i=j(n);this.setState({treeRoot:i})}},{key:"render",value:function(){var e=this,t=this.state,n=t.treeRoot,i=t.currentPath;return(0,P.jsx)("div",{className:"mx-4 o-hidden",children:n.children.map((function(t){return(0,P.jsx)(b,{node:t,currentPath:i,onLinkClick:e.onLinkClick},t.path)}))})}}]),n}(i.Component),F=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).renderIndexView=function(){return(0,P.jsxs)("div",{className:"wiki-pages-container",children:[(0,P.jsx)("div",{style:{marginTop:"2px"}}),(0,P.jsx)(Z,{indexContent:i.props.indexContent,onLinkClick:i.props.onLinkClick})]})},i.renderTreeView=function(){return(0,P.jsx)("div",{className:"wiki-pages-container",children:i.props.treeData&&(0,P.jsx)(C.Z,{treeData:i.props.treeData,currentPath:i.props.currentPath,isNodeMenuShow:i.isNodeMenuShow,onNodeClick:i.props.onNodeClick,onNodeCollapse:i.props.onNodeCollapse,onNodeExpanded:i.props.onNodeExpanded})})},i.isNodeMenuShow=!1,i}return(0,a.Z)(n,[{key:"render",value:function(){return(0,P.jsxs)("div",{className:"side-panel wiki-side-panel ".concat(this.props.closeSideBar?"":"left-zero"),children:[(0,P.jsx)("div",{className:"side-panel-top panel-top",children:(0,P.jsx)(x.Z,{onCloseSidePanel:this.props.onCloseSide})}),(0,P.jsxs)("div",{id:"side-nav",className:"wiki-side-nav",role:"navigation",children:[this.props.isTreeDataLoading&&(0,P.jsx)(N.Z,{}),!this.props.isTreeDataLoading&&this.props.indexNode&&this.renderIndexView(),!this.props.isTreeDataLoading&&!this.props.indexNode&&this.renderTreeView(),m.b6&&m.rd&&(0,P.jsx)("div",{className:"text-left p-2",children:(0,P.jsx)("a",{href:m.ze+"library/"+m.Jv+"/"+m.oF+"/",className:"text-dark text-decoration-underline",children:(0,m.ih)("Go to Library")})})]})]})}}]),n}(i.Component),T=n(88376),z=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).onMouseEnter=function(){i.setState({highlight:!0})},i.onMouseLeave=function(){i.setState({highlight:!1})},i.onContextMenu=function(e){e.preventDefault(),e.stopPropagation()},i.onDirentClick=function(e){e.preventDefault(),i.props.onDirentClick(i.props.dirent)},i.state={highlight:!1},i}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.path,n=e.dirent,i=m.ze+"published"+f.c.joinPath(t,n.name),o=f.c.getDirentIcon(n);return f.c.isDesktop()?(0,P.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onContextMenu:this.onContextMenu,children:[(0,P.jsx)("td",{className:"text-center",children:(0,P.jsx)("img",{src:o,width:"24",alt:""})}),(0,P.jsx)("td",{className:"name",children:(0,P.jsx)("a",{href:i,onClick:this.onDirentClick,children:n.name})}),(0,P.jsx)("td",{children:n.size}),(0,P.jsx)("td",{children:n.mtime_relative})]}):(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{className:"text-center",children:(0,P.jsx)("img",{src:o,width:"24",alt:""})}),(0,P.jsxs)("td",{children:[(0,P.jsx)("a",{href:i,onClick:this.onDirentClick,children:n.name}),(0,P.jsx)("br",{}),(0,P.jsx)("span",{className:"item-meta-info",children:n.size}),(0,P.jsx)("span",{className:"item-meta-info",children:n.mtime_relative})]})]})}}]),n}(i.Component),O=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){var e=this,t=f.c.isDesktop();return(0,P.jsxs)("table",{className:"table-hover ".concat(t?"":"table-thead-hidden"),children:[(0,P.jsx)("thead",{children:t?(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{style:{width:"4%"}}),(0,P.jsx)("th",{style:{width:"66%"},children:(0,m.ih)("Name")}),(0,P.jsx)("th",{style:{width:"15%"},children:(0,m.ih)("Size")}),(0,P.jsx)("th",{style:{width:"15%"},children:(0,m.ih)("Last Update")})]}):(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{width:"12%"}),(0,P.jsx)("th",{width:"88%"})]})}),(0,P.jsx)("tbody",{children:0!==this.props.direntList.length&&this.props.direntList.map((function(t,n){return(0,P.jsx)(z,{path:e.props.path,dirent:t,onDirentClick:e.props.onDirentClick},n)}))})]})}}]),n}(i.Component),B=O,R=n(49119),W=n(29619),_=n(93190),H=n(1413),V=n(63036),A=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(e){var o;return(0,r.Z)(this,n),(o=t.call(this,e)).changeInlineNode=function(e){var t,n,i=o.props.repoID;if("image"==e.type){if(t=e.data.src,new RegExp(m.xx+"/lib/"+i+"/file.*raw=1").test(t)){var r=t.indexOf("/file"),a=t.indexOf("?");n=t.substring(r+5,a)}else{if(!/^\.\.\/*/.test(t)&&!/^\.\/*/.test(t))return;var s=o.props.path,d=s.slice(0,s.lastIndexOf("/"))+"/"+t;n=f.c.pathNormalize(d)}e.data.src=m.xx+"/view-image-via-public-wiki/?slug="+m.oF+"&path="+n}else if("link"==e.type)if(t=e.url,f.c.isInternalFileLink(t,i))if(f.c.isInternalMarkdownLink(t,i)){var l=f.c.getPathFromInternalMarkdownLink(t,i);e.url=m.xx+"/published/"+m.oF+l}else e.url=t.replace(/(.*)lib\/([-0-9a-f]{36})\/file(.*)/g,(function(e,t,n,i){return"".concat(t,"d/").concat(m.lI,"/files/?p=").concat(i,"&dl=1")}));else if(f.c.isInternalDirLink(t,i)){var c=f.c.getPathFromInternalDirLink(t,i);e.url=m.xx+"/published/"+m.oF+c}return e},o.modifyValueBeforeRender=function(e){return f.c.changeMarkdownNodes(e,o.changeInlineNode)},o.renderMarkdown=function(){var e=o.props,t=e.isTOCShow,n=e.markdownContent;if(!n)return null;var i=JSON.parse(n);window.seafile||(window.seafile={serviceUrl:m.xx,username:m.b6,name:m.u2,avatarURL:m.UK,repoID:m.Jv,siteRoot:m.ze,assetsUrl:m.Qu});var r={document:i,showOutline:t,scrollRef:o.scrollRef};return(0,P.jsx)(V.UT,(0,H.Z)({},r))},o.scrollRef=i.createRef(),o}return(0,a.Z)(n,[{key:"render",value:function(){if(this.props.isFileLoading)return(0,P.jsx)(N.Z,{});var e=this.props,t=e.isWiki,n=e.containerClassName,i="wiki-page-container ".concat(void 0===n?"":n),o="wiki-page-content ".concat(t?"":NaN);return(0,P.jsx)("div",{ref:this.scrollRef,className:i,children:(0,P.jsxs)("div",{className:o,children:[this.props.children,this.renderMarkdown(),(0,P.jsxs)("p",{id:"wiki-page-last-modified",children:[(0,m.ih)("Last modified by")," ",this.props.latestContributor,", ",(0,P.jsx)("span",{children:this.props.lastModified})]})]})})}}]),n}(i.Component);A.defaultProps={isWiki:!1,isTOCShow:!0};var U=A,J=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).onMenuClick=function(){e.props.onMenuClick()},e.onEditClick=function(t){t.preventDefault();var n=m.ze+"lib/"+m.Jv+"/file"+e.props.path+"?mode=edit";window.open(n)},e.onMainNavBarClick=function(t){var n=f.c.getEventData(t,"path");e.props.onMainNavBarClick(n)},e.renderNavPath=function(){var t=e.props.path.split("/"),n="";return t.map((function(o,r){return""===o?null:r===t.length-1?(0,P.jsxs)(i.Fragment,{children:[(0,P.jsx)("span",{className:"path-split",children:"/"}),(0,P.jsx)("span",{className:"path-file-name",children:o})]},r):(n+="/"+o,(0,P.jsxs)(i.Fragment,{children:[(0,P.jsx)("span",{className:"path-split",children:"/"}),(0,P.jsx)("a",{className:"path-link","data-path":n,onClick:e.onMainNavBarClick,children:o})]},r))}))},e}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props.onSearchedClick,t=(0,P.jsx)("div",{className:"message err-tip",children:(0,m.ih)("Folder does not exist.")}),n=this.props.pathExist&&!this.props.isDataLoading&&this.props.isViewFile;return(0,P.jsxs)("div",{className:"main-panel wiki-main-panel",children:[(0,P.jsx)("div",{className:"main-panel-hide hide",children:this.props.content}),(0,P.jsxs)("div",{className:"main-panel-north panel-top ".concat("rw"===this.props.permission?"border-left-show":""),children:[!m.b6&&(0,P.jsxs)(i.Fragment,{children:[(0,P.jsx)("div",{className:"cur-view-toolbar",children:(0,P.jsx)("span",{className:"sf2-icon-menu hidden-md-up d-md-none side-nav-toggle",title:"Side Nav Menu",onClick:this.onMenuClick})}),(0,P.jsx)("div",{className:"common-toolbar",children:m._y&&(0,P.jsx)(R.Z,{isPublic:!0,repoID:m.Jv,onSearchedClick:e,placeholder:(0,m.ih)("Search files")})})]}),m.b6&&(0,P.jsxs)(i.Fragment,{children:[(0,P.jsxs)("div",{className:"cur-view-toolbar",children:[(0,P.jsx)("span",{className:"sf2-icon-menu hidden-md-up d-md-none side-nav-toggle",title:"Side Nav Menu",onClick:this.onMenuClick}),"rw"==this.props.permission&&(f.c.isDesktop()?(0,P.jsx)("button",{className:"btn btn-secondary operation-item",title:(0,m.ih)("Edit"),onClick:this.onEditClick,children:(0,m.ih)("Edit")}):(0,P.jsx)("span",{className:"fa fa-pencil-alt mobile-toolbar-icon",title:(0,m.ih)("Edit"),onClick:this.onEditClick,style:{fontSize:"1.1rem"}}))]}),(0,P.jsxs)("div",{className:"common-toolbar",children:[m._y&&(0,P.jsx)(R.Z,{isPublic:!0,repoID:m.Jv,onSearchedClick:e,placeholder:(0,m.ih)("Search files")}),(0,P.jsx)(W.Z,{}),(0,P.jsx)(_.Z,{})]})]})]}),(0,P.jsx)("div",{className:"main-panel-center",children:(0,P.jsxs)("div",{className:"cur-view-content ".concat(n?"o-hidden":""),children:[!this.props.pathExist&&t,this.props.pathExist&&this.props.isDataLoading&&(0,P.jsx)(N.Z,{}),n&&f.c.isMarkdownFile(this.props.path)&&(0,P.jsx)(T.Z,{isWiki:!0,path:this.props.path,repoID:m.Jv,markdownContent:this.props.content,isFileLoading:this.props.isDataLoading,lastModified:this.props.lastModified,latestContributor:this.props.latestContributor,onLinkClick:this.props.onLinkClick}),n&&f.c.isSdocFile(this.props.path)&&(0,P.jsx)(U,{isWiki:!0,path:this.props.path,repoID:m.Jv,markdownContent:this.props.content,isFileLoading:this.props.isDataLoading,lastModified:this.props.lastModified,latestContributor:this.props.latestContributor,onLinkClick:this.props.onLinkClick}),!this.props.isDataLoading&&!this.props.isViewFile&&(0,P.jsx)(B,{path:this.props.path,direntList:this.props.direntList,onDirentClick:this.props.onDirentClick})]})})]})}}]),n}(i.Component),K=J;n(54890),n(98391),n(53379);c().locale(m.KQ);var X=function(e){(0,s.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).loadSidePanel=function(e){m.dP?i.loadIndexNode():(e="None"===m.zj||f.c.isSdocFile(e)?"/":e,i.loadNodeAndParentsByPath(e))},i.loadWikiData=function(e){if(i.pythonWrapper=document.getElementById("wiki-file-content"),"False"===m.zj&&f.c.isSdocFile(e))i.showDir("/");else if("False"!==m.zj)if(i.removePythonWrapper(),"True"!==m.zj)if("None"!==m.zj||"/home.md"!==e){if("None"===m.zj){i.setState({pathExist:!1});var t=m.ze+"published/"+m.oF+f.c.encodePath(e);window.history.pushState({url:t,path:e},e,t)}}else i.showDir("/");else i.showDir(e);else i.setState({path:e})},i.loadIndexNode=function(){v.I.listWikiDir(m.oF,"/").then((function(e){var t=i.state.treeData;i.addFirstResponseListToNode(e.data.dirent_list,t.root);var n=t.getNodeByPath(i.indexPath);v.I.getWikiFileContent(m.oF,n.path).then((function(e){i.setState({treeData:t,indexNode:n,indexContent:e.data.content,isTreeDataLoading:!1})}))})).catch((function(){i.setState({isLoadFailed:!0})}))},i.showDir=function(e){i.removePythonWrapper(),i.loadDirentList(e);var t=m.ze+"published/"+m.oF+f.c.encodePath(e);window.history.pushState({url:t,path:e},e,t)},i.showFile=function(e){i.setState({isDataLoading:!0,isViewFile:!0,path:e}),i.removePythonWrapper(),v.I.getWikiFileContent(m.oF,e).then((function(e){var t=e.data;i.setState({isDataLoading:!1,content:t.content,permission:t.permission,lastModified:c().unix(t.last_modified).fromNow(),latestContributor:t.latest_contributor})}));var t=window.location.hash,n=m.ze+"published/"+m.oF+f.c.encodePath(e)+t;"/home.md"===e?window.history.replaceState({url:n,path:e},e,n):window.history.pushState({url:n,path:e},e,n)},i.loadDirentList=function(e){i.setState({isDataLoading:!0}),v.I.listWikiDir(m.oF,e).then((function(t){var n=t.data.dirent_list.map((function(e){return new g.Z(e)}));"/"===e&&(n=n.filter((function(e){if("dir"===e.type){var t=e.name.toLowerCase();return"drafts"!==t&&"images"!==t&&"downloads"!==t}return!0}))),n=f.c.sortDirents(n,"name","asc"),i.setState({path:e,isViewFile:!1,direntList:n,isDataLoading:!1})})).catch((function(){i.setState({isLoadFailed:!0})}))},i.loadTreeNodeByPath=function(e){var t=i.state.treeData.clone(),n=t.getNodeByPath(e);n.isLoaded?(t.getNodeByPath(n.parentNode.path).isExpanded=!0,i.setState({treeData:t,currentNode:n})):v.I.listWikiDir(m.oF,n.path).then((function(e){i.addResponseListToNode(e.data.dirent_list,n),t.getNodeByPath(n.parentNode.path).isExpanded=!0,i.setState({treeData:t,currentNode:n})}))},i.loadNodeAndParentsByPath=function(e){var t=i.state.treeData.clone();f.c.isMarkdownFile(e)&&(e=f.c.getDirName(e)),v.I.listWikiDir(m.oF,e,!0).then((function(e){for(var n=e.data.dirent_list,o={},r=0;r<n.length;r++){var a=n[r],s=a.parent_dir;o[s]||(o[s]=[]),o[s].push(a)}for(var d in o){var l=t.getNodeByPath(d);l.isLoaded||"/"!==l.path?l.isLoaded||i.addResponseListToNode(o[d],l):i.addFirstResponseListToNode(o[d],l)}i.setState({isTreeDataLoading:!1,treeData:t})})).catch((function(){i.setState({isLoadFailed:!0})}))},i.removePythonWrapper=function(){i.pythonWrapper&&(document.body.removeChild(i.pythonWrapper),i.pythonWrapper=null)},i.onConentLinkClick=function(e){e.preventDefault(),e.stopPropagation();var t="";if("A"!==e.target.tagName){for(var n=e.target.parentNode;"A"!==n.tagName;)n=n.parentNode;t=n.href}else t=e.target.href;i.onLinkClick(t)},i.onLinkClick=function(e){var t=e;if(f.c.isWikiInternalMarkdownLink(t,m.oF)){var n=f.c.getPathFromWikiInternalMarkdownLink(t,m.oF);i.showFile(n)}else if(f.c.isWikiInternalDirLink(t,m.oF)){var o=f.c.getPathFromWikiInternalDirLink(t,m.oF);i.showDir(o)}else window.location.href=t;i.state.closeSideBar||i.setState({closeSideBar:!0})},i.onpopstate=function(e){if(e.state&&e.state.path){var t=e.state.path;f.c.isMarkdownFile(t)?i.showFile(t):(i.loadDirentList(t),i.setState({path:t,isViewFile:!1}))}},i.onSearchedClick=function(e){var t=e.is_dir?e.path.slice(0,e.path.length-1):e.path;if(i.state.currentPath!==t){for(var n=-1,o=f.c.getPaths(t),r=0;r<o.length;r++){var a=i.state.treeData.getNodeByPath(a);if(!a){n=r;break}}if(-1===n){var s=i.state.treeData.clone(),d=s.getNodeByPath(e.path);w.Z.expandNode(d),i.setState({treeData:s})}else i.loadNodeAndParentsByPath(t);if(e.is_dir)i.showDir(t);else if(f.c.isMarkdownFile(t))i.showFile(t);else{var l=m.ze+"d/"+m.lI+"/files/?p="+f.c.encodePath(t);window.open("about:blank").location.href=l}}},i.onMenuClick=function(){i.setState({closeSideBar:!i.state.closeSideBar})},i.onMainNavBarClick=function(e){var t=i.state.treeData.clone(),n=t.getNodeByPath(e);t.expandNode(n),i.setState({treeData:t,currentNode:n}),i.showDir(n.path)},i.onDirentClick=function(e){var t=f.c.joinPath(i.state.path,e.name);if(e.isDir())i.loadTreeNodeByPath(t),i.showDir(t);else if(f.c.isMarkdownFile(t))i.showFile(t);else{var n=window.open("about:blank"),o=m.ze+"d/"+m.lI+"/files/?p="+f.c.encodePath(t);n.location.href=o}},i.onCloseSide=function(){i.setState({closeSideBar:!i.state.closeSideBar})},i.onNodeClick=function(e){if(i.state.pathExist||i.setState({pathExist:!0}),e.object.isDir()){if(!e.isLoaded){var t=i.state.treeData.clone();e=t.getNodeByPath(e.path),v.I.listWikiDir(m.oF,e.path).then((function(n){i.addResponseListToNode(n.data.dirent_list,e),t.collapseNode(e),i.setState({treeData:t})}))}if(e.path===i.state.path)if(e.isExpanded){var n=w.Z.collapseNode(i.state.treeData,e);i.setState({treeData:n})}else{var o=i.state.treeData.clone();e=o.getNodeByPath(e.path),o.expandNode(e),i.setState({treeData:o})}}if(e.path!==i.state.path)if(e.object.isDir())i.showDir(e.path);else if(f.c.isMarkdownFile(e.path)||f.c.isSdocFile(e.path))e.path!==i.state.path&&i.showFile(e.path),i.onCloseSide();else{var r=window.open("about:blank"),a=m.ze+"d/"+m.lI+"/files/?p="+f.c.encodePath(e.path);r.location.href=a}},i.onNodeCollapse=function(e){var t=w.Z.collapseNode(i.state.treeData,e);i.setState({treeData:t})},i.onNodeExpanded=function(e){var t=i.state.treeData.clone();(e=t.getNodeByPath(e.path)).isLoaded?(t.expandNode(e),i.setState({treeData:t})):v.I.listWikiDir(m.oF,e.path).then((function(n){i.addResponseListToNode(n.data.dirent_list,e),i.setState({treeData:t})}))},i.addFirstResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var n=e.map((function(e){return new g.Z(e)}));n=n.filter((function(e){if("dir"===e.type){var t=e.name.toLowerCase();return"drafts"!==t&&"images"!==t&&"downloads"!==t}return!0}));var i=(n=f.c.sortDirents(n,"name","asc")).map((function(e){return new k.Z({object:e})}));t.addChildren(i)},i.addResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var n=e.map((function(e){return new g.Z(e)})),i=(n=f.c.sortDirents(n,"name","asc")).map((function(e){return new k.Z({object:e})}));t.addChildren(i)},i.state={path:"",pathExist:!0,closeSideBar:!1,isViewFile:!0,isDataLoading:!1,direntList:[],content:"",permission:"",lastModified:"",latestContributor:"",isTreeDataLoading:!0,treeData:w.Z.buildTree(),currentNode:null,indexNode:null,indexContent:""},window.onpopstate=i.onpopstate,i.indexPath="/index.md",i.homePath="/home.md",i.pythonWrapper=null,i}return(0,a.Z)(n,[{key:"UNSAFE_componentWillMount",value:function(){f.c.isDesktop()||this.setState({closeSideBar:!0})}},{key:"componentDidMount",value:function(){var e=this;this.loadSidePanel(m.OG),this.loadWikiData(m.OG),this.links=document.querySelectorAll("#wiki-file-content a"),this.links.forEach((function(t){return t.addEventListener("click",e.onConentLinkClick)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.links.forEach((function(t){return t.removeEventListener("click",e.onConentLinkClick)}))}},{key:"render",value:function(){return(0,P.jsxs)("div",{id:"main",className:"wiki-main",children:[(0,P.jsx)(F,{isTreeDataLoading:this.state.isTreeDataLoading,closeSideBar:this.state.closeSideBar,currentPath:this.state.path,treeData:this.state.treeData,indexNode:this.state.indexNode,indexContent:this.state.indexContent,onCloseSide:this.onCloseSide,onNodeClick:this.onNodeClick,onNodeCollapse:this.onNodeCollapse,onNodeExpanded:this.onNodeExpanded,onLinkClick:this.onLinkClick}),(0,P.jsx)(K,{path:this.state.path,pathExist:this.state.pathExist,isViewFile:this.state.isViewFile,isDataLoading:this.state.isDataLoading,content:this.state.content,permission:this.state.permission,lastModified:this.state.lastModified,latestContributor:this.state.latestContributor,direntList:this.state.direntList,onLinkClick:this.onLinkClick,onMenuClick:this.onMenuClick,onSearchedClick:this.onSearchedClick,onMainNavBarClick:this.onMainNavBarClick,onDirentClick:this.onDirentClick}),(0,P.jsx)(h(),{query:"(max-width: 767.8px)",children:(0,P.jsx)(u.Z,{isOpen:!this.state.closeSideBar,toggle:this.onCloseSide,contentClassName:"d-none"})})]})}}]),n}(i.Component);o.render((0,P.jsx)(X,{}),document.getElementById("wrapper"))}},function(e){e.O(0,[351],(function(){return t=46689,e(e.s=t);var t}));e.O()}]);