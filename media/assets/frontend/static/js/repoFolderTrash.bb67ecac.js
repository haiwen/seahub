"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[9023],{68849:function(e,t,r){var n=r(23029),s=r(92901),a=r(39874),o=r(85501),i=r(9950),l=r(8081),d=r(10877),c=r(6754),h=r(34322),u=r(9341),m=r(30730),p=r(40326),f=r(97011),x=r(65604),g=r(4086),j=r(20338),b=r(44414),v=function(e){function t(e){var r;return(0,n.default)(this,t),(r=(0,a.default)(this,t,[e])).handleInputChange=function(e){r.setState({inputValue:e})},r.formSubmit=function(){var e=r.state.inputValue,t=r.props.repoID;r.setState({submitBtnDisabled:!0}),f.e.deleteRepoTrash(t,e.value).then((function(e){g.A.success((0,p.APU)("Clean succeeded.")),r.props.refreshTrash(),r.props.toggleDialog()})).catch((function(e){var t=x.Aq.getErrorMsg(e);r.setState({formErrorMsg:t,submitBtnDisabled:!1})}))},r.options=[{label:(0,p.APU)("3 days ago"),value:3},{label:(0,p.APU)("1 week ago"),value:7},{label:(0,p.APU)("1 month ago"),value:30},{label:(0,p.APU)("all"),value:0}],r.state={inputValue:r.options[0],submitBtnDisabled:!1},r}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.state.formErrorMsg;return(0,b.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,b.jsx)(j.A,{toggle:this.props.toggleDialog,children:(0,p.APU)("Clean")}),(0,b.jsx)(d.A,{children:(0,b.jsxs)(i.Fragment,{children:[(0,b.jsx)("p",{children:(0,p.APU)("Clear files in trash and history\uff1a")}),(0,b.jsx)(u.A,{defaultValue:this.options[0],options:this.options,autoFocus:!1,onChange:this.handleInputChange,placeholder:"",styles:m.x}),e&&(0,b.jsx)("p",{className:"error m-0 mt-2",children:e})]})}),(0,b.jsxs)(c.A,{children:[(0,b.jsx)(h.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,p.APU)("Cancel")}),(0,b.jsx)(h.A,{color:"primary",disabled:this.state.submitBtnDisabled,onClick:this.formSubmit,children:(0,p.APU)("Submit")})]})]})}}])}(i.Component);t.A=v},12121:function(e,t,r){var n=r(23029),s=r(92901),a=r(39874),o=r(85501),i=r(9950),l=r(1352),d=r(14894),c=r(4159),h=r.n(c),u=r(65604),m=r(40326),p=r(97011),f=r(9961),x=r(40866),g=r(4086),j=r(72991),b=r(68849),v=r(49434),A=(r(40672),r(81848),r(44414)),P=window.app.pageOptions,D=P.repoID,M=P.repoFolderName,k=P.path,C=P.enableUserCleanTrash,F=P.isRepoAdmin,U=function(e){function t(e){var r;return(0,n.default)(this,t),(r=(0,a.default)(this,t,[e])).getItems=function(e){p.e.getRepoFolderTrash(D,k,e).then((function(e){var t=e.data,n=t.data,s=t.more,a=t.scan_stat;!n.length&&s?r.getItems(a):r.setState({isLoading:!1,items:r.state.items.concat(n),more:s,scanStat:a})})).catch((function(e){r.setState({isLoading:!1,errorMsg:u.Aq.getErrorMsg(e,!0)})}))},r.getMore=function(){r.setState({isLoading:!0}),r.getItems(r.state.scanStat)},r.onSearchedClick=function(e){if(!0===e.is_dir){var t=m.YcY+"library/"+e.repo_id+"/"+e.repo_name+e.path;(0,d.oo)(t,{replace:!0})}else{var r=m.YcY+"lib/"+e.repo_id+"/file"+u.Aq.encodePath(e.path);window.open("about:blank").location.href=r}},r.goBack=function(e){e.preventDefault(),window.history.back()},r.cleanTrash=function(){r.toggleCleanTrashDialog()},r.toggleCleanTrashDialog=function(){r.setState({isCleanTrashDialogOpen:!r.state.isCleanTrashDialogOpen})},r.refreshTrash=function(){r.setState({isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,showFolder:!1}),r.getItems()},r.renderFolder=function(e,t,n){r.setState({showFolder:!0,commitID:e,baseDir:t,folderPath:n,folderItems:[],isLoading:!0}),p.e.listCommitDir(D,e,"".concat(t.substr(0,t.length-1)).concat(n)).then((function(e){r.setState({isLoading:!1,folderItems:e.data.dirent_list})})).catch((function(e){e.response?403==e.response.status?r.setState({isLoading:!1,errorMsg:(0,m.APU)("Permission denied")}):r.setState({isLoading:!1,errorMsg:(0,m.APU)("Error")}):r.setState({isLoading:!1,errorMsg:(0,m.APU)("Please check the network.")})}))},r.clickRoot=function(e){e.preventDefault(),r.refreshTrash()},r.clickFolderPath=function(e,t){t.preventDefault();var n=r.state,s=n.commitID,a=n.baseDir;r.renderFolder(s,a,e)},r.renderFolderPath=function(){var e=r.state.folderPath.split("/");return(0,A.jsxs)(i.Fragment,{children:[(0,A.jsx)("a",{href:"#",onClick:r.clickRoot,className:"text-truncate",title:M,children:M}),(0,A.jsx)("span",{className:"mx-1",children:"/"}),e.map((function(t,n){return n>0&&n!=e.length-1?(0,A.jsxs)(i.Fragment,{children:[(0,A.jsx)("a",{className:"text-truncate",href:"#",onClick:r.clickFolderPath.bind(r,e.slice(0,n+1).join("/")),title:e[n],children:e[n]}),(0,A.jsx)("span",{className:"mx-1",children:"/"})]},n):null})),(0,A.jsx)("span",{className:"text-truncate",title:e[e.length-1],children:e[e.length-1]})]})},r.state={isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,isCleanTrashDialogOpen:!1},r}return(0,o.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){this.getItems()}},{key:"render",value:function(){var e=this.state,t=e.isCleanTrashDialogOpen,r=e.showFolder,n=(0,m.APU)("{placeholder} Trash");return n=n.replace("{placeholder}",'<span class="op-target text-truncate mx-1">'+u.Aq.HTMLescape(M)+"</span>"),(0,A.jsxs)(i.Fragment,{children:[(0,A.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,A.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[(0,A.jsx)("a",{href:m.YcY,children:(0,A.jsx)("img",{src:m.SGU+m.VIO,height:m.hMI,width:m.gAF,title:m.q0L,alt:"logo"})}),(0,A.jsx)(j.A,{onSearchedClick:this.onSearchedClick})]}),(0,A.jsx)("div",{className:"flex-auto container-fluid pt-4 pb-6 o-auto",children:(0,A.jsx)("div",{className:"row",children:(0,A.jsxs)("div",{className:"col-md-10 offset-md-1",children:[(0,A.jsx)("h2",{dangerouslySetInnerHTML:{__html:n},className:"d-flex mw-100"}),(0,A.jsx)("a",{href:"#",className:"go-back",title:(0,m.APU)("Back"),onClick:this.goBack,role:"button","aria-label":(0,m.APU)("Back"),children:(0,A.jsx)("span",{className:"sf3-font sf3-font-down rotate-90 d-inline-block","aria-hidden":"true"})}),(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[(0,A.jsxs)("p",{className:"m-0 text-truncate d-flex",children:[(0,A.jsx)("span",{className:"mr-1",children:(0,m.APU)("Current path: ")}),r?this.renderFolderPath():(0,A.jsx)("span",{className:"text-truncate",title:M,children:M})]}),"/"===k&&C&&!r&&F&&(0,A.jsx)("button",{className:"btn btn-secondary clean flex-shrink-0 ml-4",onClick:this.cleanTrash,"aria-label":(0,m.APU)("Clean"),children:(0,m.APU)("Clean")})]}),(0,A.jsx)(w,{data:this.state,getMore:this.getMore,renderFolder:this.renderFolder})]})})})]}),t&&(0,A.jsx)(x.A,{children:(0,A.jsx)(b.A,{repoID:D,refreshTrash:this.refreshTrash,toggleDialog:this.toggleCleanTrashDialog})})]})}}])}(i.Component),w=function(e){function t(e){var r;return(0,n.default)(this,t),(r=(0,a.default)(this,t,[e])).theadData=[{width:"5%",text:""},{width:"20%",text:(0,m.APU)("Name")},{width:"40%",text:(0,m.APU)("Original path")},{width:"12%",text:(0,m.APU)("Deleted time")},{width:"13%",text:(0,m.APU)("Size")},{width:"10%",text:""}],r}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this,t=this.props.data,r=t.isLoading,n=t.errorMsg,s=t.items,a=t.more,o=t.showFolder,l=t.commitID,d=t.baseDir,c=t.folderPath,h=t.folderItems;return(0,A.jsxs)(i.Fragment,{children:[(0,A.jsxs)("table",{className:"table-hover",children:[(0,A.jsx)("thead",{children:(0,A.jsx)("tr",{children:this.theadData.map((function(e,t){return(0,A.jsx)("th",{width:e.width,children:e.text},t)}))})}),(0,A.jsx)("tbody",{children:o?h.map((function(t,r){return(0,A.jsx)(_,{item:t,commitID:l,baseDir:d,folderPath:c,renderFolder:e.props.renderFolder},r)})):s.map((function(t,r){return(0,A.jsx)(I,{item:t,renderFolder:e.props.renderFolder},r)}))})]}),r&&(0,A.jsx)(f.A,{}),n&&(0,A.jsx)("p",{className:"error mt-6 text-center",children:n}),a&&!r&&!o&&(0,A.jsx)("button",{className:"btn btn-block more mt-6",onClick:this.props.getMore,children:(0,m.APU)("More")})]})}}])}(i.Component),I=function(e){function t(e){var r;return(0,n.default)(this,t),(r=(0,a.default)(this,t,[e])).handleMouseOver=function(){r.setState({isIconShown:!0})},r.handleMouseOut=function(){r.setState({isIconShown:!1})},r.restoreItem=function(e){e.preventDefault();var t=r.props.item,n=t.commit_id,s=t.parent_dir+t.obj_name;(t.is_dir?p.e.restoreFolder(D,n,s):p.e.restoreFile(D,n,s)).then((function(e){r.setState({restored:!0}),g.A.success((0,m.APU)("Restored 1 item"))})).catch((function(e){var t="";t=e.response?e.response.data.error_msg||(0,m.APU)("Error"):(0,m.APU)("Please check the network."),g.A.danger(t)}))},r.renderFolder=function(e){e.preventDefault();var t=r.props.item;r.props.renderFolder(t.commit_id,t.parent_dir,u.Aq.joinPath("/",t.obj_name))},r.state={restored:!1,isIconShown:!1},r}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,r=t.restored,n=t.isIconShown;return r?null:e.is_dir?(0,A.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,A.jsx)("td",{className:"text-center",children:(0,A.jsx)("img",{src:u.Aq.getFolderIconUrl(),alt:(0,m.APU)("Folder"),width:"24"})}),(0,A.jsx)("td",{children:(0,A.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.obj_name})}),(0,A.jsx)("td",{children:e.parent_dir}),(0,A.jsx)("td",{title:(0,v.l)(e.deleted_time),children:h()(e.deleted_time).format("YYYY-MM-DD")}),(0,A.jsx)("td",{}),(0,A.jsx)("td",{children:(0,A.jsx)("a",{href:"#",className:n?"":"invisible",onClick:this.restoreItem,role:"button",children:(0,m.APU)("Restore")})})]}):(0,A.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,A.jsx)("td",{className:"text-center",children:(0,A.jsx)("img",{src:u.Aq.getFileIconUrl(e.obj_name),alt:(0,m.APU)("File"),width:"24"})}),(0,A.jsx)("td",{children:(0,A.jsx)("a",{href:"".concat(m.YcY,"repo/").concat(D,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(e.commit_id,"&base=").concat(encodeURIComponent(e.parent_dir),"&p=").concat(encodeURIComponent("/"+e.obj_name)),target:"_blank",rel:"noreferrer",children:e.obj_name})}),(0,A.jsx)("td",{children:e.parent_dir}),(0,A.jsx)("td",{title:(0,v.l)(e.deleted_time),children:h()(e.deleted_time).format("YYYY-MM-DD")}),(0,A.jsx)("td",{children:u.Aq.bytesToSize(e.size)}),(0,A.jsx)("td",{children:(0,A.jsx)("a",{href:"#",className:n?"":"invisible",onClick:this.restoreItem,role:"button",children:(0,m.APU)("Restore")})})]})}}])}(i.Component),_=function(e){function t(e){var r;return(0,n.default)(this,t),(r=(0,a.default)(this,t,[e])).handleMouseOver=function(){r.setState({isIconShown:!0})},r.handleMouseOut=function(){r.setState({isIconShown:!1})},r.renderFolder=function(e){e.preventDefault();var t=r.props.item,n=r.props,s=n.commitID,a=n.baseDir,o=n.folderPath;r.props.renderFolder(s,a,u.Aq.joinPath(o,t.name))},r.state={isIconShown:!1},r}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.props,r=t.commitID,n=t.baseDir,s=t.folderPath;return"dir"==e.type?(0,A.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,A.jsx)("td",{className:"text-center",children:(0,A.jsx)("img",{src:u.Aq.getFolderIconUrl(),alt:(0,m.APU)("Folder"),width:"24"})}),(0,A.jsx)("td",{children:(0,A.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.name})}),(0,A.jsx)("td",{children:e.parent_dir}),(0,A.jsx)("td",{}),(0,A.jsx)("td",{})]}):(0,A.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,A.jsx)("td",{className:"text-center",children:(0,A.jsx)("img",{src:u.Aq.getFileIconUrl(e.name),alt:(0,m.APU)("File"),width:"24"})}),(0,A.jsx)("td",{children:(0,A.jsx)("a",{href:"".concat(m.YcY,"repo/").concat(D,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(r,"&base=").concat(encodeURIComponent(n),"&p=").concat(encodeURIComponent(u.Aq.joinPath(s,e.name))),target:"_blank",rel:"noreferrer",children:e.name})}),(0,A.jsx)("td",{children:e.parent_dir}),(0,A.jsx)("td",{}),(0,A.jsx)("td",{children:u.Aq.bytesToSize(e.size)}),(0,A.jsx)("td",{})]})}}])}(i.Component);(0,l.createRoot)(document.getElementById("wrapper")).render((0,A.jsx)(U,{}))}},function(e){e.O(0,[4223],(function(){return t=12121,e(e.s=t);var t}));e.O()}]);