{"version":3,"sources":["components/history-list-view/history-list-item.js","components/history-list-view/history-list-view.js","pages/file-history/side-panel.js","pages/file-history/main-panel.js","file-history.js"],"names":["moment","locale","window","app","config","lang","HistoryListItem","props","onMouseEnter","isItemFreezed","setState","isShowOperationIcon","onMouseLeave","onToggleClick","e","isMenuShow","state","onFreezedItemToggle","onItemClick","item","commit_id","currentItem","currentIndex","index","onItemRestore","onItemDownload","this","time","ctime","format","isHigtlightItem","objID","rev_file_id","url","URLDecorator","getUrl","type","filePath","className","onClick","creator_name","Dropdown","isOpen","toggle","DropdownToggle","tag","alt","gettext","DropdownMenu","DropdownItem","href","onItemDownLoad","React","Component","HistoryListView","componentDidMount","historyList","length","onScrollHandler","event","clientHeight","target","scrollHeight","isBottom","scrollTop","hasMore","reloadMore","preItem","onScroll","map","isReloadingData","SidePanel","currentPage","editUtilities","listFileHistoryRecords","PER_PAGE","then","res","updateResultState","data","commitId","revertFile","success","isLoading","refershFileList","message","toaster","historyInfo","isError","fileOwner","Error","initResultState","result","page","total_count","creator_email","MainPanel","onSearchedClick","Prism","highlightAll","renderingContent","scriptSource","mediaUrl","newMarkdownContent","oldMarkdownContent","FileHistory","searchedItem","Utils","handleSearchedItemClick","setDiffContent","onHistoryItemClick","axios","all","seafileAPI","getFileRevision","historyRepoID","path","spread","res1","getFileContent","content1","content2","onBackClick","preventDefault","history","back","id","title","fileName","ReactDom","render","document","getElementById"],"mappings":"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","file":"static/js/fileHistory.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\n\nimport '../../css/history-record-item.css';\n\nmoment.locale(window.app.config.lang);\n\nconst propTypes = {\n  index: PropTypes.number.isRequired,\n  item: PropTypes.object.isRequired,\n  currentItem: PropTypes.object,\n  isItemFreezed: PropTypes.bool.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n  onFreezedItemToggle: PropTypes.func.isRequired,\n};\n\nclass HistoryListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: true});\n    }\n  }\n\n  onMouseLeave = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: false});\n    }\n  }\n\n  onToggleClick = (e) => {\n    this.setState({isMenuShow: !this.state.isMenuShow});\n    this.props.onFreezedItemToggle();\n  }\n\n  onItemClick = () => {\n    this.setState({isShowOperationIcon: false});  //restore to default state\n    if (this.props.item.commit_id === this.props.currentItem.commit_id) {\n      return;\n    }\n    let currentIndex = this.props.index;\n    this.props.onItemClick(this.props.item, currentIndex);\n  }\n\n  onItemRestore = () => {\n    this.props.onItemRestore(this.props.currentItem);\n  }\n\n  onItemDownload = () => {\n    // nothing todo\n  }\n\n  render() {\n    if (!this.props.currentItem) {\n      return '';\n    }\n    let item = this.props.item;\n    let time = moment(item.ctime).format('YYYY-MM-DD HH:mm');\n    let isHigtlightItem = false;\n    if (this.props.item && this.props.currentItem) {\n      isHigtlightItem = this.props.item.commit_id === this.props.currentItem.commit_id;\n    }\n    let objID = this.props.currentItem.rev_file_id;\n    let url = URLDecorator.getUrl({type: 'download_historic_file', filePath: filePath, objID: objID});\n    return (\n      <li\n        className={`history-list-item ${isHigtlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onItemClick}\n      >\n        <div className=\"history-info\">\n          <div className=\"time\">{time}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{item.creator_name}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHigtlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryListItem.propTypes = propTypes;\n\nexport default HistoryListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport HisotyListItem from './history-list-item';\nimport Loading from '../loading';\n\nconst propTypes = {\n  hasMore: PropTypes.bool.isRequired,\n  isReloadingData: PropTypes.bool.isRequired,\n  historyList: PropTypes.array.isRequired,\n  reloadMore: PropTypes.func.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n};\n\nclass HistoryListView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isItemFreezed: false,\n      currentItem: null,\n    };\n  }\n\n  componentDidMount = () => {\n    let historyList = this.props.historyList;\n    if (historyList.length > 0) {\n      this.setState({currentItem: historyList[0]});\n      if (historyList === 1) {\n        this.props.onItemClick(historyList[0]);\n      } else {\n        this.props.onItemClick(historyList[0], historyList[1]);\n      }\n    }\n  }\n\n  onFreezedItemToggle = () => {\n    this.setState({isItemFreezed: !this.state.isItemFreezed});\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop    = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    let hasMore = this.props.hasMore;\n    if (isBottom && hasMore) {\n      this.props.reloadMore();\n    }\n  }\n\n  onItemClick = (item, currentIndex) => {\n    this.setState({currentItem: item});\n    if (currentIndex !== this.props.historyList.length) {\n      let preItem = this.props.historyList[currentIndex + 1];\n      this.props.onItemClick(item, preItem);\n    } else {\n      this.props.onItemClick(item);\n    }\n  }\n\n  render() {\n    return (\n      <ul className=\"history-list-container\" onScroll={this.onScrollHandler}>\n        {this.props.historyList.map((item, index) => {\n          return (\n            <HisotyListItem\n              key={index}\n              item={item}\n              index={index}\n              currentItem={this.state.currentItem}\n              isItemFreezed={this.state.isItemFreezed}\n              onItemClick={this.onItemClick}\n              onItemRestore={this.props.onItemRestore}\n              onFreezedItemToggle={this.onFreezedItemToggle}\n            />\n          );\n        })}\n        {this.props.isReloadingData && <li><Loading /></li>}\n      </ul>\n    );\n  }\n}\n\nHistoryListView.propTypes = propTypes;\n\nexport default HistoryListView;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, PER_PAGE, filePath } from '../../utils/constants';\nimport editUtilities from '../../utils/editor-utilities';\nimport Loading from '../../components/loading';\nimport HistoryListView from '../../components/history-list-view/history-list-view';\nimport toaster from '../../components/toast';\n\nconst propTypes = {\n  onItemClick: PropTypes.func.isRequired,\n};\n\nclass SidePanel extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      historyInfo: '',\n      currentPage: 1,\n      hasMore: false,\n      isLoading: true,\n      isError: false,\n      fileOwner: '',\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      let historyList = res.data;\n      if (historyList.length === 0) {\n        this.setState({isLoading: false});\n        throw Error('there has an error in server');\n      }\n      this.initResultState(res.data);\n    });\n  }\n\n  refershFileList() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      this.initResultState(res.data);\n    });\n  }\n\n  initResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: result.data,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email,\n      });\n    }\n  }\n\n  updateResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: [...this.state.historyInfo, ...result.data],\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email\n      });\n    }\n  }\n\n  reloadMore = () => {\n    if (!this.state.isReloadingData) {\n      let currentPage = this.state.currentPage + 1;\n      this.setState({\n        currentPage: currentPage,\n        isReloadingData: true,\n      });\n      editUtilities.listFileHistoryRecords(filePath, currentPage, PER_PAGE).then(res => {\n        this.updateResultState(res.data);\n        this.setState({isReloadingData: false});\n      });\n    }\n  }\n\n  onItemRestore = (currentItem) => {\n    let commitId = currentItem.commit_id;\n    editUtilities.revertFile(filePath, commitId).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n      let message = gettext('Successfully restored.');\n      toaster.success(message);\n    });\n  }\n\n  onItemClick =(item, preItem) => {\n    this.props.onItemClick(item, preItem);\n  }\n\n  render() {\n    return (\n      <div className=\"side-panel history-side-panel\">\n        <div className=\"side-panel-center\">\n          <div className=\"history-side-panel-title\">{gettext('History Versions')}</div>\n          <div className=\"history-body\">\n            {this.state.isLoading && <Loading />}\n            {this.state.historyInfo &&\n              <HistoryListView\n                hasMore={this.state.hasMore}\n                isReloadingData={this.state.isReloadingData}\n                historyList={this.state.historyInfo}\n                reloadMore={this.reloadMore}\n                onItemClick={this.onItemClick}\n                onItemRestore={this.onItemRestore}\n              />\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = propTypes;\n\nexport default SidePanel;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Prism from 'prismjs';\nimport { DiffViewer } from '@seafile/seafile-editor';\nimport Loading from '../../components/loading';\nimport { mediaUrl } from '../../utils/constants';\n\nconst contentClass = 'markdown-viewer-render-content';\nconst propTypes = {\n  renderingContent: PropTypes.bool.isRequired,\n  content: PropTypes.string,\n  newMarkdownContent: PropTypes.string.isRequired,\n  oldMarkdownContent: PropTypes.string.isRequired,\n};\n\nclass MainPanel extends React.Component {\n\n  componentDidMount() {\n    Prism.highlightAll();\n  }\n\n  onSearchedClick = () => {\n    //todos;\n  }\n\n  render() {\n    return (\n      <div className=\"main-panel\">\n        <div className=\"main-panel-center content-viewer\">\n          <div className={contentClass}>\n            {\n              this.props.renderingContent ?\n                (<Loading />) :\n                (<div className=\"diff-view article\">\n                  <DiffViewer\n                    scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n                    newMarkdownContent={this.props.newMarkdownContent}\n                    oldMarkdownContent={this.props.oldMarkdownContent}\n                  />\n                </div>)\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nMainPanel.propTypes = propTypes;\n\nexport default MainPanel;\n","import React, { Fragment } from 'react';\nimport ReactDom from 'react-dom';\nimport axios from 'axios';\nimport { fileName, historyRepoID } from './utils/constants';\nimport { Utils } from './utils/utils';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport SidePanel from './pages/file-history/side-panel';\nimport MainPanel from './pages/file-history/main-panel';\nimport { seafileAPI } from './utils/seafile-api';\n\nimport './css/layout.css';\nimport './css/file-history.css';\nimport './css/toolbar.css';\nimport './css/search.css';\n\nclass FileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      renderingContent: true,\n      newMarkdownContent: '',\n      oldMarkdownContent: ''\n    };\n  }\n\n  onSearchedClick = (searchedItem) => {\n    Utils.handleSearchedItemClick(searchedItem);\n  }\n\n  setDiffContent = (newMarkdownContent, oldMarkdownContent)=> {\n    this.setState({\n      renderingContent: false,\n      newMarkdownContent: newMarkdownContent,\n      oldMarkdownContent: oldMarkdownContent,\n    });\n  }\n\n\n  onHistoryItemClick = (item, preItem)=> {\n    this.setState({renderingContent: true});\n    if (preItem) {\n      axios.all([\n        seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path),\n        seafileAPI.getFileRevision(historyRepoID, preItem.commit_id, preItem.path)\n      ]).then(axios.spread((res, res1) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n          seafileAPI.getFileContent(res1.data)\n        ]).then(axios.spread((content1, content2) => {\n          this.setDiffContent(content1.data, content2.data);\n        }));\n      }));\n    } else {\n      seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path).then((res) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n        ]).then(axios.spread((content1) => {\n          this.setDiffContent(content1.data, '');\n        }));\n      });\n    }\n  }\n\n  onBackClick = (event) => {\n    event.preventDefault();\n    window.history.back();\n  }\n\n  render() {\n    return(\n      <Fragment>\n        <div id=\"header\" className=\"history-header\">\n          <div className=\"title\">\n            <a href=\"#\" className=\"go-back\" title=\"Back\" onClick={this.onBackClick}>\n              <span className=\"fas fa-chevron-left\"></span>\n            </a>\n            <span className=\"name\">{fileName}</span>\n          </div>\n          <div className='toolbar'>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n        </div>\n        <div id=\"main\" className=\"history-content\">\n          <MainPanel\n            newMarkdownContent={this.state.newMarkdownContent}\n            oldMarkdownContent={this.state.oldMarkdownContent}\n            renderingContent={this.state.renderingContent}\n          />\n          <SidePanel onItemClick={this.onHistoryItemClick}/>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nReactDom.render(<FileHistory />, document.getElementById('wrapper'));\n"],"sourceRoot":""}