(this["webpackJsonpseahub-frontend"]=this["webpackJsonpseahub-frontend"]||[]).push([[5],{1151:function(e,t,a){e.exports=a(1287)},1152:function(e,t,a){"use strict";var n=a(440),i=a(441),o=a(1153),r=a(444),s=a(445),c=a(446);e.exports=function e(){var t=[],a=r(),w={},b=!1,E=-1;return C.data=function(e,t){if(s(e))return 2===arguments.length?(p("data",b),w[e]=t,C):m.call(w,e)&&w[e]||null;if(e)return p("data",b),w=e,C;return w},C.freeze=N,C.attachers=t,C.use=function(e){var a;if(p("use",b),null===e||void 0===e);else if("function"===typeof e)s.apply(null,arguments);else{if("object"!==typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?r(e):i(e)}a&&(w.settings=n(w.settings||{},a));return C;function i(e){r(e.plugins),e.settings&&(a=n(a||{},e.settings))}function o(e){if("function"===typeof e)s(e);else{if("object"!==typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?s.apply(null,e):i(e)}}function r(e){var t,a;if(null===e||void 0===e);else{if("object"!==typeof e||!("length"in e))throw new Error("Expected a list of plugins, not `"+e+"`");for(t=e.length,a=-1;++a<t;)o(e[a])}}function s(e,a){var i=y(e);i?(c(i[1])&&c(a)&&(a=n(i[1],a)),i[1]=a):t.push(l.call(arguments))}},C.parse=function(e){var t,a=o(e);if(N(),u("parse",t=C.Parser),f(t))return new t(String(a),a).parse();return t(String(a),a)},C.stringify=function(e,t){var a,n=o(t);if(N(),h("stringify",a=C.Compiler),v(e),f(a))return new a(e,n).compile();return a(e,n)},C.run=O,C.runSync=function(e,t){var a,n=!1;return O(e,t,o),g("runSync","run",n),a;function o(e,t){n=!0,i(e),a=t}},C.process=D,C.processSync=function(e){var t,a=!1;return N(),u("processSync",C.Parser),h("processSync",C.Compiler),D(t=o(e),n),g("processSync","process",a),t;function n(e){a=!0,i(e)}},C;function C(){for(var a=e(),i=t.length,o=-1;++o<i;)a.use.apply(null,t[o]);return a.data(n(!0,{},w)),a}function N(){var e,n,i,o;if(b)return C;for(;++E<t.length;)n=(e=t[E])[0],null,!1!==(i=e[1])&&(!0===i&&(e[1]=void 0),"function"===typeof(o=n.apply(C,e.slice(1)))&&a.use(o));return b=!0,E=1/0,C}function y(e){for(var a,n=t.length,i=-1;++i<n;)if((a=t[i])[0]===e)return a}function O(e,t,n){if(v(e),N(),n||"function"!==typeof t||(n=t,t=null),!n)return new Promise(i);function i(i,r){a.run(e,o(t),(function(t,a,o){a=a||e,t?r(t):i?i(a):n(null,a,o)}))}i(null,n)}function D(e,t){if(N(),u("process",C.Parser),h("process",C.Compiler),!t)return new Promise(a);function a(a,n){var i=o(e);d.run(C,{file:i},(function(e){e?n(e):a?a(i):t(null,i)}))}a(null,t)}}().freeze();var l=[].slice,m={}.hasOwnProperty,d=r().use((function(e,t){t.tree=e.parse(t.file)})).use((function(e,t,a){e.run(t.tree,t.file,(function(e,n,i){e?a(e):(t.tree=n,t.file=i,a())}))})).use((function(e,t){t.file.contents=e.stringify(t.tree,t.file)}));function f(e){return"function"===typeof e&&function(e){var t;for(t in e)return!0;return!1}(e.prototype)}function u(e,t){if("function"!==typeof t)throw new Error("Cannot `"+e+"` without `Parser`")}function h(e,t){if("function"!==typeof t)throw new Error("Cannot `"+e+"` without `Compiler`")}function p(e,t){if(t)throw new Error(["Cannot invoke `"+e+"` on a frozen processor.\nCreate a new ","processor first, by invoking it: use `processor()` instead of ","`processor`."].join(""))}function v(e){if(!e||!s(e.type))throw new Error("Expected node, got `"+e+"`")}function g(e,t,a){if(!a)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}},1153:function(e,t,a){"use strict";var n=a(442),i=a(1154);e.exports=i;var o=i.prototype;function r(e,t,a){var i=this.path,o=new n(e,t,a);return i&&(o.name=i+":"+o.name,o.file=i),o.fatal=!1,this.messages.push(o),o}o.message=r,o.info=function(){var e=this.message.apply(this,arguments);return e.fatal=null,e},o.fail=function(){var e=this.message.apply(this,arguments);throw e.fatal=!0,e},o.warn=r},1154:function(e,t,a){"use strict";(function(t){var n=a(303),i=a(443),o=a(1155);e.exports=l;var r={}.hasOwnProperty,s=l.prototype;s.toString=function(e){var t=this.contents||"";return o(t)?t.toString(e):String(t)};var c=["history","path","basename","stem","extname","dirname"];function l(e){var a,n,i;if(e){if("string"===typeof e||o(e))e={contents:e};else if("message"in e&&"messages"in e)return e}else e={};if(!(this instanceof l))return new l(e);for(this.data={},this.messages=[],this.history=[],this.cwd=t.cwd(),n=-1,i=c.length;++n<i;)a=c[n],r.call(e,a)&&(this[a]=e[a]);for(a in e)-1===c.indexOf(a)&&(this[a]=e[a])}function m(e,t){if(-1!==e.indexOf(n.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+n.sep+"`")}function d(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function f(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}Object.defineProperty(s,"path",{get:function(){return this.history[this.history.length-1]},set:function(e){d(e,"path"),e!==this.path&&this.history.push(e)}}),Object.defineProperty(s,"dirname",{get:function(){return"string"===typeof this.path?n.dirname(this.path):void 0},set:function(e){f(this.path,"dirname"),this.path=n.join(e||"",this.basename)}}),Object.defineProperty(s,"basename",{get:function(){return"string"===typeof this.path?n.basename(this.path):void 0},set:function(e){d(e,"basename"),m(e,"basename"),this.path=n.join(this.dirname||"",e)}}),Object.defineProperty(s,"extname",{get:function(){return"string"===typeof this.path?n.extname(this.path):void 0},set:function(e){var t=e||"";if(m(t,"extname"),f(this.path,"extname"),t){if("."!==t.charAt(0))throw new Error("`extname` must start with `.`");if(-1!==t.indexOf(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=i(this.path,t)}}),Object.defineProperty(s,"stem",{get:function(){return"string"===typeof this.path?n.basename(this.path,this.extname):void 0},set:function(e){d(e,"stem"),m(e,"stem"),this.path=n.join(this.dirname||"",e+(this.extname||""))}})}).call(this,a(80))},1155:function(e,t){e.exports=function(e){return null!=e&&null!=e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},1156:function(e,t,a){},1157:function(e,t,a){},1158:function(e,t,a){},1159:function(e,t,a){},1287:function(e,t,a){"use strict";a.r(t);var n=a(5),i=a(6),o=a(26),r=a(8),s=a(7),c=a(0),l=a.n(c),m=a(23),d=a.n(m),f=a(3),u=(a(111),a(1)),h=a(9),p=a(47),v=a.n(p),g=a(200),w=a(284),b=a(15),E=a(1152),C=a(308),N=a(474),y=a(475),O=a(476),D=a(482),j=a(486),S=a(74),x=a(498),k=a(506),R=a(324),I=a(507).default;var _=E().use(C,{commonmark:!0}).use(y).use(N).use(O,{allowDangerousHTML:!0}).use(j).use(D).use((function(e){var t=S(e,this.data("settings")),a=I(R,{attributes:{input:["type"],li:["className"],code:["className"]},tagNames:["input","code"]});this.Compiler=function(e){var n=k(e,a);return x(n,t)}})),T=(E().use(C,{commonmark:!0}).use(N),a(4)),M=a(10),L=(a(1156),function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).handleCommentChange=function(e){i.setState({comment:e.target.value})},i.submitComment=function(){var e=i.state.comment.trim();e.length>0&&(h.a.postComment(u.N,u.J,e).then((function(){i.props.listComments()})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)})),i.setState({comment:""}))},i.resolveComment=function(e){h.a.updateComment(u.N,e.target.id,"true").then((function(e){i.props.listComments()})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}))},i.editComment=function(e,t){h.a.updateComment(u.N,e,null,null,t).then((function(e){i.props.listComments()})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}))},i.toggleResolvedComment=function(){i.setState({showResolvedComment:!i.state.showResolvedComment})},i.deleteComment=function(e){h.a.deleteComment(u.N,e.target.id).then((function(e){i.props.listComments()})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}))},i.onResizeMouseUp=function(){i.state.inResizing&&i.setState({inResizing:!1})},i.onResizeMouseDown=function(){i.setState({inResizing:!0})},i.onResizeMouseMove=function(e){var t=100-(e.nativeEvent.clientY-120)/i.refs.comment.clientHeight*100;if(t<20||t>70)return t<20&&i.setState({commentFooterHeight:25}),t>70&&i.setState({commentFooterHeight:65}),i.setState({inResizing:!1}),null;i.setState({commentFooterHeight:t})},i.scrollToQuote=function(e,t,a){i.props.scrollToQuote(e,t,a),i.setState({comment:""})},i.state={inResizing:!1,commentFooterHeight:25,showResolvedComment:!0,comment:""},i}return Object(i.a)(a,[{key:"componentWillReceiveProps",value:function(e){if(this.props.commentsList.length<e.commentsList.length){var t=this;setTimeout((function(){t.refs.commentsList.scrollTo(0,1e4)}),100)}}},{key:"render",value:function(){var e=this,t=this.state.inResizing?this.onResizeMouseMove:null,a=this.props.commentsList;return l.a.createElement("div",{className:this.state.inResizing||this.props.inResizing?"seafile-comment seafile-comment-resizing":"seafile-comment",onMouseMove:t,onMouseUp:this.onResizeMouseUp,ref:"comment"},l.a.createElement("div",{className:"seafile-comment-title"},l.a.createElement("div",{className:"seafile-comment-title-text"},Object(u.mb)("Show resolved comments")),l.a.createElement("div",{className:"seafile-comment-title-toggle"},l.a.createElement("label",{className:"custom-switch",id:"toggle-resolved-comments"},l.a.createElement("input",{type:"checkbox",name:"option",className:"custom-switch-input",onChange:this.toggleResolvedComment,checked:this.state.showResolvedComment&&"checked"}),l.a.createElement("span",{className:"custom-switch-indicator"})))),l.a.createElement("div",{style:{height:100-this.state.commentFooterHeight+"%"}},0===a.length&&l.a.createElement("div",{className:"seafile-comment-list"},l.a.createElement("div",{className:"comment-vacant"},Object(u.mb)("No comment yet."))),l.a.createElement("ul",{className:"seafile-comment-list",ref:"commentsList"},a.length>0&&a.map((function(t,a){return l.a.createElement(P,{item:t,key:a,showResolvedComment:e.state.showResolvedComment,resolveComment:e.resolveComment,editComment:e.editComment,scrollToQuote:e.scrollToQuote,deleteComment:e.deleteComment})})))),l.a.createElement("div",{className:"seafile-comment-footer",style:{height:this.state.commentFooterHeight+"%"}},l.a.createElement("div",{className:"seafile-comment-row-resize",onMouseDown:this.onResizeMouseDown}),l.a.createElement("div",{className:"seafile-add-comment"},l.a.createElement("textarea",{className:"add-comment-input",value:this.state.comment,placeholder:Object(u.mb)("Add a comment."),onChange:this.handleCommentChange,clos:"100",rows:"3",warp:"virtual"}),l.a.createElement(f.c,{className:"comment-btn",color:"primary",size:"sm",onClick:this.submitComment},Object(u.mb)("Submit")))))}}]),a}(l.a.Component)),P=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).toggleDropDownMenu=function(){i.setState({dropdownOpen:!i.state.dropdownOpen})},i.convertComment=function(e){_.process(e.comment).then((function(e){var t=String(e);i.setState({comment:t})})),_.process(e.quote).then((function(e){var t=String(e);i.setState({quote:t})}))},i.scrollToQuote=function(){var e=i.props.item;i.props.scrollToQuote(e.newIndex,e.oldIndex,e.quote)},i.toggleEditComment=function(){i.setState({editable:!i.state.editable})},i.updateComment=function(e){var t=i.state.newComment;i.props.item.comment!==t&&i.props.editComment(e.target.id,t),i.toggleEditComment()},i.handleCommentChange=function(e){i.setState({newComment:e.target.value})},i.state={dropdownOpen:!1,comment:"",quote:"",newComment:i.props.item.comment,editable:!1},i}return Object(i.a)(a,[{key:"componentWillMount",value:function(){this.convertComment(this.props.item)}},{key:"componentWillReceiveProps",value:function(e){this.convertComment(e.item)}},{key:"render",value:function(){var e=this.props.item;return e.resolved&&!this.props.showResolvedComment?null:this.state.editable?l.a.createElement("li",{className:"seafile-comment-item",id:e.id},l.a.createElement("div",{className:"seafile-comment-info"},l.a.createElement("img",{className:"avatar",src:e.avatarUrl,alt:""}),l.a.createElement("div",{className:"reviewer-info"},l.a.createElement("div",{className:"reviewer-name ellipsis"},e.name),l.a.createElement("div",{className:"review-time"},e.time))),l.a.createElement("div",{className:"seafile-edit-comment"},l.a.createElement("textarea",{className:"edit-comment-input",value:this.state.newComment,onChange:this.handleCommentChange,clos:"100",rows:"3",warp:"virtual"}),l.a.createElement(f.c,{className:"comment-btn",color:"primary",size:"sm",onClick:this.updateComment,id:e.id},Object(u.mb)("Update"))," ",l.a.createElement(f.c,{className:"comment-btn",color:"secondary",size:"sm",onClick:this.toggleEditComment},Object(u.mb)("Cancel")))):l.a.createElement("li",{className:e.resolved?"seafile-comment-item seafile-comment-item-resolved":"seafile-comment-item",id:e.id},l.a.createElement("div",{className:"seafile-comment-info"},l.a.createElement("img",{className:"avatar",src:e.avatarUrl,alt:""}),l.a.createElement("div",{className:"reviewer-info"},l.a.createElement("div",{className:"reviewer-name ellipsis"},e.name),l.a.createElement("div",{className:"review-time"},e.time)),!e.resolved&&l.a.createElement(f.l,{isOpen:this.state.dropdownOpen,size:"sm",className:"seafile-comment-dropdown",toggle:this.toggleDropDownMenu},l.a.createElement(f.o,{className:"seafile-comment-dropdown-btn"},l.a.createElement("i",{className:"fas fa-ellipsis-v"})),l.a.createElement(f.n,null,e.userEmail===u.tc&&l.a.createElement(f.m,{onClick:this.props.deleteComment,className:"delete-comment",id:e.id},Object(u.mb)("Delete")),e.userEmail===u.tc&&l.a.createElement(f.m,{onClick:this.toggleEditComment,className:"edit-comment",id:e.id},Object(u.mb)("Edit")),l.a.createElement(f.m,{onClick:this.props.resolveComment,className:"seafile-comment-resolved",id:e.id},Object(u.mb)("Mark as resolved"))))),e.newIndex>=-1&&e.oldIndex>=-1&&l.a.createElement("blockquote",{className:"seafile-comment-content"},l.a.createElement("div",{onClick:this.scrollToQuote,dangerouslySetInnerHTML:{__html:this.state.quote}})),l.a.createElement("div",{className:"seafile-comment-content",dangerouslySetInnerHTML:{__html:this.state.comment}}))}}]),a}(l.a.Component),F=L,q=(a(1157),function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).handleCommentChange=function(e){var t=e.target.value;i.setState({comment:t})},i.submitComment=function(){var e=i.props,t=e.quote,a=e.newIndex,n=e.oldIndex,o=i.state.comment.trim();if(0!==o.length){if(t.length>0){var r={quote:t,newIndex:a,oldIndex:n};h.a.postComment(u.N,u.J,o,JSON.stringify(r)).then((function(){i.props.onCommentAdded()})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}))}else h.a.postComment(u.N,u.J,o).then((function(){i.props.onCommentAdded()})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}));i.setState({comment:""})}},i.setQuoteText=function(e){_.process(e).then((function(e){var t=String(e);i.setState({quote:t})}))},i.state={comment:"",quote:""},i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.setQuoteText(this.props.quote)}},{key:"componentWillReceiveProps",value:function(e){this.props.quote!==e.quote&&this.setQuoteText(e.quote)}},{key:"render",value:function(){return l.a.createElement("div",{className:"review-comment-dialog"},l.a.createElement("div",null,u.Mb),l.a.createElement("blockquote",{className:"review-comment-dialog-quote"},l.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.quote}})),l.a.createElement("textarea",{value:this.state.comment,onChange:this.handleCommentChange}),l.a.createElement("div",{className:"button-group"},l.a.createElement(f.c,{size:"sm",color:"primary",onClick:this.submitComment},Object(u.mb)("Submit")),l.a.createElement(f.c,{size:"sm",color:"secondary",onClick:this.props.toggleCommentDialog},Object(u.mb)("Cancel"))),l.a.createElement("span",{className:"review-comment-dialog-triangle"}))}}]),a}(l.a.Component)),z=a(43),H=(a(1158),function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).listReviewers=function(){h.a.listDraftReviewers(i.props.draftID).then((function(e){i.setState({reviewers:e.data.reviewers})}))},i.handleSelectChange=function(e){i.setState({selectedOption:e}),i.Options=[]},i.addReviewers=function(){if(i.state.selectedOption.length>0){i.refs.reviewSelect.clearSelect();for(var e=[],t=0;t<i.state.selectedOption.length;t++)e[t]=i.state.selectedOption[t].email;i.setState({loading:!0,errorMsg:[]}),h.a.addDraftReviewers(i.props.draftID,e).then((function(e){if(e.data.failed.length>0){for(var t=[],a=0;a<e.data.failed.length;a++)t[a]=e.data.failed[a];i.setState({errorMsg:t})}i.setState({selectedOption:null,loading:!1}),e.data.success.length>0&&i.listReviewers()})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}))}},i.deleteReviewer=function(e){var t=e.target.getAttribute("name");h.a.deleteDraftReviewer(i.props.draftID,t).then((function(e){if(200===e.data){for(var a=[],n=0;n<i.state.reviewers.length;n++)i.state.reviewers[n].user_email!==t&&a.push(i.state.reviewers[n]);i.setState({reviewers:a})}})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}))},i.state={reviewers:i.props.reviewers,selectedOption:null,errorMsg:[],loading:!1},i.Options=[],i}return Object(i.a)(a,[{key:"render",value:function(){var e=this,t=this.props.toggleAddReviewerDialog,a=this.state,n=a.reviewers,i=a.errorMsg;return l.a.createElement(f.x,{isOpen:!0,toggle:t},l.a.createElement(f.A,{toggle:t},Object(u.mb)("Request a review")),l.a.createElement(f.y,null,l.a.createElement("p",null,Object(u.mb)("Add new reviewer")),l.a.createElement("div",{className:"add-reviewer"},l.a.createElement(z.a,{placeholder:Object(u.mb)("Search users..."),onSelectChange:this.handleSelectChange,ref:"reviewSelect",isMulti:!0,className:"reviewer-select"}),this.state.selectedOption&&!this.state.loading?l.a.createElement(f.c,{color:"secondary",onClick:this.addReviewers},Object(u.mb)("Submit")):l.a.createElement(f.c,{color:"secondary",disabled:!0},Object(u.mb)("Submit"))),i.length>0&&i.map((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l.a.createElement("p",{className:"reviewer-select-error error",key:t},i[t].email,": ",i[t].error_msg)})),n.length>0&&n.map((function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l.a.createElement("div",{className:"reviewer-select-info",key:a},l.a.createElement("div",{className:"d-flex"},l.a.createElement("img",{className:"avatar reviewer-select-avatar",src:t.avatar_url,alt:""}),l.a.createElement("span",{className:"reviewer-select-name ellipsis"},t.user_name)),l.a.createElement("i",{className:"fa fa-times",name:t.user_email,onClick:e.deleteReviewer}))}))),l.a.createElement(f.z,null,l.a.createElement(f.c,{color:"secondary",onClick:t},Object(u.mb)("Close"))))}}]),a}(l.a.Component)),A=a(48),J=a(13),Q=a.n(J),U=a(54),B=a(12),Y=a.n(B);a(402);Y.a.locale(window.app.config.lang);var V=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onClick=function(e,t,a,n){if(t===i.state.activeItem)return!1;i.props.onHistoryItemClick(n,a,t)},i.onScroll=function(e){var t=e.target.clientHeight,a=e.target.scrollHeight;if(t+e.target.scrollTop+1>=a&&i.props.totalReversionCount>i.perPage*i.state.currentPage){var n=i.state.currentPage+1;i.setState({currentPage:n,loading:!0}),h.a.listFileHistoryRecords(u.N,u.J,n,i.perPage).then((function(e){var t=Object.assign([],i.props.historyList);i.props.onHistoryListChange([].concat(Object(U.a)(t),Object(U.a)(e.data.data))),i.setState({loading:!1})})).catch((function(e){var t=T.a.getErrorMsg(e);M.a.danger(t)}))}},i.perPage=25,i.state={currentPage:1,loading:!1},i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"history-body"},l.a.createElement("ul",{onScroll:this.onScroll,className:"history-list-container"},this.props.historyList?this.props.historyList.map((function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=a+1;return i===n.length&&(i=a),l.a.createElement(W,{onClick:e.onClick,ctime:t.ctime,className:e.props.activeItem===a?"item-active":"",name:t.creator_name,index:a,key:a,preItem:n[i],currentItem:t})})):l.a.createElement(b.a,null),this.state.loading&&l.a.createElement("li",{className:"reloading-reversion"},l.a.createElement(b.a,null))))}}]),a}(l.a.Component),W=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){var e=this,t=Y.a.parseZone(this.props.ctime).format("YYYY-MM-DD HH:mm");return l.a.createElement("li",{onClick:function(t){return e.props.onClick(t,e.props.index,e.props.preItem,e.props.currentItem)},className:"history-list-item "+this.props.className},l.a.createElement("div",{className:"history-info"},l.a.createElement("div",{className:"time"},t),l.a.createElement("div",{className:"owner"},l.a.createElement("i",{className:"squire-icon"}),l.a.createElement("span",null,this.props.name))))}}]),a}(l.a.Component),K=V,Z=a(11),G=a(18),X=function e(t){Object(n.a)(this,e);var a=new Date(t.created_at).getTime();if(this.time=Y()(a).format("YYYY-MM-DD HH:mm"),this.id=t.id,this.avatarUrl=t.avatar_url,this.comment=t.comment,this.name=t.user_name,this.userEmail=t.user_email,this.resolved=t.resolved,t.detail){var i=JSON.parse(t.detail);this.newIndex=i.newIndex,this.oldIndex=i.oldIndex,this.quote=i.quote}};a(136),a(93),a(235),a(1159);a(208);var $=a(398),ee=a(12),te=A.b.toSlateRange,ae=A.b.toDOMNode,ne=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).initialContent=function(){switch(u.O){case"open":if(!u.H)return void i.setState({isLoading:!1,isShowDiff:!1});if(!u.Qb)return void h.a.getFileDownloadLink(u.N,u.J).then((function(e){h.a.getFileContent(e.data).then((function(e){i.setState({draftContent:e.data,draftOriginContent:e.data,isLoading:!1,isShowDiff:!1})}))}));var e=window.location.hash;if(0===e.indexOf("#history-")){var t,a,n=e.slice(9,49),r=e.slice(50,90);i.setState({isLoading:!1,activeTab:"history"}),h.a.listFileHistoryRecords(u.N,u.J,1,25).then((function(e){var o=e.data.data;i.setState({historyList:o,totalReversionCount:e.data.total_count});for(var s=0,c=o.length;s<c&&(r===o[s].commit_id&&(i.setState({activeItem:s}),t=o[s].path),n===o[s].commit_id&&(a=o[s].path),!t||!a);s++);v.a.all([h.a.getFileRevision(u.N,n,a),h.a.getFileRevision(u.N,r,t)]).then(v.a.spread((function(e,t){v.a.all([h.a.getFileContent(e.data),h.a.getFileContent(t.data)]).then(v.a.spread((function(e,t){i.setDiffViewerContent(t.data,e.data)})))})))}))}else v.a.all([h.a.getFileDownloadLink(u.N,u.J),h.a.getFileDownloadLink(u.N,u.L)]).then(v.a.spread((function(e,t){v.a.all([h.a.getFileContent(e.data),h.a.getFileContent(t.data)]).then(v.a.spread((function(e,t){i.setState({draftContent:e.data,draftOriginContent:t.data,isLoading:!1});var a=Object(o.a)(i);setTimeout((function(){a.getChangedNodes()}),100)})))})));break;case"published":if(!u.Qb)return void i.setState({isLoading:!1,isShowDiff:!1});var s=u.ic+"repo/"+u.N+"/"+u.M+"/download?p="+u.L,c=u.ic+"repo/"+u.N+"/"+u.Rb+"/download?p="+u.L;v.a.all([h.a.getFileContent(s),h.a.getFileContent(c)]).then(v.a.spread((function(e,t){i.setState({draftContent:e.data,draftOriginContent:t.data,isLoading:!1})})))}},i.onHistoryItemClick=function(e,t,a){var n=t.commit_id,o=e.commit_id,r="history-"+n+"-"+o;i.setURL(r),i.setState({activeItem:a,isLoading:!0}),v.a.all([h.a.getFileRevision(u.N,o,e.path),h.a.getFileRevision(u.N,n,t.path)]).then(v.a.spread((function(e,t){v.a.all([h.a.getFileContent(e.data),h.a.getFileContent(t.data)]).then(v.a.spread((function(e,t){i.setDiffViewerContent(e.data,t.data)})))})))},i.onHistoryListChange=function(e){i.setState({historyList:e})},i.listComments=function(){h.a.listComments(u.N,u.J).then((function(e){var t=[];e.data.comments.forEach((function(e){t.push(new X(e))})),i.setState({commentsList:t})}))},i.addComment=function(e){e.stopPropagation(),i.getQuote(),i.quote&&i.setState({isShowCommentDialog:!0})},i.onCommentAdded=function(){i.listComments(),i.toggleCommentDialog()},i.toggleCommentDialog=function(){i.setState({isShowCommentDialog:!i.state.isShowCommentDialog})},i.getOriginRepoInfo=function(){h.a.getRepoInfo(u.N).then((function(e){i.setState({originRepoName:e.data.repo_name})}))},i.getDraftInfo=function(){"open"===u.O&&h.a.getFileInfo(u.N,u.J).then((function(e){i.setState({draftInfo:e.data})}))},i.getChangedNodes=function(){var e=i.refs.diffViewer.value,t=[],a="";e.map((function(e,n){var i=e.data.diff_state;("diff-added"===i&&"diff-added"!==a||"diff-removed"===i&&"diff-removed"!==a||"diff-replaced"===i&&"diff-replaced"!==a)&&t.push(n),a=e.data.diff_state})),i.setState({changedNodes:t})},i.scrollToChangedNode=function(e){if(0!=i.state.changedNodes.length){"up"===e?i.changeIndex++:i.changeIndex--,i.changeIndex>i.state.changedNodes.length-1&&(i.changeIndex=0),i.changeIndex<0&&(i.changeIndex=i.state.changedNodes.length-1);for(var t=window,a=i.state.changedNodes[i.changeIndex],n=window.viewer.children[a],o=ae(window.viewer,n);-1===o.className.indexOf("diff-")&&"BODY"!==o.tagName;)o=o.parentNode;var r=i.findScrollContainer(o,t);r==t.document.body||r==t.document.documentElement?t.scrollTo(0,o.offsetTop):r.scrollTop=o.offsetTop}},i.findScrollContainer=function(e,t){for(var a,n=e.parentNode,i=["auto","overlay","scroll"];!a&&n.parentNode;){var o=t.getComputedStyle(n).overflowY;if(i.includes(o)){a=n;break}n=n.parentNode}return a||t.document.body},i.scrollToQuote=function(e,t,a){var n=i.refs.diffViewer.value.find((function(a){if(a.data.old_index==t&&a.data.new_index==e)return a}));if(n){var o=ae(window.viewer,n);if(!o)return;var r=window,s=i.findScrollContainer(o,r);s==r.document.body||s==r.document.documentElement?r.scrollTo(0,o.offsetTop):s.scrollTop=o.offsetTop}},i.showDiffViewer=function(){return l.a.createElement("div",null,i.state.isShowDiff?l.a.createElement(g.a,{scriptSource:u.Jb+"js/mathjax/tex-svg.js",newMarkdownContent:i.state.draftContent,oldMarkdownContent:i.state.draftOriginContent,ref:"diffViewer"}):l.a.createElement(g.a,{scriptSource:u.Jb+"js/mathjax/tex-svg.js",newMarkdownContent:i.state.draftContent,oldMarkdownContent:i.state.draftContent,ref:"diffViewer"}),l.a.createElement("i",{className:"fa fa-plus-square review-comment-btn",ref:"commentbtn",onMouseDown:i.addComment}))},i.listReviewers=function(){h.a.listDraftReviewers(u.K).then((function(e){i.setState({reviewers:e.data.reviewers})}))},i.onSwitchShowDiff=function(){if(!i.state.isShowDiff){var e=Object(o.a)(i);setTimeout((function(){e.getChangedNodes()}),100)}i.setState({isShowDiff:!i.state.isShowDiff})},i.toggleDiffTip=function(){i.setState({showDiffTip:!i.state.showDiffTip})},i.toggleAddReviewerDialog=function(){i.state.showReviewerDialog&&i.listReviewers(),i.setState({showReviewerDialog:!i.state.showReviewerDialog})},i.showDiffButton=function(){return l.a.createElement("div",{className:"seafile-toggle-diff"},l.a.createElement("label",{className:"custom-switch",id:"toggle-diff"},l.a.createElement("input",{type:"checkbox",checked:i.state.isShowDiff&&"checked",name:"option",className:"custom-switch-input",onChange:i.onSwitchShowDiff}),l.a.createElement("span",{className:"custom-switch-indicator"})),l.a.createElement(f.J,{placement:"bottom",isOpen:i.state.showDiffTip,target:"toggle-diff",toggle:i.toggleDiffTip},Object(u.mb)("View diff")))},i.onPublishDraft=function(){h.a.publishDraft(u.K).then((function(e){i.setState({draftStatus:e.data.draft_status})}))},i.initialDiffViewerContent=function(){h.a.listFileHistoryRecords(u.N,u.J,1,25).then((function(e){i.setState({historyList:e.data.data,totalReversionCount:e.data.total_count}),e.data.data.length>1?v.a.all([h.a.getFileRevision(u.N,e.data.data[0].commit_id,u.J),h.a.getFileRevision(u.N,e.data.data[1].commit_id,u.J)]).then(v.a.spread((function(e,t){v.a.all([h.a.getFileContent(e.data),h.a.getFileContent(t.data)]).then(v.a.spread((function(e,t){i.setState({draftContent:e.data,draftOriginContent:t.data})})))}))):h.a.getFileRevision(u.N,e.data.data[0].commit_id,u.J).then((function(e){h.a.getFileContent(e.data).then((function(e){i.setState({draftContent:e.data,draftOriginContent:""})}))}))}))},i.setDiffViewerContent=function(e,t){i.setState({draftContent:e,draftOriginContent:t,isLoading:!1})},i.setURL=function(e){var t=new $(window.location.href);t.set("hash",e),window.location.href=t.toString()},i.tabItemClick=function(e){i.state.activeTab!==e&&("history"!==e&&window.location.hash&&i.setURL("#"),"reviewInfo"==e?i.initialContent():"history"==e&&i.initialDiffViewerContent(),i.setState({activeTab:e}))},i.showNavItem=function(e){var t=i.state.commentsList.length;switch(e){case"info":return l.a.createElement(f.C,{className:"nav-item"},l.a.createElement(f.D,{className:Q()({active:"reviewInfo"===i.state.activeTab}),onClick:function(){i.tabItemClick("reviewInfo")}},l.a.createElement("i",{className:"fas fa-info-circle"})));case"comments":return l.a.createElement(f.C,{className:"nav-item"},l.a.createElement(f.D,{className:Q()({active:"comments"===i.state.activeTab}),onClick:function(){i.tabItemClick("comments")}},l.a.createElement("i",{className:"fa fa-comments"}),t>0&&l.a.createElement("div",{className:"comments-number"},t)));case"history":return l.a.createElement(f.C,{className:"nav-item"},l.a.createElement(f.D,{className:Q()({active:"history"===i.state.activeTab}),onClick:function(){i.tabItemClick("history")}},l.a.createElement("i",{className:"fas fa-history"})))}},i.getDomNodeByPath=function(e){for(var t,a=document.querySelector(".viewer-component");"number"===typeof e[0]&&a;)(t=a.children[e[0]]).getAttribute("data-slate-node")||(t=t.children[0]),e.shift(),a=t;return t},i.setBtnPosition=function(){var e=window.getSelection();if(e.rangeCount){var t=e.getRangeAt(0),a=null,n=i.refs.commentbtn.style;try{a=te(window.viewer,t)}catch(s){return void(n.top="-1000px")}if(a&&!Z.h.isCollapsed(a)){i.range=a;var o=a.anchor.path.slice();o.pop();var r=i.getDomNodeByPath(o);n.right="0px",n.top=r?"".concat(r.offsetTop,"px"):"-1000px"}else n.top="-1000px"}},i.getQuote=function(){if(i.range){i.quote=Object(w.a)(Z.b.fragment(window.viewer,i.range));var e=window.viewer.children[i.range.anchor.path[0]];i.newIndex=e.data.new_index,i.oldIndex=e.data.old_index}},i.onResizeMouseUp=function(){i.state.inResizing&&i.setState({inResizing:!1})},i.onResizeMouseDown=function(){i.setState({inResizing:!0})},i.onResizeMouseMove=function(e){var t=100-e.nativeEvent.clientX/i.refs.main.clientWidth*100;if(t<20||t>60)return i.setState({inResizing:!1}),null;i.setState({rightPartWidth:t})},i.renderDiffButton=function(){switch(u.O){case"open":if(!u.H||!u.Qb)return;return i.showDiffButton();case"published":if(!u.Qb)return;return i.showDiffButton()}},i.renderNavItems=function(){switch(u.O){case"open":return u.H?l.a.createElement(f.B,{tabs:!0,className:"review-side-panel-nav"},i.showNavItem("info"),i.showNavItem("comments"),i.showNavItem("history")):l.a.createElement(f.B,{tabs:!0,className:"review-side-panel-nav"},i.showNavItem("info"));case"published":return u.Qb?l.a.createElement(f.B,{tabs:!0,className:"review-side-panel-nav"},i.showNavItem("info"),i.showNavItem("comments")):l.a.createElement(f.B,{tabs:!0,className:"review-side-panel-nav"},i.showNavItem("info"))}},i.renderContent=function(){switch(u.O){case"open":return u.H?i.showDiffViewer():l.a.createElement("p",{className:"error"},Object(u.mb)("Draft has been deleted."));case"published":return u.Qb?i.showDiffViewer():l.a.createElement("p",{className:"error"},Object(u.mb)("Original file has been deleted."))}},i.state={draftContent:"",draftOriginContent:"",draftInfo:{},isLoading:!0,isShowDiff:!0,showDiffTip:!1,activeTab:"reviewInfo",commentsList:[],changedNodes:[],originRepoName:"",isShowCommentDialog:!1,activeItem:null,historyList:[],showReviewerDialog:!1,reviewers:[],inResizing:!1,rightPartWidth:30,draftStatus:u.O},i.quote="",i.newIndex=null,i.oldIndex=null,i.changeIndex=-1,i.range=null,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.getOriginRepoInfo(),this.getDraftInfo(),this.listReviewers(),this.listComments(),this.initialContent(),document.addEventListener("selectionchange",this.setBtnPosition)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("selectionchange",this.setBtnPosition)}},{key:"render",value:function(){var e=this.state,t=e.draftInfo,a=e.reviewers,n=e.originRepoName,i=e.draftStatus,o=this.state.inResizing?this.onResizeMouseMove:null,r=u.ic+"lib/"+u.N+"/file"+u.J+"?mode=edit",s="published"==this.state.draftStatus,c="open"==this.state.draftStatus&&"rw"==u.jb,m="open"==this.state.draftStatus&&"rw"==u.jb,d=ee(1e3*t.mtime).format("YYYY-MM-DD HH:mm"),h="".concat(u.ic,"profile/").concat(encodeURIComponent(t.last_modifier_email),"/");return l.a.createElement("div",{className:"wrapper"},l.a.createElement("div",{id:"header",className:"header review"},l.a.createElement("div",{className:"cur-file-info"},l.a.createElement("div",{className:"info-item file-feature"},l.a.createElement("span",{className:"sf2-icon-review"})),l.a.createElement("div",null,l.a.createElement("div",{className:"info-item file-info"},l.a.createElement("span",{className:"file-name"},u.I),l.a.createElement("span",{className:"mx-2 file-review"},Object(u.mb)("Review"))),!s&&t.mtime&&l.a.createElement("div",{className:"last-modification"},l.a.createElement("a",{href:h},t.last_modifier_name),l.a.createElement("span",{className:"mx-1"},d)))),l.a.createElement("div",{className:"button-group"},this.renderDiffButton(),m&&l.a.createElement("a",{href:r,className:"mx-1"},l.a.createElement(f.c,{className:"file-operation-btn",color:"secondary"},Object(u.mb)("Edit Draft"))),c&&l.a.createElement("button",{className:"btn btn-success file-operation-btn",title:Object(u.mb)("Publish draft"),onClick:this.onPublishDraft},Object(u.mb)("Publish")),s&&l.a.createElement("button",{className:"btn btn-success file-operation-btn",title:Object(u.mb)("Published"),disabled:!0},Object(u.mb)("Published")))),l.a.createElement("div",{id:"main",className:"main",ref:"main"},l.a.createElement("div",{className:"cur-view-container",onMouseMove:o,onMouseUp:this.onResizeMouseUp},l.a.createElement("div",{className:"cur-view-content",ref:"viewContent",style:{width:100-this.state.rightPartWidth+"%"}},this.state.isLoading?l.a.createElement("div",{className:"markdown-viewer-render-content article"},l.a.createElement(b.a,null)):l.a.createElement("div",{className:"markdown-viewer-render-content article"},this.renderContent())),l.a.createElement("div",{className:"cur-view-right-part",style:{width:this.state.rightPartWidth+"%"}},l.a.createElement("div",{className:"seafile-comment-resize",onMouseDown:this.onResizeMouseDown}),l.a.createElement("div",{className:"review-side-panel"},this.renderNavItems(),l.a.createElement(f.G,{activeTab:this.state.activeTab},l.a.createElement(f.H,{tabId:"reviewInfo"},l.a.createElement("div",{className:"review-side-panel-body"},l.a.createElement(ie,{reviewers:a,toggleAddReviewerDialog:this.toggleAddReviewerDialog}),l.a.createElement(oe,null),u.H&&l.a.createElement(se,{commentsList:this.state.commentsList}),!0===this.state.isShowDiff&&this.state.changedNodes.length>0&&l.a.createElement(ce,{changedNumber:this.state.changedNodes.length,scrollToChangedNode:this.scrollToChangedNode}),l.a.createElement(re,{originRepoName:n,draftInfo:t,draftStatus:i}))),l.a.createElement(f.H,{tabId:"comments",className:"comments"},l.a.createElement(F,{scrollToQuote:this.scrollToQuote,listComments:this.listComments,commentsList:this.state.commentsList,inResizing:!1})),l.a.createElement(f.H,{tabId:"history",className:"history"},l.a.createElement(K,{activeItem:this.state.activeItem,historyList:this.state.historyList,totalReversionCount:this.state.totalReversionCount,onHistoryItemClick:this.onHistoryItemClick,onHistoryListChange:this.onHistoryListChange}))))))),this.state.showReviewerDialog&&l.a.createElement(G.a,null,l.a.createElement(H,{showReviewerDialog:this.state.showReviewerDialog,toggleAddReviewerDialog:this.toggleAddReviewerDialog,draftID:u.K,reviewers:a})),this.state.isShowCommentDialog&&l.a.createElement(G.a,null,l.a.createElement(q,{toggleCommentDialog:this.toggleCommentDialog,onCommentAdded:this.onCommentAdded,quote:this.quote,newIndex:this.newIndex,oldIndex:this.oldIndex})))}}]),a}(l.a.Component),ie=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){return Object(n.a)(this,a),t.call(this,e)}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.reviewers;return l.a.createElement("div",{className:"review-side-panel-item"},l.a.createElement("div",{className:"review-side-panel-header"},Object(u.mb)("Reviewers"),l.a.createElement("i",{className:"fa fa-cog",onClick:this.props.toggleAddReviewerDialog})),e.length>0?e.map((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l.a.createElement("div",{className:"reviewer-info",key:t},l.a.createElement("img",{className:"avatar review-side-panel-avatar",src:e.avatar_url,alt:""}),l.a.createElement("span",{className:"reviewer-name ellipsis"},e.user_name))})):l.a.createElement("span",null,Object(u.mb)("No reviewer yet.")))}}]),a}(l.a.Component),oe=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"review-side-panel-item"},l.a.createElement("div",{className:"review-side-panel-header"},Object(u.mb)("Author")),l.a.createElement("div",{className:"author-info"},l.a.createElement("img",{className:"avatar review-side-panel-avatar",src:u.h,alt:""}),l.a.createElement("span",{className:"author-name ellipsis"},u.g)))}}]),a}(l.a.Component),re=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){return Object(n.a)(this,a),t.call(this,e)}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props,t=e.draftStatus,a=e.originRepoName,n=u.Zb+"/lib/"+u.N+"/file"+u.L;return l.a.createElement("div",{className:"dirent-table-container"},l.a.createElement("table",{className:"table-thead-hidden"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",{width:"25%"}),l.a.createElement("th",{width:"75%"}))),l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("th",{className:"align-text-top"},Object(u.mb)("Location")),l.a.createElement("td",null,"open"===t?l.a.createElement("span",null,a,u.J):l.a.createElement("a",{href:n,className:"text-dark"},n))))))}}]),a}(l.a.Component),se=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){return Object(n.a)(this,a),t.call(this,e)}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.commentsList,t=0;if(e)for(var a=0,n=e.length;a<n;a++)!1===e[a].resolved&&t++;return l.a.createElement("div",{className:"review-side-panel-item"},l.a.createElement("div",{className:"review-side-panel-header"},Object(u.mb)("Comments")),l.a.createElement("div",{className:"changes-info"},l.a.createElement("span",null,Object(u.mb)("Unresolved comments:")," ",t)))}}]),a}(l.a.Component),ce=function(e){Object(r.a)(a,e);var t=Object(s.a)(a);function a(e){return Object(n.a)(this,a),t.call(this,e)}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"review-side-panel-item"},l.a.createElement("div",{className:"review-side-panel-header"},Object(u.mb)("Changes")),l.a.createElement("div",{className:"changes-info"},l.a.createElement("span",null,Object(u.mb)("Number of changes:")," ",this.props.changedNumber),this.props.changedNumber>0&&l.a.createElement("div",null,l.a.createElement("i",{className:"fa fa-arrow-circle-up",onClick:function(){e.props.scrollToChangedNode("down")}}),l.a.createElement("i",{className:"fa fa-arrow-circle-down",onClick:function(){e.props.scrollToChangedNode("up")}}))))}}]),a}(l.a.Component);d.a.render(l.a.createElement(ne,null),document.getElementById("wrapper"))},200:function(e,t,a){"use strict";var n=a(14),i=a(17),o=a(19),r=a(20),s=a(21),c=a(0),l=a.n(c),m=a(86),d=a(35),f=a(81),u=a.n(f);function h(e,t){if(!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e.toUpperCase()===t.toUpperCase())return 1;if(1===e.length&&1===t.length)return 0;var a=g(e),n=g(t),i=a.length+n.length,o=0;return a.forEach((function(e){for(var t,a=0;t=n[a];a++)if(e===t){o++,n.splice(a,1);break}})),2*o/i}function p(e){return Array.isArray(e)?e.reduce((function(e,t){return e.concat(p(t))}),[]):[e]}function v(e){for(var t=[],a=0,n=e.length-1;a<n;a++)t[a]=e.substring(a,a+2);return t}function g(e){return p(e.toUpperCase().split(" ").map(v))}var w=a(11),b=a(41);function E(e,t){return e.type===t.type&&(!!u.a.isEqual(e,t)||(w.i.isText(e)&&w.i.isText(t)?h(e.text,t.text)>=.5&&"changed":(e.type===t.type&&(e.type.includes("ordered_list")||e.type.includes("unordered_list"))&&h(w.d.text(e),w.d.text(t))>=.5||e.type===t.type&&(e.children.length>1||t.children.length>1)&&"list_item"===e.type&&h(w.d.text(e),w.d.text(t))>=.5||e.type===t.type&&"paragraph"===e.type&&h(w.d.text(e),w.d.text(t))>=.5||e.type===t.type&&"table"===e.type&&h(w.d.text(e),w.d.text(t))>=.5||e.type===t.type&&"table_row"===e.type||e.type===t.type&&"table_cell"===e.type)&&"changed"))}function C(e,t){return e===t}var N=function(){function e(){var t=this;Object(n.a)(this,e),this.deepDiff=function(e,a,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=[],r=i+1,s=new O({equalFunc:n});s.ArrayDiff(e,a);for(var c=0;c<s.diff.length;c++){var l=s.diff[c],m=l.changeType;if("common"===m){var d={diff_state:"diff-common",new_index:l.newIndex,old_index:-1,node_depth:r};l.item.data=Object.assign(l.item.data?l.item.data:{},d)}else if("added"===m)if(w.i.isText(l.item))l.item.ADD=!0;else{var f={diff_state:"diff-added",new_index:l.newIndex,old_index:-1,node_depth:r};l.item.data=Object.assign(l.item.data?l.item.data:{},f)}else if("removed"===m)if(w.i.isText(l.item))l.item.DELETE=!0;else{var u={diff_state:"diff-removed",new_index:-1,old_index:l.oldIndex,node_depth:r};l.item.data=Object.assign(l.item.data?l.item.data:{},u)}else if("replaced"===m){var h=void 0,p=l.item.type||"text";if("text"===p?h=t.getTextDiff(l.newItem,l.oldItem):(p.includes("ordered_list")||p.includes("unordered_list")||p.includes("list_item")||"table"===p||"table_row"===p||"table_cell"===p||"paragraph"===p)&&(h=t.deepDiff(l.newItem.children,l.oldItem.children,n,r)),w.i.isText(l.item))l.item=h;else{var v={diff_state:"diff-replaced",new_index:-1,old_index:l.oldIndex,node_depth:r};l.item.data=Object.assign(l.item.data?l.item.data:{},v),l.item.children=h}}Array.isArray(l.item)?o=o.concat(l.item):o.push(l.item)}return o},this.getDiffDocument=function(e,a){var n=Object(b.a)(e),i=Object(b.a)(a),o=t.deepDiff(n,i,E);return o=t.splitTopDiffNodes(o)}}return Object(i.a)(e,[{key:"getTextDiff",value:function(e,t){var a=[],n=this.textDiff(e.text,t.text);return a=a.concat(n)}},{key:"textDiff",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=[],i=new O({equalFunc:C});i.StringDiff(e,t);var o=i.diff,r="",s=o[0].changeType;return o.forEach((function(e,t,i){var o="";"removed"===s?o="DELETE":"added"===s&&(o="ADD"),s===e.changeType?(r+=e.item,t===i.length-1&&n.push(Object(d.a)(Object(m.a)({text:r},o,!0),a))):e.changeType!==s&&(n.push(Object(d.a)(Object(d.a)({text:r},a),{},Object(m.a)({},o,!0))),s=e.changeType,r=e.item,t===i.length-1&&("removed"===s?o="DELETE":"added"===s&&(o="ADD"),n.push(Object(d.a)(Object(m.a)({text:r},o,!0),a))))})),n}},{key:"splitDiffParagraph",value:function(e){var t=u.a.cloneDeep(e),a=u.a.cloneDeep(e),n=[],i=[];return e.children.forEach((function(e,t,a){"link"===e.type||"image"===e.type?"diff-added"===e.data.diff_state?n.push(e):("diff-removed"===e.data.diff_state||n.push(e),i.push(e)):e.ADD?n.push(e):(e.DELETE||n.push(e),i.push(e))})),t.children=n,a.data.paragraph_state="old-paragraph",t.data.paragraph_state="new-paragraph",a.children=i,[a,t]}},{key:"splitTopDiffNodes",value:function(e){var t=this,a=[];return e.forEach((function(e){if("diff-replaced"===e.data.diff_state&&"paragraph"===e.type){var n=t.splitDiffParagraph(e);a.push(n[0],n[1])}else"diff-replaced"===e.data.diff_state&&"table"===e.type?(t.splitTableDiffParagraph(e),a.push(e)):a.push(e)})),a}},{key:"splitTableDiffParagraph",value:function(e){var t=this;return e.children.forEach((function(e,a,n){"diff-replaced"===e.data.diff_state&&e.children.forEach((function(e){if("diff-replaced"===e.data.diff_state&&"diff-replaced"===e.children[0].data.diff_state){var a=t.splitDiffParagraph(e.children[0]);e.children=a}}))})),e}}]),e}(),y=function(){function e(t,a,i){Object(n.a)(this,e),this.item=t,this.newIndex=a,this.oldIndex=i}return Object(i.a)(e,[{key:"added",value:function(){return void 0===this.oldIndex}},{key:"removed",value:function(){return void 0===this.newIndex}},{key:"common",value:function(){return void 0!==this.oldIndex&&void 0!==this.newIndex}}]),e}(),O=function(){function e(t){Object(n.a)(this,e),this.equalFunc=t.equalFunc?t.equalFunc:C,void 0!=t.shouldDetectChange?this.shouldDetectChange=t.shouldDetectChange:this.shouldDetectChange=!1,this.similarityFunc=t.similarityFunc}return Object(i.a)(e,[{key:"addAdded",value:function(e,t){var a=new y(e,t,void 0);a.changeType="added",this.added.push(a),this.diff.push(a)}},{key:"addRemoved",value:function(e,t){var a=new y(e,void 0,t);this.removed.push(a),a.changeType="removed",this.diff.push(a)}},{key:"addReplaced",value:function(e,t,a,n){var i=new y(e,n,a);i.newItem=t,i.oldItem=e,i.changeType="replaced",this.replaced.push(i),this.diff.push(i)}},{key:"addCommon",value:function(e,t,a,n){var i=new y(e,n,a);i.newItem=t,i.changeType="common",i.oldItem=e,this.common.push(i),this.diff.push(i)}},{key:"StringDiff",value:function(e,t){var a=e.length,n=t.length,i=0,o=0,r=[];for(r[a]=[],o=n;o>=0;r[a][o--]=0);for(i=a-1;i>=0;i--)for(r[i]=[],r[i][n]=0,o=n-1;o>=0;o--)this.equalFunc(e[i],t[o])?r[i][o]=r[i+1][o+1]+1:r[i][o]=Math.max(r[i+1][o],r[i][o+1]);for(this.common=[],this.added=[],this.removed=[],this.replaced=[],this.diff=[],i=o=0;i<a&&o<n;){if(this.equalFunc(e[i],t[o])){var s=e[i],c=t[o];this.addCommon(c,s,o,i),i++,o++}else r[i+1][o]>=r[i][o+1]?(this.addAdded(e[i],i),i++):(this.addRemoved(t[o],o),o++)}for(;i<a;i++)this.addAdded(e[i],i);for(;o<n;o++)this.addRemoved(t[o],o)}},{key:"ArrayDiff",value:function(e,t,a){var n=e.length,i=t.length,o=0,r=0,s=[];for(s[n]=[],r=i;r>=0;s[n][r--]=0);for(o=n-1;o>=0;o--)for(s[o]=[],s[o][i]=0,r=i-1;r>=0;r--)this.equalFunc(e[o],t[r])?s[o][r]=s[o+1][r+1]+1:s[o][r]=Math.max(s[o+1][r],s[o][r+1]);for(this.common=[],this.added=[],this.removed=[],this.replaced=[],this.diff=[],o=r=0;o<n&&r<i;){var c=this.equalFunc(e[o],t[r]);if(c){var l=e[o],m=t[r];"changed"===c?this.addReplaced(m,l,r,o):this.addCommon(m,l,r,o),a&&a("C",r,o),o++,r++}else s[o+1][r]>=s[o][r+1]?(this.addAdded(e[o],o),a&&a("A",0,o),o++):(this.addRemoved(t[r],r),a&&a("D",r,0),r++)}for(;o<n;o++)this.addAdded(e[o],o),a&&a("A",0,o);for(;r<i;r++)this.addRemoved(t[r],r),a&&a("D",r,0)}}]),e}(),D=a(58),j=a(167),S=a(118),x=(a(401),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(o.a)(this,Object(r.a)(t).call(this,e))).renderDiffNode=function(e){var t=e.element,a=t.data?t.data:{},n=a.diff_state,i=a.node_depth;return"diff-added"===n?i>1?"blockquote"===t.type||"code_block"===t.type?l.a.createElement("div",{className:"diff-added-container"},Object(D.b)(e)):Object(D.b)(e):l.a.createElement("div",{className:"diff-added"},Object(D.b)(e)):"diff-removed"===n?i>1?"blockquote"===t.type||"code_block"===t.type?l.a.createElement("div",{className:"diff-removed-container"},Object(D.b)(e)):Object(D.b)(e):l.a.createElement("div",{className:"diff-removed"},Object(D.b)(e)):"diff-replaced"===n?i>1?Object(D.b)(e):l.a.createElement("div",{className:"diff-replaced"},Object(D.b)(e)):Object(D.b)(e)},a.value=[],a.slateDiff=new N,a}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.newMarkdownContent,t=this.props.oldMarkdownContent;return this.value=this.slateDiff.getDiffDocument(e,t),l.a.createElement(S.a,{scriptSource:this.props.scriptSource},l.a.createElement(j.a,{style:{width:"100%"},renderDiffElement:this.renderDiffNode,renderDiffLeaf:D.a,value:this.value}))}}]),t}(l.a.PureComponent));t.a=x},401:function(e,t,a){},402:function(e,t,a){}},[[1151,1,0]]]);
//# sourceMappingURL=draft.chunk.js.map