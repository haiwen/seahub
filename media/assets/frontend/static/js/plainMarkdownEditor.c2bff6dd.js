"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[3041],{28994:function(e,t,n){var i=n(23029),o=n(92901),r=n(97011),s=n(65604),a=window.app.pageOptions,l=a.repoID,c=a.repoName,p=a.filePath,d=a.fileName,u=window.app.config.serviceUrl,f=window.app.userInfo,h=f.username,g=s.Aq.getDirName(p);var m=function(){return(0,o.A)((function e(){var t=this;(0,i.A)(this,e),this.uploadLocalImage=function(e){return r.e.getFileServerUploadLink(l,"/").then((function(t){var n=t.data+"?ret-json=1",i="image-"+Date.now().toString()+".png",o=new File([e],i,{type:e.type}),s=new FormData;return s.append("parent_dir","/"),s.append("relative_path","images/auto-upload"),s.append("file",o),r.e.uploadImage(n,s)})).then((function(e){return t._getImageURL(e.data[0].name)}))},this.listFileTags=function(){return r.e.listFileTags(l,p)},this.listRepoTags=function(){return r.e.listRepoTags(l)},this.repoID=l,this.filePath=p,this.serviceUrl=u,this.name=f.name,this.contact_email=f.contact_email,this.fileName=d,this.userName=h}),[{key:"saveContent",value:function(e){return r.e.getUpdateLink(l,g).then((function(t){var n=t.data;return r.e.updateFile(n,p,d,e)}))}},{key:"unstarItem",value:function(){return r.e.unstarItem(this.repoID,this.filePath)}},{key:"starItem",value:function(){return r.e.starItem(this.repoID,this.filePath)}},{key:"getParentDictionaryUrl",value:function(){var e=this.filePath.substring(0,this.filePath.lastIndexOf("/")),t=encodeURIComponent(c),n=s.Aq.encodePath(e);return this.serviceUrl+"/library/"+this.repoID+"/"+t+n}},{key:"_getImageURL",value:function(e){return this.serviceUrl+"/lib/"+l+"/file/images/auto-upload/"+e+"?raw=1"}},{key:"getFileURL",value:function(e){return"file"===e.type?e.isImage()?u+"/lib/"+l+"/file"+s.Aq.encodePath(e.path())+"?raw=1":u+"/lib/"+l+"/file"+s.Aq.encodePath(e.path()):u+"/library/"+l+"/"+encodeURIComponent(c)+s.Aq.encodePath(e.path())}},{key:"isInternalFileLink",value:function(e){return new RegExp(this.serviceUrl+"/lib/[0-9a-f-]{36}/file.*").test(e)}},{key:"isInternalDirLink",value:function(e){return new RegExp(u+"/library/[0-9a-f-]{36}.*").test(e)}},{key:"getFiles",value:function(){return r.e.listDir(l,"/",{recursive:!0}).then((function(e){return e.data.dirent_list.map((function(e){return{name:e.name,type:"dir"===e.type?"dir":"file",parent_path:e.parent_dir}}))}))}},{key:"getFileHistory",value:function(){return r.e.getFileHistory(l,p)}},{key:"getFileInfo",value:function(){return r.e.getFileInfo(l,p)}},{key:"getRepoInfo",value:function(e){return r.e.getRepoInfo(e)}},{key:"getInternalLink",value:function(){return r.e.getInternalLink(l,p)}},{key:"createShareLink",value:function(e,t,n,i,o){return r.e.createShareLink(e,t,n,i,o)}},{key:"deleteShareLink",value:function(e){return r.e.deleteShareLink(e)}},{key:"getFileContent",value:function(e){return r.e.getFileContent(e)}},{key:"listFileHistoryRecords",value:function(e,t){return r.e.listFileHistoryRecords(l,p,e,t)}},{key:"getFileHistoryVersion",value:function(e,t){return r.e.getFileRevision(l,e,t)}},{key:"getUserAvatar",value:function(e){return r.e.getUserAvatar(h,e)}},{key:"fileMetaData",value:function(){return r.e.fileMetaData(l,p)}},{key:"markdownLint",value:function(e){return r.e.markdownLint(e)}},{key:"listFileParticipant",value:function(){return r.e.listFileParticipants(l,p)}},{key:"addFileParticipants",value:function(e){return r.e.addFileParticipants(l,p,e)}},{key:"listRepoRelatedUsers",value:function(){return r.e.listRepoRelatedUsers(l)}}])}(),v=new m;t.A=v},97963:function(e,t,n){n.d(t,{A:function(){return E}});var i=n(23029),o=n(92901),r=n(39874),s=n(85501),a=n(9950),l=n(40326),c=n(44414),p=function(e){function t(){return(0,i.A)(this,t),(0,r.A)(this,t,arguments)}return(0,s.A)(t,e),(0,o.A)(t,[{key:"render",value:function(){return(0,c.jsx)("div",{className:"btn-group "+this.props.className,role:"group",children:this.props.children})}}])}(a.PureComponent),d=p,u=n(81718),f=n(95754),h=function(e){function t(e){var n;return(0,i.A)(this,t),(n=(0,r.A)(this,t,[e])).toggle=function(){if(!n.props.disabled){var e=n.state,t=e.isFreezed,i=e.tooltipOpen;t&&!i||(n.setState({tooltipOpen:!i,isFreezed:!0}),setTimeout((function(){n.setState({isFreezed:!1})}),100))}},n.onClick=function(e){n.props.disabled||n.props.onClick&&n.props.onClick(e)},n.onMouseDown=function(e){n.props.disabled||n.props.onMouseDown&&n.props.onMouseDown(e)},n.getClassName=function(){var e=n.props,t=e.isRichEditor,i=e.className,o=e.disabled,r="btn btn-icon btn-secondary btn-active";return t?(r="rich-icon-btn ".concat(o?"rich-icon-btn-disabled":"rich-icon-btn-hover"))+" "+i:r+" "+i},n.state={tooltipOpen:!1,isFreezed:!1},n.timer=null,n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"componentWillUnmount",value:function(){this.timer&&clearTimeout(this.timer)}},{key:"shouldComponentUpdate",value:function(e,t){var n=e.disabled,i=e.isActive,o=this.props,r=o.disabled,s=o.isActive;return n!==r?(this.setState({tooltipOpen:!1}),!0):t.tooltipOpen!==this.state.tooltipOpen||i!==s}},{key:"render",value:function(){var e=this.state.tooltipOpen,t=this.props,n=t.id,i=t.isActive,o=t.disabled,r=t.icon,s=t.text,a=this.getClassName();return(0,c.jsxs)("button",{type:"button",id:n,className:a,"data-active":i,disabled:o,onClick:this.onClick,onMouseDown:this.onMouseDown,children:[(0,c.jsx)(f.A,{symbol:r}),(0,c.jsx)(u.A,{target:n,isOpen:e,delay:{show:0,hide:0},placement:"bottom",toggle:this.toggle,children:s})]})}}])}(a.Component);h.defaultProps={className:"",isActive:!1};var g=h,m=n(19260),v=n(6030),A=n(33151),w=n(68879),y=function(e){function t(e){var n;return(0,i.A)(this,t),(n=(0,r.A)(this,t,[e])).dropdownToggle=function(){n.setState({dropdownOpen:!n.state.dropdownOpen})},n.state={dropdownOpen:!1},n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"render",value:function(){return(0,c.jsxs)(m.A,{className:this.props.className,isOpen:this.state.dropdownOpen,toggle:this.dropdownToggle,children:[(0,c.jsxs)(v.A,{id:this.props.id,children:[(0,c.jsx)("i",{className:"iconfont icon-users"})," ",this.props.users.length]}),(0,c.jsx)(A.A,{className:"drop-list",children:this.props.users.map((function(e,t){return(0,c.jsxs)(w.A,{children:[(0,c.jsx)("i",{className:e.is_editing?"iconfont icon-edit":"iconfont icon-user"})," ",e.user.name," ",e.myself?"(you)":""]},t)}))})]})}}])}(a.PureComponent),b=n(92203),k=window.app.pageOptions.canDownloadFile,x=function(e){function t(e){var n;return(0,i.A)(this,t),(n=(0,r.A)(this,t,[e])).tooltipToggle=function(){n.setState({tooltipOpen:!n.state.tooltipOpen})},n.dropdownToggle=function(){n.setState({dropdownOpen:!n.state.dropdownOpen})},n.onHelpModuleToggle=function(e){b.EventBus.getInstance().dispatch(b.EXTERNAL_EVENTS.ON_HELP_INFO_TOGGLE,!0)},n.downloadFile=function(){location.href="?dl=1"},n.state={tooltipOpen:!1,dropdownOpen:!1},n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"render",value:function(){var e=this.props.editorMode,t=this.props.isSmallScreen;return(0,c.jsxs)(m.A,{isOpen:this.state.dropdownOpen,toggle:this.dropdownToggle,direction:"down",className:"mx-1",children:[(0,c.jsxs)(v.A,{id:"moreButton","aria-label":(0,l.AP)("More operations"),children:[(0,c.jsx)(f.A,{symbol:"more-vertical"}),(0,c.jsx)(u.A,{toggle:this.tooltipToggle,delay:{show:0,hide:0},target:"moreButton",placement:"bottom",isOpen:this.state.tooltipOpen,children:(0,l.AP)("More")})]}),(0,c.jsxs)(A.A,{className:"drop-list",right:!0,children:[!this.props.readOnly&&"rich"===e&&(0,c.jsx)(w.A,{onClick:this.props.onEdit.bind(this,"plain"),children:(0,l.AP)("Switch to plain text editor")}),!this.props.readOnly&&"plain"===e&&(0,c.jsx)(w.A,{onClick:this.props.onEdit.bind(this,"rich"),children:(0,l.AP)("Switch to rich text editor")}),!t&&this.props.showFileHistory&&(0,c.jsx)(w.A,{onClick:this.props.toggleHistory,children:(0,l.AP)("History")}),this.props.openDialogs&&"rich"===e&&(0,c.jsx)(w.A,{onClick:this.onHelpModuleToggle,children:(0,l.AP)("Help")}),(0,c.jsx)(w.A,{onClick:this.props.openParentDirectory,children:(0,l.AP)("Open parent folder")}),t&&l.zn&&(0,c.jsx)(w.A,{onClick:this.props.toggleShareLinkDialog,children:(0,l.AP)("Share")}),t&&k&&(0,c.jsx)(w.A,{onClick:this.downloadFile,children:(0,l.AP)("Download")})]})]})}}])}(a.PureComponent),j=n(59051),C=n.n(j),I=n(58788),S=window.app.pageOptions,D=S.repoID,P=S.filePath,N=function(e){function t(){return(0,i.A)(this,t),(0,r.A)(this,t,arguments)}return(0,s.A)(t,e),(0,o.A)(t,[{key:"render",value:function(){var e=this.props,t=e.fileInfo,n=e.isPro,i=e.isLocked,o=e.mediaUrl,r=t.starred?(0,l.AP)("starred"):(0,l.AP)("unstarred"),s="iconfont ".concat(t.starred?"icon-star1 star":"icon-star2"),a=C()(1e3*t.mtime).format("YYYY-MM-DD HH:mm"),p=(0,l.AP)("locked");return(0,c.jsxs)("div",{className:"topbar-file-info text-truncate ml-0 mr-4",children:[(0,c.jsxs)("div",{className:"file-title",children:[(0,c.jsx)("span",{className:"file-name text-truncate",children:t.name}),(0,c.jsx)("span",{className:"file-star",title:r,children:(0,c.jsx)("i",{className:s,onClick:this.props.toggleStar})}),(0,c.jsx)(I.j,{path:P,repoID:D}),n&&i&&(0,c.jsx)("img",{className:"file-locked-icon mx-2",width:"16",src:"".concat(o,"img/file-locked-32.png"),alt:p,title:p,"aria-label":p})]}),(0,c.jsxs)("div",{className:"file-state",children:[(0,c.jsx)("span",{className:"file-modifier-name",children:t.lastModifier}),(0,c.jsx)("span",{className:"file-modifier-time",children:a})]})]})}}])}(a.PureComponent),F=N,M=window.app.config.seafileCollabServer,O=window.app.pageOptions.canDownloadFile,L=function(e){function t(e){var n;return(0,i.A)(this,t),(n=(0,r.A)(this,t,[e])).downloadFile=function(){location.href="?dl=1"},n.openFileViaClient=function(){var e=n.props.fileInfo,t=e.repoID,i=e.path;location.href="seafile://openfile?repo_id=".concat(encodeURIComponent(t),"&path=").concat(encodeURIComponent(i))},n.openParentDirectory=function(){var e=n.props.editorApi;window.location.href=e.getParentDictionaryUrl()},n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"render",value:function(){var e=this.props,t=e.contentChanged,n=e.saving,i=e.isLocked,o=e.lockedByMe;return"rich"===this.props.editorMode?(0,c.jsxs)("div",{className:"sf-md-viewer-topbar",children:[(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first d-flex justify-content-between mw-100",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo,isLocked:i,isPro:l.am,mediaUrl:l.SG,isStarred:this.props.fileInfo.isStarred}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[M&&this.props.collabUsers.length>0&&(0,c.jsx)(y,{className:"collab-users-dropdown",users:this.props.collabUsers,id:"usersButton"}),(0,c.jsxs)(d,{children:[l.eg&&!i&&(0,c.jsx)(g,{id:"lock-unlock-file",icon:"lock",text:(0,l.AP)("Lock"),onMouseDown:this.props.toggleLockFile}),l.eg&&o&&(0,c.jsx)(g,{id:"lock-unlock-file",icon:"unlock",text:(0,l.AP)("Unlock"),onMouseDown:this.props.toggleLockFile}),l.zn&&(0,c.jsx)(g,{id:"shareBtn",text:(0,l.AP)("Share"),icon:"share",onMouseDown:this.props.toggleShareLinkDialog}),n?(0,c.jsx)("button",{type:"button","aria-label":(0,l.AP)("Saving..."),className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)(f.A,{symbol:"spinner"})}):(0,c.jsx)(g,{text:(0,l.AP)("Save"),id:"saveButton",icon:"save",disabled:!t,onMouseDown:this.props.onSaveEditorContent,isActive:t}),O&&(0,c.jsx)(g,{id:"download-file",icon:"download",text:(0,l.AP)("Download"),onClick:this.downloadFile}),"rw"==this.props.fileInfo.permission&&(0,c.jsx)(g,{id:"open-via-client",icon:"client",text:(0,l.AP)("Open via Client"),onClick:this.openFileViaClient})]}),(0,c.jsx)(x,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,showFileHistory:this.props.showFileHistory,toggleHistory:this.props.toggleHistory,openParentDirectory:this.openParentDirectory,isSmallScreen:!1})]})]}),(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first-narrow d-flex justify-content-between",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[(0,c.jsx)(d,{children:n?(0,c.jsx)("button",{type:"button","aria-label":(0,l.AP)("Saving..."),className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)(f.A,{symbol:"spinner"})}):(0,c.jsx)(g,{text:(0,l.AP)("Save"),id:"saveButton",icon:"save",disabled:!t,onMouseDown:this.props.onSaveEditorContent,isActive:t})}),(0,c.jsx)(x,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,toggleShareLinkDialog:this.props.toggleShareLinkDialog,openParentDirectory:this.openParentDirectory,showFileHistory:this.props.showFileHistory,toggleHistory:this.props.toggleHistory,isSmallScreen:!0})]})]})]}):"plain"===this.props.editorMode?(0,c.jsxs)("div",{className:"sf-md-viewer-topbar",children:[(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first d-flex justify-content-between",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[M&&this.props.collabUsers.length>0&&(0,c.jsx)(y,{className:"collab-users-dropdown",users:this.props.collabUsers,id:"usersButton"}),(0,c.jsx)(d,{children:n?(0,c.jsx)("button",{type:"button",className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)(f.A,{symbol:"spinner"})}):(0,c.jsx)(g,{id:"saveButton",text:(0,l.AP)("Save"),icon:"save",onMouseDown:this.props.onSaveEditorContent,disabled:!t,isActive:t})}),(0,c.jsx)(x,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,openParentDirectory:this.openParentDirectory,isSmallScreen:!1})]})]}),(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first-narrow d-flex justify-content-between",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[(0,c.jsx)(d,{children:n?(0,c.jsx)("button",{type:"button",className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)(f.A,{symbol:"spinner"})}):(0,c.jsx)(g,{id:"saveButton",text:(0,l.AP)("Save"),icon:"save",onMouseDown:this.props.onSaveEditorContent,disabled:!t,isActive:t})}),(0,c.jsx)(x,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,openParentDirectory:this.openParentDirectory,isSmallScreen:!1})]})]})]}):null}}])}(a.Component),E=L},87812:function(e,t,n){var i=n(90675),o=n(89379),r=n(10467),s=n(5544),a=n(9950),l=n(17119),c=n(75168),p=n(92203),d=n(23029),u=n(92901),f=n(39874),h=n(85501),g=n(48738),m=n.n(g),v=n(60436),A=n(94219),w=n(21289),y=n(91196),b=n(80512),k=n(80208),x=n(19516),j=n(94635),C=function(){return[(0,A.$K)(),(0,A.Wu)(),(0,A.N$)(),(0,b.b6)(),(0,y.Lv)(),(0,A.VH)(),(0,A.A)(),w.$t.allowMultipleSelections.of(!0),(0,y.WD)(),(0,y.y9)(y.Zt,{fallback:!0}),(0,y.SG)(),(0,x.wm)(),(0,x.yU)(),(0,A.D4)(),(0,A.HJ)(),(0,A.dz)(),(0,k.gN)(),A.w4.of([].concat((0,v.A)(x.Bc),(0,v.A)(b.pw),(0,v.A)(k.Eo),(0,v.A)(b.cL),(0,v.A)(y.f7),(0,v.A)(x.OO),(0,v.A)(j.$w)))]}(),I=n(23938),S=n(27629),D=n(44414),P=function(e){function t(){var e;(0,d.A)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=(0,f.A)(this,t,[].concat(i))).onValueChanged=function(t){var n=e.props.onChange;n&&t.docChanged&&n(t.state.doc.toString())},e.focus=function(){e.view.focus()},e.scrollIntoView=function(e){A.Lz.scrollIntoView(e)},e.setCodeMirrorRef=function(t){e.codeMirrorRef=t},e}return(0,h.A)(t,e),(0,u.A)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.initialValue,i=t.autoFocus;this.view=new A.Lz({doc:n,extensions:[C,(0,I.markdown)({codeLanguages:S.e}),A.Lz.updateListener.of((function(t){e.onValueChanged(t)})),A.Lz.lineWrapping],parent:this.codeMirrorRef}),i&&this.focus()}},{key:"componentWillUnmount",value:function(){this.view&&this.view.destroy()}},{key:"componentDidUpdate",value:function(e){e.initialValue||e.initialValue===this.props.initialValue||this.view.dispatch({changes:{from:0,to:this.view.state.doc.length,insert:this.props.initialValue}})}},{key:"render",value:function(){return(0,D.jsx)("div",{className:m()("sf-code-mirror",this.props.className),children:(0,D.jsx)("div",{ref:this.setCodeMirrorRef})})}}])}(a.Component),N=P,F=n(97963),M=n(28994),O=n(97011),L=n(65604),E=function(){var e=(0,r.A)((0,i.A)().mark((function e(t,n){var o,r,s,a,l,c,p,d;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.e.getFileInfo(t,n);case 2:return o=e.sent,r=o.data,s=r.mtime,a=r.size,l=r.starred,c=r.permission,p=r.last_modifier_name,d=r.id,e.abrupt("return",{mtime:s,size:a,starred:l,permission:c,lastModifier:p,id:d});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=(0,r.A)((0,i.A)().mark((function e(t,n){var o,r;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.e.getFileDownloadLink(t,n);case 2:return o=e.sent,r=o.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=(0,r.A)((0,i.A)().mark((function e(t,n){var o,r,s,a,l;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="rw"===t||"cloud-edit"===t,!t.startsWith("custom-")){e.next=9;break}return r=t.split("-")[1],e.next=5,O.e.getCustomPermission(n,r);case 5:s=e.sent,a=s.data.permission,l=a.permission.modify,o=!!l||o;case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=(0,r.A)((0,i.A)().mark((function e(t){var n,o;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.e.getFileContent(t);case 2:return n=e.sent,o=n.data,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=(0,r.A)((0,i.A)().mark((function e(t){var n,o,r,s,a,l,c,p;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileName,o=t.filePath,r=t.repoID,s=L.Aq.getFileIconUrl(n),document.getElementById("favicon").href=s,e.next=5,E(r,o);case 5:return a=e.sent,e.next=8,U(r,o);case 8:return l=e.sent,e.next=11,R(l);case 11:return c=e.sent,e.next=14,H(a.permission,r);case 14:return p=e.sent,e.abrupt("return",{markdownContent:c,hasPermission:p,fileInfo:a});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=n(40326),B=n(4086),V=function(e){function t(){return(0,d.A)(this,t),(0,f.A)(this,t,arguments)}return(0,h.A)(t,e),(0,u.A)(t,[{key:"render",value:function(){return(0,D.jsx)("div",{className:"empty-loading-page",children:(0,D.jsxs)("div",{className:"lds-ripple page-centered",children:[(0,D.jsx)("div",{}),(0,D.jsx)("div",{})]})})}}])}(a.Component),z=V,q=(n(93502),window.app.pageOptions),W=q.repoID,G=q.filePath,Y=q.fileName,$=q.isLocked,K=q.lockedByMe,J=window.app.config.seafileCollabServer,X=window.app.userInfo,Z={markdownContent:"",loading:!0,mode:"editor",fileInfo:{repoID:W,name:Y,path:G,mtime:null,size:0,starred:!1,permission:"",lastModifier:"",id:""},editorMode:"plain",collabServer:J||null,showMarkdownEditorDialog:!1,showShareLinkDialog:!1,showInsertFileDialog:!1,collabUsers:X?[{user:X,is_editing:!1}]:[],value:null,isShowHistory:!1,readOnly:!0,contentChanged:!1,saving:!1,isLocked:$,lockedByMe:K,fileTagList:[],participants:[]},Q=function(e){var t=(0,a.useState)(""),n=(0,s.A)(t,2),l=n[0],d=n[1],u=(0,a.useState)(""),f=(0,s.A)(u,2),h=f[0],g=f[1],m=(0,a.useState)(!1),v=(0,s.A)(m,2),A=v[0],w=v[1],y=(0,a.useState)(!1),b=(0,s.A)(y,2),k=b[0],x=b[1],j=(0,a.useState)(0),C=(0,s.A)(j,2),I=C[0],S=C[1],P=(0,a.useRef)(null),O=(0,a.useRef)(null),L=(0,a.useState)(Z),E=(0,s.A)(L,2),U=E[0],H=E[1],R=(0,a.useState)(!1),V=(0,s.A)(R,2),q=V[0],$=V[1],K=(0,a.useCallback)((function(e){d(e),p.processor.process(e,(function(e,t){var n=String(t);g(n)}))}),[]),J=(0,a.useCallback)(function(){var e=(0,r.A)((0,i.A)().mark((function e(t){var n,r,s,a,l,c,p;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileName,r=t.filePath,s=t.repoID,e.next=3,T({fileName:n,filePath:r,repoID:s});case 3:a=e.sent,l=a.markdownContent,c=a.hasPermission,p=a.fileInfo,K(l),H((0,o.A)((0,o.A)({},U),{},{loading:!1,fileInfo:(0,o.A)((0,o.A)({},U.fileInfo),p),markdownContent:l,value:"",readOnly:!c}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[U,K]);(0,a.useLayoutEffect)((function(){J({fileName:Y,filePath:G,repoID:W})}),[]);var X=(0,a.useCallback)((function(e){if(U.contentChanged){var t=(0,_.AP)("Leave this page? The system may not save your changes.");return e.returnValue=t,t}}),[U]);(0,a.useEffect)((function(){return window.addEventListener("beforeunload",X),function(){window.removeEventListener("beforeunload",X)}}),[X]);var Q=(0,a.useCallback)((function(e){K(String(e)),!U.onContentChanged&&H((0,o.A)((0,o.A)({},U),{},{contentChanged:!0}))}),[U,K]),ee=(0,a.useCallback)((function(){w(!0),x(!1)}),[]),te=(0,a.useCallback)((function(){w(!1)}),[]),ne=(0,a.useCallback)((function(e){if(A){var t=P.current,n=O.current,i=t.scrollTop/t.scrollHeight;S(i),n.scrollTop=i*n.scrollHeight}}),[A]),ie=(0,a.useCallback)((function(){x(!0),w(!1)}),[]),oe=(0,a.useCallback)((function(){x(!1)}),[]),re=(0,a.useCallback)((function(e){if(k){var t=O.current,n=P.current;S(t.scrollTop/t.scrollHeight),n.scrollTop=I*n.scrollHeight}}),[k,I]),se=(0,a.useCallback)((function(e){var t=U.fileInfo;return Object.assign({},t,{mtime:e.mtime,id:e.id,lastModifier:e.last_modifier_name})}),[U]),ae=(0,a.useCallback)((function(){$(!0);var e=U.fileInfo;M.A.saveContent(l).then((function(){M.A.getFileInfo().then((function(t){e=se(t.data),H((0,o.A)((0,o.A)({},U),{},{fileInfo:e,contentChanged:!1})),$((function(){return!1}));var n=(0,_.AP)("Successfully saved");B.A.success(n,{duration:2})}))}),(function(){$(!1);var e=(0,_.AP)("Failed to save");B.A.danger(e,{duration:2})}))}),[l,U,H,se]),le=(0,a.useCallback)((function(e){if((0,c.default)("mod+s",e))return e.preventDefault(),ae(l),!0}),[l,ae]),ce=(0,a.useCallback)((function(){var e=U.fileInfo.starred,t=Object.assign({},U.fileInfo,{starred:!e});e?M.A.unstarItem().then((function(e){H((0,o.A)((0,o.A)({},U),{},{fileInfo:t}))})):M.A.starItem().then((function(e){H((0,o.A)((0,o.A)({},U),{},{fileInfo:t}))}))}),[U]),pe=(0,a.useCallback)((function(){var e=window.location,t=e.origin,n=e.pathname;window.location.href=t+n}),[]),de=(0,a.useCallback)((function(){}),[]);return U.loading?(0,D.jsx)(z,{}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(F.A,{editorApi:M.A,collabUsers:U.collabUsers,fileInfo:U.fileInfo,toggleStar:ce,openDialogs:de,toggleShareLinkDialog:de,onEdit:pe,showFileHistory:!1,toggleHistory:de,readOnly:U.readOnly,contentChanged:U.contentChanged,saving:q,onSaveEditorContent:ae,isLocked:U.isLocked,lockedByMe:U.lockedByMe,toggleLockFile:de,editorMode:"plain"}),(0,D.jsx)("div",{className:"sf-plain-editor",children:(0,D.jsxs)("div",{className:"sf-plain-editor-main d-flex",onKeyDown:le,children:[(0,D.jsx)("div",{className:"sf-plain-editor-left-panel",ref:P,onMouseLeave:te,onMouseEnter:ee,onScroll:ne,children:(0,D.jsx)(N,{autoFocus:!0,initialValue:l,onChange:Q})}),(0,D.jsx)("div",{className:"sf-plain-editor-right-panel",ref:O,onMouseEnter:ie,onMouseLeave:oe,onScroll:re,children:(0,D.jsx)("div",{className:"preview",children:(0,D.jsx)("div",{className:"rendered-markdown article",dangerouslySetInnerHTML:{__html:h}})})})]})})]})};l.render((0,D.jsx)(Q,{}),document.getElementById("root"))},93502:function(){}},function(e){e.O(0,[4223],(function(){return t=87812,e(e.s=t);var t}));e.O()}]);