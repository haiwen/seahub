"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[613],{45743:function(e,t,r){var n=r(15671),s=r(43144),a=r(97326),i=r(60136),o=r(29388),l=r(47313),c=r(1168),h=r(3885),d=r(70816),u=r.n(d),m=r(83854),p=r(61805),f=r(4514),x=r(51282),g=r(68164),j=r(68396),b=r(24213),v=r(42995),D=r(12756),M=r(12213),I=r(7764),k=r(58447),C=r(46417),F=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e){var s;return(0,n.Z)(this,r),(s=t.call(this,e)).handleInputChange=function(e){s.setState({inputValue:e})},s.formSubmit=function(){var e=s.state.inputValue,t=s.props.repoID;s.setState({submitBtnDisabled:!0}),f.I.deleteRepoTrash(t,e.value).then((function(e){j.Z.success((0,p.ih)("Clean succeeded.")),s.props.refreshTrash(),s.props.toggleDialog()})).catch((function(e){var t=m.c.getErrorMsg(e);s.setState({formErrorMsg:t,submitBtnDisabled:!1})}))},s.options=[{label:(0,p.ih)("3 days ago"),value:3},{label:(0,p.ih)("1 week ago"),value:7},{label:(0,p.ih)("1 month ago"),value:30},{label:(0,p.ih)("all"),value:0}],s.state={inputValue:s.options[0],submitBtnDisabled:!1},s}return(0,s.Z)(r,[{key:"render",value:function(){var e=this.state.formErrorMsg;return(0,C.jsxs)(v.Z,{isOpen:!0,centered:!0,toggle:this.props.toggleDialog,children:[(0,C.jsx)(D.Z,{toggle:this.props.toggleDialog,children:(0,p.ih)("Clean")}),(0,C.jsx)(M.Z,{children:(0,C.jsxs)(l.Fragment,{children:[(0,C.jsx)("p",{children:(0,p.ih)("Clear files in trash and history\uff1a")}),(0,C.jsx)(k.Z,{defaultValue:this.options[0],options:this.options,autoFocus:!1,onChange:this.handleInputChange,placeholder:""}),e&&(0,C.jsx)("p",{className:"error m-0 mt-2",children:e})]})}),(0,C.jsx)(I.Z,{children:(0,C.jsx)("button",{className:"btn btn-primary",disabled:this.state.submitBtnDisabled,onClick:this.formSubmit,children:(0,p.ih)("Submit")})})]})}}]),r}(l.Component),S=F,w=(r(98391),r(53379),window.app.pageOptions),_=w.repoID,N=w.repoFolderName,Z=w.path,O=w.enableClean,y=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e){var s;return(0,n.Z)(this,r),(s=t.call(this,e)).getItems=function(e){f.I.getRepoFolderTrash(_,Z,e).then((function(e){var t=e.data,r=t.data,n=t.more,a=t.scan_stat;!r.length&&n?s.getItems(a):s.setState({isLoading:!1,items:s.state.items.concat(r),more:n,scanStat:a})})).catch((function(e){s.setState({isLoading:!1,errorMsg:m.c.getErrorMsg(e,!0)})}))},s.getMore=function(){s.setState({isLoading:!0}),s.getItems(s.state.scanStat)},s.onSearchedClick=function(e){if(!0===e.is_dir){var t=p.ze+"library/"+e.repo_id+"/"+e.repo_name+e.path;(0,h.c4)(t,{repalce:!0})}else{var r=p.ze+"lib/"+e.repo_id+"/file"+m.c.encodePath(e.path);window.open("about:blank").location.href=r}},s.goBack=function(e){e.preventDefault(),window.history.back()},s.cleanTrash=function(){s.toggleCleanTrashDialog()},s.toggleCleanTrashDialog=function(){s.setState({isCleanTrashDialogOpen:!s.state.isCleanTrashDialogOpen})},s.refreshTrash=function(){s.setState({isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,showFolder:!1}),s.getItems()},s.renderFolder=function(e,t,r){s.setState({showFolder:!0,commitID:e,baseDir:t,folderPath:r,folderItems:[],isLoading:!0}),f.I.listCommitDir(_,e,"".concat(t.substr(0,t.length-1)).concat(r)).then((function(e){s.setState({isLoading:!1,folderItems:e.data.dirent_list})})).catch((function(e){e.response?403==e.response.status?s.setState({isLoading:!1,errorMsg:(0,p.ih)("Permission denied")}):s.setState({isLoading:!1,errorMsg:(0,p.ih)("Error")}):s.setState({isLoading:!1,errorMsg:(0,p.ih)("Please check the network.")})}))},s.clickRoot=function(e){e.preventDefault(),s.refreshTrash()},s.clickFolderPath=function(e,t){t.preventDefault();var r=s.state,n=r.commitID,a=r.baseDir;s.renderFolder(n,a,e)},s.renderFolderPath=function(){var e=s.state.folderPath.split("/");return(0,C.jsxs)(l.Fragment,{children:[(0,C.jsx)("a",{href:"#",onClick:s.clickRoot,className:"text-truncate",title:N,children:N}),(0,C.jsx)("span",{className:"mx-1",children:"/"}),e.map((function(t,r){return r>0&&r!=e.length-1?(0,C.jsxs)(l.Fragment,{children:[(0,C.jsx)("a",{className:"text-truncate",href:"#",onClick:s.clickFolderPath.bind((0,a.Z)(s),e.slice(0,r+1).join("/")),title:e[r],children:e[r]}),(0,C.jsx)("span",{className:"mx-1",children:"/"})]},r):null})),(0,C.jsx)("span",{className:"text-truncate",title:e[e.length-1],children:e[e.length-1]})]})},s.state={isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,isCleanTrashDialogOpen:!1},s}return(0,s.Z)(r,[{key:"componentDidMount",value:function(){this.getItems()}},{key:"render",value:function(){var e=this.state,t=e.isCleanTrashDialogOpen,r=e.showFolder,n=(0,p.ih)("{placeholder} Trash");return n=n.replace("{placeholder}",'<span class="op-target text-truncate mx-1">'+m.c.HTMLescape(N)+"</span>"),(0,C.jsxs)(l.Fragment,{children:[(0,C.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,C.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[(0,C.jsx)("a",{href:p.ze,children:(0,C.jsx)("img",{src:p.si+p.j1,height:p.AN,width:p.Bv,title:p.y7,alt:"logo"})}),(0,C.jsx)(b.Z,{onSearchedClick:this.onSearchedClick})]}),(0,C.jsx)("div",{className:"flex-auto container-fluid pt-4 pb-6 o-auto",children:(0,C.jsx)("div",{className:"row",children:(0,C.jsxs)("div",{className:"col-md-10 offset-md-1",children:[(0,C.jsx)("h2",{dangerouslySetInnerHTML:{__html:n},className:"d-flex mw-100"}),(0,C.jsx)("a",{href:"#",className:"go-back",title:(0,p.ih)("Back"),onClick:this.goBack,role:(0,p.ih)("Back"),children:(0,C.jsx)("span",{className:"fas fa-chevron-left"})}),(0,C.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[(0,C.jsxs)("p",{className:"m-0 text-truncate d-flex",children:[(0,C.jsx)("span",{className:"mr-1",children:(0,p.ih)("Current path: ")}),r?this.renderFolderPath():(0,C.jsx)("span",{className:"text-truncate",title:N,children:N})]}),"/"==Z&&O&&!r&&(0,C.jsx)("button",{className:"btn btn-secondary clean flex-shrink-0 ml-4",onClick:this.cleanTrash,children:(0,p.ih)("Clean")})]}),(0,C.jsx)(T,{data:this.state,getMore:this.getMore,renderFolder:this.renderFolder})]})})})]}),t&&(0,C.jsx)(g.Z,{children:(0,C.jsx)(S,{repoID:_,refreshTrash:this.refreshTrash,toggleDialog:this.toggleCleanTrashDialog})})]})}}]),r}(l.Component),T=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e){var s;return(0,n.Z)(this,r),(s=t.call(this,e)).theadData=[{width:"5%",text:""},{width:"45%",text:(0,p.ih)("Name")},{width:"20%",text:(0,p.ih)("Delete Time")},{width:"15%",text:(0,p.ih)("Size")},{width:"15%",text:""}],s}return(0,s.Z)(r,[{key:"render",value:function(){var e=this,t=this.props.data,r=t.isLoading,n=t.errorMsg,s=t.items,a=t.more,i=t.showFolder,o=t.commitID,c=t.baseDir,h=t.folderPath,d=t.folderItems;return(0,C.jsxs)(l.Fragment,{children:[(0,C.jsxs)("table",{className:"table-hover",children:[(0,C.jsx)("thead",{children:(0,C.jsx)("tr",{children:this.theadData.map((function(e,t){return(0,C.jsx)("th",{width:e.width,children:e.text},t)}))})}),(0,C.jsx)("tbody",{children:i?d.map((function(t,r){return(0,C.jsx)(P,{item:t,commitID:o,baseDir:c,folderPath:h,renderFolder:e.props.renderFolder},r)})):s.map((function(t,r){return(0,C.jsx)(L,{item:t,renderFolder:e.props.renderFolder},r)}))})]}),r&&(0,C.jsx)(x.Z,{}),n&&(0,C.jsx)("p",{className:"error mt-6 text-center",children:n}),a&&!r&&!i&&(0,C.jsx)("button",{className:"btn btn-block more mt-6",onClick:this.props.getMore,children:(0,p.ih)("More")})]})}}]),r}(l.Component),L=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e){var s;return(0,n.Z)(this,r),(s=t.call(this,e)).handleMouseOver=function(){s.setState({isIconShown:!0})},s.handleMouseOut=function(){s.setState({isIconShown:!1})},s.restoreItem=function(e){e.preventDefault();var t=s.props.item,r=t.commit_id,n=t.parent_dir+t.obj_name;(t.is_dir?f.I.restoreFolder(_,r,n):f.I.restoreFile(_,r,n)).then((function(e){s.setState({restored:!0}),j.Z.success((0,p.ih)("Successfully restored 1 item."))})).catch((function(e){var t="";t=e.response?e.response.data.error_msg||(0,p.ih)("Error"):(0,p.ih)("Please check the network."),j.Z.danger(t)}))},s.renderFolder=function(e){e.preventDefault();var t=s.props.item;s.props.renderFolder(t.commit_id,t.parent_dir,m.c.joinPath("/",t.obj_name))},s.state={restored:!1,isIconShown:!1},s}return(0,s.Z)(r,[{key:"render",value:function(){var e=this.props.item,t=this.state,r=t.restored,n=t.isIconShown;return r?null:e.is_dir?(0,C.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,C.jsx)("td",{className:"text-center",children:(0,C.jsx)("img",{src:m.c.getFolderIconUrl(),alt:(0,p.ih)("Directory"),width:"24"})}),(0,C.jsx)("td",{children:(0,C.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.obj_name})}),(0,C.jsx)("td",{title:u()(e.deleted_time).format("LLLL"),children:u()(e.deleted_time).format("YYYY-MM-DD")}),(0,C.jsx)("td",{}),(0,C.jsx)("td",{children:(0,C.jsx)("a",{href:"#",className:n?"":"invisible",onClick:this.restoreItem,role:"button",children:(0,p.ih)("Restore")})})]}):(0,C.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,C.jsx)("td",{className:"text-center",children:(0,C.jsx)("img",{src:m.c.getFileIconUrl(e.obj_name),alt:(0,p.ih)("File"),width:"24"})}),(0,C.jsx)("td",{children:(0,C.jsx)("a",{href:"".concat(p.ze,"repo/").concat(_,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(e.commit_id,"&base=").concat(encodeURIComponent(e.parent_dir),"&p=").concat(encodeURIComponent("/"+e.obj_name)),target:"_blank",rel:"noreferrer",children:e.obj_name})}),(0,C.jsx)("td",{title:u()(e.deleted_time).format("LLLL"),children:u()(e.deleted_time).format("YYYY-MM-DD")}),(0,C.jsx)("td",{children:m.c.bytesToSize(e.size)}),(0,C.jsx)("td",{children:(0,C.jsx)("a",{href:"#",className:n?"":"invisible",onClick:this.restoreItem,role:"button",children:(0,p.ih)("Restore")})})]})}}]),r}(l.Component),P=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e){var s;return(0,n.Z)(this,r),(s=t.call(this,e)).handleMouseOver=function(){s.setState({isIconShown:!0})},s.handleMouseOut=function(){s.setState({isIconShown:!1})},s.renderFolder=function(e){e.preventDefault();var t=s.props.item,r=s.props,n=r.commitID,a=r.baseDir,i=r.folderPath;s.props.renderFolder(n,a,m.c.joinPath(i,t.name))},s.state={isIconShown:!1},s}return(0,s.Z)(r,[{key:"render",value:function(){var e=this.props.item,t=this.props,r=t.commitID,n=t.baseDir,s=t.folderPath;return"dir"==e.type?(0,C.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,C.jsx)("td",{className:"text-center",children:(0,C.jsx)("img",{src:m.c.getFolderIconUrl(),alt:(0,p.ih)("Directory"),width:"24"})}),(0,C.jsx)("td",{children:(0,C.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.name})}),(0,C.jsx)("td",{}),(0,C.jsx)("td",{}),(0,C.jsx)("td",{})]}):(0,C.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,C.jsx)("td",{className:"text-center",children:(0,C.jsx)("img",{src:m.c.getFileIconUrl(e.name),alt:(0,p.ih)("File"),width:"24"})}),(0,C.jsx)("td",{children:(0,C.jsx)("a",{href:"".concat(p.ze,"repo/").concat(_,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(r,"&base=").concat(encodeURIComponent(n),"&p=").concat(encodeURIComponent(m.c.joinPath(s,e.name))),target:"_blank",rel:"noreferrer",children:e.name})}),(0,C.jsx)("td",{}),(0,C.jsx)("td",{children:m.c.bytesToSize(e.size)}),(0,C.jsx)("td",{})]})}}]),r}(l.Component);c.render((0,C.jsx)(y,{}),document.getElementById("wrapper"))}},function(e){e.O(0,[351],(function(){return t=45743,e(e.s=t);var t}));e.O()}]);