"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[8713],{56999:function(e,t,i){var n=i(23029),o=i(92901),r=i(39874),a=i(85501),s=i(9950),c=i(58195),l=i(14113),u=i(99308),h=i(19247),d=i(76152),f=i(55627),g=i(85077),p=i(76115),S=i(85907),m=i(18849),v=i(40326),A=i(65604),b=i(44414),D=function(e){function t(e){var i;(0,n.A)(this,t),(i=(0,r.A)(this,t,[e])).isSdocSuffix=function(e){return e.endsWith(".sdoc")},i.handleChange=function(e){e.target.value.trim()?i.setState({isSubmitBtnActive:!0}):i.setState({isSubmitBtnActive:!1}),i.setState({childName:e.target.value})},i.handleSubmit=function(){if(i.state.isSubmitBtnActive){var e=i.checkDuplicatedName(),t=i.state.childName;if(e){var n=(0,v.AP)('The name "{name}" is already taken. Please choose a different name.');n=n.replace("{name}",A.Aq.HTMLescape(t)),i.setState({errMessage:n})}else{var o=i.state.parentPath+t;i.props.onAddFile(o),i.props.toggleDialog()}}},i.handleKeyDown=function(e){"Enter"===e.key&&(i.handleSubmit(),e.preventDefault())},i.checkDuplicatedName=function(){return i.props.checkDuplicatedName(i.state.childName)},i.onAfterModelOpened=function(){i.newInput.current&&(i.newInput.current.focus(),i.newInput.current.setSelectionRange(0,0))};var o=e.fileType,a=void 0===o?"":o;return i.state={parentPath:"",childName:a,errMessage:"",isSubmitBtnActive:!!i.isSdocSuffix(a)},i.newInput=s.createRef(),i}return(0,a.A)(t,e),(0,o.A)(t,[{key:"componentDidMount",value:function(){var e=this.props.parentPath;"/"===e[e.length-1]?this.setState({parentPath:e}):this.setState({parentPath:e+"/"})}},{key:"render",value:function(){var e=this.props.toggleDialog;return(0,b.jsxs)(c.A,{isOpen:!0,toggle:e,onOpened:this.onAfterModelOpened,children:[(0,b.jsx)(l.A,{toggle:e,children:(0,v.AP)("New File")}),(0,b.jsxs)(u.A,{children:[(0,b.jsx)(h.A,{children:(0,b.jsxs)(d.A,{children:[(0,b.jsx)(f.A,{for:"fileName",children:(0,v.AP)("Name")}),(0,b.jsx)(g.A,{id:"fileName",onKeyDown:this.handleKeyDown,innerRef:this.newInput,value:this.state.childName,onChange:this.handleChange})]})}),this.state.errMessage&&(0,b.jsx)(p.A,{color:"danger",className:"mt-2",children:this.state.errMessage})]}),(0,b.jsxs)(S.A,{children:[(0,b.jsx)(m.A,{color:"secondary",onClick:e,children:(0,v.AP)("Cancel")}),(0,b.jsx)(m.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,v.AP)("Submit")})]})]})}}])}(s.Component);t.A=D},87532:function(e,t,i){var n=i(9950),o=i(17119),r=i(28321),a=i(97499),s=i(65604),c=i(81446),l=i(23029),u=i(92901),h=i(39874),d=i(85501),f=i(17),g=i(97011),p=i(4086),S=i(44124),m=i(88134),v=i(56999),A=i(44414),b=function(e){function t(e){var i;return(0,l.A)(this,t),(i=(0,h.A)(this,t,[e])).onInternalLinkToggle=function(e){e&&e.internalLink&&i.setState({internalLink:e.internalLink}),i.setState({isShowInternalLinkDialog:!i.state.isShowInternalLinkDialog})},i.toggleStar=function(){var e=i.props,t=e.isStarred,n=e.repoID,o=e.docPath;t?g.e.unstarItem(n,o).then((function(e){i.props.toggleStar(!1)})).catch((function(e){var t=s.Aq.getErrorMsg(e);p.A.danger(t)})):g.e.starItem(n,o).then((function(e){i.props.toggleStar(!0)})).catch((function(e){var t=s.Aq.getErrorMsg(e);p.A.danger(t)}))},i.onShareToggle=function(){i.setState({isShowShareDialog:!i.state.isShowShareDialog})},i.onFreezeDocument=function(){var e=i.props,t=e.repoID,n=e.docPath;g.e.lockfile(t,n,-1).then((function(e){f.l7.getInstance().dispatch(f.Zo.REFRESH_DOCUMENT)})).catch((function(e){var t=s.Aq.getErrorMsg(e);p.A.danger(t)}))},i.unFreeze=function(){var e=i.props,t=e.repoID,n=e.docPath;g.e.unlockfile(t,n).then((function(e){f.l7.getInstance().dispatch(f.Zo.REFRESH_DOCUMENT)})).catch((function(e){var t=s.Aq.getErrorMsg(e);p.A.danger(t)}))},i.onNewNotification=function(){i.props.onNewNotification()},i.onClearNotification=function(){i.props.onClearNotification()},i.onCreateSdocFile=function(e){null!==e&&void 0!==e&&e.editor&&null!==e&&void 0!==e&&e.insertSdocFileLink&&i.setState({editor:e.editor,insertSdocFileLink:e.insertSdocFileLink}),null!==e&&void 0!==e&&e.newFileName&&i.setState({fileType:"".concat(e.newFileName,".sdoc")}),i.setState({isShowCreateFileDialog:!i.state.isShowCreateFileDialog})},i.checkDuplicatedName=function(e){return i.props.direntList.some((function(t){return t.name===e}))},i.onAddFile=function(e){var t=i.props.repoID,n=i.state,o=n.insertSdocFileLink,r=n.editor;g.e.createFile(t,e).then((function(e){o&&r&&o(r,e.data.obj_name,e.data.doc_uuid)})).catch((function(e){var t=s.Aq.getErrorMsg(e);p.A.danger(t)}))},i.state={isShowInternalLinkDialog:!1,isShowShareDialog:!1,internalLink:"",isShowCreateFileDialog:!1,fileType:".sdoc",editor:null,insertSdocFileLink:null},i}return(0,d.A)(t,e),(0,u.A)(t,[{key:"componentDidMount",value:function(){var e=f.l7.getInstance();this.unsubscribeInternalLinkEvent=e.subscribe(f.Zo.INTERNAL_LINK_CLICK,this.onInternalLinkToggle),this.unsubscribeStar=e.subscribe(f.Zo.TOGGLE_STAR,this.toggleStar),this.unsubscribeShare=e.subscribe(f.Zo.SHARE_SDOC,this.onShareToggle),this.unsubscribeFreezeDocument=e.subscribe(f.Zo.FREEZE_DOCUMENT,this.onFreezeDocument),this.unsubscribeUnfreeze=e.subscribe(f.Zo.UNFREEZE,this.unFreeze),this.unsubscribeNewNotification=e.subscribe(f.Zo.NEW_NOTIFICATION,this.onNewNotification),this.unsubscribeClearNotification=e.subscribe(f.Zo.CLEAR_NOTIFICATION,this.onClearNotification),this.unsubscribeCreateSdocFile=e.subscribe(f.Zo.CREATE_SDOC_FILE,this.onCreateSdocFile)}},{key:"componentWillUnmount",value:function(){this.unsubscribeInternalLinkEvent(),this.unsubscribeStar(),this.unsubscribeUnmark(),this.unsubscribeShare(),this.unsubscribeFreezeDocument(),this.unsubscribeUnfreeze(),this.unsubscribeNewNotification(),this.unsubscribeCreateSdocFile(),this.unsubscribeClearNotification()}},{key:"render",value:function(){var e=this.props,t=e.repoID,i=e.docPath,n=e.docName,o=e.docPerm,r=e.dirPath,a=this.state,s=a.isShowInternalLinkDialog,c=a.isShowShareDialog,l=a.internalLink,u=a.isShowCreateFileDialog,h=a.fileType;return(0,A.jsxs)(A.Fragment,{children:[s&&(0,A.jsx)(S.A,{repoID:t,path:i,internalLink:l,onInternalLinkDialogToggle:this.onInternalLinkToggle}),c&&(0,A.jsx)(m.A,{itemType:"file",itemPath:i,itemName:n,repoID:t,userPerm:o,toggleDialog:this.onShareToggle}),u&&(0,A.jsx)(v.A,{parentPath:r,fileType:h,onAddFile:this.onAddFile,checkDuplicatedName:this.checkDuplicatedName,toggleDialog:this.onCreateSdocFile})]})}}])}(n.Component),D=b,N=i(84878),w=function(e){function t(e){var i;(0,l.A)(this,t),(i=(0,h.A)(this,t,[e])).toggleStar=function(e){i.setState({isStarred:e})},i.onSetFavicon=function(e){var t=window.seafile.docName;e&&(t+=e);var i=s.Aq.getFileIconUrl(t);document.getElementById("favicon").href=i},i.onNewNotification=function(){i.onSetFavicon("_notification")},i.onClearNotification=function(){i.onSetFavicon()},i.getDirPath=function(){var e=window.seafile.docPath,t=e.lastIndexOf("/");return t?e.slice(0,t):"/"},i.getDirentList=function(){var e=window.seafile.repoID,t=i.getDirPath();g.e.listDir(e,t,{with_thumbnail:!0}).then((function(e){var t=[];e.data.dirent_list.forEach((function(e){var i=new N.A(e);t.push(i)})),i.setState({direntList:t})})).catch((function(e){s.Aq.getErrorMsg(e,!0)}))};var n=window.app.pageOptions,o=n.isStarred,r=n.isSdocDraft;return i.state={isStarred:o,isDraft:r,direntList:[]},i}return(0,d.A)(t,e),(0,u.A)(t,[{key:"componentDidMount",value:function(){this.onSetFavicon(),this.getDirentList()}},{key:"render",value:function(){var e=window.seafile,t=e.repoID,i=e.docPath,o=e.docName,r=e.docPerm,a=this.state,s=a.isStarred,c=a.isDraft,l=a.direntList,u=this.getDirPath();return(0,A.jsxs)(n.Fragment,{children:[(0,A.jsx)(f.YU,{isStarred:s,isDraft:c}),(0,A.jsx)(D,{repoID:t,docPath:i,docName:o,docPerm:r,isStarred:s,direntList:l,dirPath:u,toggleStar:this.toggleStar,onNewNotification:this.onNewNotification,onClearNotification:this.onClearNotification})]})}}])}(n.Component),I=window.app.config,F=I.serviceURL,k=I.avatarURL,L=I.siteRoot,C=I.lang,P=I.mediaUrl,E=I.isPro,T=window.app.userInfo,x=T.username,U=T.name,y=window.app.pageOptions,R=y.repoID,j=y.repoName,O=y.parentDir,M=y.filePerm,_=y.docPath,Z=y.docName,q=y.docUuid,z=y.seadocAccessToken,B=y.seadocServerUrl,H=y.assetsUrl,K=y.isSdocRevision,W=y.isPublished,G=y.originFilename,V=y.revisionCreatedAt,Y=y.originFileVersion,J=y.originFilePath,Q=y.originDocUuid,X=y.revisionId,$=y.isFreezed;window.seafile={repoID:R,docPath:_,docName:Z,docUuid:q,isOpenSocket:!0,serviceUrl:F,accessToken:z,sdocServer:B,name:U,username:x,avatarURL:k,siteRoot:L,docPerm:M,historyURL:s.Aq.generateHistoryURL(L,R,_),parentFolderURL:"".concat(L,"library/").concat(R,"/").concat(s.Aq.encodePath(j+O)),assetsUrl:H,isShowInternalLink:!0,isStarIconShown:!0,isSdocRevision:K,isPublished:W,originFilename:G,originFileVersion:Y,originFilePath:J,originDocUuid:Q,revisionCreatedAt:V,lang:C,revisionId:X,mediaUrl:P,isFreezed:$,isPro:"True"===E},o.render((0,A.jsx)(r.I18nextProvider,{i18n:a.A,children:(0,A.jsx)(n.Suspense,{fallback:(0,A.jsx)(c.A,{}),children:(0,A.jsx)(w,{})})}),document.getElementById("wrapper"))}},function(e){e.O(0,[4223],(function(){return t=87532,e(e.s=t);var t}));e.O()}]);