"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[676],{34464:function(e,t,n){var i=n(15671),o=n(43144),r=n(4514),s=n(83854),a=window.app.pageOptions,l=a.repoID,c=a.repoName,p=a.filePath,d=a.fileName,u=window.app.config.serviceUrl,f=window.app.userInfo,h=f.username,g=s.c.getDirName(p);var v=function(){function e(){var t=this;(0,i.Z)(this,e),this.uploadLocalImage=function(e){return r.I.getFileServerUploadLink(l,"/").then((function(t){var n=t.data+"?ret-json=1",i="image-"+Date.now().toString()+".png",o=new File([e],i,{type:e.type}),s=new FormData;return s.append("parent_dir","/"),s.append("relative_path","images/auto-upload"),s.append("file",o),r.I.uploadImage(n,s)})).then((function(e){return t._getImageURL(e.data[0].name)}))},this.listFileTags=function(){return r.I.listFileTags(l,p)},this.listRepoTags=function(){return r.I.listRepoTags(l)},this.repoID=l,this.filePath=p,this.serviceUrl=u,this.name=f.name,this.contact_email=f.contact_email,this.fileName=d,this.userName=h}return(0,o.Z)(e,[{key:"saveContent",value:function(e){return r.I.getUpdateLink(l,g).then((function(t){var n=t.data;return r.I.updateFile(n,p,d,e)}))}},{key:"unstarItem",value:function(){return r.I.unstarItem(this.repoID,this.filePath)}},{key:"starItem",value:function(){return r.I.starItem(this.repoID,this.filePath)}},{key:"getParentDictionaryUrl",value:function(){var e=this.filePath.substring(0,this.filePath.lastIndexOf("/")),t=encodeURIComponent(c),n=s.c.encodePath(e);return this.serviceUrl+"/library/"+this.repoID+"/"+t+n}},{key:"_getImageURL",value:function(e){return this.serviceUrl+"/lib/"+l+"/file/images/auto-upload/"+e+"?raw=1"}},{key:"getFileURL",value:function(e){return"file"===e.type?e.isImage()?u+"/lib/"+l+"/file"+s.c.encodePath(e.path())+"?raw=1":u+"/lib/"+l+"/file"+s.c.encodePath(e.path()):u+"/library/"+l+"/"+encodeURIComponent(c)+s.c.encodePath(e.path())}},{key:"isInternalFileLink",value:function(e){return new RegExp(this.serviceUrl+"/lib/[0-9a-f-]{36}/file.*").test(e)}},{key:"isInternalDirLink",value:function(e){return new RegExp(u+"/library/[0-9a-f-]{36}.*").test(e)}},{key:"getFiles",value:function(){return r.I.listDir(l,"/",{recursive:!0}).then((function(e){return e.data.dirent_list.map((function(e){return{name:e.name,type:"dir"===e.type?"dir":"file",parent_path:e.parent_dir}}))}))}},{key:"getFileHistory",value:function(){return r.I.getFileHistory(l,p)}},{key:"getFileInfo",value:function(){return r.I.getFileInfo(l,p)}},{key:"getRepoInfo",value:function(e){return r.I.getRepoInfo(e)}},{key:"getInternalLink",value:function(){return r.I.getInternalLink(l,p)}},{key:"createShareLink",value:function(e,t,n,i,o){return r.I.createShareLink(e,t,n,i,o)}},{key:"deleteShareLink",value:function(e){return r.I.deleteShareLink(e)}},{key:"getFileContent",value:function(e){return r.I.getFileContent(e)}},{key:"listFileHistoryRecords",value:function(e,t){return r.I.listFileHistoryRecords(l,p,e,t)}},{key:"getFileHistoryVersion",value:function(e,t){return r.I.getFileRevision(l,e,t)}},{key:"getUserAvatar",value:function(e){return r.I.getUserAvatar(h,e)}},{key:"fileMetaData",value:function(){return r.I.fileMetaData(l,p)}},{key:"markdownLint",value:function(e){return r.I.markdownLint(e)}},{key:"listFileParticipant",value:function(){return r.I.listFileParticipants(l,p)}},{key:"addFileParticipants",value:function(e){return r.I.addFileParticipants(l,p,e)}},{key:"listRepoRelatedUsers",value:function(){return r.I.listRepoRelatedUsers(l)}}]),e}(),m=new v;t.Z=m},45330:function(e,t,n){n.d(t,{Z:function(){return P}});var i=n(15671),o=n(43144),r=n(60136),s=n(29388),a=n(47313),l=n(61805),c=n(46417),p=function(e){(0,r.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"render",value:function(){return(0,c.jsx)("div",{className:"btn-group "+this.props.className,role:"group",children:this.props.children})}}]),n}(a.PureComponent),d=p,u=n(39857),f=function(e){(0,r.Z)(n,e);var t=(0,s.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).toggle=function(){if(!o.props.disabled){var e=o.state,t=e.isFreezed,n=e.tooltipOpen;t&&!n||(o.setState({tooltipOpen:!n,isFreezed:!0}),setTimeout((function(){o.setState({isFreezed:!1})}),100))}},o.onClick=function(e){o.props.disabled||o.props.onClick&&o.props.onClick(e)},o.onMouseDown=function(e){o.props.disabled||o.props.onMouseDown(e)},o.getClassName=function(){var e=o.props,t=e.isRichEditor,n=e.className,i=e.disabled,r="btn btn-icon btn-secondary btn-active";return t?(r="rich-icon-btn ".concat(i?"rich-icon-btn-disabled":"rich-icon-btn-hover"))+" "+n:r+" "+n},o.state={tooltipOpen:!1,isFreezed:!1},o.timer=null,o}return(0,o.Z)(n,[{key:"componentWillUnmount",value:function(){this.timer&&clearTimeout(this.timer)}},{key:"shouldComponentUpdate",value:function(e,t){var n=e.disabled,i=e.isActive,o=this.props,r=o.disabled,s=o.isActive;return n!==r?(this.setState({tooltipOpen:!1}),!0):t.tooltipOpen!==this.state.tooltipOpen||i!==s}},{key:"render",value:function(){var e=this.state.tooltipOpen,t=this.props,n=t.id,i=t.isActive,o=t.disabled,r=t.icon,s=t.text,a=this.getClassName();return(0,c.jsxs)("button",{type:"button",id:n,className:a,"data-active":i,disabled:o,onClick:this.onClick,onMouseDown:this.onMouseDown,children:[(0,c.jsx)("i",{className:r}),(0,c.jsx)(u.Z,{target:n,isOpen:e,delay:{show:0,hide:0},placement:"bottom",toggle:this.toggle,children:s})]})}}]),n}(a.Component);f.defaultProps={className:"",isActive:!1};var h=f,g=n(13380),v=n(25417),m=n(72611),w=n(57124),y=function(e){(0,r.Z)(n,e);var t=(0,s.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).dropdownToggle=function(){o.setState({dropdownOpen:!o.state.dropdownOpen})},o.state={dropdownOpen:!1},o}return(0,o.Z)(n,[{key:"render",value:function(){return(0,c.jsxs)(g.Z,{className:this.props.className,isOpen:this.state.dropdownOpen,toggle:this.dropdownToggle,children:[(0,c.jsxs)(v.Z,{id:this.props.id,children:[(0,c.jsx)("i",{className:"iconfont icon-users"})," ",this.props.users.length]}),(0,c.jsx)(m.Z,{className:"drop-list",children:this.props.users.map((function(e,t){return(0,c.jsxs)(w.Z,{children:[(0,c.jsx)("i",{className:e.is_editing?"iconfont icon-edit":"iconfont icon-user"})," ",e.user.name," ",e.myself?"(you)":""]},t)}))})]})}}]),n}(a.PureComponent),k=n(95423),x=window.app.pageOptions.canDownloadFile,b=function(e){(0,r.Z)(n,e);var t=(0,s.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).tooltipToggle=function(){o.setState({tooltipOpen:!o.state.tooltipOpen})},o.dropdownToggle=function(){o.setState({dropdownOpen:!o.state.dropdownOpen})},o.onHelpModuleToggle=function(e){k.EventBus.getInstance().dispatch(k.EXTERNAL_EVENTS.ON_HELP_INFO_TOGGLE,!0)},o.downloadFile=function(){location.href="?dl=1"},o.state={tooltipOpen:!1,dropdownOpen:!1},o}return(0,o.Z)(n,[{key:"render",value:function(){var e=this.props.editorMode,t=this.props.isSmallScreen;return(0,c.jsxs)(g.Z,{isOpen:this.state.dropdownOpen,toggle:this.dropdownToggle,direction:"down",className:"mx-1",children:[(0,c.jsxs)(v.Z,{id:"moreButton","aria-label":(0,l.ih)("More operations"),children:[(0,c.jsx)("i",{className:"fa fa-ellipsis-v"}),(0,c.jsx)(u.Z,{toggle:this.tooltipToggle,delay:{show:0,hide:0},target:"moreButton",placement:"bottom",isOpen:this.state.tooltipOpen,children:(0,l.ih)("More")})]}),(0,c.jsxs)(m.Z,{className:"drop-list",right:!0,children:[!this.props.readOnly&&"rich"===e&&(0,c.jsx)(w.Z,{onClick:this.props.onEdit.bind(this,"plain"),children:(0,l.ih)("Switch to plain text editor")}),!this.props.readOnly&&"plain"===e&&(0,c.jsx)(w.Z,{onClick:this.props.onEdit.bind(this,"rich"),children:(0,l.ih)("Switch to rich text editor")}),!t&&this.props.showFileHistory&&(0,c.jsx)(w.Z,{onClick:this.props.toggleHistory,children:(0,l.ih)("History")}),this.props.openDialogs&&"rich"===e&&(0,c.jsx)(w.Z,{onClick:this.onHelpModuleToggle,children:(0,l.ih)("Help")}),t&&(0,c.jsx)(w.Z,{onClick:this.props.openParentDirectory,children:(0,l.ih)("Open parent directory")}),t&&l.Fl&&(0,c.jsx)(w.Z,{onClick:this.props.toggleShareLinkDialog,children:(0,l.ih)("Share")}),t&&this.props.showFileHistory&&(0,c.jsx)(w.Z,{onClick:this.props.toggleHistory,children:(0,l.ih)("History")}),t&&x&&(0,c.jsx)(w.Z,{onClick:this.downloadFile,children:(0,l.ih)("Download")})]})]})}}]),n}(a.PureComponent),Z=n(70816),I=n.n(Z),j=n(44028),C=window.app.pageOptions,S=C.repoID,D=C.filePath,N=function(e){(0,r.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.fileInfo,n=e.isPro,i=e.isLocked,o=e.mediaUrl,r=t.starred?(0,l.ih)("starred"):(0,l.ih)("unstarred"),s="iconfont ".concat(t.starred?"icon-star1 star":"icon-star2"),a=I()(1e3*t.mtime).format("YYYY-MM-DD HH:mm"),p=(0,l.ih)("locked");return(0,c.jsxs)("div",{className:"topbar-file-info text-truncate ml-0 mr-4",children:[(0,c.jsxs)("div",{className:"file-title",children:[(0,c.jsx)("span",{className:"file-name text-truncate",children:t.name}),(0,c.jsx)("span",{className:"file-star",title:r,children:(0,c.jsx)("i",{className:s,onClick:this.props.toggleStar})}),(0,c.jsx)(j.O,{path:D,repoID:S}),n&&i&&(0,c.jsx)("img",{className:"file-locked-icon mx-2",width:"16",src:"".concat(o,"img/file-locked-32.png"),alt:p,title:p,"aria-label":p})]}),(0,c.jsxs)("div",{className:"file-state",children:[(0,c.jsx)("span",{className:"file-modifier-name",children:t.lastModifier}),(0,c.jsx)("span",{className:"file-modifier-time",children:a})]})]})}}]),n}(a.PureComponent),F=N,M=window.app.config.seafileCollabServer,O=window.app.pageOptions.canDownloadFile,L=function(e){(0,r.Z)(n,e);var t=(0,s.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).downloadFile=function(){location.href="?dl=1"},o.openFileViaClient=function(){var e=o.props.fileInfo,t=e.repoID,n=e.path;location.href="seafile://openfile?repo_id=".concat(encodeURIComponent(t),"&path=").concat(encodeURIComponent(n))},o.openParentDirectory=function(){var e=o.props.editorApi;window.location.href=e.getParentDictionaryUrl()},o}return(0,o.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.contentChanged,n=e.saving,i=e.isLocked,o=e.lockedByMe;return"rich"===this.props.editorMode?(0,c.jsxs)("div",{className:"sf-md-viewer-topbar",children:[(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first d-flex justify-content-between mw-100",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo,isLocked:i,isPro:l._y,mediaUrl:l.si,isStarred:this.props.fileInfo.isStarred}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[M&&this.props.collabUsers.length>0&&(0,c.jsx)(y,{className:"collab-users-dropdown",users:this.props.collabUsers,id:"usersButton"}),(0,c.jsxs)(d,{children:[(0,c.jsx)(h,{text:(0,l.ih)("Open parent directory"),id:"parentDirectory",icon:"fa fa-folder-open",onMouseDown:this.openParentDirectory}),l.yX&&!i&&(0,c.jsx)(h,{id:"lock-unlock-file",icon:"fa fa-lock",text:(0,l.ih)("Lock"),onMouseDown:this.props.toggleLockFile}),l.yX&&o&&(0,c.jsx)(h,{id:"lock-unlock-file",icon:"fa fa-unlock",text:(0,l.ih)("Unlock"),onMouseDown:this.props.toggleLockFile}),l.Fl&&(0,c.jsx)(h,{id:"shareBtn",text:(0,l.ih)("Share"),icon:"fa fa-share-alt",onMouseDown:this.props.toggleShareLinkDialog}),n?(0,c.jsx)("button",{type:"button","aria-label":(0,l.ih)("Saving..."),className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)("i",{className:"fa fa-spin fa-spinner"})}):(0,c.jsx)(h,{text:(0,l.ih)("Save"),id:"saveButton",icon:"fa fa-save",disabled:!t,onMouseDown:this.props.onSaveEditorContent,isActive:t}),O&&(0,c.jsx)(h,{id:"download-file",icon:"fa fa-download",text:(0,l.ih)("Download"),onClick:this.downloadFile}),"rw"==this.props.fileInfo.permission&&(0,c.jsx)(h,{id:"open-via-client",icon:"sf3-font sf3-font-desktop",text:(0,l.ih)("Open via Client"),onClick:this.openFileViaClient})]}),(0,c.jsx)(b,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,showFileHistory:this.props.showFileHistory,toggleHistory:this.props.toggleHistory,isSmallScreen:!1})]})]}),(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first-narrow d-flex justify-content-between",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[(0,c.jsx)(d,{children:n?(0,c.jsx)("button",{type:"button","aria-label":(0,l.ih)("Saving..."),className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)("i",{className:"fa fa-spin fa-spinner"})}):(0,c.jsx)(h,{text:(0,l.ih)("Save"),id:"saveButton",icon:"fa fa-save",disabled:!t,onMouseDown:this.props.onSaveEditorContent,isActive:t})}),(0,c.jsx)(b,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,toggleShareLinkDialog:this.props.toggleShareLinkDialog,openParentDirectory:this.openParentDirectory,showFileHistory:this.props.showFileHistory,toggleHistory:this.props.toggleHistory,isSmallScreen:!0})]})]})]}):"plain"===this.props.editorMode?(0,c.jsxs)("div",{className:"sf-md-viewer-topbar",children:[(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first d-flex justify-content-between",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[M&&this.props.collabUsers.length>0&&(0,c.jsx)(y,{className:"collab-users-dropdown",users:this.props.collabUsers,id:"usersButton"}),(0,c.jsx)(d,{children:n?(0,c.jsx)("button",{type:"button",className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)("i",{className:"fa fa-spin fa-spinner"})}):(0,c.jsx)(h,{id:"saveButton",text:(0,l.ih)("Save"),icon:"fa fa-save",onMouseDown:this.props.onSaveEditorContent,disabled:!t,isActive:t})}),(0,c.jsx)(b,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,isSmallScreen:!1})]})]}),(0,c.jsxs)("div",{className:"sf-md-viewer-topbar-first-narrow d-flex justify-content-between",children:[(0,c.jsx)(F,{toggleStar:this.props.toggleStar,editorApi:this.props.editorApi,fileInfo:this.props.fileInfo}),(0,c.jsxs)("div",{className:"topbar-btn-container",children:[(0,c.jsx)(d,{children:n?(0,c.jsx)("button",{type:"button",className:"btn btn-icon btn-secondary btn-active",children:(0,c.jsx)("i",{className:"fa fa-spin fa-spinner"})}):(0,c.jsx)(h,{id:"saveButton",text:(0,l.ih)("Save"),icon:"fa fa-save",onMouseDown:this.props.onSaveEditorContent,disabled:!t,isActive:t})}),(0,c.jsx)(b,{readOnly:this.props.readOnly,openDialogs:this.props.openDialogs,editorMode:this.props.editorMode,onEdit:this.props.onEdit,isSmallScreen:!1})]})]})]}):null}}]),n}(a.Component),P=L},4896:function(e,t,n){var i=n(74165),o=n(1413),r=n(15861),s=n(29439),a=n(47313),l=n(1168),c=n(37387),p=n(95423),d=n(15671),u=n(43144),f=n(60136),h=n(29388),g=n(46123),v=n.n(g),m=n(93433),w=n(22740),y=n(89933),k=n(92649),x=n(75453),b=n(687),Z=n(63961),I=n(74926),j=function(){return[(0,w.Eu)(),(0,w.HQ)(),(0,w.AE)(),(0,x.m8)(),(0,k.mi)(),(0,w.Uw)(),(0,w.qr)(),y.yy.allowMultipleSelections.of(!0),(0,k.nY)(),(0,k.nF)(k.R_,{fallback:!0}),(0,k.n$)(),(0,Z.vQ)(),(0,Z.ys)(),(0,w.Zs)(),(0,w.S2)(),(0,w.ZO)(),(0,b.sW)(),w.$f.of([].concat((0,m.Z)(Z.GA),(0,m.Z)(x.wQ),(0,m.Z)(b.Lp),(0,m.Z)(x.f$),(0,m.Z)(k.e7),(0,m.Z)(Z.B1),(0,m.Z)(I.Fv)))]}(),C=n(17471),S=n(76826),D=n(46417),N=function(e){(0,f.Z)(n,e);var t=(0,h.Z)(n);function n(){var e;(0,d.Z)(this,n);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onValueChanged=function(t){var n=e.props.onChange;n&&t.docChanged&&n(t.state.doc.toString())},e.focus=function(){e.view.focus()},e.scrollIntoView=function(e){w.tk.scrollIntoView(e)},e.setCodeMirrorRef=function(t){e.codeMirrorRef=t},e}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.initialValue,i=t.autoFocus;this.view=new w.tk({doc:n,extensions:[j,(0,C.markdown)({codeLanguages:S.M}),w.tk.updateListener.of((function(t){e.onValueChanged(t)})),w.tk.lineWrapping],parent:this.codeMirrorRef}),i&&this.focus()}},{key:"componentWillUnmount",value:function(){this.view&&this.view.destroy()}},{key:"componentDidUpdate",value:function(e){e.initialValue||e.initialValue===this.props.initialValue||this.view.dispatch({changes:{from:0,to:this.view.state.doc.length,insert:this.props.initialValue}})}},{key:"render",value:function(){return(0,D.jsx)("div",{className:v()("sf-code-mirror",this.props.className),children:(0,D.jsx)("div",{ref:this.setCodeMirrorRef})})}}]),n}(a.Component),F=N,M=n(45330),O=n(34464),L=n(4514),P=n(83854),E=function(e){var t=P.c.getFileIconUrl(e,192);document.getElementById("favicon").href=t},U=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){var o,r,s,a,l,c,p,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.I.getFileInfo(t,n);case 2:return o=e.sent,r=o.data,s=r.mtime,a=r.size,l=r.starred,c=r.permission,p=r.last_modifier_name,d=r.id,e.abrupt("return",{mtime:s,size:a,starred:l,permission:c,lastModifier:p,id:d});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){var o,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.I.getFileDownloadLink(t,n);case 2:return o=e.sent,r=o.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){var o,r,s,a,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="rw"===t||"cloud-edit"===t,!t.startsWith("custom-")){e.next=9;break}return r=t.split("-")[1],e.next=5,L.I.getCustomPermission(n,r);case 5:s=e.sent,a=s.data.permission,l=a.permission.modify,o=!!l||o;case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){var n,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.I.getFileContent(t);case 2:return n=e.sent,o=n.data,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){var n,o,r,s,a,l,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileName,o=t.filePath,r=t.repoID,E(n),e.next=4,U(r,o);case 4:return s=e.sent,e.next=7,H(r,o);case 7:return a=e.sent,e.next=10,_(a);case 10:return l=e.sent,e.next=13,R(s.permission,r);case 13:return c=e.sent,e.abrupt("return",{markdownContent:l,hasPermission:c,fileInfo:s});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=n(61805),B=n(68396),V=function(e){(0,f.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,u.Z)(n,[{key:"render",value:function(){return(0,D.jsx)("div",{className:"empty-loading-page",children:(0,D.jsxs)("div",{className:"lds-ripple page-centered",children:[(0,D.jsx)("div",{}),(0,D.jsx)("div",{})]})})}}]),n}(a.Component),z=V,W=(n(66987),window.app.pageOptions),Y=W.repoID,G=W.filePath,Q=W.fileName,X=W.isLocked,$=W.lockedByMe,q=window.app.config.seafileCollabServer,K=window.app.userInfo,J={markdownContent:"",loading:!0,mode:"editor",fileInfo:{repoID:Y,name:Q,path:G,mtime:null,size:0,starred:!1,permission:"",lastModifier:"",id:""},editorMode:"plain",collabServer:q||null,showMarkdownEditorDialog:!1,showShareLinkDialog:!1,showInsertFileDialog:!1,collabUsers:K?[{user:K,is_editing:!1}]:[],value:null,isShowHistory:!1,readOnly:!0,contentChanged:!1,saving:!1,isLocked:X,lockedByMe:$,fileTagList:[],participants:[]},ee=function(e){var t=(0,a.useState)(""),n=(0,s.Z)(t,2),l=n[0],d=n[1],u=(0,a.useState)(""),f=(0,s.Z)(u,2),h=f[0],g=f[1],v=(0,a.useState)(!1),m=(0,s.Z)(v,2),w=m[0],y=m[1],k=(0,a.useState)(!1),x=(0,s.Z)(k,2),b=x[0],Z=x[1],I=(0,a.useState)(0),j=(0,s.Z)(I,2),C=j[0],S=j[1],N=(0,a.useRef)(null),L=(0,a.useRef)(null),P=(0,a.useState)(J),E=(0,s.Z)(P,2),U=E[0],H=E[1],R=(0,a.useState)(!1),_=(0,s.Z)(R,2),V=_[0],W=_[1],X=(0,a.useCallback)((function(e){d(e),p.processor.process(e,(function(e,t){var n=String(t);g(n)}))}),[]),$=(0,a.useCallback)(function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){var n,r,s,a,l,c,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileName,r=t.filePath,s=t.repoID,e.next=3,A({fileName:n,filePath:r,repoID:s});case 3:a=e.sent,l=a.markdownContent,c=a.hasPermission,p=a.fileInfo,X(l),H((0,o.Z)((0,o.Z)({},U),{},{loading:!1,fileInfo:(0,o.Z)((0,o.Z)({},U.fileInfo),p),markdownContent:l,value:"",readOnly:!c}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[U,X]);(0,a.useLayoutEffect)((function(){$({fileName:Q,filePath:G,repoID:Y})}),[]);var q=(0,a.useCallback)((function(e){if(U.contentChanged){var t=(0,T.ih)("Leave this page? The system may not save your changes.");return e.returnValue=t,t}}),[U]);(0,a.useEffect)((function(){return window.addEventListener("beforeunload",q),function(){window.removeEventListener("beforeunload",q)}}),[q]);var K=(0,a.useCallback)((function(e){X(String(e)),!U.onContentChanged&&H((0,o.Z)((0,o.Z)({},U),{},{contentChanged:!0}))}),[U,X]),ee=(0,a.useCallback)((function(){y(!0),Z(!1)}),[]),te=(0,a.useCallback)((function(){y(!1)}),[]),ne=(0,a.useCallback)((function(e){if(w){var t=N.current,n=L.current,i=t.scrollTop/t.scrollHeight;S(i),n.scrollTop=i*n.scrollHeight}}),[w]),ie=(0,a.useCallback)((function(){Z(!0),y(!1)}),[]),oe=(0,a.useCallback)((function(){Z(!1)}),[]),re=(0,a.useCallback)((function(e){if(b){var t=L.current,n=N.current;S(t.scrollTop/t.scrollHeight),n.scrollTop=C*n.scrollHeight}}),[b,C]),se=(0,a.useCallback)((function(e){var t=U.fileInfo;return Object.assign({},t,{mtime:e.mtime,id:e.id,lastModifier:e.last_modifier_name})}),[U]),ae=(0,a.useCallback)((function(){W(!0);var e=U.fileInfo;O.Z.saveContent(l).then((function(){O.Z.getFileInfo().then((function(t){e=se(t.data),H((0,o.Z)((0,o.Z)({},U),{},{fileInfo:e,contentChanged:!1})),W((function(){return!1}));var n=(0,T.ih)("Successfully saved");B.Z.success(n,{duration:2})}))}),(function(){W(!1);var e=(0,T.ih)("Failed to save");B.Z.danger(e,{duration:2})}))}),[l,U,H,se]),le=(0,a.useCallback)((function(e){if((0,c.default)("mod+s",e))return e.preventDefault(),ae(l),!0}),[l,ae]),ce=(0,a.useCallback)((function(){var e=U.fileInfo.starred,t=Object.assign({},U.fileInfo,{starred:!e});e?O.Z.unstarItem().then((function(e){H((0,o.Z)((0,o.Z)({},U),{},{fileInfo:t}))})):O.Z.starItem().then((function(e){H((0,o.Z)((0,o.Z)({},U),{},{fileInfo:t}))}))}),[U]),pe=(0,a.useCallback)((function(){var e=window.location,t=e.origin,n=e.pathname;window.location.href=t+n}),[]),de=(0,a.useCallback)((function(){}),[]);return U.loading?(0,D.jsx)(z,{}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(M.Z,{editorApi:O.Z,collabUsers:U.collabUsers,fileInfo:U.fileInfo,toggleStar:ce,openDialogs:de,toggleShareLinkDialog:de,onEdit:pe,showFileHistory:!1,toggleHistory:de,readOnly:U.readOnly,contentChanged:U.contentChanged,saving:V,onSaveEditorContent:ae,isLocked:U.isLocked,lockedByMe:U.lockedByMe,toggleLockFile:de,editorMode:"plain"}),(0,D.jsx)("div",{className:"sf-plain-editor",children:(0,D.jsxs)("div",{className:"sf-plain-editor-main d-flex",onKeyDown:le,children:[(0,D.jsx)("div",{className:"sf-plain-editor-left-panel",ref:N,onMouseLeave:te,onMouseEnter:ee,onScroll:ne,children:(0,D.jsx)(F,{autoFocus:!0,initialValue:l,onChange:K})}),(0,D.jsx)("div",{className:"sf-plain-editor-right-panel",ref:L,onMouseEnter:ie,onMouseLeave:oe,onScroll:re,children:(0,D.jsx)("div",{className:"preview",children:(0,D.jsx)("div",{className:"rendered-markdown article",dangerouslySetInnerHTML:{__html:h}})})})]})})]})};l.render((0,D.jsx)(ee,{}),document.getElementById("root"))},66987:function(){}},function(e){e.O(0,[351],(function(){return t=4896,e(e.s=t);var t}));e.O()}]);