"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[514],{18718:function(e,n,t){var i=t(15671),s=t(43144),o=t(60136),a=t(29388),r=t(47313),c=t(61805),l=t(83854),h=t(68396),d=t(46417),u=function(e){(0,o.Z)(t,e);var n=(0,a.Z)(t);function t(e){var s;return(0,i.Z)(this,t),(s=n.call(this,e)).onClick=function(e){s.inputRef.current.contains(e.target)||s.onRenameConfirm()},s.onChange=function(e){s.setState({name:e.target.value})},s.onKeyDown=function(e){e.keyCode===l.c.keyCodes.enter?s.onRenameConfirm(e):e.keyCode===l.c.keyCodes.esc&&s.onRenameCancel(e),e.nativeEvent.stopImmediatePropagation()},s.onRenameConfirm=function(e){e&&e.nativeEvent.stopImmediatePropagation();var n=s.state.name.trim();if(n!==s.props.name){var t=s.validateInput(),i=t.isValid,o=t.errMessage;i?s.props.onRenameConfirm(n):(h.Z.danger(o),s.props.onRenameCancel())}else s.props.onRenameCancel()},s.onRenameCancel=function(e){e.nativeEvent.stopImmediatePropagation(),s.props.onRenameCancel()},s.validateInput=function(){var e=s.state.name.trim(),n=!0,t="";return e?e.indexOf("/")>-1?{isValid:n=!1,errMessage:t=(0,c.ih)("Name should not include '/'.")}:{isValid:n,errMessage:t}:{isValid:n=!1,errMessage:t=(0,c.ih)("Name is required.")}},s.state={name:e.name},s.inputRef=r.createRef(),s}return(0,s.Z)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.inputRef.current.focus(),this.props.hasSuffix){var n=this.props.name.lastIndexOf(".");this.inputRef.current.setSelectionRange(0,n,"forward")}else this.inputRef.current.setSelectionRange(0,-1);setTimeout((function(){document.addEventListener("click",e.onClick)}),1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.onClick)}},{key:"render",value:function(){return(0,d.jsx)("div",{className:"rename-container",children:(0,d.jsx)("input",{ref:this.inputRef,value:this.state.name,onChange:this.onChange,onKeyDown:this.onKeyDown})})}}]),t}(r.Component);n.Z=u},28403:function(e,n,t){var i=t(93433),s=t(15671),o=t(43144),a=t(60136),r=t(29388),c=t(47313),l=t(1168),h=t(48128),d=t(46123),u=t.n(d),f=t(75517),m=t(70816),p=t.n(m),g=t(4514),v=t(61805),y=t(51282),x=t(46417),C=function(e){(0,a.Z)(t,e);var n=(0,r.Z)(t);function t(){var e;(0,s.Z)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=n.call.apply(n,[this].concat(o))).onBackClick=function(e){e.preventDefault(),window.history.back()},e}return(0,o.Z)(t,[{key:"render",value:function(){return(0,x.jsx)("div",{className:"go-back",onClick:this.onBackClick,children:(0,x.jsx)("span",{className:"fas fa-chevron-left"})})}}]),t}(c.Component),w=C,S=t(83854),j=t(14658),D=t(68396),M=t(42995),N=t(12213),I=t(13380),k=t(25417),Z=t(72611),V=t(57124),R=t(52522),H=t(18718);t(23534);p().locale(window.app.config.lang);var L=function(e){(0,a.Z)(t,e);var n=(0,r.Z)(t);function t(e){var i;return(0,s.Z)(this,t),(i=n.call(this,e)).onMouseEnter=function(){var e=i.props,n=e.currentVersion,t=e.historyVersion;n.commit_id!==t.commit_id&&i.setState({isShowOperationIcon:!0})},i.onMouseLeave=function(){var e=i.props,n=e.currentVersion,t=e.historyVersion;n.commit_id!==t.commit_id&&i.setState({isShowOperationIcon:!1})},i.onToggleClick=function(e){i.setState({isMenuShow:!i.state.isMenuShow})},i.onClick=function(){i.setState({isShowOperationIcon:!1});var e=i.props,n=e.currentVersion,t=e.historyVersion,s=e.path;n.commit_id!==t.commit_id&&i.props.onSelectHistoryVersion(s)},i.onRestore=function(){var e=i.props.historyVersion;i.props.onRestore(e)},i.onItemDownload=function(){},i.onItemCopy=function(){var e=i.props.historyVersion;e.ctime_format=p()(e.ctime).format("YYYY-MM-DD HH:mm"),i.props.onCopy(e)},i.toggleRename=function(){i.isMobile&&i.setState({isMenuShow:!1}),i.setState({isRenameShow:!i.state.isRenameShow})},i.onRenameConfirm=function(e){var n=i.props.historyVersion.obj_id;i.props.renameHistoryVersion(n,e),i.toggleRename()},i.onRenameCancel=function(){i.toggleRename()},i.showDailyHistory=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();var n=i.props.path;i.props.showDailyHistory(n,(function(){i.props.onSelectHistoryVersion(n)}))},i.state={isShowOperationIcon:!1,isMenuShow:!1,isRenameShow:!1},i.isMobile=S.t,i}return(0,o.Z)(t,[{key:"render",value:function(){var e=this.props,n=e.currentVersion,t=e.historyVersion,i=e.path,s=e.showDaily;if(!n||!t)return null;var o=t.ctime,a=t.commit_id,r=t.creator_name,c=t.obj_id,l=t.name,h=t.count,d=a===n.commit_id,f=R.Z.getUrl({type:"download_historic_file",filePath:v.bc,objID:c});return(0,x.jsxs)("li",{className:"history-list-item ".concat(d?"item-active":""," ").concat(i[2]>0?"daily-history-detail":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick,children:[0===i[2]&&(0,x.jsx)("div",{className:"daily-history-detail-toggle-container",children:h>1&&(0,x.jsx)("div",{className:u()("daily-history-detail-toggle",{"daily-history-detail-show":s}),onClick:this.showDailyHistory,children:(0,x.jsx)("i",{className:"dropdown-toggle"})})}),i[2]>0&&(0,x.jsx)("div",{className:"daily-history-detail-no-more"}),(0,x.jsxs)("div",{className:"history-info",children:[this.state.isRenameShow?(0,x.jsx)(H.Z,{name:l,onRenameConfirm:this.onRenameConfirm,onRenameCancel:this.onRenameCancel}):(0,x.jsx)("div",{className:"name",children:l}),(0,x.jsx)("div",{className:"time",children:p()(o).format("YYYY-MM-DD HH:mm")}),(0,x.jsxs)("div",{className:"owner",children:[(0,x.jsx)("span",{className:"squire-icon"}),(0,x.jsx)("span",{children:r})]})]}),(0,x.jsx)("div",{className:"history-operation",children:this.isMobile?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("a",{className:"fas fa-ellipsis-v ".concat(this.state.isShowOperationIcon||d?"":"invisible"),title:(0,v.ih)("More operations"),"aria-label":(0,v.ih)("More operations"),"aria-expanded":this.state.isMenuShow,onClick:this.onToggleClick}),(0,x.jsx)(M.Z,{className:"sdoc-mobile-history-options-modal",isOpen:this.state.isMenuShow,toggle:this.onToggleClick,children:(0,x.jsxs)(N.Z,{className:"sdoc-operation-mobile-modal-body",children:[(0,x.jsxs)("div",{className:"option-item",children:[(0,x.jsx)("i",{className:"mr-3 sf3-font sf3-font-download"}),(0,x.jsx)("a",{href:f,onClick:this.onItemDownLoad,children:(0,v.ih)("Download")})]}),0!==i[0]&&0!==i[1]&&0!==i[2]&&(0,x.jsxs)("div",{className:"option-item",children:[(0,x.jsx)("i",{className:"mr-3 sf3-font sf3-font-copy"}),(0,x.jsx)("span",{href:f,onClick:this.onItemCopy,children:(0,v.ih)("Copy")})]}),(0,x.jsxs)("div",{className:"option-item",onClick:this.toggleRename,children:[(0,x.jsx)("i",{className:"mr-3 sf3-font sf3-font-rename"}),(0,x.jsx)("span",{children:(0,v.ih)("Rename")})]})]})})]}):(0,x.jsxs)(I.Z,{isOpen:this.state.isMenuShow,toggle:this.onToggleClick,children:[(0,x.jsx)(k.Z,{tag:"a",className:"fas fa-ellipsis-v ".concat(this.state.isShowOperationIcon||d?"":"invisible"),"data-toggle":"dropdown","aria-expanded":this.state.isMenuShow,title:(0,v.ih)("More operations"),"aria-label":(0,v.ih)("More operations")}),(0,x.jsxs)(Z.Z,{children:[(0,x.jsx)(V.Z,{tag:"a",href:f,onClick:this.onItemDownLoad,children:(0,v.ih)("Download")}),0!==i[0]&&0!==i[1]&&0!==i[2]&&(0,x.jsx)(V.Z,{onClick:this.onItemCopy,children:(0,v.ih)("Copy")}),(0,x.jsx)(V.Z,{onClick:this.toggleRename,children:(0,v.ih)("Rename")})]})]})})]})}}]),t}(c.Component),Y=t(21803),b=t(29439),P=function(e,n,t){var i=(0,b.Z)(e,3),s=i[0],o=i[1],a=i[2],r=t[s],c=r.children[o],l="";if(n){var h,d,u;if(c.showDaily&&(l=c.children[a+1]),!l)l=null===(h=r.children[o+1])||void 0===h?void 0:h.children[0];if(!l)l=null===(d=t[s+1])||void 0===d||null===(u=d.children[0])||void 0===u?void 0:u.children[0];0!==s||l||(l="init")}return l},E=function(e,n,t){var i=(0,b.Z)(e,3),s=i[0],o=i[1],a=i[2];return[n[s].children[o].children[a],P(e,t,n)]};p().locale(window.app.config.lang);var _=window.fileHistory.pageOptions.docUuid,T=function(e){(0,a.Z)(t,e);var n=(0,r.Z)(t);function t(e){var o,a;(0,s.Z)(this,t),(a=n.call(this,e)).loadMore=function(){a.state.isReloadingData||(a.currentPage=a.currentPage+1,a.setState({isReloadingData:!0},(function(){g.I.listSdocHistory(_,a.currentPage,v.LZ).then((function(e){a.updateResultState(e.data),a.setState({isReloadingData:!1})}))})))},a.renameHistoryVersion=function(e,n){g.I.renameSdocHistory(_,e,n).then((function(t){a.setState({historyGroups:a.state.historyGroups.map((function(t){return t.obj_id==e&&(t.name=n),t}))})})).catch((function(e){var n=S.c.getErrorMsg(e,!0);a.setState({isLoading:!1,errorMessage:n})}))},a.onScrollHandler=function(e){var n=e.target.clientHeight,t=e.target.scrollHeight;n+e.target.scrollTop+1>=t&&a.state.hasMore&&a.loadMore()},a.restoreVersion=function(e){var n=e.commit_id,t=e.path;j.Z.revertFile(t,n).then((function(e){e.data.success&&a.setState({isLoading:!0},(function(){a.firstLoadSdocHistory()}));var n=(0,v.ih)("Successfully restored.");D.Z.success(n)})).catch((function(e){var n=S.c.getErrorMsg(e,!0);D.Z.danger((0,v.ih)(n))}))},a.onSelectHistoryVersion=function(e){var n,t=a.state.historyGroups,s=a.props.isShowChanges;(n=a.props).onSelectHistoryVersion.apply(n,(0,i.Z)(E(e,t,s)))},a.copyHistoryFile=function(e){var n=e.path,t=e.obj_id,i=e.ctime_format;g.I.sdocCopyHistoryFile(v.y8,n,t,i).then((function(e){var n=(0,v.ih)("Successfully copied %(name)s."),t=e.data.file_name;n=n.replace("%(name)s",t),D.Z.success(n)})).catch((function(e){var n=S.c.getErrorMsg(e,!0);D.Z.danger((0,v.ih)(n))}))},a.showDailyHistory=function(e,n){var t=a.state.historyGroups.slice(0),s=t[e[0]].children[e[1]];return s.showDaily?(s.showDaily=!1,void a.setState({historyGroups:t},(function(){n&&n()}))):s.children.length>1?(s.showDaily=!0,void a.setState({historyGroups:t},(function(){n&&n()}))):void g.I.listSdocDailyHistoryDetail(_,s.children[0].ctime).then((function(e){var o,r=e.data.histories;(o=s.children).push.apply(o,(0,i.Z)(r)),s.showDaily=!0,a.setState({historyGroups:t},(function(){n&&n()}))})).catch((function(e){var n=S.c.getErrorMsg(e,!0);D.Z.danger((0,v.ih)(n))}))},a.renderHistoryVersions=function(){var e=a.state,n=e.isLoading,t=e.historyGroups,i=e.errorMessage;return 0===t.length?n?(0,x.jsx)("div",{className:"h-100 w-100 d-flex align-items-center justify-content-center",children:(0,x.jsx)(y.Z,{})}):i?(0,x.jsx)("div",{className:"h-100 w-100 d-flex align-items-center justify-content-center error-message",children:(0,v.ih)(i)}):(0,x.jsx)("div",{className:"h-100 w-100 d-flex align-items-center justify-content-center empty-tip-color",children:(0,v.ih)("No version history")}):(0,x.jsxs)(x.Fragment,{children:[t.map((function(e,n){return(0,x.jsxs)(c.Fragment,{children:[(0,x.jsx)("div",{className:"history-list-item history-month-title",children:e.month},e.month),e.children.map((function(e,t){var i=e.children,s=e.showDaily;return(s?i:i.slice(0,1)).map((function(e,i){return(0,x.jsx)(L,{path:[n,t,i],showDaily:0===i&&s,currentVersion:a.props.currentVersion,historyVersion:e,onSelectHistoryVersion:a.onSelectHistoryVersion,onRestore:a.restoreVersion,onCopy:a.copyHistoryFile,renameHistoryVersion:a.renameHistoryVersion,showDailyHistory:a.showDailyHistory},e.commit_id)}))})).flat()]},e.month)})),n&&(0,x.jsx)("div",{className:"loading-more d-flex align-items-center justify-content-center w-100",children:(0,x.jsx)(y.Z,{})})]})},a.onShowChanges=function(){var e,n=a.props,t=n.isShowChanges,i=n.currentVersion,s=a.state.historyGroups,o=!t;if(o){var r=i.date,c=p()(r),l=c.format("YYYY-MM"),h=c.format("YYYY-MM-DD"),d=s.findIndex((function(e){return e.month===l})),u=s[d].children.findIndex((function(e){return e.day===h})),f=s[d].children[u].children.findIndex((function(e){return e.date===r}));e=P([d,u,f],o,a.state.historyGroups)}a.props.onShowChanges(o,e)};var r=e.sidePanelInitData;return a.state={isLoading:null===(o=r.isLoading)||void 0===o||o,historyGroups:r.historyGroups||[],errorMessage:r.errorMessage||"",hasMore:r.hasMore||!1,isReloadingData:!1},a.currentPage=1,a}return(0,o.Z)(t,[{key:"formatHistories",value:function(e){var n=this.state.historyGroups;if(!Array.isArray(e)||0===e.length)return n;var t=n.slice(0);return e.forEach((function(e){var n=e.date,i=p()(n),s=i.format("YYYY-MM"),o=t.find((function(e){return e.month===s}));o?o.children.push({day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}):t.push({month:s,children:[{day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}]})})),t}},{key:"updateResultState",value:function(e){var n=e.histories.length;this.setState({historyGroups:this.formatHistories(e.histories),hasMore:n>=v.LZ,isLoading:!1})}},{key:"render",value:function(){var e=this.state.historyGroups;return(0,x.jsxs)("div",{className:"sdoc-file-history-panel d-flex flex-column",children:[(0,x.jsxs)("div",{className:"sdoc-file-history-select-range",children:[(0,x.jsx)("div",{className:"sdoc-file-history-select-range-title",children:(0,v.ih)("History Versions")}),(0,x.jsx)("div",{className:"sdoc-side-panel-close",children:(0,x.jsx)("i",{className:"sf3-font sf3-font-close",onClick:this.props.onClose})})]}),(0,x.jsx)("div",{className:u()("sdoc-file-history-versions",{"o-hidden":0===e.length}),onScroll:this.onScrollHandler,children:this.renderHistoryVersions()}),(0,x.jsx)("div",{className:"sdoc-file-history-diff-switch d-flex align-items-center",children:(0,x.jsx)(Y.Z,{checked:this.props.isShowChanges,placeholder:(0,v.ih)("Show changes"),className:"sdoc-history-show-changes w-100",size:"small",onChange:this.onShowChanges})})]})}}]),t}(c.Component),G=(t(54890),window.app.config),O=G.serviceURL,F=G.avatarURL,U=G.siteRoot,A=window.app.pageOptions,B=A.username,q=A.name,K=window.fileHistory.pageOptions,z=K.repoID,W=K.fileName,X=K.filePath,J=K.docUuid,Q=K.assetsUrl;window.seafile={repoID:z,docPath:X,docName:W,docUuid:J,isOpenSocket:!1,serviceUrl:O,name:q,username:B,avatarURL:F,siteRoot:U,assetsUrl:Q};var $=function(e){(0,a.Z)(t,e);var n=(0,r.Z)(t);function t(e){var i;(0,s.Z)(this,t),(i=n.call(this,e)).getInitContent=function(e){return e?{version:-1,children:[{id:e.id,type:"title",children:[{id:e.children[0].id,text:""}]}]}:i.getInitContentByPath()},i.getInitContentByPath=function(e){var n,t;return{version:-1,children:[{id:"1",type:"title",children:[{id:"2",text:e?null===(n=e.split("/"))||void 0===n||null===(t=n.pop())||void 0===t?void 0:t.slice(0,-5):""}]}]}},i.updateLastVersionContent=function(e,n,t){if(t)if("init"!==t)g.I.getFileRevision(v.y8,t.commit_id,t.path).then((function(e){return e.data?g.I.getFileContent(e.data):{data:""}})).then((function(n){var s=n.data,o=e.children[0],a=t&&!s?i.getInitContent(o):s;i.setContent(e,a)})).catch((function(n){var t=S.c.getErrorMsg(n,!0);D.Z.danger((0,v.ih)(t)),i.setContent(e,"")}));else{var s=e?i.getInitContent(e.children[0]):i.getInitContentByPath(n.path),o=e||i.getInitContentByPath(n.path);i.setContent(o,s)}else i.setContent(e,"")},i.onSelectHistoryVersion=function(e,n){i.setState({isLoading:!0,currentVersion:e}),g.I.getFileRevision(v.y8,e.commit_id,e.path).then((function(e){return g.I.getFileContent(e.data)})).then((function(t){var s=t.data;i.updateLastVersionContent(s,e,n)})).catch((function(e){var n=S.c.getErrorMsg(e,!0);D.Z.danger((0,v.ih)(n)),i.setContent("","")}))},i.setContent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";i.setState({currentVersionContent:e,lastVersionContent:n,isLoading:!1,changes:[],currentDiffIndex:0})},i.onShowChanges=function(e,n){if(e){var t=i.state,s=t.currentVersionContent,o=t.currentVersion;i.setState({isLoading:!0,isShowChanges:e},(function(){localStorage.setItem("seahub-sdoc-history-show-changes",e+""),i.updateLastVersionContent(s,o,n)}))}else i.setState({isLoading:!0,isShowChanges:e},(function(){i.setState({isLoading:!1,lastVersionContent:""},(function(){localStorage.setItem("seahub-sdoc-history-show-changes",e+"")}))}))},i.getTopLevelChanges=function(e){var n=[];return e.forEach((function(e){var t=document.querySelectorAll('[data-id="'.concat(e,'"]'))[0];if(!t)return[];for(;"true"!==(null===(i=t)||void 0===i||null===(s=i.dataset)||void 0===s?void 0:s.root);){var i,s,o;if(null===(o=t)||void 0===o||!o.parentNode||t instanceof Document)break;var a=t.parentNode;if(a instanceof Document)break;t=a}n.push(t.dataset.id)})),Array.from(new Set(n))},i.getMergedChanges=function(e,n){var t=[],i=[];return n.forEach((function(n){if(e.includes(n.id)){var i={id:n.id,value:n};t.push(i)}})),t.forEach((function(e){var n,t=null===(n=i[i.length-1])||void 0===n?void 0:n.value,s=e.value;null!==s&&void 0!==s&&s.add&&null!==t&&void 0!==t&&t.add||null!==s&&void 0!==s&&s.delete&&null!==t&&void 0!==t&&t.delete||i.push(e)})),i.map((function(e){return e.id}))},i.setDiffCount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{value:[],changes:[]},n=e.changes,t=e.value,s=i.getTopLevelChanges(n),o=i.getMergedChanges(s,t);i.setState({changes:o,currentDiffIndex:0})},i.jumpToElement=function(e){i.setState({currentDiffIndex:e},(function(){var e=i.state,n=e.currentDiffIndex,t=e.changes[n],s=document.querySelectorAll('[data-id="'.concat(t,'"]'))[0];s&&(i.historyContentRef.scrollTop=s.offsetTop-10)}))},i.lastChange=function(){var e=i.state,n=e.currentDiffIndex,t=e.changes;0!==n?i.jumpToElement(n-1):i.jumpToElement(t.length-1)},i.nextChange=function(){var e=i.state,n=e.currentDiffIndex;n!==e.changes.length-1?i.jumpToElement(n+1):i.jumpToElement(0)},i.changeSidePanelStatus=function(){i.setState({showSidePanel:!i.state.showSidePanel})},i.renderChangesTip=function(e){var n=e.onChangeSidePanelDisplay,t=i.state,s=t.isShowChanges,o=t.changes,a=t.currentDiffIndex;if(t.isLoading)return null;if(!s)return null;var r=o?o.length:0;return 0===r?(0,x.jsxs)("div",{className:"sdoc-file-history-header-right d-flex align-items-center",children:[(0,x.jsx)("div",{className:"sdoc-file-changes-container d-flex align-items-center pl-2 pr-2",children:(0,v.ih)("No changes")}),(0,x.jsx)("div",{className:"sdoc-file-changes-switch ml-4",children:(0,x.jsx)("i",{className:"sf3-font sf3-font-history",onClick:n})})]}):(0,x.jsxs)("div",{className:"sdoc-file-history-header-right d-flex align-items-center",children:[(0,x.jsxs)("div",{className:"sdoc-file-changes-container d-flex align-items-center",children:[(0,x.jsx)("div",{className:"sdoc-file-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2",children:"".concat((0,v.ih)("Changes")," ").concat(a+1,"/").concat(r)}),(0,x.jsx)("div",{className:"sdoc-file-changes-divider"}),(0,x.jsx)("div",{className:"sdoc-file-changes-last d-flex align-items-center justify-content-center",id:"sdoc-file-changes-last",onClick:i.lastChange,children:(0,x.jsx)("span",{className:"fas fa-chevron-up"})}),(0,x.jsx)("div",{className:"sdoc-file-changes-divider"}),(0,x.jsx)("div",{className:"sdoc-file-changes-next d-flex align-items-center justify-content-center",id:"sdoc-file-changes-next",onClick:i.nextChange,children:(0,x.jsx)("span",{className:"fas fa-chevron-down"})}),(0,x.jsx)(h.Z,{placement:"bottom",target:"sdoc-file-changes-last",delay:0,fade:!1,children:(0,v.ih)("Last modification")}),(0,x.jsx)(h.Z,{placement:"bottom",target:"sdoc-file-changes-next",delay:0,fade:!1,children:(0,v.ih)("Next modification")})]}),(0,x.jsx)("div",{className:"sdoc-file-changes-switch d-flex align-items-center justify-content-center ml-4",id:"sdoc-file-changes-panel-switch",onClick:i.changeSidePanelStatus,children:(0,x.jsx)("i",{className:"sf3-font sf3-font-history"})})]})};var o="false"!==localStorage.getItem("seahub-sdoc-history-show-changes");return i.state={isLoading:!0,isShowChanges:o,currentVersion:{},currentVersionContent:"",lastVersionContent:"",changes:[],currentDiffIndex:0,isMobile:S.t,sidePanelInitData:{},showSidePanel:!0},i}return(0,o.Z)(t,[{key:"componentDidMount",value:function(){this.firstLoadSdocHistory()}},{key:"formatHistories",value:function(e){var n=[];if(!Array.isArray(e)||0===e.length)return n;var t=n.slice(0);return e.forEach((function(e){var n=e.date,i=p()(n),s=i.format("YYYY-MM"),o=t.find((function(e){return e.month===s}));o?o.children.push({day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}):t.push({month:s,children:[{day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}]})})),t}},{key:"firstLoadSdocHistory",value:function(){var e=this;g.I.listSdocHistory(J,1,v.LZ).then((function(n){var t=n.data,s=t.histories.length,o=e.formatHistories(t.histories),a={historyGroups:o,hasMore:s>=v.LZ,isLoading:!1};if(e.setState({sidePanelInitData:a}),o.length>0){var r=e.state.isShowChanges;e.onSelectHistoryVersion.apply(e,(0,i.Z)(E([0,0,0],o,r)))}})).catch((function(n){var t="there has an error in server";throw e.setState({isLoading:false}),e.setState({sidePanelInitData:{isLoading:false,errorMessage:t}}),Error(t)}))}},{key:"render",value:function(){var e=this,n=this.state,t=n.currentVersion,i=n.isShowChanges,s=n.currentVersionContent,o=n.lastVersionContent,a=n.isLoading,r=n.isMobile,c=n.sidePanelInitData,l=n.showSidePanel;return(0,x.jsx)("div",{className:"sdoc-file-history d-flex ".concat(r?"mobile":""),children:(0,x.jsxs)("div",{className:"sdoc-file-history-container d-flex flex-column",children:[(0,x.jsxs)("div",{className:"sdoc-file-history-header pt-2 pb-2 pl-4 pr-4 d-flex justify-content-between w-100",children:[(0,x.jsxs)("div",{className:u()("sdoc-file-history-header-left d-flex align-items-center",{"pr-4":i}),children:[(0,x.jsx)(w,{}),(0,x.jsx)("div",{className:"file-name text-truncate",children:W})]}),this.renderChangesTip({onChangeSidePanelDisplay:this.changeSidePanelStatus})]}),(0,x.jsx)("div",{className:"sdoc-file-history-content d-flex",ref:function(n){return e.historyContentRef=n},children:a?(0,x.jsx)("div",{className:"sdoc-file-history-viewer d-flex align-items-center justify-content-center",children:(0,x.jsx)(y.Z,{})}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(f.ZX,{currentContent:s,lastContent:i?o:"",didMountCallback:this.setDiffCount}),l&&(0,x.jsx)(T,{isShowChanges:i,currentVersion:t,onSelectHistoryVersion:this.onSelectHistoryVersion,onShowChanges:this.onShowChanges,sidePanelInitData:c,onClose:this.changeSidePanelStatus})]})})]})})}}]),t}(c.Component);l.render((0,x.jsx)($,{}),document.getElementById("wrapper"))},23534:function(){}},function(e){e.O(0,[351],(function(){return n=28403,e(e.s=n);var n}));e.O()}]);