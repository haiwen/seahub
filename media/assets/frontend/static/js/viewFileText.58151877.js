"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[4263],{36971:function(t,e,n){var i=n(23029),a=n(92901),s=n(39874),r=n(85501),o=n(9950),c=n(17119),u=n(4086),p=n(40326),d=n(41689),v=n(49690),l=n(44513),f=n(97011),h=n(65604),S=(n(61610),n(44414)),g=window.app.pageOptions,P=g.err,m=g.fileExt,y=g.fileContent,A=g.repoID,k=g.filePath,w=g.fileName,C=g.canEditFile,x=g.username,F=function(t){function e(){return(0,i.A)(this,e),(0,s.A)(this,e,arguments)}return(0,r.A)(e,t),(0,a.A)(e,[{key:"render",value:function(){return P?(0,S.jsx)(l.A,{}):(0,S.jsx)("div",{className:"file-view-content flex-1 text-file-view",children:(0,S.jsx)(v.A,{fileExt:m,value:this.props.content,readOnly:!C,onChange:this.props.updateContent})})}}])}(o.Component),j=function(t){function e(t){var n;return(0,i.A)(this,e),(n=(0,s.A)(this,e,[t])).updateContent=function(t){n.setState({needSave:!0,content:t})},n.addParticipant=function(){f.e.addFileParticipants(A,k,[x]).then((function(t){200===t.status&&(n.isParticipant=!0,n.getParticipants())}))},n.getParticipants=function(){f.e.listFileParticipants(A,k).then((function(t){var e=t.data.participant_list;n.setState({participants:e}),e.length>0&&(n.isParticipant=e.every((function(t){return t.email==x})))}))},n.onParticipantsChange=function(){n.getParticipants()},n.saveFile=function(t){(t.ctrlKey||t.metaKey)&&"s"==t.key&&n.state.needSave&&(t.preventDefault(),n.onSave())},n.state={content:y,needSave:!1,isSaving:!1,participants:[]},n.onSave=n.onSave.bind(n),n.isParticipant=!1,n}return(0,r.A)(e,t),(0,a.A)(e,[{key:"onSave",value:function(){var t=this;this.isParticipant||this.addParticipant();var e=h.Aq.getDirName(k);return f.e.getUpdateLink(A,e).then((function(e){var n=e.data;return t.setState({isSaving:!0}),f.e.updateFile(n,k,w,t.state.content).then((function(){u.A.success((0,p.AP)("Successfully saved"),{duration:2}),t.setState({isSaving:!1,needSave:!1})}))}))}},{key:"componentDidMount",value:function(){this.getParticipants(),window.addEventListener("keydown",this.saveFile)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.saveFile)}},{key:"render",value:function(){return(0,S.jsx)(d.A,{content:(0,S.jsx)(F,{content:this.state.content,updateContent:this.updateContent}),isSaving:this.state.isSaving,needSave:this.state.needSave,onSave:this.onSave,participants:this.state.participants,onParticipantsChange:this.onParticipantsChange})}}])}(o.Component);c.render((0,S.jsx)(j,{}),document.getElementById("wrapper"))}},function(t){t.O(0,[4223],(function(){return e=36971,t(t.s=e);var e}));t.O()}]);