{"version":3,"sources":["../node_modules/unified/index.js","../node_modules/vfile/index.js","../node_modules/vfile/core.js","../node_modules/vfile/node_modules/is-buffer/index.js","utils/seafile-markdown2html.js","components/review-list-view/review-comments.js","components/review-list-view/review-comment-dialog.js","components/dialog/add-reviewer-dialog.js","pages/review/history-list.js","models/review-comment.js","draft.js","../node_modules/@seafile/seafile-editor/dist/utils/diff/compare-strings.js","../node_modules/@seafile/seafile-editor/dist/utils/diff/diff.js","../node_modules/@seafile/seafile-editor/dist/viewer/diff-viewer.js"],"names":["extend","require","bail","vfile","trough","string","plain","module","exports","unified","attachers","transformers","namespace","frozen","freezeIndex","processor","data","key","value","arguments","length","assertUnfrozen","own","call","freeze","use","settings","undefined","addPlugin","apply","Error","addList","addPreset","result","plugins","add","index","plugin","entry","find","push","slice","parse","doc","Parser","file","assertParser","newable","String","stringify","node","Compiler","assertCompiler","assertNode","compile","run","runSync","complete","done","assertDone","err","tree","process","processSync","destination","values","options","transformer","Infinity","cb","Promise","executor","resolve","reject","pipeline","hasOwnProperty","p","ctx","next","contents","keys","prototype","name","type","asyncName","VMessage","VFile","proto","message","reason","position","origin","filePath","this","path","fatal","messages","info","fail","warn","replace","buffer","toString","encoding","order","prop","history","cwd","indexOf","assertPart","part","sep","assertNonEmpty","assertPath","Object","defineProperty","get","set","dirname","join","basename","extname","ext","charAt","stem","obj","constructor","isBuffer","markdown","slug","breaks","remark2rehype","format","raw","xtend","toHTML","sanitize","gh","deepmerge","default","commonmark","allowDangerousHTML","config","schema","hast","ReviewComments","props","handleCommentChange","event","setState","comment","target","submitComment","state","trim","seafileAPI","postComment","draftRepoID","draftFilePath","then","listComments","catch","error","errMessage","Utils","getErrorMsg","toaster","danger","resolveComment","updateComment","id","res","editComment","commentID","newComment","toggleResolvedComment","showResolvedComment","deleteComment","onResizeMouseUp","inResizing","onResizeMouseDown","onResizeMouseMove","rate","nativeEvent","clientY","refs","clientHeight","commentFooterHeight","scrollToQuote","newIndex","oldIndex","quote","nextProps","commentsList","that","setTimeout","scrollTo","onResizeMove","className","onMouseMove","onMouseUp","ref","gettext","onChange","checked","style","height","map","item","onMouseDown","placeholder","clos","rows","warp","color","size","onClick","React","Component","CommentItem","toggleDropDownMenu","dropdownOpen","convertComment","toggleEditComment","editable","resolved","src","avatarUrl","alt","time","isOpen","toggle","userEmail","username","dangerouslySetInnerHTML","__html","ReviewCommentDialog","detail","JSON","onCommentAdded","setQuoteText","mdQuote","toggleCommentDialog","AddReviewerDialog","listReviewers","listDraftReviewers","draftID","reviewers","handleSelectChange","option","selectedOption","Options","addReviewers","reviewSelect","clearSelect","i","email","loading","errorMsg","addDraftReviewers","failed","success","deleteReviewer","reviewer","getAttribute","deleteDraftReviewer","newReviewers","user_email","toggleDialog","toggleAddReviewerDialog","onSelectChange","isMulti","disabled","error_msg","avatar_url","user_name","moment","locale","window","app","lang","HistoryList","preItem","currentItem","activeItem","onHistoryItemClick","onScroll","scrollHeight","scrollTop","totalReversionCount","perPage","currentPage","listFileHistoryRecords","currentHistoryList","assign","historyList","onHistoryListChange","arr","preItemIndex","ctime","creator_name","HistoryItem","parseZone","reviewComment","oldTime","Date","created_at","getTime","URL","findRange","ReactEditor","toSlateRange","toDOMNode","Draft","initialContent","draftStatus","draftFileExists","isLoading","isShowDiff","originFileExists","getFileDownloadLink","getFileContent","draftContent","draftOriginContent","hash","location","preItemFilePath","currentItemFilePath","currentCommitID","preCommitID","activeTab","total_count","commit_id","axios","all","getFileRevision","spread","res1","res2","content1","content2","setDiffViewerContent","draftOriginFilePath","getChangedNodes","dl0","siteRoot","draftPublishVersion","dl","originFileVersion","url","setURL","comments","forEach","addComment","e","stopPropagation","getQuote","isShowCommentDialog","getOriginRepoInfo","getRepoInfo","originRepoName","repo_name","getDraftInfo","getFileInfo","draftInfo","nodes","diffViewer","lastDiffState","diff_state","changedNodes","scrollToChangedNode","scroll","changeIndex","win","viewer","children","element","tagName","parentNode","scroller","findScrollContainer","document","body","documentElement","offsetTop","parent","OVERFLOWS","overflowY","getComputedStyle","includes","commentNode","showDiffViewer","scriptSource","mediaUrl","newMarkdownContent","oldMarkdownContent","onSwitchShowDiff","toggleDiffTip","showDiffTip","showReviewerDialog","showDiffButton","placement","onPublishDraft","publishDraft","draft_status","initialDiffViewerContent","content","newContent","prevContent","newurl","href","tabItemClick","tab","showNavItem","showTab","commentsNumber","classnames","active","getDomNodeByPath","querySelector","shift","setBtnPosition","nativeSelection","getSelection","rangeCount","nativeRange","getRangeAt","selection","commentbtn","top","Range","isCollapsed","range","focusNodePath","anchor","pop","focusNode","right","serialize","Editor","fragment","clientX","main","clientWidth","rightPartWidth","renderDiffButton","renderNavItems","tabs","renderContent","addEventListener","removeEventListener","draftLink","showPublishedButton","showPublishButton","filePermission","showEditButton","mtime","encodeURIComponent","last_modifier_email","draftFileName","last_modifier_name","title","width","tabId","changedNumber","SidePanelReviewers","SidePanelAuthor","authorAvatar","author","SidePanelOrigin","serviceURL","UnresolvedComments","unresolvedNumber","count","SidePanelChanges","ReactDOM","render","getElementById","compareTwoStrings","str1","str2","toUpperCase","pairs1","wordLetterPairs","pairs2","union","intersection","pair1","pair2","splice","flattenDeep","Array","isArray","reduce","a","b","concat","letterPairs","str","pairs","max","substring","split","equalityFunctionForSlate","lodash","isEqual","Text","isText","text","Node","defaultEqualityFunction","SlateDiff","_this","_classCallCheck","deepDiff","newNodes","oldNodes","equalFunc","depth","slateDiffNodes","nodeDepth","diff","Diff","ArrayDiff","diffElement","changeType","newItemData","new_index","old_index","node_depth","ADD","_newItemData","DELETE","_newItemData2","diffNodes","elementType","getTextDiff","newItem","oldItem","_newItemData3","getDiffDocument","deserialize","topSlateDiffNodes","splitTopDiffNodes","_createClass","newTextItem","oldTextItem","textNodes","textDiff","newText","oldText","marks","texts","StringDiff","textDiffArray","stringFragment","textCharacter","markType","_objectSpread","_defineProperty","diffParagraph","newParagraph","cloneDeep","oldParagraph","newParagraphNodes","oldParagraphNodes","index1","paragraph_state","_this2","newSlateDiffNodes","splicedParagraph","splitDiffParagraph","splitTableDiffParagraph","_this3","tableRow","rowIndex","tablerows","tableCell","splicedParagraphNodes","ArrayDiffElement","opts","shouldDetectChange","similarityFunc","added","removed","replaced","common","newString","oldString","newLength","oldLength","n","o","table","Math","addCommon","addAdded","addRemoved","newArray","oldArray","callback","diffState","addReplaced","DiffViewer","_React$PureComponent","_props","_possibleConstructorReturn","_getPrototypeOf","renderDiffNode","createElement","renderNode","slateDiff","_inherits","LoadScript","SlateViewer","renderDiffElement","renderDiffLeaf","renderLeaf","PureComponent"],"mappings":"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","file":"static/js/draft.chunk.js","sourcesContent":["'use strict'\n\nvar extend = require('extend')\nvar bail = require('bail')\nvar vfile = require('vfile')\nvar trough = require('trough')\nvar string = require('x-is-string')\nvar plain = require('is-plain-obj')\n\n// Expose a frozen processor.\nmodule.exports = unified().freeze()\n\nvar slice = [].slice\nvar own = {}.hasOwnProperty\n\n// Process pipeline.\nvar pipeline = trough()\n  .use(pipelineParse)\n  .use(pipelineRun)\n  .use(pipelineStringify)\n\nfunction pipelineParse(p, ctx) {\n  ctx.tree = p.parse(ctx.file)\n}\n\nfunction pipelineRun(p, ctx, next) {\n  p.run(ctx.tree, ctx.file, done)\n\n  function done(err, tree, file) {\n    if (err) {\n      next(err)\n    } else {\n      ctx.tree = tree\n      ctx.file = file\n      next()\n    }\n  }\n}\n\nfunction pipelineStringify(p, ctx) {\n  ctx.file.contents = p.stringify(ctx.tree, ctx.file)\n}\n\n// Function to create the first processor.\nfunction unified() {\n  var attachers = []\n  var transformers = trough()\n  var namespace = {}\n  var frozen = false\n  var freezeIndex = -1\n\n  // Data management.\n  processor.data = data\n\n  // Lock.\n  processor.freeze = freeze\n\n  // Plugins.\n  processor.attachers = attachers\n  processor.use = use\n\n  // API.\n  processor.parse = parse\n  processor.stringify = stringify\n  processor.run = run\n  processor.runSync = runSync\n  processor.process = process\n  processor.processSync = processSync\n\n  // Expose.\n  return processor\n\n  // Create a new processor based on the processor in the current scope.\n  function processor() {\n    var destination = unified()\n    var length = attachers.length\n    var index = -1\n\n    while (++index < length) {\n      destination.use.apply(null, attachers[index])\n    }\n\n    destination.data(extend(true, {}, namespace))\n\n    return destination\n  }\n\n  // Freeze: used to signal a processor that has finished configuration.\n  //\n  // For example, take unified itself.  Its frozen.  Plugins should not be\n  // added to it.  Rather, it should be extended, by invoking it, before\n  // modifying it.\n  //\n  // In essence, always invoke this when exporting a processor.\n  function freeze() {\n    var values\n    var plugin\n    var options\n    var transformer\n\n    if (frozen) {\n      return processor\n    }\n\n    while (++freezeIndex < attachers.length) {\n      values = attachers[freezeIndex]\n      plugin = values[0]\n      options = values[1]\n      transformer = null\n\n      if (options === false) {\n        continue\n      }\n\n      if (options === true) {\n        values[1] = undefined\n      }\n\n      transformer = plugin.apply(processor, values.slice(1))\n\n      if (typeof transformer === 'function') {\n        transformers.use(transformer)\n      }\n    }\n\n    frozen = true\n    freezeIndex = Infinity\n\n    return processor\n  }\n\n  // Data management.  Getter / setter for processor-specific informtion.\n  function data(key, value) {\n    if (string(key)) {\n      // Set `key`.\n      if (arguments.length === 2) {\n        assertUnfrozen('data', frozen)\n\n        namespace[key] = value\n\n        return processor\n      }\n\n      // Get `key`.\n      return (own.call(namespace, key) && namespace[key]) || null\n    }\n\n    // Set space.\n    if (key) {\n      assertUnfrozen('data', frozen)\n      namespace = key\n      return processor\n    }\n\n    // Get space.\n    return namespace\n  }\n\n  // Plugin management.\n  //\n  // Pass it:\n  // *   an attacher and options,\n  // *   a preset,\n  // *   a list of presets, attachers, and arguments (list of attachers and\n  //     options).\n  function use(value) {\n    var settings\n\n    assertUnfrozen('use', frozen)\n\n    if (value === null || value === undefined) {\n      // Empty.\n    } else if (typeof value === 'function') {\n      addPlugin.apply(null, arguments)\n    } else if (typeof value === 'object') {\n      if ('length' in value) {\n        addList(value)\n      } else {\n        addPreset(value)\n      }\n    } else {\n      throw new Error('Expected usable value, not `' + value + '`')\n    }\n\n    if (settings) {\n      namespace.settings = extend(namespace.settings || {}, settings)\n    }\n\n    return processor\n\n    function addPreset(result) {\n      addList(result.plugins)\n\n      if (result.settings) {\n        settings = extend(settings || {}, result.settings)\n      }\n    }\n\n    function add(value) {\n      if (typeof value === 'function') {\n        addPlugin(value)\n      } else if (typeof value === 'object') {\n        if ('length' in value) {\n          addPlugin.apply(null, value)\n        } else {\n          addPreset(value)\n        }\n      } else {\n        throw new Error('Expected usable value, not `' + value + '`')\n      }\n    }\n\n    function addList(plugins) {\n      var length\n      var index\n\n      if (plugins === null || plugins === undefined) {\n        // Empty.\n      } else if (typeof plugins === 'object' && 'length' in plugins) {\n        length = plugins.length\n        index = -1\n\n        while (++index < length) {\n          add(plugins[index])\n        }\n      } else {\n        throw new Error('Expected a list of plugins, not `' + plugins + '`')\n      }\n    }\n\n    function addPlugin(plugin, value) {\n      var entry = find(plugin)\n\n      if (entry) {\n        if (plain(entry[1]) && plain(value)) {\n          value = extend(entry[1], value)\n        }\n\n        entry[1] = value\n      } else {\n        attachers.push(slice.call(arguments))\n      }\n    }\n  }\n\n  function find(plugin) {\n    var length = attachers.length\n    var index = -1\n    var entry\n\n    while (++index < length) {\n      entry = attachers[index]\n\n      if (entry[0] === plugin) {\n        return entry\n      }\n    }\n  }\n\n  // Parse a file (in string or vfile representation) into a unist node using\n  // the `Parser` on the processor.\n  function parse(doc) {\n    var file = vfile(doc)\n    var Parser\n\n    freeze()\n    Parser = processor.Parser\n    assertParser('parse', Parser)\n\n    if (newable(Parser)) {\n      return new Parser(String(file), file).parse()\n    }\n\n    return Parser(String(file), file) // eslint-disable-line new-cap\n  }\n\n  // Run transforms on a unist node representation of a file (in string or\n  // vfile representation), async.\n  function run(node, file, cb) {\n    assertNode(node)\n    freeze()\n\n    if (!cb && typeof file === 'function') {\n      cb = file\n      file = null\n    }\n\n    if (!cb) {\n      return new Promise(executor)\n    }\n\n    executor(null, cb)\n\n    function executor(resolve, reject) {\n      transformers.run(node, vfile(file), done)\n\n      function done(err, tree, file) {\n        tree = tree || node\n        if (err) {\n          reject(err)\n        } else if (resolve) {\n          resolve(tree)\n        } else {\n          cb(null, tree, file)\n        }\n      }\n    }\n  }\n\n  // Run transforms on a unist node representation of a file (in string or\n  // vfile representation), sync.\n  function runSync(node, file) {\n    var complete = false\n    var result\n\n    run(node, file, done)\n\n    assertDone('runSync', 'run', complete)\n\n    return result\n\n    function done(err, tree) {\n      complete = true\n      bail(err)\n      result = tree\n    }\n  }\n\n  // Stringify a unist node representation of a file (in string or vfile\n  // representation) into a string using the `Compiler` on the processor.\n  function stringify(node, doc) {\n    var file = vfile(doc)\n    var Compiler\n\n    freeze()\n    Compiler = processor.Compiler\n    assertCompiler('stringify', Compiler)\n    assertNode(node)\n\n    if (newable(Compiler)) {\n      return new Compiler(node, file).compile()\n    }\n\n    return Compiler(node, file) // eslint-disable-line new-cap\n  }\n\n  // Parse a file (in string or vfile representation) into a unist node using\n  // the `Parser` on the processor, then run transforms on that node, and\n  // compile the resulting node using the `Compiler` on the processor, and\n  // store that result on the vfile.\n  function process(doc, cb) {\n    freeze()\n    assertParser('process', processor.Parser)\n    assertCompiler('process', processor.Compiler)\n\n    if (!cb) {\n      return new Promise(executor)\n    }\n\n    executor(null, cb)\n\n    function executor(resolve, reject) {\n      var file = vfile(doc)\n\n      pipeline.run(processor, {file: file}, done)\n\n      function done(err) {\n        if (err) {\n          reject(err)\n        } else if (resolve) {\n          resolve(file)\n        } else {\n          cb(null, file)\n        }\n      }\n    }\n  }\n\n  // Process the given document (in string or vfile representation), sync.\n  function processSync(doc) {\n    var complete = false\n    var file\n\n    freeze()\n    assertParser('processSync', processor.Parser)\n    assertCompiler('processSync', processor.Compiler)\n    file = vfile(doc)\n\n    process(file, done)\n\n    assertDone('processSync', 'process', complete)\n\n    return file\n\n    function done(err) {\n      complete = true\n      bail(err)\n    }\n  }\n}\n\n// Check if `func` is a constructor.\nfunction newable(value) {\n  return typeof value === 'function' && keys(value.prototype)\n}\n\n// Check if `value` is an object with keys.\nfunction keys(value) {\n  var key\n  for (key in value) {\n    return true\n  }\n  return false\n}\n\n// Assert a parser is available.\nfunction assertParser(name, Parser) {\n  if (typeof Parser !== 'function') {\n    throw new Error('Cannot `' + name + '` without `Parser`')\n  }\n}\n\n// Assert a compiler is available.\nfunction assertCompiler(name, Compiler) {\n  if (typeof Compiler !== 'function') {\n    throw new Error('Cannot `' + name + '` without `Compiler`')\n  }\n}\n\n// Assert the processor is not frozen.\nfunction assertUnfrozen(name, frozen) {\n  if (frozen) {\n    throw new Error(\n      'Cannot invoke `' +\n        name +\n        '` on a frozen processor.\\nCreate a new processor first, by invoking it: use `processor()` instead of `processor`.'\n    )\n  }\n}\n\n// Assert `node` is a unist node.\nfunction assertNode(node) {\n  if (!node || !string(node.type)) {\n    throw new Error('Expected node, got `' + node + '`')\n  }\n}\n\n// Assert that `complete` is `true`.\nfunction assertDone(name, asyncName, complete) {\n  if (!complete) {\n    throw new Error(\n      '`' + name + '` finished async. Use `' + asyncName + '` instead'\n    )\n  }\n}\n","'use strict'\n\nvar VMessage = require('vfile-message')\nvar VFile = require('./core.js')\n\nmodule.exports = VFile\n\nvar proto = VFile.prototype\n\nproto.message = message\nproto.info = info\nproto.fail = fail\n\n// Slight backwards compatibility.  Remove in the future.\nproto.warn = message\n\n// Create a message with `reason` at `position`.  When an error is passed in as\n// `reason`, copies the stack.\nfunction message(reason, position, origin) {\n  var filePath = this.path\n  var message = new VMessage(reason, position, origin)\n\n  if (filePath) {\n    message.name = filePath + ':' + message.name\n    message.file = filePath\n  }\n\n  message.fatal = false\n\n  this.messages.push(message)\n\n  return message\n}\n\n// Fail.  Creates a vmessage, associates it with the file, and throws it.\nfunction fail() {\n  var message = this.message.apply(this, arguments)\n\n  message.fatal = true\n\n  throw message\n}\n\n// Info.  Creates a vmessage, associates it with the file, and marks the\n// fatality as null.\nfunction info() {\n  var message = this.message.apply(this, arguments)\n\n  message.fatal = null\n\n  return message\n}\n","'use strict'\n\nvar path = require('path')\nvar replace = require('replace-ext')\nvar buffer = require('is-buffer')\n\nmodule.exports = VFile\n\nvar own = {}.hasOwnProperty\nvar proto = VFile.prototype\n\nproto.toString = toString\n\n// Order of setting (least specific to most), we need this because otherwise\n// `{stem: 'a', path: '~/b.js'}` would throw, as a path is needed before a\n// stem can be set.\nvar order = ['history', 'path', 'basename', 'stem', 'extname', 'dirname']\n\n// Construct a new file.\nfunction VFile(options) {\n  var prop\n  var index\n  var length\n\n  if (!options) {\n    options = {}\n  } else if (typeof options === 'string' || buffer(options)) {\n    options = {contents: options}\n  } else if ('message' in options && 'messages' in options) {\n    return options\n  }\n\n  if (!(this instanceof VFile)) {\n    return new VFile(options)\n  }\n\n  this.data = {}\n  this.messages = []\n  this.history = []\n  this.cwd = process.cwd()\n\n  // Set path related properties in the correct order.\n  index = -1\n  length = order.length\n\n  while (++index < length) {\n    prop = order[index]\n\n    if (own.call(options, prop)) {\n      this[prop] = options[prop]\n    }\n  }\n\n  // Set non-path related properties.\n  for (prop in options) {\n    if (order.indexOf(prop) === -1) {\n      this[prop] = options[prop]\n    }\n  }\n}\n\n// Access full path (`~/index.min.js`).\nObject.defineProperty(proto, 'path', {\n  get: function() {\n    return this.history[this.history.length - 1]\n  },\n  set: function(path) {\n    assertNonEmpty(path, 'path')\n\n    if (path !== this.path) {\n      this.history.push(path)\n    }\n  }\n})\n\n// Access parent path (`~`).\nObject.defineProperty(proto, 'dirname', {\n  get: function() {\n    return typeof this.path === 'string' ? path.dirname(this.path) : undefined\n  },\n  set: function(dirname) {\n    assertPath(this.path, 'dirname')\n    this.path = path.join(dirname || '', this.basename)\n  }\n})\n\n// Access basename (`index.min.js`).\nObject.defineProperty(proto, 'basename', {\n  get: function() {\n    return typeof this.path === 'string' ? path.basename(this.path) : undefined\n  },\n  set: function(basename) {\n    assertNonEmpty(basename, 'basename')\n    assertPart(basename, 'basename')\n    this.path = path.join(this.dirname || '', basename)\n  }\n})\n\n// Access extname (`.js`).\nObject.defineProperty(proto, 'extname', {\n  get: function() {\n    return typeof this.path === 'string' ? path.extname(this.path) : undefined\n  },\n  set: function(extname) {\n    var ext = extname || ''\n\n    assertPart(ext, 'extname')\n    assertPath(this.path, 'extname')\n\n    if (ext) {\n      if (ext.charAt(0) !== '.') {\n        throw new Error('`extname` must start with `.`')\n      }\n\n      if (ext.indexOf('.', 1) !== -1) {\n        throw new Error('`extname` cannot contain multiple dots')\n      }\n    }\n\n    this.path = replace(this.path, ext)\n  }\n})\n\n// Access stem (`index.min`).\nObject.defineProperty(proto, 'stem', {\n  get: function() {\n    return typeof this.path === 'string'\n      ? path.basename(this.path, this.extname)\n      : undefined\n  },\n  set: function(stem) {\n    assertNonEmpty(stem, 'stem')\n    assertPart(stem, 'stem')\n    this.path = path.join(this.dirname || '', stem + (this.extname || ''))\n  }\n})\n\n// Get the value of the file.\nfunction toString(encoding) {\n  var value = this.contents || ''\n  return buffer(value) ? value.toString(encoding) : String(value)\n}\n\n// Assert that `part` is not a path (i.e., does not contain `path.sep`).\nfunction assertPart(part, name) {\n  if (part.indexOf(path.sep) !== -1) {\n    throw new Error(\n      '`' + name + '` cannot be a path: did not expect `' + path.sep + '`'\n    )\n  }\n}\n\n// Assert that `part` is not empty.\nfunction assertNonEmpty(part, name) {\n  if (!part) {\n    throw new Error('`' + name + '` cannot be empty')\n  }\n}\n\n// Assert `path` exists.\nfunction assertPath(path, name) {\n  if (!path) {\n    throw new Error('Setting `' + name + '` requires `path` to be set too')\n  }\n}\n","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\nmodule.exports = function isBuffer (obj) {\n  return obj != null && obj.constructor != null &&\n    typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n","var unified = require('unified');\nvar markdown = require('remark-parse');\nvar slug = require('remark-slug');\nvar breaks = require('remark-breaks');\nvar remark2rehype = require('remark-rehype');\nvar format = require('rehype-format');\nvar raw = require('rehype-raw');\nvar xtend = require('xtend');\nvar toHTML = require('hast-util-to-html');\nvar sanitize = require('hast-util-sanitize');\nvar gh = require('hast-util-sanitize/lib/github');\nvar deepmerge = require('deepmerge').default;\n\nfunction stringify(config) {\n  var settings = xtend(config, this.data('settings'));\n  var schema = deepmerge(gh, {\n    'attributes': {\n      'input': [\n        'type',\n      ],\n      'li': [\n        'className'\n      ],\n      'code': [\n        'className',\n      ],\n    },\n    'tagNames': [\n      'input',\n      'code'\n    ]\n  });\n  this.Compiler = compiler;\n\n  function compiler(tree) {\n    // use sanity to remove dangerous html, the default is\n    var hast = sanitize(tree, schema);\n    return toHTML(hast, settings);\n  }\n}\n\n// markdown -> mdast -> html AST -> html\nvar processor = unified()\n  .use(markdown, {commonmark: true})\n  .use(breaks)\n  .use(slug)\n  .use(remark2rehype, {allowDangerousHTML: true})\n  .use(raw)\n  .use(format)\n  .use(stringify);\n\nvar processorGetAST = unified()\n  .use(markdown, {commonmark: true})\n  .use(slug);\n\nexport { processor, processorGetAST };\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { processor } from '../../utils/seafile-markdown2html';\nimport { Button, Dropdown, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext, draftFilePath, draftRepoID } from '../../utils/constants';\nimport { username } from '../../utils/constants.js';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\n\nimport '../../css/review-comments.css';\n\nconst commentPropTypes = {\n  listComments: PropTypes.func.isRequired,\n  inResizing: PropTypes.bool.isRequired,\n  commentsList: PropTypes.array.isRequired,\n  scrollToQuote: PropTypes.func.isRequired\n};\n\nclass ReviewComments extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      inResizing: false,\n      commentFooterHeight: 25,\n      showResolvedComment: true,\n      comment: '',\n    };\n  }\n\n  handleCommentChange = (event) => {\n    this.setState({ comment: event.target.value });\n  }\n\n  submitComment = () => {\n    let comment = this.state.comment.trim();\n    if (comment.length > 0) {\n      seafileAPI.postComment(draftRepoID, draftFilePath, comment).then(() => {\n        this.props.listComments();\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n      this.setState({ comment: '' });\n    }\n  }\n\n  resolveComment = (event) => {\n    seafileAPI.updateComment(draftRepoID, event.target.id, 'true').then((res) => {\n      this.props.listComments();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  editComment = (commentID, newComment) => {\n    seafileAPI.updateComment(draftRepoID, commentID, null, null, newComment).then((res) => {\n      this.props.listComments();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  toggleResolvedComment = () => {\n    this.setState({ showResolvedComment: !this.state.showResolvedComment });\n  }\n\n  deleteComment = (event) => {\n    seafileAPI.deleteComment(draftRepoID, event.target.id).then((res) => {\n      this.props.listComments();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  onResizeMouseUp = () => {\n    if (this.state.inResizing) {\n      this.setState({ inResizing: false });\n    }\n  }\n\n  onResizeMouseDown = () => {\n    this.setState({ inResizing: true });\n  };\n\n  onResizeMouseMove = (event) => {\n    let rate = 100 - (event.nativeEvent.clientY - 120 ) / this.refs.comment.clientHeight * 100;\n    if (rate < 20 || rate > 70) {\n      if (rate < 20) {\n        this.setState({ commentFooterHeight: 25 });\n      }\n      if (rate > 70) {\n        this.setState({ commentFooterHeight: 65 });\n      }\n      this.setState({ inResizing: false });\n      return null;\n    }\n    this.setState({ commentFooterHeight: rate });\n  };\n\n  scrollToQuote = (newIndex, oldIndex, quote) => {\n    this.props.scrollToQuote(newIndex, oldIndex, quote);\n    this.setState({ comment: '' });\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.commentsList.length < nextProps.commentsList.length) {\n      let that = this;\n      setTimeout(() => {\n        that.refs.commentsList.scrollTo(0, 10000);\n      }, 100);\n    }\n  }\n\n  render() {\n    const onResizeMove = this.state.inResizing ? this.onResizeMouseMove : null;\n    const { commentsList } = this.props;\n    return (\n      <div className={(this.state.inResizing || this.props.inResizing)?\n        'seafile-comment seafile-comment-resizing' : 'seafile-comment'}\n      onMouseMove={onResizeMove} onMouseUp={this.onResizeMouseUp} ref=\"comment\">\n        <div className=\"seafile-comment-title\">\n          <div className={'seafile-comment-title-text'}>{gettext('Show resolved comments')}</div>\n          <div className={'seafile-comment-title-toggle'}>\n            <label className=\"custom-switch\" id=\"toggle-resolved-comments\">\n              <input type=\"checkbox\" name=\"option\" className=\"custom-switch-input\"\n                onChange={this.toggleResolvedComment}\n                checked={this.state.showResolvedComment && 'checked'}\n              />\n              <span className=\"custom-switch-indicator\"></span>\n            </label>\n          </div>\n        </div>\n        <div style={{height:(100 - this.state.commentFooterHeight)+'%'}}>\n          {commentsList.length === 0 &&\n            <div className=\"seafile-comment-list\">\n              <div className=\"comment-vacant\">{gettext('No comment yet.')}</div>\n            </div>\n          }\n          <ul className=\"seafile-comment-list\" ref='commentsList'>\n            {(commentsList.length > 0) &&\n              commentsList.map((item, index) => {\n                return (\n                  <CommentItem\n                    item={item}\n                    key={index}\n                    showResolvedComment={this.state.showResolvedComment}\n                    resolveComment={this.resolveComment}\n                    editComment={this.editComment}\n                    scrollToQuote={this.scrollToQuote}\n                    deleteComment={this.deleteComment}\n                  />\n                );\n              })\n            }\n          </ul>\n        </div>\n        <div className=\"seafile-comment-footer\" style={{height:this.state.commentFooterHeight+'%'}}>\n          <div className=\"seafile-comment-row-resize\" onMouseDown={this.onResizeMouseDown}></div>\n          <div className=\"seafile-add-comment\">\n            <textarea\n              className=\"add-comment-input\"\n              value={this.state.comment}\n              placeholder={gettext('Add a comment.')}\n              onChange={this.handleCommentChange}\n              clos=\"100\" rows=\"3\" warp=\"virtual\"\n            ></textarea>\n            <Button className=\"comment-btn\" color=\"primary\" size=\"sm\" onClick={this.submitComment}>{gettext('Submit')}</Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReviewComments.propTypes = commentPropTypes;\n\nconst commentItemPropTypes = {\n  item: PropTypes.object.isRequired,\n  deleteComment: PropTypes.func.isRequired,\n  resolveComment: PropTypes.func.isRequired,\n  editComment: PropTypes.func.isRequired,\n  showResolvedComment: PropTypes.bool.isRequired,\n  scrollToQuote: PropTypes.func.isRequired\n};\n\nclass CommentItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      dropdownOpen: false,\n      comment: '',\n      quote: '',\n      newComment: this.props.item.comment,\n      editable: false,\n    };\n  }\n\n  toggleDropDownMenu = () => {\n    this.setState({ dropdownOpen: !this.state.dropdownOpen });\n  }\n\n  convertComment = (item) => {\n    processor.process(item.comment).then((result) => {\n      let comment = String(result);\n      this.setState({ comment: comment });\n    });\n    processor.process(item.quote).then((result) => {\n      let quote = String(result);\n      this.setState({ quote: quote });\n    });\n  }\n\n  scrollToQuote = () => {\n    const item = this.props.item;\n    this.props.scrollToQuote(item.newIndex, item.oldIndex, item.quote);\n  }\n\n  toggleEditComment = () => {\n    this.setState({ editable: !this.state.editable });\n  }\n\n  updateComment = (event) => {\n    const newComment = this.state.newComment;\n    if (this.props.item.comment !== newComment) {\n      this.props.editComment(event.target.id, newComment);\n    }\n    this.toggleEditComment();\n  }\n\n  handleCommentChange = (event) => {\n    this.setState({ newComment: event.target.value });\n  }\n\n  componentWillMount() {\n    this.convertComment(this.props.item);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.convertComment(nextProps.item);\n  }\n\n  render() {\n    const item = this.props.item;\n    if (item.resolved && !this.props.showResolvedComment) return null;\n    if (this.state.editable) {\n      return(\n        <li className=\"seafile-comment-item\" id={item.id}>\n          <div className=\"seafile-comment-info\">\n            <img className=\"avatar\" src={item.avatarUrl} alt=\"\"/>\n            <div className=\"reviewer-info\">\n              <div className=\"reviewer-name ellipsis\">{item.name}</div>\n              <div className=\"review-time\">{item.time}</div>\n            </div>\n          </div>\n          <div className=\"seafile-edit-comment\">\n            <textarea\n              className=\"edit-comment-input\"\n              value={this.state.newComment}\n              onChange={this.handleCommentChange}\n              clos=\"100\" rows=\"3\" warp=\"virtual\"\n            ></textarea>\n            <Button className=\"comment-btn\" color=\"primary\" size=\"sm\" onClick={this.updateComment} id={item.id}>\n              {gettext('Update')}</Button>{' '}\n            <Button className=\"comment-btn\" color=\"secondary\" size=\"sm\" onClick={this.toggleEditComment}>\n              {gettext('Cancel')}</Button>\n          </div>\n        </li>\n      );\n    }\n    return (\n      <li className={item.resolved ? 'seafile-comment-item seafile-comment-item-resolved'\n        : 'seafile-comment-item'} id={item.id}>\n        <div className=\"seafile-comment-info\">\n          <img className=\"avatar\" src={item.avatarUrl} alt=\"\"/>\n          <div className=\"reviewer-info\">\n            <div className=\"reviewer-name ellipsis\">{item.name}</div>\n            <div className=\"review-time\">{item.time}</div>\n          </div>\n          {!item.resolved &&\n            <Dropdown isOpen={this.state.dropdownOpen} size=\"sm\"\n              className=\"seafile-comment-dropdown\" toggle={this.toggleDropDownMenu}>\n              <DropdownToggle className=\"seafile-comment-dropdown-btn\">\n                <i className=\"fas fa-ellipsis-v\"></i>\n              </DropdownToggle>\n              <DropdownMenu>\n                {(item.userEmail === username) &&\n                  <DropdownItem onClick={this.props.deleteComment}\n                    className=\"delete-comment\" id={item.id}>{gettext('Delete')}</DropdownItem>}\n                {(item.userEmail === username) &&\n                  <DropdownItem onClick={this.toggleEditComment}\n                    className=\"edit-comment\" id={item.id}>{gettext('Edit')}</DropdownItem>}\n                <DropdownItem onClick={this.props.resolveComment}\n                  className=\"seafile-comment-resolved\" id={item.id}>{gettext('Mark as resolved')}</DropdownItem>\n              </DropdownMenu>\n            </Dropdown>\n          }\n        </div>\n        {(item.newIndex >= -1 && item.oldIndex >= -1) &&\n          <blockquote className=\"seafile-comment-content\">\n            <div onClick={this.scrollToQuote} dangerouslySetInnerHTML={{ __html: this.state.quote }}></div>\n          </blockquote>\n        }\n        <div className=\"seafile-comment-content\" dangerouslySetInnerHTML={{ __html: this.state.comment }}></div>\n      </li>\n    );\n  }\n}\n\nCommentItem.propTypes = commentItemPropTypes;\n\nexport default ReviewComments;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Button } from 'reactstrap';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext, name, draftRepoID, draftFilePath } from '../../utils/constants';\nimport { processor } from '../../utils/seafile-markdown2html';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\n\nimport '../../css/review-comment-dialog.css';\n\nconst commentDialogPropTypes = {\n  onCommentAdded: PropTypes.func.isRequired,\n  toggleCommentDialog: PropTypes.func.isRequired,\n  quote: PropTypes.string,\n  newIndex: PropTypes.number,\n  oldIndex: PropTypes.number,\n};\n\nclass ReviewCommentDialog extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      comment: '',\n      quote: '',\n    };\n  }\n\n  handleCommentChange = (event) => {\n    let comment = event.target.value;\n    this.setState({ comment: comment });\n  }\n\n  submitComment = () => {\n    const { quote, newIndex, oldIndex } = this.props;\n    const comment = this.state.comment.trim();\n    if (comment.length === 0) return;\n    if (quote.length > 0) {\n      let detail = {\n        quote: quote,\n        newIndex: newIndex,\n        oldIndex: oldIndex\n      };\n      seafileAPI.postComment(draftRepoID, draftFilePath, comment, JSON.stringify(detail)).then(() => {\n        this.props.onCommentAdded();\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    } else {\n      seafileAPI.postComment(draftRepoID, draftFilePath, comment).then(() => {\n        this.props.onCommentAdded();\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    }\n    this.setState({ comment: '' });\n  }\n\n  setQuoteText = (mdQuote) => {\n    processor.process(mdQuote).then(\n      (result) => {\n        let quote = String(result);\n        this.setState({ quote: quote });\n      }\n    );\n  }\n\n  componentDidMount() {\n    this.setQuoteText(this.props.quote);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.quote !== nextProps.quote) {\n      this.setQuoteText(nextProps.quote);\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"review-comment-dialog\">\n        <div>{name}</div>\n        <blockquote className=\"review-comment-dialog-quote\">\n          <div dangerouslySetInnerHTML={{ __html: this.state.quote}}></div>\n        </blockquote>\n        <textarea value={this.state.comment} onChange={this.handleCommentChange}></textarea>\n        <div className=\"button-group\">\n          <Button size=\"sm\" color=\"primary\" onClick={this.submitComment}>{gettext('Submit')}</Button>\n          <Button size=\"sm\" color=\"secondary\" onClick={this.props.toggleCommentDialog}>{gettext('Cancel')}</Button>\n        </div>\n        <span className=\"review-comment-dialog-triangle\"></span>\n      </div>\n    );\n  }\n}\n\nReviewCommentDialog.propTypes = commentDialogPropTypes;\n\nexport default ReviewCommentDialog;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext } from '../../utils/constants';\nimport { Button, Modal, ModalHeader, ModalBody, ModalFooter } from 'reactstrap';\nimport { seafileAPI } from '../../utils/seafile-api.js';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\nimport UserSelect from '../user-select.js';\nimport '../../css/add-reviewer-dialog.css';\n\nconst propTypes = {\n  showReviewerDialog: PropTypes.bool.isRequired,\n  draftID: PropTypes.string.isRequired,\n  toggleAddReviewerDialog: PropTypes.func.isRequired,\n  reviewers: PropTypes.array.isRequired\n};\n\nclass AddReviewerDialog extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      reviewers: this.props.reviewers,\n      selectedOption: null,\n      errorMsg: [],\n      loading: false,\n    };\n    this.Options = [];\n  }\n\n  listReviewers = () => {\n    seafileAPI.listDraftReviewers(this.props.draftID).then((res) => {\n      this.setState({ reviewers: res.data.reviewers });\n    });\n  }\n\n  handleSelectChange = (option) => {\n    this.setState({ selectedOption: option });\n    this.Options = [];\n  }\n\n  addReviewers = () => {\n    if (this.state.selectedOption.length > 0 ) {\n      this.refs.reviewSelect.clearSelect();\n      let reviewers = [];\n      for (let i = 0; i < this.state.selectedOption.length; i ++) {\n        reviewers[i] = this.state.selectedOption[i].email;\n      }\n      this.setState({\n        loading: true,\n        errorMsg: [],\n      });\n      seafileAPI.addDraftReviewers(this.props.draftID, reviewers).then((res) => {\n        if (res.data.failed.length > 0) {\n          let errorMsg = [];\n          for (let i = 0 ; i < res.data.failed.length ; i++) {\n            errorMsg[i] = res.data.failed[i];\n          }\n          this.setState({ errorMsg: errorMsg });\n        }\n        this.setState({\n          selectedOption: null,\n          loading: false\n        });\n        if (res.data.success.length > 0) {\n          this.listReviewers();\n        }\n      }).catch(error => {\n        let errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    }\n  }\n\n  deleteReviewer = (event) => {\n    let reviewer = event.target.getAttribute('name');\n    seafileAPI.deleteDraftReviewer(this.props.draftID, reviewer).then((res) => {\n      if (res.data === 200) {\n        let newReviewers = [];\n        for (let i = 0; i < this.state.reviewers.length; i ++) {\n          if (this.state.reviewers[i].user_email !== reviewer) {\n            newReviewers.push(this.state.reviewers[i]);\n          }\n        }\n        this.setState({ reviewers: newReviewers });\n      }\n    }).catch(error => {\n      let errorMsg = Utils.getErrorMsg(error);\n      toaster.danger(errorMsg);\n    });\n  }\n\n  render() {\n    const toggleDialog = this.props.toggleAddReviewerDialog;\n    const { reviewers, errorMsg } = this.state;\n    return (\n      <Modal isOpen={true} toggle={toggleDialog}>\n        <ModalHeader toggle={toggleDialog}>{gettext('Request a review')}</ModalHeader>\n        <ModalBody>\n          <p>{gettext('Add new reviewer')}</p>\n          <div className='add-reviewer'>\n            <UserSelect\n              placeholder={gettext('Search users...')}\n              onSelectChange={this.handleSelectChange}\n              ref=\"reviewSelect\"\n              isMulti={true}\n              className='reviewer-select'\n            />\n            {(this.state.selectedOption && !this.state.loading)?\n              <Button color=\"secondary\" onClick={this.addReviewers}>{gettext('Submit')}</Button> :\n              <Button color=\"secondary\" disabled>{gettext('Submit')}</Button>\n            }\n          </div>\n          {errorMsg.length > 0 &&\n            errorMsg.map((item, index = 0, arr) => {\n              return (\n                <p className=\"reviewer-select-error error\" key={index}>{errorMsg[index].email}\n                  {': '}{errorMsg[index].error_msg}</p>\n              );\n            })\n          }\n          {reviewers.length > 0 &&\n            reviewers.map((item, index = 0, arr) => {\n              return (\n                <div className=\"reviewer-select-info\" key={index}>\n                  <div className=\"d-flex\">\n                    <img className=\"avatar reviewer-select-avatar\" src={item.avatar_url} alt=\"\"/>\n                    <span className=\"reviewer-select-name ellipsis\">{item.user_name}</span>\n                  </div>\n                  <i className=\"fa fa-times\" name={item.user_email} onClick={this.deleteReviewer}></i>\n                </div>\n              );\n            })\n          }\n        </ModalBody>\n        <ModalFooter>\n          <Button color=\"secondary\" onClick={toggleDialog}>{gettext('Close')}</Button>\n        </ModalFooter>\n      </Modal>\n    );\n  }\n}\n\nAddReviewerDialog.propTypes = propTypes;\n\nexport default AddReviewerDialog;\n","/* eslint-disable linebreak-style */\nimport React from 'react';\nimport axios from 'axios';\nimport Loading from '../../components/loading';\nimport moment from 'moment';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { draftRepoID, draftFilePath, draftOriginFilePath } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../../components/toast';\n\nimport '../../css/file-history.css';\n\nmoment.locale(window.app.config.lang);\n\nclass HistoryList extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.perPage = 25;\n    this.state = {\n      currentPage: 1,\n      loading: false\n    };\n  }\n\n  onClick = (event, key, preItem, currentItem)=> {\n    if (key === this.state.activeItem) return false;\n    this.props.onHistoryItemClick(currentItem, preItem, key);\n  }\n\n  onScroll = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop    = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    if (isBottom) {\n      if (this.props.totalReversionCount > this.perPage * this.state.currentPage) {\n        let currentPage = this.state.currentPage + 1;\n        this.setState({\n          currentPage: currentPage,\n          loading : true\n        });\n        seafileAPI.listFileHistoryRecords(draftRepoID, draftFilePath, currentPage, this.perPage).then((res) => {\n          let currentHistoryList = Object.assign([], this.props.historyList);\n          this.props.onHistoryListChange([...currentHistoryList, ...res.data.data]);\n          this.setState({\n            loading : false\n          });\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"history-body\">\n        <ul onScroll={this.onScroll} className={'history-list-container'}>\n          {\n            this.props.historyList ?\n              this.props.historyList.map((item, index = 0, arr) => {\n                let preItemIndex = index + 1;\n                if (preItemIndex === arr.length) {\n                  preItemIndex = index;\n                }\n                return (\n                  <HistoryItem\n                    onClick={this.onClick}\n                    ctime={item.ctime}\n                    className={this.props.activeItem === index ? 'item-active': ''}\n                    name={item.creator_name}\n                    index={index}\n                    key={index}\n                    preItem={arr[preItemIndex]}\n                    currentItem={item}\n                  />\n                );\n              }) : <Loading/>\n          }\n          {\n            this.state.loading &&\n            <li className={'reloading-reversion'}><Loading /></li>\n          }\n        </ul>\n      </div>\n    );\n  }\n}\n\nclass HistoryItem extends React.Component {\n  render() {\n    let time = moment.parseZone(this.props.ctime).format('YYYY-MM-DD HH:mm');\n    return (\n      <li onClick={(event) => this.props.onClick(event, this.props.index, this.props.preItem, this.props.currentItem)} className={'history-list-item ' + this.props.className}>\n        <div className=\"history-info\">\n          <div className=\"time\">{time}</div>\n          <div className=\"owner\"><i className=\"squire-icon\"/><span>{this.props.name}</span></div>\n        </div>\n      </li>\n    );\n  }\n}\n\n\nexport default HistoryList;\n","import moment from 'moment';\n\nclass reviewComment {\n\n  constructor(item) {\n    let oldTime = (new Date(item.created_at)).getTime();\n    this.time = moment(oldTime).format('YYYY-MM-DD HH:mm');\n    this.id = item.id;\n    this.avatarUrl = item.avatar_url;\n    this.comment = item.comment;\n    this.name = item.user_name;\n    this.userEmail = item.user_email;\n    this.resolved = item.resolved;\n    if (item.detail) {\n      let detail = JSON.parse(item.detail);\n      this.newIndex = detail.newIndex;\n      this.oldIndex = detail.oldIndex;\n      this.quote = detail.quote;\n    }\n  }\n\n}\n\nexport default reviewComment;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { Button } from 'reactstrap';\n/* eslint-disable */\nimport Prism from 'prismjs';\n/* eslint-enable */\nimport { siteRoot, gettext, draftOriginFilePath, draftFilePath, author, authorAvatar, originFileExists, draftFileExists, draftID, draftFileName, draftRepoID, draftStatus, draftPublishVersion, originFileVersion, filePermission, serviceURL, mediaUrl } from './utils/constants';\nimport { seafileAPI } from './utils/seafile-api';\nimport axios from 'axios';\nimport DiffViewer from '@seafile/seafile-editor/dist/viewer/diff-viewer';\nimport { serialize } from '@seafile/seafile-editor/dist/utils/slate2markdown/serialize';\nimport Loading from './components/loading';\nimport ReviewComments from './components/review-list-view/review-comments';\nimport ReviewCommentDialog from './components/review-list-view/review-comment-dialog.js';\nimport { Tooltip } from 'reactstrap';\nimport AddReviewerDialog from './components/dialog/add-reviewer-dialog.js';\nimport  { ReactEditor }  from '@seafile/slate-react';\nimport { Nav, NavItem, NavLink, TabContent, TabPane } from 'reactstrap';\nimport classnames from 'classnames';\nimport HistoryList from './pages/review/history-list';\nimport { Range, Editor } from 'slate';\nimport ModalPortal from './components/modal-portal';\nimport reviewComment from './models/review-comment.js';\n\nimport './css/layout.css';\nimport './css/toolbar.css';\nimport './css/dirent-detail.css';\nimport './css/draft.css';\n\nrequire('@seafile/seafile-editor/dist/editor/code-highlight-package');\nconst URL = require('url-parse');\nvar moment = require('moment');\n\nconst { toSlateRange: findRange, toDOMNode } = ReactEditor;\n\nclass Draft extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      draftContent: '',\n      draftOriginContent: '',\n      draftInfo: {},\n      isLoading: true,\n      isShowDiff: true,\n      showDiffTip: false,\n      activeTab: 'reviewInfo',\n      commentsList: [],\n      changedNodes: [],\n      originRepoName: '',\n      isShowCommentDialog: false,\n      activeItem: null,\n      historyList: [],\n      showReviewerDialog: false,\n      reviewers: [],\n      inResizing: false,\n      rightPartWidth: 30,\n      draftStatus: draftStatus,\n    };\n    this.quote = '';\n    this.newIndex = null;\n    this.oldIndex = null;\n    this.changeIndex = -1;\n    this.range = null;\n  }\n\n  initialContent = () => {\n    switch(draftStatus) {\n      case 'open':\n        if (!draftFileExists) {\n          this.setState({\n            isLoading: false,\n            isShowDiff: false\n          });\n          return;\n        }\n\n        if (!originFileExists) {\n          seafileAPI.getFileDownloadLink(draftRepoID, draftFilePath)\n            .then(res => {\n              seafileAPI.getFileContent(res.data)\n                .then(res => {\n                  this.setState({\n                    draftContent: res.data,\n                    draftOriginContent: res.data,\n                    isLoading: false,\n                    isShowDiff: false\n                  });\n                });\n            });\n          return;\n        }\n\n        const hash = window.location.hash;\n        if (hash.indexOf('#history-') === 0) {\n          const currentCommitID = hash.slice(9, 49);\n          const preCommitID = hash.slice(50, 90);\n          let preItemFilePath, currentItemFilePath;\n          this.setState({\n            isLoading: false,\n            activeTab: 'history',\n          });\n          seafileAPI.listFileHistoryRecords(draftRepoID, draftFilePath, 1, 25).then((res) => {\n            const historyList = res.data.data;\n            this.setState({\n              historyList: historyList,\n              totalReversionCount: res.data.total_count\n            });\n            for (let i = 0, length = historyList.length; i < length; i++) {\n              if (preCommitID === historyList[i].commit_id) {\n                this.setState({\n                  activeItem: i\n                });\n                preItemFilePath = historyList[i].path;\n              }\n              if (currentCommitID === historyList[i].commit_id) {\n                currentItemFilePath = historyList[i].path;\n              }\n              if (preItemFilePath && currentItemFilePath) break;\n            }\n            axios.all([\n              seafileAPI.getFileRevision(draftRepoID, currentCommitID, currentItemFilePath),\n              seafileAPI.getFileRevision(draftRepoID, preCommitID, preItemFilePath)\n            ]).then(axios.spread((res1, res2) => {\n              axios.all([seafileAPI.getFileContent(res1.data), seafileAPI.getFileContent(res2.data)]).then(axios.spread((content1, content2) => {\n                this.setDiffViewerContent(content2.data, content1.data);\n              }));\n            }));\n            return;\n          });\n        } else {\n          axios.all([\n            seafileAPI.getFileDownloadLink(draftRepoID, draftFilePath),\n            seafileAPI.getFileDownloadLink(draftRepoID, draftOriginFilePath)\n          ]).then(axios.spread((res1, res2) => {\n            axios.all([\n              seafileAPI.getFileContent(res1.data),\n              seafileAPI.getFileContent(res2.data)\n            ]).then(axios.spread((draftContent, draftOriginContent) => {\n              this.setState({\n                draftContent: draftContent.data,\n                draftOriginContent: draftOriginContent.data,\n                isLoading: false\n              });\n              let that = this;\n              setTimeout(() => {\n                that.getChangedNodes();\n              }, 100);\n            }));\n          }));\n        }\n        break;\n      case 'published':\n        if (!originFileExists) {\n          this.setState({\n            isLoading: false,\n            isShowDiff: false\n          });\n          return;\n        }\n\n        let dl0 = siteRoot + 'repo/' + draftRepoID + '/' + draftPublishVersion + '/download?' + 'p=' + draftOriginFilePath;\n        let dl = siteRoot + 'repo/' + draftRepoID + '/' + originFileVersion + '/download?' + 'p=' + draftOriginFilePath;\n        axios.all([\n          seafileAPI.getFileContent(dl0),\n          seafileAPI.getFileContent(dl)\n        ]).then(axios.spread((draftContent, draftOriginContent) => {\n          this.setState({\n            draftContent: draftContent.data,\n            draftOriginContent: draftOriginContent.data,\n            isLoading: false,\n          });\n        }));\n        break;\n    }\n  }\n\n  onHistoryItemClick = (currentItem, preItem, activeItem) => {\n    const preCommitID = preItem.commit_id;\n    const currentCommitID = currentItem.commit_id;\n    const url = 'history-' + preCommitID + '-' + currentCommitID;\n    this.setURL(url);\n    this.setState({\n      activeItem: activeItem,\n      isLoading: true,\n    });\n    axios.all([\n      seafileAPI.getFileRevision(draftRepoID, currentCommitID, currentItem.path),\n      seafileAPI.getFileRevision(draftRepoID, preCommitID, preItem.path)\n    ]).then(axios.spread((res1, res2) => {\n      axios.all([seafileAPI.getFileContent(res1.data), seafileAPI.getFileContent(res2.data)]).then(axios.spread((content1,content2) => {\n        this.setDiffViewerContent(content1.data, content2.data);\n      }));\n    }));\n  }\n\n  onHistoryListChange = (historyList) => {\n    this.setState({historyList: historyList });\n  }\n\n  listComments = () => {\n    seafileAPI.listComments(draftRepoID, draftFilePath).then((res) => {\n      let commentsList = [];\n      res.data.comments.forEach((item) => {\n        commentsList.push(new reviewComment(item));\n      });\n      this.setState({ commentsList: commentsList });\n    });\n  }\n\n  addComment = (e) => {\n    e.stopPropagation();\n    this.getQuote();\n    if (!this.quote) return;\n    this.setState({ isShowCommentDialog: true });\n  }\n\n  onCommentAdded = () => {\n    this.listComments();\n    this.toggleCommentDialog();\n  }\n\n  toggleCommentDialog = () => {\n    this.setState({\n      isShowCommentDialog: !this.state.isShowCommentDialog\n    });\n  }\n\n  getOriginRepoInfo = () => {\n    seafileAPI.getRepoInfo(draftRepoID).then((res) => {\n      this.setState({ originRepoName: res.data.repo_name });\n    });\n  }\n\n  getDraftInfo = () => {\n    if (draftStatus === 'open') {\n      seafileAPI.getFileInfo(draftRepoID, draftFilePath).then((res) => {\n        this.setState({ draftInfo: res.data });\n      });\n    }\n  }\n\n  getChangedNodes = () => {\n    const nodes = this.refs.diffViewer.value;\n    let keys = [];\n    let lastDiffState = '';\n    nodes.map((node, index) => {\n      const diff_state = node.data['diff_state'];\n      if (diff_state === 'diff-added' && lastDiffState !== 'diff-added') {\n        keys.push(index);\n      } else if (diff_state === 'diff-removed' && lastDiffState !== 'diff-removed') {\n        keys.push(index);\n      } else if (diff_state === 'diff-replaced' && lastDiffState !== 'diff-replaced') {\n        keys.push(index);\n      }\n      lastDiffState = node.data.diff_state;\n    });\n    this.setState({\n      changedNodes: keys\n    });\n  }\n\n  scrollToChangedNode = (scroll) => {\n    if (this.state.changedNodes.length == 0) return;\n    if (scroll === 'up') { this.changeIndex++; } else { this.changeIndex--; }\n    if (this.changeIndex > this.state.changedNodes.length - 1) {\n      this.changeIndex = 0;\n    }\n    if (this.changeIndex < 0) {\n      this.changeIndex = this.state.changedNodes.length - 1;\n    }\n    const win = window;\n    let key = this.state.changedNodes[this.changeIndex];\n    let node = window.viewer.children[key];\n    let element = toDOMNode(window.viewer, node);\n    // fix code-block or tables\n    while (element.className.indexOf('diff-') === -1 && element.tagName !== 'BODY') {\n      element = element.parentNode;\n    }\n    const scroller = this.findScrollContainer(element, win);\n    const isWindow = scroller == win.document.body || scroller == win.document.documentElement;\n    if (isWindow) {\n      win.scrollTo(0, element.offsetTop);\n    } else {\n      scroller.scrollTop = element.offsetTop;\n    }\n  }\n\n  findScrollContainer = (element, window) => {\n    let parent = element.parentNode;\n    const OVERFLOWS = ['auto', 'overlay', 'scroll'];\n    let scroller;\n    while (!scroller) {\n      if (!parent.parentNode) break;\n      const style = window.getComputedStyle(parent);\n      const { overflowY } = style;\n      if (OVERFLOWS.includes(overflowY)) {\n        scroller = parent;\n        break;\n      }\n      parent = parent.parentNode;\n    }\n    if (!scroller) {\n      return window.document.body;\n    }\n    return scroller;\n  }\n\n  scrollToQuote = (newIndex, oldIndex, quote) => {\n    const nodes = this.refs.diffViewer.value;\n    let commentNode = nodes.find((node) => {\n      if (node.data['old_index'] == oldIndex && node.data['new_index'] == newIndex) {\n        return node;\n      }\n    });\n    if (commentNode) {\n      const element = toDOMNode(window.viewer, commentNode);\n      if (!element) return;\n      const win = window;\n      const scroller = this.findScrollContainer(element, win);\n      const isWindow = scroller == win.document.body || scroller == win.document.documentElement;\n      if (isWindow) {\n        win.scrollTo(0, element.offsetTop);\n      } else {\n        scroller.scrollTop = element.offsetTop;\n      }\n    }\n  }\n\n  showDiffViewer = () => {\n    return (\n      <div>\n        {this.state.isShowDiff ?\n          <DiffViewer\n            scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n            newMarkdownContent={this.state.draftContent}\n            oldMarkdownContent={this.state.draftOriginContent}\n            ref=\"diffViewer\"\n          /> :\n          <DiffViewer\n            scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n            newMarkdownContent={this.state.draftContent}\n            oldMarkdownContent={this.state.draftContent}\n            ref=\"diffViewer\"\n          />\n        }\n        <i className=\"fa fa-plus-square review-comment-btn\" ref=\"commentbtn\" onMouseDown={this.addComment}></i>\n      </div>\n    );\n  }\n\n  listReviewers = () => {\n    seafileAPI.listDraftReviewers(draftID).then((res) => {\n      this.setState({\n        reviewers: res.data.reviewers\n      });\n    });\n  }\n\n  onSwitchShowDiff = () => {\n    if (!this.state.isShowDiff) {\n      let that = this;\n      setTimeout(() => {\n        that.getChangedNodes();\n      }, 100);\n    }\n    this.setState({\n      isShowDiff: !this.state.isShowDiff,\n    });\n  }\n\n  toggleDiffTip = () => {\n    this.setState({\n      showDiffTip: !this.state.showDiffTip\n    });\n  }\n\n  toggleAddReviewerDialog = () => {\n    if (this.state.showReviewerDialog) {\n      this.listReviewers();\n    }\n    this.setState({\n      showReviewerDialog: !this.state.showReviewerDialog\n    });\n  }\n\n  showDiffButton = () => {\n    return (\n      <div className={'seafile-toggle-diff'}>\n        <label className=\"custom-switch\" id=\"toggle-diff\">\n          <input type=\"checkbox\" checked={this.state.isShowDiff && 'checked'}\n            name=\"option\" className=\"custom-switch-input\"\n            onChange={this.onSwitchShowDiff}/>\n          <span className=\"custom-switch-indicator\"></span>\n        </label>\n        <Tooltip placement=\"bottom\" isOpen={this.state.showDiffTip}\n          target=\"toggle-diff\" toggle={this.toggleDiffTip}>\n          {gettext('View diff')}</Tooltip>\n      </div>\n    );\n  }\n\n  onPublishDraft = () => {\n    seafileAPI.publishDraft(draftID).then(res => {\n      this.setState({\n        draftStatus: res.data.draft_status,\n      });\n    });\n  }\n\n  initialDiffViewerContent = () => {\n    seafileAPI.listFileHistoryRecords(draftRepoID, draftFilePath, 1, 25).then((res) => {\n      this.setState({\n        historyList: res.data.data,\n        totalReversionCount: res.data.total_count\n      });\n      if (res.data.data.length > 1) {\n        axios.all([\n          seafileAPI.getFileRevision(draftRepoID, res.data.data[0].commit_id, draftFilePath),\n          seafileAPI.getFileRevision(draftRepoID, res.data.data[1].commit_id, draftFilePath)\n        ]).then(axios.spread((res1, res2) => {\n          axios.all([seafileAPI.getFileContent(res1.data), seafileAPI.getFileContent(res2.data)]).then(axios.spread((content1,content2) => {\n            this.setState({\n              draftContent: content1.data,\n              draftOriginContent: content2.data\n            });\n          }));\n        }));\n      } else {\n        seafileAPI.getFileRevision(draftRepoID, res.data.data[0].commit_id, draftFilePath).then((res) => {\n          seafileAPI.getFileContent(res.data).then((content) => {\n            this.setState({\n              draftContent: content.data,\n              draftOriginContent: ''\n            });\n          });\n        });\n      }\n    });\n  }\n\n  setDiffViewerContent = (newContent, prevContent) => {\n    this.setState({\n      draftContent: newContent,\n      draftOriginContent: prevContent,\n      isLoading: false,\n    });\n  }\n\n  setURL = (newurl) => {\n    let url = new URL(window.location.href);\n    url.set('hash', newurl);\n    window.location.href = url.toString();\n  }\n\n  tabItemClick = (tab) => {\n    if (this.state.activeTab !== tab) {\n      if (tab !== 'history' && window.location.hash) {\n        this.setURL('#');\n      }\n      if (tab == 'reviewInfo') {\n        this.initialContent();\n      } else if (tab == 'history') {\n        this.initialDiffViewerContent();\n      }\n      this.setState({\n        activeTab: tab\n      });\n    }\n  }\n\n  showNavItem = (showTab) => {\n    const commentsNumber = this.state.commentsList.length;\n    switch(showTab) {\n      case 'info':\n        return (\n          <NavItem className=\"nav-item\">\n            <NavLink\n              className={classnames({ active: this.state.activeTab === 'reviewInfo' })}\n              onClick={() => { this.tabItemClick('reviewInfo');}}\n            >\n              <i className=\"fas fa-info-circle\"></i>\n            </NavLink>\n          </NavItem>\n        );\n      case 'comments':\n        return (\n          <NavItem className=\"nav-item\">\n            <NavLink\n              className={classnames({ active: this.state.activeTab === 'comments' })}\n              onClick={() => {this.tabItemClick('comments');}}\n            >\n              <i className=\"fa fa-comments\"></i>\n              {commentsNumber > 0 && <div className='comments-number'>{commentsNumber}</div>}\n            </NavLink>\n          </NavItem>\n        );\n      case 'history':\n        return (\n          <NavItem className=\"nav-item\">\n            <NavLink\n              className={classnames({ active: this.state.activeTab === 'history' })}\n              onClick={() => { this.tabItemClick('history');}}\n            >\n              <i className=\"fas fa-history\"></i>\n            </NavLink>\n          </NavItem>\n        );\n    }\n  }\n\n  getDomNodeByPath = (path) => {\n    let node, parent = document.querySelector('.viewer-component');\n    while(typeof path[0] === 'number' && parent) {\n      node = parent.children[path[0]];\n      if (!node.getAttribute('data-slate-node')) {\n        node = node.children[0];\n      }\n      path.shift();\n      parent = node;\n    }\n    return node;\n  }\n\n  setBtnPosition = () => {\n    const nativeSelection = window.getSelection();\n    if (!nativeSelection.rangeCount) {\n      return;\n    }\n    const nativeRange = nativeSelection.getRangeAt(0);\n    let selection = null;\n    let style = this.refs.commentbtn.style;\n    try {\n      selection = findRange(window.viewer, nativeRange);\n    } catch (err) {\n      style.top = '-1000px';\n      return;\n    }\n    if (!selection || Range.isCollapsed(selection)) {\n      style.top = '-1000px';\n      return;\n    }\n    this.range = selection;\n    const focusNodePath = selection.anchor.path.slice();\n    focusNodePath.pop();\n    const focusNode = this.getDomNodeByPath(focusNodePath);\n    style.right = '0px';\n\n    if (focusNode) {\n      style.top = `${focusNode.offsetTop}px`;\n    } else {\n      style.top = '-1000px';\n    }\n  }\n\n  getQuote = () => {\n    if (!this.range) return;\n    this.quote = serialize(Editor.fragment(window.viewer, this.range));\n    const node = window.viewer.children[this.range.anchor.path[0]];\n    this.newIndex = node.data['new_index'];\n    this.oldIndex = node.data['old_index'];\n  }\n\n  onResizeMouseUp = () => {\n    if (this.state.inResizing) {\n      this.setState({ inResizing: false });\n    }\n  }\n\n  onResizeMouseDown = () => {\n    this.setState({ inResizing: true });\n  };\n\n  onResizeMouseMove = (e) => {\n    let rate = 100 - e.nativeEvent.clientX / this.refs.main.clientWidth * 100;\n    if (rate < 20 || rate > 60) {\n      this.setState({ inResizing: false });\n      return null;\n    }\n    this.setState({ rightPartWidth: rate });\n  };\n\n  componentDidMount() {\n    this.getOriginRepoInfo();\n    this.getDraftInfo();\n    this.listReviewers();\n    this.listComments();\n    this.initialContent();\n    document.addEventListener('selectionchange', this.setBtnPosition);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('selectionchange', this.setBtnPosition);\n  }\n\n  renderDiffButton = () => {\n    switch(draftStatus) {\n      case 'open':\n        if (!draftFileExists || !originFileExists) {\n          return;\n        }\n        return this.showDiffButton();\n      case 'published':\n        if (!originFileExists) {\n          return;\n        }\n        return this.showDiffButton();\n    }\n  }\n\n  renderNavItems = () => {\n    switch (draftStatus) {\n      case 'open':\n        if (!draftFileExists) {\n          return (\n            <Nav tabs className=\"review-side-panel-nav\">\n              {this.showNavItem('info')}\n            </Nav>\n          );\n        }\n\n        return (\n          <Nav tabs className=\"review-side-panel-nav\">\n            {this.showNavItem('info')}\n            {this.showNavItem('comments')}\n            {this.showNavItem('history')}\n          </Nav>\n        );\n      case 'published':\n        if (!originFileExists) {\n          return (\n            <Nav tabs className=\"review-side-panel-nav\">\n              {this.showNavItem('info')}\n            </Nav>\n          );\n        }\n        return (\n          <Nav tabs className=\"review-side-panel-nav\">\n            {this.showNavItem('info')}\n            {this.showNavItem('comments')}\n          </Nav>\n        );\n    }\n  }\n\n  renderContent = () => {\n    switch(draftStatus) {\n      case 'open':\n        if (!draftFileExists) {\n          return <p className=\"error\">{gettext('Draft has been deleted.')}</p>;\n        }\n        return this.showDiffViewer();\n      case 'published':\n        if (!originFileExists) {\n          return <p className=\"error\">{gettext('Original file has been deleted.')}</p>;\n        }\n        return this.showDiffViewer();\n    }\n  }\n\n  render() {\n    const { draftInfo, reviewers, originRepoName, draftStatus } = this.state;\n    const onResizeMove = this.state.inResizing ? this.onResizeMouseMove : null;\n    const draftLink = siteRoot + 'lib/' + draftRepoID + '/file' + draftFilePath + '?mode=edit';\n    const showPublishedButton = this.state.draftStatus == 'published';\n    const showPublishButton = this.state.draftStatus == 'open' && filePermission == 'rw';\n    const showEditButton = this.state.draftStatus == 'open' && filePermission == 'rw';\n    const time = moment(draftInfo.mtime * 1000).format('YYYY-MM-DD HH:mm');\n    const url = `${siteRoot}profile/${encodeURIComponent(draftInfo.last_modifier_email)}/`;\n    return(\n      <div className=\"wrapper\">\n        <div id=\"header\" className=\"header review\">\n          <div className=\"cur-file-info\">\n            <div className=\"info-item file-feature\">\n              <span className=\"sf2-icon-review\"></span>\n            </div>\n            <div>\n              <div className=\"info-item file-info\">\n                <span className=\"file-name\">{draftFileName}</span>\n                <span className=\"mx-2 file-review\">{gettext('Review')}</span>\n              </div>\n              {(!showPublishedButton && draftInfo.mtime) &&\n                <div className=\"last-modification\">\n                  <a href={url}>{draftInfo.last_modifier_name}</a><span className=\"mx-1\">{time}</span>\n                </div>\n              }\n            </div>\n          </div>\n          <div className=\"button-group\">\n            {this.renderDiffButton()}\n            {showEditButton &&\n              <a href={draftLink} className=\"mx-1\">\n                <Button className=\"file-operation-btn\" color=\"secondary\">{gettext('Edit Draft')}</Button>\n              </a>\n            }\n            {showPublishButton &&\n              <button className='btn btn-success file-operation-btn' title={gettext('Publish draft')} onClick={this.onPublishDraft}>\n                {gettext('Publish')}\n              </button>\n            }\n            {showPublishedButton &&\n              <button className='btn btn-success file-operation-btn' title={gettext('Published')} disabled>\n                {gettext('Published')}\n              </button>\n            }\n          </div>\n        </div>\n        <div id=\"main\" className=\"main\" ref=\"main\">\n          <div className=\"cur-view-container\" onMouseMove={onResizeMove} onMouseUp={this.onResizeMouseUp} >\n            <div className='cur-view-content' ref=\"viewContent\" style={{width:(100 - this.state.rightPartWidth) + '%'}}>\n              {this.state.isLoading ?\n                <div className=\"markdown-viewer-render-content article\">\n                  <Loading />\n                </div>\n                :\n                <div className=\"markdown-viewer-render-content article\">\n                  {this.renderContent()}\n                </div>\n              }\n            </div>\n            <div className=\"cur-view-right-part\" style={{width:(this.state.rightPartWidth) + '%'}}>\n              <div className=\"seafile-comment-resize\" onMouseDown={this.onResizeMouseDown}></div>\n              <div className=\"review-side-panel\">\n                {this.renderNavItems()}\n                <TabContent activeTab={this.state.activeTab}>\n                  <TabPane tabId=\"reviewInfo\">\n                    <div className=\"review-side-panel-body\">\n                      <SidePanelReviewers\n                        reviewers={reviewers}\n                        toggleAddReviewerDialog={this.toggleAddReviewerDialog}/>\n                      <SidePanelAuthor/>\n                      {draftFileExists && <UnresolvedComments commentsList={this.state.commentsList}/>}\n                      {(this.state.isShowDiff === true && this.state.changedNodes.length > 0) &&\n                      <SidePanelChanges\n                        changedNumber={this.state.changedNodes.length}\n                        scrollToChangedNode={this.scrollToChangedNode}/>\n                      }\n                      <SidePanelOrigin originRepoName={originRepoName} draftInfo={draftInfo} draftStatus={draftStatus}/>\n                    </div>\n                  </TabPane>\n                  <TabPane tabId=\"comments\" className=\"comments\">\n                    <ReviewComments\n                      scrollToQuote={this.scrollToQuote}\n                      listComments={this.listComments}\n                      commentsList={this.state.commentsList}\n                      inResizing={false}\n                    />\n                  </TabPane>\n                  <TabPane tabId=\"history\" className=\"history\">\n                    <HistoryList\n                      activeItem={this.state.activeItem}\n                      historyList={this.state.historyList}\n                      totalReversionCount={this.state.totalReversionCount}\n                      onHistoryItemClick={this.onHistoryItemClick}\n                      onHistoryListChange={this.onHistoryListChange}\n                    />\n                  </TabPane>\n                </TabContent>\n              </div>\n            </div>\n          </div>\n        </div>\n        {this.state.showReviewerDialog &&\n          <ModalPortal>\n            <AddReviewerDialog\n              showReviewerDialog={this.state.showReviewerDialog}\n              toggleAddReviewerDialog={this.toggleAddReviewerDialog}\n              draftID={draftID}\n              reviewers={reviewers}\n            />\n          </ModalPortal>\n        }\n        {this.state.isShowCommentDialog &&\n          <ModalPortal>\n            <ReviewCommentDialog\n              toggleCommentDialog={this.toggleCommentDialog}\n              onCommentAdded={this.onCommentAdded}\n              quote={this.quote}\n              newIndex={this.newIndex}\n              oldIndex={this.oldIndex}\n            />\n          </ModalPortal>\n        }\n      </div>\n    );\n  }\n}\n\n\nclass SidePanelReviewers extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const { reviewers } = this.props;\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Reviewers')}\n          <i className=\"fa fa-cog\" onClick={this.props.toggleAddReviewerDialog}></i>\n        </div>\n        {reviewers.length > 0 ?\n          reviewers.map((item, index = 0, arr) => {\n            return (\n              <div className=\"reviewer-info\" key={index}>\n                <img className=\"avatar review-side-panel-avatar\" src={item.avatar_url} alt=\"\"/>\n                <span className=\"reviewer-name ellipsis\">{item.user_name}</span>\n              </div>\n            );\n          })\n          :\n          <span>{gettext('No reviewer yet.')}</span>\n        }\n      </div>\n    );\n  }\n}\n\nconst sidePanelReviewersPropTypes = {\n  reviewers: PropTypes.array.isRequired,\n  toggleAddReviewerDialog: PropTypes.func.isRequired\n};\n\nSidePanelReviewers.propTypes = sidePanelReviewersPropTypes;\n\nclass SidePanelAuthor extends React.Component {\n  render() {\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Author')}</div>\n        <div className=\"author-info\">\n          <img className=\"avatar review-side-panel-avatar\" src={authorAvatar} alt=\"\"/>\n          <span className=\"author-name ellipsis\">{author}</span>\n        </div>\n      </div>\n    );\n  }\n}\n\nclass SidePanelOrigin extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const { draftStatus, originRepoName } = this.props;\n    const filePath = serviceURL + '/lib/' + draftRepoID + '/file' + draftOriginFilePath;\n    return (\n      <div className=\"dirent-table-container\">\n        <table className=\"table-thead-hidden\">\n          <thead>\n            <tr><th width=\"25%\"></th><th width=\"75%\"></th></tr>\n          </thead>\n          <tbody>\n            <tr>\n              <th className=\"align-text-top\">{gettext('Location')}</th>\n              <td>\n                {draftStatus === 'open' ?\n                  <span>{originRepoName}{draftFilePath}</span> :\n                  <a href={filePath} className=\"text-dark\">{filePath}</a>\n                }\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    );\n  }\n}\n\nconst SidePanelOriginPropTypes = {\n  originRepoName: PropTypes.string.isRequired,\n  draftStatus: PropTypes.string.isRequired,\n};\n\nSidePanelOrigin.propTypes = SidePanelOriginPropTypes;\n\n\nclass UnresolvedComments extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const { commentsList } = this.props;\n    let unresolvedNumber = 0;\n    if (commentsList) {\n      for (let i = 0, count = commentsList.length; i < count; i++) {\n        if (commentsList[i].resolved === false) {\n          unresolvedNumber++;\n        }\n      }\n    }\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Comments')}</div>\n        <div className=\"changes-info\">\n          <span>{gettext('Unresolved comments:')}{' '}{unresolvedNumber}</span>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst UnresolvedCommentsPropTypes = {\n  commentsList: PropTypes.array.isRequired,\n};\n\nUnresolvedComments.propTypes = UnresolvedCommentsPropTypes;\n\n\nclass SidePanelChanges extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Changes')}</div>\n        <div className=\"changes-info\">\n          <span>{gettext('Number of changes:')}{' '}{this.props.changedNumber}</span>\n          {this.props.changedNumber > 0 &&\n            <div>\n              <i className=\"fa fa-arrow-circle-up\" onClick={() => { this.props.scrollToChangedNode('down');}}></i>\n              <i className=\"fa fa-arrow-circle-down\" onClick={() => { this.props.scrollToChangedNode('up');}}></i>\n            </div>\n          }\n        </div>\n      </div>\n    );\n  }\n}\n\nconst sidePanelChangesPropTypes = {\n  changedNumber: PropTypes.number.isRequired,\n  scrollToChangedNode: PropTypes.func.isRequired\n};\n\nSidePanelChanges.propTypes = sidePanelChangesPropTypes;\n\n\nReactDOM.render (\n  <Draft />,\n  document.getElementById('wrapper')\n);\n","function compareTwoStrings(str1, str2) {\n  if (!str1.length && !str2.length) return 1; // if both are empty strings\n\n  if (!str1.length || !str2.length) return 0; // if only one is empty string\n\n  if (str1.toUpperCase() === str2.toUpperCase()) return 1; // identical\n\n  if (str1.length === 1 && str2.length === 1) return 0; // both are 1-letter strings\n\n  var pairs1 = wordLetterPairs(str1);\n  var pairs2 = wordLetterPairs(str2);\n  var union = pairs1.length + pairs2.length;\n  var intersection = 0;\n  pairs1.forEach(function (pair1) {\n    for (var i = 0, pair2; pair2 = pairs2[i]; i++) {\n      if (pair1 !== pair2) continue;\n      intersection++;\n      pairs2.splice(i, 1);\n      break;\n    }\n  });\n  return intersection * 2 / union;\n}\n\nfunction flattenDeep(arr) {\n  return Array.isArray(arr) ? arr.reduce(function (a, b) {\n    return a.concat(flattenDeep(b));\n  }, []) : [arr];\n}\n\nfunction letterPairs(str) {\n  var pairs = [];\n\n  for (var i = 0, max = str.length - 1; i < max; i++) {\n    pairs[i] = str.substring(i, i + 2);\n  }\n\n  return pairs;\n}\n\nfunction wordLetterPairs(str) {\n  var pairs = str.toUpperCase().split(' ').map(letterPairs);\n  return flattenDeep(pairs);\n}\n\nexport { compareTwoStrings };","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport lodash from 'lodash';\nimport { compareTwoStrings } from './compare-strings';\nimport { Node, Text } from 'slate';\nimport { deserialize } from '../slate2markdown';\n\nfunction equalityFunctionForSlate(a, b) {\n  if (a.type !== b.type) {\n    return false;\n  }\n\n  if (lodash.isEqual(a, b)) {\n    return true;\n  }\n\n  if (Text.isText(a) && Text.isText(b)) {\n    if (compareTwoStrings(a.text, b.text) >= 0.5) {\n      return 'changed';\n    } else {\n      return false;\n    }\n  }\n\n  if (a.type === b.type && (a.type.includes('ordered_list') || a.type.includes('unordered_list'))) {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n\n  if (a.type === b.type && (a.children.length > 1 || b.children.length > 1) && a.type === 'list_item') {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n\n  if (a.type === b.type && a.type === 'paragraph') {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n\n  if (a.type === b.type && a.type === 'table') {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n  /*\n   * the table diff is not the same as list diff,\n   * in the table, if the old table_line and the new table_line or the old table_cell and new table_cell are not equal\n   * the table_line or table_cells is set as changed, then the diff is expressed in the text of table_cell\n   * */\n\n\n  if (a.type === b.type && a.type === 'table_row') {\n    return 'changed';\n  }\n\n  if (a.type === b.type && a.type === 'table_cell') {\n    return 'changed';\n  }\n\n  return false;\n}\n\nfunction defaultEqualityFunction(a, b) {\n  return a === b;\n}\n\nvar SlateDiff = /*#__PURE__*/function () {\n  function SlateDiff() {\n    var _this = this;\n\n    _classCallCheck(this, SlateDiff);\n\n    this.deepDiff = function (newNodes, oldNodes, equalFunc) {\n      var depth = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var slateDiffNodes = []; // remeber current nodes depth\n\n      var nodeDepth = depth + 1;\n      var diff = new Diff({\n        equalFunc: equalFunc\n      });\n      diff.ArrayDiff(newNodes, oldNodes);\n\n      for (var i = 0; i < diff.diff.length; i++) {\n        var diffElement = diff.diff[i];\n        var changeType = diffElement.changeType;\n\n        if (changeType === 'common') {\n          var newItemData = {\n            diff_state: 'diff-common',\n            new_index: diffElement.newIndex,\n            old_index: -1,\n            node_depth: nodeDepth\n          };\n          diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, newItemData);\n        } else if (changeType === 'added') {\n          if (Text.isText(diffElement.item)) {\n            diffElement.item.ADD = true;\n          } else {\n            var _newItemData = {\n              diff_state: 'diff-added',\n              new_index: diffElement.newIndex,\n              old_index: -1,\n              node_depth: nodeDepth\n            };\n            diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, _newItemData);\n          }\n        } else if (changeType === 'removed') {\n          if (Text.isText(diffElement.item)) {\n            diffElement.item.DELETE = true;\n          } else {\n            var _newItemData2 = {\n              diff_state: 'diff-removed',\n              new_index: -1,\n              old_index: diffElement.oldIndex,\n              node_depth: nodeDepth\n            };\n            diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, _newItemData2);\n          }\n        } else if (changeType === 'replaced') {\n          var diffNodes = void 0,\n              elementType = diffElement.item.type || 'text';\n\n          if (elementType === 'text') {\n            // compare text diff leaves use getTextDiff function\n            diffNodes = _this.getTextDiff(diffElement.newItem, diffElement.oldItem);\n          } else if (elementType.includes('ordered_list') || elementType.includes('unordered_list') || elementType.includes('list_item')) {\n            diffNodes = _this.deepDiff(diffElement.newItem.children, diffElement.oldItem.children, equalFunc, nodeDepth);\n          } else if (elementType === 'table' || elementType === 'table_row' || elementType === 'table_cell') {\n            diffNodes = _this.deepDiff(diffElement.newItem.children, diffElement.oldItem.children, equalFunc, nodeDepth);\n          } else if (elementType === 'paragraph') {\n            // compare text or inline\n            diffNodes = _this.deepDiff(diffElement.newItem.children, diffElement.oldItem.children, equalFunc, nodeDepth);\n          }\n\n          if (Text.isText(diffElement.item)) {\n            diffElement.item = diffNodes;\n          } else {\n            var _newItemData3 = {\n              diff_state: 'diff-replaced',\n              new_index: -1,\n              old_index: diffElement.oldIndex,\n              node_depth: nodeDepth\n            };\n            diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, _newItemData3);\n            diffElement.item.children = diffNodes;\n          }\n        } // add diff nodes to document\n\n\n        if (Array.isArray(diffElement.item)) {\n          slateDiffNodes = slateDiffNodes.concat(diffElement.item);\n        } else {\n          slateDiffNodes.push(diffElement.item);\n        }\n      }\n\n      return slateDiffNodes;\n    };\n\n    this.getDiffDocument = function (newMarkdownContent, oldMarkdownContent) {\n      var newNodes = deserialize(newMarkdownContent);\n      var oldNodes = deserialize(oldMarkdownContent);\n\n      var topSlateDiffNodes = _this.deepDiff(newNodes, oldNodes, equalityFunctionForSlate); //handle replaced paragraph\n\n\n      topSlateDiffNodes = _this.splitTopDiffNodes(topSlateDiffNodes);\n      return topSlateDiffNodes;\n    };\n  }\n\n  _createClass(SlateDiff, [{\n    key: \"getTextDiff\",\n    value: function getTextDiff(newTextItem, oldTextItem) {\n      var textNodes = [];\n      var nodes = this.textDiff(newTextItem.text, oldTextItem.text);\n      textNodes = textNodes.concat(nodes);\n      return textNodes;\n    }\n  }, {\n    key: \"textDiff\",\n    value: function textDiff(newText, oldText) {\n      var marks = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      var texts = [];\n      var diff = new Diff({\n        equalFunc: defaultEqualityFunction\n      });\n      diff.StringDiff(newText, oldText);\n      var textDiffArray = diff.diff;\n      var stringFragment = '';\n      var lastDiffState = textDiffArray[0].changeType;\n      textDiffArray.forEach(function (textCharacter, index, textDiffArray) {\n        var markType = '';\n\n        if (lastDiffState === 'removed') {\n          markType = 'DELETE';\n        } else if (lastDiffState === 'added') {\n          markType = 'ADD';\n        }\n\n        if (lastDiffState === textCharacter.changeType) {\n          stringFragment += textCharacter.item;\n\n          if (index === textDiffArray.length - 1) {\n            texts.push(_objectSpread(_defineProperty({\n              text: stringFragment\n            }, markType, true), marks));\n          }\n        } else if (textCharacter.changeType !== lastDiffState) {\n          texts.push(_objectSpread(_objectSpread({\n            text: stringFragment\n          }, marks), {}, _defineProperty({}, markType, true)));\n          lastDiffState = textCharacter.changeType;\n          stringFragment = textCharacter.item;\n\n          if (index === textDiffArray.length - 1) {\n            if (lastDiffState === 'removed') {\n              markType = 'DELETE';\n            } else if (lastDiffState === 'added') {\n              markType = 'ADD';\n            }\n\n            texts.push(_objectSpread(_defineProperty({\n              text: stringFragment\n            }, markType, true), marks));\n          }\n        }\n      });\n      return texts;\n    }\n  }, {\n    key: \"splitDiffParagraph\",\n    value: function splitDiffParagraph(diffParagraph) {\n      // clone the replace paragraph to wrap the deleted and added nodes\n      var newParagraph = lodash.cloneDeep(diffParagraph),\n          oldParagraph = lodash.cloneDeep(diffParagraph),\n          // wrap new paragraph nodes and old paragraph nodes\n      newParagraphNodes = [],\n          oldParagraphNodes = []; // traverse paragraph nodes\n\n      diffParagraph.children.forEach(function (node, index1, nodes) {\n        if (node.type === 'link' || node.type === 'image') {\n          // if the node is inline node, like link\n          // if the inline is added\n          if (node.data.diff_state === 'diff-added') {\n            // push the inline node to new paragraph nodes\n            newParagraphNodes.push(node);\n          } else if (node.data.diff_state === 'diff-removed') {\n            // if the inline is added push the inline node to new paragraph nodes\n            oldParagraphNodes.push(node);\n          } else {\n            // if the inline node is common new paragraph node and old paragraph all push the inline node\n            newParagraphNodes.push(node);\n            oldParagraphNodes.push(node);\n          }\n        } else {\n          if (node.ADD) {\n            newParagraphNodes.push(node);\n          } else if (node.DELETE) {\n            oldParagraphNodes.push(node);\n          } else {\n            // push common text\n            newParagraphNodes.push(node);\n            oldParagraphNodes.push(node);\n          }\n        }\n      }); // set new paragraph and old paragraph nodes\n\n      newParagraph.children = newParagraphNodes;\n      oldParagraph.data.paragraph_state = 'old-paragraph';\n      newParagraph.data.paragraph_state = 'new-paragraph';\n      oldParagraph.children = oldParagraphNodes;\n      return [oldParagraph, newParagraph];\n    }\n  }, {\n    key: \"splitTopDiffNodes\",\n    value: function splitTopDiffNodes(slateDiffNodes) {\n      var _this2 = this;\n\n      // newSlateDiffNodes used to wrap the new slate nodes\n      var newSlateDiffNodes = []; // traverse slate top Nodes and find the paragraph handle it\n\n      slateDiffNodes.forEach(function (node) {\n        if (node.data.diff_state === 'diff-replaced' && node.type === 'paragraph') {\n          var splicedParagraph = _this2.splitDiffParagraph(node); // push the old and new paragraph node to newSlateDiffNodes\n\n\n          newSlateDiffNodes.push(splicedParagraph[0], splicedParagraph[1]);\n        } else if (node.data.diff_state === 'diff-replaced' && node.type === 'table') {\n          _this2.splitTableDiffParagraph(node);\n\n          newSlateDiffNodes.push(node);\n        } else {\n          newSlateDiffNodes.push(node);\n        }\n      });\n      return newSlateDiffNodes;\n    }\n  }, {\n    key: \"splitTableDiffParagraph\",\n    value: function splitTableDiffParagraph(node) {\n      var _this3 = this;\n\n      node.children.forEach(function (tableRow, rowIndex, tablerows) {\n        if (tableRow.data.diff_state === 'diff-replaced') {\n          tableRow.children.forEach(function (tableCell) {\n            if (tableCell.data.diff_state === 'diff-replaced') {\n              if (tableCell.children[0].data.diff_state === 'diff-replaced') {\n                var splicedParagraphNodes = _this3.splitDiffParagraph(tableCell.children[0]);\n\n                tableCell.children = splicedParagraphNodes;\n              }\n            }\n          });\n        }\n      });\n      return node;\n    }\n  }]);\n\n  return SlateDiff;\n}();\n\nvar ArrayDiffElement = /*#__PURE__*/function () {\n  function ArrayDiffElement(item, newIndex, oldIndex) {\n    _classCallCheck(this, ArrayDiffElement);\n\n    this.item = item;\n    this.newIndex = newIndex;\n    this.oldIndex = oldIndex;\n  }\n\n  _createClass(ArrayDiffElement, [{\n    key: \"added\",\n    value: function added() {\n      return this.oldIndex === undefined;\n    }\n  }, {\n    key: \"removed\",\n    value: function removed() {\n      return this.newIndex === undefined;\n    }\n  }, {\n    key: \"common\",\n    value: function common() {\n      return this.oldIndex !== undefined && this.newIndex !== undefined;\n    }\n  }]);\n\n  return ArrayDiffElement;\n}();\n\nvar Diff = /*#__PURE__*/function () {\n  function Diff(opts) {\n    _classCallCheck(this, Diff);\n\n    this.equalFunc = opts.equalFunc ? opts.equalFunc : defaultEqualityFunction;\n    if (opts.shouldDetectChange != undefined) this.shouldDetectChange = opts.shouldDetectChange;else this.shouldDetectChange = false;\n    this.similarityFunc = opts.similarityFunc;\n  }\n  /**\n   Appends an array item to the subsequence of items that were added in the new array.\n   @method  added\n   @param   item   The array item that was added.\n   **/\n\n\n  _createClass(Diff, [{\n    key: \"addAdded\",\n    value: function addAdded(item, newIndex) {\n      var element = new ArrayDiffElement(item, newIndex, undefined);\n      element.changeType = 'added';\n      this.added.push(element);\n      this.diff.push(element);\n    }\n    /**\n     Appends an array item to the subsequence of items that were removed from the old array.\n     @method  removed\n     @param   item     The array item that was added.\n     **/\n\n  }, {\n    key: \"addRemoved\",\n    value: function addRemoved(item, oldIndex) {\n      var element = new ArrayDiffElement(item, undefined, oldIndex);\n      this.removed.push(element);\n      element.changeType = 'removed';\n      this.diff.push(element);\n    }\n  }, {\n    key: \"addReplaced\",\n    value: function addReplaced(oldItem, newItem, oldIndex, newIndex) {\n      var element = new ArrayDiffElement(oldItem, newIndex, oldIndex);\n      element.newItem = newItem;\n      element.oldItem = oldItem;\n      element.changeType = 'replaced';\n      this.replaced.push(element);\n      this.diff.push(element);\n    }\n    /**\n     Appends an array item to the longest common subsequence between the new and old arrays.\n     @method  common\n     @param   item    The array item that was added.\n     **/\n\n  }, {\n    key: \"addCommon\",\n    value: function addCommon(oldItem, newItem, oldIndex, newIndex) {\n      var element = new ArrayDiffElement(oldItem, newIndex, oldIndex);\n      element.newItem = newItem;\n      element.changeType = 'common';\n      element.oldItem = oldItem;\n      this.common.push(element);\n      this.diff.push(element);\n    }\n  }, {\n    key: \"StringDiff\",\n    value: function StringDiff(newString, oldString) {\n      var newLength = newString.length;\n      var oldLength = oldString.length;\n      var n = 0;\n      var o = 0;\n      var table = [];\n      table[newLength] = [];\n\n      for (o = oldLength; o >= 0; table[newLength][o--] = 0) {\n        ;\n      }\n\n      for (n = newLength - 1; n >= 0; n--) {\n        table[n] = [];\n        table[n][oldLength] = 0;\n\n        for (o = oldLength - 1; o >= 0; o--) {\n          if (this.equalFunc(newString[n], oldString[o])) {\n            table[n][o] = table[n + 1][o + 1] + 1;\n          } else {\n            table[n][o] = Math.max(table[n + 1][o], table[n][o + 1]);\n          }\n        }\n      } // Fill in the subsequence arrays\n\n\n      this.common = [];\n      this.added = [];\n      this.removed = [];\n      this.replaced = [];\n      this.diff = [];\n      n = o = 0;\n\n      while (n < newLength && o < oldLength) {\n        var diffState = this.equalFunc(newString[n], oldString[o]);\n\n        if (diffState) {\n          var newItem = newString[n];\n          var oldItem = oldString[o];\n          this.addCommon(oldItem, newItem, o, n);\n          n++;\n          o++;\n        } else if (table[n + 1][o] >= table[n][o + 1]) {\n          this.addAdded(newString[n], n);\n          n++;\n        } else {\n          this.addRemoved(oldString[o], o);\n          o++;\n        }\n      }\n\n      for (; n < newLength; n++) {\n        this.addAdded(newString[n], n);\n      }\n\n      for (; o < oldLength; o++) {\n        this.addRemoved(oldString[o], o);\n      }\n    }\n  }, {\n    key: \"ArrayDiff\",\n    value: function ArrayDiff(newArray, oldArray, callback) {\n      //newArray = newArray.toArray();\n      //oldArray = oldArray.toArray();\n      var newLength = newArray.length;\n      var oldLength = oldArray.length;\n      var n = 0;\n      var o = 0;\n      var table = []; // Build out the table\n\n      table[newLength] = [];\n\n      for (o = oldLength; o >= 0; table[newLength][o--] = 0) {\n        ;\n      }\n\n      for (n = newLength - 1; n >= 0; n--) {\n        table[n] = [];\n        table[n][oldLength] = 0;\n\n        for (o = oldLength - 1; o >= 0; o--) {\n          if (this.equalFunc(newArray[n], oldArray[o])) {\n            table[n][o] = table[n + 1][o + 1] + 1;\n          } else {\n            table[n][o] = Math.max(table[n + 1][o], table[n][o + 1]);\n          }\n        }\n      } // Fill in the subsequence arrays\n\n\n      this.common = [];\n      this.added = [];\n      this.removed = [];\n      this.replaced = [];\n      this.diff = [];\n      n = o = 0;\n\n      while (n < newLength && o < oldLength) {\n        var diffState = this.equalFunc(newArray[n], oldArray[o]);\n\n        if (diffState) {\n          var newItem = newArray[n];\n          var oldItem = oldArray[o];\n\n          if (diffState === 'changed') {\n            this.addReplaced(oldItem, newItem, o, n);\n          } else {\n            //if (newItem.isVoid) {\n            this.addCommon(oldItem, newItem, o, n);\n          }\n\n          if (callback) {\n            callback('C', o, n);\n          }\n\n          n++;\n          o++;\n        } else if (table[n + 1][o] >= table[n][o + 1]) {\n          this.addAdded(newArray[n], n);\n\n          if (callback) {\n            callback('A', 0, n);\n          }\n\n          n++;\n        } else {\n          this.addRemoved(oldArray[o], o);\n\n          if (callback) {\n            callback('D', o, 0);\n          }\n\n          o++;\n        }\n      }\n\n      for (; n < newLength; n++) {\n        this.addAdded(newArray[n], n);\n\n        if (callback) {\n          callback('A', 0, n);\n        }\n      }\n\n      for (; o < oldLength; o++) {\n        this.addRemoved(oldArray[o], o);\n\n        if (callback) {\n          callback('D', o, 0);\n        }\n      }\n    }\n  }]);\n\n  return Diff;\n}();\n\nvar Diff3 = /*#__PURE__*/function () {\n  function Diff3(opts) {\n    _classCallCheck(this, Diff3);\n\n    opts = opts || {};\n    this.equalFunc = opts.equalFunc ? opts.equalFunc : defaultEqualityFunction;\n    if (opts.shouldDetectChange != undefined) this.shouldDetectChange = opts.shouldDetectChange;else this.shouldDetectChange = false;\n    this.similarityFunc = opts.similarityFunc;\n    this.chunks = [];\n    this.common = [];\n    this.added = [];\n    this.removed = [];\n    this.mergedArray = [];\n  }\n\n  _createClass(Diff3, [{\n    key: \"diff3\",\n    value: function diff3(oArray, aArray, bArray) {\n      this.oArray = oArray;\n      this.aArray = aArray;\n      this.bArray = bArray;\n      var oaDiff = new Diff({\n        equalFunc: this.equalFunc,\n        shouldDetectChange: this.shouldDetectChange,\n        similarityFunc: this.similarityFunc\n      });\n      oaDiff.ArrayDiff(aArray, oArray);\n      var obDiff = new Diff({\n        equalFunc: this.equalFunc,\n        shouldDetectChange: this.shouldDetectChange,\n        similarityFunc: this.similarityFunc\n      });\n      obDiff.ArrayDiff(bArray, oArray);\n      var M_oa = [];\n\n      for (var i = 0; i < oArray.length; i++) {\n        M_oa[i] = [];\n\n        for (var j = 0; j < aArray.length; j++) {\n          M_oa[i][j] = 0;\n        }\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = oaDiff.common[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var item = _step.value;\n          M_oa[item.oldIndex][item.newIndex] = 1;\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.M_oa = M_oa;\n      var M_ob = [];\n\n      for (var _i = 0; _i < oArray.length; _i++) {\n        M_ob[_i] = [];\n\n        for (var _j = 0; _j < bArray.length; _j++) {\n          M_ob[_i][_j] = 0;\n        }\n      }\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = obDiff.common[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var _item = _step2.value;\n          M_ob[_item.oldIndex][_item.newIndex] = 1;\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      this.M_ob = M_ob;\n      /*\n      console.log(\"M_oa\");\n      console.log(M_oa);\n      console.log(\"M_ob\");\n      console.log(M_ob);\n      */\n\n      var lo = 0;\n      var la = 0;\n      var lb = 0;\n      var finalStable = undefined; // while (true) {\n      //   // find i that the cursor at the three array not match\n      //   let i = 0;\n      //   var iFound = false;\n      //   while (true) {\n      //     if (M_oa[lo+i][la+i] == 0 || M_ob[lo+i][lb+i] == 0) {\n      //       iFound = true;\n      //       break;\n      //     }\n      //     i++;\n      //     if (lo+i == oArray.length || la+i == aArray.length ||\n      //       lb+i == bArray.length)\n      //       break;\n      //   }\n      //   if (iFound == false) {\n      //     // go out and output a final stable chunk\n      //     //console.log(\"iFound == false\");\n      //     finalStable = true;\n      //     break;\n      //   }\n      //\n      //   if (i > 0) {\n      //     //console.log(\"stable chunk \");\n      //     var chunk = {};\n      //     chunk.startO = lo;\n      //     chunk.startA = la;\n      //     chunk.startB = lb;\n      //     chunk.endO = lo+i-1;\n      //     chunk.endA = la+i-1;\n      //     chunk.endB = lb+i-1;\n      //     chunk.isStable = true;\n      //     this.chunks.push(chunk);\n      //     //printChunk(oArray, aArray, bArray, chunk);\n      //     lo = lo + i;\n      //     la = la + i;\n      //     lb = lb + i;\n      //     continue;\n      //   }\n      //\n      //   //console.log(\"unstable chunk \");\n      //   let o;\n      //   let a;\n      //   let b;\n      //   let found = false;\n      //   for (o = lo; o < oArray.length; o++) {\n      //     for (a = la; a < aArray.length; a++) {\n      //       if (M_oa[o][a] != true) {\n      //         continue;\n      //       }\n      //\n      //       for (b = lb; b < bArray.length; b++) {\n      //         if (M_ob[o][b] == true) {\n      //           found = true;\n      //           break;\n      //         }\n      //       }\n      //       if (found == true) {\n      //         break;\n      //       }\n      //     }\n      //     if (found == true) {\n      //       break;\n      //     }\n      //   }\n      //\n      //   if (found == true) {\n      //     let chunk = {}\n      //     chunk.startO = lo;\n      //     chunk.startA = la;\n      //     chunk.startB = lb;\n      //     chunk.endO = o-1;\n      //     chunk.endA = a-1;\n      //     chunk.endB = b-1;\n      //     chunk.isStable = false;\n      //     this.chunks.push(chunk);\n      //     //printChunk(oArray, aArray, bArray, chunk);\n      //     lo = o;\n      //     la = a;\n      //     lb = b;\n      //     continue;\n      //   } else {\n      //     // output a final unstable chunk\n      //     finalStable = false;\n      //     break;\n      //   }\n      // }\n      // output the final chunk\n\n      if (lo < oArray.length || la < aArray.length || lb < bArray.length) {\n        //console.log(\"final chunk \");\n        var chunk = {};\n        chunk.startO = lo;\n        chunk.endO = oArray.length - 1;\n        chunk.startA = la;\n        chunk.endA = aArray.length - 1;\n        chunk.startB = lb;\n        chunk.endB = bArray.length - 1;\n        chunk.isStable = finalStable;\n        this.chunks.push(chunk); //printChunk(oArray, aArray, bArray, chunk);\n      }\n    }\n  }, {\n    key: \"calPatchChunk\",\n    value: function calPatchChunk(chunk) {\n      for (var i = chunk.startA; i <= chunk.endA; ++i) {\n        // find if item also in O\n        var found = false;\n\n        for (var j = chunk.startO; j <= chunk.endO; ++j) {\n          if (this.M_oa[j][i] === 1) {\n            // The item in both A and O\n            // The item is removed by B\n            found = true;\n            break;\n          }\n        }\n\n        if (found === false) {\n          // the item not found in O\n          // the item is added or modifed in A\n          // keep\n          this.mergedArray.push(this.aArray[i]);\n        }\n      }\n\n      for (var _i2 = chunk.startB; _i2 <= chunk.endB; ++_i2) {\n        // find if item also in O\n        var found = false;\n\n        for (var _j2 = chunk.startO; _j2 <= chunk.endO; ++_j2) {\n          if (this.M_ob[_j2][_i2] === 1) {\n            // The item in both B and O\n            // the item is removed by A (or moved by A)\n            // do nothing\n            found = true;\n            break;\n          }\n        }\n\n        if (found) continue; // the matched item not found in O\n        // the item is added or modifed in B\n\n        this.mergedArray.push(this.bArray[_i2]);\n      }\n    }\n  }, {\n    key: \"calPatch\",\n    value: function calPatch() {\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.chunks[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var chunk = _step3.value;\n\n          if (chunk.isStable) {\n            for (var i = 0; i + chunk.startA <= chunk.endA; ++i) {\n              var c = {};\n              c.indexA = i + chunk.startA;\n              c.indexO = i + chunk.startO;\n              c.indexB = i + chunk.startB; //this.common.push(c);\n\n              this.mergedArray.push(this.aArray[c.indexA]);\n            }\n          }\n\n          if (!chunk.isStable) {\n            this.calPatchChunk(chunk);\n          }\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n    }\n  }]);\n\n  return Diff3;\n}();\n\nexport { Diff, Diff3, equalityFunctionForSlate, SlateDiff };","import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport React from 'react';\nimport { SlateDiff } from '../utils/diff';\nimport { renderNode, renderLeaf } from '../utils/render-slate';\nimport SlateViewer from '../viewer/slate-viewer';\nimport LoadScript from '../editor/load-script';\nimport '../css/diff-viewer.css';\n\nvar DiffViewer = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(DiffViewer, _React$PureComponent);\n\n  function DiffViewer(_props) {\n    var _this;\n\n    _classCallCheck(this, DiffViewer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DiffViewer).call(this, _props));\n\n    _this.renderDiffNode = function (props) {\n      var element = props.element;\n      var data = element.data ? element.data : {};\n      var diffState = data['diff_state'];\n      var nodeDepth = data['node_depth'];\n\n      if (diffState === 'diff-added') {\n        if (nodeDepth > 1) {\n          if (element.type === 'blockquote' || element.type === 'code_block') {\n            return React.createElement(\"div\", {\n              className: 'diff-added-container'\n            }, renderNode(props));\n          }\n\n          return renderNode(props);\n        } else {\n          return React.createElement(\"div\", {\n            className: 'diff-added'\n          }, renderNode(props));\n        }\n      } else if (diffState === 'diff-removed') {\n        if (nodeDepth > 1) {\n          if (element.type === 'blockquote' || element.type === 'code_block') {\n            return React.createElement(\"div\", {\n              className: 'diff-removed-container'\n            }, renderNode(props));\n          }\n\n          return renderNode(props);\n        } else {\n          return React.createElement(\"div\", {\n            className: 'diff-removed'\n          }, renderNode(props));\n        }\n      } else if (diffState === 'diff-replaced') {\n        if (nodeDepth > 1) {\n          return renderNode(props);\n        } else {\n          return React.createElement(\"div\", {\n            className: 'diff-replaced'\n          }, renderNode(props));\n        }\n      } else {\n        return renderNode(props);\n      }\n    };\n\n    _this.value = [];\n    _this.slateDiff = new SlateDiff();\n    return _this;\n  }\n\n  _createClass(DiffViewer, [{\n    key: \"render\",\n    value: function render() {\n      var newMarkdownContent = this.props.newMarkdownContent;\n      var oldMarkdownContent = this.props.oldMarkdownContent;\n      this.value = this.slateDiff.getDiffDocument(newMarkdownContent, oldMarkdownContent);\n      return React.createElement(LoadScript, {\n        scriptSource: this.props.scriptSource\n      }, React.createElement(SlateViewer, {\n        style: {\n          width: '100%'\n        },\n        renderDiffElement: this.renderDiffNode,\n        renderDiffLeaf: renderLeaf,\n        value: this.value\n      }));\n    }\n  }]);\n\n  return DiffViewer;\n}(React.PureComponent);\n\nexport default DiffViewer;"],"sourceRoot":""}