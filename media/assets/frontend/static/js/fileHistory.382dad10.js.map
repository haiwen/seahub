{"version":3,"file":"static/js/fileHistory.382dad10.js","mappings":"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","sources":["components/history-list-view/history-list-item.js","components/history-list-view/history-list-view.js","pages/file-history/side-panel.js","pages/file-history/main-panel.js","file-history.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\n\nimport '../../css/history-record-item.css';\n\nmoment.locale(window.app.config.lang);\n\nconst propTypes = {\n  index: PropTypes.number.isRequired,\n  item: PropTypes.object.isRequired,\n  currentItem: PropTypes.object,\n  isItemFreezed: PropTypes.bool.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n  onFreezedItemToggle: PropTypes.func.isRequired,\n};\n\nclass HistoryListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: true});\n    }\n  };\n\n  onMouseLeave = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: false});\n    }\n  };\n\n  onToggleClick = (e) => {\n    this.setState({isMenuShow: !this.state.isMenuShow});\n    this.props.onFreezedItemToggle();\n  };\n\n  onItemClick = () => {\n    this.setState({isShowOperationIcon: false});  //restore to default state\n    if (this.props.item.commit_id === this.props.currentItem.commit_id) {\n      return;\n    }\n    let currentIndex = this.props.index;\n    this.props.onItemClick(this.props.item, currentIndex);\n  };\n\n  onItemRestore = () => {\n    this.props.onItemRestore(this.props.currentItem);\n  };\n\n  onItemDownload = () => {\n    // nothing todo\n  };\n\n  render() {\n    if (!this.props.currentItem) {\n      return '';\n    }\n    let item = this.props.item;\n    let time = moment(item.ctime).format('YYYY-MM-DD HH:mm');\n    let isHigtlightItem = false;\n    if (this.props.item && this.props.currentItem) {\n      isHigtlightItem = this.props.item.commit_id === this.props.currentItem.commit_id;\n    }\n    let objID = this.props.currentItem.rev_file_id;\n    let url = URLDecorator.getUrl({type: 'download_historic_file', filePath: filePath, objID: objID});\n    return (\n      <li\n        className={`history-list-item ${isHigtlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onItemClick}\n      >\n        <div className=\"history-info\">\n          <div className=\"time\">{time}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{item.creator_name}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHigtlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryListItem.propTypes = propTypes;\n\nexport default HistoryListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport HisotyListItem from './history-list-item';\nimport Loading from '../loading';\n\nconst propTypes = {\n  hasMore: PropTypes.bool.isRequired,\n  isReloadingData: PropTypes.bool.isRequired,\n  historyList: PropTypes.array.isRequired,\n  reloadMore: PropTypes.func.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n};\n\nclass HistoryListView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isItemFreezed: false,\n      currentItem: null,\n    };\n  }\n\n  componentDidMount = () => {\n    let historyList = this.props.historyList;\n    if (historyList.length > 0) {\n      this.setState({currentItem: historyList[0]});\n      if (historyList === 1) {\n        this.props.onItemClick(historyList[0]);\n      } else {\n        this.props.onItemClick(historyList[0], historyList[1]);\n      }\n    }\n  };\n\n  onFreezedItemToggle = () => {\n    this.setState({isItemFreezed: !this.state.isItemFreezed});\n  };\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop    = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    let hasMore = this.props.hasMore;\n    if (isBottom && hasMore) {\n      this.props.reloadMore();\n    }\n  };\n\n  onItemClick = (item, currentIndex) => {\n    this.setState({currentItem: item});\n    if (currentIndex !== this.props.historyList.length) {\n      let preItem = this.props.historyList[currentIndex + 1];\n      this.props.onItemClick(item, preItem);\n    } else {\n      this.props.onItemClick(item);\n    }\n  };\n\n  render() {\n    return (\n      <ul className=\"history-list-container\" onScroll={this.onScrollHandler}>\n        {this.props.historyList.map((item, index) => {\n          return (\n            <HisotyListItem\n              key={index}\n              item={item}\n              index={index}\n              currentItem={this.state.currentItem}\n              isItemFreezed={this.state.isItemFreezed}\n              onItemClick={this.onItemClick}\n              onItemRestore={this.props.onItemRestore}\n              onFreezedItemToggle={this.onFreezedItemToggle}\n            />\n          );\n        })}\n        {this.props.isReloadingData && <li><Loading /></li>}\n      </ul>\n    );\n  }\n}\n\nHistoryListView.propTypes = propTypes;\n\nexport default HistoryListView;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, PER_PAGE, filePath } from '../../utils/constants';\nimport editUtilities from '../../utils/editor-utilities';\nimport Loading from '../../components/loading';\nimport HistoryListView from '../../components/history-list-view/history-list-view';\nimport toaster from '../../components/toast';\n\nconst propTypes = {\n  onItemClick: PropTypes.func.isRequired,\n};\n\nclass SidePanel extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      historyInfo: '',\n      currentPage: 1,\n      hasMore: false,\n      isLoading: true,\n      isError: false,\n      fileOwner: '',\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      let historyList = res.data;\n      if (historyList.length === 0) {\n        this.setState({isLoading: false});\n        throw Error('there has an error in server');\n      }\n      this.initResultState(res.data);\n    });\n  }\n\n  refershFileList() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      this.initResultState(res.data);\n    });\n  }\n\n  initResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: result.data,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email,\n      });\n    }\n  }\n\n  updateResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: [...this.state.historyInfo, ...result.data],\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email\n      });\n    }\n  }\n\n  reloadMore = () => {\n    if (!this.state.isReloadingData) {\n      let currentPage = this.state.currentPage + 1;\n      this.setState({\n        currentPage: currentPage,\n        isReloadingData: true,\n      });\n      editUtilities.listFileHistoryRecords(filePath, currentPage, PER_PAGE).then(res => {\n        this.updateResultState(res.data);\n        this.setState({isReloadingData: false});\n      });\n    }\n  };\n\n  onItemRestore = (currentItem) => {\n    let commitId = currentItem.commit_id;\n    editUtilities.revertFile(filePath, commitId).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n      let message = gettext('Successfully restored.');\n      toaster.success(message);\n    });\n  };\n\n  onItemClick =(item, preItem) => {\n    this.props.onItemClick(item, preItem);\n  };\n\n  render() {\n    return (\n      <div className=\"side-panel history-side-panel\">\n        <div className=\"side-panel-center\">\n          <div className=\"history-side-panel-title\">{gettext('History Versions')}</div>\n          <div className=\"history-body\">\n            {this.state.isLoading && <Loading />}\n            {this.state.historyInfo &&\n              <HistoryListView\n                hasMore={this.state.hasMore}\n                isReloadingData={this.state.isReloadingData}\n                historyList={this.state.historyInfo}\n                reloadMore={this.reloadMore}\n                onItemClick={this.onItemClick}\n                onItemRestore={this.onItemRestore}\n              />\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = propTypes;\n\nexport default SidePanel;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Prism from 'prismjs';\nimport { DiffViewer } from '@seafile/seafile-editor';\nimport Loading from '../../components/loading';\nimport { mediaUrl } from '../../utils/constants';\n\nconst contentClass = 'markdown-viewer-render-content';\nconst propTypes = {\n  renderingContent: PropTypes.bool.isRequired,\n  content: PropTypes.string,\n  newMarkdownContent: PropTypes.string.isRequired,\n  oldMarkdownContent: PropTypes.string.isRequired,\n};\n\nclass MainPanel extends React.Component {\n\n  componentDidMount() {\n    Prism.highlightAll();\n  }\n\n  onSearchedClick = () => {\n    //todos;\n  };\n\n  render() {\n    return (\n      <div className=\"main-panel\">\n        <div className=\"main-panel-center content-viewer\">\n          <div className={contentClass}>\n            {\n              this.props.renderingContent ?\n                (<Loading />) :\n                (<div className=\"diff-view article\">\n                  <DiffViewer\n                    scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n                    newMarkdownContent={this.props.newMarkdownContent}\n                    oldMarkdownContent={this.props.oldMarkdownContent}\n                  />\n                </div>)\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nMainPanel.propTypes = propTypes;\n\nexport default MainPanel;\n","import React, { Fragment } from 'react';\nimport ReactDom from 'react-dom';\nimport axios from 'axios';\nimport { fileName, historyRepoID } from './utils/constants';\nimport { Utils } from './utils/utils';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport SidePanel from './pages/file-history/side-panel';\nimport MainPanel from './pages/file-history/main-panel';\nimport { seafileAPI } from './utils/seafile-api';\n\nimport './css/layout.css';\nimport './css/file-history.css';\nimport './css/toolbar.css';\nimport './css/search.css';\n\nclass FileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      renderingContent: true,\n      newMarkdownContent: '',\n      oldMarkdownContent: ''\n    };\n  }\n\n  onSearchedClick = (searchedItem) => {\n    Utils.handleSearchedItemClick(searchedItem);\n  };\n\n  setDiffContent = (newMarkdownContent, oldMarkdownContent)=> {\n    this.setState({\n      renderingContent: false,\n      newMarkdownContent: newMarkdownContent,\n      oldMarkdownContent: oldMarkdownContent,\n    });\n  };\n\n\n  onHistoryItemClick = (item, preItem)=> {\n    this.setState({renderingContent: true});\n    if (preItem) {\n      axios.all([\n        seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path),\n        seafileAPI.getFileRevision(historyRepoID, preItem.commit_id, preItem.path)\n      ]).then(axios.spread((res, res1) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n          seafileAPI.getFileContent(res1.data)\n        ]).then(axios.spread((content1, content2) => {\n          this.setDiffContent(content1.data, content2.data);\n        }));\n      }));\n    } else {\n      seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path).then((res) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n        ]).then(axios.spread((content1) => {\n          this.setDiffContent(content1.data, '');\n        }));\n      });\n    }\n  };\n\n  onBackClick = (event) => {\n    event.preventDefault();\n    window.history.back();\n  };\n\n  render() {\n    return(\n      <Fragment>\n        <div id=\"header\" className=\"history-header\">\n          <div className=\"title\">\n            <a href=\"#\" className=\"go-back\" title=\"Back\" onClick={this.onBackClick}>\n              <span className=\"fas fa-chevron-left\"></span>\n            </a>\n            <span className=\"name\">{fileName}</span>\n          </div>\n          <div className='toolbar'>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n        </div>\n        <div id=\"main\" className=\"history-content\">\n          <MainPanel\n            newMarkdownContent={this.state.newMarkdownContent}\n            oldMarkdownContent={this.state.oldMarkdownContent}\n            renderingContent={this.state.renderingContent}\n          />\n          <SidePanel onItemClick={this.onHistoryItemClick}/>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nReactDom.render(<FileHistory />, document.getElementById('wrapper'));\n"],"names":["moment","window","app","config","lang","_React$Component","_inherits","HistoryListItem","_super","_createSuper","props","_this","_classCallCheck","call","onMouseEnter","isItemFreezed","setState","isShowOperationIcon","onMouseLeave","onToggleClick","e","isMenuShow","state","onFreezedItemToggle","onItemClick","item","commit_id","currentItem","currentIndex","index","onItemRestore","onItemDownload","_createClass","key","value","this","time","ctime","format","isHigtlightItem","objID","rev_file_id","url","URLDecorator","getUrl","type","filePath","_jsxs","className","concat","onClick","children","_jsx","creator_name","Dropdown","isOpen","toggle","DropdownToggle","tag","alt","gettext","DropdownMenu","DropdownItem","href","onItemDownLoad","React","HistoryListView","componentDidMount","historyList","length","onScrollHandler","event","clientHeight","target","scrollHeight","isBottom","scrollTop","hasMore","reloadMore","preItem","_this2","onScroll","map","HisotyListItem","isReloadingData","Loading","SidePanel","currentPage","editUtilities","listFileHistoryRecords","PER_PAGE","then","res","updateResultState","data","commitId","revertFile","success","isLoading","refershFileList","message","toaster","historyInfo","isError","fileOwner","Error","initResultState","_this3","result","page","total_count","creator_email","_toConsumableArray","MainPanel","_len","arguments","args","Array","_key","apply","onSearchedClick","Prism","renderingContent","DiffViewer","scriptSource","mediaUrl","newMarkdownContent","oldMarkdownContent","FileHistory","searchedItem","Utils","handleSearchedItemClick","setDiffContent","onHistoryItemClick","axios","all","seafileAPI","getFileRevision","historyRepoID","path","spread","res1","getFileContent","content1","content2","onBackClick","preventDefault","history","back","Fragment","id","title","fileName","CommonToolbar","ReactDom","document","getElementById"],"sourceRoot":""}