"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[6245],{12086:function(e,t,a){var i=a(23029),s=a(92901),n=a(39874),o=a(85501),r=a(9950),l=a(8081),c=a(10877),d=a(6754),u=a(9341),h=a(40326),m=a(97011),g=a(65604),p=a(4086),f=a(20338),x=a(44414),P=function(e){function t(e){var a;return(0,i.default)(this,t),(a=(0,n.default)(this,t,[e])).handleInputChange=function(e){a.setState({inputValue:e})},a.formSubmit=function(){var e=a.state.inputValue.map((function(e,t){return e.value})).join(","),t=a.props,i=t.repoID,s=t.commitID;a.setState({submitBtnDisabled:!0}),m.e.updateRepoCommitLabels(i,s,e).then((function(e){var t=e.data.revisionTags.map((function(e){return e.tag}));a.props.updateCommitLabels(t),a.props.toggleDialog(),p.A.success((0,h.APU)("Successfully edited labels."))})).catch((function(e){var t=g.Aq.getErrorMsg(e);a.setState({formErrorMsg:t,submitBtnDisabled:!1})}))},a.state={inputValue:a.props.commitLabels.map((function(e,t){return{label:e,value:e}})),submitBtnDisabled:!1},a}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.state.formErrorMsg;return(0,x.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,x.jsx)(f.A,{toggle:this.props.toggleDialog,children:(0,h.APU)("Edit labels")}),(0,x.jsx)(c.A,{children:(0,x.jsxs)(r.Fragment,{children:[(0,x.jsx)(u.A,{defaultValue:this.props.commitLabels.map((function(e,t){return{label:e,value:e}})),isMulti:!0,onChange:this.handleInputChange,placeholder:"",noOptionsMessage:function(){return(0,h.APU)("No options available")},formatCreateLabel:function(e){return(0,h.APU)("Add option: %s").replace("%s",e)}}),e&&(0,x.jsx)("p",{className:"error m-0 mt-2",children:e})]})}),(0,x.jsx)(d.A,{children:(0,x.jsx)("button",{className:"btn btn-primary",disabled:this.state.submitBtnDisabled,onClick:this.formSubmit,children:(0,h.APU)("Submit")})})]})}}])}(r.Component);t.A=P},93498:function(e,t,a){var i=a(23029),s=a(92901),n=a(39874),o=a(85501),r=a(9950),l=a(1352),c=a(14894),d=a(4159),u=a.n(d),h=a(65604),m=a(40326),g=a(97011),p=a(9961),f=a(62376),x=a(40866),P=a(72991),b=a(33e3),D=a(12086),j=a(49434),v=a(95754),A=(a(40672),a(81848),a(44414)),w=window.app.pageOptions,C=w.repoID,U=w.repoName,L=w.userPerm,N=w.showLabel,S=function(e){function t(e){var a;return(0,i.default)(this,t),(a=(0,n.default)(this,t,[e])).getItems=function(e){g.e.getRepoHistory(C,e,a.state.perPage).then((function(t){a.setState({isLoading:!1,currentPage:e,items:t.data.data,hasNextPage:t.data.more})})).catch((function(e){a.setState({isLoading:!1,errorMsg:h.Aq.getErrorMsg(e,!0)})}))},a.resetPerPage=function(e){a.setState({perPage:e},(function(){a.getItems(1)}))},a.onSearchedClick=function(e){if(!0===e.is_dir){var t=m.YcY+"library/"+e.repo_id+"/"+e.repo_name+e.path;(0,c.oo)(t,{replace:!0})}else{var a=m.YcY+"lib/"+e.repo_id+"/file"+h.Aq.encodePath(e.path);window.open("about:blank").location.href=a}},a.goBack=function(e){e.preventDefault(),window.history.back()},a.state={isLoading:!0,errorMsg:"",currentPage:1,perPage:100,hasNextPage:!1,items:[]},a}return(0,o.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,a=this.state,i=a.currentPage,s=a.perPage;this.setState({perPage:parseInt(t.get("per_page")||s),currentPage:parseInt(t.get("page")||i)},(function(){e.getItems(e.state.currentPage)}))}},{key:"render",value:function(){var e=(0,m.APU)("{placeholder} Modification History");return e=e.replace("{placeholder}",'<span class="op-target text-truncate mx-1">'+h.Aq.HTMLescape(U)+"</span>"),(0,A.jsx)(r.Fragment,{children:(0,A.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,A.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[(0,A.jsx)("a",{href:m.YcY,children:(0,A.jsx)("img",{src:m.SGU+m.VIO,height:m.hMI,width:m.gAF,title:m.q0L,alt:"logo"})}),(0,A.jsx)(P.A,{onSearchedClick:this.onSearchedClick})]}),(0,A.jsx)("div",{className:"flex-auto container-fluid pt-4 pb-6 o-auto",children:(0,A.jsx)("div",{className:"row",children:(0,A.jsxs)("div",{className:"col-md-10 offset-md-1",children:[(0,A.jsx)("h2",{dangerouslySetInnerHTML:{__html:e},className:"d-flex text-nowrap"}),(0,A.jsx)("a",{href:"#",className:"go-back",title:(0,m.APU)("Back"),onClick:this.goBack,role:"button","aria-label":(0,m.APU)("Back"),children:(0,A.jsx)(v.A,{symbol:"down",className:"rotate-90"})}),"rw"==L&&(0,A.jsx)("p",{className:"tip",children:(0,m.APU)("Tip: a snapshot will be generated after modification, which records the library state after the modification.")}),(0,A.jsx)(M,{isLoading:this.state.isLoading,errorMsg:this.state.errorMsg,items:this.state.items,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getItems})]})})})]})})}}])}(r.Component),M=function(e){function t(e){var a;return(0,i.default)(this,t),(a=(0,n.default)(this,t,[e])).getPreviousPage=function(){a.props.getListByPage(a.props.currentPage-1)},a.getNextPage=function(){a.props.getListByPage(a.props.currentPage+1)},a.theadData=N?[{width:"43%",text:(0,m.APU)("Description")},{width:"12%",text:(0,m.APU)("Time")},{width:"9%",text:(0,m.APU)("Modifier")},{width:"12%",text:"".concat((0,m.APU)("Device")," / ").concat((0,m.APU)("Version"))},{width:"12%",text:(0,m.APU)("Labels")},{width:"12%",text:""}]:[{width:"43%",text:(0,m.APU)("Description")},{width:"15%",text:(0,m.APU)("Time")},{width:"15%",text:(0,m.APU)("Modifier")},{width:"15%",text:"".concat((0,m.APU)("Device")," / ").concat((0,m.APU)("Version"))},{width:"12%",text:""}],a}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props,t=e.isLoading,a=e.errorMsg,i=e.items,s=e.curPerPage,n=e.currentPage,o=e.hasNextPage;return t?(0,A.jsx)(p.A,{}):a?(0,A.jsx)("p",{className:"error mt-6 text-center",children:a}):(0,A.jsxs)(r.Fragment,{children:[(0,A.jsxs)("table",{className:"table-hover",children:[(0,A.jsx)("thead",{children:(0,A.jsx)("tr",{children:this.theadData.map((function(e,t){return(0,A.jsx)("th",{width:e.width,children:e.text},t)}))})}),(0,A.jsx)("tbody",{children:i.map((function(e,t){return e.isFirstCommit=1==n&&0==t,e.showDetails=o||t!=i.length-1,(0,A.jsx)(I,{item:e},t)}))})]}),(0,A.jsx)(f.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:n,hasNextPage:o,curPerPage:s,resetPerPage:this.props.resetPerPage})]})}}])}(r.Component),I=function(e){function t(e){var a;return(0,i.default)(this,t),(a=(0,n.default)(this,t,[e])).handleMouseOver=function(){a.setState({isIconShown:!0})},a.handleMouseOut=function(){a.setState({isIconShown:!1})},a.showCommitDetails=function(e){e.preventDefault(),a.setState({isCommitDetailsDialogOpen:!a.state.isCommitDetailsDialogOpen})},a.toggleCommitDetailsDialog=function(){a.setState({isCommitDetailsDialogOpen:!a.state.isCommitDetailsDialogOpen})},a.editLabel=function(e){e.preventDefault(),a.setState({isCommitLabelUpdateDialogOpen:!a.state.isCommitLabelUpdateDialogOpen})},a.toggleLabelEditDialog=function(){a.setState({isCommitLabelUpdateDialogOpen:!a.state.isCommitLabelUpdateDialogOpen})},a.updateLabels=function(e){a.setState({labels:e})},a.state={labels:a.props.item.tags,isIconShown:!1,isCommitLabelUpdateDialogOpen:!1,isCommitDetailsDialogOpen:!1},a}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,a=t.isIconShown,i=t.isCommitLabelUpdateDialogOpen,s=t.isCommitDetailsDialogOpen,n=t.labels,o="";return o=e.email?e.second_parent_id?(0,m.APU)("None"):(0,A.jsx)("a",{href:"".concat(m.YcY,"profile/").concat(encodeURIComponent(e.email),"/"),children:e.name}):(0,m.APU)("Unknown"),(0,A.jsxs)(r.Fragment,{children:[(0,A.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,A.jsxs)("td",{children:[e.description,e.showDetails&&(0,A.jsx)("a",{href:"#",className:"details",onClick:this.showCommitDetails,role:"button",children:(0,m.APU)("Details")})]}),(0,A.jsx)("td",{title:(0,j.l)(e.time),children:u()(e.time).format("YYYY-MM-DD")}),(0,A.jsx)("td",{children:o}),(0,A.jsx)("td",{children:e.client_version?"".concat(e.device_name," / ").concat(e.client_version):"API / --"}),N&&(0,A.jsxs)("td",{children:[n.map((function(e,t){return(0,A.jsx)("span",{className:"commit-label",children:e},t)})),"rw"==L&&(0,A.jsx)("a",{href:"#",role:"button",className:"attr-action-icon ".concat(a?"":"invisible"),title:(0,m.APU)("Edit"),"aria-label":(0,m.APU)("Edit"),onClick:this.editLabel,children:(0,A.jsx)(v.A,{symbol:"rename"})})]}),(0,A.jsx)("td",{children:"rw"==L&&(e.isFirstCommit?(0,A.jsx)("span",{className:a?"":"invisible",children:(0,m.APU)("Current Version")}):(0,A.jsx)("a",{href:"".concat(m.YcY,"repo/").concat(C,"/snapshot/?commit_id=").concat(e.commit_id),className:a?"":"invisible",children:(0,m.APU)("View Snapshot")}))})]}),s&&(0,A.jsx)(x.A,{children:(0,A.jsx)(b.A,{repoID:C,commitID:e.commit_id,commitTime:e.time,toggleDialog:this.toggleCommitDetailsDialog})}),i&&(0,A.jsx)(x.A,{children:(0,A.jsx)(D.A,{repoID:C,commitID:e.commit_id,commitLabels:n,updateCommitLabels:this.updateLabels,toggleDialog:this.toggleLabelEditDialog})})]})}}])}(r.Component);(0,l.createRoot)(document.getElementById("wrapper")).render((0,A.jsx)(S,{}))}},function(e){e.O(0,[4223],(function(){return t=93498,e(e.s=t);var t}));e.O()}]);