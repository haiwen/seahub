"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[5583],{65396:function(e,t,n){var r=n(23029),s=n(92901),a=n(39874),i=n(85501),o=n(9950),l=n(1352),c=n(48738),d=n.n(c),h=n(14894),u=n(65604),m=n(40326),f=n(97011),p=n(9961),x=n(40866),g=n(4086),j=n(72991),b=n(8081),v=n(10877),A=n(6754),P=n(34322),N=n(20338),k=n(44414),w=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).action=function(){n.setState({btnDisabled:!0}),n.props.restoreRepo()},n.state={btnDisabled:!1},n}return(0,i.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props.toggle;return(0,k.jsxs)(b.A,{centered:!0,isOpen:!0,toggle:e,children:[(0,k.jsx)(N.A,{toggle:e,children:(0,m.APU)("Restore Library")}),(0,k.jsx)(v.A,{children:(0,k.jsx)("p",{children:(0,m.APU)("Are you sure you want to restore this library?")})}),(0,k.jsxs)(A.A,{children:[(0,k.jsx)(P.A,{color:"secondary",onClick:e,children:(0,m.APU)("Cancel")}),(0,k.jsx)(P.A,{color:"primary",onClick:this.action,disabled:this.state.btnDisabled,children:(0,m.APU)("Restore")})]})]})}}])}(o.Component),U=(n(18291),n(81848),window.app.pageOptions),C=U.repoID,y=U.repoName,F=U.canRestoreRepo,I=U.commitID,D=U.commitTime,M=U.commitDesc,R=U.commitRelativeTime,O=U.showAuthor,S=U.authorAvatarURL,_=U.authorName,q=U.authorNickName,Y=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).toggleDialog=function(){n.setState({isConfirmDialogOpen:!n.state.isConfirmDialogOpen})},n.onSearchedClick=function(e){if(!0===e.is_dir){var t=m.YcY+"library/"+e.repo_id+"/"+e.repo_name+e.path;(0,h.oo)(t,{replace:!0})}else{var n=m.YcY+"lib/"+e.repo_id+"/file"+u.Aq.encodePath(e.path);window.open("about:blank").location.href=n}},n.goBack=function(e){e.preventDefault(),window.history.back()},n.renderFolder=function(e){n.setState({folderPath:e,folderItems:[],isLoading:!0}),f.e.listCommitDir(C,I,e).then((function(e){n.setState({isLoading:!1,folderItems:e.data.dirent_list})})).catch((function(e){n.setState({isLoading:!1,errorMsg:u.Aq.getErrorMsg(e,!0)})}))},n.clickFolderPath=function(e,t){t.preventDefault(),n.renderFolder(e)},n.renderPath=function(){var e=n.state.folderPath,t=e.split("/");return"/"==e?(0,k.jsx)("span",{className:"text-truncate",title:y,children:y}):(0,k.jsxs)(o.Fragment,{children:[(0,k.jsx)("a",{href:"#",onClick:n.clickFolderPath.bind(n,"/"),className:"text-truncate",title:y,children:y}),(0,k.jsx)("span",{className:"mx-1",children:"/"}),t.map((function(e,r){return r>0&&r!=t.length-1?(0,k.jsxs)(o.Fragment,{children:[(0,k.jsx)("a",{href:"#",onClick:n.clickFolderPath.bind(n,t.slice(0,r+1).join("/")),className:"text-truncate",title:t[r],children:t[r]}),(0,k.jsx)("span",{className:"mx-1",children:"/"})]},r):null})),(0,k.jsx)("span",{className:"text-truncate",title:t[t.length-1],children:t[t.length-1]})]})},n.restoreRepo=function(){f.e.revertRepo(C,I).then((function(e){n.toggleDialog(),g.A.success((0,m.APU)("Successfully restored the library."))})).catch((function(e){var t=u.Aq.getErrorMsg(e);n.toggleDialog(),g.A.danger(t)}))},n.state={isLoading:!0,errorMsg:"",folderPath:"/",folderItems:[],isConfirmDialogOpen:!1},n}return(0,i.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){this.renderFolder(this.state.folderPath)}},{key:"render",value:function(){var e=this.state,t=e.isConfirmDialogOpen,n=e.folderPath,r=(0,m.APU)("{placeholder} Snapshot");return r=r.replace("{placeholder}",'<span class="op-target text-truncate mx-1">'+u.Aq.HTMLescape(y)+"</span>"),(0,k.jsxs)(o.Fragment,{children:[(0,k.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,k.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[(0,k.jsx)("a",{href:m.YcY,children:(0,k.jsx)("img",{src:m.SGU+m.VIO,height:m.hMI,width:m.gAF,title:m.q0L,alt:"logo"})}),(0,k.jsx)(j.A,{onSearchedClick:this.onSearchedClick})]}),(0,k.jsx)("div",{className:"flex-auto container-fluid pt-4 pb-6 o-auto",children:(0,k.jsx)("div",{className:"row",children:(0,k.jsxs)("div",{className:"col-md-10 offset-md-1",children:[(0,k.jsxs)("h2",{children:[(0,k.jsx)("span",{dangerouslySetInnerHTML:{__html:r},className:"d-flex mw-100"}),(0,k.jsxs)("span",{className:"heading-commit-time ml-1",children:["(",D,")"]})]}),(0,k.jsx)("a",{href:"#",className:"go-back",title:(0,m.APU)("Back"),role:"button","aria-label":(0,m.APU)("Back"),onClick:this.goBack,children:(0,k.jsx)("span",{className:"sf3-font sf3-font-down rotate-90 d-inline-block"})}),"/"==n&&(0,k.jsxs)("div",{className:"d-flex mb-2 align-items-center",children:[(0,k.jsx)("p",{className:"m-0 text-truncate",title:M,children:M}),(0,k.jsxs)("div",{className:"ml-4 border-start pl-4 d-flex align-items-center flex-shrink-0",children:[O?(0,k.jsxs)(o.Fragment,{children:[(0,k.jsx)("img",{src:S,width:"20",height:"20",alt:"",className:"rounded mr-1"}),(0,k.jsx)("a",{href:"".concat(m.YcY,"profile/").concat(encodeURIComponent(_),"/"),children:q})]}):(0,k.jsx)("span",{children:(0,m.APU)("Unknown")}),(0,k.jsx)("p",{className:"m-0 ml-2",dangerouslySetInnerHTML:{__html:R}})]})]}),(0,k.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[(0,k.jsxs)("p",{className:"m-0 text-truncate d-flex",children:[(0,k.jsx)("span",{className:"mr-1",children:(0,m.APU)("Current path: ")}),this.renderPath()]}),"/"==n&&F&&(0,k.jsx)("button",{className:"btn btn-secondary op-bar-btn flex-shrink-0 ml-4",onClick:this.toggleDialog,children:(0,m.APU)("Restore")})]}),(0,k.jsx)(L,{data:this.state,renderFolder:this.renderFolder})]})})})]}),t&&(0,k.jsx)(x.A,{children:(0,k.jsx)(w,{restoreRepo:this.restoreRepo,toggle:this.toggleDialog})})]})}}])}(o.Component),L=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).theadData=[{width:"5%",text:""},{width:"55%",text:(0,m.APU)("Name")},{width:"20%",text:(0,m.APU)("Size")},{width:"20%",text:""}],n}return(0,i.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this,t=this.props.data,n=t.isLoading,r=t.errorMsg,s=t.folderPath,a=t.folderItems;return n?(0,k.jsx)(p.A,{}):r?(0,k.jsx)("p",{className:"error mt-6 text-center",children:r}):(0,k.jsxs)("table",{className:"table-hover",children:[(0,k.jsx)("thead",{children:(0,k.jsx)("tr",{children:this.theadData.map((function(e,t){return(0,k.jsx)("th",{width:e.width,children:e.text},t)}))})}),(0,k.jsx)("tbody",{children:a.map((function(t,n){return(0,k.jsx)(H,{item:t,folderPath:s,renderFolder:e.props.renderFolder},n)}))})]})}}])}(o.Component),H=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).handleMouseOver=function(){n.setState({isHighlighted:!0,isIconShown:!0})},n.handleMouseOut=function(){n.setState({isHighlighted:!1,isIconShown:!1})},n.restoreItem=function(){var e=n.props.item,t=u.Aq.joinPath(n.props.folderPath,e.name);("dir"==e.type?f.e.revertFolder(C,t,I):f.e.revertFile(C,t,I)).then((function(e){g.A.success((0,m.APU)("Restored 1 item"))})).catch((function(e){var t=u.Aq.getErrorMsg(e);g.A.danger(t)}))},n.renderFolder=function(e){e.preventDefault();var t=n.props.item,r=n.props.folderPath;n.props.renderFolder(u.Aq.joinPath(r,t.name))},n.state={isHighlighted:!1,isIconShown:!1},n}return(0,i.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,n=t.isIconShown,r=t.isHighlighted,s=this.props.folderPath;return"dir"==e.type?(0,k.jsxs)("tr",{className:d()({"tr-highlight":r}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,k.jsx)("td",{className:"text-center",children:(0,k.jsx)("img",{src:u.Aq.getFolderIconUrl(),alt:(0,m.APU)("Folder"),width:"24"})}),(0,k.jsx)("td",{children:(0,k.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.name})}),(0,k.jsx)("td",{}),(0,k.jsx)("td",{children:(0,k.jsx)("i",{role:"button",className:"op-icon sf2-icon-reply ".concat(n?"":"invisible"),onClick:this.restoreItem,title:(0,m.APU)("Restore"),"aria-label":(0,m.APU)("Restore")})})]}):(0,k.jsxs)("tr",{className:d()({"tr-highlight":r}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,k.jsx)("td",{className:"text-center",children:(0,k.jsx)("img",{src:u.Aq.getFileIconUrl(e.name),alt:(0,m.APU)("File"),width:"24"})}),(0,k.jsx)("td",{children:(0,k.jsx)("a",{href:"".concat(m.YcY,"repo/").concat(C,"/snapshot/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(I,"&p=").concat(encodeURIComponent(u.Aq.joinPath(s,e.name))),target:"_blank",rel:"noreferrer",children:e.name})}),(0,k.jsx)("td",{children:u.Aq.bytesToSize(e.size)}),(0,k.jsx)("td",{children:(0,k.jsxs)("div",{className:"d-flex align-items-center",children:[(0,k.jsx)("i",{className:"op-icon sf2-icon-reply ".concat(n?"":"invisible"),onClick:this.restoreItem,title:(0,m.APU)("Restore"),"aria-label":(0,m.APU)("Restore"),role:"button"}),(0,k.jsx)("a",{href:"".concat(m.YcY,"repo/").concat(C,"/").concat(e.obj_id,"/download/?file_name=").concat(encodeURIComponent(e.name),"&p=").concat(encodeURIComponent(u.Aq.joinPath(s,e.name))),className:"op-icon sf3-font sf3-font-download1 ".concat(n?"":"invisible"),title:(0,m.APU)("Download")})]})})]})}}])}(o.Component);(0,l.createRoot)(document.getElementById("wrapper")).render((0,k.jsx)(Y,{}))}},function(e){e.O(0,[4223],(function(){return t=65396,e(e.s=t);var t}));e.O()}]);