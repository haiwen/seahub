{"version":3,"sources":["components/dialog/clean-trash.js","repo-folder-trash.js"],"names":["CleanTrash","props","handleInputChange","value","setState","inputValue","formSubmit","state","repoID","submitBtnDisabled","seafileAPI","deleteRepoTrash","then","res","toaster","success","gettext","refreshTrash","toggleDialog","catch","error","errorMsg","Utils","getErrorMsg","formErrorMsg","options","label","this","Modal","isOpen","centered","toggle","ModalHeader","ModalBody","Fragment","defaultValue","autoFocus","onChange","placeholder","className","ModalFooter","disabled","onClick","React","Component","window","app","pageOptions","repoFolderName","path","enableClean","RepoFolderTrash","getItems","scanStat","getRepoFolderTrash","data","more","scan_stat","length","isLoading","items","concat","getMore","onSearchedClick","selectedItem","is_dir","url","siteRoot","repo_id","repo_name","navigate","repalce","encodePath","open","location","href","goBack","e","preventDefault","history","back","cleanTrash","toggleCleanTrashDialog","isCleanTrashDialogOpen","showFolder","renderFolder","commitID","baseDir","folderPath","folderItems","listCommitDir","substr","dirent_list","response","status","clickRoot","clickFolderPath","renderFolderPath","pathList","split","map","item","index","bind","slice","join","src","mediaUrl","logoPath","height","logoHeight","width","logoWidth","title","siteTitle","alt","generateDialogTitle","role","Content","theadData","text","Item","handleMouseOver","isIconShown","handleMouseOut","restoreItem","commit_id","parent_dir","obj_name","restoreFolder","restoreFile","restored","error_msg","danger","joinPath","onMouseOver","onMouseOut","onFocus","getFolderIconUrl","moment","deleted_time","format","getFileIconUrl","obj_id","encodeURIComponent","target","bytesToSize","size","FolderItem","name","type","ReactDom","render","document","getElementById"],"mappings":"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","file":"static/js/repoFolderTrash.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Modal, ModalHeader, ModalBody, ModalFooter } from 'reactstrap';\nimport CreatableSelect from 'react-select/creatable';\nimport { gettext } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\n\nconst propTypes = {\n  repoID: PropTypes.string.isRequired,\n  refreshTrash: PropTypes.func.isRequired,\n  toggleDialog: PropTypes.func.isRequired\n};\n\nclass CleanTrash extends React.Component {\n  constructor(props) {\n    super(props);\n    this.options = [\n      {label: gettext('3 days ago'), value: 3},\n      {label: gettext('1 week ago'), value: 7},\n      {label: gettext('1 month ago'), value: 30},\n      {label: gettext('all'), value: 0}\n    ];\n    this.state = {\n      inputValue: this.options[0],\n      submitBtnDisabled: false\n    };\n  }\n\n  handleInputChange = (value) => {\n    this.setState({\n      inputValue: value\n    });\n  }\n\n  formSubmit = () => {\n    const inputValue = this.state.inputValue;\n    const { repoID } = this.props;\n\n    this.setState({\n      submitBtnDisabled: true\n    });\n\n    seafileAPI.deleteRepoTrash(repoID, inputValue.value).then((res) => {\n      toaster.success(gettext('Clean succeeded.'));\n      this.props.refreshTrash();\n      this.props.toggleDialog();\n    }).catch((error) => {\n      let errorMsg = Utils.getErrorMsg(error);\n      this.setState({\n        formErrorMsg: errorMsg,\n        submitBtnDisabled: false\n      });\n    });\n  }\n\n  render() {\n    const { formErrorMsg } = this.state;\n    return (\n      <Modal isOpen={true} centered={true} toggle={this.props.toggleDialog}>\n        <ModalHeader toggle={this.props.toggleDialog}>{gettext('Clean')}</ModalHeader>\n        <ModalBody>\n          <React.Fragment>\n            <p>{gettext('Clear files in trash and history：')}</p>\n            <CreatableSelect\n              defaultValue={this.options[0]}\n              options={this.options}\n              autoFocus={false}\n              onChange={this.handleInputChange}\n              placeholder=''\n            />\n            {formErrorMsg && <p className=\"error m-0 mt-2\">{formErrorMsg}</p>}\n          </React.Fragment>\n        </ModalBody>\n        <ModalFooter>\n          <button className=\"btn btn-primary\" disabled={this.state.submitBtnDisabled} onClick={this.formSubmit}>{gettext('Submit')}</button>\n        </ModalFooter>\n      </Modal>\n    );\n  }\n}\n\nCleanTrash.propTypes = propTypes;\n\nexport default CleanTrash;\n","import React from 'react';\nimport ReactDom from 'react-dom';\nimport { navigate } from '@gatsbyjs/reach-router';\nimport moment from 'moment';\nimport { Utils } from './utils/utils';\nimport { gettext, siteRoot, mediaUrl, logoPath, logoWidth, logoHeight, siteTitle } from './utils/constants';\nimport { seafileAPI } from './utils/seafile-api';\nimport Loading from './components/loading';\nimport ModalPortal from './components/modal-portal';\nimport toaster from './components/toast';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport CleanTrash from './components/dialog/clean-trash';\n\nimport './css/toolbar.css';\nimport './css/search.css';\n\nimport './css/repo-folder-trash.css';\n\nconst {\n  repoID,\n  repoFolderName,\n  path,\n  enableClean\n} = window.app.pageOptions;\n\nclass RepoFolderTrash extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      errorMsg: '',\n      items: [],\n      scanStat: null,\n      more: false,\n      isCleanTrashDialogOpen: false\n    };\n  }\n\n  componentDidMount() {\n    this.getItems();\n  }\n\n  getItems = (scanStat) => {\n    seafileAPI.getRepoFolderTrash(repoID, path, scanStat).then((res) => {\n      const { data, more, scan_stat } = res.data;\n      if (!data.length && more) {\n        this.getItems(scan_stat);\n      } else {\n        this.setState({\n          isLoading: false,\n          items: this.state.items.concat(data),\n          more: more,\n          scanStat: scan_stat\n        });\n      }\n    }).catch((error) => {\n      this.setState({\n        isLoading: false,\n        errorMsg: Utils.getErrorMsg(error, true) // true: show login tip if 403\n      });\n    });\n  }\n\n  getMore = () => {\n    this.setState({\n      isLoading: true\n    });\n    this.getItems(this.state.scanStat);\n  }\n\n  onSearchedClick = (selectedItem) => {\n    if (selectedItem.is_dir === true) {\n      let url = siteRoot + 'library/' + selectedItem.repo_id + '/' + selectedItem.repo_name + selectedItem.path;\n      navigate(url, {repalce: true});\n    } else {\n      let url = siteRoot + 'lib/' + selectedItem.repo_id + '/file' + Utils.encodePath(selectedItem.path);\n      let newWindow = window.open('about:blank');\n      newWindow.location.href = url;\n    }\n  }\n\n  goBack = (e) => {\n    e.preventDefault();\n    window.history.back();\n  }\n\n  cleanTrash = () => {\n    this.toggleCleanTrashDialog();\n  }\n\n  toggleCleanTrashDialog = () => {\n    this.setState({\n      isCleanTrashDialogOpen: !this.state.isCleanTrashDialogOpen\n    });\n  }\n\n  refreshTrash = () => {\n    this.setState({\n      isLoading: true,\n      errorMsg: '',\n      items: [],\n      scanStat: null,\n      more: false,\n      showFolder: false\n    });\n    this.getItems();\n  }\n\n  renderFolder = (commitID, baseDir, folderPath) => {\n    this.setState({\n      showFolder: true,\n      commitID: commitID,\n      baseDir: baseDir,\n      folderPath: folderPath,\n      folderItems: [],\n      isLoading: true\n    });\n\n    seafileAPI.listCommitDir(repoID, commitID, `${baseDir.substr(0, baseDir.length - 1)}${folderPath}`).then((res) => {\n      this.setState({\n        isLoading: false,\n        folderItems: res.data.dirent_list\n      });\n    }).catch((error) => {\n      if (error.response) {\n        if (error.response.status == 403) {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Permission denied')\n          });\n        } else {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Error')\n          });\n        }\n      } else {\n        this.setState({\n          isLoading: false,\n          errorMsg: gettext('Please check the network.')\n        });\n      }\n    });\n  }\n\n  clickRoot = (e) => {\n    e.preventDefault();\n    this.refreshTrash();\n  }\n\n  clickFolderPath = (folderPath, e) => {\n    e.preventDefault();\n    const { commitID, baseDir } = this.state;\n    this.renderFolder(commitID, baseDir, folderPath);\n  }\n\n  renderFolderPath = () => {\n    const pathList = this.state.folderPath.split('/');\n    return (\n      <React.Fragment>\n        <a href=\"#\" onClick={this.clickRoot}>{repoFolderName}</a>\n        <span> / </span>\n        {pathList.map((item, index) => {\n          if (index > 0 && index != pathList.length - 1) {\n            return (\n              <React.Fragment key={index}>\n                <a href=\"#\" onClick={this.clickFolderPath.bind(this, pathList.slice(0, index+1).join('/'))}>{pathList[index]}</a>\n                <span> / </span>\n              </React.Fragment>\n            );\n          }\n        }\n        )}\n        {pathList[pathList.length - 1]}\n      </React.Fragment>\n    );\n  }\n\n  render() {\n    const { isCleanTrashDialogOpen, showFolder } = this.state;\n\n    return (\n      <React.Fragment>\n        <div className=\"h-100 d-flex flex-column\">\n          <div className=\"top-header d-flex justify-content-between\">\n            <a href={siteRoot}>\n              <img src={mediaUrl + logoPath} height={logoHeight} width={logoWidth} title={siteTitle} alt=\"logo\" />\n            </a>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n          <div className=\"flex-auto container-fluid pt-4 pb-6 o-auto\">\n            <div className=\"row\">\n              <div className=\"col-md-10 offset-md-1\">\n                <h2>{Utils.generateDialogTitle(gettext('{placeholder} Trash'), repoFolderName)}</h2>\n                <a href=\"#\" className=\"go-back\" title={gettext('Back')} onClick={this.goBack} role={gettext('Back')}>\n                  <span className=\"fas fa-chevron-left\"></span>\n                </a>\n                <div className=\"d-flex justify-content-between align-items-center op-bar\">\n                  <p className=\"m-0\">{gettext('Current path: ')}{showFolder ? this.renderFolderPath() : repoFolderName}</p>\n                  {(path == '/' && enableClean && !showFolder) &&\n                  <button className=\"btn btn-secondary clean\" onClick={this.cleanTrash}>{gettext('Clean')}</button>\n                  }\n                </div>\n                <Content\n                  data={this.state}\n                  getMore={this.getMore}\n                  renderFolder={this.renderFolder}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n        {isCleanTrashDialogOpen &&\n        <ModalPortal>\n          <CleanTrash\n            repoID={repoID}\n            refreshTrash={this.refreshTrash}\n            toggleDialog={this.toggleCleanTrashDialog}\n          />\n        </ModalPortal>\n        }\n      </React.Fragment>\n    );\n  }\n}\n\nclass Content extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.theadData = [\n      {width: '5%', text: ''},\n      {width: '45%', text: gettext('Name')},\n      {width: '20%', text: gettext('Delete Time')},\n      {width: '15%', text: gettext('Size')},\n      {width: '15%', text: ''}\n    ];\n  }\n\n  render() {\n    const { isLoading, errorMsg, items, more, showFolder, commitID, baseDir, folderPath, folderItems } = this.props.data;\n\n    return (\n      <React.Fragment>\n        <table className=\"table-hover\">\n          <thead>\n            <tr>\n              {this.theadData.map((item, index) => {\n                return <th key={index} width={item.width}>{item.text}</th>;\n              })}\n            </tr>\n          </thead>\n          <tbody>\n            {showFolder ?\n              folderItems.map((item, index) => {\n                return <FolderItem\n                  key={index}\n                  item={item}\n                  commitID={commitID}\n                  baseDir={baseDir}\n                  folderPath={folderPath}\n                  renderFolder={this.props.renderFolder}\n                />;\n              }) :\n              items.map((item, index) => {\n                return <Item\n                  key={index}\n                  item={item}\n                  renderFolder={this.props.renderFolder}\n                />;\n              })}\n          </tbody>\n        </table>\n        {isLoading && <Loading />}\n        {errorMsg && <p className=\"error mt-6 text-center\">{errorMsg}</p>}\n        {(more && !isLoading && !showFolder) && (\n          <button className=\"btn btn-block more mt-6\" onClick={this.props.getMore}>{gettext('More')}</button>\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nclass Item extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      restored: false,\n      isIconShown: false\n    };\n  }\n\n  handleMouseOver = () => {\n    this.setState({isIconShown: true});\n  }\n\n  handleMouseOut = () => {\n    this.setState({isIconShown: false});\n  }\n\n  restoreItem = (e) => {\n    e.preventDefault();\n\n    const item = this.props.item;\n    const { commit_id, parent_dir, obj_name } = item;\n    const path = parent_dir + obj_name;\n    const request = item.is_dir ?\n      seafileAPI.restoreFolder(repoID, commit_id, path) :\n      seafileAPI.restoreFile(repoID, commit_id, path);\n    request.then((res) => {\n      this.setState({\n        restored: true\n      });\n      toaster.success(gettext('Successfully restored 1 item.'));\n    }).catch((error) => {\n      let errorMsg = '';\n      if (error.response) {\n        errorMsg = error.response.data.error_msg || gettext('Error');\n      } else {\n        errorMsg = gettext('Please check the network.');\n      }\n      toaster.danger(errorMsg);\n    });\n  }\n\n  renderFolder = (e) => {\n    e.preventDefault();\n    const item = this.props.item;\n    this.props.renderFolder(item.commit_id, item.parent_dir, Utils.joinPath('/', item.obj_name));\n  }\n\n  render() {\n    const item = this.props.item;\n    const { restored, isIconShown } = this.state;\n\n    if (restored) {\n      return null;\n    }\n\n    return item.is_dir ? (\n      <tr onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut} onFocus={this.handleMouseOver}>\n        <td className=\"text-center\"><img src={Utils.getFolderIconUrl()} alt={gettext('Directory')} width=\"24\" /></td>\n        <td><a href=\"#\" onClick={this.renderFolder}>{item.obj_name}</a></td>\n        <td title={moment(item.deleted_time).format('LLLL')}>{moment(item.deleted_time).format('YYYY-MM-DD')}</td>\n        <td></td>\n        <td>\n          <a href=\"#\" className={isIconShown ? '': 'invisible'} onClick={this.restoreItem} role=\"button\">{gettext('Restore')}</a>\n        </td>\n      </tr>\n    ) : (\n      <tr onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut} onFocus={this.handleMouseOver}>\n        <td className=\"text-center\"><img src={Utils.getFileIconUrl(item.obj_name)} alt={gettext('File')} width=\"24\" /></td>\n        <td><a href={`${siteRoot}repo/${repoID}/trash/files/?obj_id=${item.obj_id}&commit_id=${item.commit_id}&base=${encodeURIComponent(item.parent_dir)}&p=${encodeURIComponent('/' + item.obj_name)}`} target=\"_blank\">{item.obj_name}</a></td>\n        <td title={moment(item.deleted_time).format('LLLL')}>{moment(item.deleted_time).format('YYYY-MM-DD')}</td>\n        <td>{Utils.bytesToSize(item.size)}</td>\n        <td>\n          <a href=\"#\" className={isIconShown ? '': 'invisible'} onClick={this.restoreItem} role=\"button\">{gettext('Restore')}</a>\n        </td>\n      </tr>\n    );\n  }\n}\n\nclass FolderItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isIconShown: false\n    };\n  }\n\n  handleMouseOver = () => {\n    this.setState({isIconShown: true});\n  }\n\n  handleMouseOut = () => {\n    this.setState({isIconShown: false});\n  }\n\n  renderFolder = (e) => {\n    e.preventDefault();\n\n    const item = this.props.item;\n    const { commitID, baseDir, folderPath } = this.props;\n    this.props.renderFolder(commitID, baseDir, Utils.joinPath(folderPath, item.name));\n  }\n\n  render() {\n    const item = this.props.item;\n    const { isIconShown } = this.state;\n    const { commitID, baseDir, folderPath } = this.props;\n\n    return item.type == 'dir' ? (\n      <tr onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut}>\n        <td className=\"text-center\"><img src={Utils.getFolderIconUrl()} alt={gettext('Directory')} width=\"24\" /></td>\n        <td><a href=\"#\" onClick={this.renderFolder}>{item.name}</a></td>\n        <td></td>\n        <td></td>\n        <td></td>\n      </tr>\n    ) : (\n      <tr onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut}>\n        <td className=\"text-center\"><img src={Utils.getFileIconUrl(item.name)} alt={gettext('File')} width=\"24\" /></td>\n        <td><a href={`${siteRoot}repo/${repoID}/trash/files/?obj_id=${item.obj_id}&commit_id=${commitID}&base=${encodeURIComponent(baseDir)}&p=${encodeURIComponent(Utils.joinPath(folderPath, item.name))}`} target=\"_blank\">{item.name}</a></td>\n        <td></td>\n        <td>{Utils.bytesToSize(item.size)}</td>\n        <td></td>\n      </tr>\n    );\n  }\n}\n\nReactDom.render(<RepoFolderTrash />, document.getElementById('wrapper'));\n"],"sourceRoot":""}