"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[6419],{29009:function(e,t,n){var i=n(23029),o=n(92901),r=n(39874),s=n(85501),a=n(9950),d=n(5495),l=n(34940),c=n(65276),p=n(69123),u=n(92795),h=n(46757),f=n(31095),m=n(65604),v=n(95754),g=n(44414),w=function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,r.default)(this,t,[e])).registerHandlers=function(){document.addEventListener("mousedown",n.handleOutsideClick),document.addEventListener("touchstart",n.handleOutsideClick),document.addEventListener("scroll",n.handleHide),document.addEventListener("contextmenu",n.handleHide),document.addEventListener("keydown",n.handleKeyNavigation),window.addEventListener("resize",n.handleHide)},n.unregisterHandlers=function(){document.removeEventListener("mousedown",n.handleOutsideClick),document.removeEventListener("touchstart",n.handleOutsideClick),document.removeEventListener("scroll",n.handleHide),document.removeEventListener("contextmenu",n.handleHide),document.removeEventListener("keydown",n.handleKeyNavigation),window.removeEventListener("resize",n.handleHide)},n.handleShow=function(e){if(e.detail.id===n.props.id){var t=e.detail.position,i=t.x,o=t.y;if(n.props.getMenuContainerSize){var r=n.props.getMenuContainerSize(),s=i-(window.innerWidth-parseFloat(r.width)),a=o-(window.innerHeight-parseFloat(r.height));n.setState({x:s,y:a})}else n.setState({x:i,y:o});var d=e.detail,l=d.currentObject,c=d.menuList;n.setState({isVisible:!0,currentObject:l,menuList:c}),n.registerHandlers(),(0,f._$)(n.props.onShowMenu,e)}},n.handleHide=function(e){!n.state.isVisible||e.detail&&e.detail.id&&e.detail.id!==n.props.id||(n.unregisterHandlers(),n.setState({isVisible:!1}),(0,f._$)(n.props.onHideMenu,e))},n.handleOutsideClick=function(e){n.menu.contains(e.target)||(0,h.ks)()},n.handleMouseLeave=function(e){e.preventDefault()},n.handleContextMenu=function(e){n.handleHide(e)},n.handleKeyNavigation=function(e){!1!==n.state.isVisible&&(e.preventDefault(),n.hideMenu(e))},n.hideMenu=function(e){27!==e.keyCode&&13!==e.keyCode||(0,h.ks)()},n.getMenuPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i={top:t,left:e};if(!n.menu)return i;var o=window,r=o.innerWidth,s=o.innerHeight,a=n.menu.getBoundingClientRect();if(n.props.getMenuContainerSize){var d=n.props.getMenuContainerSize();r=parseFloat(d.width),s=parseFloat(d.height)}return t+a.height>s-10&&(i.top=s-a.height-10),e+a.width>r-10&&(i.left=r-a.width-10),i.left<0&&(i.left=a.width<r?(r-a.width)/2:0),i.top<0&&(i.top=a.height<s?(s-a.height)/2:0),i},n.onMenuItemClick=function(e){e.stopPropagation();var t=m.Aq.getEventData(e,"operation"),i=n.state.currentObject;n.props.onMenuItemClick(t,i,e)},n.onContextMenu=function(e){e.stopPropagation()},n.onDropDownMouseMove=function(e){n.state.isSubMenuShown&&n.setState({isSubMenuShown:!1})},n.toggleSubMenu=function(e){e.stopPropagation(),n.setState({isSubMenuShown:!n.state.isSubMenuShown})},n.toggleSubMenuShown=function(e){n.setState({isSubMenuShown:!0,currentItem:e.key})},n.state={x:0,y:0,isVisible:!1,currentObject:null,menuList:[],isSubMenuShown:!1,currentItem:""},n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){this.listenId=u.A.register(this.handleShow,this.handleHide)}},{key:"componentDidUpdate",value:function(){var e=this;if(this.state.isVisible){var t=window.requestAnimationFrame||setTimeout;t((function(){var n=e.state,i=n.x,o=n.y,r=e.getMenuPosition(i,o),s=r.top,a=r.left;t((function(){e.menu&&(e.menu.style.top="".concat(s,"px"),e.menu.style.left="".concat(a,"px"),e.menu.style.opacity=1,e.menu.style.pointerEvents="auto")}))}))}else{if(!this.menu)return;this.menu.style.opacity=0,this.menu.style.pointerEvents="none"}}},{key:"componentWillUnmount",value:function(){this.listenId&&u.A.unregister(this.listenId),this.unregisterHandlers()}},{key:"render",value:function(){var e=this;return(0,g.jsx)("div",{role:"menu",className:"seafile-contextmenu dropdown-menu",style:{position:"fixed",opacity:0,pointerEvents:"none",display:"block"},ref:function(t){e.menu=t},children:this.state.menuList.map((function(t,n){return"Divider"===t?(0,g.jsx)("div",{className:"seafile-divider dropdown-divider"},n):t.subOpList?(0,g.jsxs)(d.A,{direction:"right",className:"w-100",isOpen:e.state.isSubMenuShown&&e.state.currentItem==t.key,toggle:e.toggleSubMenu,onMouseMove:function(e){e.stopPropagation()},children:[(0,g.jsxs)(p.A,{tag:"span",className:"dropdown-item font-weight-normal rounded-0 d-flex align-items-center",onMouseEnter:e.toggleSubMenuShown.bind(e,t),children:[(0,g.jsx)("span",{className:"mr-auto",children:t.value}),(0,g.jsx)(v.A,{symbol:"down",className:"rotate-270"})]}),(0,g.jsx)(c.A,{children:t.subOpList.map((function(t,n){return"Divider"==t?(0,g.jsx)(l.A,{divider:!0},n):(0,g.jsx)(l.A,{"data-operation":t.key,onClick:e.onMenuItemClick,onContextMenu:e.onContextMenu,children:t.value},n)}))})]},n):(0,g.jsx)("button",{className:"seafile-contextmenu-item dropdown-item","data-operation":t.key,onClick:e.onMenuItemClick,onContextMenu:e.onContextMenu,onMouseMove:e.onDropDownMouseMove,children:t.value},n)}))})}}])}(a.Component);t.A=w},54352:function(e,t,n){n.d(t,{A:function(){return C}});var i=n(23029),o=n(92901),r=n(39874),s=n(85501),a=n(9950),d=n(5495),l=n(69123),c=n(65276),p=n(34940),u=n(48738),h=n.n(u),f=n(92795),m=n(40326),v=n(65604),g=n(40866),w=n(95754),k=n(44414),x=function(e){var t=e.menuItem,n=e.onClick,i=e.onKeyDown,o=e.onMouseMove,r=e.tickable,s=void 0!==r&&r,d=e.isSubMenuItem,l=void 0!==d&&d,c=(0,a.useCallback)((function(e){n&&n(e)}),[n]),u=(0,a.useCallback)((function(e){i&&i(e)}),[i]);return(0,k.jsxs)(p.A,{className:h()({"position-relative pl-5":s&&!l}),"data-toggle":t.key,onClick:c,onKeyDown:u,onMouseMove:l?void 0:o,children:[!l&&t.tick&&(0,k.jsx)("span",{className:"dropdown-item-tick",children:(0,k.jsx)(w.A,{symbol:"check-thin"})}),t.icon_dom||null,l?(0,k.jsx)("span",{children:t.value}):t.value]})},C=(n(55351),function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,r.default)(this,t,[e])).removeUselessDivider=function(e){for(;e&&"Divider"===e[0];)e.shift();return e},n.onShowMenu=function(){},n.onHideMenu=function(){n.state.isItemMenuShow&&(n.setState({isItemMenuShow:!1,isSubMenuShown:!1}),"function"===typeof n.props.unfreezeItem&&n.props.unfreezeItem())},n.onDropdownToggleKeyDown=function(e){"Enter"!=e.key&&"Space"!=e.key||n.onDropdownToggleClick(e)},n.onDropdownToggleClick=function(e){e.preventDefault(),e.stopPropagation(),n.toggleOperationMenu()},n.toggleOperationMenu=function(){n.setState({isItemMenuShow:!n.state.isItemMenuShow,isSubMenuShown:!1},(function(){n.state.isItemMenuShow&&"function"===typeof n.props.freezeItem?n.props.freezeItem():n.state.isItemMenuShow||"function"!==typeof n.props.unfreezeItem||n.props.unfreezeItem()}))},n.onMenuItemKeyDown=function(e){"Enter"!=e.key&&"Space"!=e.key||n.onMenuItemClick(e)},n.onMenuItemClick=function(e){var t,i=null!==(t=v.Aq.getEventData(e,"toggle"))&&void 0!==t?t:e.currentTarget.getAttribute("data-toggle"),o=n.props.item;"function"===typeof n.props.unfreezeItem&&n.props.unfreezeItem(),n.props.onMenuItemClick(i,e,o),n.setState({isItemMenuShow:!1})},n.onDropDownMouseMove=function(){n.state.isSubMenuShown&&n.setState({isSubMenuShown:!1})},n.toggleSubMenu=function(e){e.stopPropagation(),n.setState({isSubMenuShown:!n.state.isSubMenuShown})},n.toggleSubMenuShown=function(e){n.setState({isSubMenuShown:!0,currentItem:e.key})},n.state={menuList:[],isItemMenuShow:!1,isSubMenuShown:!1,currentItem:""},n.dropdownRef=a.createRef(),n.mainMenuDirection="down",n.subMenuDirection="right",n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.isHandleContextMenuEvent;(void 0===t||t)&&(this.listenerId=f.A.register(this.onShowMenu,this.onHideMenu)),this.setState({menuList:this.removeUselessDivider(this.props.getMenuList(this.props.item))}),setTimeout((function(){if(e.dropdownRef.current){var t,n=e.dropdownRef.current.getBoundingClientRect(),i=window.innerHeight-n.bottom,o=n.top;if(i<400&&o<400)t=window.innerWidth-n.right>=200?"right":"left";else t=i<400?"up":"down";e.mainMenuDirection=t,e.subMenuDirection=window.innerWidth-e.dropdownRef.current.getBoundingClientRect().right<400?"left":"right"}}),1)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.removeUselessDivider(e.getMenuList(e.item));e.item.name===this.props.item.name&&this.state.menuList===t||this.setState({menuList:t})}},{key:"componentWillUnmount",value:function(){var e=this.props.isHandleContextMenuEvent;(void 0===e||e)&&this.listenerId&&f.A.unregister(this.listenerId)}},{key:"render",value:function(){var e=this,t=this.state.menuList,n=this.props,i=n.toggleClass,o=n.toggleChildren,r=n.tagName,s=n.menuStyle,a=void 0===s?{}:s;return t.length?r&&"button"===r?(0,k.jsxs)(d.A,{isOpen:this.state.isItemMenuShow,toggle:this.onDropdownToggleClick,children:[(0,k.jsx)(l.A,{tag:"span",className:h()("more-dropdown-toggle",i),"data-toggle":"dropdown",title:(0,m.APU)("More operations"),"aria-label":(0,m.APU)("More operations"),"aria-expanded":this.state.isItemMenuShow,onKeyDown:this.onDropdownToggleKeyDown,children:o}),(0,k.jsx)(c.A,{children:t.map((function(t,n){return"Divider"===t?(0,k.jsx)(p.A,{divider:!0},n):(0,k.jsx)(p.A,{"data-toggle":t.key,onClick:e.onMenuItemClick,onKeyDown:e.onMenuItemKeyDown,children:t.value},n)}))})]}):(0,k.jsxs)(d.A,{isOpen:this.state.isItemMenuShow,toggle:this.onDropdownToggleClick,className:"vam",direction:this.mainMenuDirection,children:[(0,k.jsx)(l.A,{tag:r||"span",role:"button",tabIndex:"0",className:h()("more-dropdown-toggle",i),title:(0,m.APU)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.isItemMenuShow,"aria-label":(0,m.APU)("More operations"),onKeyDown:this.onDropdownToggleKeyDown,innerRef:this.dropdownRef,children:(0,k.jsx)(w.A,{symbol:"more-level"})}),(0,k.jsx)(g.A,{children:(0,k.jsx)(c.A,{style:a,children:t.map((function(t,n){return"Divider"===t?(0,k.jsx)(p.A,{divider:!0},n):t.subOpList?(0,k.jsxs)(d.A,{direction:e.subMenuDirection,className:"w-100",isOpen:e.state.isSubMenuShown&&e.state.currentItem==t.key,toggle:e.toggleSubMenu,onMouseMove:function(e){e.stopPropagation()},children:[(0,k.jsxs)(l.A,{tag:"span",className:"dropdown-item font-weight-normal rounded-0 d-flex align-items-center",onMouseEnter:e.toggleSubMenuShown.bind(e,t),children:[(0,k.jsx)("span",{className:"mr-auto",children:t.value}),(0,k.jsx)(w.A,{symbol:"down",className:"rotate-270"})]}),(0,k.jsxs)(c.A,{children:[t.subOpListHeader&&(0,k.jsx)(p.A,{header:!0,children:t.subOpListHeader}),t.subOpList.map((function(t,n){return"Divider"==t?(0,k.jsx)(p.A,{divider:!0},n):(0,k.jsx)(x,{menuItem:t,onClick:e.onMenuItemClick,onKeyDown:e.onMenuItemKeyDown,isSubMenuItem:!0},n)}))]})]},n):(0,k.jsx)(x,{menuItem:t,onClick:e.onMenuItemClick,onKeyDown:e.onMenuItemKeyDown,onMouseMove:e.onDropDownMouseMove,tickable:e.props.tickable},n)}))})})]}):""}}])}(a.Component))},79837:function(e,t,n){n.d(t,{A:function(){return w}});var i=n(23029),o=n(92901),r=n(39874),s=n(85501),a=n(9950),d=n(94634),l=n(40326),c=n(54352),p=n(65604),u=n(45613),h=n(95754),f=n(44414),m=function(e){function t(e){var n;(0,i.default)(this,t),(n=(0,r.default)(this,t,[e])).onMouseEnter=function(){n.props.isItemFreezed||n.setState({isShowOperationMenu:!0,isHighlight:!0})},n.onMouseOver=function(){n.props.isItemFreezed||n.setState({isShowOperationMenu:!0,isHighlight:!0})},n.onMouseLeave=function(){n.props.isItemFreezed||n.setState({isShowOperationMenu:!1,isHighlight:!1})},n.onNodeClick=function(){var e=n.props.node.object;if(e.isDir())n.props.onNodeClick(n.props.node);else{var t=p.Aq.getUserPermission(e.permission),i=t.isCustomPermission,o=t.customPermission;if(i){var r=o.permission,s=r.preview,a=r.modify;if(!s&&!a)return}n.props.onNodeClick(n.props.node)}},n.onLoadToggle=function(e){e.stopPropagation();var t=n.props.node;t.isExpanded?n.props.onNodeCollapse(t):n.props.onNodeExpanded(t)},n.onNodeDragStart=function(e){if(p.Aq.isIEBrowser()||!n.canDrag)return!1;n.props.onNodeDragStart(e,n.props.node)},n.onNodeDragEnter=function(e){if(p.Aq.isIEBrowser()||!n.canDrag)return!1;"dir"===n.props.node.object.type&&n.setState({isNodeDropShow:!0}),n.props.onNodeDragEnter(e,n.props.node)},n.onNodeDragMove=function(e){if(p.Aq.isIEBrowser()||!n.canDrag)return!1;n.props.onNodeDragMove(e)},n.onNodeDragLeave=function(e){if(p.Aq.isIEBrowser()||!n.canDrag)return!1;n.setState({isNodeDropShow:!1}),n.props.onNodeDragLeave(e,n.props.node)},n.onNodeDrop=function(e){if(p.Aq.isIEBrowser()||!n.canDrag)return!1;e.stopPropagation(),n.setState({isNodeDropShow:!1}),n.props.onNodeDrop(e,n.props.node)},n.unfreezeItem=function(){n.setState({isShowOperationMenu:!1}),n.props.unfreezeItem()},n.onMenuItemClick=function(e,t,i){n.props.onMenuItemClick(e,i)},n.onItemMouseDown=function(e){e.stopPropagation(),e.button},n.onItemContextMenu=function(e){n.handleContextClick(e)},n.handleContextClick=function(e){n.props.handleContextClick(e,n.props.node),n.setState({isShowOperationMenu:!1})},n.getNodeTypeAndIcon=function(){var e=n.props.node,t="",i="";if("dir"===e.object.type)t=(0,f.jsx)(h.A,{symbol:"folder",className:"sf3-font-folder-icon"}),i="dir";else{var o=e.object.name.lastIndexOf(".");if(-1===o)t=(0,f.jsx)(h.A,{symbol:"file"}),i="file";else{var r=e.object.name.slice(o).toLowerCase();".png"===r||".jpg"===r||".jpeg"===r||".gif"===r||".bmp"===r?(t=(0,f.jsx)(h.A,{symbol:"gallery"}),i="image"):(t=(0,f.jsx)(h.A,{symbol:"file"}),i="file")}}return{icon:t,type:i}},n.calculateMenuList=function(e){var t=d.A.NEW_FOLDER,i=d.A.NEW_FILE,o=d.A.COPY,r=d.A.MOVE,s=d.A.RENAME,a=d.A.DELETE,l=d.A.OPEN_VIA_CLIENT,c=[s,a,o,r,l];"dir"===e.object.type&&(c=[t,i,o,r,s,a]);var u=n.props.userPerm,h=p.Aq.getUserPermission(u),f=h.isCustomPermission,m=h.customPermission;if(!f)return c;c=[];var v=m.permission,g=v.create,w=v.modify,k=v.delete,x=v.copy;return"dir"===e.object.type&&g&&c.push(t,i),x&&c.push(o),w&&c.push(r,s),k&&c.push(a),"dir"!==e.object.type&&c.push(l),c},n.renderChildren=function(){var e=n.props.node;return e.hasChildren()?(0,f.jsx)("div",{className:"children",children:e.children.map((function(e){return(0,f.jsx)(t,{node:e,leftIndent:n.props.leftIndent+20,userPerm:n.props.userPerm,currentPath:n.props.currentPath,isNodeMenuShow:n.props.isNodeMenuShow,isItemFreezed:n.props.isItemFreezed,onNodeClick:n.props.onNodeClick,onNodeCollapse:n.props.onNodeCollapse,onNodeExpanded:n.props.onNodeExpanded,freezeItem:n.props.freezeItem,onMenuItemClick:n.props.onMenuItemClick,unfreezeItem:n.unfreezeItem,onNodeDragStart:n.props.onNodeDragStart,onNodeDragMove:n.props.onNodeDragMove,onNodeDrop:n.props.onNodeDrop,onNodeDragEnter:n.props.onNodeDragEnter,onNodeDragLeave:n.props.onNodeDragLeave,handleContextClick:n.props.handleContextClick,isDisplayFiles:n.props.isDisplayFiles},e.path)}))}):""},n.state={isHighlight:!1,isShowOperationMenu:!1,isNodeDropShow:!1};var o=e.userPerm;n.canDrag="rw"===o;var s=p.Aq.getUserPermission(o),a=s.isCustomPermission,l=s.customPermission;if(a){var c=l.permission.modify;n.canDrag=c}return n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.isItemFreezed||this.setState({isShowOperationMenu:!1,isHighlight:!1})}},{key:"render",value:function(){var e=this.props,t=e.currentPath,n=e.node,i=e.isNodeMenuShow,o=e.userPerm,r=e.leftIndent,s=this.getNodeTypeAndIcon(),a=s.type,d=s.icon,h=this.state.isHighlight?"tree-node-inner-hover ":"";if(n.path===t&&(h="tree-node-hight-light"),"/"!==n.path&&"dir"!==a&&!this.props.isDisplayFiles)return"";var m=p.Aq.getUserPermission(o).isCustomPermission;return(0,f.jsxs)("div",{className:"tree-node",children:[(0,f.jsxs)("div",{type:a,className:"tree-node-inner text-nowrap ".concat(h," ").concat("/"===n.path?"hide":""," ").concat(this.state.isNodeDropShow?"tree-node-drop":""),title:n.object.name,onMouseEnter:this.onMouseEnter,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,onMouseDown:this.onItemMouseDown,onContextMenu:this.onItemContextMenu,onClick:this.onNodeClick,onKeyDown:p.Aq.onKeyDown,onFocus:this.onMouseEnter,tabIndex:"0",children:[(0,f.jsx)("div",{className:"tree-node-text",draggable:this.canDrag,onDragStart:this.onNodeDragStart,onDragEnter:this.onNodeDragEnter,onDragLeave:this.onNodeDragLeave,onDragOver:this.onNodeDragMove,onDrop:this.onNodeDrop,style:{paddingLeft:r+5},children:n.object.name}),(0,f.jsxs)("div",{className:"left-icon",style:{left:r-40},children:["dir"===a&&(!n.isLoaded||n.isLoaded&&n.hasChildren())&&(0,f.jsx)(u.A,{className:"folder-toggle-icon ".concat(n.isExpanded?"":"rotate-270"),symbol:"down",title:n.isExpanded?(0,l.APU)("Fold"):(0,l.APU)("Unfold"),onMouseDown:function(e){return e.stopPropagation()},op:this.onLoadToggle}),(0,f.jsx)("span",{className:"tree-node-icon",children:d})]}),i&&("rw"===o||l.EK0||m)&&this.state.isShowOperationMenu&&(0,f.jsx)("div",{className:"right-icon",children:(0,f.jsx)(c.A,{item:this.props.node,getMenuList:this.calculateMenuList,onMenuItemClick:this.onMenuItemClick,freezeItem:this.props.freezeItem,unfreezeItem:this.unfreezeItem,menuStyle:p.Fr?{zIndex:1050}:{}})})]}),n.isExpanded&&this.renderChildren()]})}}])}(a.Component),v=n(29009),g=n(46757),w=function(e){function t(e){var n;(0,i.default)(this,t),(n=(0,r.default)(this,t,[e])).onNodeDragStart=function(e,t){if(p.Aq.isIEBrowser())return!1;var n={nodeDirent:t.object,nodeParentPath:t.parentNode.path,nodeRootPath:t.path};n=JSON.stringify(n),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/drag-item-info",n)},n.onNodeDragEnter=function(e,t){if(p.Aq.isIEBrowser()||!n.canDrop)return!1;e.persist(),"tree-view tree "===e.target.className&&n.setState({isTreeViewDropTipShow:!0})},n.onNodeDragMove=function(e){if(p.Aq.isIEBrowser()||!n.canDrop)return!1;e.preventDefault(),e.dataTransfer.dropEffect="move"},n.onNodeDragLeave=function(e,t){if(p.Aq.isIEBrowser()||!n.canDrop)return!1;"tree-view tree tree-view-drop"===e.target.className&&n.setState({isTreeViewDropTipShow:!1})},n.onContainerClick=function(e){(0,g.ks)()},n.onNodeClick=function(e){(0,g.ks)(),n.props.onNodeClick(e)},n.onNodeDrop=function(e,t){if(p.Aq.isIEBrowser()||!n.canDrop)return!1;if(!e.dataTransfer.files.length){var i=e.dataTransfer.getData("application/drag-item-info");if(i){var o=i=JSON.parse(i),r=o.nodeDirent,s=o.nodeParentPath,a=o.nodeRootPath,d=t;if(Array.isArray(i))return d?void n.onMoveItems(i,d,n.props.currentRepoInfo,d.path):("/"===i[0].nodeParentPath||n.props.onItemsMove(n.props.currentRepoInfo,"/"),void n.setState({isTreeViewDropTipShow:!1}));if(!d)return"/"===s||n.props.onItemMove(n.props.currentRepoInfo,r,"/",s),void n.setState({isTreeViewDropTipShow:!1});if("dir"===d.object.type&&s!==d.path&&(s!==d.parentNode.path||d.object.name!==r.name)){if("dir"===d.object.type&&"dir"===r.type)if(d.parentNode.path!==s)if(p.Aq.getPaths(d.path).includes(a))return;n.props.onItemMove(n.props.currentRepoInfo,r,d.path,s)}}}},n.onMoveItems=function(e,t,i,o){var r=[],s=p.Aq.getPaths(o);(e.forEach((function(e){var t=e.nodeRootPath;r.push(t)})),"dir"===t.object.type)&&(r.some((function(e){return e===o}))||e[0].nodeParentPath&&e[0].nodeParentPath===t.path||r.some((function(e){return s.includes(e)}))||n.props.onItemsMove(i,o))},n.freezeItem=function(){n.setState({isItemFreezed:!0})},n.unfreezeItem=function(){n.setState({isItemFreezed:!1})},n.onMenuItemClick=function(e,t){n.props.onMenuItemClick(e,t),(0,g.ks)()},n.onMouseDown=function(e){e.stopPropagation(),e.button},n.onContextMenu=function(e){e.preventDefault();var t=n.props.currentRepoInfo;if("admin"!==t.permission&&"rw"!==t.permission)return"";n.handleContextClick(e)},n.handleContextClick=function(e,t){if(e.preventDefault(),e.stopPropagation(),n.props.isNodeMenuShow){var i=e.clientX||e.touches&&e.touches[0].pageX,o=e.clientY||e.touches&&e.touches[0].pageY;n.props.posX&&(i-=n.props.posX),n.props.posY&&(o-=n.props.posY),(0,g.ks)();var r=n.getMenuList(t),s={id:"tree-node-contextmenu",position:{x:i,y:o},target:e.target,currentObject:t,menuList:r};(0,g.db)(s)}},n.getMenuList=function(e){var t=[],i=d.A.NEW_FOLDER,o=d.A.NEW_FILE,r=d.A.COPY,s=d.A.MOVE,a=d.A.RENAME,l=d.A.DELETE,c=d.A.OPEN_VIA_CLIENT;if(!e)return[i,o];t="dir"===e.object.type?[i,o,r,s,a,l]:[a,l,r,s,c];var u=n.props.userPerm,h=p.Aq.getUserPermission(u),f=h.isCustomPermission,m=h.customPermission;if(!f)return t;t=[];var v=m.permission,g=v.create,w=v.modify,k=v.delete,x=v.copy;return e?("dir"===e.object.type&&g&&t.push(i,o),x&&t.push(r),w&&t.push(s,a),k&&t.push(l),"dir"!==e.object.type&&t.push(c),t):(g&&t.push(i,o),t)},n.onShowMenu=function(){n.freezeItem()},n.onHideMenu=function(){n.unfreezeItem()},n.state={isItemFreezed:!1,isTreeViewDropTipShow:!1};var o=e.userPerm;n.canDrop="rw"===o;var s=p.Aq.getUserPermission(o),a=s.isCustomPermission,l=s.customPermission;if(a){var c=l.permission.modify;n.canDrop=c}return n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){return(0,f.jsxs)("div",{className:"tree-view tree ".concat(this.state.isTreeViewDropTipShow&&this.canDrop?"tree-view-drop":""),onDrop:this.onNodeDrop,onDragEnter:this.onNodeDragEnter,onDragLeave:this.onNodeDragLeave,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onClick:this.onContainerClick,children:[(0,f.jsx)(m,{userPerm:this.props.userPerm,node:this.props.treeData.root,currentPath:this.props.currentPath,leftIndent:20,isNodeMenuShow:this.props.isNodeMenuShow,isItemFreezed:this.state.isItemFreezed,onNodeClick:this.onNodeClick,onMenuItemClick:this.props.onMenuItemClick,onNodeExpanded:this.props.onNodeExpanded,onNodeCollapse:this.props.onNodeCollapse,onNodeDragStart:this.onNodeDragStart,freezeItem:this.freezeItem,unfreezeItem:this.unfreezeItem,onNodeDragMove:this.onNodeDragMove,onNodeDrop:this.onNodeDrop,onNodeDragEnter:this.onNodeDragEnter,onNodeDragLeave:this.onNodeDragLeave,handleContextClick:this.handleContextClick,isDisplayFiles:this.props.isDisplayFiles}),(0,f.jsx)(v.A,{id:"tree-node-contextmenu",onMenuItemClick:this.onMenuItemClick,onHideMenu:this.onHideMenu,onShowMenu:this.onShowMenu,getMenuContainerSize:this.props.getMenuContainerSize})]})}}])}(a.Component)},17312:function(e,t,n){var i=n(9950),o=n(1352),r=n(23029),s=n(92901),a=n(39874),d=n(85501),l=n(4159),c=n.n(l),p=n(37609),u=n.n(p),h=n(53496),f=n(8081),m=n(65604),v=n(40326),g=n(97011),w=n(84878),k=n(56044),x=n(25547),C=n(49403),D=n(9961),N=n(79837),M=n(92203),S=function(){return(0,s.default)((function e(t){var n=t.name,i=t.href,o=t.parentNode;(0,r.default)(this,e),this.name=n,this.href=i,this.parentNode=o||null,this.children=[]}),[{key:"setParent",value:function(e){this.parentNode=e}},{key:"addChildren",value:function(e){this.children=e}}])}(),y=function(e,t){var n=e.name,i="/"===t?t+n:t+"/"+n;e.path=i,e.children.length>0&&e.children.forEach((function(e){y(e,i)}))},j=function(e){var t;if(e.children[1]&&"link"===e.children[1].type){var n=e.children[1],i=n.children[0],o=i?i.text:"";t=new S({name:o,href:n.url})}else if(e.children[0]){var r=e.children[0],s=r.text?r.text:"";t=new S({name:s,href:""})}else t=new S({name:"",href:""});return t},A=function(e,t){var n=e.map((function(e){if(2!==e.children.length||"unordered_list"!==e.children[1].type&&"ordered_list"!==e.children[1].type)return e.children[0]&&"paragraph"===e.children[0].type?j(e.children[0]):new S({name:"",href:""});var t=e.children[0],n=j(t),i=e.children[1];return A(i.children,n)}));return t.addChildren(n),t},L=n(48738),I=n.n(L),b=n(95754),P=n(44414),E=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).toggleExpanded=function(){var e=n.state.expanded;n.setState({expanded:!e})},n.onLinkClick=function(e){e.preventDefault();var t=n.props.node,i=n.state.expanded;t.children&&t.children.length>0&&!i?n.setState({expanded:!i}):n.props.onLinkClick(t)},n.itemClick=function(){var e=n.props.node,t=n.state.expanded;e.children&&e.children.length>0&&n.setState({expanded:!t})},n.renderLink=function(e){var t=e.href,i=e.name,o=e.path,r=e.children,s=n.props.currentPath,a=I()("wiki-nav-content",{"no-children":!r||0===r.length,"wiki-nav-content-highlight":s===o});return t&&i?(0,P.jsx)("div",{className:a,children:(0,P.jsx)("a",{href:t,"data-path":o,onClick:n.onLinkClick,title:i,children:i})}):i?(0,P.jsx)("div",{className:a,onClick:n.itemClick,children:(0,P.jsx)("span",{title:i,children:i})}):null},n.state={expanded:!1},n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this,n=this.props.node,i=this.state.expanded;return n.children.length>0?(0,P.jsxs)("div",{className:"pl-4 position-relative",children:[(0,P.jsx)("span",{className:"switch-btn",onClick:this.toggleExpanded,children:(0,P.jsx)("span",{className:"".concat(i?"":"rotate-270 d-inline-flex align-items-center"),"aria-hidden":"true",children:(0,P.jsx)(b.A,{symbol:"down"})})}),this.renderLink(n),i&&n.children.map((function(n,i){return(0,P.jsx)(t,{node:n,currentPath:e.props.currentPath,onLinkClick:e.props.onLinkClick},i)}))]}):this.renderLink(n)}}])}(i.Component),R=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).onLinkClick=function(e){var t=n.state.currentPath;if(e.path!==t){e.path&&n.setState({currentPath:e.path});var i=new URL(e.href);e.href&&n.props.onLinkClick(i.href)}},n.changeInlineNode=function(e){var t;if("link"==e.type||"image"===e.type)if("image"==e.type&&v.Ejc){if(t=e.data.src,!new RegExp(v.xW0+"/lib/"+v.GCj+"/file.*raw=1").test(t))return;var n=t.indexOf("/file"),i=t.indexOf("?"),o=t.substring(n+5,i);e.data.src=v.xW0+"/view-image-via-public-wiki/?slug="+v.yRH+"&path="+o}else if("link"==e.type){t=e.url;if(new RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/).test(t)){if(m.Aq.isInternalMarkdownLink(t,v.GCj)){var r=m.Aq.getPathFromInternalMarkdownLink(t,v.GCj);e.url=v.xW0+"/published/"+v.yRH+r}else if(m.Aq.isInternalDirLink(t,v.GCj)){var s=m.Aq.getPathFromInternalDirLink(t,v.GCj);e.url=v.xW0+"/published/"+v.yRH+s}}else t.startsWith("./")&&(t=t.slice(2)),e.url=v.xW0+"/published/"+v.yRH+"/"+t}return e},n.links=[],n.state={currentPath:"",treeRoot:{name:"",href:"",children:[],isRoot:!0}},n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.indexContent,t=(0,M.mdStringToSlate)(e),n=function(e){var t=new S({name:"",href:""});return e.forEach((function(e){"unordered_list"!==e.type&&"ordered_list"!==e.type||(t=A(e.children,t),y(t,"/"))})),t}(m.Aq.changeMarkdownNodes(t,this.changeInlineNode));this.setState({treeRoot:n})}},{key:"render",value:function(){var e=this,t=this.state,n=t.treeRoot,i=t.currentPath;return(0,P.jsx)("div",{className:"mx-4 o-hidden",children:n.children.map((function(t){return(0,P.jsx)(E,{node:t,currentPath:i,onLinkClick:e.onLinkClick},t.path)}))})}}])}(i.Component),F=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).renderIndexView=function(){return(0,P.jsxs)("div",{className:"wiki-pages-container",children:[(0,P.jsx)("div",{style:{marginTop:"2px"}}),(0,P.jsx)(R,{indexContent:n.props.indexContent,onLinkClick:n.props.onLinkClick})]})},n.renderTreeView=function(){return(0,P.jsx)("div",{className:"wiki-pages-container",children:n.props.treeData&&(0,P.jsx)(N.A,{treeData:n.props.treeData,currentPath:n.props.currentPath,isNodeMenuShow:n.isNodeMenuShow,onNodeClick:n.props.onNodeClick,onNodeCollapse:n.props.onNodeCollapse,onNodeExpanded:n.props.onNodeExpanded})})},n.isNodeMenuShow=!1,n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){return(0,P.jsxs)("div",{className:"side-panel wiki-side-panel ".concat(this.props.closeSideBar?"":"left-zero"),children:[(0,P.jsx)("div",{className:"side-panel-top panel-top",children:(0,P.jsx)(C.A,{onCloseSidePanel:this.props.onCloseSide})}),(0,P.jsxs)("div",{id:"side-nav",className:"wiki-side-nav",role:"navigation",children:[this.props.isTreeDataLoading&&(0,P.jsx)(D.A,{}),!this.props.isTreeDataLoading&&this.props.indexNode&&this.renderIndexView(),!this.props.isTreeDataLoading&&!this.props.indexNode&&this.renderTreeView(),v.Xh_&&v.EK0&&(0,P.jsx)("div",{className:"p-2",children:(0,P.jsx)("a",{href:v.YcY+"library/"+v.GCj+"/"+v.yRH+"/",className:"text-dark text-decoration-underline",children:(0,v.APU)("Go to Library")})})]})]})}}])}(i.Component),q=n(89379),O=n(67818),T=n(66945),W=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).checkMarkdownEditorRenderCompleted=function(){n.seafileMarkdownViewerRef&&("empty-loading-page"!==n.seafileMarkdownViewerRef.firstElementChild.className&&(n.setState({isMarkdownEditorRenderCompleted:!0}),n.timer&&clearInterval(n.timer)))},n.onLinkClick=function(e){n.props.onLinkClick(e)},n.changeInlineNode=function(e){var t,i,o=n.props.repoID;if("image"==e.type){if(t=e.data.src,new RegExp(v.xW0+"/lib/"+o+"/file.*raw=1").test(t)){var r=t.indexOf("/file"),s=t.indexOf("?");i=t.substring(r+5,s)}else{if(!/^\.\.\/*/.test(t)&&!/^\.\/*/.test(t))return;var a=n.props.path,d=a.slice(0,a.lastIndexOf("/"))+"/"+t;i=m.Aq.pathNormalize(d)}e.data.src=v.xW0+"/view-image-via-public-wiki/?slug="+v.yRH+"&path="+i}else if("link"==e.type)if(t=e.url,m.Aq.isInternalFileLink(t,o))if(m.Aq.isInternalMarkdownLink(t,o)){var l=m.Aq.getPathFromInternalMarkdownLink(t,o);e.url=v.xW0+"/published/"+v.yRH+l}else e.url=t.replace(/(.*)lib\/([-0-9a-f]{36})\/file(.*)/g,(function(e,t,n,i){return"".concat(t,"d/").concat(v.Jif,"/files/?p=").concat(i,"&dl=1")}));else if(m.Aq.isInternalDirLink(t,o)){var c=m.Aq.getPathFromInternalDirLink(t,o);e.url=v.xW0+"/published/"+v.yRH+c}return e},n.modifyValueBeforeRender=function(e){return m.Aq.changeMarkdownNodes(e,n.changeInlineNode)},n.renderMarkdown=function(){var e=n.props,t=e.isTOCShow,o=void 0===t||t,r=e.isWiki,s=void 0!==r&&r,a=e.markdownContent,d=(0,q.default)({isShowOutline:o,mathJaxSource:"".concat(v.SGU,"js/mathjax/tex-svg.js"),value:a,scrollRef:n.scrollRef,onLinkClick:n.onLinkClick},s&&{beforeRenderCallback:n.modifyValueBeforeRender});return(0,P.jsx)(O.I18nextProvider,{i18n:T.A,children:(0,P.jsx)(i.Suspense,{fallback:(0,P.jsx)(D.A,{}),children:(0,P.jsx)(M.MarkdownViewer,(0,q.default)({},d))})})},n.scrollRef=i.createRef(),n.seafileMarkdownViewerRef=null,n.timer=null,n.state={isMarkdownEditorRenderCompleted:!1},n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval((function(){e.checkMarkdownEditorRenderCompleted()}),100)}},{key:"componentWillUnmount",value:function(){this.timer&&clearInterval(this.timer)}},{key:"render",value:function(){var e=this,t=this.state.isMarkdownEditorRenderCompleted,n=this.props,i=n.isFileLoading,o=n.isWiki,r=void 0!==o&&o,s=n.containerClassName,a=void 0===s?"":s;return i?(0,P.jsx)(D.A,{}):(0,P.jsx)("div",{ref:this.scrollRef,className:"wiki-page-container ".concat(a),children:(0,P.jsxs)("div",{className:"wiki-page-content ".concat(r?"":"w-100"),ref:function(t){return e.seafileMarkdownViewerRef=t},children:[this.props.children,this.renderMarkdown(),t&&(0,P.jsxs)("p",{id:"wiki-page-last-modified",children:[(0,v.APU)("Last modified by")," ",this.props.latestContributor,", ",(0,P.jsx)("span",{children:this.props.lastModified})]}),!t&&(0,P.jsx)(D.A,{})]})})}}])}(i.Component),z=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).onMouseEnter=function(){n.setState({highlight:!0})},n.onMouseLeave=function(){n.setState({highlight:!1})},n.onContextMenu=function(e){e.preventDefault(),e.stopPropagation()},n.onDirentClick=function(e){e.preventDefault(),n.props.onDirentClick(n.props.dirent)},n.state={highlight:!1},n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props,t=e.path,n=e.dirent,i=v.YcY+"published"+m.Aq.joinPath(t,n.name),o=m.Aq.getDirentIcon(n);return m.Aq.isDesktop()?(0,P.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onContextMenu:this.onContextMenu,children:[(0,P.jsx)("td",{className:"text-center",children:(0,P.jsx)("img",{src:o,width:"24",alt:""})}),(0,P.jsx)("td",{className:"name",children:(0,P.jsx)("a",{href:i,onClick:this.onDirentClick,children:n.name})}),(0,P.jsx)("td",{children:n.size}),(0,P.jsx)("td",{children:n.mtime_relative})]}):(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{className:"text-center",children:(0,P.jsx)("img",{src:o,width:"24",alt:""})}),(0,P.jsxs)("td",{children:[(0,P.jsx)("a",{href:i,onClick:this.onDirentClick,children:n.name}),(0,P.jsx)("br",{}),(0,P.jsx)("span",{className:"item-meta-info",children:n.size}),(0,P.jsx)("span",{className:"item-meta-info",children:n.mtime_relative})]})]})}}])}(i.Component),B=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,d.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this,t=m.Aq.isDesktop();return(0,P.jsxs)("table",{className:"table-hover ".concat(t?"":"table-thead-hidden"),children:[(0,P.jsx)("thead",{children:t?(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{style:{width:"4%"}}),(0,P.jsx)("th",{style:{width:"66%"},children:(0,v.APU)("Name")}),(0,P.jsx)("th",{style:{width:"15%"},children:(0,v.APU)("Size")}),(0,P.jsx)("th",{style:{width:"15%"},children:(0,v.APU)("Last Update")})]}):(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{width:"12%"}),(0,P.jsx)("th",{width:"88%"})]})}),(0,P.jsx)("tbody",{children:0!==this.props.direntList.length&&this.props.direntList.map((function(t,n){return(0,P.jsx)(z,{path:e.props.path,dirent:t,onDirentClick:e.props.onDirentClick},n)}))})]})}}])}(i.Component),H=B,U=n(66987),_=n(48731),V=n(51925),Y=n(98705),K=n(97499),G=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).changeInlineNode=function(e){var t,i,o=n.props.repoID;if("image"==e.type){if(t=e.data.src,new RegExp(v.xW0+"/lib/"+o+"/file.*raw=1").test(t)){var r=t.indexOf("/file"),s=t.indexOf("?");i=t.substring(r+5,s)}else{if(!/^\.\.\/*/.test(t)&&!/^\.\/*/.test(t))return;var a=n.props.path,d=a.slice(0,a.lastIndexOf("/"))+"/"+t;i=m.Aq.pathNormalize(d)}e.data.src=v.xW0+"/view-image-via-public-wiki/?slug="+v.yRH+"&path="+i}else if("link"==e.type)if(t=e.url,m.Aq.isInternalFileLink(t,o))if(m.Aq.isInternalMarkdownLink(t,o)){var l=m.Aq.getPathFromInternalMarkdownLink(t,o);e.url=v.xW0+"/published/"+v.yRH+l}else e.url=t.replace(/(.*)lib\/([-0-9a-f]{36})\/file(.*)/g,(function(e,t,n,i){return"".concat(t,"d/").concat(v.Jif,"/files/?p=").concat(i,"&dl=1")}));else if(m.Aq.isInternalDirLink(t,o)){var c=m.Aq.getPathFromInternalDirLink(t,o);e.url=v.xW0+"/published/"+v.yRH+c}return e},n.modifyValueBeforeRender=function(e){return m.Aq.changeMarkdownNodes(e,n.changeInlineNode)},n.renderMarkdown=function(){var e=n.props,t=e.isTOCShow,o=void 0===t||t,r=e.markdownContent;if(!r)return null;var s=JSON.parse(r);window.seafile||(window.seafile={serviceUrl:v.xW0,username:v.Xh_,name:v.UUu,avatarURL:v.wgO,repoID:v.GCj,siteRoot:v.YcY,assetsUrl:v.Hh2});var a={document:s,showOutline:o,scrollRef:n.scrollRef,mathJaxSource:v.SGU+"js/mathjax/tex-svg.js"};return(0,P.jsx)(O.I18nextProvider,{i18n:K.A,children:(0,P.jsx)(i.Suspense,{fallback:(0,P.jsx)(D.A,{}),children:(0,P.jsx)(Y.DM,(0,q.default)({},a))})})},n.scrollRef=i.createRef(),n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){if(this.props.isFileLoading)return(0,P.jsx)(D.A,{});var e=this.props,t=e.isWiki,n=void 0!==t&&t,i=e.containerClassName,o=void 0===i?"":i;return(0,P.jsx)("div",{ref:this.scrollRef,className:"wiki-page-container ".concat(o),children:(0,P.jsxs)("div",{className:"wiki-page-content ".concat(n?"":"w-100"),children:[this.props.children,this.renderMarkdown(),(0,P.jsxs)("p",{id:"wiki-page-last-modified",children:[(0,v.APU)("Last modified by")," ",this.props.latestContributor,", ",(0,P.jsx)("span",{children:this.props.lastModified})]})]})})}}])}(i.Component),J=function(e){function t(){var e;(0,r.default)(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=(0,a.default)(this,t,[].concat(o))).onMenuClick=function(){e.props.onMenuClick()},e.onEditClick=function(t){t.preventDefault();var n=v.YcY+"lib/"+v.GCj+"/file"+e.props.path+"?mode=edit";window.open(n)},e.onMainNavBarClick=function(t){var n=m.Aq.getEventData(t,"path");e.props.onMainNavBarClick(n)},e.renderNavPath=function(){var t=e.props.path.split("/"),n="";return t.map((function(o,r){return""===o?null:r===t.length-1?(0,P.jsxs)(i.Fragment,{children:[(0,P.jsx)("span",{className:"path-split",children:"/"}),(0,P.jsx)("span",{className:"path-file-name",children:o})]},r):(n+="/"+o,(0,P.jsxs)(i.Fragment,{children:[(0,P.jsx)("span",{className:"path-split",children:"/"}),(0,P.jsx)("a",{className:"path-link","data-path":n,onClick:e.onMainNavBarClick,children:o})]},r))}))},e}return(0,d.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props.onSearchedClick,t=(0,P.jsx)("div",{className:"message err-tip",children:(0,v.APU)("Folder does not exist.")}),n=this.props.pathExist&&!this.props.isDataLoading&&this.props.isViewFile;return(0,P.jsxs)("div",{className:"main-panel wiki-main-panel",children:[(0,P.jsx)("div",{className:"main-panel-hide hide",children:this.props.content}),(0,P.jsxs)("div",{className:"main-panel-north panel-top ".concat("rw"===this.props.permission?"border-left-show":""),children:[!v.Xh_&&(0,P.jsxs)(i.Fragment,{children:[(0,P.jsx)("div",{className:"cur-view-toolbar",children:(0,P.jsx)("span",{className:"hidden-md-up d-md-none side-nav-toggle",title:"Side Nav Menu",onClick:this.onMenuClick,children:(0,P.jsx)(b.A,{symbol:"menu"})})}),(0,P.jsx)("div",{className:"common-toolbar",children:v.amr&&(0,P.jsx)(U.A,{isPublic:!0,repoID:v.GCj,onSearchedClick:e,placeholder:(0,v.APU)("Search files")})})]}),v.Xh_&&(0,P.jsxs)(i.Fragment,{children:[(0,P.jsxs)("div",{className:"cur-view-toolbar",children:[(0,P.jsx)("span",{className:"hidden-md-up d-md-none side-nav-toggle",title:"Side Nav Menu",onClick:this.onMenuClick,children:(0,P.jsx)(b.A,{symbol:"menu"})}),"rw"==this.props.permission&&(m.Aq.isDesktop()?(0,P.jsx)("button",{className:"btn btn-secondary operation-item",title:(0,v.APU)("Edit"),onClick:this.onEditClick,children:(0,v.APU)("Edit")}):(0,P.jsx)("span",{className:"mobile-toolbar-icon",title:(0,v.APU)("Edit"),onClick:this.onEditClick,children:(0,P.jsx)(b.A,{symbol:"rename"})}))]}),(0,P.jsxs)("div",{className:"common-toolbar",children:[v.amr&&(0,P.jsx)(U.A,{isPublic:!0,repoID:v.GCj,onSearchedClick:e,placeholder:(0,v.APU)("Search files")}),(0,P.jsx)(_.A,{}),(0,P.jsx)(V.A,{})]})]})]}),(0,P.jsx)("div",{className:"main-panel-center",children:(0,P.jsxs)("div",{className:"cur-view-content ".concat(n?"o-hidden":""),children:[!this.props.pathExist&&t,this.props.pathExist&&this.props.isDataLoading&&(0,P.jsx)(D.A,{}),n&&m.Aq.isMarkdownFile(this.props.path)&&(0,P.jsx)(W,{isWiki:!0,path:this.props.path,repoID:v.GCj,isTOCShow:!1,markdownContent:this.props.content,isFileLoading:this.props.isDataLoading,lastModified:this.props.lastModified,latestContributor:this.props.latestContributor,onLinkClick:this.props.onLinkClick}),n&&m.Aq.isSdocFile(this.props.path)&&(0,P.jsx)(G,{isWiki:!0,path:this.props.path,repoID:v.GCj,markdownContent:this.props.content,isFileLoading:this.props.isDataLoading,lastModified:this.props.lastModified,latestContributor:this.props.latestContributor,onLinkClick:this.props.onLinkClick}),!this.props.isDataLoading&&!this.props.isViewFile&&(0,P.jsx)(H,{path:this.props.path,direntList:this.props.direntList,onDirentClick:this.props.onDirentClick})]})})]})}}])}(i.Component),X=J;n(16322),n(62664),n(40672),n(81848);c().locale(v.vVe),c().extend(u());var Q=function(e){function t(e){var n;return(0,r.default)(this,t),(n=(0,a.default)(this,t,[e])).loadSidePanel=function(e){v.V6g?n.loadIndexNode():(e="None"===v.Q7U||m.Aq.isSdocFile(e)?"/":e,n.loadNodeAndParentsByPath(e))},n.loadWikiData=function(e){if(n.pythonWrapper=document.getElementById("wiki-file-content"),"False"===v.Q7U&&m.Aq.isSdocFile(e))n.showDir("/");else if("False"!==v.Q7U)if(n.removePythonWrapper(),"True"!==v.Q7U)if("None"!==v.Q7U||"/home.md"!==e){if("None"===v.Q7U){n.setState({pathExist:!1});var t=v.YcY+"published/"+v.yRH+m.Aq.encodePath(e);window.history.pushState({url:t,path:e},e,t)}}else n.showDir("/");else n.showDir(e);else n.setState({path:e})},n.loadIndexNode=function(){g.e.listWikiDir(v.gj_,"/").then((function(e){var t=n.state.treeData;n.addFirstResponseListToNode(e.data.dirent_list,t.root);var i=t.getNodeByPath(n.indexPath);g.e.getWikiFileContent(v.gj_,i.path).then((function(e){n.setState({treeData:t,indexNode:i,indexContent:e.data.content,isTreeDataLoading:!1})}))})).catch((function(e){n.setState({isLoadFailed:!0})}))},n.showDir=function(e){n.removePythonWrapper(),n.loadDirentList(e);var t=v.YcY+"published/"+v.yRH+m.Aq.encodePath(e);window.history.pushState({url:t,path:e},e,t)},n.showFile=function(e){n.setState({isDataLoading:!0,isViewFile:!0,path:e}),n.removePythonWrapper(),g.e.getWikiFileContent(v.gj_,e).then((function(e){var t=e.data;n.setState({isDataLoading:!1,content:t.content,permission:t.permission,lastModified:c().unix(t.last_modified).fromNow(),latestContributor:t.latest_contributor})}));var t=window.location.hash,i=v.YcY+"published/"+v.yRH+m.Aq.encodePath(e)+t;"/home.md"===e?window.history.replaceState({url:i,path:e},e,i):window.history.pushState({url:i,path:e},e,i)},n.loadDirentList=function(e){n.setState({isDataLoading:!0}),g.e.listWikiDir(v.gj_,e).then((function(t){var i=t.data.dirent_list.map((function(e){return new w.A(e)}));"/"===e&&(i=i.filter((function(e){if("dir"===e.type){var t=e.name.toLowerCase();return"drafts"!==t&&"images"!==t&&"downloads"!==t}return!0}))),i=m.Aq.sortDirents(i,"name","asc"),n.setState({path:e,isViewFile:!1,direntList:i,isDataLoading:!1})})).catch((function(){n.setState({isLoadFailed:!0})}))},n.loadTreeNodeByPath=function(e){var t=n.state.treeData.clone(),i=t.getNodeByPath(e);i.isLoaded?(t.getNodeByPath(i.parentNode.path).isExpanded=!0,n.setState({treeData:t,currentNode:i})):g.e.listWikiDir(v.gj_,i.path).then((function(e){n.addResponseListToNode(e.data.dirent_list,i),t.getNodeByPath(i.parentNode.path).isExpanded=!0,n.setState({treeData:t,currentNode:i})}))},n.loadNodeAndParentsByPath=function(e){var t=n.state.treeData.clone();m.Aq.isMarkdownFile(e)&&(e=m.Aq.getDirName(e)),g.e.listWikiDir(v.gj_,e,!0).then((function(e){for(var i=e.data.dirent_list,o={},r=0;r<i.length;r++){var s=i[r],a=s.parent_dir;o[a]||(o[a]=[]),o[a].push(s)}for(var d in o){var l=t.getNodeByPath(d);l.isLoaded||"/"!==l.path?l.isLoaded||n.addResponseListToNode(o[d],l):n.addFirstResponseListToNode(o[d],l)}n.setState({isTreeDataLoading:!1,treeData:t})})).catch((function(){n.setState({isLoadFailed:!0})}))},n.removePythonWrapper=function(){n.pythonWrapper&&(document.body.removeChild(n.pythonWrapper),n.pythonWrapper=null)},n.onConentLinkClick=function(e){e.preventDefault(),e.stopPropagation();var t="";if("A"!==e.target.tagName){for(var i=e.target.parentNode;"A"!==i.tagName;)i=i.parentNode;t=i.href}else t=e.target.href;n.onLinkClick(t)},n.onLinkClick=function(e){var t=e;if(m.Aq.isRelativePath(t)&&(t=window.location.href.replace("home.md",""),t+=e),m.Aq.isWikiInternalMarkdownLink(t,v.yRH)){var i=m.Aq.getPathFromWikiInternalMarkdownLink(t,v.yRH);n.showFile(i)}else if(m.Aq.isWikiInternalDirLink(t,v.yRH)){var o=m.Aq.getPathFromWikiInternalDirLink(t,v.yRH);n.showDir(o)}else window.location.href=t;n.state.closeSideBar||n.setState({closeSideBar:!0})},n.onpopstate=function(e){if(e.state&&e.state.path){var t=e.state.path;m.Aq.isMarkdownFile(t)?n.showFile(t):(n.loadDirentList(t),n.setState({path:t,isViewFile:!1}))}},n.onSearchedClick=function(e){var t=e.is_dir?e.path.slice(0,e.path.length-1):e.path;if(n.state.currentPath!==t){for(var i=-1,o=m.Aq.getPaths(t),r=0;r<o.length;r++){var s=n.state.treeData.getNodeByPath(s);if(!s){i=r;break}}if(-1===i){var a=n.state.treeData.clone(),d=a.getNodeByPath(e.path);x.A.expandNode(d),n.setState({treeData:a})}else n.loadNodeAndParentsByPath(t);if(e.is_dir)n.showDir(t);else if(m.Aq.isMarkdownFile(t))n.showFile(t);else{var l=v.YcY+"d/"+v.Jif+"/files/?p="+m.Aq.encodePath(t);window.open("about:blank").location.href=l}}},n.onMenuClick=function(){n.setState({closeSideBar:!n.state.closeSideBar})},n.onMainNavBarClick=function(e){var t=n.state.treeData.clone(),i=t.getNodeByPath(e);t.expandNode(i),n.setState({treeData:t,currentNode:i}),n.showDir(i.path)},n.onDirentClick=function(e){var t=m.Aq.joinPath(n.state.path,e.name);if(e.isDir())n.loadTreeNodeByPath(t),n.showDir(t);else if(m.Aq.isMarkdownFile(t))n.showFile(t);else{var i=window.open("about:blank"),o=v.YcY+"d/"+v.Jif+"/files/?p="+m.Aq.encodePath(t);i.location.href=o}},n.onCloseSide=function(){n.setState({closeSideBar:!n.state.closeSideBar})},n.onNodeClick=function(e){if(n.state.pathExist||n.setState({pathExist:!0}),e.object.isDir()){if(!e.isLoaded){var t=n.state.treeData.clone();e=t.getNodeByPath(e.path),g.e.listWikiDir(v.gj_,e.path).then((function(i){n.addResponseListToNode(i.data.dirent_list,e),t.collapseNode(e),n.setState({treeData:t})}))}if(e.path===n.state.path)if(e.isExpanded){var i=x.A.collapseNode(n.state.treeData,e);n.setState({treeData:i})}else{var o=n.state.treeData.clone();e=o.getNodeByPath(e.path),o.expandNode(e),n.setState({treeData:o})}}if(e.path!==n.state.path)if(e.object.isDir())n.showDir(e.path);else if(m.Aq.isMarkdownFile(e.path)||m.Aq.isSdocFile(e.path))e.path!==n.state.path&&n.showFile(e.path),n.onCloseSide();else{var r=window.open("about:blank"),s=v.YcY+"d/"+v.Jif+"/files/?p="+m.Aq.encodePath(e.path);r.location.href=s}},n.onNodeCollapse=function(e){var t=x.A.collapseNode(n.state.treeData,e);n.setState({treeData:t})},n.onNodeExpanded=function(e){var t=n.state.treeData.clone();(e=t.getNodeByPath(e.path)).isLoaded?(t.expandNode(e),n.setState({treeData:t})):g.e.listWikiDir(v.gj_,e.path).then((function(i){n.addResponseListToNode(i.data.dirent_list,e),n.setState({treeData:t})}))},n.addFirstResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var n=e.map((function(e){return new w.A(e)}));n=n.filter((function(e){if("dir"===e.type){var t=e.name.toLowerCase();return"drafts"!==t&&"images"!==t&&"downloads"!==t}return!0}));var i=(n=m.Aq.sortDirents(n,"name","asc")).map((function(e){return new k.A({object:e})}));t.addChildren(i)},n.addResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var n=e.map((function(e){return new w.A(e)})),i=(n=m.Aq.sortDirents(n,"name","asc")).map((function(e){return new k.A({object:e})}));t.addChildren(i)},n.state={path:"",pathExist:!0,closeSideBar:!1,isViewFile:!0,isDataLoading:!1,direntList:[],content:"",permission:"",lastModified:"",latestContributor:"",isTreeDataLoading:!0,treeData:x.A.buildTree(),currentNode:null,indexNode:null,indexContent:""},window.onpopstate=n.onpopstate,n.indexPath="/index.md",n.homePath="/home.md",n.pythonWrapper=null,n}return(0,d.default)(t,e),(0,s.default)(t,[{key:"UNSAFE_componentWillMount",value:function(){m.Aq.isDesktop()||this.setState({closeSideBar:!0})}},{key:"componentDidMount",value:function(){var e=this;this.loadSidePanel(v.cN8),this.loadWikiData(v.cN8),this.links=document.querySelectorAll("#wiki-file-content a"),this.links.forEach((function(t){return t.addEventListener("click",e.onConentLinkClick)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.links.forEach((function(t){return t.removeEventListener("click",e.onConentLinkClick)}))}},{key:"render",value:function(){return(0,P.jsxs)("div",{id:"main",className:"wiki-main",children:[(0,P.jsx)(F,{isTreeDataLoading:this.state.isTreeDataLoading,closeSideBar:this.state.closeSideBar,currentPath:this.state.path,treeData:this.state.treeData,indexNode:this.state.indexNode,indexContent:this.state.indexContent,onCloseSide:this.onCloseSide,onNodeClick:this.onNodeClick,onNodeCollapse:this.onNodeCollapse,onNodeExpanded:this.onNodeExpanded,onLinkClick:this.onLinkClick}),(0,P.jsx)(X,{path:this.state.path,pathExist:this.state.pathExist,isViewFile:this.state.isViewFile,isDataLoading:this.state.isDataLoading,content:this.state.content,permission:this.state.permission,lastModified:this.state.lastModified,latestContributor:this.state.latestContributor,direntList:this.state.direntList,onLinkClick:this.onLinkClick,onMenuClick:this.onMenuClick,onSearchedClick:this.onSearchedClick,onMainNavBarClick:this.onMainNavBarClick,onDirentClick:this.onDirentClick}),(0,P.jsx)(h.Ay,{query:"(max-width: 767.8px)",children:(0,P.jsx)(f.A,{isOpen:!this.state.closeSideBar,toggle:this.onCloseSide,contentClassName:"d-none"})})]})}}])}(i.Component);(0,o.createRoot)(document.getElementById("wrapper")).render((0,P.jsx)(Q,{}))},62664:function(){}},function(e){e.O(0,[4223],(function(){return t=17312,e(e.s=t);var t}));e.O()}]);