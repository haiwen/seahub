"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[6245],{33e3:function(e,t,i){i.d(t,{A:function(){return D}});var a=i(23029),s=i(92901),n=i(39874),r=i(85501),o=i(9950),l=i(58195),c=i(14113),d=i(99308),h=i(59051),m=i.n(h),u=i(40326),g=i(97011),p=i(65604),f=i(81446),x=i(44414),P=function(e){function t(e){var i;return(0,a.A)(this,t),(i=(0,n.A)(this,t,[e])).state={isLoading:!0,errorMsg:""},i}return(0,r.A)(t,e),(0,s.A)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,i=t.repoID,a=t.commitID;g.e.getCommitDetails(i,a).then((function(t){e.setState({isLoading:!1,errorMsg:"",commitDetails:t.data})})).catch((function(t){var i=p.Aq.getErrorMsg(t);e.setState({isLoading:!1,errorMsg:i})}))}},{key:"render",value:function(){var e=this.props,t=e.toggleDialog,i=e.commitTime;return(0,x.jsxs)(l.A,{isOpen:!0,centered:!0,toggle:t,children:[(0,x.jsx)(c.A,{toggle:t,children:(0,u.AP)("Modification Details")}),(0,x.jsxs)(d.A,{children:[(0,x.jsx)("p",{className:"small",children:m()(i).format("YYYY-MM-DD HH:mm:ss")}),(0,x.jsx)(A,{data:this.state})]})]})}}])}(o.Component),A=function(e){function t(){var e;(0,a.A)(this,t);for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=(0,n.A)(this,t,[].concat(s))).renderDetails=function(e){for(var t=[{type:"new",title:(0,u.AP)("New files")},{type:"removed",title:(0,u.AP)("Deleted files")},{type:"renamed",title:(0,u.AP)("Renamed or Moved files")},{type:"modified",title:(0,u.AP)("Modified files")},{type:"newdir",title:(0,u.AP)("New directories")},{type:"deldir",title:(0,u.AP)("Deleted directories")}],i=!0,a=0,s=t.length;a<s;a++)if(e[t[a].type].length){i=!1;break}return i?(0,x.jsx)("p",{children:e.cmt_desc}):(0,x.jsx)(o.Fragment,{children:t.map((function(t,i){return e[t.type].length?(0,x.jsxs)(o.Fragment,{children:[(0,x.jsx)("h6",{children:t.title}),(0,x.jsx)("ul",{children:e[t.type].map((function(e,t){return(0,x.jsx)("li",{dangerouslySetInnerHTML:{__html:e},className:"commit-detail-item text-truncate"},t)}))})]},i):null}))})},e}return(0,r.A)(t,e),(0,s.A)(t,[{key:"render",value:function(){var e=this.props.data,t=e.isLoading,i=e.errorMsg,a=e.commitDetails;return t?(0,x.jsx)(f.A,{}):i?(0,x.jsx)("p",{className:"error mt-4 text-center",children:i}):this.renderDetails(a)}}])}(o.Component),D=P},20565:function(e,t,i){var a=i(23029),s=i(92901),n=i(39874),r=i(85501),o=i(9950),l=i(17119),c=i(13690),d=i(59051),h=i.n(d),m=i(65604),u=i(40326),g=i(97011),p=i(81446),f=i(62376),x=i(40866),P=i(27288),A=i(33e3),D=i(58195),b=i(14113),j=i(99308),v=i(85907),w=i(20015),C=i(4086),L=i(44414),M=function(e){function t(e){var i;return(0,a.A)(this,t),(i=(0,n.A)(this,t,[e])).handleInputChange=function(e){i.setState({inputValue:e})},i.formSubmit=function(){var e=i.state.inputValue.map((function(e,t){return e.value})).join(","),t=i.props,a=t.repoID,s=t.commitID;i.setState({submitBtnDisabled:!0}),g.e.updateRepoCommitLabels(a,s,e).then((function(e){i.props.updateCommitLabels(e.data.revisionTags.map((function(e,t){return e.tag}))),i.props.toggleDialog(),C.A.success((0,u.AP)("Successfully edited labels."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);i.setState({formErrorMsg:t,submitBtnDisabled:!1})}))},i.state={inputValue:i.props.commitLabels.map((function(e,t){return{label:e,value:e}})),submitBtnDisabled:!1},i}return(0,r.A)(t,e),(0,s.A)(t,[{key:"render",value:function(){var e=this.state.formErrorMsg;return(0,L.jsxs)(D.A,{isOpen:!0,centered:!0,toggle:this.props.toggleDialog,children:[(0,L.jsx)(b.A,{toggle:this.props.toggleDialog,children:(0,u.AP)("Edit labels")}),(0,L.jsx)(j.A,{children:(0,L.jsxs)(o.Fragment,{children:[(0,L.jsx)(w.A,{defaultValue:this.props.commitLabels.map((function(e,t){return{label:e,value:e}})),isMulti:!0,onChange:this.handleInputChange,placeholder:""}),e&&(0,L.jsx)("p",{className:"error m-0 mt-2",children:e})]})}),(0,L.jsx)(v.A,{children:(0,L.jsx)("button",{className:"btn btn-primary",disabled:this.state.submitBtnDisabled,onClick:this.formSubmit,children:(0,u.AP)("Submit")})})]})}}])}(o.Component),N=M,y=(i(18291),i(81848),window.app.pageOptions),S=y.repoID,k=y.repoName,I=y.userPerm,O=y.showLabel,_=function(e){function t(e){var i;return(0,a.A)(this,t),(i=(0,n.A)(this,t,[e])).getItems=function(e){g.e.getRepoHistory(S,e,i.state.perPage).then((function(t){i.setState({isLoading:!1,currentPage:e,items:t.data.data,hasNextPage:t.data.more})})).catch((function(e){i.setState({isLoading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},i.resetPerPage=function(e){i.setState({perPage:e},(function(){i.getItems(1)}))},i.onSearchedClick=function(e){if(!0===e.is_dir){var t=u.Yc+"library/"+e.repo_id+"/"+e.repo_name+e.path;(0,c.oo)(t,{repalce:!0})}else{var i=u.Yc+"lib/"+e.repo_id+"/file"+m.Aq.encodePath(e.path);window.open("about:blank").location.href=i}},i.goBack=function(e){e.preventDefault(),window.history.back()},i.state={isLoading:!0,errorMsg:"",currentPage:1,perPage:25,hasNextPage:!1,items:[]},i}return(0,r.A)(t,e),(0,s.A)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,i=this.state,a=i.currentPage,s=i.perPage;this.setState({perPage:parseInt(t.get("per_page")||s),currentPage:parseInt(t.get("page")||a)},(function(){e.getItems(e.state.currentPage)}))}},{key:"render",value:function(){var e=(0,u.AP)("{placeholder} Modification History");return e=e.replace("{placeholder}",'<span class="op-target text-truncate mx-1">'+m.Aq.HTMLescape(k)+"</span>"),(0,L.jsx)(o.Fragment,{children:(0,L.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,L.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[(0,L.jsx)("a",{href:u.Yc,children:(0,L.jsx)("img",{src:u.SG+u.VI,height:u.hM,width:u.gA,title:u.q0,alt:"logo"})}),(0,L.jsx)(P.A,{onSearchedClick:this.onSearchedClick})]}),(0,L.jsx)("div",{className:"flex-auto container-fluid pt-4 pb-6 o-auto",children:(0,L.jsx)("div",{className:"row",children:(0,L.jsxs)("div",{className:"col-md-10 offset-md-1",children:[(0,L.jsx)("h2",{dangerouslySetInnerHTML:{__html:e},className:"d-flex text-nowrap"}),(0,L.jsx)("a",{href:"#",className:"go-back",title:(0,u.AP)("Back"),onClick:this.goBack,role:"button","aria-label":(0,u.AP)("Back"),children:(0,L.jsx)("span",{className:"sf3-font sf3-font-down rotate-90 d-inline-block"})}),"rw"==I&&(0,L.jsx)("p",{className:"tip",children:(0,u.AP)("Tip: a snapshot will be generated after modification, which records the library state after the modification.")}),(0,L.jsx)(Y,{isLoading:this.state.isLoading,errorMsg:this.state.errorMsg,items:this.state.items,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getItems})]})})})]})})}}])}(o.Component),Y=function(e){function t(e){var i;return(0,a.A)(this,t),(i=(0,n.A)(this,t,[e])).getPreviousPage=function(){i.props.getListByPage(i.props.currentPage-1)},i.getNextPage=function(){i.props.getListByPage(i.props.currentPage+1)},i.theadData=O?[{width:"43%",text:(0,u.AP)("Description")},{width:"12%",text:(0,u.AP)("Time")},{width:"9%",text:(0,u.AP)("Modifier")},{width:"12%",text:"".concat((0,u.AP)("Device")," / ").concat((0,u.AP)("Version"))},{width:"12%",text:(0,u.AP)("Labels")},{width:"12%",text:""}]:[{width:"43%",text:(0,u.AP)("Description")},{width:"15%",text:(0,u.AP)("Time")},{width:"15%",text:(0,u.AP)("Modifier")},{width:"15%",text:"".concat((0,u.AP)("Device")," / ").concat((0,u.AP)("Version"))},{width:"12%",text:""}],i}return(0,r.A)(t,e),(0,s.A)(t,[{key:"render",value:function(){var e=this.props,t=e.isLoading,i=e.errorMsg,a=e.items,s=e.curPerPage,n=e.currentPage,r=e.hasNextPage;return t?(0,L.jsx)(p.A,{}):i?(0,L.jsx)("p",{className:"error mt-6 text-center",children:i}):(0,L.jsxs)(o.Fragment,{children:[(0,L.jsxs)("table",{className:"table-hover",children:[(0,L.jsx)("thead",{children:(0,L.jsx)("tr",{children:this.theadData.map((function(e,t){return(0,L.jsx)("th",{width:e.width,children:e.text},t)}))})}),(0,L.jsx)("tbody",{children:a.map((function(e,t){return e.isFirstCommit=1==n&&0==t,e.showDetails=r||t!=a.length-1,(0,L.jsx)(B,{item:e},t)}))})]}),(0,L.jsx)(f.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:n,hasNextPage:r,curPerPage:s,resetPerPage:this.props.resetPerPage})]})}}])}(o.Component),B=function(e){function t(e){var i;return(0,a.A)(this,t),(i=(0,n.A)(this,t,[e])).handleMouseOver=function(){i.setState({isIconShown:!0})},i.handleMouseOut=function(){i.setState({isIconShown:!1})},i.showCommitDetails=function(e){e.preventDefault(),i.setState({isCommitDetailsDialogOpen:!i.state.isCommitDetailsDialogOpen})},i.toggleCommitDetailsDialog=function(){i.setState({isCommitDetailsDialogOpen:!i.state.isCommitDetailsDialogOpen})},i.editLabel=function(e){e.preventDefault(),i.setState({isCommitLabelUpdateDialogOpen:!i.state.isCommitLabelUpdateDialogOpen})},i.toggleLabelEditDialog=function(){i.setState({isCommitLabelUpdateDialogOpen:!i.state.isCommitLabelUpdateDialogOpen})},i.updateLabels=function(e){i.setState({labels:e})},i.state={labels:i.props.item.tags,isIconShown:!1,isCommitLabelUpdateDialogOpen:!1,isCommitDetailsDialogOpen:!1},i}return(0,r.A)(t,e),(0,s.A)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,i=t.isIconShown,a=t.isCommitLabelUpdateDialogOpen,s=t.isCommitDetailsDialogOpen,n=t.labels,r="";return r=e.email?e.second_parent_id?(0,u.AP)("None"):(0,L.jsx)("a",{href:"".concat(u.Yc,"profile/").concat(encodeURIComponent(e.email),"/"),children:e.name}):(0,u.AP)("Unknown"),(0,L.jsxs)(o.Fragment,{children:[(0,L.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,L.jsxs)("td",{children:[e.description,e.showDetails&&(0,L.jsx)("a",{href:"#",className:"details",onClick:this.showCommitDetails,role:"button",children:(0,u.AP)("Details")})]}),(0,L.jsx)("td",{title:h()(e.time).format("LLLL"),children:h()(e.time).format("YYYY-MM-DD")}),(0,L.jsx)("td",{children:r}),(0,L.jsx)("td",{children:e.client_version?"".concat(e.device_name," / ").concat(e.client_version):"API / --"}),O&&(0,L.jsxs)("td",{children:[n.map((function(e,t){return(0,L.jsx)("span",{className:"commit-label",children:e},t)})),"rw"==I&&(0,L.jsx)("a",{href:"#",role:"button",className:"attr-action-icon sf3-font sf3-font-rename ".concat(i?"":"invisible"),title:(0,u.AP)("Edit"),"aria-label":(0,u.AP)("Edit"),onClick:this.editLabel})]}),(0,L.jsx)("td",{children:"rw"==I&&(e.isFirstCommit?(0,L.jsx)("span",{className:i?"":"invisible",children:(0,u.AP)("Current Version")}):(0,L.jsx)("a",{href:"".concat(u.Yc,"repo/").concat(S,"/snapshot/?commit_id=").concat(e.commit_id),className:i?"":"invisible",children:(0,u.AP)("View Snapshot")}))})]}),s&&(0,L.jsx)(x.A,{children:(0,L.jsx)(A.A,{repoID:S,commitID:e.commit_id,commitTime:e.time,toggleDialog:this.toggleCommitDetailsDialog})}),a&&(0,L.jsx)(x.A,{children:(0,L.jsx)(N,{repoID:S,commitID:e.commit_id,commitLabels:n,updateCommitLabels:this.updateLabels,toggleDialog:this.toggleLabelEditDialog})})]})}}])}(o.Component);l.render((0,L.jsx)(_,{}),document.getElementById("wrapper"))}},function(e){e.O(0,[4223],(function(){return t=20565,e(e.s=t);var t}));e.O()}]);