"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[539],{1631:function(e,t,i){var n=i(15671),r=i(43144),a=i(60136),o=i(29388),s=i(47313),c=i(42995),l=i(12756),u=i(12213),h=i(74073),d=i(54105),f=i(85951),g=i(5684),p=i(93869),S=i(7764),m=i(21303),v=i(61805),b=i(83854),N=i(46417),D=function(e){(0,a.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;(0,n.Z)(this,i),(r=t.call(this,e)).isSdocSuffix=function(e){return e.endsWith(".sdoc")},r.handleChange=function(e){e.target.value.trim()?r.setState({isSubmitBtnActive:!0}):r.setState({isSubmitBtnActive:!1}),r.setState({childName:e.target.value})},r.handleSubmit=function(){if(r.state.isSubmitBtnActive){var e=r.checkDuplicatedName(),t=r.state.childName.trim(),i=(0,b.Ol)(t),n=i.isValid,a=i.errMessage;if(n)if(e){var o=(0,v.ih)('The name "{name}" is already taken. Please choose a different name.');o=o.replace("{name}",b.cQ.HTMLescape(t)),r.setState({errMessage:o})}else{var s=r.state.parentPath+t;r.props.onAddFile(s),r.props.toggleDialog()}else r.setState({errMessage:a})}},r.handleKeyDown=function(e){"Enter"===e.key&&(r.handleSubmit(),e.preventDefault())},r.checkDuplicatedName=function(){return r.props.checkDuplicatedName(r.state.childName)},r.onAfterModelOpened=function(){r.newInput.current&&(r.newInput.current.focus(),r.newInput.current.setSelectionRange(0,0))};var a=e.fileType,o=void 0===a?"":a;return r.state={parentPath:"",childName:o,errMessage:"",isSubmitBtnActive:!!r.isSdocSuffix(o)},r.newInput=s.createRef(),r}return(0,r.Z)(i,[{key:"componentDidMount",value:function(){var e=this.props.parentPath;"/"===e[e.length-1]?this.setState({parentPath:e}):this.setState({parentPath:e+"/"})}},{key:"render",value:function(){var e=this.props.toggleDialog;return(0,N.jsxs)(c.Z,{isOpen:!0,toggle:e,onOpened:this.onAfterModelOpened,children:[(0,N.jsx)(l.Z,{toggle:e,children:(0,v.ih)("New File")}),(0,N.jsxs)(u.Z,{children:[(0,N.jsx)(h.Z,{children:(0,N.jsxs)(d.Z,{children:[(0,N.jsx)(f.Z,{for:"fileName",children:(0,v.ih)("Name")}),(0,N.jsx)(g.Z,{id:"fileName",onKeyDown:this.handleKeyDown,innerRef:this.newInput,value:this.state.childName,onChange:this.handleChange})]})}),this.state.errMessage&&(0,N.jsx)(p.Z,{color:"danger",className:"mt-2",children:this.state.errMessage})]}),(0,N.jsxs)(S.Z,{children:[(0,N.jsx)(m.Z,{color:"secondary",onClick:e,children:(0,v.ih)("Cancel")}),(0,N.jsx)(m.Z,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,v.ih)("Submit")})]})]})}}]),i}(s.Component);t.Z=D},60658:function(e,t,i){var n=i(47313),r=i(1168),a=i(72970),o=i(12409),s=i(83854),c=i(51282),l=i(15671),u=i(43144),h=i(60136),d=i(29388),f=i(75517),g=i(4514),p=i(68396),S=i(13884),m=i(63876),v=i(1631),b=i(46417),N=function(e){(0,h.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,l.Z)(this,i),(n=t.call(this,e)).onInternalLinkToggle=function(e){e&&e.internalLink&&n.setState({internalLink:e.internalLink}),n.setState({isShowInternalLinkDialog:!n.state.isShowInternalLinkDialog})},n.toggleStar=function(){var e=n.props,t=e.isStarred,i=e.repoID,r=e.docPath;t?g.I.unstarItem(i,r).then((function(e){n.props.toggleStar(!1)})).catch((function(e){var t=s.cQ.getErrorMsg(e);p.Z.danger(t)})):g.I.starItem(i,r).then((function(e){n.props.toggleStar(!0)})).catch((function(e){var t=s.cQ.getErrorMsg(e);p.Z.danger(t)}))},n.onShareToggle=function(){n.setState({isShowShareDialog:!n.state.isShowShareDialog})},n.onFreezeDocument=function(){var e=n.props,t=e.repoID,i=e.docPath;g.I.lockfile(t,i,-1).then((function(e){f.Nd.getInstance().dispatch(f.dK.REFRESH_DOCUMENT)})).catch((function(e){var t=s.cQ.getErrorMsg(e);p.Z.danger(t)}))},n.unFreeze=function(){var e=n.props,t=e.repoID,i=e.docPath;g.I.unlockfile(t,i).then((function(e){f.Nd.getInstance().dispatch(f.dK.REFRESH_DOCUMENT)})).catch((function(e){var t=s.cQ.getErrorMsg(e);p.Z.danger(t)}))},n.onNewNotification=function(){n.props.onNewNotification()},n.onClearNotification=function(){n.props.onClearNotification()},n.onCreateSdocFile=function(e){null!==e&&void 0!==e&&e.newFileName&&n.setState({fileType:"".concat(e.newFileName,".sdoc")}),n.setState({isShowCreateFileDialog:!n.state.isShowCreateFileDialog})},n.checkDuplicatedName=function(e){return n.props.direntList.some((function(t){return t.name===e}))},n.onAddFile=function(e){var t=n.props.repoID;g.I.createFile(t,e).then((function(e){f.Nd.getInstance().dispatch(f.dK.INSERT_LINK,{data:e.data})})).catch((function(e){var t=s.cQ.getErrorMsg(e);p.Z.danger(t)}))},n.state={isShowInternalLinkDialog:!1,isShowShareDialog:!1,internalLink:"",isShowCreateFileDialog:!1,fileType:".sdoc"},n}return(0,u.Z)(i,[{key:"componentDidMount",value:function(){var e=f.Nd.getInstance();this.unsubscribeInternalLinkEvent=e.subscribe(f.dK.INTERNAL_LINK_CLICK,this.onInternalLinkToggle),this.unsubscribeStar=e.subscribe(f.dK.TOGGLE_STAR,this.toggleStar),this.unsubscribeShare=e.subscribe(f.dK.SHARE_SDOC,this.onShareToggle),this.unsubscribeFreezeDocument=e.subscribe(f.dK.FREEZE_DOCUMENT,this.onFreezeDocument),this.unsubscribeUnfreeze=e.subscribe(f.dK.UNFREEZE,this.unFreeze),this.unsubscribeNewNotification=e.subscribe(f.dK.NEW_NOTIFICATION,this.onNewNotification),this.unsubscribeClearNotification=e.subscribe(f.dK.CLEAR_NOTIFICATION,this.onClearNotification),this.unsubscribeCreateSdocFile=e.subscribe(f.dK.CREATE_SDOC_FILE,this.onCreateSdocFile)}},{key:"componentWillUnmount",value:function(){this.unsubscribeInternalLinkEvent(),this.unsubscribeStar(),this.unsubscribeUnmark(),this.unsubscribeShare(),this.unsubscribeFreezeDocument(),this.unsubscribeUnfreeze(),this.unsubscribeNewNotification(),this.unsubscribeCreateSdocFile(),this.unsubscribeClearNotification()}},{key:"render",value:function(){var e=this.props,t=e.repoID,i=e.docPath,n=e.docName,r=e.docPerm,a=e.dirPath,o=this.state,s=o.isShowInternalLinkDialog,c=o.isShowShareDialog,l=o.internalLink,u=o.isShowCreateFileDialog,h=o.fileType;return(0,b.jsxs)(b.Fragment,{children:[s&&(0,b.jsx)(S.Z,{repoID:t,path:i,internalLink:l,onInternalLinkDialogToggle:this.onInternalLinkToggle}),c&&(0,b.jsx)(m.Z,{itemType:"file",itemPath:i,itemName:n,repoID:t,userPerm:r,toggleDialog:this.onShareToggle}),u&&(0,b.jsx)(v.Z,{parentPath:a,fileType:h,onAddFile:this.onAddFile,checkDuplicatedName:this.checkDuplicatedName,toggleDialog:this.onCreateSdocFile})]})}}]),i}(n.Component),D=N,I=i(55668),w=function(e){(0,h.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;(0,l.Z)(this,i),(n=t.call(this,e)).toggleStar=function(e){n.setState({isStarred:e})},n.onSetFavicon=function(e){var t=window.seafile.docName;e&&(t+=e);var i=s.cQ.getFileIconUrl(t,192);document.getElementById("favicon").href=i},n.onNewNotification=function(){n.onSetFavicon("_notification")},n.onClearNotification=function(){n.onSetFavicon()},n.getDirPath=function(){var e=window.seafile.docPath,t=e.lastIndexOf("/");return t?e.slice(0,t):"/"},n.getDirentList=function(){var e=window.seafile.repoID,t=n.getDirPath();g.I.listDir(e,t,{with_thumbnail:!0}).then((function(e){var t=[];e.data.dirent_list.forEach((function(e){var i=new I.Z(e);t.push(i)})),n.setState({direntList:t})})).catch((function(e){s.cQ.getErrorMsg(e,!0)}))};var r=window.app.pageOptions,a=r.isStarred,o=r.isSdocDraft;return n.state={isStarred:a,isDraft:o,direntList:[]},n}return(0,u.Z)(i,[{key:"componentDidMount",value:function(){this.onSetFavicon(),this.getDirentList()}},{key:"render",value:function(){var e=window.seafile,t=e.repoID,i=e.docPath,r=e.docName,a=e.docPerm,o=this.state,s=o.isStarred,c=o.isDraft,l=o.direntList,u=this.getDirPath();return(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)(f.Qo,{isStarred:s,isDraft:c}),(0,b.jsx)(D,{repoID:t,docPath:i,docName:r,docPerm:a,isStarred:s,direntList:l,dirPath:u,toggleStar:this.toggleStar,onNewNotification:this.onNewNotification,onClearNotification:this.onClearNotification})]})}}]),i}(n.Component),F=window.app.config,k=F.serviceURL,C=F.avatarURL,L=F.siteRoot,Z=F.lang,P=F.mediaUrl,E=F.isPro,T=window.app.userInfo,x=T.username,y=T.name,R=window.app.pageOptions,U=R.repoID,j=R.repoName,A=R.parentDir,M=R.filePerm,O=R.docPath,K=R.docName,_=R.docUuid,Q=R.seadocAccessToken,z=R.seadocServerUrl,B=R.assetsUrl,H=R.isSdocRevision,V=R.isPublished,W=R.originFilename,G=R.revisionCreatedAt,q=R.originFileVersion,J=R.originFilePath,X=R.originDocUuid,Y=R.revisionId,$=R.isFreezed;window.seafile={repoID:U,docPath:O,docName:K,docUuid:_,isOpenSocket:!0,serviceUrl:k,accessToken:Q,sdocServer:z,name:y,username:x,avatarURL:C,siteRoot:L,docPerm:M,historyURL:s.cQ.generateHistoryURL(L,U,O),parentFolderURL:"".concat(L,"library/").concat(U,"/").concat(s.cQ.encodePath(j+A)),assetsUrl:B,isShowInternalLink:!0,isStarIconShown:!0,isSdocRevision:H,isPublished:V,originFilename:W,originFileVersion:q,originFilePath:J,originDocUuid:X,revisionCreatedAt:G,lang:Z,revisionId:Y,mediaUrl:P,isFreezed:$,isPro:"True"===E},r.render((0,b.jsx)(a.I18nextProvider,{i18n:o.Z,children:(0,b.jsx)(n.Suspense,{fallback:(0,b.jsx)(c.Z,{}),children:(0,b.jsx)(w,{})})}),document.getElementById("wrapper"))}},function(e){e.O(0,[351],(function(){return t=60658,e(e.s=t);var t}));e.O()}]);