"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[187],{3640:function(e,t,s){var a=s(23029),r=s(92901),i=s(39874),n=s(85501),l=s(9950),o=s(17119),h=s(27288),c=s(49403),p=s(55097),d=s.n(p),u=s(40326),m=s(97011),f=s(4159),g=s.n(f),A=s(65604),x=s(44414),y=function(e){function t(e){var s;return(0,a.A)(this,t),(s=(0,i.A)(this,t,[e])).handlerFileURL=function(e){return e.is_dir?u.Yc+"library/"+e.repo_id+"/"+e.repo_name+e.fullpath:u.Yc+"lib/"+e.repo_id+"/file"+A.Aq.encodePath(e.fullpath)},s.handlerParentDirPath=function(e){var t=e.is_dir?e.fullpath.length-e.name.length-1:e.fullpath.length-e.name.length;return e.fullpath.substring(0,t)},s.handlerParentDirURL=function(e){return u.Yc+"library/"+e.repo_id+"/"+e.repo_name+s.handlerParentDirPath(e)},s}return(0,n.A)(t,e),(0,r.A)(t,[{key:"render",value:function(){var e=this.props.item,t=decodeURI(e.fullpath).substring(1),s=t?A.Aq.getFolderIconUrl(!1,192):A.Aq.getDefaultLibIconUrl(!0),a=e.is_dir?s:A.Aq.getFileIconUrl(e.name);return""!==e.thumbnail_url&&(a=e.thumbnail_url),(0,x.jsxs)("li",{className:"search-result-item",children:[(0,x.jsx)("img",{className:t?"item-img":"lib-item-img",src:a,alt:""}),(0,x.jsxs)("div",{className:"item-content",children:[(0,x.jsx)("div",{className:"item-name ellipsis",children:(0,x.jsx)("a",{href:this.handlerFileURL(e),target:"_blank",title:e.name,rel:"noreferrer",children:e.name})}),(0,x.jsx)("div",{className:"item-link ellipsis",children:(0,x.jsxs)("a",{href:this.handlerParentDirURL(e),target:"_blank",rel:"noreferrer",children:[e.repo_name,this.handlerParentDirPath(e)]})}),(0,x.jsx)("div",{className:"item-link ellipsis",children:A.Aq.bytesToSize(e.size)+" "+g()(1e3*e.last_modified).format("YYYY-MM-DD")}),(0,x.jsx)("div",{className:"item-text ellipsis",dangerouslySetInnerHTML:{__html:e.content_highlight}})]})]})}}])}(l.Component),j=function(e){function t(e){return(0,a.A)(this,t),(0,i.A)(this,t,[e])}return(0,n.A)(t,e),(0,r.A)(t,[{key:"render",value:function(){var e=this.props,t=e.resultItems,s=e.total;return(0,x.jsxs)("div",{className:"search-result-container position-static",children:[(0,x.jsx)("p",{className:"tip",children:s>0?s+" "+(1===s?(0,u.AP)("result"):(0,u.AP)("results")):(0,u.AP)("No result")}),(0,x.jsx)("ul",{className:"search-result-list",children:t.map((function(e,t){return(0,x.jsx)(y,{item:e},t)}))})]})}}])}(l.Component),S=s(70446),_=s.n(S),v=s(47914),T=s(70349),k=s(23931),C=s(76152),P=s(55627),I=s(85077),F=s(36656),b=s(48918),N=s(30038),M=s(18849),D=s(28189),z=window.search.pageOptions,w=z.repo_name,R=z.search_repo,L=function(e){function t(e){var s;return(0,a.A)(this,t),(s=(0,i.A)(this,t,[e])).getFileTypesList=function(e){for(var t=[(0,u.AP)("Text"),(0,u.AP)("Document"),(0,u.AP)("Image"),(0,u.AP)("Video"),(0,u.AP)("Audio"),"PDF","Markdown"],s=[],a=0,r=e.length;a<r;a++)e[a]&&s.push(t[a]);return s},s.disabledStartDate=function(e){if(!e)return!1;var t=e.isAfter(g()(),"day"),a=s.props.stateAndValues.time_to;return a&&e.isAfter(a)||t},s.disabledEndDate=function(e){if(!e)return!1;var t=e.isAfter(g()(),"day"),a=s.props.stateAndValues.time_from;return a&&e.isBefore(a)||t},s}return(0,n.A)(t,e),(0,r.A)(t,[{key:"render",value:function(){var e=this,t=this.props.stateAndValues,s=t.errorDateMsg,a=t.errorSizeMsg;if(t.isShowSearchFilter){var r=t.size_from,i=t.size_to,n=t.time_from,o=t.time_to,h=t.search_repo,c=t.fileTypeItemsStatus,p=this.getFileTypesList(c),d=p.length;return(0,x.jsxs)("div",{className:"search-filters",children:[h&&(0,x.jsxs)("span",{className:"mr-4",children:[(0,u.AP)("Libraries"),": ","all"==h?(0,u.AP)("All"):w]}),d>0&&(0,x.jsxs)("span",{className:"mr-4",children:[(0,u.AP)("File Types"),": ",p.map((function(e,t){return(0,x.jsxs)("span",{children:[e,t!==d-1&&","," "]},t)}))]}),n&&o&&(0,x.jsxs)("span",{className:"mr-4",children:[(0,u.AP)("Last Update"),": ",n.format("YYYY-MM-DD")," ",(0,u.AP)("to")," ",o.format("YYYY-MM-DD")]}),r&&i&&(0,x.jsxs)("span",{className:"mr-4",children:[(0,u.AP)("Size"),": ",r,"MB - ",i,"MB"]})]})}return(0,x.jsx)("div",{className:"advanced-search",children:(0,x.jsxs)(v.A,{isOpen:t.isCollapseOpen,children:["all"!==R&&(0,x.jsx)("div",{className:"search-repo search-catalog",children:(0,x.jsxs)(T.A,{children:[(0,x.jsxs)(k.A,{md:"2",lg:"2",children:[(0,u.AP)("Libraries"),": "]}),(0,x.jsx)(k.A,{md:"4",lg:"4",children:(0,x.jsx)(C.A,{check:!0,children:(0,x.jsxs)(P.A,{check:!0,children:[(0,x.jsx)(I.A,{type:"radio",name:"repo",checked:t.isAllRepoCheck,onChange:function(){return e.props.handlerRepo(!0)}}),(0,u.AP)("In all libraries")]})})}),(0,x.jsx)(k.A,{md:"4",lg:"4",children:(0,x.jsx)(C.A,{check:!0,children:(0,x.jsxs)(P.A,{check:!0,children:[(0,x.jsx)(I.A,{type:"radio",name:"repo",checked:!t.isAllRepoCheck,onChange:function(){return e.props.handlerRepo(!1)}}),w]})})})]})}),(0,x.jsxs)("div",{className:"search-file-types search-catalog",children:[(0,x.jsxs)(T.A,{children:[(0,x.jsxs)(k.A,{md:"2",lg:"2",children:[(0,u.AP)("File Types"),": "]}),(0,x.jsx)(k.A,{md:"4",lg:"4",children:(0,x.jsx)(C.A,{check:!0,children:(0,x.jsxs)(P.A,{check:!0,children:[(0,x.jsx)(I.A,{type:"radio",name:"types",checked:!t.isFileTypeCollapseOpen,onChange:this.props.closeFileTypeCollapse}),(0,u.AP)("All file types")]})})}),(0,x.jsx)(k.A,{md:"4",lg:"4",children:(0,x.jsx)(C.A,{check:!0,children:(0,x.jsxs)(P.A,{check:!0,children:[(0,x.jsx)(I.A,{type:"radio",name:"types",checked:t.isFileTypeCollapseOpen,onChange:this.props.openFileTypeCollapse}),(0,u.AP)("Custom file types")]})})})]}),(0,x.jsxs)(T.A,{children:[(0,x.jsx)(k.A,{md:"2",lg:"2"}),(0,x.jsx)(k.A,{md:"10",lg:"10",children:(0,x.jsxs)(v.A,{isOpen:t.isFileTypeCollapseOpen,children:[(0,x.jsx)(C.A,{className:"search-file-types-form",children:(0,x.jsxs)(l.Fragment,{children:[(0,x.jsx)(F.A,{type:"checkbox",id:"checkTextFiles",label:(0,u.AP)("Text files"),inline:!0,onChange:function(){return e.props.handlerFileTypes(0)},checked:t.fileTypeItemsStatus[0]}),(0,x.jsx)(F.A,{type:"checkbox",id:"checkDocuments",label:(0,u.AP)("Documents"),inline:!0,onChange:function(){return e.props.handlerFileTypes(1)},checked:t.fileTypeItemsStatus[1]}),(0,x.jsx)(F.A,{type:"checkbox",id:"checkImages",label:(0,u.AP)("Images"),inline:!0,onChange:function(){return e.props.handlerFileTypes(2)},checked:t.fileTypeItemsStatus[2]}),(0,x.jsx)(F.A,{type:"checkbox",id:"checkVideo",label:(0,u.AP)("Video"),inline:!0,onChange:function(){return e.props.handlerFileTypes(3)},checked:t.fileTypeItemsStatus[3]}),(0,x.jsx)(F.A,{type:"checkbox",id:"checkAudio",label:(0,u.AP)("Audio"),inline:!0,onChange:function(){return e.props.handlerFileTypes(4)},checked:t.fileTypeItemsStatus[4]}),(0,x.jsx)(F.A,{type:"checkbox",id:"checkPdf",label:"PDF",inline:!0,onChange:function(){return e.props.handlerFileTypes(5)},checked:t.fileTypeItemsStatus[5]}),(0,x.jsx)(F.A,{type:"checkbox",id:"checkMarkdown",label:"Markdown",inline:!0,onChange:function(){return e.props.handlerFileTypes(6)},checked:t.fileTypeItemsStatus[6]})]})}),(0,x.jsx)("input",{type:"text",className:"form-control search-input",name:"query",autoComplete:"off",placeholder:(0,u.AP)("Input file extensions here, separate with ','"),onChange:this.props.handlerFileTypesInput,value:t.input_fexts,onKeyDown:this.props.handleKeyDown})]})})]})]}),(0,x.jsxs)("div",{className:"search-date search-catalog",children:[(0,x.jsxs)(T.A,{children:[(0,x.jsxs)(k.A,{md:"2",lg:"2",className:"mt-2",children:[(0,u.AP)("Last Update"),": "]}),(0,x.jsxs)(k.A,{md:"4",lg:"4",sm:"4",xs:"5",className:"position-relative",children:[(0,x.jsx)(D.A,{inputWidth:"100%",disabledDate:this.disabledStartDate,value:t.time_from,onChange:this.props.handleTimeFromInput,showHourAndMinute:!1}),(0,x.jsx)("span",{className:"select-data-icon",children:(0,x.jsx)("i",{className:"sf3-font sf3-font-calendar-alt"})})]}),(0,x.jsx)("div",{className:"mt-2",children:"-"}),(0,x.jsxs)(k.A,{md:"4",lg:"4",sm:"4",xs:"5",className:"position-relative",children:[(0,x.jsx)(D.A,{inputWidth:"100%",disabledDate:this.disabledEndDate,value:t.time_to,onChange:this.props.handleTimeToInput,showHourAndMinute:!1}),(0,x.jsx)("span",{className:"select-data-icon",children:(0,x.jsx)("i",{className:"sf3-font sf3-font-calendar-alt"})})]})]}),s&&(0,x.jsxs)(T.A,{children:[(0,x.jsx)(k.A,{md:"2",lg:"2"}),(0,x.jsx)(k.A,{md:"8",className:"error mt-2",children:s})]})]}),(0,x.jsx)("div",{className:"search-size search-catalog",children:(0,x.jsxs)(T.A,{children:[(0,x.jsxs)(k.A,{md:"2",lg:"2",className:"mt-2",children:[(0,u.AP)("Size"),": "]}),(0,x.jsxs)(k.A,{md:"4",lg:"4",sm:"4",xs:"5",children:[(0,x.jsx)(C.A,{children:(0,x.jsxs)(b.A,{children:[(0,x.jsx)(I.A,{type:"tel",name:"size_from",onKeyDown:this.props.handleKeyDown,onChange:this.props.handleSizeFromInput,value:t.size_from}),(0,x.jsx)(N.A,{addonType:"append",children:"MB"})]})}),(0,x.jsxs)(_(),{query:"(min-width: 768px)",children:[a&&(0,x.jsx)("div",{className:"error mb-4",children:a}),(0,x.jsx)(M.A,{color:"primary",onClick:this.props.handleSubmit,children:(0,u.AP)("Submit")}),(0,x.jsx)(M.A,{className:"ml-2",onClick:this.props.handleReset,children:(0,u.AP)("Reset")})]})]}),(0,x.jsx)("div",{className:"mt-2",children:"-"}),(0,x.jsx)(k.A,{md:"4",lg:"4",sm:"4",xs:"5",children:(0,x.jsx)(C.A,{children:(0,x.jsxs)(b.A,{children:[(0,x.jsx)(I.A,{type:"tel",name:"size_to",onKeyDown:this.props.handleKeyDown,onChange:this.props.handleSizeToInput,value:t.size_to}),(0,x.jsx)(N.A,{addonType:"append",children:"MB"})]})})})]})}),(0,x.jsxs)(_(),{query:"(max-width: 767.8px)",children:[a&&(0,x.jsx)("div",{className:"error mb-4",children:a}),(0,x.jsx)(M.A,{color:"primary",onClick:this.props.handleSubmit,children:(0,u.AP)("Submit")}),(0,x.jsx)(M.A,{className:"ml-2",onClick:this.props.handleReset,children:(0,u.AP)("Reset")})]})]})})}}])}(l.Component),q=s(4086),O=s(81446),Y=(s(81848),window.search.pageOptions),H=Y.q,K=Y.search_repo,U=Y.search_ftypes,V=function(e){function t(e){var s;return(0,a.A)(this,t),(s=(0,i.A)(this,t,[e])).onNormalSearch=function(e){var t=d()(s.state);m.e.searchFiles(e,null).then((function(a){var r=a.data,i=r.results,n=r.has_more,l=r.total;s.setState({isLoading:!1,isResultGot:!0,resultItems:i,hasMore:n,total:l,page:e.page,isShowSearchFilter:!0}),s.stateHistory=t,s.stateHistory.resultItems=i,s.stateHistory.hasMore=n,s.stateHistory.page=e.page})).catch((function(e){s.setState({isLoading:!1}),e.response?q.A.danger(e.response.data.detail||e.response.data.error_msg||(0,u.AP)("Error"),{duration:3}):q.A.danger((0,u.AP)("Please check the network."),{duration:3})}))},s.handleSearchParams=function(e){var t={q:s.state.q.trim(),page:e},a=s.getFileTypesList();s.state.search_repo&&(t.search_repo=s.state.search_repo),s.state.search_ftypes&&(t.search_ftypes=s.state.search_ftypes),s.state.per_page&&(t.per_page=s.state.per_page),s.state.input_fexts&&(t.input_fexts=s.state.input_fexts);var r=s.state,i=r.time_from,n=r.time_to;return i&&(t.time_from=parseInt(i.valueOf()/1e3)),n&&(t.time_to=parseInt(n.valueOf()/1e3)),s.state.size_from&&(t.size_from=1e3*s.state.size_from*1e3),s.state.size_to&&(t.size_to=1e3*s.state.size_to*1e3),0!==a.length&&(t.ftype=a),t},s.handleSubmit=function(){if(s.compareNumber(s.state.size_from,s.state.size_to))s.setState({errorSizeMsg:(0,u.AP)("Invalid file size range.")});else{if(s.getValueLength(s.state.q.trim())<3)0===s.state.q.trim().length?s.setState({errorMsg:(0,u.AP)("It is required.")}):s.setState({errorMsg:(0,u.AP)("Required at least three letters.")}),s.state.isLoading&&s.setState({isLoading:!1});else{var e=s.handleSearchParams(1);s.getSearchResults(e)}s.state.isCollapseOpen&&s.setState({isCollapseOpen:!1})}},s.compareNumber=function(e,t){return!(!e||!t)&&parseInt(e.replace(/\-/g,""))>=parseInt(t.replace(/\-/g,""))},s.showSearchFilter=function(){s.setState({isShowSearchFilter:!0})},s.hideSearchFilter=function(){s.setState({isShowSearchFilter:!1})},s.handleReset=function(){s.setState({q:H.trim(),search_repo:K,search_ftypes:U,fileTypeItemsStatus:[!1,!1,!1,!1,!1,!1,!1],input_fexts:"",time_from:null,time_to:null,size_from:"",size_to:"",errorMsg:"",errorDateMsg:"",errorSizeMsg:""})},s.handlePrevious=function(e){e.preventDefault(),s.stateHistory&&s.state.page>1?s.setState(s.stateHistory,(function(){var e=s.handleSearchParams(s.state.page-1);s.getSearchResults(e)})):q.A.danger((0,u.AP)("Error"),{duration:3})},s.handleNext=function(e){e.preventDefault(),s.stateHistory&&s.state.hasMore?s.setState(s.stateHistory,(function(){var e=s.handleSearchParams(s.state.page+1);s.getSearchResults(e)})):q.A.danger((0,u.AP)("Error"),{duration:3})},s.toggleCollapse=function(){s.setState({isCollapseOpen:!s.state.isCollapseOpen}),s.hideSearchFilter()},s.openFileTypeCollapse=function(){s.setState({isFileTypeCollapseOpen:!0,search_ftypes:"custom"})},s.closeFileTypeCollapse=function(){s.setState({isFileTypeCollapseOpen:!1,fileTypeItemsStatus:Array(7).fill(!1),search_ftypes:"all",input_fexts:""})},s.handleSearchInput=function(e){s.setState({q:e.target.value}),s.state.errorMsg&&s.setState({errorMsg:""}),s.state.errorSizeMsg&&s.setState({errorSizeMsg:""}),s.state.errorDateMsg&&s.setState({errorDateMsg:""})},s.handleKeyDown=function(e){13===e.keyCode&&(e.preventDefault(),s.handleSubmit())},s.handlerRepo=function(e){e?s.setState({isAllRepoCheck:!0,search_repo:"all"}):s.setState({isAllRepoCheck:!1,search_repo:"all"!==K?K:""})},s.handlerFileTypes=function(e){var t=s.state.fileTypeItemsStatus;t[e]=!s.state.fileTypeItemsStatus[e],s.setState({fileTypeItemsStatus:t})},s.getFileTypesList=function(){for(var e=["Text","Document","Image","Video","Audio","PDF","Markdown"],t=[],a=0,r=s.state.fileTypeItemsStatus.length;a<r;a++)s.state.fileTypeItemsStatus[a]&&t.push(e[a]);return t},s.handlerFileTypesInput=function(e){s.setState({input_fexts:e.target.value.trim()})},s.handleTimeFromInput=function(e){s.setState({time_from:e?e.hours(0).minutes(0).seconds(0):e}),s.state.errorDateMsg&&s.setState({errorDateMsg:""})},s.handleTimeToInput=function(e){s.setState({time_to:e?e.hours(23).minutes(59).seconds(59):e}),s.state.errorDateMsg&&s.setState({errorDateMsg:""})},s.handleSizeFromInput=function(e){s.setState({size_from:e.target.value>=0?e.target.value:0}),s.state.errorSizeMsg&&s.setState({errorSizeMsg:""})},s.handleSizeToInput=function(e){s.setState({size_to:e.target.value>=0?e.target.value:0}),s.state.errorSizeMsg&&s.setState({errorSizeMsg:""})},s.stateHistory=null,s.state={isCollapseOpen:"all"!==K,isFileTypeCollapseOpen:!1,isResultGot:!1,isLoading:!0,isAllRepoCheck:"all"===K,isShowSearchFilter:!1,q:H.trim(),search_repo:K,search_ftypes:U,fileTypeItemsStatus:[!1,!1,!1,!1,!1,!1,!1],input_fexts:"",time_from:null,time_to:null,size_from:"",size_to:"",hasMore:!1,resultItems:[],page:1,per_page:20,errorMsg:"",errorDateMsg:"",errorSizeMsg:""},s}return(0,n.A)(t,e),(0,r.A)(t,[{key:"getSearchResults",value:function(e){this.setState({isLoading:!0,isResultGot:!1}),this.onNormalSearch(e)}},{key:"getValueLength",value:function(e){for(var t=0,s=0,a=0,r=e.length;a<r;a++)10===(t=e.charCodeAt(a))?s+=2:t<127?s+=1:t>=128&&t<=2047?s+=2:t>=2048&&t<=65535&&(s+=3);return s}},{key:"componentDidMount",value:function(){this.state.q?this.handleSubmit():this.setState({isLoading:!1})}},{key:"render",value:function(){var e=this.state.isCollapseOpen;return(0,x.jsxs)("div",{className:"search-page",children:[(0,x.jsxs)("div",{className:"search-page-container",children:[(0,x.jsxs)("div",{className:"input-icon align-items-center d-flex",children:[(0,x.jsx)("input",{type:"text",className:"form-control search-input",name:"query",autoComplete:"off",value:this.state.q,placeholder:(0,u.AP)("Search files"),onChange:this.handleSearchInput,onKeyDown:this.handleKeyDown}),(0,x.jsx)("i",{className:"search-icon-right input-icon-addon sf3-font sf3-font-search",onClick:this.handleSubmit}),(0,x.jsx)("i",{className:"action-icon sf3-font sf3-font-angles-".concat(e?"up":"down"),onClick:this.toggleCollapse})]}),this.state.errorMsg&&(0,x.jsx)("div",{className:"error",children:this.state.errorMsg}),(0,x.jsx)(L,{openFileTypeCollapse:this.openFileTypeCollapse,closeFileTypeCollapse:this.closeFileTypeCollapse,handlerFileTypes:this.handlerFileTypes,handlerFileTypesInput:this.handlerFileTypesInput,handleSubmit:this.handleSubmit,handleReset:this.handleReset,handlerRepo:this.handlerRepo,handleKeyDown:this.handleKeyDown,handleTimeFromInput:this.handleTimeFromInput,handleTimeToInput:this.handleTimeToInput,handleSizeFromInput:this.handleSizeFromInput,handleSizeToInput:this.handleSizeToInput,stateAndValues:this.state})]}),this.state.isLoading&&(0,x.jsx)(O.A,{}),!this.state.isLoading&&this.state.isResultGot&&(0,x.jsx)(j,{resultItems:this.state.resultItems,total:this.state.total}),!this.state.isLoading&&this.state.isResultGot&&(0,x.jsxs)("div",{className:"paginator",children:[1!==this.state.page&&(0,x.jsx)("a",{href:"#",onClick:this.handlePrevious,children:(0,u.AP)("Previous")}),1!==this.state.page&&this.state.hasMore&&(0,x.jsx)("span",{children:" | "}),this.state.hasMore&&(0,x.jsx)("a",{href:"#",onClick:this.handleNext,children:(0,u.AP)("Next")})]})]})}}])}(l.Component),B=(s(16322),s(18291),function(e){function t(e){var s;return(0,a.A)(this,t),(s=(0,i.A)(this,t,[e])).onSearchedClick=function(e){var t=e.is_dir?u.Yc+"library/"+e.repo_id+"/"+e.repo_name+e.path:u.Yc+"lib/"+e.repo_id+"/file"+A.Aq.encodePath(e.path);window.open("about:blank").location.href=t},s}return(0,n.A)(t,e),(0,r.A)(t,[{key:"render",value:function(){return(0,x.jsxs)("div",{className:"w-100 h-100",children:[(0,x.jsxs)("div",{className:"main-panel-north border-left-show",children:[(0,x.jsx)(c.A,{}),(0,x.jsx)(h.A,{onSearchedClick:this.onSearchedClick})]}),(0,x.jsx)("div",{className:"main-panel-south",children:(0,x.jsx)(V,{})})]})}}])}(l.Component));o.render((0,x.jsx)(B,{}),document.getElementById("wrapper"))}},function(e){e.O(0,[4223],(function(){return t=3640,e(e.s=t);var t}));e.O()}]);