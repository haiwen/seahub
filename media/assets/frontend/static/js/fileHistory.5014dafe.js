"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[9207],{78979:function(e,t,n){var i=n(23029),r=n(92901),o=n(39874),s=n(85501),a=n(9950),l=n(1352),c=n(90287),u=n(40326),d=n(60436),h=n(75511),f=n(9961),m=n(4159),p=n.n(m),k=n(5495),g=n(69123),v=n(65276),I=n(34940),y=n(57354),C=(n(73424),n(44414));p().locale(window.app.config.lang);var x=function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,o.default)(this,t,[e])).onMouseEnter=function(){n.props.isItemFreezed||n.setState({isShowOperationIcon:!0})},n.onMouseLeave=function(){n.props.isItemFreezed||n.setState({isShowOperationIcon:!1})},n.onToggleClick=function(e){n.setState({isMenuShow:!n.state.isMenuShow}),n.props.onFreezedItemToggle()},n.onItemClick=function(){if(n.setState({isShowOperationIcon:!1}),n.props.item.commit_id!==n.props.currentItem.commit_id){var e=n.props.index;n.props.onItemClick(n.props.item,e)}},n.onItemRestore=function(){n.props.onItemRestore(n.props.currentItem)},n.onItemDownload=function(){},n.state={isShowOperationIcon:!1,isMenuShow:!1},n}return(0,s.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){if(!this.props.currentItem)return"";var e=this.props.item,t=p()(e.ctime).format("YYYY-MM-DD HH:mm"),n=!1;this.props.item&&this.props.currentItem&&(n=this.props.item.commit_id===this.props.currentItem.commit_id);var i=this.props.currentItem.rev_file_id,r=y.A.getUrl({type:"download_historic_file",filePath:u.s$t,objID:i});return(0,C.jsxs)("li",{className:"history-list-item ".concat(n?"item-active":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onItemClick,children:[(0,C.jsxs)("div",{className:"history-info",children:[(0,C.jsx)("div",{className:"time",children:t}),(0,C.jsxs)("div",{className:"owner",children:[(0,C.jsx)("span",{className:"squire-icon"}),(0,C.jsx)("span",{children:e.creator_name})]})]}),(0,C.jsx)("div",{className:"history-operation",children:(0,C.jsxs)(k.A,{isOpen:this.state.isMenuShow,toggle:this.onToggleClick,children:[(0,C.jsx)(g.A,{tag:"a",className:"sf3-font sf3-font-more ".concat(this.state.isShowOperationIcon||n?"":"invisible"),"data-toggle":"dropdown","aria-expanded":this.state.isMenuShow,title:(0,u.APU)("More operations"),"aria-label":(0,u.APU)("More operations")}),(0,C.jsxs)(v.A,{children:[0!==this.props.index&&(0,C.jsx)(I.A,{onClick:this.onItemRestore,children:(0,u.APU)("Restore")}),(0,C.jsx)(I.A,{tag:"a",href:r,onClick:this.onItemDownLoad,children:(0,u.APU)("Download")})]})]})})]})}}])}(a.Component),w=function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,o.default)(this,t,[e])).componentDidMount=function(){var e=n.props.historyList;e.length>0&&(n.setState({currentItem:e[0]}),1===e?n.props.onItemClick(e[0]):n.props.onItemClick(e[0],e[1]))},n.onFreezedItemToggle=function(){n.setState({isItemFreezed:!n.state.isItemFreezed})},n.onScrollHandler=function(e){var t=e.target.clientHeight,i=e.target.scrollHeight,r=t+e.target.scrollTop+1>=i,o=n.props.hasMore;r&&o&&n.props.reloadMore()},n.onItemClick=function(e,t){if(n.setState({currentItem:e}),t!==n.props.historyList.length){var i=n.props.historyList[t+1];n.props.onItemClick(e,i)}else n.props.onItemClick(e)},n.state={isItemFreezed:!1,currentItem:null},n}return(0,s.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this;return(0,C.jsxs)("ul",{className:"history-list-container",onScroll:this.onScrollHandler,children:[this.props.historyList.map((function(t,n){return(0,C.jsx)(x,{item:t,index:n,currentItem:e.state.currentItem,isItemFreezed:e.state.isItemFreezed,onItemClick:e.onItemClick,onItemRestore:e.props.onItemRestore,onFreezedItemToggle:e.onFreezedItemToggle},n)})),this.props.isReloadingData&&(0,C.jsx)("li",{children:(0,C.jsx)(f.A,{})})]})}}])}(a.Component),j=n(4086),M=function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,o.default)(this,t,[e])).reloadMore=function(){if(!n.state.isReloadingData){var e=n.state.currentPage+1;n.setState({currentPage:e,isReloadingData:!0}),h.A.listFileHistoryRecords(u.s$t,e,u.EKj).then((function(e){n.updateResultState(e.data),n.setState({isReloadingData:!1})}))}},n.onItemRestore=function(e){var t=e.commit_id;h.A.revertFile(u.s$t,t).then((function(e){e.data.success&&(n.setState({isLoading:!0}),n.refreshFileList());var t=(0,u.APU)("Successfully restored.");j.A.success(t)}))},n.onItemClick=function(e,t){n.props.onItemClick(e,t)},n.state={historyInfo:"",currentPage:1,hasMore:!1,isLoading:!0,isError:!1,fileOwner:"",isReloadingData:!1},n}return(0,s.default)(t,e),(0,r.default)(t,[{key:"componentDidMount",value:function(){var e=this;h.A.listFileHistoryRecords(u.s$t,1,u.EKj).then((function(t){if(0===t.data.length)throw e.setState({isLoading:!1}),Error("there has an error in server");e.initResultState(t.data)}))}},{key:"refreshFileList",value:function(){var e=this;h.A.listFileHistoryRecords(u.s$t,1,u.EKj).then((function(t){e.initResultState(t.data)}))}},{key:"initResultState",value:function(e){e.data.length&&this.setState({historyInfo:e.data,currentPage:e.page,hasMore:e.total_count>u.EKj*this.state.currentPage,isLoading:!1,isError:!1,fileOwner:e.data[0].creator_email})}},{key:"updateResultState",value:function(e){e.data.length&&this.setState({historyInfo:[].concat((0,d.default)(this.state.historyInfo),(0,d.default)(e.data)),currentPage:e.page,hasMore:e.total_count>u.EKj*this.state.currentPage,isLoading:!1,isError:!1,fileOwner:e.data[0].creator_email})}},{key:"render",value:function(){return(0,C.jsx)("div",{className:"side-panel history-side-panel",children:(0,C.jsxs)("div",{className:"side-panel-center",children:[(0,C.jsx)("div",{className:"history-side-panel-title",children:(0,u.APU)("History Versions")}),(0,C.jsxs)("div",{className:"history-body",children:[this.state.isLoading&&(0,C.jsx)(f.A,{}),this.state.historyInfo&&(0,C.jsx)(w,{hasMore:this.state.hasMore,isReloadingData:this.state.isReloadingData,historyList:this.state.historyInfo,reloadMore:this.reloadMore,onItemClick:this.onItemClick,onItemRestore:this.onItemRestore})]})]})})}}])}(a.Component),S=n(92203),F=function(e){function t(){return(0,i.default)(this,t),(0,o.default)(this,t,arguments)}return(0,s.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.props,t=e.renderingContent,n=e.newMarkdownContent;return(0,C.jsxs)("div",{className:"content-viewer flex-fill",children:[t&&(0,C.jsx)(f.A,{}),!t&&(0,C.jsx)(S.MarkdownViewer,{isFetching:t,value:n,isShowOutline:!1,mathJaxSource:u.SGU+"js/mathjax/tex-svg.js"})]})}}])}(a.Component),D=F,R=n(97011),A=(n(16322),function(e){function t(e){var n;return(0,i.default)(this,t),(n=(0,o.default)(this,t,[e])).setDiffContent=function(e,t){n.setState({renderingContent:!1,newMarkdownContent:e,oldMarkdownContent:t})},n.onHistoryItemClick=function(e,t){n.setState({renderingContent:!0}),R.e.getFileRevision(u.IId,e.commit_id,e.path).then((function(e){c.A.all([R.e.getFileContent(e.data)]).then(c.A.spread((function(e){n.setDiffContent(e.data,"")})))}))},n.onBackClick=function(e){e.preventDefault(),window.history.back()},n.state={renderingContent:!0,newMarkdownContent:"",oldMarkdownContent:""},n}return(0,s.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){return(0,C.jsxs)("div",{className:"history-content flex-fill d-flex h-100",children:[(0,C.jsxs)("div",{className:"flex-fill d-flex flex-column text-truncate",children:[(0,C.jsx)("div",{className:"history-header file-history-header flex-shrink-0",children:(0,C.jsxs)("div",{className:"title d-flex mw-100",children:[(0,C.jsx)("a",{href:"#",className:"go-back",title:"Back",onClick:this.onBackClick,children:(0,C.jsx)("span",{className:"sf3-font sf3-font-down rotate-90 d-inline-block"})}),(0,C.jsx)("span",{className:"name text-truncate",title:u.MdH,children:u.MdH})]})}),(0,C.jsx)(D,{newMarkdownContent:this.state.newMarkdownContent,oldMarkdownContent:this.state.oldMarkdownContent,renderingContent:this.state.renderingContent})]}),(0,C.jsx)(M,{onItemClick:this.onHistoryItemClick})]})}}])}(a.Component));(0,l.createRoot)(document.getElementById("wrapper")).render((0,C.jsx)(A,{}))},75511:function(e,t,n){var i=n(23029),r=n(92901),o=n(40326),s=n(97011),a=new(function(){return(0,r.default)((function e(){(0,i.default)(this,e)}),[{key:"listRepoDir",value:function(){return s.e.listDir(o.GCj,"/",{recursive:!0}).then((function(e){return e.data.dirent_list.map((function(e){return{name:e.name,type:"dir"===e.type?"dir":"file",isExpanded:"dir"===e.type,parent_path:e.parent_dir,last_update_time:e.mtime,permission:e.permission,size:e.size}}))}))}},{key:"deleteFile",value:function(e){return s.e.deleteFile(o.GCj,e)}},{key:"renameFile",value:function(e,t){return s.e.renameFile(o.GCj,e,t)}},{key:"createDir",value:function(e){return s.e.createDir(o.GCj,e)}},{key:"deleteDir",value:function(e){return s.e.deleteDir(o.GCj,e)}},{key:"renameDir",value:function(e,t){return s.e.renameDir(o.GCj,e,t)}},{key:"getWikiFileContent",value:function(e,t){return s.e.getWikiFileContent(e,t)}},{key:"getSource",value:function(){return s.e.getSource()}},{key:"searchFiles",value:function(e,t){return s.e.searchFiles(e,t)}},{key:"getAccountInfo",value:function(){return s.e.getAccountInfo()}},{key:"getFileDownloadLink",value:function(e){return s.e.getFileDownloadLink(o.IId,e)}},{key:"getFileContent",value:function(e){return s.e.getFileContent(e)}},{key:"listFileHistoryRecords",value:function(e,t,n){return s.e.listFileHistoryRecords(o.IId,e,t,n)}},{key:"revertFile",value:function(e,t){return s.e.revertFile(o.IId,e,t)}},{key:"zipDownload",value:function(e,t){return s.e.zipDownload(o.GCj,e,t)}},{key:"queryZipProgress",value:function(e){return s.e.queryZipProgress(e)}},{key:"cancelZipTask",value:function(e){return s.e.cancelZipTask(e)}}])}());t.A=a},73424:function(){}},function(e){e.O(0,[4223],(function(){return t=78979,e(e.s=t);var t}));e.O()}]);