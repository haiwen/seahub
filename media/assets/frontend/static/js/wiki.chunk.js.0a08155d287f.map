{"version":3,"sources":["components/context-menu/globalEventListener.js","components/context-menu/context-menu.js","components/dropdown-menu/item-dropdown-menu.js","components/index-viewer.js","pages/wiki/side-panel.js","components/wiki-dir-list-view/wiki-dir-list-item.js","components/wiki-dir-list-view/wiki-dir-list-view.js","pages/wiki/main-panel.js","wiki.js","components/wiki-markdown-viewer.js","components/tree-view/tree-node-view.js","components/tree-view/tree-view.js","components/context-menu/actions.js","components/context-menu/helpers.js"],"names":["handleShowEvent","event","id","callbacks","hasOwnProp","show","handleHideEvent","hide","register","showCallback","hideCallback","uniqueId","unregister","this","canUseDOM","window","addEventListener","MENU_SHOW","MENU_HIDE","ContextMenu","props","registerHandlers","document","handleOutsideClick","handleHide","handleKeyNavigation","unregisterHandlers","removeEventListener","handleShow","e","detail","state","isVisible","position","x","y","currentObject","menuList","setState","callIfExists","onShowMenu","onHideMenu","menu","contains","target","hideMenu","handleMouseLeave","preventDefault","hideOnLeave","handleContextMenu","keyCode","getMenuPosition","menuStyles","top","left","innerWidth","innerHeight","rect","getBoundingClientRect","height","width","getRTLMenuPosition","onMenuItemClick","stopPropagation","operation","Utils","getEventData","onContextMenu","listenId","listener","wrapper","requestAnimationFrame","setTimeout","rtl","style","opacity","pointerEvents","role","className","display","ref","map","menuItem","index","data-operation","key","onClick","value","React","Component","ItemDropdownMenu","isItemMenuShow","unfreezeItem","onDropdownToggleKeyDown","onDropdownToggleClick","toggleOperationMenu","freezeItem","onMenuItemKeyDown","item","isHandleContextMenuEvent","listenerId","getMenuList","nextProps","name","toggleClass","tagName","length","isOpen","toggle","data-toggle","title","gettext","aria-label","aria-expanded","onKeyDown","divider","tag","tabIndex","defaultProps","TreeNode","href","parentNode","children","nodeList","forEach","node","setParent","IndexContentViewer","bindClickEvent","links","querySelectorAll","link","onLinkClick","removeClickEvent","currentPath","getAttribute","getLink","changeInlineNode","url","type","isPublicWiki","data","src","RegExp","serviceURL","repoID","test","indexOf","index2","imagePath","substring","slug","isInternalMarkdownLink","path","getPathFromInternalMarkdownLink","isInternalDirLink","getPathFromInternalDirLink","getRootNode","deserialize","indexContent","changeMarkdownNodes","treeRoot","transSlateToTree","setNodePath","parentNodePath","child","slateNodes","parentTreeNode","treeNodes","slateNode","transParagraph","paragraphNode","treeNode","listNode","addChildren","linkNode","textNode","text","FolderItem","toggleExpanded","expanded","renderLink","data-path","Fragment","SidePanel","renderIndexView","marginTop","renderTreeView","treeData","isNodeMenuShow","onNodeClick","onNodeCollapse","onNodeExpanded","closeSideBar","onCloseSidePanel","onCloseSide","isTreeDataLoading","indexNode","username","permission","siteRoot","WikiDirListItem","onMouseEnter","highlight","onMouseLeave","onDirentClick","dirent","joinPath","iconUrl","getDirentIcon","isDesktop","alt","size","mtime_relative","WikiDirListView","direntList","MainPanel","onMenuClick","onEditClick","open","onMainNavBarClick","renderNavPath","paths","split","nodePath","onSearchedClick","searchPlaceholder","errMessage","isViewingFile","pathExist","isDataLoading","isViewFile","content","isPro","isPublic","placeholder","markdownContent","isFileLoading","lastModified","latestContributor","isWiki","moment","locale","lang","Wiki","loadSidePanel","initialPath","hasIndex","loadIndexNode","isDir","loadNodeAndParentsByPath","loadWikiData","pythonWrapper","getElementById","removePythonWrapper","fileUrl","encodePath","history","pushState","showDir","seafileAPI","listWikiDir","then","res","tree","addFirstResponseListToNode","dirent_list","root","getNodeByPath","indexPath","getWikiFileContent","catch","isLoadFailed","dirPath","loadDirentList","showFile","filePath","unix","last_modified","fromNow","latest_contributor","hash","location","replaceState","Dirent","filter","toLowerCase","sortDirents","loadTreeNodeByPath","clone","isLoaded","isExpanded","currentNode","addResponseListToNode","isMarkdownFile","getDirName","results","i","object","parent_dir","push","body","removeChild","onConentLinkClick","isWikiInternalMarkdownLink","getPathFromWikiInternalMarkdownLink","isWikiInternalDirLink","getPathFromWikiInternalDirLink","onpopstate","is_dir","slice","getPaths","treeHelper","expandNode","sharedToken","direntPath","w","collapseNode","list","buildTree","homePath","query","contentClassName","ReactDOM","render","contentClass","WikiMarkdownViewer","getTitlesInfo","titlesInfo","titleDom","replace","updateTabTitle","headingList","offsetTop","onScrollHandler","activeTitleIndex","contentScrollTop","markdownContainer","current","scrollTop","titlesLength","originalPath","lastIndexOf","pathNormalize","isInternalFileLink","match","p1","p2","p3","modifyValueBeforeRender","renderMarkdown","isTOCShow","showTOC","scriptSource","mediaUrl","createRef","onScroll","bind","MarkdownViewer","TreeNodeView","isItemFreezed","isShowOperationMenu","isHighlight","onMouseOver","getUserPermission","isCustomPermission","customPermission","canPreview","preview","canModify","modify","onLoadToggle","onNodeDragStart","isIEBrower","canDrag","onNodeDragEnter","isNodeDropShow","onNodeDragMove","onNodeDragLeave","onNodeDrop","onItemMouseDown","button","onItemContextMenu","handleContextClick","getNodeTypeAndIcon","icon","suffix","calculateMenuList","NEW_FOLDER","TextTranslation","NEW_FILE","COPY","MOVE","RENAME","DELETE","OPEN_VIA_CLIENT","userPerm","canDelete","delete","canCopy","copy","renderChildren","paddingLeft","hasChildren","hlClass","onMouseDown","draggable","onDragStart","onDragEnter","onDragLeave","onDragOver","onDrop","TreeView","onItemMove","repo","selectedPath","dragStartNodeData","nodeDirent","nodeParentPath","nodeRootPath","JSON","stringify","dataTransfer","effectAllowed","setData","canDrop","persist","isTreeViewDropTipShow","dropEffect","files","getData","parse","dropNodeData","Array","isArray","onMoveItems","currentRepoInfo","onItemsMove","includes","destRepo","destDirentPath","direntPaths","some","clientX","touches","pageX","clientY","pageY","posX","posY","showMenuConfig","showMenu","dispatchGlobalEvent","eventName","opts","CustomEvent","createEvent","initCustomEvent","dispatchEvent","assign","store","func","args","obj","prop","Object","prototype","hasOwnProperty","call","Math","random","toString","Boolean","createElement"],"mappings":"sJA4Ce,QAvCb,aAAe,IAAD,gCASdA,gBAAkB,SAACC,GACjB,IAAK,IAAMC,KAAM,EAAKC,UAChBC,YAAW,EAAKD,UAAWD,IAAK,EAAKC,UAAUD,GAAIG,KAAKJ,IAXlD,KAedK,gBAAkB,SAACL,GACjB,IAAK,IAAMC,KAAM,EAAKC,UAChBC,YAAW,EAAKD,UAAWD,IAAK,EAAKC,UAAUD,GAAIK,KAAKN,IAjBlD,KAqBdO,SAAW,SAACC,EAAcC,GACxB,IAAMR,EAAKS,cAOX,OALA,EAAKR,UAAUD,GAAM,CACnBG,KAAMI,EACNF,KAAMG,GAGDR,GA7BK,KAgCdU,WAAa,SAACV,GACRA,GAAM,EAAKC,UAAUD,WAChB,EAAKC,UAAUD,IAjCxBW,KAAKV,UAAY,GAEbW,MACFC,OAAOC,iBAAiBC,IAAWJ,KAAKb,iBACxCe,OAAOC,iBAAiBE,IAAWL,KAAKP,oB,wHCKxCa,E,kDAEJ,WAAYC,GAAQ,IAAD,8BACjB,cAAMA,IA8CRC,iBAAmB,WACjBC,SAASN,iBAAiB,YAAa,EAAKO,oBAC5CD,SAASN,iBAAiB,aAAc,EAAKO,oBAC7CD,SAASN,iBAAiB,SAAU,EAAKQ,YACzCF,SAASN,iBAAiB,cAAe,EAAKQ,YAC9CF,SAASN,iBAAiB,UAAW,EAAKS,qBAC1CV,OAAOC,iBAAiB,SAAU,EAAKQ,aArDtB,EAwDnBE,mBAAqB,WACnBJ,SAASK,oBAAoB,YAAa,EAAKJ,oBAC/CD,SAASK,oBAAoB,aAAc,EAAKJ,oBAChDD,SAASK,oBAAoB,SAAU,EAAKH,YAC5CF,SAASK,oBAAoB,cAAe,EAAKH,YACjDF,SAASK,oBAAoB,UAAW,EAAKF,qBAC7CV,OAAOY,oBAAoB,SAAU,EAAKH,aA9DzB,EAiEnBI,WAAa,SAACC,GACZ,GAAIA,EAAEC,OAAO5B,KAAO,EAAKkB,MAAMlB,KAAM,EAAK6B,MAAMC,UAAhD,CADkB,MAGDH,EAAEC,OAAOG,SAAlBC,EAHU,EAGVA,EAAGC,EAHO,EAGPA,EAHO,EAIiBN,EAAEC,OAA7BM,EAJU,EAIVA,cAAeC,EAJL,EAIKA,SAEvB,EAAKC,SAAS,CAAEN,WAAW,EAAME,IAAGC,IAAGC,gBAAeC,aACtD,EAAKhB,mBACLkB,YAAa,EAAKnB,MAAMoB,WAAYX,KAzEnB,EA4EnBL,WAAa,SAACK,IACR,EAAKE,MAAMC,WAAeH,EAAEC,QAAWD,EAAEC,OAAO5B,IAAM2B,EAAEC,OAAO5B,KAAO,EAAKkB,MAAMlB,KACnF,EAAKwB,qBACL,EAAKY,SAAS,CAAEN,WAAW,IAC3BO,YAAa,EAAKnB,MAAMqB,WAAYZ,KAhFrB,EAoFnBN,mBAAqB,SAACM,GACf,EAAKa,KAAKC,SAASd,EAAEe,SAASC,eArFlB,EAwFnBC,iBAAmB,SAAC7C,GAClBA,EAAM8C,iBAEF,EAAK3B,MAAM4B,aAAaH,eA3FX,EA8FnBI,kBAAoB,SAACpB,GACnB,EAAKL,WAAWK,IA/FC,EAkGnBJ,oBAAsB,SAACI,IACQ,IAAzB,EAAKE,MAAMC,YAGfH,EAAEkB,iBACF,EAAKF,SAAShB,KAvGG,EA0GnBgB,SAAW,SAAChB,GACQ,KAAdA,EAAEqB,SAAgC,KAAdrB,EAAEqB,SACxBL,eA5Ge,EAgHnBM,gBAAkB,WAAmB,IAAlBjB,EAAiB,uDAAb,EAAGC,EAAU,uDAAN,EACxBiB,EAAa,CACfC,IAAKlB,EACLmB,KAAMpB,GAGR,IAAK,EAAKQ,KAAM,OAAOU,EANW,MAQErC,OAA5BwC,EAR0B,EAQ1BA,WAAYC,EARc,EAQdA,YACdC,EAAO,EAAKf,KAAKgB,wBAkBvB,OAhBIvB,EAAIsB,EAAKE,OAASH,IACpBJ,EAAWC,KAAOI,EAAKE,QAGrBzB,EAAIuB,EAAKG,MAAQL,IACnBH,EAAWE,MAAQG,EAAKG,OAGtBR,EAAWC,IAAM,IACnBD,EAAWC,IAAMI,EAAKE,OAASH,GAAeA,EAAcC,EAAKE,QAAU,EAAI,GAG7EP,EAAWE,KAAO,IACpBF,EAAWE,KAAOG,EAAKG,MAAQL,GAAcA,EAAaE,EAAKG,OAAS,EAAI,GAGvER,GA3IU,EA8InBS,mBAAqB,WAAmB,IAAlB3B,EAAiB,uDAAb,EAAGC,EAAU,uDAAN,EAC3BiB,EAAa,CACfC,IAAKlB,EACLmB,KAAMpB,GAGR,IAAK,EAAKQ,KAAM,OAAOU,EANc,MAQDrC,OAA5BwC,EAR6B,EAQ7BA,WAAYC,EARiB,EAQjBA,YACdC,EAAO,EAAKf,KAAKgB,wBAqBvB,OAlBAN,EAAWE,KAAOpB,EAAIuB,EAAKG,MAEvBzB,EAAIsB,EAAKE,OAASH,IACpBJ,EAAWC,KAAOI,EAAKE,QAGrBP,EAAWE,KAAO,IACpBF,EAAWE,MAAQG,EAAKG,OAGtBR,EAAWC,IAAM,IACnBD,EAAWC,IAAMI,EAAKE,OAASH,GAAeA,EAAcC,EAAKE,QAAU,EAAI,GAG7EP,EAAWE,KAAOG,EAAKG,MAAQL,IACjCH,EAAWE,KAAOG,EAAKG,MAAQL,GAAcA,EAAaE,EAAKG,OAAS,EAAI,GAGvER,GA5KU,EAgLnBU,gBAAkB,SAAC7D,GACjBA,EAAM8D,kBACN,IAAIC,EAAYC,IAAMC,aAAajE,EAAO,aACtCmC,EAAgB,EAAKL,MAAMK,cAC/B,EAAKhB,MAAM0C,gBAAgBE,EAAW5B,EAAenC,IApLpC,EAuLnBkE,cAAgB,SAAClE,GACfA,EAAM8D,mBArLN,EAAKhC,MAAQ,CACXG,EAAG,EACHC,EAAG,EACHH,WAAW,EACXI,cAAe,KACfC,SAAU,IARK,E,qDAYnB,WACExB,KAAKuD,SAAWC,IAAS7D,SAASK,KAAKe,WAAYf,KAAKW,c,gCAG1D,WAAuB,IAAD,OACpB,GAAIX,KAAKkB,MAAMC,UAAW,CACxB,IAAMsC,EAAUvD,OAAOwD,uBAAyBC,WAEhDF,GAAQ,WAAO,IAAD,EACK,EAAKvC,MAAdG,EADI,EACJA,EAAGC,EADC,EACDA,EADC,EAEU,EAAKf,MAAMqD,IAAM,EAAKZ,mBAAmB3B,EAAGC,GAAK,EAAKgB,gBAAgBjB,EAAGC,GAAvFkB,EAFI,EAEJA,IAAKC,EAFD,EAECA,KAEbgB,GAAQ,WACD,EAAK5B,OACV,EAAKA,KAAKgC,MAAMrB,IAAhB,UAAyBA,EAAzB,MACA,EAAKX,KAAKgC,MAAMpB,KAAhB,UAA0BA,EAA1B,MACA,EAAKZ,KAAKgC,MAAMC,QAAU,EAC1B,EAAKjC,KAAKgC,MAAME,cAAgB,kBAG/B,CACL,IAAK/D,KAAK6B,KAAM,OAChB7B,KAAK6B,KAAKgC,MAAMC,QAAU,EAC1B9D,KAAK6B,KAAKgC,MAAME,cAAgB,U,kCAIpC,WACM/D,KAAKuD,UACPC,IAASzD,WAAWC,KAAKuD,UAG3BvD,KAAKa,uB,oBA+IP,WAAU,IAAD,OAEP,OACE,qBAAKmD,KAAK,OAAOC,UAAU,oCAAoCJ,MAF7C,CAAEzC,SAAU,QAAS0C,QAAS,EAAGC,cAAe,OAAQG,QAAS,SAEAC,IAAK,SAAAtC,GAAU,EAAKA,KAAOA,GAA9G,SACG7B,KAAKkB,MAAMM,SAAS4C,KAAI,SAACC,EAAUC,GAClC,MAAiB,YAAbD,EACK,qBAAiBJ,UAAU,oCAAjBK,GAGf,wBAEEL,UAAU,yCACVM,iBAAgBF,EAASG,IACzBC,QAAS,EAAKxB,gBACdK,cAAe,EAAKA,cALtB,SAOGe,EAASK,OANLJ,Y,GAvMKK,IAAMC,WAyNjBtE,O,sHCtNTuE,E,kDAOJ,WAAYtE,GAAQ,IAAD,8BACjB,cAAMA,IA8BRoB,WAAa,aA/BM,EAmCnBC,WAAa,WACP,EAAKV,MAAM4D,iBACb,EAAKrD,SAAS,CAACqD,gBAAgB,IACS,oBAA7B,EAAKvE,MAAMwE,cACpB,EAAKxE,MAAMwE,iBAvCE,EA4CnBC,wBAA0B,SAAChE,GACZ,SAATA,EAAEwD,KAA2B,SAATxD,EAAEwD,KACxB,EAAKS,sBAAsBjE,IA9CZ,EAkDnBiE,sBAAwB,SAACjE,GACvBA,EAAEkB,iBACFlB,EAAEkC,kBAEF,EAAKgC,uBAtDY,EAyDnBA,oBAAsB,WACpB,EAAKzD,SACH,CAACqD,gBAAiB,EAAK5D,MAAM4D,iBAC7B,WACM,EAAK5D,MAAM4D,gBAAoD,oBAA3B,EAAKvE,MAAM4E,WACjD,EAAK5E,MAAM4E,aACD,EAAKjE,MAAM4D,gBAAsD,oBAA7B,EAAKvE,MAAMwE,cACzD,EAAKxE,MAAMwE,mBAhEA,EAsEnBK,kBAAoB,SAACpE,GACN,SAATA,EAAEwD,KAA2B,SAATxD,EAAEwD,KACxB,EAAKvB,gBAAgBjC,IAxEN,EA4EnBiC,gBAAkB,SAAC7D,GACjB,IAAI+D,EAAYC,IAAMC,aAAajE,EAAO,UACtCiG,EAAO,EAAK9E,MAAM8E,KACtB,EAAK9E,MAAM0C,gBAAgBE,EAAW/D,EAAOiG,IA7E7C,EAAKnE,MAAQ,CACXM,SAAU,GACVsD,gBAAgB,GAJD,E,qDAQnB,WACM9E,KAAKO,MAAM+E,2BACbtF,KAAKuF,WAAa/B,IAAS7D,SAASK,KAAK2B,WAAY3B,KAAK4B,aAF1C,IAIZyD,EAASrF,KAAKO,MAAd8E,KACF7D,EAAWxB,KAAKO,MAAMiF,YAAYH,GACtCrF,KAAKyB,SAAS,CAACD,SAAUA,M,uCAG3B,SAA0BiE,GAAW,IAC7BJ,EAASI,EAATJ,KACN,GAAIA,EAAKK,OAAS1F,KAAKO,MAAM8E,KAAKK,KAAM,CACtC,IAAIlE,EAAWxB,KAAKO,MAAMiF,YAAYH,GACtCrF,KAAKyB,SAAS,CAACD,SAAUA,O,kCAI7B,WACMxB,KAAKO,MAAM+E,0BAA4BtF,KAAKuF,YAC9C/B,IAASzD,WAAWC,KAAKuF,c,oBAuD7B,WAAU,IAAD,OACH/D,EAAWxB,KAAKkB,MAAMM,SADnB,EAEwBxB,KAAKO,MAA9BoF,EAFC,EAEDA,YAAaC,EAFZ,EAEYA,QAGnB,OAFAD,EAAc,sBAAwBA,EAEjCnE,EAASqE,OAIVD,GAAuB,WAAZA,EAEX,eAAC,IAAD,CAAgBE,OAAQ9F,KAAKkB,MAAM4D,eAAgBiB,OAAQ/F,KAAKiF,sBAAhE,UACE,cAAC,IAAD,CACEhB,UAAW0B,EACXK,cAAY,WACZC,MAAOC,aAAQ,mBACfC,aAAYD,aAAQ,mBACpBE,gBAAepG,KAAKkB,MAAM4D,eAC1BuB,UAAWrG,KAAKgF,0BAIlB,cAAC,IAAD,UACGxD,EAAS4C,KAAI,SAACC,EAAUC,GACvB,MAAiB,YAAbD,EACK,cAAC,IAAD,CAA0BiC,SAAO,GAAdhC,GAGxB,cAAC,IAAD,CAA0B0B,cAAa3B,EAASG,IAAKC,QAAS,EAAKxB,gBAAiBoD,UAAW,EAAKjB,kBAApG,SAAwHf,EAASK,OAA9GJ,WAU/B,eAAC,IAAD,CAAUwB,OAAQ9F,KAAKkB,MAAM4D,eAAgBiB,OAAQ/F,KAAKiF,sBAA1D,UACE,cAAC,IAAD,CACEsB,IAAKX,GAAW,IAChB5B,KAAK,SACLwC,SAAS,IACTvC,UAAW0B,EACXM,MAAOC,aAAQ,mBACfF,cAAY,WACZI,gBAAepG,KAAKkB,MAAM4D,eAC1BqB,aAAYD,aAAQ,mBACpBG,UAAWrG,KAAKgF,0BAGlB,cAAC,IAAD,UACGxD,EAAS4C,KAAI,SAACC,EAAUC,GACvB,MAAiB,YAAbD,EACK,cAAC,IAAD,CAA0BiC,SAAO,GAAdhC,GAGxB,cAAC,IAAD,CAA0B0B,cAAa3B,EAASG,IAAKC,QAAS,EAAKxB,gBAAiBoD,UAAW,EAAKjB,kBAApG,SAAwHf,EAASK,OAA9GJ,WAnDtB,O,GA/FkBK,IAAMC,WAA/BC,EAEG4B,aAAe,CACpBnB,0BAA0B,EAC1BK,YAAa,uBA0JFd,O,uWCpKT6B,E,WAEJ,cAAyC,IAA3BhB,EAA0B,EAA1BA,KAAMiB,EAAoB,EAApBA,KAAMC,EAAc,EAAdA,WAAc,oBACtC5G,KAAK0F,KAAOA,EACZ1F,KAAK2G,KAAOA,EACZ3G,KAAK4G,WAAaA,GAAc,KAChC5G,KAAK6G,SAAW,G,6CAGlB,SAAUD,GACR5G,KAAK4G,WAAaA,I,yBAGpB,SAAYE,GAAW,IAAD,OACpBA,EAASC,SAAQ,SAACC,GAChBA,EAAKC,UAAU,MAEjBjH,KAAK6G,SAAWC,M,KAIdI,E,kDAEJ,WAAY3G,GAAQ,IAAD,8BACjB,cAAMA,IA4BR4G,eAAiB,WAEf,EAAKC,MAAQ3G,SAAS4G,iBAAT,WADQ,mBACR,OACb,EAAKD,MAAML,SAAQ,SAAAO,GACjBA,EAAKnH,iBAAiB,QAAS,EAAKoH,iBAjCrB,EAqCnBC,iBAAmB,WACjB,EAAKJ,MAAML,SAAQ,SAAAO,GACjBA,EAAKxG,oBAAoB,QAAS,EAAKyG,iBAvCxB,EA2CnBA,YAAc,SAACnI,GACbA,EAAM8C,iBACN,IAAMuF,EAAcrI,EAAM2C,OAAO2F,aAAa,aAC9C,GAAID,IAAgB,EAAKvG,MAAMuG,YAA/B,CAEWA,GACT,EAAKhG,SAAS,CAAEgG,YAAaA,IAE/B,IAAMH,EAAO,EAAKK,QAAQvI,EAAM2C,QAC5BuF,GAAM,EAAK/G,MAAMgH,YAAYD,KApDhB,EAuDnBK,QAAU,SAACX,GACT,IAAMpB,EAAUoB,EAAKpB,QACrB,GAAKA,GAAuB,SAAZA,EAChB,MAAgB,MAAZA,EACKoB,EAAKL,KAEL,EAAKgB,QAAQX,EAAKJ,aA7DV,EAiEnBgB,iBAAmB,SAACvC,GAEhB,IAAIwC,EADN,GAAiB,QAAbxC,EAAKyC,MAAgC,UAAdzC,EAAKyC,KAI9B,GAAiB,SAAbzC,EAAKyC,MAAmBC,KAAc,CAIxC,GAHAF,EAAMxC,EAAK2C,KAAKC,KACL,IAAIC,OAAOC,KAAa,QAAUC,KAAQ,gBAE7CC,KAAKR,GACX,OAGF,IAAIvD,EAAQuD,EAAIS,QAAQ,SACpBC,EAASV,EAAIS,QAAQ,KACnBE,EAAYX,EAAIY,UAAUnE,EAAQ,EAAGiE,GAE3ClD,EAAK2C,KAAKC,IAAME,KAAa,qCAAuCO,KAAO,SAAWF,OAGnF,GAAiB,QAAbnD,EAAKyC,KAAgB,CAC5BD,EAAMxC,EAAK2C,KAAKrB,KAOhB,GAHS,IAAIuB,OAFI,wLAKTG,KAAKR,IAIR,GAAIzE,IAAMuF,uBAAuBd,EAAKO,MAAS,CAClD,IAAIQ,EAAOxF,IAAMyF,gCAAgChB,EAAKO,MAEtD/C,EAAK2C,KAAKrB,KAAOwB,KAAa,cAAgBO,KAAOE,OAGlD,GAAIxF,IAAM0F,kBAAkBjB,EAAKO,MAAS,CAC7C,IAAIQ,EAAOxF,IAAM2F,2BAA2BlB,EAAKO,MAEjD/C,EAAK2C,KAAKrB,KAAOwB,KAAa,cAAgBO,KAAOE,QAZrDvD,EAAK2C,KAAKrB,KAAOwB,KAAa,cAAgBO,KAAO,IAAMb,EAiBjE,OAAOxC,GA/GU,EAkHnB2D,YAAc,WACZ,IAAItE,EAAQuE,YAAY,EAAK1I,MAAM2I,cAClB9F,IAAM+F,oBAAoBzE,EAAO,EAAKkD,kBAC9CxD,KAAI,SAAC4C,GACZ,GAAkB,mBAAdA,EAAKc,MAA2C,iBAAdd,EAAKc,KAAyB,CAClE,IAAIsB,EAAW,EAAKC,iBAAiBrC,EAAKH,SAAU,EAAKuC,UACzD,EAAKE,YAAYF,EAAU,KAC3B,EAAKA,SAAWA,OAzHH,EA8HnBE,YAAc,SAACtC,EAAMuC,GACnB,IAAI7D,EAAOsB,EAAKtB,KACZkD,EAA0B,MAAnBW,EAAyBA,EAAiB7D,EAAO6D,EAAiB,IAAM7D,EACnFsB,EAAK4B,KAAOA,EACR5B,EAAKH,SAAShB,OAAS,GACzBmB,EAAKH,SAASzC,KAAI,SAAAoF,GAChB,EAAKF,YAAYE,EAAOZ,OApIX,EA0InBS,iBAAmB,SAACI,EAAYC,GAC9B,IAAIC,EAAYF,EAAWrF,KAAI,SAACwF,GAE9B,GAAkC,IAA9BA,EAAU/C,SAAShB,QAAgD,mBAA/B+D,EAAU/C,SAAS,GAAGiB,MAA4D,iBAA/B8B,EAAU/C,SAAS,GAAGiB,KAU/G,OAAI8B,EAAU/C,SAAS,IAAsC,cAA/B+C,EAAU/C,SAAS,GAAGiB,KAC3C,EAAK+B,eAAeD,EAAU/C,SAAS,IAGvC,IAAIH,EAAS,CAAEhB,KAAM,GAAIiB,KAAM,KAZxC,IAAMmD,EAAgBF,EAAU/C,SAAS,GACnCkD,EAAW,EAAKF,eAAeC,GAE/BE,EAAWJ,EAAU/C,SAAS,GAEpC,OAAO,EAAKwC,iBAAiBW,EAASnD,SAAUkD,MAYpD,OADAL,EAAeO,YAAYN,GACpBD,GAhKU,EAoKnBG,eAAiB,SAACC,GAChB,IAAIC,EACJ,GAAID,EAAcjD,SAAS,IAAyC,SAAnCiD,EAAcjD,SAAS,GAAGiB,KAAiB,CAE1E,IAAMoC,EAAWJ,EAAcjD,SAAS,GAClCsD,EAAWD,EAASrD,SAAS,GAC/BnB,EAAOyE,EAAWA,EAASC,KAAO,GACtCL,EAAY,IAAIrD,EAAS,CAAEhB,KAAMA,EAAMiB,KAAMuD,EAASlC,KAAKrB,YACtD,GAAImD,EAAcjD,SAAS,GAAI,CAEpC,IAAMsD,EAAWL,EAAcjD,SAAS,GACpCnB,EAAOyE,EAASC,KAAOD,EAASC,KAAO,GAC3CL,EAAW,IAAIrD,EAAS,CAAEhB,KAAMA,EAAMiB,KAAM,UAE5CoD,EAAW,IAAIrD,EAAS,CAAEhB,KAAM,GAAIiB,KAAM,KAE5C,OAAOoD,GAlLP,EAAK3C,MAAQ,GACb,EAAKgC,SAAW,IAAI1C,EAAS,CAAEhB,KAAM,GAAIiB,KAAM,KAC/C,EAAKzF,MAAQ,CACXuG,YAAa,IALE,E,sDASnB,WACEzH,KAAKgJ,gB,+BAGP,WACEhJ,KAAKmH,mB,uCAGP,WACEnH,KAAKwH,qB,gCAGP,WACExH,KAAKmH,mB,kCAGP,WACEnH,KAAKwH,qB,oBA6JP,WACE,OACE,qBAAKvD,UAAU,gBAAf,SACE,cAAC,EAAD,CAAY+C,KAAMhH,KAAKoJ,SAAUjC,eAAgBnH,KAAKmH,eAAgBM,YAAazH,KAAKkB,MAAMuG,oB,GA5LrE9C,IAAMC,WA0MjCyF,E,kDAEJ,WAAY9J,GAAQ,IAAD,8BACjB,cAAMA,IAMR+J,eAAiB,WACf,EAAK7I,SAAS,CAAE8I,UAAW,EAAKrJ,MAAMqJ,WAAY,WAC5C,EAAKrJ,MAAMqJ,UAAU,EAAKhK,MAAM4G,qBATrB,EAanBqD,WAAa,YAA2B,IAAxB7D,EAAuB,EAAvBA,KAAMjB,EAAiB,EAAjBA,KAAMkD,EAAW,EAAXA,KACpB3E,EAAS,2BAAuB2E,IAAS,EAAKrI,MAAMkH,YAAc,6BAA+B,IACvG,OAAId,GAAQjB,EACH,qBAAKzB,UAAWA,EAAhB,SAA2B,mBAAG0C,KAAMA,EAAM8D,YAAW7B,EAAMnE,QAAS,EAAK6F,eAAgBrE,MAAOP,EAArE,SAA4EA,MACrGA,EACF,qBAAKzB,UAAU,mBAAf,SAAkC,sBAAMQ,QAAS,EAAK6F,eAAgBrE,MAAOP,EAA3C,SAAkDA,MAEpF,MAlBT,EAAKxE,MAAQ,CACXqJ,UAAU,GAHK,E,qDAwBnB,WAAqB,IAAD,OACdvK,KAAKO,MAAMyG,OAAShH,KAAKO,MAAMyG,KAAKJ,YACtC5G,KAAKyB,SAAS,CAAE8I,UAAU,IAAQ,WAChC,EAAKhK,MAAM4G,sB,oBAKjB,WAAU,IAAD,OACCH,EAAShH,KAAKO,MAAdyG,KACR,OAAIA,EAAKH,SAAShB,OAAS,EAEvB,eAAC,IAAM6E,SAAP,WACG1D,EAAKJ,YACJ,eAAC,IAAM8D,SAAP,WACE,sBAAMzG,UAAU,aAAaQ,QAASzE,KAAKsK,eAA3C,SACGtK,KAAKkB,MAAMqJ,SAAW,mBAAGtG,UAAU,qBAA0B,mBAAGA,UAAU,wBAE5EjE,KAAKwK,WAAWxD,MAGpBhH,KAAKkB,MAAMqJ,UAAYvD,EAAKH,SAASzC,KAAI,SAACoF,EAAOlF,GAChD,OACE,qBAAKL,UAAU,yBAAf,SACE,cAACoG,EAAD,CAAYrD,KAAMwC,EAAOrC,eAAgB,EAAK5G,MAAM4G,eAAgBM,YAAa,EAAKlH,MAAMkH,eADjDnD,SAQ9CtE,KAAKwK,WAAWxD,O,GAzDJrC,IAAMC,WAgEhBsC,IC1NAyD,E,kDAzDb,WAAYpK,GAAQ,IAAD,8BACjB,cAAMA,IAIRqK,gBAAkB,WAChB,OACE,cAAC,WAAD,UACE,sBAAK3G,UAAU,uBAAf,UACE,qBAAKJ,MAAO,CAACgH,UAAW,SACxB,cAAC,EAAD,CACE3B,aAAc,EAAK3I,MAAM2I,aACzB3B,YAAa,EAAKhH,MAAMgH,oBAZf,EAmBnBuD,eAAiB,WACf,OACE,cAAC,WAAD,UACE,qBAAK7G,UAAU,uBAAf,SACG,EAAK1D,MAAMwK,UACV,cAAC,IAAD,CACEA,SAAU,EAAKxK,MAAMwK,SACrBtD,YAAa,EAAKlH,MAAMkH,YACxBuD,eAAgB,EAAKA,eACrBC,YAAa,EAAK1K,MAAM0K,YACxBC,eAAgB,EAAK3K,MAAM2K,eAC3BC,eAAgB,EAAK5K,MAAM4K,sBA5BrC,EAAKH,gBAAiB,EAFL,E,0CAsCnB,WACE,OACE,sBAAK/G,UAAS,qCAAgCjE,KAAKO,MAAM6K,aAAe,GAAI,aAA5E,UACE,qBAAKnH,UAAU,2BAAf,SACE,cAAC,IAAD,CAAMoH,iBAAkBrL,KAAKO,MAAM+K,gBAErC,sBAAKjM,GAAG,WAAW4E,UAAU,gBAAgBD,KAAK,aAAlD,UACGhE,KAAKO,MAAMgL,mBAAqB,cAAC,IAAD,KAC/BvL,KAAKO,MAAMgL,mBAAqBvL,KAAKO,MAAMiL,WAAaxL,KAAK4K,mBAC7D5K,KAAKO,MAAMgL,oBAAsBvL,KAAKO,MAAMiL,WAAaxL,KAAK8K,iBAC9DW,MAAYC,MAAe,qBAAKzH,UAAU,gBAAf,SAA+B,mBAAG0C,KAAMgF,KAAW,WAAavD,KAAS,IAAMM,KAAO,IAAKzE,UAAU,sCAAtE,SAA6GiC,aAAQ,+B,GAlDnKtB,a,SCmDTgH,E,kDA5Db,WAAYrL,GAAQ,IAAD,8BACjB,cAAMA,IAMRsL,aAAe,WACb,EAAKpK,SAAS,CAACqK,WAAW,KART,EAWnBC,aAAe,WACb,EAAKtK,SAAS,CAACqK,WAAW,KAZT,EAenBxI,cAAgB,SAAClE,GACfA,EAAM8C,iBACN9C,EAAM8D,mBAjBW,EAoBnB8I,cAAgB,SAAChL,GACfA,EAAEkB,iBACF,EAAK3B,MAAMyL,cAAc,EAAKzL,MAAM0L,SApBpC,EAAK/K,MAAQ,CACX4K,WAAW,GAHI,E,0CAyBnB,WAAU,IAAD,EACgB9L,KAAKO,MAAtBqI,EADC,EACDA,KAAMqD,EADL,EACKA,OACRtF,EAAOgF,KAAW,YAAcvI,IAAM8I,SAAStD,EAAMqD,EAAOvG,MAC5DyG,EAAU/I,IAAMgJ,cAAcH,GAGlC,OADkB7I,IAAMiJ,YAEtB,qBAAIpI,UAAWjE,KAAKkB,MAAM4K,UAAY,eAAiB,GAAID,aAAc7L,KAAK6L,aAAcE,aAAc/L,KAAK+L,aAAczI,cAAetD,KAAKsD,cAAjJ,UACE,oBAAIW,UAAU,cAAd,SACE,qBAAKgE,IAAKkE,EAASpJ,MAAM,KAAKuJ,IAAI,OAEpC,oBAAIrI,UAAU,OAAd,SACE,mBAAG0C,KAAMA,EAAMlC,QAASzE,KAAKgM,cAA7B,SAA6CC,EAAOvG,SAEtD,6BAAKuG,EAAOM,OACZ,6BAAKN,EAAOO,oBAGd,+BACE,oBAAIvI,UAAU,cAAd,SACE,qBAAKgE,IAAKkE,EAASpJ,MAAM,KAAKuJ,IAAI,OAEpC,+BACE,mBAAG3F,KAAMA,EAAMlC,QAASzE,KAAKgM,cAA7B,SAA6CC,EAAOvG,OACpD,uBACA,sBAAMzB,UAAU,iBAAhB,SAAkCgI,EAAOM,OACzC,sBAAMtI,UAAU,iBAAhB,SAAkCgI,EAAOO,2B,GArDrB7H,IAAMC,WCoCrB6H,E,4JAjCb,WAAU,IAAD,OACDJ,EAAYjJ,IAAMiJ,YACxB,OACE,wBAAOpI,UAAS,sBAAiBoI,EAAY,GAAI,sBAAjD,UACE,gCACGA,EACC,+BACE,oBAAIxI,MAAO,CAACd,MAAO,QACnB,oBAAIc,MAAO,CAACd,MAAO,OAAnB,SAA4BmD,aAAQ,UACpC,oBAAIrC,MAAO,CAACd,MAAO,OAAnB,SAA4BmD,aAAQ,UACpC,oBAAIrC,MAAO,CAACd,MAAO,OAAnB,SAA4BmD,aAAQ,oBAGtC,+BACE,oBAAInD,MAAM,QACV,oBAAIA,MAAM,aAIhB,gCACoC,IAAjC/C,KAAKO,MAAMmM,WAAW7G,QAAgB7F,KAAKO,MAAMmM,WAAWtI,KAAI,SAAC6H,EAAQ3H,GACxE,OACE,cAAC,EAAD,CAA6BsE,KAAM,EAAKrI,MAAMqI,KAAMqD,OAAQA,EAAQD,cAAe,EAAKzL,MAAMyL,eAAxE1H,e,GAxBNK,IAAMC,W,0BC2IrB+H,E,4MAzHbC,YAAc,WACZ,EAAKrM,MAAMqM,e,EAGbC,YAAc,SAAC7L,GACbA,EAAEkB,iBACF,IAAI2F,EAAM8D,KAAW,OAASvD,KAAS,QAAU,EAAK7H,MAAMqI,KAAO,aACnE1I,OAAO4M,KAAKjF,I,EAGdkF,kBAAoB,SAAC/L,GACnB,IAAI4H,EAAOxF,IAAMC,aAAarC,EAAG,QACjC,EAAKT,MAAMwM,kBAAkBnE,I,EAG/BoE,cAAgB,WACd,IAAIC,EAAQ,EAAK1M,MAAMqI,KAAKsE,MAAM,KAC9BC,EAAW,GA2Bf,OA1BeF,EAAM7I,KAAI,SAACiB,EAAMf,GAC9B,GAAa,KAATe,EAGJ,OAAIf,IAAW2I,EAAMpH,OAAS,EAE1B,eAAC,WAAD,WACE,sBAAM5B,UAAU,aAAhB,eACA,sBAAMA,UAAU,iBAAhB,SAAkCoB,MAFrBf,IAMjB6I,GAAY,IAAM9H,EAEhB,eAAC,WAAD,WACE,sBAAMpB,UAAU,aAAhB,eACA,mBACEA,UAAU,YACVwG,YAAW0C,EACX1I,QAAS,EAAKsI,kBAHhB,SAIG1H,MANUf,Q,4CAgBvB,WAAU,IAAD,EAC+BtE,KAAKO,MAArC6M,EADC,EACDA,gBACFC,GAFG,EACgB3B,WACCxF,aAAQ,iCAC1BoH,EAAc,qBAAKrJ,UAAU,kBAAf,SAAkCiC,aAAQ,4BAExDqH,EAAgBvN,KAAKO,MAAMiN,YAAcxN,KAAKO,MAAMkN,eAAiBzN,KAAKO,MAAMmN,WACtF,OACE,sBAAKzJ,UAAU,sCAAf,UACE,qBAAKA,UAAU,uBAAf,SAAuCjE,KAAKO,MAAMoN,UAClD,sBAAK1J,UAAS,qCAA0D,OAA1BjE,KAAKO,MAAMmL,WAAsB,mBAAqB,IAApG,WACID,MACA,eAAC,WAAD,WACE,qBAAKxH,UAAU,mBAAf,SACE,sBAAMA,UAAU,uDAAuDgC,MAAM,gBAAgBxB,QAASzE,KAAK4M,gBAE7G,qBAAK3I,UAAU,iBAAf,SACG2J,MACC,cAAC,IAAD,CAAQC,UAAU,EAAMzF,OAAQA,KAAQgF,gBAAiBA,EAAiBU,YAAaT,SAK9F5B,MACC,eAAC,WAAD,WACE,sBAAKxH,UAAU,mBAAf,UACE,sBAAMA,UAAU,uDAAuDgC,MAAM,gBAAgBxB,QAASzE,KAAK4M,cACjF,MAAzB5M,KAAKO,MAAMmL,aACVtI,IAAMiJ,YACJ,wBAAQpI,UAAU,mCAAmCgC,MAAOC,aAAQ,QAASzB,QAASzE,KAAK6M,YAA3F,SAAyG3G,aAAQ,UACjH,sBAAMjC,UAAU,uCAAuCgC,MAAOC,aAAQ,QAASzB,QAASzE,KAAK6M,YAAahJ,MAAO,CAAC,SAAY,gBAGpI,sBAAKI,UAAU,iBAAf,UACG2J,MACC,cAAC,IAAD,CAAQC,UAAU,EAAMzF,OAAQA,KAAQgF,gBAAiBA,EAAiBU,YAAaT,IAEzF,cAAC,IAAD,IACA,cAAC,IAAD,aAKR,qBAAKpJ,UAAU,oBAAf,SACE,sBAAKA,UAAS,2BAAsBsJ,EAAgB,WAAa,IAAjE,WACIvN,KAAKO,MAAMiN,WAAaF,EACzBtN,KAAKO,MAAMiN,WAAaxN,KAAKO,MAAMkN,eAAiB,cAAC,IAAD,IACpDF,GACC,cAAC,IAAD,CACEQ,gBAAiB/N,KAAKO,MAAMoN,QAC5BK,cAAehO,KAAKO,MAAMkN,cAC1BQ,aAAgBjO,KAAKO,MAAM0N,aAC3BC,kBAAmBlO,KAAKO,MAAM2N,kBAC9B3G,YAAavH,KAAKO,MAAMgH,YACxB4G,QAAQ,EACRvF,KAAM5I,KAAKO,MAAMqI,QAGlB5I,KAAKO,MAAMkN,gBAAkBzN,KAAKO,MAAMmN,YACzC,cAAC,EAAD,CACE9E,KAAM5I,KAAKO,MAAMqI,KACjB8D,WAAY1M,KAAKO,MAAMmM,WACvBV,cAAehM,KAAKO,MAAMyL,4B,GA/GlBpH,a,qCCPxBwJ,IAAOC,OAAOC,M,IAERC,E,kDACJ,WAAYhO,GAAQ,IAAD,8BACjB,cAAMA,IA2CRiO,cAAgB,SAACC,GACXC,KACF,EAAKC,iBAKPF,EAAwB,SAAVG,KAAmB,IAAMH,EACvC,EAAKI,yBAAyBJ,KApDb,EAuDnBK,aAAe,SAACL,GAEd,GADA,EAAKM,cAAgBtO,SAASuO,eAAe,qBAC/B,UAAVJ,KASJ,GAFA,EAAKK,sBAES,SAAVL,KAKJ,GAAc,SAAVA,MAAoC,aAAhBH,GAKxB,GAAc,SAAVG,KAAkB,CACpB,EAAKnN,SAAS,CAAC+L,WAAW,IAC1B,IAAI0B,EAAUvD,KAAW,aAAejD,KAAOtF,IAAM+L,WAAWV,GAChEvO,OAAOkP,QAAQC,UAAU,CAACxH,IAAKqH,EAAStG,KAAM6F,GAAcA,EAAaS,SAPzE,EAAKI,QAAQ,UALb,EAAKA,QAAQb,QARb,EAAKhN,SAAS,CAACmH,KAAM6F,KA3DN,EAmFnBE,cAAgB,WACdY,IAAWC,YAAY9G,KAAM,KAAK+G,MAAK,SAAAC,GACrC,IAAIC,EAAO,EAAKzO,MAAM6J,SACtB,EAAK6E,2BAA2BF,EAAI1H,KAAK6H,YAAaF,EAAKG,MAC3D,IAAItE,EAAYmE,EAAKI,cAAc,EAAKC,WACxCT,IAAWU,mBAAmBvH,KAAM8C,EAAU5C,MAAM6G,MAAK,SAAAC,GACvD,EAAKjO,SAAS,CACZsJ,SAAU4E,EACVnE,UAAWA,EACXtC,aAAcwG,EAAI1H,KAAK2F,QACvBpC,mBAAmB,UAGtB2E,OAAM,WACP,EAAKzO,SAAS,CAAC0O,cAAc,QAjGd,EAqGnBb,QAAU,SAACc,GACT,EAAKnB,sBACL,EAAKoB,eAAeD,GAGpB,IAAIlB,EAAUvD,KAAW,aAAejD,KAAOtF,IAAM+L,WAAWiB,GAChElQ,OAAOkP,QAAQC,UAAU,CAACxH,IAAKqH,EAAStG,KAAMwH,GAAUA,EAASlB,IA3GhD,EA8GnBoB,SAAW,SAACC,GACV,EAAK9O,SAAS,CACZgM,eAAe,EACfC,YAAY,EACZ9E,KAAM2H,IAGR,EAAKtB,sBACLM,IAAWU,mBAAmBvH,KAAM6H,GAAUd,MAAK,SAAAC,GACjD,IAAI1H,EAAO0H,EAAI1H,KACf,EAAKvG,SAAS,CACZgM,eAAe,EACfE,QAAS3F,EAAK2F,QACdjC,WAAY1D,EAAK0D,WACjBuC,aAAcG,IAAOoC,KAAKxI,EAAKyI,eAAeC,UAC9CxC,kBAAmBlG,EAAK2I,wBAI5B,IAAMC,EAAO1Q,OAAO2Q,SAASD,KACzB1B,EAAUvD,KAAW,aAAejD,KAAOtF,IAAM+L,WAAWoB,GAAYK,EAC3D,aAAbL,EACFrQ,OAAOkP,QAAQ0B,aAAa,CAACjJ,IAAKqH,EAAStG,KAAM2H,GAAWA,EAAUrB,GAEtEhP,OAAOkP,QAAQC,UAAU,CAACxH,IAAKqH,EAAStG,KAAM2H,GAAWA,EAAUrB,IAtIpD,EA0InBmB,eAAiB,SAACD,GAChB,EAAK3O,SAAS,CAACgM,eAAe,IAC9B8B,IAAWC,YAAY9G,KAAM0H,GAASX,MAAK,SAAAC,GACzC,IAAIhD,EAAagD,EAAI1H,KAAK6H,YAAYzL,KAAI,SAAAiB,GAExC,OADa,IAAI0L,IAAO1L,MAGV,MAAZ+K,IACF1D,EAAaA,EAAWsE,QAAO,SAAA3L,GAC7B,GAAkB,QAAdA,EAAKyC,KAAgB,CACvB,IAAIpC,EAAOL,EAAKK,KAAKuL,cACrB,MAAgB,WAATvL,GAA8B,WAATA,GAA8B,cAATA,EAEnD,OAAO,MAGXgH,EAAatJ,IAAM8N,YAAYxE,EAAY,OAAQ,OACnD,EAAKjL,SAAS,CACZmH,KAAMwH,EACN1C,YAAY,EACZhB,WAAYA,EACZe,eAAe,OAEhByC,OAAM,WACP,EAAKzO,SAAS,CAAC0O,cAAc,QAlKd,EAsKnBgB,mBAAqB,SAACvI,GACpB,IAAI+G,EAAO,EAAKzO,MAAM6J,SAASqG,QAC3BpK,EAAO2I,EAAKI,cAAcnH,GACzB5B,EAAKqK,UAWS1B,EAAKI,cAAc/I,EAAKJ,WAAWgC,MACzC0I,YAAa,EACxB,EAAK7P,SAAS,CAACsJ,SAAU4E,EAAM4B,YAAavK,KAZ5CuI,IAAWC,YAAY9G,KAAM1B,EAAK4B,MAAM6G,MAAK,SAAAC,GAC3C,EAAK8B,sBAAsB9B,EAAI1H,KAAK6H,YAAa7I,GAChC2I,EAAKI,cAAc/I,EAAKJ,WAAWgC,MACzC0I,YAAa,EACxB,EAAK7P,SAAS,CACZsJ,SAAU4E,EACV4B,YAAavK,QAhLF,EA0LnB6H,yBAA2B,SAACjG,GAC1B,IAAI+G,EAAO,EAAKzO,MAAM6J,SAASqG,QAC3BhO,IAAMqO,eAAe7I,KACvBA,EAAOxF,IAAMsO,WAAW9I,IAE1B2G,IAAWC,YAAY9G,KAAME,GAAM,GAAM6G,MAAK,SAAAC,GAG5C,IAFA,IAAIhD,EAAagD,EAAI1H,KAAK6H,YACtB8B,EAAU,GACLC,EAAI,EAAGA,EAAIlF,EAAW7G,OAAQ+L,IAAK,CAC1C,IAAIC,EAASnF,EAAWkF,GACpBpN,EAAMqN,EAAOC,WACZH,EAAQnN,KACXmN,EAAQnN,GAAO,IAEjBmN,EAAQnN,GAAKuN,KAAKF,GAEpB,IAAK,IAAIrN,KAAOmN,EAAS,CACvB,IAAI3K,EAAO2I,EAAKI,cAAcvL,GACzBwC,EAAKqK,UAA0B,MAAdrK,EAAK4B,KAEf5B,EAAKqK,UACf,EAAKG,sBAAsBG,EAAQnN,GAAMwC,GAFzC,EAAK4I,2BAA2B+B,EAAQnN,GAAMwC,GAKlD,EAAKvF,SAAS,CACZ8J,mBAAmB,EACnBR,SAAU4E,OAEXO,OAAM,WACP,EAAKzO,SAAS,CAAC0O,cAAc,QAvNd,EA2NnBlB,oBAAsB,WAChB,EAAKF,gBACPtO,SAASuR,KAAKC,YAAY,EAAKlD,eAC/B,EAAKA,cAAgB,OA9NN,EAkOnBmD,kBAAoB,SAAC9S,GACnBA,EAAM8C,iBACN9C,EAAM8D,kBACN,IAAIoE,EAAO,GACX,GAA6B,MAAzBlI,EAAM2C,OAAO6D,QAAiB,CAEhC,IADA,IAAI7D,EAAS3C,EAAM2C,OAAO6E,WACA,MAAnB7E,EAAO6D,SACZ7D,EAASA,EAAO6E,WAElBU,EAAOvF,EAAO4E,UAEdW,EAAOlI,EAAM2C,OAAO4E,KAEtB,EAAKY,YAAYD,IA/OA,EAkPnBC,YAAc,SAACD,GACb,IAAMO,EAAMP,EACZ,GAAIlE,IAAM+O,2BAA2BtK,EAAKa,MAAO,CAC/C,IAAIE,EAAOxF,IAAMgP,oCAAoCvK,EAAKa,MAC1D,EAAK4H,SAAS1H,QACT,GAAIxF,IAAMiP,sBAAsBxK,EAAKa,MAAO,CACjD,IAAIE,EAAOxF,IAAMkP,+BAA+BzK,EAAKa,MACrD,EAAK4G,QAAQ1G,QAEb1I,OAAO2Q,SAASlK,KAAOkB,EAEpB,EAAK3G,MAAMkK,cACd,EAAK3J,SAAS,CAAE2J,cAAc,KA9Pf,EAkQnBmH,WAAa,SAACnT,GACZ,GAAIA,EAAM8B,OAAS9B,EAAM8B,MAAM0H,KAAM,CACnC,IAAIA,EAAOxJ,EAAM8B,MAAM0H,KACnBxF,IAAMqO,eAAe7I,GACvB,EAAK0H,SAAS1H,IAEd,EAAKyH,eAAezH,GACpB,EAAKnH,SAAS,CACZmH,KAAMA,EACN8E,YAAY,OA3QD,EAiRnBN,gBAAkB,SAAC/H,GACjB,IAAIuD,EAAOvD,EAAKmN,OAASnN,EAAKuD,KAAK6J,MAAM,EAAGpN,EAAKuD,KAAK/C,OAAS,GAAKR,EAAKuD,KACzE,GAAI,EAAK1H,MAAMuG,cAAgBmB,EAA/B,CAOA,IAFA,IAAItE,GAAS,EACT2I,EAAQ7J,IAAMsP,SAAS9J,GAClBgJ,EAAI,EAAGA,EAAI3E,EAAMpH,OAAQ+L,IAAK,CACrC,IAAI5K,EAAO,EAAK9F,MAAM6J,SAASgF,cAAc/I,GAC7C,IAAKA,EAAM,CACT1C,EAAQsN,EACR,OAGJ,IAAe,IAAXtN,EAAc,CAChB,IAAIqL,EAAO,EAAKzO,MAAM6J,SAASqG,QAC3BpK,EAAO2I,EAAKI,cAAc1K,EAAKuD,MACnC+J,IAAWC,WAAW5L,GACtB,EAAKvF,SAAS,CAACsJ,SAAU4E,SAEzB,EAAKd,yBAAyBjG,GAIhC,GAAIvD,EAAKmN,OACP,EAAKlD,QAAQ1G,QAEb,GAAIxF,IAAMqO,eAAe7I,GACvB,EAAK0H,SAAS1H,OACT,CACL,IAAIf,EAAM8D,KAAW,KAAOkH,KAAc,aAAezP,IAAM+L,WAAWvG,GAC1D1I,OAAO4M,KAAK,eAClB+D,SAASlK,KAAOkB,KAnTb,EAwTnB+E,YAAc,WACZ,EAAKnL,SAAS,CAAC2J,cAAe,EAAKlK,MAAMkK,gBAzTxB,EA4TnB2B,kBAAoB,SAACI,GACnB,IAAIwC,EAAO,EAAKzO,MAAM6J,SAASqG,QAC3BpK,EAAO2I,EAAKI,cAAc5C,GAC9BwC,EAAKiD,WAAW5L,GAChB,EAAKvF,SAAS,CAACsJ,SAAU4E,EAAM4B,YAAavK,IAC5C,EAAKsI,QAAQtI,EAAK4B,OAjUD,EAoUnBoD,cAAgB,SAACC,GACf,IAAI6G,EAAa1P,IAAM8I,SAAS,EAAKhL,MAAM0H,KAAMqD,EAAOvG,MACxD,GAAIuG,EAAO2C,QACT,EAAKuC,mBAAmB2B,GACxB,EAAKxD,QAAQwD,QAEb,GAAI1P,IAAMqO,eAAeqB,GACvB,EAAKxC,SAASwC,OACT,CACL,IAAMC,EAAE7S,OAAO4M,KAAK,eACdjF,EAAM8D,KAAW,KAAOkH,KAAc,aAAezP,IAAM+L,WAAW2D,GAC5EC,EAAElC,SAASlK,KAAOkB,IA/UL,EAoVnByD,YAAc,WACZ,EAAK7J,SAAS,CAAC2J,cAAe,EAAKlK,MAAMkK,gBArVxB,EAwVnBH,YAAc,SAACjE,GAKb,GAJK,EAAK9F,MAAMsM,WACd,EAAK/L,SAAS,CAAC+L,WAAW,IAGxBxG,EAAK6K,OAAOjD,QAAS,CACvB,IAAK5H,EAAKqK,SAAU,CAClB,IAAI1B,EAAO,EAAKzO,MAAM6J,SAASqG,QAC/BpK,EAAO2I,EAAKI,cAAc/I,EAAK4B,MAC/B2G,IAAWC,YAAY9G,KAAM1B,EAAK4B,MAAM6G,MAAK,SAAAC,GAC3C,EAAK8B,sBAAsB9B,EAAI1H,KAAK6H,YAAa7I,GACjD2I,EAAKqD,aAAahM,GAClB,EAAKvF,SAAS,CAACsJ,SAAU4E,OAG7B,GAAI3I,EAAK4B,OAAS,EAAK1H,MAAM0H,KAC3B,GAAI5B,EAAKsK,WAAY,CACnB,IAAI3B,EAAOgD,IAAWK,aAAa,EAAK9R,MAAM6J,SAAU/D,GACxD,EAAKvF,SAAS,CAACsJ,SAAU4E,QACpB,CACL,IAAIA,EAAO,EAAKzO,MAAM6J,SAASqG,QAC/BpK,EAAO2I,EAAKI,cAAc/I,EAAK4B,MAC/B+G,EAAKiD,WAAW5L,GAChB,EAAKvF,SAAS,CAACsJ,SAAU4E,KAK/B,GAAI3I,EAAK4B,OAAS,EAAK1H,MAAM0H,KAI7B,GAAI5B,EAAK6K,OAAOjD,QACd,EAAKU,QAAQtI,EAAK4B,WAElB,GAAIxF,IAAMqO,eAAezK,EAAK4B,MACxB5B,EAAK4B,OAAS,EAAK1H,MAAM0H,MAC3B,EAAK0H,SAAStJ,EAAK4B,MAErB,EAAK0C,kBACA,CACL,IAAMyH,EAAI7S,OAAO4M,KAAK,eAChBjF,EAAM8D,KAAW,KAAOkH,KAAc,aAAezP,IAAM+L,WAAWnI,EAAK4B,MACjFmK,EAAElC,SAASlK,KAAOkB,IAnYL,EAwYnBqD,eAAiB,SAAClE,GAChB,IAAI2I,EAAOgD,IAAWK,aAAa,EAAK9R,MAAM6J,SAAU/D,GACxD,EAAKvF,SAAS,CAACsJ,SAAU4E,KA1YR,EA6YnBxE,eAAiB,SAACnE,GAChB,IAAI2I,EAAO,EAAKzO,MAAM6J,SAASqG,SAC/BpK,EAAO2I,EAAKI,cAAc/I,EAAK4B,OACrByI,UAMR1B,EAAKiD,WAAW5L,GAChB,EAAKvF,SAAS,CAACsJ,SAAU4E,KANzBJ,IAAWC,YAAY9G,KAAM1B,EAAK4B,MAAM6G,MAAK,SAAAC,GAC3C,EAAK8B,sBAAsB9B,EAAI1H,KAAK6H,YAAa7I,GACjD,EAAKvF,SAAS,CAACsJ,SAAU4E,QAnZZ,EA2ZnBC,2BAA6B,SAACqD,EAAMjM,GAClCA,EAAKqK,UAAW,EAChBrK,EAAKsK,YAAa,EAClB,IAAI5E,EAAauG,EAAK7O,KAAI,SAAAiB,GACxB,OAAO,IAAI0L,IAAO1L,MAEpBqH,EAAaA,EAAWsE,QAAO,SAAA3L,GAC7B,GAAkB,QAAdA,EAAKyC,KAAgB,CACvB,IAAIpC,EAAOL,EAAKK,KAAKuL,cACrB,MAAgB,WAATvL,GAA8B,WAATA,GAA8B,cAATA,EAEnD,OAAO,KAIT,IAAIoB,GAFJ4F,EAAatJ,IAAM8N,YAAYxE,EAAY,OAAQ,QAEzBtI,KAAI,SAAAyN,GAC5B,OAAO,IAAInL,IAAS,CAACmL,cAEvB7K,EAAKiD,YAAYnD,IA7aA,EAgbnB0K,sBAAwB,SAACyB,EAAMjM,GAC7BA,EAAKqK,UAAW,EAChBrK,EAAKsK,YAAa,EAClB,IAAI5E,EAAauG,EAAK7O,KAAI,SAAAiB,GACxB,OAAO,IAAI0L,IAAO1L,MAIhByB,GAFJ4F,EAAatJ,IAAM8N,YAAYxE,EAAY,OAAQ,QAEzBtI,KAAI,SAAAyN,GAC5B,OAAO,IAAInL,IAAS,CAACmL,cAEvB7K,EAAKiD,YAAYnD,IAzbjB,EAAK5F,MAAQ,CACX0H,KAAM,GACN4E,WAAW,EACXpC,cAAc,EACdsC,YAAY,EACZD,eAAe,EACff,WAAY,GACZiB,QAAS,GACTjC,WAAY,GACZuC,aAAc,GACdC,kBAAmB,GACnB3C,mBAAmB,EACnBR,SAAU4H,IAAWO,YACrB3B,YAAa,KACb/F,UAAW,KACXtC,aAAc,IAGhBhJ,OAAOqS,WAAa,EAAKA,WACzB,EAAKvC,UAAY,YACjB,EAAKmD,SAAW,WAChB,EAAKpE,cAAgB,KAvBJ,E,sDA0BnB,WACO3L,IAAMiJ,aACTrM,KAAKyB,SAAS,CAAE2J,cAAc,M,+BAIlC,WAAqB,IAAD,OAClBpL,KAAKwO,cAAcC,MACnBzO,KAAK8O,aAAaL,MAElBzO,KAAKoH,MAAQ3G,SAAS4G,iBAAT,wBACbrH,KAAKoH,MAAML,SAAQ,SAAAO,GAAI,OAAIA,EAAKnH,iBAAiB,QAAS,EAAK+R,wB,kCAGjE,WAAwB,IAAD,OACrBlS,KAAKoH,MAAML,SAAQ,SAAAO,GAAI,OAAIA,EAAKxG,oBAAoB,QAAS,EAAKoR,wB,oBAqZpE,WACE,OACE,sBAAK7S,GAAG,OAAO4E,UAAU,YAAzB,UACE,cAAC,EAAD,CACEsH,kBAAmBvL,KAAKkB,MAAMqK,kBAC9BH,aAAcpL,KAAKkB,MAAMkK,aACzB3D,YAAazH,KAAKkB,MAAM0H,KACxBmC,SAAU/K,KAAKkB,MAAM6J,SACrBS,UAAWxL,KAAKkB,MAAMsK,UACtBtC,aAAclJ,KAAKkB,MAAMgI,aACzBoC,YAAatL,KAAKsL,YAClBL,YAAajL,KAAKiL,YAClBC,eAAgBlL,KAAKkL,eACrBC,eAAgBnL,KAAKmL,eACrB5D,YAAavH,KAAKuH,cAEpB,cAAC,EAAD,CACEqB,KAAM5I,KAAKkB,MAAM0H,KACjB4E,UAAWxN,KAAKkB,MAAMsM,UACtBE,WAAY1N,KAAKkB,MAAMwM,WACvBD,cAAezN,KAAKkB,MAAMuM,cAC1BE,QAAS3N,KAAKkB,MAAMyM,QACpBjC,WAAY1L,KAAKkB,MAAMwK,WACvBuC,aAAcjO,KAAKkB,MAAM+M,aACzBC,kBAAmBlO,KAAKkB,MAAMgN,kBAC9BxB,WAAY1M,KAAKkB,MAAMwL,WACvBnF,YAAavH,KAAKuH,YAClBqF,YAAa5M,KAAK4M,YAClBQ,gBAAiBpN,KAAKoN,gBACtBL,kBAAmB/M,KAAK+M,kBACxBf,cAAehM,KAAKgM,gBAEtB,cAAC,IAAD,CAAYoH,MAAM,uBAAlB,SACE,cAAC,IAAD,CAAOtN,QAAS9F,KAAKkB,MAAMkK,aAAcrF,OAAQ/F,KAAKsL,YAAa+H,iBAAiB,oB,GAhe3EzO,aAuenB0O,IAASC,OACP,cAAC,EAAD,IACA9S,SAASuO,eAAe,a,sHC3epBwE,EAAe,oBAEfC,E,kDAEJ,WAAYlT,GAAQ,IAAD,8BACjB,cAAMA,IA+CRmT,cAAgB,WACd,IAAIC,EAAa,GACXC,EAAWnT,SAAS4G,iBAAiB,0BAA0B,GACrE,GAAIuM,EAAU,CACZ,IAAMvU,EAAKuU,EAASlM,aAAa,MAC7BiG,EAAUtO,GAAMA,EAAGwU,QAAQ,gBAAiB,IAChDlG,EAAUA,EAAO,UAAMA,EAAN,cAAmBjF,MAASA,KAC7CtF,IAAM0Q,eAAenG,GAGvB,IADA,IAAIoG,EAActT,SAAS4G,iBAAiB,kDACnCuK,EAAI,EAAGA,EAAImC,EAAYlO,OAAQ+L,IACtC+B,EAAW5B,KAAKgC,EAAYnC,GAAGoC,WAEjC,EAAKL,WAAaA,GA7DD,EAgEnBpM,YAAc,SAACnI,GACbA,EAAM8C,iBACN9C,EAAM8D,kBACN,IAAIoE,EAAO,GACX,GAA6B,MAAzBlI,EAAM2C,OAAO6D,QAAiB,CAEhC,IADA,IAAI7D,EAAS3C,EAAM2C,OAAO6E,WACA,MAAnB7E,EAAO6D,SACZ7D,EAASA,EAAO6E,WAElBU,EAAOvF,EAAO4E,UAEdW,EAAOlI,EAAM2C,OAAO4E,KAEtB,EAAKpG,MAAMgH,YAAYD,IA7EN,EAgFnB2M,gBAAkB,WAChB,IAEIC,EAFEC,EAAmB,EAAKC,kBAAkBC,QAAQC,UAAY,IAChEC,EAAe,EAAKZ,WAAW9N,OAEnC,GAAIsO,GAAoB,EAAKR,WAAW,GAGtC,OAFAO,EAAmB,OACnB,EAAKzS,SAAS,CAACyS,iBAAkBA,IAGnC,GAAIC,EAAmB,EAAKR,WAAWY,EAAe,GAGpD,OAFAL,EAAmB,EAAKP,WAAW9N,OAAS,OAC5C,EAAKpE,SAAS,CAACyS,iBAAkBA,IAGnC,IAAK,IAAItC,EAAI,EAAGA,EAAI2C,EAAc3C,IAChC,KAAIuC,EAAmB,EAAKR,WAAW/B,IAAvC,CAGEsC,EAAmBtC,EAAI,EACvB,MAGJ,EAAKnQ,SAAS,CAACyS,iBAAkBA,KAtGhB,EAyGnBtM,iBAAmB,SAACvC,GAClB,IAAIwC,EAAKW,EAET,GAAiB,SAAbnD,EAAKyC,MAAmBC,KAAc,CAIxC,GAHAF,EAAMxC,EAAK2C,KAAKC,IACL,IAAIC,OAAOC,KAAa,QAAUC,KAAQ,gBAE9CC,KAAKR,GAAM,CAEhB,IAAIvD,EAAQuD,EAAIS,QAAQ,SACpBC,EAASV,EAAIS,QAAQ,KACzBE,EAAYX,EAAIY,UAAUnE,EAAQ,EAAGiE,OAChC,KAAI,WAAWF,KAAKR,KAAQ,SAASQ,KAAKR,GAK/C,OAJA,IAAMe,EAAO,EAAKrI,MAAMqI,KAClB4L,EAAe5L,EAAK6J,MAAM,EAAG7J,EAAK6L,YAAY,MAAQ,IAAM5M,EAClEW,EAAYpF,IAAMsR,cAAcF,GAIlCnP,EAAK2C,KAAKC,IAAME,KAAa,qCAAuCO,KAAO,SAAWF,OACjF,GAAiB,QAAbnD,EAAKyC,KAEd,GADAD,EAAMxC,EAAK2C,KAAKrB,KACZvD,IAAMuR,mBAAmB9M,EAAKO,MAChC,GAAIhF,IAAMuF,uBAAuBd,EAAKO,MAAS,CAC7C,IAAIQ,EAAOxF,IAAMyF,gCAAgChB,EAAKO,MAEtD/C,EAAK2C,KAAKrB,KAAOwB,KAAa,cAAgBO,KAAOE,OAErDvD,EAAK2C,KAAKrB,KAAOkB,EAAIgM,QAAQ,uCAAuC,SAACe,EAAOC,EAAIC,EAAIC,GAClF,MAAM,GAAN,OAAUF,EAAV,aAAiBhC,KAAjB,qBAAyCkC,EAAzC,iBAGC,GAAI3R,IAAM0F,kBAAkBjB,EAAKO,MAAS,CAC/C,IAAIQ,EAAOxF,IAAM2F,2BAA2BlB,EAAKO,MAEjD/C,EAAK2C,KAAKrB,KAAOwB,KAAa,cAAgBO,KAAOE,EAIzD,OAAOvD,GAhJU,EAmJnB2P,wBAA0B,SAACtQ,GAEzB,OADetB,IAAM+F,oBAAoBzE,EAAO,EAAKkD,mBApJpC,EAwJnBqN,eAAiB,WACf,IAAIC,GAAY,EAIhB,OAH6B,IAAzB,EAAK3U,MAAM2U,YACbA,GAAY,GAEV,EAAK3U,MAAM4N,OAEX,cAAC,IAAD,CACEgH,QAASD,EACTE,aAAcC,KAAW,wBACzBtH,gBAAiB,EAAKxN,MAAMwN,gBAC5BmG,iBAAkB,EAAKhT,MAAMgT,iBAC7Bc,wBAAyB,EAAKA,0BAMlC,cAAC,IAAD,CACEG,QAASD,EACTE,aAAcC,KAAW,wBACzBtH,gBAAiB,EAAKxN,MAAMwN,gBAC5BmG,iBAAkB,EAAKhT,MAAMgT,oBA5KjC,EAAKhT,MAAQ,CACXgT,iBAAkB,GAEpB,EAAKE,kBAAoBzP,IAAM2Q,YAC/B,EAAKlO,MAAQ,GACb,EAAKuM,WAAa,GAPD,E,qDAUnB,WAAqB,IAAD,OAElB3T,KAAKoH,MAAQ3G,SAAS4G,iBAAT,WAA8BmM,EAA9B,OACbxT,KAAKoH,MAAML,SAAQ,SAAAO,GACjBA,EAAKnH,iBAAiB,QAAS,EAAKoH,gBAGtCvH,KAAK0T,kB,uCAGP,SAA0BjO,GAAY,IAAD,OAC/BzF,KAAKO,MAAMwN,kBAAoBtI,EAAUsI,iBAI7C/N,KAAKoH,MAAML,SAAQ,SAAAO,GACjBA,EAAKxG,oBAAoB,QAAS,EAAKyG,kB,gCAI3C,WAAsB,IAAD,OAEnBvH,KAAKoH,MAAQ3G,SAAS4G,iBAAT,WAA8BmM,EAA9B,OACbxT,KAAKoH,MAAML,SAAQ,SAAAO,GACjBA,EAAKnH,iBAAiB,QAAS,EAAKoH,gBAEP,IAA3BvH,KAAK2T,WAAW9N,QAClB7F,KAAK0T,kB,kCAIT,WAAwB,IAAD,OAErB1T,KAAKoH,MAAML,SAAQ,SAAAO,GACjBA,EAAKxG,oBAAoB,QAAS,EAAKyG,kB,oBAuI3C,WACE,GAAIvH,KAAKO,MAAMyN,cACb,OAAO,cAAC,IAAD,IAGT,IAAIqF,EAAgB,UAAMrT,KAAKO,MAAM6H,OAASoL,EAAe,SAAWA,GACxE,OACE,qBAAKrP,IAAKnE,KAAKoU,kBAAmBnQ,UAAU,sBAAsBsR,SAAUvV,KAAKiU,gBAAgBuB,KAAKxV,MAAtG,SACE,sBAAKiE,UAAWoP,EAAhB,UACGrT,KAAKO,MAAMsG,SACX7G,KAAKiV,iBACN,oBAAG5V,GAAG,0BAAN,UAAiC6G,aAAQ,oBAAzC,IAA+DlG,KAAKO,MAAM2N,kBAA1E,KAA8F,+BAAOlO,KAAKO,MAAM0N,2B,GAhMzFtJ,IAAMC,WA4MvC6Q,IAAehP,aALM,CACnB0H,QAAQ,GAMKsF,O,uHCkGAiC,E,kDAzSb,WAAYnV,GAAQ,IAAD,uBACjB,cAAMA,IAwBRsL,aAAe,WACR,EAAKtL,MAAMoV,eACd,EAAKlU,SAAS,CACZmU,qBAAqB,EACrBC,aAAa,KA7BA,EAkCnBC,YAAc,WACP,EAAKvV,MAAMoV,eACd,EAAKlU,SAAS,CACZmU,qBAAqB,EACrBC,aAAa,KAtCA,EA2CnB9J,aAAe,WACR,EAAKxL,MAAMoV,eACd,EAAKlU,SAAS,CACZmU,qBAAqB,EACrBC,aAAa,KA/CA,EAoDnB5K,YAAc,WAAO,IAEX4G,EADS,EAAKtR,MAAdyG,KACA6K,OACR,GAAIA,EAAOjD,QACT,EAAKrO,MAAM0K,YAAY,EAAK1K,MAAMyG,UADpC,CAHkB,MAO+B5D,IAAM2S,kBAAkBlE,EAAOnG,YAAxEsK,EAPU,EAOVA,mBAAoBC,EAPV,EAOUA,iBAC5B,GAAID,EAAoB,CAAC,IAAD,EAC6BC,EAAiBvK,WAAnDwK,EADK,EACdC,QAA6BC,EADf,EACOC,OAC7B,IAAKH,IAAeE,EAAW,OAEjC,EAAK7V,MAAM0K,YAAY,EAAK1K,MAAMyG,QAhEjB,EAmEnBsP,aAAe,SAACtV,GACdA,EAAEkC,kBADkB,IAEd8D,EAAS,EAAKzG,MAAdyG,KACFA,EAAKsK,WACP,EAAK/Q,MAAM2K,eAAelE,GAE1B,EAAKzG,MAAM4K,eAAenE,IAzEX,EA6EnBuP,gBAAkB,SAACvV,GACjB,GAAIoC,IAAMoT,eAAiB,EAAKC,QAC9B,OAAO,EAET,EAAKlW,MAAMgW,gBAAgBvV,EAAG,EAAKT,MAAMyG,OAjFxB,EAoFnB0P,gBAAkB,SAAC1V,GACjB,GAAIoC,IAAMoT,eAAiB,EAAKC,QAC9B,OAAO,EAE2B,QAAhC,EAAKlW,MAAMyG,KAAK6K,OAAO/J,MACzB,EAAKrG,SAAS,CAACkV,gBAAgB,IAEjC,EAAKpW,MAAMmW,gBAAgB1V,EAAG,EAAKT,MAAMyG,OA3FxB,EA8FnB4P,eAAiB,SAAC5V,GAChB,GAAIoC,IAAMoT,eAAiB,EAAKC,QAC9B,OAAO,EAET,EAAKlW,MAAMqW,eAAe5V,IAlGT,EAqGnB6V,gBAAkB,SAAC7V,GACjB,GAAIoC,IAAMoT,eAAiB,EAAKC,QAC9B,OAAO,EAET,EAAKhV,SAAS,CAACkV,gBAAgB,IAC/B,EAAKpW,MAAMsW,gBAAgB7V,EAAG,EAAKT,MAAMyG,OA1GxB,EA6GnB8P,WAAa,SAAC9V,GACZ,GAAIoC,IAAMoT,eAAiB,EAAKC,QAC9B,OAAO,EAETzV,EAAEkC,kBACF,EAAKzB,SAAS,CAACkV,gBAAgB,IAC/B,EAAKpW,MAAMuW,WAAW9V,EAAG,EAAKT,MAAMyG,OAnHnB,EAsHnBjC,aAAe,WACb,EAAKtD,SAAS,CAACmU,qBAAqB,IACpC,EAAKrV,MAAMwE,gBAxHM,EA2HnB9B,gBAAkB,SAACE,EAAW/D,EAAO4H,GACnC,EAAKzG,MAAM0C,gBAAgBE,EAAW6D,IA5HrB,EA+HnB+P,gBAAkB,SAAC3X,GACjBA,EAAM8D,kBACF9D,EAAM4X,QAjIO,EAsInBC,kBAAoB,SAAC7X,GACnB,EAAK8X,mBAAmB9X,IAvIP,EA0InB8X,mBAAqB,SAAC9X,GACpB,EAAKmB,MAAM2W,mBAAmB9X,EAAO,EAAKmB,MAAMyG,MAChD,EAAKvF,SAAS,CAACmU,qBAAqB,KA5InB,EA+InBuB,mBAAqB,WAAO,IACpBnQ,EAAS,EAAKzG,MAAdyG,KACFoQ,EAAO,GACPtP,EAAO,GACX,GAAyB,QAArBd,EAAK6K,OAAO/J,KACdsP,EAAO,mBAAGnT,UAAU,kBACpB6D,EAAO,UACF,CACL,IAAIxD,EAAQ0C,EAAK6K,OAAOnM,KAAK+O,YAAY,KACzC,IAAe,IAAXnQ,EACF8S,EAAO,mBAAGnT,UAAU,gBACpB6D,EAAO,WACF,CACL,IAAIuP,EAASrQ,EAAK6K,OAAOnM,KAAK+M,MAAMnO,GAAO2M,cAC5B,SAAXoG,GAAgC,SAAXA,GAAgC,UAAXA,GAAiC,SAAXA,GAAgC,SAAXA,GACvFD,EAAO,mBAAGnT,UAAU,iBACpB6D,EAAO,SAEW,QAAXuP,GAA+B,cAAXA,GAC3BD,EAAO,mBAAGnT,UAAU,oBACpB6D,EAAO,SAGPsP,EAAO,mBAAGnT,UAAU,gBACpB6D,EAAO,SAIb,MAAO,CAACsP,OAAMtP,SA3KG,EA8KnBwP,kBAAoB,SAACtQ,GAAU,IACvBuQ,EAAsEC,IAAtED,WAAYE,EAA0DD,IAA1DC,SAAUC,EAAgDF,IAAhDE,KAAMC,EAA0CH,IAA1CG,KAAMC,EAAoCJ,IAApCI,OAAQC,EAA4BL,IAA5BK,OAAQC,EAAoBN,IAApBM,gBAEpDtW,EAAW,CAACoW,EAAQC,EAAQH,EAAMC,EAAMG,GACnB,QAArB9Q,EAAK6K,OAAO/J,OACbtG,EAAW,CAAC+V,EAAYE,EAAUC,EAAMC,EAAMC,EAAQC,IAL7B,IAQpBE,EAAa,EAAKxX,MAAlBwX,SARoB,EASqB3U,IAAM2S,kBAAkBgC,GAAjE/B,EAToB,EASpBA,mBAAoBC,EATA,EASAA,iBAC5B,IAAKD,EACH,OAAOxU,EAGTA,EAAW,GAdiB,MAeoCyU,EAAiBvK,WAAjE0K,EAfY,EAepBC,OAA2B2B,EAfP,EAeDC,OAAyBC,EAfxB,EAekBC,KAa9C,MAZyB,QAArBnR,EAAK6K,OAAO/J,MACdsO,GAAa5U,EAASuQ,KAAKwF,EAAYE,GAGzCS,GAAW1W,EAASuQ,KAAK2F,GACzBtB,GAAa5U,EAASuQ,KAAK4F,EAAMC,GACjCI,GAAaxW,EAASuQ,KAAK8F,GAEF,QAArB7Q,EAAK6K,OAAO/J,MACdtG,EAASuQ,KAAK+F,GAGTtW,GA1MU,EA6MnB4W,eAAiB,WAAO,IAAD,EACO,EAAK7X,MAA3ByG,EADe,EACfA,KAAMqR,EADS,EACTA,YACZ,OAAKrR,EAAKsR,cAIR,qBAAKrU,UAAU,WAAWJ,MAAO,CAACwU,YAAaA,GAA/C,SACGrR,EAAKH,SAASzC,KAAI,SAAAiB,GACjB,OACE,cAACqQ,EAAD,CAEE1O,KAAM3B,EACNgT,YAAaA,EACbN,SAAU,EAAKxX,MAAMwX,SACrBtQ,YAAa,EAAKlH,MAAMkH,YACxBuD,eAAgB,EAAKzK,MAAMyK,eAC3B2K,cAAe,EAAKpV,MAAMoV,cAC1B1K,YAAa,EAAK1K,MAAM0K,YACxBC,eAAgB,EAAK3K,MAAM2K,eAC3BC,eAAgB,EAAK5K,MAAM4K,eAC3BhG,WAAY,EAAK5E,MAAM4E,WACvBlC,gBAAiB,EAAK1C,MAAM0C,gBAC5B8B,aAAc,EAAKA,aACnBwR,gBAAiB,EAAKhW,MAAMgW,gBAC5BK,eAAgB,EAAKrW,MAAMqW,eAC3BE,WAAY,EAAKvW,MAAMuW,WACvBJ,gBAAiB,EAAKnW,MAAMmW,gBAC5BG,gBAAiB,EAAKtW,MAAMsW,gBAC5BK,mBAAoB,EAAK3W,MAAM2W,oBAlB1B7R,EAAKuD,WAPX,IA9MT,EAAK1H,MAAQ,CACX2U,aAAa,EACbD,qBAAqB,EACrBe,gBAAgB,GALD,IAOToB,EAAaxX,EAAbwX,SACR,EAAKtB,QAAuB,OAAbsB,EARE,MASgC3U,IAAM2S,kBAAkBgC,GAAjE/B,EATS,EASTA,mBAAoBC,EATX,EASWA,iBAC5B,GAAID,EAAoB,CAAC,IACfK,EAAWJ,EAAiBvK,WAA5B2K,OACR,EAAKI,QAAUJ,EAZA,S,6DAgBnB,SAA0B5Q,GACnBA,EAAUkQ,eACb3V,KAAKyB,SAAS,CACZmU,qBAAqB,EACrBC,aAAa,M,oBA6NnB,WAAU,IAAD,EAC+C7V,KAAKO,MAArDkH,EADC,EACDA,YAAaT,EADZ,EACYA,KAAMgE,EADlB,EACkBA,eAAgB+M,EADlC,EACkCA,SADlC,EAEc/X,KAAKmX,qBAApBrP,EAFC,EAEDA,KAAMsP,EAFL,EAEKA,KACRmB,EAAUvY,KAAKkB,MAAM2U,YAAc,yBAA2B,GAC9D7O,EAAK4B,OAASnB,IAChB8Q,EAAU,yBALL,IAQCvC,EAAuB5S,IAAM2S,kBAAkBgC,GAA/C/B,mBACR,OACE,sBAAK/R,UAAU,YAAf,UACE,sBACE6D,KAAMA,EACN7D,UAAS,sCAAiCsU,EAAjC,YAA0D,MAAdvR,EAAK4B,KAAc,OAAQ,GAAvE,YAA6E5I,KAAKkB,MAAMyV,eAAiB,iBAAmB,IACrI1Q,MAAOe,EAAK6K,OAAOnM,KACnBmG,aAAc7L,KAAK6L,aACnBiK,YAAa9V,KAAK8V,YAClB/J,aAAc/L,KAAK+L,aACnByM,YAAaxY,KAAK+W,gBAClBzT,cAAetD,KAAKiX,kBACpBxS,QAASzE,KAAKiL,YAThB,UAWE,qBAAKhH,UAAU,iBAAiBwU,UAAWzY,KAAKyW,QAASiC,YAAa1Y,KAAKuW,gBAAiBoC,YAAa3Y,KAAK0W,gBAAiBkC,YAAa5Y,KAAK6W,gBAAiBgC,WAAY7Y,KAAK4W,eAAgBkC,OAAQ9Y,KAAK8W,WAAhN,SAA6N9P,EAAK6K,OAAOnM,OACzO,sBAAKzB,UAAU,YAAf,UACY,QAAT6D,KAAoBd,EAAKqK,UAAcrK,EAAKqK,UAAYrK,EAAKsR,gBAC5D,mBACErU,UAAS,gCAA2B+C,EAAKsK,WAAa,gBAAkB,kBACxEkH,YAAa,SAAAxX,GAAC,OAAIA,EAAEkC,mBACpBuB,QAASzE,KAAKsW,eAGlB,mBAAGrS,UAAU,iBAAb,SAA+BmT,OAEhCpM,GACC,qBAAK/G,UAAU,aAAf,UACkB,OAAb8T,GAAqBrM,MAAcsK,IAAuBhW,KAAKkB,MAAM0U,qBACtE,cAAC,IAAD,CACEvQ,KAAMrF,KAAKO,MAAMyG,KACjBrB,YAAa,oBACbH,YAAaxF,KAAKsX,kBAClBrU,gBAAiBjD,KAAKiD,gBACtBkC,WAAYnF,KAAKO,MAAM4E,WACvBJ,aAAc/E,KAAK+E,oBAM5BiC,EAAKsK,YAActR,KAAKoY,wB,GAnSNzT,IAAMC,W,iBCH3BmU,E,kDAEJ,WAAYxY,GAAQ,IAAD,uBACjB,cAAMA,IAcRyY,WAAa,SAACC,EAAMhN,EAAQiN,EAAczR,GACxC,EAAKlH,MAAMyY,WAAWC,EAAMhN,EAAQiN,EAAczR,IAhBjC,EAmBnB8O,gBAAkB,SAACvV,EAAGgG,GACpB,GAAI5D,IAAMoT,aACR,OAAO,EAET,IAAI2C,EAAoB,CAACC,WAAYpS,EAAK6K,OAAQwH,eAAgBrS,EAAKJ,WAAWgC,KAAM0Q,aAActS,EAAK4B,MAC3GuQ,EAAoBI,KAAKC,UAAUL,GAEnCnY,EAAEyY,aAAaC,cAAgB,OAC/B1Y,EAAEyY,aAAaE,QAAQ,6BAA8BR,IA3BpC,EA8BnBzC,gBAAkB,SAAC1V,EAAGgG,GACpB,GAAI5D,IAAMoT,eAAiB,EAAKoD,QAC9B,OAAO,EAET5Y,EAAE6Y,UACyB,oBAAvB7Y,EAAEe,OAAOkC,WACX,EAAKxC,SAAS,CACZqY,uBAAuB,KArCV,EA0CnBlD,eAAiB,SAAC5V,GAChB,GAAIoC,IAAMoT,eAAiB,EAAKoD,QAC9B,OAAO,EAET5Y,EAAEkB,iBACFlB,EAAEyY,aAAaM,WAAa,QA/CX,EAkDnBlD,gBAAkB,SAAC7V,EAAGgG,GACpB,GAAI5D,IAAMoT,eAAiB,EAAKoD,QAC9B,OAAO,EAEkB,kCAAvB5Y,EAAEe,OAAOkC,WACX,EAAKxC,SAAS,CACZqY,uBAAuB,KAxDV,EA6DnBhD,WAAa,SAAC9V,EAAGgG,GACf,GAAI5D,IAAMoT,eAAiB,EAAKoD,QAC9B,OAAO,EAET,IAAI5Y,EAAEyY,aAAaO,MAAMnU,OAAzB,CAGA,IAAIsT,EAAoBnY,EAAEyY,aAAaQ,QAAQ,8BAPvB,EAQxBd,EAAoBI,KAAKW,MAAMf,GAE1BC,EAVmB,EAUnBA,WAAYC,EAVO,EAUPA,eAAgBC,EAVT,EAUSA,aAC7Ba,EAAenT,EAEnB,GAAIoT,MAAMC,QAAQlB,GAChB,OAAKgB,OASL,EAAKG,YAAYnB,EAAmBgB,EAAc,EAAK5Z,MAAMga,gBAAiBJ,EAAavR,OAR7C,MAAxCuQ,EAAkB,GAAGE,gBAIzB,EAAK9Y,MAAMia,YAAY,EAAKja,MAAMga,gBAAiB,UAHjD,EAAK9Y,SAAS,CAACqY,uBAAuB,KAW5C,IAAKK,EACH,MAAuB,MAAnBd,GAIJ,EAAKL,WAAW,EAAKzY,MAAMga,gBAAiBnB,EAAY,IAAKC,QAH3D,EAAK5X,SAAS,CAACqY,uBAAuB,IAQ1C,GAAiC,QAA7BK,EAAatI,OAAO/J,MAIpBuR,IAAmBc,EAAavR,OAKhCyQ,IAAmBc,EAAavT,WAAWgC,MACzCuR,EAAatI,OAAOnM,OAAS0T,EAAW1T,MAD9C,CAOA,GAAiC,QAA7ByU,EAAatI,OAAO/J,MAAsC,QAApBsR,EAAWtR,KACnD,GAAIqS,EAAavT,WAAWgC,OAASyQ,EAEnC,GADYjW,IAAMsP,SAASyH,EAAavR,MAC9B6R,SAASnB,GACjB,OAKN,EAAKN,WAAW,EAAKzY,MAAMga,gBAAiBnB,EAAYe,EAAavR,KAAMyQ,MA3H1D,EA8HnBiB,YAAc,SAACnB,EAAmBgB,EAAcO,EAAUC,GACxD,IAAIC,EAAc,GACd3N,EAAQ7J,IAAMsP,SAASiI,IAC3BxB,EAAkBpS,SAAQ,SAAAkF,GACxB,IAAIrD,EAAOqD,EAAOqN,aAClBsB,EAAY7I,KAAKnJ,MAGc,QAA7BuR,EAAatI,OAAO/J,QAKpB8S,EAAYC,MAAK,SAAA/H,GAAgB,OAAOA,IAAe6H,MAKvDxB,EAAkB,GAAGE,gBAAkBF,EAAkB,GAAGE,iBAAmBc,EAAavR,MAK9EgS,EAAYC,MAAK,SAAA/H,GACjC,OAAO7F,EAAMwN,SAAS3H,OAMxB,EAAKvS,MAAMia,YAAYE,EAAUC,KA5JhB,EA+JnBxV,WAAa,WACX,EAAK1D,SAAS,CAACkU,eAAe,KAhKb,EAmKnB5Q,aAAe,WACb,EAAKtD,SAAS,CAACkU,eAAe,KApKb,EAuKnB1S,gBAAkB,SAACE,EAAW6D,GAC5B,EAAKzG,MAAM0C,gBAAgBE,EAAW6D,GACtChF,eAzKiB,EA4KnBwW,YAAc,SAACpZ,GACbA,EAAM8D,kBACF9D,EAAM4X,QA9KO,EAmLnB1T,cAAgB,SAAClE,GACfA,EAAM8C,iBAEN,IAAIqY,EAAkB,EAAKha,MAAMga,gBACjC,GAAmC,UAA/BA,EAAgB7O,YAAyD,OAA/B6O,EAAgB7O,WAC5D,MAAO,GAET,EAAKwL,mBAAmB9X,IA1LP,EA6LnB8X,mBAAqB,SAAC9X,EAAO4H,GAI3B,GAHA5H,EAAM8C,iBACN9C,EAAM8D,kBAED,EAAK3C,MAAMyK,eAAhB,CAIA,IAAI3J,EAAIjC,EAAM0b,SAAY1b,EAAM2b,SAAW3b,EAAM2b,QAAQ,GAAGC,MACxD1Z,EAAIlC,EAAM6b,SAAY7b,EAAM2b,SAAW3b,EAAM2b,QAAQ,GAAGG,MAExD,EAAK3a,MAAM4a,OACb9Z,GAAK,EAAKd,MAAM4a,MAEd,EAAK5a,MAAM6a,OACb9Z,GAAK,EAAKf,MAAM6a,MAGlBpZ,cAEA,IAAIR,EAAW,EAAKgE,YAAYwB,GAE5BqU,EAAiB,CACnBhc,GAAI,wBACJ+B,SAAU,CAAEC,IAAGC,KACfS,OAAQ3C,EAAM2C,OACdR,cAAeyF,EACfxF,SAAUA,GAGZ8Z,YAASD,KA3NQ,EA8NnB7V,YAAc,SAACwB,GACb,IAAIxF,EAAW,GAET+V,EAAsEC,IAAtED,WAAYE,EAA0DD,IAA1DC,SAAUC,EAAgDF,IAAhDE,KAAMC,EAA0CH,IAA1CG,KAAMC,EAAoCJ,IAApCI,OAAQC,EAA4BL,IAA5BK,OAAQC,EAAoBN,IAApBM,gBAExD,IAAK9Q,EACH,MAAO,CAACuQ,EAAYE,GAIpBjW,EADuB,QAArBwF,EAAK6K,OAAO/J,KACH,CAACyP,EAAYE,EAAUC,EAAMC,EAAMC,EAAQC,GAE3C,CAACD,EAAQC,EAAQH,EAAMC,EAAMG,GAZpB,IAedC,EAAa,EAAKxX,MAAlBwX,SAfc,EAgB2B3U,IAAM2S,kBAAkBgC,GAAjE/B,EAhBc,EAgBdA,mBAAoBC,EAhBN,EAgBMA,iBAC5B,IAAKD,EACH,OAAOxU,EAGTA,EAAW,GArBW,MAuB0CyU,EAAiBvK,WAAjE0K,EAvBM,EAuBdC,OAA2B2B,EAvBb,EAuBKC,OAAyBC,EAvB9B,EAuBwBC,KAC9C,OAAKnR,GAKoB,QAArBA,EAAK6K,OAAO/J,MACdsO,GAAa5U,EAASuQ,KAAKwF,EAAYE,GAGzCS,GAAW1W,EAASuQ,KAAK2F,GACzBtB,GAAa5U,EAASuQ,KAAK4F,EAAMC,GACjCI,GAAaxW,EAASuQ,KAAK8F,GAEF,QAArB7Q,EAAK6K,OAAO/J,MACdtG,EAASuQ,KAAK+F,GAGTtW,IAhBL4U,GAAa5U,EAASuQ,KAAKwF,EAAYE,GAChCjW,IAxPQ,EA0QnBG,WAAa,WACX,EAAKwD,cA3QY,EA8QnBvD,WAAa,WACX,EAAKmD,gBA7QL,EAAK7D,MAAQ,CACXyU,eAAe,EACfmE,uBAAuB,GAJR,IAMT/B,EAAaxX,EAAbwX,SACR,EAAK6B,QAAuB,OAAb7B,EAPE,MAQgC3U,IAAM2S,kBAAkBgC,GAAjE/B,EARS,EAQTA,mBAAoBC,EARX,EAQWA,iBAC5B,GAAID,EAAoB,CAAC,IACfK,EAAWJ,EAAiBvK,WAA5B2K,OACR,EAAKuD,QAAUvD,EAXA,S,0CAkRnB,WACE,OACE,sBACEpS,UAAS,yBAAqBjE,KAAKkB,MAAM4Y,uBAAyB9Z,KAAK4Z,QAAW,iBAAmB,IACrGd,OAAQ9Y,KAAK8W,WACb6B,YAAa3Y,KAAK0W,gBAClBkC,YAAa5Y,KAAK6W,gBAClB2B,YAAaxY,KAAKwY,YAClBlV,cAAetD,KAAKsD,cANtB,UAQE,cAAC,EAAD,CACEyU,SAAU/X,KAAKO,MAAMwX,SACrB/Q,KAAMhH,KAAKO,MAAMwK,SAAS+E,KAC1BrI,YAAazH,KAAKO,MAAMkH,YACxB4Q,YApSW,GAqSXrN,eAAgBhL,KAAKO,MAAMyK,eAC3B2K,cAAe3V,KAAKkB,MAAMyU,cAC1B1K,YAAajL,KAAKO,MAAM0K,YACxBhI,gBAAiBjD,KAAKO,MAAM0C,gBAC5BkI,eAAgBnL,KAAKO,MAAM4K,eAC3BD,eAAgBlL,KAAKO,MAAM2K,eAC3BqL,gBAAiBvW,KAAKuW,gBACtBpR,WAAYnF,KAAKmF,WACjBJ,aAAc/E,KAAK+E,aACnB6R,eAAgB5W,KAAK4W,eACrBE,WAAY9W,KAAK8W,WACjBJ,gBAAiB1W,KAAK0W,gBACtBG,gBAAiB7W,KAAK6W,gBACtBK,mBAAoBlX,KAAKkX,qBAE3B,cAAC,IAAD,CACE7X,GAAI,wBACJ4D,gBAAiBjD,KAAKiD,gBACtBrB,WAAY5B,KAAK4B,WACjBD,WAAY3B,KAAK2B,oB,GAtTJgD,IAAMC,WA+TdmU,O,gCCxVf,qKAIa3Y,EAAY,yBACZC,EAAY,yBAGlB,SAASkb,EAAoBC,EAAWC,GAAwB,IAGjErc,EAH+C2C,EAAiB,uDAAR7B,OAK1B,oBAAvBA,OAAOwb,YAChBtc,EAAQ,IAAIc,OAAOwb,YAAYF,EAAW,CAAEva,OAAQwa,KAEpDrc,EAAQqB,SAASkb,YAAY,gBACvBC,gBAAgBJ,GAAW,GAAO,EAAMC,GAG5C1Z,IACFA,EAAO8Z,cAAczc,GACrB0c,IAAOC,IAAON,IAIX,SAASH,IAA6B,IAApBG,EAAmB,uDAAZ,GAAI1Z,EAAQ,uCAC1CwZ,EAAoBnb,EAAW0b,IAAO,GAAIL,EAAM,CAAE3T,KAAM1H,IAAc2B,GAGjE,SAASC,IAA6B,IAApByZ,EAAmB,uDAAZ,GAAI1Z,EAAQ,uCAC1CwZ,EAAoBlb,EAAWyb,IAAO,GAAIL,EAAM,CAAE3T,KAAMzH,IAAc0B,K,gCC/BjE,SAASL,EAAasa,GAAgB,IAAD,uBAANC,EAAM,iCAANA,EAAM,kBAC1C,MAAwB,oBAATD,GAAwBA,EAAI,WAAJ,EAAQC,GAG1C,SAAS1c,EAAW2c,EAAKC,GAC9B,OAAOC,OAAOC,UAAUC,eAAeC,KAAKL,EAAKC,GAG5C,SAASrc,IACd,OAAO0c,KAAKC,SAASC,SAAS,IAAIjU,UAAU,GAT9C,0KAYO,IAAMsT,EAAQ,GAER9b,EAAY0c,QACL,qBAAXzc,QAA0BA,OAAOO,UAAYP,OAAOO,SAASmc,iB","file":"static/js/wiki.chunk.js","sourcesContent":["import { MENU_SHOW, MENU_HIDE } from './actions';\nimport { uniqueId, hasOwnProp, canUseDOM } from './helpers';\n\nclass GlobalEventListener {\n\n  constructor() {\n    this.callbacks = {};\n\n    if (canUseDOM) {\n      window.addEventListener(MENU_SHOW, this.handleShowEvent);\n      window.addEventListener(MENU_HIDE, this.handleHideEvent);\n    }\n  }\n\n  handleShowEvent = (event) => {\n    for (const id in this.callbacks) {\n      if (hasOwnProp(this.callbacks, id)) this.callbacks[id].show(event);\n    }\n  }\n\n  handleHideEvent = (event) => {\n    for (const id in this.callbacks) {\n      if (hasOwnProp(this.callbacks, id)) this.callbacks[id].hide(event);\n    }\n  }\n\n  register = (showCallback, hideCallback) => {\n    const id = uniqueId();\n\n    this.callbacks[id] = {\n      show: showCallback,\n      hide: hideCallback\n    };\n\n    return id;\n  }\n\n  unregister = (id) => {\n    if (id && this.callbacks[id]) {\n      delete this.callbacks[id];\n    }\n  }\n}\n\nexport default new GlobalEventListener();\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport listener from './globalEventListener';\nimport { hideMenu } from './actions';\nimport { callIfExists } from './helpers';\nimport { Utils } from '../../utils/utils';\n\nconst propTypes = {\n  id: PropTypes.string.isRequired,\n  rtl: PropTypes.bool,\n  onMenuItemClick: PropTypes.func.isRequired,\n  onShowMenu: PropTypes.func,\n  onHideMenu: PropTypes.func,\n};\n\nclass ContextMenu extends React.Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      x: 0,\n      y: 0,\n      isVisible: false,\n      currentObject: null,\n      menuList: [],\n    };\n  }\n\n  componentDidMount() {\n    this.listenId = listener.register(this.handleShow, this.handleHide);\n  }\n\n  componentDidUpdate () {\n    if (this.state.isVisible) {\n      const wrapper = window.requestAnimationFrame || setTimeout;\n\n      wrapper(() => {\n        const { x, y } = this.state;\n        const { top, left } = this.props.rtl ? this.getRTLMenuPosition(x, y) : this.getMenuPosition(x, y);\n\n        wrapper(() => {\n          if (!this.menu) return;\n          this.menu.style.top = `${top}px`;\n          this.menu.style.left = `${left}px`;\n          this.menu.style.opacity = 1;\n          this.menu.style.pointerEvents = 'auto';\n        });\n      });\n    } else {\n      if (!this.menu) return;\n      this.menu.style.opacity = 0;\n      this.menu.style.pointerEvents = 'none';\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.listenId) {\n      listener.unregister(this.listenId);\n    }\n\n    this.unregisterHandlers();\n  }\n\n  registerHandlers = () => {\n    document.addEventListener('mousedown', this.handleOutsideClick);\n    document.addEventListener('touchstart', this.handleOutsideClick);\n    document.addEventListener('scroll', this.handleHide);\n    document.addEventListener('contextmenu', this.handleHide);\n    document.addEventListener('keydown', this.handleKeyNavigation);\n    window.addEventListener('resize', this.handleHide);\n  }\n\n  unregisterHandlers = () => {\n    document.removeEventListener('mousedown', this.handleOutsideClick);\n    document.removeEventListener('touchstart', this.handleOutsideClick);\n    document.removeEventListener('scroll', this.handleHide);\n    document.removeEventListener('contextmenu', this.handleHide);\n    document.removeEventListener('keydown', this.handleKeyNavigation);\n    window.removeEventListener('resize', this.handleHide);\n  }\n\n  handleShow = (e) => {\n    if (e.detail.id !== this.props.id || this.state.isVisible) return;\n\n    const { x, y } = e.detail.position;\n    const { currentObject, menuList} = e.detail;\n\n    this.setState({ isVisible: true, x, y, currentObject, menuList });\n    this.registerHandlers();\n    callIfExists(this.props.onShowMenu, e);\n  }\n\n  handleHide = (e) => {\n    if (this.state.isVisible && (!e.detail || !e.detail.id || e.detail.id === this.props.id)) {\n      this.unregisterHandlers();\n      this.setState({ isVisible: false});\n      callIfExists(this.props.onHideMenu, e);\n    }\n  }\n\n  handleOutsideClick = (e) => {\n    if (!this.menu.contains(e.target)) hideMenu();\n  }\n\n  handleMouseLeave = (event) => {\n    event.preventDefault();\n\n    if (this.props.hideOnLeave) hideMenu();\n  }\n\n  handleContextMenu = (e) => {\n    this.handleHide(e);\n  }\n\n  handleKeyNavigation = (e) => {\n    if (this.state.isVisible === false) {\n      return;\n    }\n    e.preventDefault();\n    this.hideMenu(e);\n  }\n\n  hideMenu = (e) => {\n    if (e.keyCode === 27 || e.keyCode === 13) { // ECS or enter\n      hideMenu();\n    }\n  }\n\n  getMenuPosition = (x = 0, y = 0) => {\n    let menuStyles = {\n      top: y,\n      left: x\n    };\n\n    if (!this.menu) return menuStyles;\n\n    const { innerWidth, innerHeight } = window;\n    const rect = this.menu.getBoundingClientRect();\n\n    if (y + rect.height > innerHeight) {\n      menuStyles.top -= rect.height;\n    }\n\n    if (x + rect.width > innerWidth) {\n      menuStyles.left -= rect.width;\n    }\n\n    if (menuStyles.top < 0) {\n      menuStyles.top = rect.height < innerHeight ? (innerHeight - rect.height) / 2 : 0;\n    }\n\n    if (menuStyles.left < 0) {\n      menuStyles.left = rect.width < innerWidth ? (innerWidth - rect.width) / 2 : 0;\n    }\n\n    return menuStyles;\n  }\n\n  getRTLMenuPosition = (x = 0, y = 0) => {\n    let menuStyles = {\n      top: y,\n      left: x\n    };\n\n    if (!this.menu) return menuStyles;\n\n    const { innerWidth, innerHeight } = window;\n    const rect = this.menu.getBoundingClientRect();\n\n    // Try to position the menu on the left side of the cursor\n    menuStyles.left = x - rect.width;\n\n    if (y + rect.height > innerHeight) {\n      menuStyles.top -= rect.height;\n    }\n\n    if (menuStyles.left < 0) {\n      menuStyles.left += rect.width;\n    }\n\n    if (menuStyles.top < 0) {\n      menuStyles.top = rect.height < innerHeight ? (innerHeight - rect.height) / 2 : 0;\n    }\n\n    if (menuStyles.left + rect.width > innerWidth) {\n      menuStyles.left = rect.width < innerWidth ? (innerWidth - rect.width) / 2 : 0;\n    }\n\n    return menuStyles;\n  }\n\n\n  onMenuItemClick = (event) => {\n    event.stopPropagation();\n    let operation = Utils.getEventData(event, 'operation');\n    let currentObject = this.state.currentObject;\n    this.props.onMenuItemClick(operation, currentObject, event);\n  }\n\n  onContextMenu = (event) => {\n    event.stopPropagation();\n  }\n\n  render() {\n    const inlineStyle = { position: 'fixed', opacity: 0, pointerEvents: 'none', display: 'block' };\n    return (\n      <div role=\"menu\" className=\"seafile-contextmenu dropdown-menu\" style={inlineStyle} ref={menu => { this.menu = menu; }}>\n        {this.state.menuList.map((menuItem, index) => {\n          if (menuItem === 'Divider') {\n            return <div key={index} className=\"seafile-divider dropdown-divider\"></div>;\n          } else {\n            return (\n              <button\n                key={index}\n                className=\"seafile-contextmenu-item dropdown-item\"\n                data-operation={menuItem.key}\n                onClick={this.onMenuItemClick}\n                onContextMenu={this.onContextMenu}\n              >\n                {menuItem.value}\n              </button>\n            );\n          }\n        })}\n      </div>\n    );\n  }\n}\n\nContextMenu.propTypes = propTypes;\n\nexport default ContextMenu;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport listener from '../context-menu/globalEventListener';\nimport { Dropdown, ButtonDropdown, DropdownMenu, DropdownToggle, DropdownItem } from 'reactstrap';\nimport { gettext } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\n\nconst propTypes = {\n  tagName: PropTypes.string,\n  item: PropTypes.object.isRequired,\n  toggleClass: PropTypes.string,\n  isHandleContextMenuEvent: PropTypes.bool,\n  getMenuList: PropTypes.func.isRequired,\n  onMenuItemClick: PropTypes.func.isRequired,\n  freezeItem: PropTypes.func,\n  unfreezeItem: PropTypes.func,\n};\n\nclass ItemDropdownMenu extends React.Component {\n\n  static defaultProps = {\n    isHandleContextMenuEvent: true,\n    toggleClass: 'sf2-icon-caret-down'\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      menuList: [],\n      isItemMenuShow: false,\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.isHandleContextMenuEvent) {\n      this.listenerId = listener.register(this.onShowMenu, this.onHideMenu);\n    }\n    let { item } = this.props;\n    let menuList = this.props.getMenuList(item);\n    this.setState({menuList: menuList});\n  }\n\n  componentWillReceiveProps(nextProps) {  // for toolbar item operation\n    let { item } = nextProps;\n    if (item.name !== this.props.item.name) {\n      let menuList = this.props.getMenuList(item);\n      this.setState({menuList: menuList});\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.props.isHandleContextMenuEvent && this.listenerId) {\n      listener.unregister(this.listenerId);\n    }\n  }\n\n  onShowMenu = () => {\n    // nothing todo\n  }\n\n  onHideMenu = () => {\n    if (this.state.isItemMenuShow) {\n      this.setState({isItemMenuShow: false});\n      if (typeof(this.props.unfreezeItem) === 'function') {\n        this.props.unfreezeItem();\n      }\n    }\n  }\n\n  onDropdownToggleKeyDown = (e) => {\n    if (e.key == 'Enter' || e.key == 'Space') {\n      this.onDropdownToggleClick(e);\n    }\n  }\n\n  onDropdownToggleClick = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.toggleOperationMenu();\n  }\n\n  toggleOperationMenu = () => {\n    this.setState(\n      {isItemMenuShow: !this.state.isItemMenuShow},\n      () => {\n        if (this.state.isItemMenuShow && typeof(this.props.freezeItem) === 'function') {\n          this.props.freezeItem();\n        } else if (!this.state.isItemMenuShow && typeof(this.props.unfreezeItem) === 'function') {\n          this.props.unfreezeItem();\n        }\n      }\n    );\n  }\n\n  onMenuItemKeyDown = (e) => {\n    if (e.key == 'Enter' || e.key == 'Space') {\n      this.onMenuItemClick(e);\n    }\n  }\n\n  onMenuItemClick = (event) => {\n    let operation = Utils.getEventData(event, 'toggle');\n    let item = this.props.item;\n    this.props.onMenuItemClick(operation, event, item);\n  }\n\n  render() {\n    let menuList = this.state.menuList;\n    let { toggleClass, tagName } = this.props;\n    toggleClass = 'sf-dropdown-toggle ' + toggleClass;\n\n    if (!menuList.length) {\n      return '';\n    }\n\n    if (tagName && tagName === 'button') {\n      return (\n        <ButtonDropdown isOpen={this.state.isItemMenuShow} toggle={this.onDropdownToggleClick}>\n          <DropdownToggle\n            className={toggleClass}\n            data-toggle=\"dropdown\"\n            title={gettext('More Operations')}\n            aria-label={gettext('More Operations')}\n            aria-expanded={this.state.isItemMenuShow}\n            onKeyDown={this.onDropdownToggleKeyDown}\n            // onClick={this.onDropdownToggleClick}\n          >\n          </DropdownToggle>\n          <DropdownMenu>\n            {menuList.map((menuItem, index) => {\n              if (menuItem === 'Divider') {\n                return <DropdownItem key={index} divider />;\n              } else {\n                return (\n                  <DropdownItem key={index} data-toggle={menuItem.key} onClick={this.onMenuItemClick} onKeyDown={this.onMenuItemKeyDown}>{menuItem.value}</DropdownItem>\n                );\n              }\n            })}\n          </DropdownMenu>\n        </ButtonDropdown>\n      );\n    }\n\n    return (\n      <Dropdown isOpen={this.state.isItemMenuShow} toggle={this.onDropdownToggleClick}>\n        <DropdownToggle\n          tag={tagName || 'i'}\n          role=\"button\"\n          tabIndex=\"0\"\n          className={toggleClass}\n          title={gettext('More Operations')}\n          data-toggle=\"dropdown\"\n          aria-expanded={this.state.isItemMenuShow}\n          aria-label={gettext('More Operations')}\n          onKeyDown={this.onDropdownToggleKeyDown}\n          // onClick={this.onDropdownToggleClick}\n        />\n        <DropdownMenu>\n          {menuList.map((menuItem, index) => {\n            if (menuItem === 'Divider') {\n              return <DropdownItem key={index} divider />;\n            } else {\n              return (\n                <DropdownItem key={index} data-toggle={menuItem.key} onClick={this.onMenuItemClick} onKeyDown={this.onMenuItemKeyDown}>{menuItem.value}</DropdownItem>\n              );\n            }\n          })}\n        </DropdownMenu>\n      </Dropdown>\n    );\n  }\n}\n\nItemDropdownMenu.propTypes = propTypes;\n\nexport default ItemDropdownMenu;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { repoID, slug, serviceURL, isPublicWiki } from '../utils/constants';\nimport { Utils } from '../utils/utils';\nimport { deserialize } from '@seafile/seafile-editor';\nimport'../css/index-viewer.css';\n\nconst viewerPropTypes = {\n  indexContent: PropTypes.string.isRequired,\n  onLinkClick: PropTypes.func.isRequired,\n};\n\nclass TreeNode {\n\n  constructor({ name, href, parentNode }) {\n    this.name = name;\n    this.href = href;\n    this.parentNode = parentNode || null;\n    this.children = [];\n  }\n\n  setParent(parentNode) {\n    this.parentNode = parentNode;\n  }\n\n  addChildren(nodeList) {\n    nodeList.forEach((node) => {\n      node.setParent(this);\n    });\n    this.children = nodeList;\n  }\n}\n\nclass IndexContentViewer extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.links = [];\n    this.treeRoot = new TreeNode({ name: '', href: '' });\n    this.state = {\n      currentPath: '',\n    };\n  }\n\n  componentWillMount() {\n    this.getRootNode();\n  }\n\n  componentDidMount() {\n    this.bindClickEvent();\n  }\n\n  componentWillReceiveProps() {\n    this.removeClickEvent();\n  }\n\n  componentDidUpdate() {\n    this.bindClickEvent();\n  }\n\n  componentWillUnmount() {\n    this.removeClickEvent();\n  }\n\n  bindClickEvent = () => {\n    const contentClass = 'wiki-nav-content';\n    this.links = document.querySelectorAll(`.${contentClass} a`);\n    this.links.forEach(link => {\n      link.addEventListener('click', this.onLinkClick);\n    });\n  }\n\n  removeClickEvent = () => {\n    this.links.forEach(link => {\n      link.removeEventListener('click', this.onLinkClick);\n    });\n  }\n\n  onLinkClick = (event) => {\n    event.preventDefault();\n    const currentPath = event.target.getAttribute('data-path');\n    if (currentPath === this.state.currentPath) {\n      return;\n    } else if (currentPath) {\n      this.setState({ currentPath: currentPath });\n    }\n    const link = this.getLink(event.target);\n    if (link) this.props.onLinkClick(link);\n  }\n\n  getLink = (node) => {\n    const tagName = node.tagName;\n    if (!tagName || tagName === 'HTML') return;\n    if (tagName === 'A') {\n      return node.href;\n    } else {\n      return this.getLink(node.parentNode);\n    }\n  }\n\n  changeInlineNode = (item) => {\n    if (item.type == 'link' || item.type === 'image') {\n      let url;\n\n      // change image url\n      if (item.type == 'image' && isPublicWiki) {\n        url = item.data.src;\n        const re = new RegExp(serviceURL + '/lib/' + repoID +'/file.*raw=1');\n        // different repo\n        if (!re.test(url)) {\n          return;\n        }\n        // get image path\n        let index = url.indexOf('/file');\n        let index2 = url.indexOf('?');\n        const imagePath = url.substring(index + 5, index2);\n        // replace url\n        item.data.src = serviceURL + '/view-image-via-public-wiki/?slug=' + slug + '&path=' + imagePath;\n      }\n\n      else if (item.type == 'link') {\n        url = item.data.href;\n        /* eslint-disable */\n        let expression = /((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[\\-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9\\.\\-]+|(?:www\\.|[\\-;:&=\\+\\$,\\w]+@)[A-Za-z0-9\\.\\-]+)((?:\\/[\\+~%\\/\\.\\w\\-_]*)?\\??(?:[\\-\\+=&;%@\\.\\w_]*)#?(?:[\\.\\!\\/\\\\\\w]*))?)/\n        /* eslint-enable */\n        let re = new RegExp(expression);\n\n        // Solving relative paths\n        if (!re.test(url)) {\n          item.data.href = serviceURL + '/published/' + slug + '/' + url;\n        }\n        // change file url\n        else if (Utils.isInternalMarkdownLink(url, repoID)) {\n          let path = Utils.getPathFromInternalMarkdownLink(url, repoID);\n          // replace url\n          item.data.href = serviceURL + '/published/' + slug + path;\n        }\n        // change dir url\n        else if (Utils.isInternalDirLink(url, repoID)) {\n          let path = Utils.getPathFromInternalDirLink(url, repoID);\n          // replace url\n          item.data.href = serviceURL + '/published/' + slug + path;\n        }\n      }\n    }\n\n    return item;\n  }\n\n  getRootNode = () => {\n    let value = deserialize(this.props.indexContent);\n    const newNodes = Utils.changeMarkdownNodes(value, this.changeInlineNode);\n    newNodes.map((node) => {\n      if (node.type === 'unordered_list' || node.type === 'ordered_list') {\n        let treeRoot = this.transSlateToTree(node.children, this.treeRoot);\n        this.setNodePath(treeRoot, '/');\n        this.treeRoot = treeRoot;\n      }\n    });\n  }\n\n  setNodePath = (node, parentNodePath) => {\n    let name = node.name;\n    let path = parentNodePath === '/' ? parentNodePath + name : parentNodePath + '/' + name;\n    node.path = path;\n    if (node.children.length > 0) {\n      node.children.map(child => {\n        this.setNodePath(child, path);\n      });\n    }\n  }\n\n  // slateNodes is list items of an unordered list or ordered list, translate them to treeNode and add to parentTreeNode\n  transSlateToTree = (slateNodes, parentTreeNode) => {\n    let treeNodes = slateNodes.map((slateNode) => {\n      // item has children(unordered list)\n      if (slateNode.children.length === 2 && (slateNode.children[1].type === 'unordered_list' || slateNode.children[1].type === 'ordered_list')) {\n        // slateNode.nodes[0] is paragraph, create TreeNode, set name and href\n        const paragraphNode = slateNode.children[0];\n        const treeNode = this.transParagraph(paragraphNode);\n        // slateNode.nodes[1] is list, set it as TreeNode's children\n        const listNode = slateNode.children[1];\n        // Add sub list items to the tree node\n        return this.transSlateToTree(listNode.children, treeNode);\n      } else {\n        // item doesn't have children list\n        if (slateNode.children[0] && (slateNode.children[0].type === 'paragraph')) {\n          return this.transParagraph(slateNode.children[0]);\n        } else {\n          // list item contain table/code_block/blockqupta\n          return new TreeNode({ name: '', href: '' });\n        }\n      }\n    });\n    parentTreeNode.addChildren(treeNodes);\n    return parentTreeNode;\n  }\n\n  // translate slate_paragraph_node to treeNode\n  transParagraph = (paragraphNode) => {\n    let treeNode;\n    if (paragraphNode.children[1] && paragraphNode.children[1].type === 'link') {\n      // paragraph node is a link node\n      const linkNode = paragraphNode.children[1];\n      const textNode = linkNode.children[0];\n      let name = textNode ? textNode.text : '';\n      treeNode =  new TreeNode({ name: name, href: linkNode.data.href });\n    } else if (paragraphNode.children[0]) {\n      // paragraph first child node is a text node, then get node name\n      const textNode = paragraphNode.children[0];\n      let name = textNode.text ? textNode.text : '';\n      treeNode = new TreeNode({ name: name, href: '' });\n    } else {\n      treeNode = new TreeNode({ name: '', href: '' });\n    }\n    return treeNode;\n  }\n\n  render() {\n    return (\n      <div className=\"mx-4 o-hidden\">\n        <FolderItem node={this.treeRoot} bindClickEvent={this.bindClickEvent} currentPath={this.state.currentPath}/>\n      </div>\n    );\n  }\n}\n\nIndexContentViewer.propTypes = viewerPropTypes;\n\nconst FolderItemPropTypes = {\n  node: PropTypes.object.isRequired,\n  bindClickEvent: PropTypes.func.isRequired,\n  currentPath: PropTypes.string,\n};\n\nclass FolderItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      expanded: false\n    };\n  }\n\n  toggleExpanded = () => {\n    this.setState({ expanded: !this.state.expanded }, () => {\n      if (this.state.expanded) this.props.bindClickEvent();\n    });\n  }\n\n  renderLink = ({ href, name, path }) => {\n    const className = `wiki-nav-content ${path === this.props.currentPath ? 'wiki-nav-content-highlight' : ''}`;\n    if (href && name) {\n      return <div className={className}><a href={href} data-path={path} onClick={this.toggleExpanded} title={name}>{name}</a></div>;\n    } else if (name) {\n      return <div className=\"wiki-nav-content\"><span onClick={this.toggleExpanded} title={name}>{name}</span></div>;\n    } else {\n      return null;\n    }\n  }\n\n  componentDidMount() {\n    if (this.props.node && !this.props.node.parentNode) {\n      this.setState({ expanded: true }, () => {\n        this.props.bindClickEvent();\n      });\n    }\n  }\n\n  render() {\n    const { node } = this.props;\n    if (node.children.length > 0) {\n      return (\n        <React.Fragment>\n          {node.parentNode &&\n            <React.Fragment>\n              <span className=\"switch-btn\" onClick={this.toggleExpanded}>\n                {this.state.expanded ? <i className=\"fa fa-caret-down\"></i> : <i className=\"fa fa-caret-right\"></i>}\n              </span>\n              {this.renderLink(node)}\n            </React.Fragment>\n          }\n          {this.state.expanded && node.children.map((child, index) => {\n            return (\n              <div className=\"pl-4 position-relative\" key={index}>\n                <FolderItem node={child} bindClickEvent={this.props.bindClickEvent} currentPath={this.props.currentPath}/>\n              </div>\n            );\n          })}\n        </React.Fragment>\n      );\n    } else {\n      return this.renderLink(node);\n    }\n  }\n}\n\nFolderItem.propTypes = FolderItemPropTypes;\n\nexport default IndexContentViewer;\n","import React, { Component, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, siteRoot, repoID, slug, username, permission } from '../../utils/constants';\nimport Logo from '../../components/logo';\nimport Loading from '../../components/loading';\nimport TreeView from '../../components/tree-view/tree-view';\nimport IndexContentViewer from '../../components/index-viewer';\n\nconst propTypes = {\n  closeSideBar: PropTypes.bool.isRequired,\n  isTreeDataLoading: PropTypes.bool.isRequired,\n  treeData: PropTypes.object.isRequired,\n  indexNode: PropTypes.object,\n  indexContent: PropTypes.string.isRequired,\n  currentPath: PropTypes.string.isRequired,\n  onCloseSide: PropTypes.func.isRequired,\n  onNodeClick: PropTypes.func.isRequired,\n  onNodeCollapse: PropTypes.func.isRequired,\n  onNodeExpanded: PropTypes.func.isRequired,\n  onLinkClick: PropTypes.func.isRequired,\n};\n\nclass SidePanel extends Component {\n\n  constructor(props) {\n    super(props);\n    this.isNodeMenuShow = false;\n  }\n\n  renderIndexView = () => {\n    return (\n      <Fragment>\n        <div className=\"wiki-pages-container\">\n          <div style={{marginTop: '2px'}}></div>\n          <IndexContentViewer\n            indexContent={this.props.indexContent}\n            onLinkClick={this.props.onLinkClick}\n          />\n        </div>\n      </Fragment>\n    );\n  }\n\n  renderTreeView = () => {\n    return (\n      <Fragment>\n        <div className=\"wiki-pages-container\">\n          {this.props.treeData && (\n            <TreeView\n              treeData={this.props.treeData}\n              currentPath={this.props.currentPath}\n              isNodeMenuShow={this.isNodeMenuShow}\n              onNodeClick={this.props.onNodeClick}\n              onNodeCollapse={this.props.onNodeCollapse}\n              onNodeExpanded={this.props.onNodeExpanded}\n            />\n          )}\n        </div>\n      </Fragment>\n    );\n  }\n\n  render() {\n    return (\n      <div className={`side-panel wiki-side-panel ${this.props.closeSideBar ? '': 'left-zero'}`}>\n        <div className=\"side-panel-top panel-top\">\n          <Logo onCloseSidePanel={this.props.onCloseSide} />\n        </div>\n        <div id=\"side-nav\" className=\"wiki-side-nav\" role=\"navigation\">\n          {this.props.isTreeDataLoading && <Loading /> }\n          {!this.props.isTreeDataLoading && this.props.indexNode && this.renderIndexView() }\n          {!this.props.isTreeDataLoading && !this.props.indexNode && this.renderTreeView() }\n          {(username && permission) && <div className=\"text-left p-2\"><a href={siteRoot + 'library/' + repoID + '/' + slug + '/'} className=\"text-dark text-decoration-underline\">{gettext('Go to Library')}</a></div>}\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = propTypes;\n\nexport default SidePanel;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { siteRoot } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\n\nconst propTypes = {\n  path: PropTypes.string.isRequired,\n  dirent: PropTypes.object.isRequired,\n  onDirentClick: PropTypes.func.isRequired,\n};\n\nclass WikiDirListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      highlight: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    this.setState({highlight: true});\n  }\n\n  onMouseLeave = () => {\n    this.setState({highlight: false});\n  }\n\n  onContextMenu = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  onDirentClick = (e) => {\n    e.preventDefault();\n    this.props.onDirentClick(this.props.dirent);\n  }\n\n  render() {\n    let { path, dirent } = this.props;\n    let href = siteRoot + 'published' + Utils.joinPath(path, dirent.name);\n    let iconUrl = Utils.getDirentIcon(dirent);\n\n    const isDesktop = Utils.isDesktop();\n    return isDesktop ? (\n      <tr className={this.state.highlight ? 'tr-highlight' : ''} onMouseEnter={this.onMouseEnter} onMouseLeave={this.onMouseLeave} onContextMenu={this.onContextMenu}>\n        <td className=\"text-center\">\n          <img src={iconUrl} width=\"24\" alt=\"\" />\n        </td>\n        <td className=\"name\">\n          <a href={href} onClick={this.onDirentClick}>{dirent.name}</a>\n        </td>\n        <td>{dirent.size}</td>\n        <td>{dirent.mtime_relative}</td>\n      </tr>\n    ) : (\n      <tr>\n        <td className=\"text-center\">\n          <img src={iconUrl} width=\"24\" alt=\"\" />\n        </td>\n        <td>\n          <a href={href} onClick={this.onDirentClick}>{dirent.name}</a>\n          <br />\n          <span className=\"item-meta-info\">{dirent.size}</span>\n          <span className=\"item-meta-info\">{dirent.mtime_relative}</span>\n        </td>\n      </tr>\n    );\n  }\n}\n\nWikiDirListItem.propTypes = propTypes;\n\nexport default WikiDirListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\nimport WikiDirListItem from './wiki-dir-list-item';\n\nconst propTypes = {\n  path: PropTypes.string.isRequired,\n  direntList: PropTypes.array.isRequired,\n  onDirentClick: PropTypes.func.isRequired,\n};\n\nclass WikiDirListView extends React.Component {\n\n  render() {\n    const isDesktop = Utils.isDesktop();\n    return (\n      <table className={`table-hover ${isDesktop ? '': 'table-thead-hidden'}`}>\n        <thead>\n          {isDesktop ? (\n            <tr>\n              <th style={{width: '4%'}}></th>\n              <th style={{width: '66%'}}>{gettext('Name')}</th>\n              <th style={{width: '15%'}}>{gettext('Size')}</th>\n              <th style={{width: '15%'}}>{gettext('Last Update')}</th>\n            </tr>\n          ) : (\n            <tr>\n              <th width=\"12%\"></th>\n              <th width=\"88%\"></th>\n            </tr>\n          )}\n        </thead>\n        <tbody>\n          {this.props.direntList.length !== 0 && this.props.direntList.map((dirent, index) => {\n            return (\n              <WikiDirListItem key={index} path={this.props.path} dirent={dirent} onDirentClick={this.props.onDirentClick}/>\n            );\n          })}\n        </tbody>\n      </table>\n    );\n  }\n}\n\nWikiDirListView.propTypes = propTypes;\n\nexport default WikiDirListView;\n","import React, { Component, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, repoID, slug, siteRoot, username, isPro } from '../../utils/constants';\nimport WikiMarkdownViewer from '../../components/wiki-markdown-viewer';\nimport WikiDirListView from '../../components/wiki-dir-list-view/wiki-dir-list-view';\nimport Loading from '../../components/loading';\nimport { Utils } from '../../utils/utils';\nimport Search from '../../components/search/search';\nimport Notification from '../../components/common/notification';\nimport Account from '../../components/common/account';\n\nconst propTypes = {\n  path: PropTypes.string.isRequired,\n  pathExist: PropTypes.bool.isRequired,\n  isViewFile: PropTypes.bool.isRequired,\n  isDataLoading: PropTypes.bool.isRequired,\n  content: PropTypes.string,\n  permission: PropTypes.string,\n  lastModified: PropTypes.string,\n  latestContributor: PropTypes.string,\n  direntList: PropTypes.array.isRequired,\n  onMenuClick: PropTypes.func.isRequired,\n  onSearchedClick: PropTypes.func.isRequired,\n  onMainNavBarClick: PropTypes.func.isRequired,\n  onDirentClick: PropTypes.func.isRequired,\n  onLinkClick: PropTypes.func.isRequired,\n};\n\nclass MainPanel extends Component {\n\n  onMenuClick = () => {\n    this.props.onMenuClick();\n  }\n\n  onEditClick = (e) => {\n    e.preventDefault();\n    let url = siteRoot + 'lib/' + repoID + '/file' + this.props.path + '?mode=edit';\n    window.open(url);\n  }\n\n  onMainNavBarClick = (e) => {\n    let path = Utils.getEventData(e, 'path');\n    this.props.onMainNavBarClick(path);\n  }\n\n  renderNavPath = () => {\n    let paths = this.props.path.split('/');\n    let nodePath = '';\n    let pathElem = paths.map((item, index) => {\n      if (item === '') {\n        return;\n      }\n      if (index === (paths.length - 1)) {\n        return (\n          <Fragment key={index}>\n            <span className=\"path-split\">/</span>\n            <span className=\"path-file-name\">{item}</span>\n          </Fragment>\n        );\n      } else {\n        nodePath += '/' + item;\n        return (\n          <Fragment key={index} >\n            <span className=\"path-split\">/</span>\n            <a\n              className=\"path-link\"\n              data-path={nodePath}\n              onClick={this.onMainNavBarClick}>\n              {item}\n            </a>\n          </Fragment>\n        );\n      }\n    });\n    return pathElem;\n  }\n\n\n  render() {\n    let { onSearchedClick, permission } = this.props;\n    let searchPlaceholder = gettext('Search files in this library');\n    const errMessage = (<div className=\"message err-tip\">{gettext('Folder does not exist.')}</div>);\n\n    const isViewingFile = this.props.pathExist && !this.props.isDataLoading && this.props.isViewFile;\n    return (\n      <div className=\"main-panel wiki-main-panel o-hidden\">\n        <div className=\"main-panel-hide hide\">{this.props.content}</div>\n        <div className={`main-panel-north panel-top ${this.props.permission === 'rw' ? 'border-left-show' : ''}`}>\n          {!username &&\n            <Fragment>\n              <div className=\"cur-view-toolbar\">\n                <span className=\"sf2-icon-menu hidden-md-up d-md-none side-nav-toggle\" title=\"Side Nav Menu\" onClick={this.onMenuClick}></span>\n              </div>\n              <div className=\"common-toolbar\">\n                {isPro && (\n                  <Search isPublic={true} repoID={repoID} onSearchedClick={onSearchedClick} placeholder={searchPlaceholder}/>\n                )}\n              </div>\n            </Fragment>\n          }\n          {username && (\n            <Fragment>\n              <div className=\"cur-view-toolbar\">\n                <span className=\"sf2-icon-menu hidden-md-up d-md-none side-nav-toggle\" title=\"Side Nav Menu\" onClick={this.onMenuClick}></span>\n                {this.props.permission == 'rw' && (\n                  Utils.isDesktop() ?\n                    <button className=\"btn btn-secondary operation-item\" title={gettext('Edit')} onClick={this.onEditClick}>{gettext('Edit')}</button> :\n                    <span className=\"fa fa-pencil-alt mobile-toolbar-icon\" title={gettext('Edit')} onClick={this.onEditClick} style={{'fontSize': '1.1rem'}}></span>\n                )}\n              </div>\n              <div className=\"common-toolbar\">\n                {isPro && (\n                  <Search isPublic={true} repoID={repoID} onSearchedClick={onSearchedClick} placeholder={searchPlaceholder}/>\n                )}\n                <Notification />\n                <Account />\n              </div>\n            </Fragment>\n          )}\n        </div>\n        <div className=\"main-panel-center\">\n          <div className={`cur-view-content ${isViewingFile ? 'o-hidden' : ''}`}>\n            {!this.props.pathExist && errMessage}\n            {this.props.pathExist && this.props.isDataLoading && <Loading />}\n            {isViewingFile && (\n              <WikiMarkdownViewer\n                markdownContent={this.props.content}\n                isFileLoading={this.props.isDataLoading}\n                lastModified = {this.props.lastModified}\n                latestContributor={this.props.latestContributor}\n                onLinkClick={this.props.onLinkClick}\n                isWiki={true}\n                path={this.props.path}\n              />\n            )}\n            {(!this.props.isDataLoading && !this.props.isViewFile) && (\n              <WikiDirListView\n                path={this.props.path}\n                direntList={this.props.direntList}\n                onDirentClick={this.props.onDirentClick}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nMainPanel.propTypes = propTypes;\n\nexport default MainPanel;\n","import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport moment from 'moment';\nimport MediaQuery from 'react-responsive';\nimport { Modal } from 'reactstrap';\nimport { slug, siteRoot, initialPath, isDir, sharedToken, hasIndex } from './utils/constants';\nimport { Utils } from './utils/utils';\nimport { seafileAPI } from './utils/seafile-api';\nimport Dirent from './models/dirent';\nimport TreeNode from './components/tree-view/tree-node';\nimport treeHelper from './components/tree-view/tree-helper';\nimport SidePanel from './pages/wiki/side-panel';\nimport MainPanel from './pages/wiki/main-panel';\nimport { lang } from './utils/constants';\n\nimport './css/layout.css';\nimport './css/side-panel.css';\nimport './css/wiki.css';\nimport './css/toolbar.css';\nimport './css/search.css';\n\nmoment.locale(lang);\n\nclass Wiki extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      path: '',\n      pathExist: true,\n      closeSideBar: false,\n      isViewFile: true,\n      isDataLoading: false,\n      direntList: [],\n      content: '',\n      permission: '',\n      lastModified: '',\n      latestContributor: '',\n      isTreeDataLoading: true,\n      treeData: treeHelper.buildTree(),\n      currentNode: null,\n      indexNode: null,\n      indexContent: '',\n    };\n\n    window.onpopstate = this.onpopstate;\n    this.indexPath = '/index.md';\n    this.homePath = '/home.md';\n    this.pythonWrapper = null;\n  }\n\n  componentWillMount() {\n    if (!Utils.isDesktop()) {\n      this.setState({ closeSideBar: true });\n    }\n  }\n\n  componentDidMount() {\n    this.loadSidePanel(initialPath);\n    this.loadWikiData(initialPath);\n\n    this.links = document.querySelectorAll(`#wiki-file-content a`);\n    this.links.forEach(link => link.addEventListener('click', this.onConentLinkClick));\n  }\n\n  componentWillUnmount() {\n    this.links.forEach(link => link.removeEventListener('click', this.onConentLinkClick));\n  }\n\n  loadSidePanel = (initialPath) => {\n    if (hasIndex) {\n      this.loadIndexNode();\n      return;\n    }\n\n    // load dir list\n    initialPath = isDir === 'None' ? '/' : initialPath;\n    this.loadNodeAndParentsByPath(initialPath);\n  }\n\n  loadWikiData = (initialPath) => {\n    this.pythonWrapper = document.getElementById('wiki-file-content');\n    if (isDir === 'False') {\n      // this.showFile(initialPath);\n      this.setState({path: initialPath});\n      return;\n    }\n\n    // if it is a file list, remove the template content provided by python\n    this.removePythonWrapper();\n\n    if (isDir === 'True') {\n      this.showDir(initialPath);\n      return;\n    }\n    \n    if (isDir === 'None' && initialPath === '/home.md') {\n      this.showDir('/');\n      return;\n    }\n\n    if (isDir === 'None') {\n      this.setState({pathExist: false});\n      let fileUrl = siteRoot + 'published/' + slug + Utils.encodePath(initialPath);\n      window.history.pushState({url: fileUrl, path: initialPath}, initialPath, fileUrl);\n    }\n  }\n\n  loadIndexNode = () => {\n    seafileAPI.listWikiDir(slug, '/').then(res => {\n      let tree = this.state.treeData;\n      this.addFirstResponseListToNode(res.data.dirent_list, tree.root);\n      let indexNode = tree.getNodeByPath(this.indexPath);\n      seafileAPI.getWikiFileContent(slug, indexNode.path).then(res => {\n        this.setState({\n          treeData: tree,\n          indexNode: indexNode,\n          indexContent: res.data.content,\n          isTreeDataLoading: false,\n        });\n      });\n    }).catch(() => {\n      this.setState({isLoadFailed: true});\n    });\n  }\n\n  showDir = (dirPath) => {\n    this.removePythonWrapper();\n    this.loadDirentList(dirPath);\n\n    // update location url\n    let fileUrl = siteRoot + 'published/' + slug + Utils.encodePath(dirPath);\n    window.history.pushState({url: fileUrl, path: dirPath}, dirPath, fileUrl);\n  }\n\n  showFile = (filePath) => {\n    this.setState({\n      isDataLoading: true,\n      isViewFile: true,\n      path: filePath,\n    });\n    \n    this.removePythonWrapper();\n    seafileAPI.getWikiFileContent(slug, filePath).then(res => {\n      let data = res.data;\n      this.setState({\n        isDataLoading: false,\n        content: data.content,\n        permission: data.permission,\n        lastModified: moment.unix(data.last_modified).fromNow(),\n        latestContributor: data.latest_contributor,\n      });\n    });\n\n    const hash = window.location.hash;\n    let fileUrl = siteRoot + 'published/' + slug + Utils.encodePath(filePath) + hash;\n    if (filePath === '/home.md') {\n      window.history.replaceState({url: fileUrl, path: filePath}, filePath, fileUrl);\n    } else {\n      window.history.pushState({url: fileUrl, path: filePath}, filePath, fileUrl);\n    }\n  }\n\n  loadDirentList = (dirPath) => {\n    this.setState({isDataLoading: true});\n    seafileAPI.listWikiDir(slug, dirPath).then(res => {\n      let direntList = res.data.dirent_list.map(item => {\n        let dirent = new Dirent(item);\n        return dirent;\n      });\n      if (dirPath === '/') {\n        direntList = direntList.filter(item => {\n          if (item.type === 'dir') {\n            let name = item.name.toLowerCase();\n            return name !== 'drafts' && name !== 'images' && name !== 'downloads';\n          }\n          return true;\n        });\n      }\n      direntList = Utils.sortDirents(direntList, 'name', 'asc');\n      this.setState({\n        path: dirPath,\n        isViewFile: false,\n        direntList: direntList,\n        isDataLoading: false,\n      });\n    }).catch(() => {\n      this.setState({isLoadFailed: true});\n    });\n  }\n\n  loadTreeNodeByPath = (path) => {\n    let tree = this.state.treeData.clone();\n    let node = tree.getNodeByPath(path);\n    if (!node.isLoaded) {\n      seafileAPI.listWikiDir(slug, node.path).then(res => {\n        this.addResponseListToNode(res.data.dirent_list, node);\n        let parentNode = tree.getNodeByPath(node.parentNode.path);\n        parentNode.isExpanded = true;\n        this.setState({\n          treeData: tree,\n          currentNode: node\n        });\n      });\n    } else {\n      let parentNode = tree.getNodeByPath(node.parentNode.path);\n      parentNode.isExpanded = true;\n      this.setState({treeData: tree, currentNode: node}); //tree\n    }\n  }\n\n  loadNodeAndParentsByPath = (path) => {\n    let tree = this.state.treeData.clone();\n    if (Utils.isMarkdownFile(path)) {\n      path = Utils.getDirName(path);\n    }\n    seafileAPI.listWikiDir(slug, path, true).then(res => {\n      let direntList = res.data.dirent_list;\n      let results = {};\n      for (let i = 0; i < direntList.length; i++) {\n        let object = direntList[i];\n        let key = object.parent_dir;\n        if (!results[key]) {\n          results[key] = [];\n        }\n        results[key].push(object);\n      }\n      for (let key in results) {\n        let node = tree.getNodeByPath(key);\n        if (!node.isLoaded && node.path === '/') {\n          this.addFirstResponseListToNode(results[key], node);\n        } else if (!node.isLoaded) {\n          this.addResponseListToNode(results[key], node);\n        }\n      }\n      this.setState({\n        isTreeDataLoading: false,\n        treeData: tree\n      });\n    }).catch(() => {\n      this.setState({isLoadFailed: true});\n    });\n  }\n\n  removePythonWrapper = () => {\n    if (this.pythonWrapper)  {\n      document.body.removeChild(this.pythonWrapper);\n      this.pythonWrapper = null;\n    }\n  }\n\n  onConentLinkClick = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    let link = '';\n    if (event.target.tagName !== 'A') {\n      let target = event.target.parentNode;\n      while (target.tagName !== 'A') {\n        target = target.parentNode;\n      }\n      link = target.href;\n    } else {\n      link = event.target.href;\n    }\n    this.onLinkClick(link);\n  }\n\n  onLinkClick = (link) => {\n    const url = link;\n    if (Utils.isWikiInternalMarkdownLink(url, slug)) {\n      let path = Utils.getPathFromWikiInternalMarkdownLink(url, slug);\n      this.showFile(path);\n    } else if (Utils.isWikiInternalDirLink(url, slug)) {\n      let path = Utils.getPathFromWikiInternalDirLink(url, slug);\n      this.showDir(path);\n    } else {\n      window.location.href = url;\n    }\n    if (!this.state.closeSideBar) {\n      this.setState({ closeSideBar: true });\n    }\n  }\n\n  onpopstate = (event) => {\n    if (event.state && event.state.path) {\n      let path = event.state.path;\n      if (Utils.isMarkdownFile(path)) {\n        this.showFile(path);\n      } else {\n        this.loadDirentList(path);\n        this.setState({\n          path: path,\n          isViewFile: false\n        });\n      }\n    }\n  }\n\n  onSearchedClick = (item) => {\n    let path = item.is_dir ? item.path.slice(0, item.path.length - 1) : item.path;\n    if (this.state.currentPath === path) {\n      return;\n    }\n\n    // load sidePanel\n    let index = -1;\n    let paths = Utils.getPaths(path);\n    for (let i = 0; i < paths.length; i++) {\n      let node = this.state.treeData.getNodeByPath(node);\n      if (!node) {\n        index = i;\n        break;\n      }\n    }\n    if (index === -1) { // all the data has been loaded already.\n      let tree = this.state.treeData.clone();\n      let node = tree.getNodeByPath(item.path);\n      treeHelper.expandNode(node);\n      this.setState({treeData: tree});\n    } else {\n      this.loadNodeAndParentsByPath(path);\n    }\n\n    // load mainPanel\n    if (item.is_dir) {\n      this.showDir(path);\n    } else {\n      if (Utils.isMarkdownFile(path)) {\n        this.showFile(path);\n      } else {\n        let url = siteRoot + 'd/' + sharedToken + '/files/?p=' + Utils.encodePath(path);\n        let newWindow = window.open('about:blank');\n        newWindow.location.href = url;\n      }\n    }\n  }\n\n  onMenuClick = () => {\n    this.setState({closeSideBar: !this.state.closeSideBar});\n  }\n\n  onMainNavBarClick = (nodePath) => {\n    let tree = this.state.treeData.clone();\n    let node = tree.getNodeByPath(nodePath);\n    tree.expandNode(node);\n    this.setState({treeData: tree, currentNode: node});\n    this.showDir(node.path);\n  }\n\n  onDirentClick = (dirent) => {\n    let direntPath = Utils.joinPath(this.state.path, dirent.name);\n    if (dirent.isDir()) {  // is dir\n      this.loadTreeNodeByPath(direntPath);\n      this.showDir(direntPath);\n    } else {  // is file\n      if (Utils.isMarkdownFile(direntPath)) {\n        this.showFile(direntPath);\n      } else {\n        const w=window.open('about:blank');\n        const url = siteRoot + 'd/' + sharedToken + '/files/?p=' + Utils.encodePath(direntPath);\n        w.location.href = url;\n      }\n    }\n  }\n\n  onCloseSide = () => {\n    this.setState({closeSideBar: !this.state.closeSideBar});\n  }\n\n  onNodeClick = (node) => {\n    if (!this.state.pathExist) {\n      this.setState({pathExist: true});\n    }\n\n    if (node.object.isDir()) {\n      if (!node.isLoaded) {\n        let tree = this.state.treeData.clone();\n        node = tree.getNodeByPath(node.path);\n        seafileAPI.listWikiDir(slug, node.path).then(res => {\n          this.addResponseListToNode(res.data.dirent_list, node);\n          tree.collapseNode(node);\n          this.setState({treeData: tree});\n        });\n      }\n      if (node.path === this.state.path) {\n        if (node.isExpanded) {\n          let tree = treeHelper.collapseNode(this.state.treeData, node);\n          this.setState({treeData: tree});\n        } else {\n          let tree = this.state.treeData.clone();\n          node = tree.getNodeByPath(node.path);\n          tree.expandNode(node);\n          this.setState({treeData: tree});\n        }\n      }\n    }\n\n    if (node.path === this.state.path ) {\n      return;\n    }\n\n    if (node.object.isDir()) {  // isDir\n      this.showDir(node.path);\n    } else {\n      if (Utils.isMarkdownFile(node.path)) {\n        if (node.path !== this.state.path) {\n          this.showFile(node.path);\n        }\n        this.onCloseSide();\n      } else {\n        const w = window.open('about:blank');\n        const url = siteRoot + 'd/' + sharedToken + '/files/?p=' + Utils.encodePath(node.path);\n        w.location.href = url;\n      }\n    }\n  }\n\n  onNodeCollapse = (node) => {\n    let tree = treeHelper.collapseNode(this.state.treeData, node);\n    this.setState({treeData: tree});\n  }\n\n  onNodeExpanded = (node) => {\n    let tree = this.state.treeData.clone();\n    node = tree.getNodeByPath(node.path);\n    if (!node.isLoaded) {\n      seafileAPI.listWikiDir(slug, node.path).then(res => {\n        this.addResponseListToNode(res.data.dirent_list, node);\n        this.setState({treeData: tree});\n      });\n    } else {\n      tree.expandNode(node);\n      this.setState({treeData: tree});\n    }\n  }\n\n  addFirstResponseListToNode = (list, node) => {\n    node.isLoaded = true;\n    node.isExpanded = true;\n    let direntList = list.map(item => {\n      return new Dirent(item);\n    });\n    direntList = direntList.filter(item => {\n      if (item.type === 'dir') {\n        let name = item.name.toLowerCase();\n        return name !== 'drafts' && name !== 'images' && name !== 'downloads';\n      }\n      return true;\n    });\n    direntList = Utils.sortDirents(direntList, 'name', 'asc');\n\n    let nodeList = direntList.map(object => {\n      return new TreeNode({object});\n    });\n    node.addChildren(nodeList);\n  }\n\n  addResponseListToNode = (list, node) => {\n    node.isLoaded = true;\n    node.isExpanded = true;\n    let direntList = list.map(item => {\n      return new Dirent(item);\n    });\n    direntList = Utils.sortDirents(direntList, 'name', 'asc');\n\n    let nodeList = direntList.map(object => {\n      return new TreeNode({object});\n    });\n    node.addChildren(nodeList);\n  }\n\n  render() {\n    return (\n      <div id=\"main\" className=\"wiki-main\">\n        <SidePanel\n          isTreeDataLoading={this.state.isTreeDataLoading}\n          closeSideBar={this.state.closeSideBar}\n          currentPath={this.state.path}\n          treeData={this.state.treeData}\n          indexNode={this.state.indexNode}\n          indexContent={this.state.indexContent}\n          onCloseSide={this.onCloseSide}\n          onNodeClick={this.onNodeClick}\n          onNodeCollapse={this.onNodeCollapse}\n          onNodeExpanded={this.onNodeExpanded}\n          onLinkClick={this.onLinkClick}\n        />\n        <MainPanel\n          path={this.state.path}\n          pathExist={this.state.pathExist}\n          isViewFile={this.state.isViewFile}\n          isDataLoading={this.state.isDataLoading}\n          content={this.state.content}\n          permission={this.state.permission}\n          lastModified={this.state.lastModified}\n          latestContributor={this.state.latestContributor}\n          direntList={this.state.direntList}\n          onLinkClick={this.onLinkClick}\n          onMenuClick={this.onMenuClick}\n          onSearchedClick={this.onSearchedClick}\n          onMainNavBarClick={this.onMainNavBarClick}\n          onDirentClick={this.onDirentClick}\n        />\n        <MediaQuery query=\"(max-width: 767.8px)\">\n          <Modal isOpen={!this.state.closeSideBar} toggle={this.onCloseSide} contentClassName=\"d-none\"></Modal>\n        </MediaQuery>\n      </div>\n    );\n  }\n}\n\nReactDOM.render (\n  <Wiki />,\n  document.getElementById('wrapper')\n);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { MarkdownViewer } from '@seafile/seafile-editor';\nimport { gettext, repoID, slug, serviceURL, isPublicWiki, sharedToken, mediaUrl } from '../utils/constants';\nimport Loading from './loading';\nimport { Utils } from '../utils/utils';\n\nconst propTypes = {\n  children: PropTypes.object,\n  isFileLoading: PropTypes.bool.isRequired,\n  markdownContent: PropTypes.string.isRequired,\n  latestContributor: PropTypes.string.isRequired,\n  lastModified: PropTypes.string.isRequired,\n  onLinkClick: PropTypes.func.isRequired,\n  isWiki: PropTypes.bool,\n  isTOCShow: PropTypes.bool,\n  // for dir-column-file component(import repoID is undefined)\n  repoID: PropTypes.string,\n  path: PropTypes.string,\n};\n\nconst contentClass = 'wiki-page-content';\n\nclass WikiMarkdownViewer extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      activeTitleIndex: 0,\n    };\n    this.markdownContainer = React.createRef();\n    this.links = [];\n    this.titlesInfo = [];\n  }\n\n  componentDidMount() {\n    // Bind event when first loaded\n    this.links = document.querySelectorAll(`.${contentClass} a`);\n    this.links.forEach(link => {\n      link.addEventListener('click', this.onLinkClick);\n    });\n\n    this.getTitlesInfo();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.markdownContent === nextProps.markdownContent) {\n      return;\n    }\n    // Unbound event when updating\n    this.links.forEach(link => {\n      link.removeEventListener('click', this.onLinkClick);\n    });\n  }\n\n  componentDidUpdate() {\n    // Update completed, rebind event\n    this.links = document.querySelectorAll(`.${contentClass} a`);\n    this.links.forEach(link => {\n      link.addEventListener('click', this.onLinkClick);\n    });\n    if (this.titlesInfo.length === 0) {\n      this.getTitlesInfo();\n    }\n  }\n\n  componentWillUnmount() {\n    // Unbound events when the component is destroyed\n    this.links.forEach(link => {\n      link.removeEventListener('click', this.onLinkClick);\n    });\n  }\n\n  getTitlesInfo = () => {\n    let titlesInfo = [];\n    const titleDom = document.querySelectorAll('h1[id^=\"user-content\"]')[0];\n    if (titleDom) {\n      const id = titleDom.getAttribute('id');\n      let content = id && id.replace('user-content-', '');\n      content = content ? `${content} - ${slug}` : slug;\n      Utils.updateTabTitle(content);\n    }\n    let headingList = document.querySelectorAll('h2[id^=\"user-content\"], h3[id^=\"user-content\"]');\n    for (let i = 0; i < headingList.length; i++) {\n      titlesInfo.push(headingList[i].offsetTop);\n    }\n    this.titlesInfo = titlesInfo;\n  }\n\n  onLinkClick = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    let link = '';\n    if (event.target.tagName !== 'A') {\n      let target = event.target.parentNode;\n      while (target.tagName !== 'A') {\n        target = target.parentNode;\n      }\n      link = target.href;\n    } else {\n      link = event.target.href;\n    }\n    this.props.onLinkClick(link);\n  }\n\n  onScrollHandler = () => {\n    const contentScrollTop = this.markdownContainer.current.scrollTop + 180;\n    let titlesLength = this.titlesInfo.length;\n    let activeTitleIndex;\n    if (contentScrollTop <= this.titlesInfo[0]) {\n      activeTitleIndex = 0;\n      this.setState({activeTitleIndex: activeTitleIndex});\n      return;\n    }\n    if (contentScrollTop > this.titlesInfo[titlesLength - 1]) {\n      activeTitleIndex = this.titlesInfo.length - 1;\n      this.setState({activeTitleIndex: activeTitleIndex});\n      return;\n    }\n    for (let i = 0; i < titlesLength; i++) {\n      if (contentScrollTop > this.titlesInfo[i]) {\n        continue;\n      } else {\n        activeTitleIndex = i - 1;\n        break;\n      }\n    }\n    this.setState({activeTitleIndex: activeTitleIndex});\n  }\n\n  changeInlineNode = (item) => {\n    let url, imagePath;\n\n    if (item.type == 'image' && isPublicWiki) { // change image url\n      url = item.data.src;\n      const re = new RegExp(serviceURL + '/lib/' + repoID +'/file.*raw=1');\n      // different repo\n      if (re.test(url)) {\n        // get image path\n        let index = url.indexOf('/file');\n        let index2 = url.indexOf('?');\n        imagePath = url.substring(index + 5, index2);\n      } else if (/^\\.\\.\\/*/.test(url) || /^\\.\\/*/.test(url)) {\n        const path = this.props.path;\n        const originalPath = path.slice(0, path.lastIndexOf('/')) + '/' + url;\n        imagePath = Utils.pathNormalize(originalPath);\n      } else {\n        return;\n      }\n      item.data.src = serviceURL + '/view-image-via-public-wiki/?slug=' + slug + '&path=' + imagePath;\n    } else if (item.type == 'link') { // change link url\n      url = item.data.href;\n      if (Utils.isInternalFileLink(url, repoID)) { // change file url\n        if (Utils.isInternalMarkdownLink(url, repoID)) {\n          let path = Utils.getPathFromInternalMarkdownLink(url, repoID);\n          // replace url\n          item.data.href = serviceURL + '/published/' + slug + path;\n        } else {\n          item.data.href = url.replace(/(.*)lib\\/([-0-9a-f]{36})\\/file(.*)/g, (match, p1, p2, p3) => {\n            return `${p1}d/${sharedToken}/files/?p=${p3}&dl=1`;\n          });\n        }\n      } else if (Utils.isInternalDirLink(url, repoID)) { // change dir url\n        let path = Utils.getPathFromInternalDirLink(url, repoID);\n        // replace url\n        item.data.href = serviceURL + '/published/' + slug + path;\n      }\n    }\n\n    return item;\n  }\n\n  modifyValueBeforeRender = (value) => {\n    let newNodes = Utils.changeMarkdownNodes(value, this.changeInlineNode);\n    return newNodes;\n  }\n\n  renderMarkdown = () => {\n    let isTOCShow = true;\n    if (this.props.isTOCShow === false) {\n      isTOCShow = false;\n    }\n    if (this.props.isWiki) {\n      return (\n        <MarkdownViewer\n          showTOC={isTOCShow}\n          scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n          markdownContent={this.props.markdownContent}\n          activeTitleIndex={this.state.activeTitleIndex}\n          modifyValueBeforeRender={this.modifyValueBeforeRender}\n        />\n      );\n    }\n\n    return (\n      <MarkdownViewer\n        showTOC={isTOCShow}\n        scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n        markdownContent={this.props.markdownContent}\n        activeTitleIndex={this.state.activeTitleIndex}\n      />\n    );\n  }\n\n  render() {\n    if (this.props.isFileLoading) {\n      return <Loading />;\n    }\n    // In dir-column-file repoID is one of props, width is 100%; In wiki-viewer repoID is not props, width isn't 100%\n    let contentClassName = `${this.props.repoID ? contentClass + ' w-100' : contentClass}`;\n    return (\n      <div ref={this.markdownContainer} className=\"wiki-page-container\" onScroll={this.onScrollHandler.bind(this)}>\n        <div className={contentClassName}>\n          {this.props.children}\n          {this.renderMarkdown()}\n          <p id=\"wiki-page-last-modified\">{gettext('Last modified by')} {this.props.latestContributor}, <span>{this.props.lastModified}</span></p>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst defaultProps = {\n  isWiki: false,\n};\n\nWikiMarkdownViewer.propTypes = propTypes;\nMarkdownViewer.defaultProps = defaultProps;\n\nexport default WikiMarkdownViewer;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { permission } from '../../utils/constants';\nimport TextTranslation from '../../utils/text-translation';\nimport ItemDropdownMenu from '../dropdown-menu/item-dropdown-menu';\nimport { Utils } from '../../utils/utils';\n\nconst propTypes = {\n  userPerm: PropTypes.string,\n  node: PropTypes.object.isRequired,\n  currentPath: PropTypes.string.isRequired,\n  paddingLeft: PropTypes.number.isRequired,\n  isNodeMenuShow: PropTypes.bool.isRequired,\n  isItemFreezed: PropTypes.bool.isRequired,\n  onNodeClick: PropTypes.func.isRequired,\n  onNodeExpanded: PropTypes.func.isRequired,\n  onNodeCollapse: PropTypes.func.isRequired,\n  onNodeDragStart: PropTypes.func.isRequired,\n  freezeItem: PropTypes.func.isRequired,\n  unfreezeItem: PropTypes.func.isRequired,\n  onMenuItemClick: PropTypes.func,\n  onNodeDragMove: PropTypes.func,\n  onNodeDrop: PropTypes.func,\n  handleContextClick: PropTypes.func.isRequired,\n  onNodeDragEnter: PropTypes.func.isRequired,\n  onNodeDragLeave:PropTypes.func.isRequired,\n};\n\nclass TreeNodeView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isHighlight: false,\n      isShowOperationMenu: false,\n      isNodeDropShow: false,\n    };\n    const { userPerm } = props;\n    this.canDrag = userPerm === 'rw';\n    const { isCustomPermission, customPermission } = Utils.getUserPermission(userPerm);\n    if (isCustomPermission) {\n      const { modify } = customPermission.permission;\n      this.canDrag = modify;\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (!nextProps.isItemFreezed) {\n      this.setState({\n        isShowOperationMenu: false,\n        isHighlight: false,\n      });\n    }\n  }\n\n  onMouseEnter = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({\n        isShowOperationMenu: true,\n        isHighlight: true,\n      });\n    }\n  }\n\n  onMouseOver = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({\n        isShowOperationMenu: true,\n        isHighlight: true,\n      });\n    }\n  }\n\n  onMouseLeave = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({\n        isShowOperationMenu: false,\n        isHighlight: false,\n      });\n    }\n  }\n\n  onNodeClick = () => {\n    const { node } = this.props;\n    const { object } = node;\n    if (object.isDir()) {\n      this.props.onNodeClick(this.props.node);\n      return;\n    }\n    const { isCustomPermission, customPermission } = Utils.getUserPermission(object.permission);\n    if (isCustomPermission) {\n      const { preview: canPreview, modify: canModify } = customPermission.permission;\n      if (!canPreview && !canModify) return;\n    } \n    this.props.onNodeClick(this.props.node);\n  }\n\n  onLoadToggle = (e) => {\n    e.stopPropagation();\n    let { node } = this.props;\n    if (node.isExpanded) {\n      this.props.onNodeCollapse(node);\n    } else {\n      this.props.onNodeExpanded(node);\n    }\n  }\n\n  onNodeDragStart = (e) => {\n    if (Utils.isIEBrower() || !this.canDrag) {\n      return false;\n    }\n    this.props.onNodeDragStart(e, this.props.node);\n  }\n\n  onNodeDragEnter = (e) => {\n    if (Utils.isIEBrower() || !this.canDrag) {\n      return false;\n    }\n    if (this.props.node.object.type === 'dir') {\n      this.setState({isNodeDropShow: true});\n    }\n    this.props.onNodeDragEnter(e, this.props.node);\n  }\n\n  onNodeDragMove = (e) => {\n    if (Utils.isIEBrower() || !this.canDrag) {\n      return false;\n    }\n    this.props.onNodeDragMove(e);\n  }\n\n  onNodeDragLeave = (e) => {\n    if (Utils.isIEBrower() || !this.canDrag) {\n      return false;\n    }\n    this.setState({isNodeDropShow: false});\n    this.props.onNodeDragLeave(e, this.props.node);\n  }\n\n  onNodeDrop = (e) => {\n    if (Utils.isIEBrower() || !this.canDrag) {\n      return false;\n    }\n    e.stopPropagation();\n    this.setState({isNodeDropShow: false});\n    this.props.onNodeDrop(e, this.props.node);\n  }\n\n  unfreezeItem = () => {\n    this.setState({isShowOperationMenu: false});\n    this.props.unfreezeItem();\n  }\n\n  onMenuItemClick = (operation, event, node) => {\n    this.props.onMenuItemClick(operation, node);\n  }\n\n  onItemMouseDown = (event) => {\n    event.stopPropagation();\n    if (event.button === 2) {\n      return;\n    }\n  }\n\n  onItemContextMenu = (event) => {\n    this.handleContextClick(event);\n  }\n\n  handleContextClick = (event) => {\n    this.props.handleContextClick(event, this.props.node);\n    this.setState({isShowOperationMenu: false});\n  }\n\n  getNodeTypeAndIcon = () => {\n    let { node } = this.props;\n    let icon = '';\n    let type = '';\n    if (node.object.type === 'dir') {\n      icon = <i className=\"far fa-folder\"></i>;\n      type = 'dir';\n    } else {\n      let index = node.object.name.lastIndexOf('.');\n      if (index === -1) {\n        icon = <i className=\"far fa-file\"></i>;\n        type = 'file';\n      } else {\n        let suffix = node.object.name.slice(index).toLowerCase();\n        if (suffix === '.png' || suffix === '.jpg' || suffix === '.jpeg' || suffix === '.gif' || suffix === '.bmp') {\n          icon = <i className=\"far fa-image\"></i>;\n          type = 'image';\n        }\n        else if (suffix === '.md' || suffix === '.markdown') {\n          icon = <i className=\"far fa-file-alt\"></i>;\n          type = 'file';\n        }\n        else {\n          icon = <i className=\"far fa-file\"></i>;\n          type = 'file';\n        }\n      }\n    }\n    return {icon, type};\n  }\n\n  calculateMenuList = (node) => {\n    let { NEW_FOLDER, NEW_FILE, COPY, MOVE, RENAME, DELETE, OPEN_VIA_CLIENT} =  TextTranslation;\n\n    let menuList = [RENAME, DELETE, COPY, MOVE, OPEN_VIA_CLIENT];\n    if (node.object.type === 'dir') {\n       menuList = [NEW_FOLDER, NEW_FILE, COPY, MOVE, RENAME, DELETE];\n    }\n\n    const { userPerm } = this.props;\n    const { isCustomPermission, customPermission } = Utils.getUserPermission(userPerm);\n    if (!isCustomPermission) {\n      return menuList;\n    }\n\n    menuList = [];\n    const { modify: canModify, delete: canDelete, copy: canCopy } = customPermission.permission;\n    if (node.object.type === 'dir') { \n      canModify && menuList.push(NEW_FOLDER, NEW_FILE);\n    }\n    \n    canCopy && menuList.push(COPY);\n    canModify && menuList.push(MOVE, RENAME);\n    canDelete && menuList.push(DELETE);\n\n    if (node.object.type !== 'dir') { \n      menuList.push(OPEN_VIA_CLIENT);\n    }\n\n    return menuList;\n  }\n\n  renderChildren = () => {\n    let { node, paddingLeft } = this.props;\n    if (!node.hasChildren()) {\n      return '';\n    }\n    return (\n      <div className=\"children\" style={{paddingLeft: paddingLeft}}>\n        {node.children.map(item => {\n          return (\n            <TreeNodeView\n              key={item.path}\n              node={item}\n              paddingLeft={paddingLeft}\n              userPerm={this.props.userPerm}\n              currentPath={this.props.currentPath}\n              isNodeMenuShow={this.props.isNodeMenuShow}\n              isItemFreezed={this.props.isItemFreezed}\n              onNodeClick={this.props.onNodeClick}\n              onNodeCollapse={this.props.onNodeCollapse}\n              onNodeExpanded={this.props.onNodeExpanded}\n              freezeItem={this.props.freezeItem}\n              onMenuItemClick={this.props.onMenuItemClick}\n              unfreezeItem={this.unfreezeItem}\n              onNodeDragStart={this.props.onNodeDragStart}\n              onNodeDragMove={this.props.onNodeDragMove}\n              onNodeDrop={this.props.onNodeDrop}\n              onNodeDragEnter={this.props.onNodeDragEnter}\n              onNodeDragLeave={this.props.onNodeDragLeave}\n              handleContextClick={this.props.handleContextClick}\n            />\n          );\n        })}\n      </div>\n    );\n  }\n\n  render() {\n    let { currentPath, node, isNodeMenuShow, userPerm } = this.props;\n    let { type, icon } = this.getNodeTypeAndIcon();\n    let hlClass = this.state.isHighlight ? 'tree-node-inner-hover ' : '';\n    if (node.path === currentPath) {\n      hlClass = 'tree-node-hight-light';\n    }\n\n    const { isCustomPermission } = Utils.getUserPermission(userPerm)\n    return (\n      <div className=\"tree-node\">\n        <div\n          type={type}\n          className={`tree-node-inner text-nowrap ${hlClass} ${node.path === '/'? 'hide': ''} ${this.state.isNodeDropShow ? 'tree-node-drop' : ''}`}\n          title={node.object.name}\n          onMouseEnter={this.onMouseEnter}\n          onMouseOver={this.onMouseOver}\n          onMouseLeave={this.onMouseLeave}\n          onMouseDown={this.onItemMouseDown}\n          onContextMenu={this.onItemContextMenu}\n          onClick={this.onNodeClick}\n        >\n          <div className=\"tree-node-text\" draggable={this.canDrag} onDragStart={this.onNodeDragStart} onDragEnter={this.onNodeDragEnter} onDragLeave={this.onNodeDragLeave} onDragOver={this.onNodeDragMove} onDrop={this.onNodeDrop}>{node.object.name}</div>\n          <div className=\"left-icon\">\n            {type === 'dir' && (!node.isLoaded ||  (node.isLoaded && node.hasChildren())) && (\n              <i\n                className={`folder-toggle-icon fa ${node.isExpanded ? 'fa-caret-down' : 'fa-caret-right'}`}\n                onMouseDown={e => e.stopPropagation()}\n                onClick={this.onLoadToggle}\n              ></i>\n            )}\n            <i className=\"tree-node-icon\">{icon}</i>\n          </div>\n          {isNodeMenuShow && (\n            <div className=\"right-icon\">\n              {((userPerm === 'rw' || permission || isCustomPermission) && this.state.isShowOperationMenu) && (\n                <ItemDropdownMenu\n                  item={this.props.node}\n                  toggleClass={'fas fa-ellipsis-v'}\n                  getMenuList={this.calculateMenuList}\n                  onMenuItemClick={this.onMenuItemClick}\n                  freezeItem={this.props.freezeItem}\n                  unfreezeItem={this.unfreezeItem}\n                />\n              )}\n            </div>\n          )}\n        </div>\n        {node.isExpanded && this.renderChildren()}\n      </div>\n    );\n  }\n}\n\nTreeNodeView.propTypes = propTypes;\n\nexport default TreeNodeView;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport TextTranslation from '../../utils/text-translation';\nimport TreeNodeView from './tree-node-view';\nimport ContextMenu from '../context-menu/context-menu';\nimport { hideMenu, showMenu } from '../context-menu/actions';\nimport { Utils } from '../../utils/utils';\n\nconst propTypes = {\n  userPerm: PropTypes.string,\n  isNodeMenuShow: PropTypes.bool.isRequired,\n  treeData: PropTypes.object.isRequired,\n  currentPath: PropTypes.string.isRequired,\n  onMenuItemClick: PropTypes.func,\n  onNodeClick: PropTypes.func.isRequired,\n  onNodeExpanded: PropTypes.func.isRequired,\n  onNodeCollapse: PropTypes.func.isRequired,\n  onItemMove: PropTypes.func,\n  currentRepoInfo: PropTypes.object,\n  selectedDirentList: PropTypes.array,\n  onItemsMove: PropTypes.func,\n};\n\nconst PADDING_LEFT = 20;\n\nclass TreeView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isItemFreezed: false,\n      isTreeViewDropTipShow: false,\n    };\n    const { userPerm } = props;\n    this.canDrop = userPerm === 'rw';\n    const { isCustomPermission, customPermission } = Utils.getUserPermission(userPerm);\n    if (isCustomPermission) {\n      const { modify } = customPermission.permission;\n      this.canDrop = modify;\n    }\n  }\n\n  onItemMove = (repo, dirent, selectedPath, currentPath) => {\n    this.props.onItemMove(repo, dirent, selectedPath, currentPath);\n  }\n\n  onNodeDragStart = (e, node) => {\n    if (Utils.isIEBrower()) {\n      return false;\n    }\n    let dragStartNodeData = {nodeDirent: node.object, nodeParentPath: node.parentNode.path, nodeRootPath: node.path};\n    dragStartNodeData = JSON.stringify(dragStartNodeData);\n\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('applicaiton/drag-item-info', dragStartNodeData);\n  }\n\n  onNodeDragEnter = (e, node) => {\n    if (Utils.isIEBrower() || !this.canDrop) {\n      return false;\n    }\n    e.persist();\n    if (e.target.className === 'tree-view tree ') {\n      this.setState({\n        isTreeViewDropTipShow: true,\n      });\n    }\n  }\n\n  onNodeDragMove = (e) => {\n    if (Utils.isIEBrower() || !this.canDrop) {\n      return false;\n    }\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  }\n\n  onNodeDragLeave = (e, node) => {\n    if (Utils.isIEBrower() || !this.canDrop) {\n      return false;\n    }\n    if (e.target.className === 'tree-view tree tree-view-drop') {\n      this.setState({\n        isTreeViewDropTipShow: false,\n      });\n    }\n  }\n\n  onNodeDrop = (e, node) => {\n    if (Utils.isIEBrower() || !this.canDrop) {\n      return false;\n    }\n    if (e.dataTransfer.files.length) { // uploaded files\n      return;\n    }\n    let dragStartNodeData = e.dataTransfer.getData('applicaiton/drag-item-info');\n    dragStartNodeData = JSON.parse(dragStartNodeData);\n\n    let {nodeDirent, nodeParentPath, nodeRootPath} = dragStartNodeData;\n    let dropNodeData = node;\n\n    if (Array.isArray(dragStartNodeData)) { //move items\n      if (!dropNodeData) { //move items to root\n        if (dragStartNodeData[0].nodeParentPath === '/') {\n          this.setState({isTreeViewDropTipShow: false});\n          return;\n        }\n        this.props.onItemsMove(this.props.currentRepoInfo, '/');\n        this.setState({isTreeViewDropTipShow: false});\n        return;\n      }\n      this.onMoveItems(dragStartNodeData, dropNodeData, this.props.currentRepoInfo, dropNodeData.path);\n      return;\n    }\n\n    if (!dropNodeData) {\n      if (nodeParentPath === '/') {\n        this.setState({isTreeViewDropTipShow: false});\n        return;\n      }\n      this.onItemMove(this.props.currentRepoInfo, nodeDirent, '/', nodeParentPath);\n      this.setState({isTreeViewDropTipShow: false});\n      return;\n    }\n\n    if (dropNodeData.object.type !== 'dir') {\n      return;\n    }\n\n    if (nodeParentPath === dropNodeData.path) {\n      return;\n    }\n\n    // copy the dirent to itself. eg: A/B -> A/B\n    if (nodeParentPath === dropNodeData.parentNode.path) {\n      if (dropNodeData.object.name === nodeDirent.name) {\n        return;\n      }\n    }\n\n    // copy the dirent to it's child. eg: A/B -> A/B/C\n    if (dropNodeData.object.type === 'dir' && nodeDirent.type === 'dir') {\n      if (dropNodeData.parentNode.path !== nodeParentPath) {\n        let paths = Utils.getPaths(dropNodeData.path);\n        if (paths.includes(nodeRootPath)) {\n          return;\n        }\n      }\n    }\n\n    this.onItemMove(this.props.currentRepoInfo, nodeDirent, dropNodeData.path, nodeParentPath);\n  }\n\n  onMoveItems = (dragStartNodeData, dropNodeData, destRepo, destDirentPath) => {\n    let direntPaths = [];\n    let paths = Utils.getPaths(destDirentPath);\n    dragStartNodeData.forEach(dirent => {\n      let path = dirent.nodeRootPath;\n      direntPaths.push(path);\n    });\n\n    if (dropNodeData.object.type !== 'dir') {\n      return;\n    }\n\n    // move dirents to one of them. eg: A/B, A/C -> A/B\n    if (direntPaths.some(direntPath => { return direntPath === destDirentPath;})) {\n      return;\n    }\n\n    // move dirents to current path\n    if (dragStartNodeData[0].nodeParentPath && dragStartNodeData[0].nodeParentPath === dropNodeData.path ) {\n      return;\n    }\n\n    // move dirents to one of their child. eg: A/B, A/D -> A/B/C\n    let isChildPath = direntPaths.some(direntPath => {\n      return paths.includes(direntPath);\n    });\n    if (isChildPath) {\n      return;\n    }\n\n    this.props.onItemsMove(destRepo, destDirentPath);\n  }\n\n  freezeItem = () => {\n    this.setState({isItemFreezed: true});\n  }\n\n  unfreezeItem = () => {\n    this.setState({isItemFreezed: false});\n  }\n\n  onMenuItemClick = (operation, node) => {\n    this.props.onMenuItemClick(operation, node);\n    hideMenu();\n  }\n\n  onMouseDown = (event) => {\n    event.stopPropagation();\n    if (event.button === 2) {\n      return;\n    }\n  }\n\n  onContextMenu = (event) => {\n    event.preventDefault();\n\n    let currentRepoInfo = this.props.currentRepoInfo;\n    if (currentRepoInfo.permission !== 'admin' && currentRepoInfo.permission !== 'rw') {\n      return '';\n    }\n    this.handleContextClick(event);\n  }\n\n  handleContextClick = (event, node) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (!this.props.isNodeMenuShow) {\n      return;\n    }\n\n    let x = event.clientX || (event.touches && event.touches[0].pageX);\n    let y = event.clientY || (event.touches && event.touches[0].pageY);\n\n    if (this.props.posX) {\n      x -= this.props.posX;\n    }\n    if (this.props.posY) {\n      y -= this.props.posY;\n    }\n\n    hideMenu();\n\n    let menuList = this.getMenuList(node);\n\n    let showMenuConfig = {\n      id: 'tree-node-contextmenu',\n      position: { x, y },\n      target: event.target,\n      currentObject: node,\n      menuList: menuList,\n    };\n\n    showMenu(showMenuConfig);\n  }\n\n  getMenuList = (node) => {\n    let menuList = [];\n\n    let { NEW_FOLDER, NEW_FILE, COPY, MOVE, RENAME, DELETE, OPEN_VIA_CLIENT } = TextTranslation;\n\n    if (!node) {\n      return [NEW_FOLDER, NEW_FILE];\n    }\n\n    if (node.object.type === 'dir') {\n      menuList = [NEW_FOLDER, NEW_FILE, COPY, MOVE, RENAME, DELETE];\n    } else {\n      menuList = [RENAME, DELETE, COPY, MOVE, OPEN_VIA_CLIENT];\n    }\n\n    const { userPerm } = this.props;\n    const { isCustomPermission, customPermission } = Utils.getUserPermission(userPerm);\n    if (!isCustomPermission) {\n      return menuList;\n    }\n\n    menuList = [];\n\n    const { modify: canModify, delete: canDelete, copy: canCopy } = customPermission.permission;\n    if (!node) {\n      canModify && menuList.push(NEW_FOLDER, NEW_FILE);\n      return menuList;\n    }\n\n    if (node.object.type === 'dir') { \n      canModify && menuList.push(NEW_FOLDER, NEW_FILE);\n    }\n    \n    canCopy && menuList.push(COPY);\n    canModify && menuList.push(MOVE, RENAME);\n    canDelete && menuList.push(DELETE);\n\n    if (node.object.type !== 'dir') { \n      menuList.push(OPEN_VIA_CLIENT);\n    }\n\n    return menuList;\n  }\n\n  onShowMenu = () => {\n    this.freezeItem();\n  }\n\n  onHideMenu = () => {\n    this.unfreezeItem();\n  }\n\n  render() {\n    return (\n      <div\n        className={`tree-view tree ${(this.state.isTreeViewDropTipShow && this.canDrop) ? 'tree-view-drop' : ''}`}\n        onDrop={this.onNodeDrop}\n        onDragEnter={this.onNodeDragEnter}\n        onDragLeave={this.onNodeDragLeave}\n        onMouseDown={this.onMouseDown}\n        onContextMenu={this.onContextMenu}\n      >\n        <TreeNodeView\n          userPerm={this.props.userPerm}\n          node={this.props.treeData.root}\n          currentPath={this.props.currentPath}\n          paddingLeft={PADDING_LEFT}\n          isNodeMenuShow={this.props.isNodeMenuShow}\n          isItemFreezed={this.state.isItemFreezed}\n          onNodeClick={this.props.onNodeClick}\n          onMenuItemClick={this.props.onMenuItemClick}\n          onNodeExpanded={this.props.onNodeExpanded}\n          onNodeCollapse={this.props.onNodeCollapse}\n          onNodeDragStart={this.onNodeDragStart}\n          freezeItem={this.freezeItem}\n          unfreezeItem={this.unfreezeItem}\n          onNodeDragMove={this.onNodeDragMove}\n          onNodeDrop={this.onNodeDrop}\n          onNodeDragEnter={this.onNodeDragEnter}\n          onNodeDragLeave={this.onNodeDragLeave}\n          handleContextClick={this.handleContextClick}\n        />\n        <ContextMenu\n          id={'tree-node-contextmenu'}\n          onMenuItemClick={this.onMenuItemClick}\n          onHideMenu={this.onHideMenu}\n          onShowMenu={this.onShowMenu}\n        />\n      </div>\n    );\n  }\n}\n\nTreeView.propTypes = propTypes;\n\nexport default TreeView;\n","import assign from 'object-assign';\n\nimport { store } from './helpers';\n\nexport const MENU_SHOW = 'REACT_CONTEXTMENU_SHOW';\nexport const MENU_HIDE = 'REACT_CONTEXTMENU_HIDE';\n\n\nexport function dispatchGlobalEvent(eventName, opts, target = window) {\n  // Compatibale with IE\n  // @see http://stackoverflow.com/questions/26596123/internet-explorer-9-10-11-event-constructor-doesnt-work\n  let event;\n\n  if (typeof window.CustomEvent === 'function') {\n    event = new window.CustomEvent(eventName, { detail: opts });\n  } else {\n    event = document.createEvent('CustomEvent');\n    event.initCustomEvent(eventName, false, true, opts);\n  }\n\n  if (target) {\n    target.dispatchEvent(event);\n    assign(store, opts);\n  }\n}\n\nexport function showMenu(opts = {}, target) {\n  dispatchGlobalEvent(MENU_SHOW, assign({}, opts, { type: MENU_SHOW }), target);\n}\n\nexport function hideMenu(opts = {}, target) {\n  dispatchGlobalEvent(MENU_HIDE, assign({}, opts, { type: MENU_HIDE }), target);\n}\n","export function callIfExists(func, ...args) {\n  return (typeof func === 'function') && func(...args);\n}\n\nexport function hasOwnProp(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nexport function uniqueId() {\n  return Math.random().toString(36).substring(7);\n}\n\nexport const store = {};\n\nexport const canUseDOM = Boolean(\n  typeof window !== 'undefined' && window.document && window.document.createElement\n);\n"],"sourceRoot":""}