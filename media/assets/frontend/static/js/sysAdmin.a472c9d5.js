"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[7583],{86335:function(e,t,s){s.d(t,{A:function(){return u}});var n=s(60436),r=s(89379),i=s(5544),a=s(9950),o=s(5223),l=s(44414),c=function(e){var t=e.data,s=e.position,n=(0,a.useState)(s),o=(0,i.default)(n,2),c=o[0],d=o[1],u=(0,a.useRef)(null);(0,a.useEffect)((function(){var e=u.current.getBoundingClientRect(),t=e.height,n=e.width,i=s||{},a=i.left,o=i.top,l=(0,r.default)({},s);o+t>window.innerHeight-10&&(l.top="unset",l.bottom=10),a+n>window.innerWidth-10&&(l.left="unset",l.right=10),d(l)}),[s]);var h=t.title,g=t.records;return(0,l.jsxs)("div",{className:"sf-chart-tooltip",ref:u,style:c,children:[(0,l.jsx)("div",{className:"sf-chart-tooltip-title",children:h}),g.map((function(e){return(0,l.jsxs)("div",{className:"sf-chart-tooltip-item",children:[(0,l.jsx)("div",{className:"sf-chart-tooltip-item-marker",style:{backgroundColor:e.color}}),(0,l.jsx)("div",{className:"sf-chart-tooltip-item-name",children:e.name}),(0,l.jsx)("div",{className:"sf-chart-tooltip-item-value",children:e.value})]},e.color)}))]})},d=function(e,t){var s=function(e,t){return Math.max(1,Math.floor(e.length/(t/100)))}(e,t);return e.filter((function(e,t){return t%s===0})).map((function(e){return e.name}))},u=function(e){var t=e.data,s=void 0===t?[]:t,u=e.legends,h=void 0===u?[]:u,g=e.title,p=void 0===g?"":g,m=e.margin,f=void 0===m?{top:60,right:30,bottom:30,left:30}:m,x=e.ySuggestedMax,v=void 0===x?0:x,A=e.getDisplayValue,P=void 0===A?function(e){return e}:A,j=(0,a.useState)({display:!1,position:{x:0,y:0}}),S=(0,i.default)(j,2),y=S[0],U=S[1],D=(0,a.useRef)(null),N=(0,a.useRef)(null),b=(0,a.useRef)([]),w=(0,a.useRef)(null),I=(0,a.useRef)(null),k=(0,a.useRef)(null),M=(0,a.useMemo)((function(){return h.map((function(e){var t=e.key;return(0,r.default)((0,r.default)({},e),{},{values:s.map((function(e){return{key:t,name:e.name,value:e[t]}}))})}))}),[s,h]),C=(0,a.useCallback)((function(e,t){var s=t.height;return o.l78(e).tickSizeOuter(0).tickSize(s).tickFormat("")}),[]),L=(0,a.useCallback)((function(e,t){var s=t.width;return o.V4s(e).ticks(5).tickSize(-s).tickFormat("")}),[]),_=(0,a.useCallback)((function(e,t,r,i){var a=o.T9B(s,(function(e){return Math.max.apply(Math,(0,n.default)(i.map((function(t){return e[t.key]||0}))))}));v&&(a=Math.max(v,a));var l=o.Cmz(0,a,5)[1];r.domain([0,l])}),[v,s]),O=(0,a.useCallback)((function(){var e=.8*D.current.getBoundingClientRect().width,t=.5*e,n={height:t-f.top-f.bottom,width:e-f.left-f.right},r=o.Ltv(N.current).attr("width",e).attr("height",t).append("g").attr("transform","translate(".concat(f.left,", ").concat(f.top,")")),i=s.map((function(e){return e.name}));return{svg:r,x:o.hqK().domain(i).range([0,n.width]).padding(.1),y:o.m4Y().range([n.height,0]),tickValues:d(s,n.width),style:n}}),[s,f]),R=(0,a.useCallback)((function(e,t,s,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:500;I.current.transition().duration(r).call(o.l78(t).tickSizeOuter(0).tickValues(n)),k.current.transition().duration(r).call(o.V4s(s).tickSizeInner(0).ticks(5).tickFormat(P))}),[P]),T=(0,a.useCallback)((function(e,t,s,n,r,i){var a=r.height,o=e.append("g").attr("class","axis");I.current=o.append("g").attr("class","axis-x").attr("transform","translate(0, ".concat(a,")")),k.current=o.append("g").attr("class","axis-y"),R(e,t,s,n,0)}),[R]),F=(0,a.useCallback)((function(e,t,s,n,r,i){var a=r.height,o=r.width,l=e.append("g").attr("class","grid"),c=l.append("g").attr("class","grid-x").call(C(t,{height:a})),d=l.append("line").attr("class","grid-x-tip-line d-none").attr("y1",0).attr("y2",a);c.selectAll(".tick").append("rect").attr("class","tick-interaction").attr("x",-2.5).attr("y",0).attr("width",5).attr("height",a).attr("fill","transparent").attr("pointer-events","all").on("mouseover",(function(s,n){var r;if(d.attr("x1",t(n)).attr("x2",t(n)).classed("d-none",!1),e.selectAll(".dot").filter((function(e){return e.name===n})).classed("highlight-dot",!0),(null===(r=w.current)||void 0===r?void 0:r.title)!==n){var i=[];M.forEach((function(e){var t=e.values.find((function(e){return e.name===n}));t&&i.push({color:e.color,name:e.name,value:P(t.value)})})),w.current={records:i,title:n}}U({display:!0,position:{left:s.pageX+10,top:s.pageY+10}})})).on("mouseout",(function(t,s){d.classed("d-none",!0),e.selectAll(".dot").classed("highlight-dot",!1),U({display:!1,position:{left:0,top:0}}),w.current=null})),l.append("g").attr("class","grid-y").call(L(s,{width:o})).selectAll(".tick").classed("d-none",(function(e,t){return 0===t}))}),[M,P,C,L]),E=(0,a.useCallback)((function(e,t,s,n,r,i){r.height,r.width;var a=o.n8j().x((function(e){return t(e.name)||0})).y((function(e){return s(e.value)||0})).curve(o.lUB),l=e.select(".groups").empty()?e.append("g").attr("class","groups"):e.select(".groups"),c=l.selectAll(".group").data(i).enter().append("g").attr("class","group");c.append("path").attr("class","line").attr("d",(function(e){return a(e.values)})).attr("fill","none").attr("stroke",(function(e){return e.color})),c.each((function(e){o.Ltv(this).selectAll(".dot").data(e.values).enter().append("circle").attr("class","dot").attr("cx",(function(e){return t(e.name)||0})).attr("cy",(function(e){return s(e.value)||0})).attr("fill",e.color)})),l.selectAll(".line").classed("fade-line",(function(e){return b.current.includes(e.key)})).attr("d",(function(e){return a(e.values)})).transition().duration(500),l.selectAll(".dot").classed("fade-dot",(function(e){return b.current.includes(e.key)})).attr("cx",(function(e){return t(e.name)||0})).attr("cy",(function(e){return s(e.value)||0})).transition().duration(500),l.exit().remove()}),[]),B=(0,a.useCallback)((function(e,t,s,r,i,a){var l=i.height,c=i.width,d=e.append("text").attr("class","legend-text-measurer").style("visibility","hidden").style("font-size","12px"),u=h.map((function(e){var t=e.name;return d.text(t),d.node().getComputedTextLength()}));d.remove();var g=u.reduce((function(e,t){return e+t}),0)+44*h.length-16,p=(c-g)/2,m=e.append("g").attr("class","legends").selectAll(".legend").data(a).enter().append("g").attr("class","legend").classed("hidden-legend",(function(e){return b.current.includes(e.key)})).on("click",(function(i,a){b.current.includes(a.key)?b.current=b.current.filter((function(e){return e!==a.key})):b.current=[].concat((0,n.default)(b.current),[a.key]),o.Ltv(this).classed("hidden-legend",b.current.includes(a.key)),Y(e,t,s,r,{height:l,width:c})}));m.append("rect").attr("x",(function(e,t){return p+u.slice(0,t).reduce((function(e,t){return e+t}),0)+44*t})).attr("y",-20).attr("width",20).attr("height",6).attr("rx",3).attr("fill",(function(e){return e.color})).attr("class","legend-color"),m.append("rect").attr("x",(function(e,t){return p+u.slice(0,t).reduce((function(e,t){return e+t}),0)+44*t+20})).attr("y",-26.5).attr("width",8).attr("height",16.5).attr("class","legend-gap"),m.append("text").attr("x",(function(e,t){return p+u.slice(0,t).reduce((function(e,t){return e+t}),0)+44*t+28})).attr("y",-20).attr("dy","7px").text((function(e){return e.name})).attr("class","legend-text")}),[h,Y]),z=(0,a.useCallback)((function(e,t,s,n,r){r.height;var i=r.width;p&&e.append("text").attr("class","title").attr("x",i/2).attr("y",-40).text(p)}),[p]),Y=(0,a.useCallback)((function(e,t,s,n,r){var i=r.width,a=r.height,o=h.filter((function(e){return!b.current.includes(e.key)}));_(e,t,s,o),R(e,t,s,n),e.select(".grid-x").transition().duration(500).call(C(t,{height:a})),e.select(".grid-y").transition().duration(500).call(L(s,{width:i})),E(e,t,s,n,{width:i,height:a},M)}),[h,M,_,R,C,L,E]),H=(0,a.useCallback)((function(e,t,s,n,r){var i=h.filter((function(e){return!b.current.includes(e.key)}));_(e,t,s,i),T(e,t,s,n,r),F(e,t,s,n,r),E(e,t,s,n,r,M),B(e,t,s,n,r,M),z(e,t,s,n,r)}),[h,M,_,T,F,E,B,z]),q=(0,a.useCallback)((function(){var e=O(),t=e.svg,s=e.x,n=e.y,r=e.tickValues,i=e.style;H(t,s,n,r,i)}),[O,H]),G=(0,a.useCallback)((function(){N.current&&o.Ltv(N.current).selectAll("*").remove()}),[]),Q=(0,a.useCallback)((function(){G(),q()}),[]);return(0,a.useEffect)((function(){return window.addEventListener("resize",Q),function(){G(),window.removeEventListener("resize",Q)}}),[Q]),(0,a.useEffect)((function(){q()}),[]),(0,l.jsxs)("div",{className:"sf-chart w-100 h-100",ref:D,children:[(0,l.jsx)("svg",{ref:N}),y.display&&(0,l.jsx)(c,{data:w.current,position:y.position})]})}},52622:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(65604),g=s(40326),p=s(20338),m=s(44414),f=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).submit=function(){s.props.changeGroup2Department(),s.props.toggleDialog()},s.state={selectedOption:null},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e='<span class="op-target">'+h.Aq.HTMLescape(this.props.groupName)+"</span>",t=(0,g.APU)("Are you sure to change group {placeholder} to department ?").replace("{placeholder}",e);return(0,m.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,m.jsx)(p.A,{toggle:this.props.toggleDialog,children:(0,g.APU)("Change group to department")}),(0,m.jsx)(c.A,{children:(0,m.jsx)("p",{dangerouslySetInnerHTML:{__html:t}})}),(0,m.jsxs)(d.A,{children:[(0,m.jsx)(u.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,g.APU)("Cancel")}),(0,m.jsx)(u.A,{color:"primary",onClick:this.submit,children:(0,g.APU)("Submit")})]})]})}}])}(o.Component);t.A=f},61314:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(5495),c=s(69123),d=s(65276),u=s(34940),h=s(40326),g=s(65604),p=s(44414),m=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).onMenuItemClick=function(e){var t=g.Aq.getEventData(e,"op");s.props.onMenuItemClick(t)},s.onDropdownToggleClick=function(e){s.toggleOperationMenu(e)},s.toggleOperationMenu=function(e){s.setState({isItemMenuShow:!s.state.isItemMenuShow},(function(){s.state.isItemMenuShow?s.props.onFreezedItem():s.props.onUnfreezedItem()}))},s.state={isItemMenuShow:!1},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.operations,n=t.translateOperations;return(0,p.jsxs)(l.A,{isOpen:this.state.isItemMenuShow,toggle:this.toggleOperationMenu,children:[(0,p.jsx)(c.A,{tag:"i",className:"sf3-font sf3-font-more op-icon",title:(0,h.APU)("More operations"),"aria-label":(0,h.APU)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.isItemMenuShow}),(0,p.jsx)(d.A,{className:"my-1 mr-2",children:s.map((function(t,s){return(0,p.jsx)(u.A,{"data-op":t,onClick:e.onMenuItemClick,children:n(t)},s)}))})]})}}])}(o.Component);t.A=m},61599:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(40326),u=s(9961),h=s(20338),g=(s(8008),s(44414)),p=function(e){function t(){var e;(0,n.default)(this,t);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(r))).toggle=function(){e.props.toggle()},e}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){return(0,g.jsxs)(l.A,{className:"seahub-io-dialog",isOpen:!0,toggle:this.toggle,children:[(0,g.jsx)(h.A,{toggle:this.toggle,children:(0,d.APU)("Exporting")}),(0,g.jsx)(c.A,{children:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(u.A,{}),(0,g.jsx)("div",{className:"seahub-io-dialog-parsing-text",children:(0,d.APU)("Exporting...")})]})})]})}}])}(o.Component);t.A=p},91611:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(25328),g=s(40326),p=s(4086),m=s(20338),f=s(44414),x=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).copyToClipboard=function(){(0,h.A)(s.props.link),s.props.toggleDialog(),p.A.success((0,g.APU)("The link is copied to the clipboard."),{duration:2})},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.props,t=e.link,s=e.toggleDialog;return(0,f.jsxs)(l.A,{isOpen:!0,toggle:s,children:[(0,f.jsx)(m.A,{toggle:s,children:(0,g.APU)("Link")}),(0,f.jsx)(c.A,{children:(0,f.jsx)("a",{href:t,children:t})}),(0,f.jsxs)(d.A,{children:[(0,f.jsx)(u.A,{color:"primary",onClick:this.copyToClipboard,children:(0,g.APU)("Copy")}),(0,f.jsx)(u.A,{color:"secondary",onClick:s,children:(0,g.APU)("Close")})]})]})}}])}(o.Component);t.A=x},15097:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(39708),u=s(79969),h=s(91646),g=s(65488),p=s(6754),m=s(34322),f=s(4086),x=s(40326),v=s(65604),A=s(43825),P=s(2662),j=s(20338),S=s(44414),y=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).onKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.handleChange=function(e){s.setState({departName:e.target.value},(function(){s.setState({isSubmitBtnActive:!!s.state.departName.trim()})}))},s.handleSubmit=function(){var e=(0,v.yS)(s.state.departName.trim());if(e.isValid){var t=s.props,n=t.orgID,r=t.parentNode,i=r?r.id:-1,a=s.state.departName.trim();(n?P.k.orgAdminAddDepartGroup(n,i,a):A.H.sysAdminAddNewDepartment(i,a)).then((function(e){r?s.props.addDepartment(r,e.data):s.props.setRootNode(e.data),s.props.toggle()})).catch((function(e){var t=v.Aq.getErrorMsg(e);f.A.danger(t)}))}else s.setState({errMessage:e.message})},s.state={departName:"",isSubmitBtnActive:!1},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e,t=this.props.parentNode,s=this.state.isSubmitBtnActive;return e=t?(0,x.APU)("Add department at")+" "+t.name:(0,x.APU)("Create top department"),(0,S.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,S.jsx)(j.A,{toggle:this.props.toggle,children:e}),(0,S.jsx)(c.A,{children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(u.A,{children:[(0,S.jsx)(h.A,{for:"departmentName",children:(0,x.APU)("Name")}),(0,S.jsx)(g.A,{id:"departmentName",name:"department-name",onKeyDown:this.onKeyDown,value:this.state.departName,onChange:this.handleChange,autoFocus:!0})]})})}),(0,S.jsxs)(p.A,{children:[(0,S.jsx)(m.A,{color:"secondary",onClick:this.props.toggle,children:(0,x.APU)("Cancel")}),(0,S.jsx)(m.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,x.APU)("Submit")})]})]})}}])}(o.Component);t.A=y},47150:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(40326),g=s(20338),p=s(44414),m=function(e){function t(){return(0,n.default)(this,t),(0,i.default)(this,t,arguments)}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.props,t=e.node,s=e.toggle;return(0,p.jsxs)(l.A,{isOpen:!0,toggle:s,children:[(0,p.jsx)(g.A,{toggle:s,children:(0,h.APU)("Delete department")}),(0,p.jsx)(c.A,{children:(0,p.jsxs)("div",{className:"pb-6",children:[(0,h.APU)("Are you sure to delete")," ",(0,p.jsx)("b",{children:t.name})," ?"]})}),(0,p.jsxs)(d.A,{children:[(0,p.jsx)(u.A,{color:"secondary",onMouseDown:s,children:(0,h.APU)("Cancel")}),(0,p.jsx)(u.A,{color:"primary",onMouseDown:this.props.onDelete,children:(0,h.APU)("Delete")})]})]})}}])}(o.Component);t.A=m},77474:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(39708),u=s(79969),h=s(91646),g=s(65488),p=s(6754),m=s(34322),f=s(4086),x=s(40326),v=s(65604),A=s(43825),P=s(2662),j=s(20338),S=s(44414),y=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).onKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.handleChange=function(e){var t=e.target.value;s.setState({departName:t},(function(){s.setState({isSubmitBtnActive:!!s.state.departName.trim()})}))},s.handleSubmit=function(){var e=(0,v.yS)(s.state.departName.trim());if(e.isValid){var t=s.props,n=t.node,r=t.orgID,i=s.state.departName.trim();(r?P.k.orgAdminUpdateDepartGroup(r,n.id,i):A.H.sysAdminRenameDepartment(n.id,i)).then((function(e){s.props.renameDepartment(n,e.data),s.props.toggle()})).catch((function(e){var t=v.Aq.getErrorMsg(e);f.A.danger(t)}))}else s.setState({errMessage:e.message})},s.state={departName:e.node.name,isSubmitBtnActive:!1},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.isSubmitBtnActive;return(0,S.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,S.jsx)(j.A,{toggle:this.props.toggle,children:(0,x.APU)("Rename")}),(0,S.jsx)(c.A,{children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(u.A,{children:[(0,S.jsx)(h.A,{for:"departmentName",children:(0,x.APU)("Name")}),(0,S.jsx)(g.A,{id:"departmentName",name:"department-name",onKeyDown:this.onKeyDown,value:this.state.departName,onChange:this.handleChange,autoFocus:!0})]})})}),(0,S.jsxs)(p.A,{children:[(0,S.jsx)(m.A,{color:"secondary",onClick:this.props.toggle,children:(0,x.APU)("Cancel")}),(0,S.jsx)(m.A,{color:"primary",onClick:this.handleSubmit,disabled:!e,children:(0,x.APU)("Submit")})]})]})}}])}(o.Component);t.A=y},43226:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(39708),u=s(79969),h=s(35077),g=s(65488),p=s(3898),m=s(6754),f=s(34322),x=s(40326),v=s(20338),A=s(44414),P=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleQuotaChange=function(e){var t=e.target.value;s.setState({quota:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateQuota(s.state.quota.trim()),s.toggle()},s.state={quota:"",isSubmitBtnActive:!1},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state,t=e.quota,s=e.isSubmitBtnActive;return(0,A.jsxs)(l.A,{isOpen:!0,toggle:this.toggle,children:[(0,A.jsx)(v.A,{toggle:this.toggle,children:(0,x.APU)("Set Quota")}),(0,A.jsx)(c.A,{children:(0,A.jsx)(d.A,{children:(0,A.jsxs)(u.A,{children:[(0,A.jsxs)(h.A,{children:[(0,A.jsx)(g.A,{type:"text",className:"form-control",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleQuotaChange}),(0,A.jsx)(p.A,{children:"MB"})]}),(0,A.jsxs)("p",{className:"small text-secondary mt-2 mb-2",children:[(0,x.APU)("An integer that is greater than or equal to 0."),(0,A.jsx)("br",{}),(0,x.APU)("Tip: 0 means default limit")]})]})})}),(0,A.jsxs)(m.A,{children:[(0,A.jsx)(f.A,{color:"secondary",onClick:this.toggle,children:(0,x.APU)("Cancel")}),(0,A.jsx)(f.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,x.APU)("Submit")})]})]})}}])}(o.Component);t.A=P},685:function(e,t,s){s.d(t,{A:function(){return P}});var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(4086),g=s(40326),p=s(43825),m=s(2662),f=s(65604),x=s(98361),v=s(20338),A=s(44414),P=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleSubmit=function(){var e=s.state.selectedUsers.map((function(e){return e.email}));if(0!==e.length){s.setState({errMessage:""});var t=s.props,n=t.nodeId,r=t.orgID;(r?m.k.orgAdminAddGroupMember(r,n,e):p.H.sysAdminAddGroupMember(n,e)).then((function(e){s.setState({selectedUsers:[]}),e.data.failed.length>0&&s.setState({errMsgs:e.data.failed.map((function(e){return e.error_msg}))}),e.data.success.length>0&&(s.props.onMemberChanged(),s.props.toggle())})).catch((function(e){var t=f.Aq.getErrorMsg(e);h.A.danger(t)}))}},s.state={selectedUsers:[],errMsgs:""},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.errMsgs;return(0,A.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,A.jsx)(v.A,{toggle:this.props.toggle,children:(0,g.APU)("Add members")}),(0,A.jsxs)(c.A,{children:[(0,A.jsx)(x.A,{placeholder:(0,g.APU)("Search users"),onSelectChange:this.handleSelectChange,isMulti:!0,selectedUsers:this.state.selectedUsers}),e.length>0&&(0,A.jsx)("ul",{className:"list-unstyled",children:e.map((function(e,t){return(0,A.jsx)("li",{className:"error mt-2",children:e},t)}))})]}),(0,A.jsxs)(d.A,{children:[(0,A.jsx)(u.A,{color:"secondary",onClick:this.props.toggle,children:(0,g.APU)("Cancel")}),(0,A.jsx)(u.A,{color:"primary",onClick:this.handleSubmit,children:(0,g.APU)("Submit")})]})]})}}])}(o.Component)},96763:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(40326),c=s(8081),d=s(10877),u=s(6754),h=s(34322),g=s(20338),p=s(44414),m=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).handleInputChange=function(e){s.setState({inputChecked:e.target.checked})},s.unlinkDevice=function(){s.props.toggleDialog(),s.props.unlinkDevice(s.state.inputChecked)},s.state={inputChecked:!1},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.inputChecked,t=this.props.toggleDialog;return(0,p.jsxs)(c.A,{isOpen:!0,toggle:t,children:[(0,p.jsx)(g.A,{toggle:t,children:(0,l.APU)("Unlink device")}),(0,p.jsxs)(d.A,{children:[(0,p.jsx)("p",{children:(0,l.APU)("Are you sure you want to unlink this device?")}),l.amr&&(0,p.jsxs)("div",{className:"d-flex align-items-center",children:[(0,p.jsx)("input",{id:"delete-files",className:"mr-1",type:"checkbox",checked:e,onChange:this.handleInputChange}),(0,p.jsx)("label",{htmlFor:"delete-files",className:"m-0",children:(0,l.APU)("Delete files from this device the next time it comes online.")})]})]}),(0,p.jsxs)(u.A,{children:[(0,p.jsx)(h.A,{color:"secondary",onClick:t,children:(0,l.APU)("Cancel")}),(0,p.jsx)(h.A,{color:"primary",onClick:this.unlinkDevice,children:(0,l.APU)("Unlink")})]})]})}}])}(o.Component);t.A=m},83970:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(65488),c=s(8123),d=s(44414),u=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).onInputChange=function(e){var t=e.target.checked,n=t?1:0;s.setState({inputChecked:t}),s.props.saveSetting(s.props.keyText,n)},s.state={inputChecked:s.props.value},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.inputChecked,t=this.props,s=t.helpTip,n=t.displayName;return(0,d.jsx)(c.A,{displayName:n,mainClassName:"d-flex",mainContent:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.A,{className:"ml-0",checked:e,type:"checkbox",onChange:this.onInputChange}),(0,d.jsx)("p",{className:"ml-2",children:s})]})})}}])}(o.Component);t.A=u},15263:function(e,t,s){var n=s(9950),r=s(34322),i=s(40326),a=s(8123),o=s(44414);t.A=function(e){var t=(0,n.useRef)(null),s=e.helpTip,l=e.filePath,c=e.fileWidth,d=e.fileHeight,u=e.displayName;return(0,o.jsx)(a.A,{displayName:u,helpTip:s,mainContent:(0,o.jsx)("img",{src:l+"?t="+(new Date).getTime(),alt:u,width:c,height:d,className:"mb-1"}),extraContent:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.A,{color:"secondary",onClick:function(){t.current.click()},children:(0,i.APU)("Change")}),(0,o.jsx)("input",{className:"d-none",type:"file",onChange:function(){if(t.current.files.length){var s=t.current.files[0];e.postFile(s,e.keyText)}},ref:t})]})})}},72714:function(e,t,s){s(9950);var n=s(44414);t.A=function(e){var t=e.headingText,s=e.children;return(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:t}),s]})}},8123:function(e,t,s){s(9950);var n=s(97176),r=s(46114),i=s(91646),a=s(44414);t.A=function(e){var t=e.helpTip,s=e.displayName,o=e.mainContent,l=e.extraContent,c=e.mainClassName,d=void 0===c?"":c;return(0,a.jsxs)(n.A,{className:"my-4",children:[(0,a.jsx)(r.A,{md:"3",children:(0,a.jsx)(i.A,{className:"web-setting-label",children:s})}),(0,a.jsxs)(r.A,{md:"5",className:d,children:[o,t&&(0,a.jsx)("p",{className:"small text-secondary mt-1",children:t})]}),(0,a.jsx)(r.A,{md:"4",children:l})]})}},98091:function(e,t,s){var n=s(89379),r=s(23029),i=s(92901),a=s(39874),o=s(85501),l=s(9950),c=s(1352),d=s(53496),u=s(8081),h=s(14894),g=s(67818),p=s(40326),m=s(65604),f=s(66945),x=s(49403),v=s(44414),A=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).getActiveClass=function(t){return e.props.currentTab==t?"active":""},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this;return(0,v.jsxs)("div",{className:"side-panel ".concat(this.props.isSidePanelClosed?"":"left-zero"),children:[(0,v.jsx)("div",{className:"side-panel-north",children:(0,v.jsx)(x.A,{onCloseSidePanel:this.props.onCloseSidePanel})}),(0,v.jsx)("div",{className:"side-panel-center",children:(0,v.jsx)("div",{className:"side-nav",children:(0,v.jsxs)("div",{className:"side-nav-con",children:[(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("System Admin")}),(0,v.jsxs)("ul",{className:"nav nav-pills flex-column nav-container",children:[p.TrM&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("info")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("info")),to:p.YcY+"sys/info/",onClick:function(){return e.props.tabItemClick("info")},children:[(0,v.jsx)("span",{className:"sf2-icon-info","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Info")})]})}),(p.amr||!p.Ez)&&p.m$W&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("statistic")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("statistic")),to:p.YcY+"sys/statistics/file/",onClick:function(){return e.props.tabItemClick("statistic")},children:[(0,v.jsx)("span",{className:"sf2-icon-histogram","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Statistic")})]})}),p.IwB&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("devices")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("devices")),to:p.YcY+"sys/devices/desktop/",onClick:function(){return e.props.tabItemClick("devices")},children:[(0,v.jsx)("span",{className:"sf2-icon-monitor","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Devices")})]})}),p.sh1&&p.s4E&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("web-settings")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("web-settings")),to:p.YcY+"sys/web-settings/",onClick:function(){return e.props.tabItemClick("web-settings")},children:[(0,v.jsx)("span",{className:"sf2-icon-cog2","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Settings")})]})}),p.$j_&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("libraries")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("libraries")),to:p.YcY+"sys/all-libraries/",onClick:function(){return e.props.tabItemClick("libraries")},children:[(0,v.jsx)("span",{className:"sf2-icon-library","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Libraries")})]})}),p.jRp&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("users")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("users")),to:p.YcY+"sys/users/",onClick:function(){return e.props.tabItemClick("users")},children:[(0,v.jsx)("span",{className:"sf2-icon-user","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Users")})]})}),p.XVl&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("groups")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("groups")),to:p.YcY+"sys/groups/",onClick:function(){return e.props.tabItemClick("groups")},children:[(0,v.jsx)("span",{className:"sf2-icon-group","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Groups")})]})}),p.amr&&p.XVl&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("departments")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("departments")),to:p.YcY+"sys/departments/",onClick:function(){return e.props.tabItemClick("departments")},children:[(0,v.jsx)("span",{className:"sf2-icon-organization","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Departments")})]})}),p.wAC&&p.IwB&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("organizations")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("organizations")),to:p.YcY+"sys/organizations/",onClick:function(){return e.props.tabItemClick("organizations")},children:[(0,v.jsx)("span",{className:"sf2-icon-organization","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Organizations")})]})}),p.amr&&p.Oq6&&p.IwB&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("institutions")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("institutions")),to:p.YcY+"sys/institutions/",onClick:function(){return e.props.tabItemClick("institutions")},children:[(0,v.jsx)("span",{className:"sf2-icon-organization","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Institutions")})]})}),p.IwB&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("notifications")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("notifications")),to:p.YcY+"sys/notifications/",onClick:function(){return e.props.tabItemClick("notifications")},children:[(0,v.jsx)("span",{className:"sf2-icon-msgs","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Notifications")})]})}),p.IwB&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("links")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("links")),to:p.YcY+"sys/share-links/",onClick:function(){return e.props.tabItemClick("links")},children:[(0,v.jsx)("span",{className:"sf2-icon-link","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Links")})]})}),p.w47&&p.jup&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("logs")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("logs")),to:p.YcY+"sys/logs/login",onClick:function(){return e.props.tabItemClick("logs")},children:[(0,v.jsx)("span",{className:"sf2-icon-clock","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Logs")})]})}),p.amr&&p.IwB&&p.n5Z&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("file-scan-records")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("file-scan-records")),to:p.YcY+"sys/file-scan-records/",onClick:function(){return e.props.tabItemClick("file-scan-records")},children:[(0,v.jsx)("span",{className:"sf2-icon-security","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("File Scan")})]})}),p.amr&&p.IwB&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("virus-files")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("virus-files")),to:p.YcY+"sys/virus-files/all/",onClick:function(){return e.props.tabItemClick("virus-files")},children:[(0,v.jsx)("span",{className:"sf2-icon-security","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Virus Scan")})]})}),p.amr&&p.JC6&&p.IwB&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("invitations")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("invitations")),to:p.YcY+"sys/invitations/",onClick:function(){return e.props.tabItemClick("invitations")},children:[(0,v.jsx)("span",{className:"sf2-icon-invite","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Invitations")})]})}),p.IwB&&p.a8J&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("termsandconditions")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("termsandconditions")),to:p.YcY+"sys/terms-and-conditions/",onClick:function(){return e.props.tabItemClick("termsandconditions")},children:[(0,v.jsx)("span",{className:"sf2-icon-wiki","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Terms and Conditions")})]})}),p.amr&&p.hP6&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("adminLogs")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("adminLogs")),to:p.YcY+"sys/admin-logs/operation",onClick:function(){return e.props.tabItemClick("adminLogs")},children:[(0,v.jsx)("span",{className:"sf2-icon-admin-log","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Admin Logs")})]})}),p.IwB&&p.LpR&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("work-weixin")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("work-weixin")),to:p.YcY+"sys/work-weixin/",onClick:function(){return e.props.tabItemClick("work-weixin")},children:[(0,v.jsx)("span",{className:"sf3-font-enterprise-wechat sf3-font","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:"\u4f01\u4e1a\u5fae\u4fe1\u96c6\u6210"})]})}),p.IwB&&p.MTv&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("dingtalk")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("dingtalk")),to:p.YcY+"sys/dingtalk/",onClick:function(){return e.props.tabItemClick("dingtalk")},children:[(0,v.jsx)("span",{className:"sf3-font-dingtalk sf3-font","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:"\u9489\u9489\u96c6\u6210"})]})}),p.IwB&&p.DYR&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("abuse-reports")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("abuse-reports")),to:p.YcY+"sys/abuse-reports/",onClick:function(){return e.props.tabItemClick("abuse-reports")},children:[(0,v.jsx)("span",{className:"sf2-icon-monitor","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.APU)("Abuse Reports")})]})})]})]})})})]})}}])}(l.Component),P=A,j=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel",children:this.props.children})}}])}(l.Component),S=j,y=s(34322),U=s(43825),D=s(4086),N=s(9961),b=s(32043),w=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).uploadLicenseFile=function(e){if(s.fileInput.current.files.length){var t=s.fileInput.current.files[0];U.H.sysAdminUploadLicense(t).then((function(e){var t=s.state.sysInfo;Object.assign(t,e.data,{with_license:!0}),s.setState({sysInfo:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}},s.openFileInput=function(){s.fileInput.current.click()},s.renderLicenseDescString=function(e,t,s){return"life-time"==e?"zh-cn"==window.app.config.lang?"\u6c38\u4e45\u6388\u6743\u7ed9 "+t+"\uff0c\u6280\u672f\u652f\u6301\u670d\u52a1\u81f3 "+s+" \u5230\u671f":(0,p.APU)("licensed to {placeholder_license_to}, upgrade service expired in {placeholder_license_expiration}").replace("{placeholder_license_to}",t).replace("{placeholder_license_expiration}",s):(0,p.APU)("licensed to {placeholder_license_to}, expires on {placeholder_license_expiration}").replace("{placeholder_license_to}",t).replace("{placeholder_license_expiration}",s)},s.state={loading:!0,errorMsg:"",sysInfo:{}},s.fileInput=l.createRef(),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetSysInfo().then((function(t){e.setState({loading:!1,sysInfo:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.sysInfo,t=e.license_mode,s=e.license_to,r=e.license_expiration,i=e.org_count,a=e.repos_count,o=e.total_files_count,c=e.total_storage,d=e.total_devices_count,u=e.current_connected_devices_count,h=e.license_maxusers,g=e.multi_tenancy_enabled,f=e.active_users_count,x=e.users_count,A=e.groups_count,P=e.with_license,j=this.state,S=j.loading,U=j.errorMsg;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container system-admin-info",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Info")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[S&&(0,v.jsx)(N.A,{}),U&&(0,v.jsx)("p",{className:"error text-center mt-4",children:U}),!S&&!U&&(0,v.jsxs)("dl",{className:"flex-1 m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("System Info")}),p.amr?(0,v.jsxs)("dd",{className:"info-item-content",children:[(0,p.APU)("Professional Edition"),P&&" "+this.renderLicenseDescString(t,s,r),(0,v.jsx)("br",{}),p.P95&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{type:"button",className:"mt-2",onClick:this.openFileInput,children:(0,p.APU)("Upload license")}),(0,v.jsx)("input",{className:"d-none",type:"file",onChange:this.uploadLicenseFile,ref:this.fileInput})]})]}):(0,v.jsxs)("dd",{className:"info-item-content",children:[(0,p.APU)("Community Edition"),(0,v.jsx)("a",{className:"ml-1",href:"https://manual.seafile.com/latest/setup/migrate_ce_to_pro_with_docker/",target:"_blank",rel:"noreferrer",children:(0,p.APU)("Upgrade to Pro Edition")})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Version")}),(0,v.jsx)("dd",{className:"info-item-content",children:p.siA}),(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.APU)("Libraries")," / ",(0,p.APU)("Files")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[a," / ",o]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Storage Used")}),(0,v.jsx)("dd",{className:"info-item-content",children:m.Aq.bytesToSize(c)}),(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.APU)("Total Devices")," / ",(0,p.APU)("Current Connected Devices")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[d," / ",u]}),p.amr?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.APU)("Activated Users")," / ",(0,p.APU)("Total Users")," / ",(0,p.APU)("Limits")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[f," / ",x," / ",P?h:"--"]})]}):(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.APU)("Activated Users")," / ",(0,p.APU)("Total Users")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[f," / ",x]})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Groups")}),(0,v.jsx)("dd",{className:"info-item-content",children:A}),g&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Organizations")}),(0,v.jsx)("dd",{className:"info-item-content",children:i})]})]})]})]})})]})}}])}(l.Component),I=w,k=s(5544),M=s(4159),C=s.n(M),L=s(64467),_=s(29343),O=s(52544),R=s(86547),T=s.n(R),F=s(81139),E=(s(33731),s(9516),s(19617),"YYYY-MM-DD"),B=function(e){function t(e){var s;(0,r.default)(this,t),s=(0,a.default)(this,t,[e]);var n=window.app.config.lang,i=C()();return i="zh-cn"===n?i.locale("zh-cn"):i.locale("en-gb"),s.defaultCalendarValue=i.clone(),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=(0,v.jsx)(O.A,{defaultValue:this.defaultCalendarValue,disabledDate:e.disabledDate,format:E,locale:(0,F.r)()});return(0,v.jsx)(T(),{calendar:t,value:e.value,onChange:e.onChange,children:function(e){var t=e.value;return(0,v.jsx)("span",{children:(0,v.jsx)("input",{placeholder:"yyyy-mm-dd",tabIndex:"-1",readOnly:!0,value:t&&t.format(E)||"",className:"form-control system-statistic-input"})})}})}}])}(l.Component),z=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).changeActive=function(e){if(s.state.statisticType!==e){var t,n=C()().format("YYYY-MM-DD 00:00:00");switch(e){case"oneWeek":t=C()().subtract(6,"d").format("YYYY-MM-DD 00:00:00");break;case"oneMonth":t=C()().subtract(29,"d").format("YYYY-MM-DD 00:00:00");break;case"oneYear":t=C()().subtract(364,"d").format("YYYY-MM-DD 00:00:00")}s.setState({statisticType:e});s.props.getActivesFiles(t,n,"day")}},s.disabledStartDate=function(e){if(!e)return!1;var t=C()().format(),n=s.state.endValue;return n?n.isBefore(e)||C()(e).format()>t:t<C()(e).format()},s.disabledEndDate=function(e){if(!e)return!1;var t=C()().format(),n=s.state.startValue;return n?e.isBefore(n)||C()(e).format()>t:t<C()(e).format()},s.onChange=function(e,t){s.setState((0,L.default)({},e,t))},s.onSubmit=function(){var e=s.state,t=e.startValue,n=e.endValue;if(t&&n){s.setState({statisticType:"itemButton"});var r=C()(t).format("YYYY-MM-DD 00:00:00"),i=C()(n).format("YYYY-MM-DD 00:00:00");s.props.getActivesFiles(r,i,"day")}},s.state={statisticType:"oneWeek",startValue:null,endValue:null},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=C()().format("YYYY-MM-DD 00:00:00"),t=C()().subtract(6,"d").format("YYYY-MM-DD 00:00:00");this.props.getActivesFiles(t,e,"day")}},{key:"render",value:function(){var e=this.state,t=e.statisticType,s=e.endValue,n=e.startValue;return(0,v.jsxs)(l.Fragment,{children:[this.props.children,(0,v.jsxs)("div",{className:"system-statistic-time-range",children:[(0,v.jsxs)(_.A,{size:"sm",className:"sys-stat-tool",children:[(0,v.jsx)(y.A,{className:"font-weight-normal ".concat("oneWeek"===t?"item-active":""),onClick:this.changeActive.bind(this,"oneWeek"),children:(0,p.APU)("7 Days")}),(0,v.jsx)(y.A,{className:"font-weight-normal ".concat("oneMonth"===t?"item-active":""),onClick:this.changeActive.bind(this,"oneMonth"),children:(0,p.APU)("30 Days")}),(0,v.jsx)(y.A,{className:"font-weight-normal ".concat("oneYear"===t?"item-active":""),onClick:this.changeActive.bind(this,"oneYear"),children:(0,p.APU)("1 Year")})]}),(0,v.jsxs)("div",{className:"system-statistic-input-container",children:[(0,v.jsx)(B,{disabledDate:this.disabledStartDate,value:n,onChange:this.onChange.bind(this,"startValue")}),(0,v.jsx)("span",{className:"system-statistic-connect",children:"-"}),(0,v.jsx)(B,{disabledDate:this.disabledEndDate,value:s,onChange:this.onChange.bind(this,"endValue")}),(0,v.jsx)(y.A,{color:"primary",size:"sm",className:"system-statistic-button",onClick:this.onSubmit,children:(0,p.APU)("Submit")})]})]})]})}}])}(l.Component),Y=s(86335),H=(s(63864),function(e){var t=(0,l.useState)(!0),s=(0,k.default)(t,2),n=s[0],r=s[1],i=(0,l.useState)([]),a=(0,k.default)(i,2),o=a[0],c=a[1],d=(0,l.useMemo)((function(){return[{key:"added",color:"#57cd6b",name:(0,p.APU)("Added")},{key:"visited",color:"#fd913a",name:(0,p.APU)("Visited")},{key:"modified",color:"#72c3fc",name:(0,p.APU)("Modified")},{key:"deleted",color:"#f75356",name:(0,p.APU)("Deleted")}]}),[]),u=(0,l.useCallback)((function(e,t,s){r(!0),U.H.sysAdminStatisticFiles(e,t,s).then((function(e){var t=Array.isArray(e.data)?e.data.map((function(e){var t=e.added,s=e.deleted,n=e.modified,r=e.visited,i=e.datetime;return{name:C()(i).format("YYYY-MM-DD"),added:t,deleted:s,modified:n,visited:r}})):[];r(!1),c(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}),[]);return(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsx)(z,{getActivesFiles:u}),n&&(0,v.jsx)(N.A,{}),!n&&o.length>0&&(0,v.jsx)(Y.A,{title:(0,p.APU)("File Operations"),data:o,legends:d})]})})}),q=function(e){var t=(0,l.useState)(!0),s=(0,k.default)(t,2),n=s[0],r=s[1],i=(0,l.useState)([]),a=(0,k.default)(i,2),o=a[0],c=a[1],d=(0,l.useMemo)((function(){return[{key:"total_storage",name:(0,p.APU)("Total Storage"),color:"#fd913a"}]}),[]),u=(0,l.useMemo)((function(){return 1e7}),[]),h=(0,l.useCallback)((function(e,t,s){r(!0),U.H.sysAdminStatisticStorages(e,t,s).then((function(e){var t=Array.isArray(e.data)?e.data.map((function(e){var t=e.total_storage,s=e.datetime;return{name:C()(s).format("YYYY-MM-DD"),total_storage:t}})):[];c(t),r(!1)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}),[]),g=(0,l.useCallback)((function(e){return m.Aq.bytesToSize(e)}),[]);return(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsx)(z,{getActivesFiles:h}),n&&(0,v.jsx)(N.A,{}),!n&&o.length>0&&(0,v.jsx)(Y.A,{title:(0,p.APU)("Total Storage"),legends:d,data:o,margin:{top:60,right:30,bottom:30,left:60},ySuggestedMax:u,getDisplayValue:g})]})})},G=s(65488),Q=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.type,s=e.sortBy,n="asc"==e.sortOrder?(0,v.jsx)("span",{className:"sf3-font sf3-font-down rotate-180 d-inline-block"}):(0,v.jsx)("span",{className:"sf3-font sf3-font-down"});return(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"16%",children:"user"==t?(0,p.APU)("User"):(0,p.APU)("Organization")}),(0,v.jsx)("th",{width:"11%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"sync_file_upload"),children:[(0,p.APU)("Sync Upload")," ","sync_file_upload"===s&&n]})}),(0,v.jsx)("th",{width:"14%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"sync_file_download"),children:[(0,p.APU)("Sync Download")," ","sync_file_download"===s&&n]})}),(0,v.jsx)("th",{width:"11%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"web_file_upload"),children:[(0,p.APU)("Web Upload")," ","web_file_upload"===s&&n]})}),(0,v.jsx)("th",{width:"14%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"web_file_download"),children:[(0,p.APU)("Web Download")," ","web_file_download"===s&&n]})}),(0,v.jsx)("th",{width:"17%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"link_file_upload"),children:[(0,p.APU)("Share link upload")," ","link_file_upload"===s&&n]})}),(0,v.jsx)("th",{width:"17%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"link_file_download"),children:[(0,p.APU)("Share link download")," ","link_file_download"===s&&n]})})]})}),(0,v.jsx)("tbody",{children:this.props.children})]})}}])}(l.Component),V=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).trafficName=function(){var t=e.props,s=t.userTrafficItem;switch(t.type){case"user":return s.name?(0,v.jsx)("a",{href:p.YcY+"sys/users/"+s.email+"/",children:s.name}):(0,v.jsx)("span",{children:"--"});case"org":return s.org_name?(0,v.jsx)("a",{href:p.YcY+"sys/organizations/"+s.org_id+"/info/",children:s.org_name}):(0,v.jsx)("span",{children:"--"})}},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.userTrafficItem,t=m.Aq.bytesToSize(e.sync_file_upload),s=m.Aq.bytesToSize(e.sync_file_download),n=m.Aq.bytesToSize(e.web_file_upload),r=m.Aq.bytesToSize(e.web_file_download),i=m.Aq.bytesToSize(e.link_file_upload),a=m.Aq.bytesToSize(e.link_file_download);return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:this.trafficName()}),(0,v.jsx)("td",{children:t}),(0,v.jsx)("td",{children:s}),(0,v.jsx)("td",{children:n}),(0,v.jsx)("td",{children:r}),(0,v.jsx)("td",{children:i}),(0,v.jsx)("td",{children:a})]})}}])}(l.Component),W=V,K=s(62376),X=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.getTrafficList(s.state.month,s.state.currentPage-1)},s.getNextPage=function(){s.getTrafficList(s.state.month,s.state.currentPage+1)},s.handleChange=function(e){var t=e.target.value;s.setState({month:t})},s.handleKeyPress=function(e){var t=s.state.month;if("Enter"===e.key){if(!/^([012]\d{3})(0[1-9]|1[012])$/.test(t)){var n=(0,p.APU)("Invalid month, should be yyyymm.");return void s.setState({errorMessage:n})}s.getTrafficList(t,s.initPage),e.target.blur(),e.preventDefault()}},s.getTrafficList=function(e,t){var n=s.state,r=n.perPage,i=n.sortBy,a=n.sortOrder,o="asc"==a?i:"".concat(i,"_").concat(a);s.setState({isLoading:!0,errorMessage:""}),U.H.sysAdminListOrgTraffic(e,t,r,o).then((function(n){var r=n.data.org_monthly_traffic_list.slice(0);s.setState({month:e,currentPage:t,orgTrafficList:r,hasNextPage:n.data.has_next_page,isLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.sortItems=function(e){s.setState({sortBy:e,sortOrder:"asc"==s.state.sortOrder?"desc":"asc"},(function(){var e=s.state,t=e.month,n=e.currentPage;s.getTrafficList(t,n)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getTrafficList(s.initMonth,s.initPage)}))},s.state={orgTrafficList:[],perPage:100,currentPage:1,hasNextPage:!1,month:C()().format("YYYYMM"),isLoading:!1,errorMessage:"",sortBy:"link_file_download",sortOrder:"desc"},s.initPage=1,s.initMonth=C()().format("YYYYMM"),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getTrafficList(e.initMonth,e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isLoading,s=e.errorMessage,n=e.orgTrafficList,r=e.currentPage,i=e.hasNextPage,a=e.perPage,o=e.sortBy,c=e.sortOrder;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mt-4",children:[(0,v.jsx)("span",{className:"statistic-reports-tip",children:(0,p.APU)("Month:")}),(0,v.jsx)(G.A,{className:"statistic-reports-input",defaultValue:C()().format("YYYYMM"),onChange:this.handleChange,onKeyPress:this.handleKeyPress}),s&&(0,v.jsx)("div",{className:"error",children:s})]}),t&&(0,v.jsx)(N.A,{}),!t&&(0,v.jsx)(Q,{type:"org",sortItems:this.sortItems,sortBy:o,sortOrder:c,children:n.length>0&&n.map((function(e,t){return(0,v.jsx)(W,{userTrafficItem:e,type:"org"},t)}))}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:r,hasNextPage:i,curPerPage:a,resetPerPage:this.resetPerPage})]})}}])}(l.Component),$=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.getTrafficList(s.state.month,s.state.currentPage-1)},s.getNextPage=function(){s.getTrafficList(s.state.month,s.state.currentPage+1)},s.handleChange=function(e){var t=e.target.value;s.setState({month:t})},s.handleKeyPress=function(e){var t=s.state.month;if("Enter"===e.key){if(!/^([012]\d{3})(0[1-9]|1[012])$/.test(t)){var n=(0,p.APU)("Invalid month, should be yyyymm.");return void s.setState({errorMessage:n})}s.getTrafficList(t,s.initPage),e.target.blur(),e.preventDefault()}},s.getTrafficList=function(e,t){var n=s.state,r=n.perPage,i=n.sortBy,a=n.sortOrder,o="asc"==a?i:"".concat(i,"_").concat(a);s.setState({isLoading:!0,errorMessage:""}),U.H.sysAdminListUserTraffic(e,t,r,o).then((function(n){var r=n.data.user_monthly_traffic_list.slice(0);s.setState({month:e,currentPage:t,userTrafficList:r,hasNextPage:n.data.has_next_page,isLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.sortItems=function(e){s.setState({sortBy:e,sortOrder:"asc"==s.state.sortOrder?"desc":"asc"},(function(){var e=s.state,t=e.month,n=e.currentPage;s.getTrafficList(t,n)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getTrafficList(s.initMonth,s.initPage)}))},s.state={userTrafficList:[],hasNextPage:!1,perPage:100,currentPage:1,month:C()().format("YYYYMM"),isLoading:!1,errorMessage:"",sortBy:"link_file_download",sortOrder:"desc"},s.initPage=1,s.initMonth=C()().format("YYYYMM"),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getTrafficList(e.initMonth,e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isLoading,s=e.errorMessage,n=e.userTrafficList,r=e.currentPage,i=e.hasNextPage,a=e.perPage,o=e.sortBy,c=e.sortOrder;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mt-4",children:[(0,v.jsx)("span",{className:"statistic-reports-tip",children:(0,p.APU)("Month:")}),(0,v.jsx)(G.A,{className:"statistic-reports-input",defaultValue:C()().format("YYYYMM"),onChange:this.handleChange,onKeyPress:this.handleKeyPress}),s&&(0,v.jsx)("div",{className:"error",children:s})]}),t&&(0,v.jsx)(N.A,{}),!t&&(0,v.jsx)(Q,{type:"user",sortItems:this.sortItems,sortBy:o,sortOrder:c,children:n.length>0&&n.map((function(e,t){return(0,v.jsx)(W,{userTrafficItem:e,type:"user"},t)}))}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:r,hasNextPage:i,curPerPage:a,resetPerPage:this.resetPerPage})]})}}])}(l.Component),J=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).changeTabActive=function(e){s.setState({tabActive:e})},s.getActivesFiles=function(e,t,n){s.setState({isLoading:!0}),U.H.sysAdminStatisticTraffic(e,t,n).then((function(e){var t=[],n=[],r=[],i=[],a=e.data;Array.isArray(a)&&a.forEach((function(e){var s=e.datetime,a=C()(s).format("YYYY-MM-DD");n.push({name:a,upload:e["web-file-upload"],download:e["web-file-download"]}),r.push({name:a,upload:e["link-file-upload"],download:e["link-file-download"]}),i.push({name:a,upload:e["sync-file-upload"],download:e["sync-file-download"]}),t.push({name:a,upload:e["link-file-upload"]+e["sync-file-upload"]+e["web-file-upload"],download:e["link-file-download"]+e["sync-file-download"]+e["web-file-download"]})})),s.setState({linkData:r,syncData:i,webData:n,totalData:t,isLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.renderCommonTool=function(){var e=s.state.tabActive;return"system"===e?(0,v.jsx)(z,{getActivesFiles:s.getActivesFiles,children:(0,v.jsxs)("div",{className:"statistic-traffic-tab",children:[(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("system"===e?"active":""),onClick:s.changeTabActive.bind(s,"system"),children:(0,p.APU)("System")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("user"===e?"active":""),onClick:s.changeTabActive.bind(s,"user"),children:(0,p.APU)("Users")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("organizations"===e?"active":""),onClick:s.changeTabActive.bind(s,"organizations"),children:(0,p.APU)("Organizations")})]})}):(0,v.jsxs)("div",{className:"statistic-traffic-tab",children:[(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("system"===e?"active":""),onClick:s.changeTabActive.bind(s,"system"),children:(0,p.APU)("System")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("user"===e?"active":""),onClick:s.changeTabActive.bind(s,"user"),children:(0,p.APU)("Users")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("organizations"===e?"active":""),onClick:s.changeTabActive.bind(s,"organizations"),children:(0,p.APU)("Organizations")})]})},s.getDisplayValue=function(e){return m.Aq.bytesToSize(e)},s.legends=[{key:"upload",name:(0,p.APU)("Upload"),color:"#fd913a"},{key:"download",name:(0,p.APU)("Download"),color:"#57cd6b"}],s.state={totalData:[],linkData:[],syncData:[],webData:[],isLoading:!0,tabActive:"system"},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.totalData,s=e.linkData,n=e.syncData,r=e.webData,i=e.isLoading,a=e.tabActive;return(0,v.jsx)(l.Fragment,{children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[this.renderCommonTool(),i&&(0,v.jsx)(N.A,{}),!i&&"system"===a&&(0,v.jsxs)("div",{className:"statistic-traffic-chart-container",children:[t.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(Y.A,{legends:this.legends,data:t,title:(0,p.APU)("Total Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})}),r.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(Y.A,{legends:this.legends,data:r,title:(0,p.APU)("Web Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})}),s.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(Y.A,{legends:this.legends,data:s,title:(0,p.APU)("Share Link Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})}),n.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(Y.A,{legends:this.legends,data:n,title:(0,p.APU)("Sync Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})})]}),!i&&"user"===a&&(0,v.jsx)($,{}),!i&&"organizations"===a&&(0,v.jsx)(X,{})]})})})}}])}(l.Component),Z=function(e){var t=(0,l.useState)(!0),s=(0,k.default)(t,2),n=s[0],r=s[1],i=(0,l.useState)([]),a=(0,k.default)(i,2),o=a[0],c=a[1],d=(0,l.useMemo)((function(){return[{key:"count",name:(0,p.APU)("Active Users"),color:"#fd913a"}]}),[]),u=(0,l.useMemo)((function(){return 10}),[]),h=(0,l.useCallback)((function(e,t,s){r(!0),U.H.sysAdminStatisticActiveUsers(e,t,s).then((function(e){var t=Array.isArray(e.data)?e.data.map((function(e){var t=e.count,s=e.datetime;return{name:C()(s).format("YYYY-MM-DD"),count:t}})):[];c(t),r(!1)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}),[]);return(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsx)(z,{getActivesFiles:h}),n&&(0,v.jsx)(N.A,{}),!n&&o.length>0&&(0,v.jsx)(Y.A,{title:(0,p.APU)("Active Users"),legends:d,data:o,ySuggestedMax:u})]})})},ee=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleChange=function(e){var t=e.target.value;s.setState({month:t})},s.onGenerateReports=function(e){var t=p.xW0+p.YcY+"api/v2.1/admin/statistics/",n=s.state.month;if(n){if("month"===e){if(!/^([012]\d{3})(0[1-9]|1[012])$/.test(n)){var r=(0,p.APU)("Invalid month, should be yyyymm.");return void s.setState({errorMessage:r})}}switch(e){case"month":t+="system-user-traffic/excel/?month="+n;break;case"storage":t+="system-user-storage/excel/?"}s.setState({errorMessage:""}),window.location.href=new URL(t)}else{var i=(0,p.APU)("It is required.");s.setState({errorMessage:i})}},s.state={month:C()().format("YYYYMM"),errorMessage:""},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state.errorMessage;return(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"statistic-reports",children:[(0,v.jsx)("div",{className:"statistic-reports-title",children:(0,p.APU)("Monthly User Traffic")}),(0,v.jsxs)("div",{className:"d-flex align-items-center mt-4",children:[(0,v.jsx)("span",{className:"statistic-reports-tip",children:(0,p.APU)("Month:")}),(0,v.jsx)(G.A,{className:"statistic-reports-input",defaultValue:C()().format("YYYYMM"),onChange:this.handleChange}),(0,v.jsx)(y.A,{className:"statistic-reports-submit operation-item",onClick:this.onGenerateReports.bind(this,"month"),children:(0,p.APU)("Create Report")})]}),e&&(0,v.jsx)("div",{className:"error",children:e})]}),(0,v.jsxs)("div",{className:"statistic-reports",children:[(0,v.jsx)("div",{className:"statistic-reports-title",children:(0,p.APU)("User Storage")}),(0,v.jsx)(y.A,{className:"mt-4 operation-item",onClick:this.onGenerateReports.bind(this,"storage"),children:(0,p.APU)("Create Report")})]})]})})}}])}(l.Component),te=s(36755),se=s(10467),ne=s(24591),re=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleTooltip=function(e){s.setState((function(t){return{tooltipOpen:t.tooltipOpen===e?null:e}}))},s.handleRowHover=function(e){s.setState({hoveredRow:e})},s.handleRowLeave=function(){s.setState({hoveredRow:null})},s.state={hoveredRow:null,tooltipOpen:null},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.componentName,n=t.metrics,r=this.state,i=r.hoveredRow,a=r.tooltipOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("tr",{className:"component-header",children:(0,v.jsx)("td",{colSpan:"4",children:(0,v.jsx)("div",{className:"component-title",children:(0,v.jsx)("span",{children:s})})})}),n.map((function(t){return t.data_points.map((function(s,n){var r="".concat(t.name,"-").concat(s.labels.node,"-").concat(n);return(0,v.jsxs)("tr",{className:"metric-row",children:[(0,v.jsx)("td",{onMouseEnter:function(){return e.handleRowHover(r)},onMouseLeave:e.handleRowLeave,children:(0,v.jsx)("div",{className:"metric-info",children:(0,v.jsxs)("div",{className:"metric-name",children:[t.name.substring(t.name.indexOf("_")+1),t.help&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("i",{className:"sf3-font-help sf3-font",id:r,"aria-hidden":"true",style:{visibility:i===r?"visible":"hidden"}}),(0,v.jsx)(ne.A,{placement:"right",isOpen:a===r&&i===r,toggle:function(){return e.toggleTooltip(r)},target:r,delay:{show:200,hide:0},fade:!0,className:"metric-tooltip",hideArrow:!0,children:t.help})]})]})})}),(0,v.jsx)("td",{children:s.labels.node}),(0,v.jsx)("td",{className:"metric-value",children:s.value}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"collected-time",children:C()(s.labels.collected_at).format("YYYY-MM-DD HH:mm:ss")})})]},r)}))}))]})}}])}(l.Component),ie=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).groupMetricsByComponent=function(e){var t={};return e.forEach((function(e){e.data_points&&e.data_points.length>0&&e.data_points.forEach((function(s){var r=s.labels.component||"Other";t[r]||(t[r]=[]);var i=t[r].find((function(t){return t.name===e.name}));i?i.data_points.push(s):t[r].push((0,n.default)((0,n.default)({},e),{},{data_points:[s]}))}))})),t},s.getMetrics=(0,se.default)((0,te.default)().mark((function e(){var t,n;return(0,te.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.setState({loading:!0}),e.prev=1,e.next=4,U.H.sysAdminStatisticMetrics();case 4:t=e.sent,n=s.groupMetricsByComponent(t.data.metrics),s.setState({metrics:t.data.metrics,groupedMetrics:n,loading:!1}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),s.setState({error:"Failed to get metric data",loading:!1});case 12:case"end":return e.stop()}}),e,null,[[1,9]])}))),s.state={metrics:[],loading:!0,error:null,groupedMetrics:{}},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getMetrics()}},{key:"render",value:function(){var e=this.state,t=e.groupedMetrics,s=e.loading,n=e.error;return(0,v.jsx)("div",{className:"cur-metrics-content",children:s?(0,v.jsx)("div",{className:"loading-icon loading-tip"}):n?(0,v.jsx)("div",{className:"error text-danger",children:n}):(0,v.jsx)("div",{className:"metrics-container",children:(0,v.jsx)("div",{className:"card",children:(0,v.jsx)("div",{className:"card-body",children:(0,v.jsxs)("table",{className:"table table-striped mb-0",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"40%",children:(0,p.APU)("Metrics")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Node")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Value")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Collected time")})]})}),(0,v.jsx)("tbody",{children:Object.entries(t).map((function(e){var t=(0,k.default)(e,2),s=t[0],n=t[1];return(0,v.jsx)(re,{componentName:s,metrics:n},s)}))})]})})})})})}}])}(l.Component);document.head.insertAdjacentHTML("beforeend","\n  <style>\n    .cur-metrics-content {\n      padding: 10px 16px;\n      border: none;\n    }\n\n    .cur-metrics-content .card {\n      margin-bottom: 20px;\n    }\n\n    .component-metrics-card .card-header {\n      background-color: #fff;\n      padding: 16px 20px;\n    }\n    \n    .metric-info {\n      display: flex;\n      flex-direction: column;\n    }\n    \n    .metric-name {\n      font-size: 14px;\n    }\n\n    .metrics-container {\n      padding: 0;\n    }\n    \n    .metrics-container .loading-tip {\n      margin: 100px auto;\n      text-align: center;\n    }\n\n    .card {\n      box-shadow: none;\n      border: none;\n    }\n\n    .card-body {\n      border: none;\n      padding: 0;\n    }\n\n    .component-header {\n      background-color: #fafafa !important;\n    }\n\n    .component-header td {\n      padding-top: 24px !important;\n      padding-bottom: 2px !important;\n      }\n\n    .component-title {\n      color: #212529;\n      font-size: 16px;\n      font-weight: 500;\n    }\n\n    .metric-row td {\n      padding: 0;\n      font-size: 14px;\n    }\n\n    .metrics-container .table {\n      margin-bottom: 0;\n      border: none;\n    }\n\n    .metrics-container .table td {\n      vertical-align: middle;\n      background-color: #fff;\n      border-bottom: 1px solid #e8e8e8;\n      padding-left: 8px;\n    }\n\n    .metrics-container .table th {\n      background-color: #fff;\n      border-bottom: 1px solid #e8e8e8;\n      color: #666;\n      font-size: 14px;\n    }\n\n    .sf3-font-help {\n      font-size: 14px;\n      color: #666;\n      margin-left: 4px;\n      opacity: 0.7;\n      transition: opacity 0.2s;\n\n    }\n  </style>\n");var ae=ie,oe=s(80045),le=s(80415),ce=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"fileStatistic",urlPart:"statistics/file",text:(0,p.APU)("File")},{name:"storageStatistic",urlPart:"statistics/storage",text:(0,p.APU)("Storage")},{name:"userStatistic",urlPart:"statistics/user",text:(0,p.APU)("Users")},{name:"trafficStatistic",urlPart:"statistics/traffic",text:(0,p.APU)("Traffic")},{name:"reportsStatistic",urlPart:"statistics/reports",text:(0,p.APU)("Reports")},{name:"metricsStatistic",urlPart:"statistics/metrics",text:(0,p.APU)("Metrics")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props.currentItem,s=this.navItems.findIndex((function(e){return e.name===t})),n=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),r=n[s],i=n.slice(0,s).reduce((function(e,t){return e+t}),0)+(2*s+1)*le.L2;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(r,"px"),"--indicator-offset":"".concat(i,"px")},children:this.navItems.map((function(s,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/").concat(s.urlPart,"/"),className:"m-0 nav-link".concat(t==s.name?" active":""),children:s.text})},n)}))})})}}])}(l.Component),de=["children"],ue=function(e){var t=e.children,s=(0,oe.default)(e,de),r=(0,h.zy)().pathname.split("/").filter(Boolean).pop(),i="".concat(r,"Statistic");return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},s)),(0,v.jsx)(ce,{currentItem:i}),t]})},he=s(39708),ge=s(79969),pe=s(46114),me=s(43226),fe=s(82487),xe=s(37609),ve=s.n(xe),Ae=s(43066),Pe=s(66149),je=s(61314),Se=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/user/").concat(encodeURIComponent(this.props.email),"/"),children:this.props.name})}}])}(l.Component),ye=Se,Ue=s(10877),De=s(91646),Ne=s(6754),be=s(20338),we=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleOptionChange=function(e){s.setState({keepSharing:"true"===e.target.value})},s.submit=function(){s.props.onSubmit(s.state.keepSharing),s.props.toggleDialog()},s.state={keepSharing:!0},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,v.jsx)(be.A,{toggle:this.props.toggleDialog,children:(0,p.APU)("Set user inactive")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(he.A,{children:(0,v.jsxs)(ge.A,{tag:"fieldset",children:[(0,v.jsx)("p",{children:(0,p.APU)("Do you want to keep the library sharing relationships?")}),(0,v.jsx)(ge.A,{check:!0,children:(0,v.jsxs)(De.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"radio",name:"keepSharing",value:"true",checked:!0===this.state.keepSharing,onChange:this.handleOptionChange,className:"mr-2"}),(0,p.APU)("Keep sharing")]})}),(0,v.jsx)(ge.A,{check:!0,children:(0,v.jsxs)(De.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"radio",name:"keepSharing",value:"false",checked:!1===this.state.keepSharing,onChange:this.handleOptionChange,className:"mr-2"}),(0,p.APU)("Do not keep sharing")]})})]})})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.submit,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Ie=window.sysadmin.pageOptions,ke=Ie.availableRoles,Me=Ie.availableAdminRoles,Ce=Ie.institutions;C().extend(ve());var Le=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.sortByQuotaUsage=function(e){e.preventDefault(),s.props.sortByQuotaUsage()},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.isAdmin,n=t.loading,r=t.errorMsg,i=t.items,a=t.isAllUsersSelected,o=t.curPerPage,c=t.hasNextPage,d=t.currentPage;if(n)return(0,v.jsx)(N.A,{});if(r)return(0,v.jsx)("p",{className:"error text-center mt-4",children:r});var u=[],h="".concat((0,p.APU)("Space Used")," / ").concat((0,p.APU)("Quota")),g="".concat((0,p.APU)("Name")," / ").concat((0,p.APU)("Contact Email")),m="".concat((0,p.APU)("Created At")," / ").concat((0,p.APU)("Last Login")," / ").concat((0,p.APU)("Last Access"));p.amr?u.push({width:"20%",text:g},{width:"15%",text:(0,p.APU)("Status")},{width:"15%",text:(0,p.APU)("Role")}):u.push({width:"30%",text:g},{width:"20%",text:(0,p.APU)("Status")}),p.Oq6&&!s?u.push({width:"14%",text:h},{width:"14%",text:(0,p.APU)("Institution")},{width:"14%",text:m},{width:"5%",text:""}):u.push({width:"20%",text:h},{width:"22%",text:m},{width:"5%",text:""});var f=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"3%",className:"pl-2",children:(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:this.props.toggleSelectAllUsers,checked:a})}),u.map((function(e,t){return(0,v.jsx)("th",{width:e.width,children:e.text},t)}))]})}),(0,v.jsx)("tbody",{children:i.map((function(t,s){return s<e.props.curPerPage?(0,v.jsx)(_e,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,toggleItemFreezed:e.toggleItemFreezed,updateUser:e.props.updateUser,deleteUser:e.props.deleteUser,updateAdminRole:e.props.updateAdminRole,revokeAdmin:e.props.revokeAdmin,onUserSelected:e.props.onUserSelected,isAdmin:e.props.isAdmin,isLDAPImported:e.props.isLDAPImported},s):null}))})]}),!this.props.isAdmin&&!this.props.isSearchResult&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:d,hasNextPage:c,curPerPage:o,resetPerPage:this.props.resetPerPage})]});return(0,v.jsx)("div",{children:i.length?f:(0,v.jsx)(Ae.A,{text:(0,p.APU)("No users")})})}}])}(l.Component),_e=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.toggleDeleteUserDialog=function(){s.setState({isDeleteUserDialogOpen:!s.state.isDeleteUserDialogOpen})},s.toggleResetUserPasswordDialog=function(){s.setState({isResetUserPasswordDialogOpen:!s.state.isResetUserPasswordDialogOpen})},s.toggleRevokeAdminDialog=function(){s.setState({isRevokeAdminDialogOpen:!s.state.isRevokeAdminDialogOpen})},s.toggleConfirmInactiveDialog=function(e){"active"!==(null===e||void 0===e?void 0:e.value)&&s.setState({isConfirmInactiveDialogOpen:!s.state.isConfirmInactiveDialogOpen})},s.onUserSelected=function(){s.props.onUserSelected(s.props.item)},s.updateStatus=function(e){var t="active"==e.value;t&&D.A.notify((0,p.APU)("It may take some time, please wait.")),s.props.updateUser(s.props.item.email,"is_active",t)},s.setUserInactive=function(e){s.props.updateUser(s.props.item.email,"is_active",!1,{keep_sharing:e}),s.toggleConfirmInactiveDialog()},s.updateRole=function(e){s.props.updateUser(s.props.item.email,"role",e.value)},s.updateAdminRole=function(e){s.props.updateAdminRole(s.props.item.email,e.value)},s.translateRole=function(e){switch(e){case"default":return(0,p.APU)("Default");case"guest":return(0,p.APU)("Guest");default:return e}},s.translateAdminRole=function(e){switch(e){case"default_admin":return(0,p.APU)("Default Admin");case"system_admin":return(0,p.APU)("System Admin");case"daily_admin":return(0,p.APU)("Daily Admin");case"audit_admin":return(0,p.APU)("Audit Admin");default:return e}},s.translateStatus=function(e){switch(e){case"active":return(0,p.APU)("Active");case"inactive":return(0,p.APU)("Inactive")}},s.updateInstitution=function(e){s.props.updateUser(s.props.item.email,"institution",e.value)},s.updateQuota=function(e){s.props.updateUser(s.props.item.email,"quota_total",e)},s.deleteUser=function(){D.A.notify((0,p.APU)("It may take some time, please wait.")),s.props.deleteUser(s.props.item.email,s.props.item.name)},s.resetPassword=function(){D.A.notify((0,p.APU)("It may take some time, please wait.")),U.H.sysAdminResetUserPassword(s.props.item.email).then((function(e){D.A.success(e.data.reset_tip)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.revokeAdmin=function(){var e=s.props.item;s.props.revokeAdmin(e.email,e.name)},s.getMenuOperations=function(){var e=s.props,t=e.isAdmin,n=e.isLDAPImported,r=e.isSearchResult,i=e.item,a=["Delete"];return(!n||r&&"db"==i.source)&&a.push("Reset Password"),t&&(a=["Revoke Admin"]),a},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.APU)("Delete");break;case"Reset Password":t=(0,p.APU)("Reset Password");break;case"Revoke Admin":t=(0,p.APU)("Revoke Admin")}return t},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteUserDialog();break;case"Reset Password":s.toggleResetUserPasswordDialog();break;case"Revoke Admin":s.toggleRevokeAdminDialog()}},s.state={isOpIconShown:!1,highlight:!1,isSetQuotaDialogOpen:!1,isDeleteUserDialogOpen:!1,isResetUserPasswordDialogOpen:!1,isRevokeAdminDialogOpen:!1,isConfirmInactiveDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.item,n=t.isAdmin,r=this.state,i=r.highlight,a=r.isOpIconShown,o=r.isSetQuotaDialogOpen,c=r.isDeleteUserDialogOpen,d=r.isResetUserPasswordDialogOpen,u=r.isRevokeAdminDialogOpen,g=r.isConfirmInactiveDialogOpen,f='<span class="op-target">'+m.Aq.HTMLescape(s.name)+"</span>",x=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",f),A=(0,p.APU)("Are you sure you want to reset the password of {placeholder} ?").replace("{placeholder}",f),P=(0,p.APU)("Are you sure you want to revoke the admin permission of {placeholder} ?").replace("{placeholder}",f),j=s.is_active?"active":"inactive";this.statusOptions=["active","inactive"].map((function(t){return{value:t,text:e.translateStatus(t),isSelected:t==j}}));var S,y,U,D=this.statusOptions.filter((function(e){return e.isSelected}))[0];if(n){var N=s.admin_role;this.adminRoleOptions=Me.map((function(t){return{value:t,text:e.translateAdminRole(t),isSelected:t==N}})),S=this.adminRoleOptions.filter((function(e){return e.isSelected}))[0]}else{var b=s.role;this.roleOptions=ke.map((function(t){return{value:t,text:e.translateRole(t),isSelected:t==b}})),y=this.roleOptions.filter((function(e){return e.isSelected}))[0]||{value:b,text:this.translateRole(b),isSelected:!0}}if(p.Oq6&&!n){var w=s.institution;this.instOptions=Ce.map((function(e){return{value:e,text:e,isSelected:e==w}})),U=this.instOptions.filter((function(e){return e.isSelected}))[0]}return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{className:"pl-2",children:(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:this.onUserSelected,checked:s.isSelected})}),(0,v.jsxs)("td",{children:[(0,v.jsx)(ye,{email:s.email,name:s.name}),s.contact_email&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("br",{}),s.contact_email]}),s.org_id&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("br",{}),(0,v.jsxs)(h.N_,{to:"".concat(p.YcY,"sys/organizations/").concat(s.org_id,"/info/"),children:["(",s.org_name,")"]})]})]}),(0,v.jsx)("td",{children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:i,currentSelectedOption:D,options:this.statusOptions,selectOption:this.updateStatus,toggleItemFreezed:this.props.toggleItemFreezed,operationBeforeSelect:s.is_active?this.toggleConfirmInactiveDialog:void 0})}),p.amr&&(0,v.jsx)("td",{children:n?(0,v.jsx)(Pe.A,{isDropdownToggleShown:i,currentSelectedOption:S,options:this.adminRoleOptions,selectOption:this.updateAdminRole,toggleItemFreezed:this.props.toggleItemFreezed}):(0,v.jsx)(Pe.A,{isDropdownToggleShown:i,currentSelectedOption:y,options:this.roleOptions,selectOption:this.updateRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsxs)("td",{children:["".concat(m.Aq.bytesToSize(s.quota_usage)," / ").concat(s.quota_total>0?m.Aq.bytesToSize(s.quota_total):"--"),(0,v.jsx)("i",{title:(0,p.APU)("Edit"),className:"sf3-font sf3-font-rename op-icon ml-1 ".concat(a?"":"invisible"),onClick:this.toggleSetQuotaDialog})]}),p.Oq6&&!n&&(0,v.jsx)("td",{children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:i&&Ce.length>0,currentSelectedOption:U,options:this.instOptions,selectOption:this.updateInstitution,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsxs)("td",{children:["".concat(s.create_time?C()(s.create_time).format("YYYY-MM-DD HH:mm"):"--"," /"),(0,v.jsx)("br",{}),"".concat(s.last_login?C()(s.last_login).fromNow():"--"),(0,v.jsx)("br",{}),"".concat(s.last_access_time?C()(s.last_access_time).fromNow():"--")]}),(0,v.jsx)("td",{children:s.email!=p.Xh_&&a&&(0,v.jsx)(je.A,{operations:this.getMenuOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),o&&(0,v.jsx)(me.A,{toggle:this.toggleSetQuotaDialog,updateQuota:this.updateQuota}),c&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete User"),message:x,executeOperation:this.deleteUser,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteUserDialog}),d&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Reset Password"),message:A,executeOperation:this.resetPassword,confirmBtnText:(0,p.APU)("Reset"),toggleDialog:this.toggleResetUserPasswordDialog}),u&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Revoke Admin"),message:P,executeOperation:this.revokeAdmin,confirmBtnText:(0,p.APU)("Revoke"),toggleDialog:this.toggleRevokeAdminDialog}),g&&(0,v.jsx)(we,{toggleDialog:this.toggleConfirmInactiveDialog,onSubmit:this.setUserInactive})]})}}])}(l.Component),Oe=Le,Re=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleBatchSetQuotaDialog=function(){s.setState({isBatchSetQuotaDialogOpen:!s.state.isBatchSetQuotaDialogOpen})},s.toggleBatchDeleteUserDialog=function(){s.setState({isBatchDeleteUserDialogOpen:!s.state.isBatchDeleteUserDialogOpen})},s.onUserSelected=function(e){var t=!1,n=[],r=s.state.userList.map((function(s){return s.email===e.email&&(s.isSelected=!s.isSelected),1==s.isSelected?(t=!0,n.push(s)):n=n.filter((function(e){return e.email!=s.email})),s}));s.setState({userList:r,hasUserSelected:t,selectedUserList:n})},s.toggleSelectAllUsers=function(){if(s.state.isAllUsersSelected){var e=s.state.userList.map((function(e){return e.isSelected=!1,e}));s.setState({userList:e,hasUserSelected:!1,isAllUsersSelected:!1,selectedUserList:[]})}else{var t=s.state.userList.map((function(e){return e.isSelected=!0,e}));s.setState({userList:t,hasUserSelected:!0,isAllUsersSelected:!0,selectedUserList:t})}},s.getItems=function(e){U.H.sysAdminSearchUsers(s.state.query.trim(),e,s.state.perPage).then((function(e){s.setState({userList:e.data.user_list,loading:!1,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getItems(1)}))},s.deleteUser=function(e,t){U.H.sysAdminDeleteUser(e).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r});var i=(0,p.APU)("Deleted user %s");i=i.replace("%s",t),D.A.success(i)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.setUserQuotaInBatch=function(e){var t=s.state.selectedUserList.map((function(e){return e.email}));U.H.sysAdminSetUserQuotaInBatch(t,e).then((function(e){var t=s.state.userList.map((function(t){return e.data.success.forEach((function(e){t.email==e.email&&(t.quota_total=e.quota_total)})),t}));s.setState({userList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteUserInBatch=function(){var e=s.state.selectedUserList.map((function(e){return e.email}));U.H.sysAdminDeleteUserInBatch(e).then((function(t){if(t.data.success.length){var n=s.state.userList.filter((function(e){return!t.data.success.some((function(t){return t.email==e.email}))}));s.setState({userList:n,hasUserSelected:e.length!=t.data.success.length});var r=t.data.success.length,i=1==r?(0,p.APU)("Successfully deleted 1 user."):(0,p.APU)("Successfully deleted {user_number_placeholder} users.").replace("{user_number_placeholder}",r);D.A.success(i)}t.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);D.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateUser=function(e,t,n,r){U.H.sysAdminUpdateUser(e,t,n,r).then((function(r){var i=s.state.userList.map((function(s){return s.email==e&&(s[t]=r.data[t]),s}));s.setState({userList:i});var a="is_active"==t&&n?r.data.update_status_tip:(0,p.APU)("Edit succeeded");D.A.success(a)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateAdminRole=function(e,t){U.H.sysAdminUpdateAdminRole(e,t).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.admin_role=t.data.role),s}));s.setState({userList:n}),D.A.success((0,p.APU)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.revokeAdmin=function(e,t){U.H.sysAdminUpdateUser(e,"is_staff",!1).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r}),D.A.success((0,p.APU)("Successfully revoked the admin permission of {placeholder}.").replace("{placeholder}",t))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.handleInputChange=function(e){s.setState({query:e.target.value},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.query;s.setState({isSubmitBtnActive:e.trim()})},s.getPreviousPageList=function(){s.getItems(s.state.pageInfo.current_page-1)},s.getNextPageList=function(){s.getItems(s.state.pageInfo.current_page+1)},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.getItems(1))},s.state={query:"",isSubmitBtnActive:!1,loading:!0,errorMsg:"",userList:[],pageInfo:{has_next_page:!1,current_page:1},currentPage:1,perPage:100,hasUserSelected:!1,selectedUserList:[],isAllUsersSelected:!1,isBatchSetQuotaDialogOpen:!1,isBatchDeleteUserDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(document.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({query:t.get("query")||"",currentPage:parseInt(t.get("page")||n),perPage:parseInt(t.get("per_page")||r)},(function(){e.getItems(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.query,r=t.isSubmitBtnActive,i=this.state,a=i.hasUserSelected,o=i.isBatchDeleteUserDialogOpen,c=i.isBatchSetQuotaDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[a?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleBatchSetQuotaDialog,children:(0,p.APU)("Set Quota")}),(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleBatchDeleteUserDialog,children:(0,p.APU)("Delete Users")})]})})):(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Users")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Search Users")}),(0,v.jsxs)(he.A,{tag:"div",children:[(0,v.jsx)(ge.A,{row:!0,children:(0,v.jsx)(pe.A,{sm:5,children:(0,v.jsx)(G.A,{type:"text",name:"query",value:s,placeholder:(0,p.APU)("Search users"),onChange:this.handleInputChange,onKeyDown:this.handleKeyDown})})}),(0,v.jsx)(ge.A,{row:!0,children:(0,v.jsx)(pe.A,{sm:{size:5},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!r,onClick:function(){return e.getItems(1)},children:(0,p.APU)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Result")}),(0,v.jsx)(Oe,{isLDAPImported:!1,isAdmin:!1,isSearchResult:!0,loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,curPerPage:this.state.perPage,updateUser:this.updateUser,deleteUser:this.deleteUser,updateAdminRole:this.updateAdminRole,revokeAdmin:this.revokeAdmin,onUserSelected:this.onUserSelected,isAllUsersSelected:this.isAllUsersSelected,toggleSelectAllUsers:this.toggleSelectAllUsers})]})]})]})}),c&&(0,v.jsx)(me.A,{toggle:this.toggleBatchSetQuotaDialog,updateQuota:this.setUserQuotaInBatch}),o&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Users"),message:(0,p.APU)("Are you sure you want to delete the selected user(s) ?"),executeOperation:this.deleteUserInBatch,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleBatchDeleteUserDialog}),this.state.pageInfo&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:this.state.pageInfo.current_page,hasNextPage:this.state.pageInfo.has_next_page,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage})]})}}])}(l.Component),Te=Re,Fe=s(60096),Ee=s(35077),Be=s(3898),ze=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleRateLimitChange=function(e){var t=e.target.value;s.setState({rateLimit:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateUploadDownloadRateLimit(s.props.uploadOrDownload,s.state.rateLimit.trim()),s.toggle()},s.state={rateLimit:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.rateLimit,s=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:"upload"==this.props.uploadOrDownload?(0,p.APU)("Set Upload Rate Limit"):(0,p.APU)("Set Download Rate Limit")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(he.A,{children:(0,v.jsxs)(ge.A,{children:[(0,v.jsxs)(Ee.A,{children:[(0,v.jsx)(G.A,{type:"text",className:"form-control",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleRateLimitChange}),(0,v.jsx)(Be.A,{children:"kB/s"})]}),(0,v.jsxs)("p",{className:"small text-secondary mt-2 mb-2",children:[(0,p.APU)("An integer that is greater than or equal to 0."),(0,v.jsx)("br",{}),(0,p.APU)("Tip: 0 means default limit")]})]})})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Ye=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleInputChange=function(e){var t=e.target.value;s.setState({value:t})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateValue(s.state.value.trim()),s.props.toggleDialog()},s.state={value:s.props.value,isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.toggleDialog;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:e,children:[(0,v.jsx)(be.A,{toggle:e,children:this.props.dialogTitle}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(he.A,{children:(0,v.jsx)(ge.A,{children:(0,v.jsx)(G.A,{type:"text",value:this.state.value,onKeyDown:this.handleKeyDown,onChange:this.handleInputChange})})})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:e,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),He=s(72249),qe=s(3866),Ge=window.sysadmin.pageOptions,Qe=Ge.twoFactorAuthEnabled,Ve=Ge.availableRoles,We=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.toggleSetUserUploadRateLimitDialog=function(){s.setState({isSetUserUploadRateLimitDialogOpen:!s.state.isSetUserUploadRateLimitDialogOpen})},s.toggleSetUserDownloadRateLimitDialog=function(){s.setState({isSetUserDownloadRateLimitDialogOpen:!s.state.isSetUserDownloadRateLimitDialogOpen})},s.updateQuota=function(e){s.props.updateUser("quota_total",e)},s.updateUploadDownloadRateLimit=function(e,t){"upload"==e&&s.props.updateUser("upload_rate_limit",t),"download"==e&&s.props.updateUser("download_rate_limit",t)},s.toggleDialog=function(e,t){s.setState({currentKey:e,dialogTitle:t,isUpdateUserDialogOpen:!s.state.isUpdateUserDialogOpen})},s.toggleSetNameDialog=function(){s.toggleDialog("name",(0,p.APU)("Set Name"))},s.toggleSetUserLoginIDDialog=function(){s.toggleDialog("login_id",(0,p.APU)("Set Login ID"))},s.toggleSetUserContactEmailDialog=function(){s.toggleDialog("contact_email",(0,p.APU)("Set Contact Email"))},s.updateValue=function(e){s.props.updateUser(s.state.currentKey,e)},s.toggleUpdateUserDialog=function(){s.toggleDialog("","")},s.state={currentKey:"",dialogTitle:"",isSetQuotaDialogOpen:!1,isSetUserUploadRateLimitDialogOpen:!1,isSetUserDownloadRateLimitDialogOpen:!1,isUpdateUserDialogOpen:!1,highlight:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=this.state.highlight;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center mt-4",children:s});var r=this.props.userInfo,i=this.state,a=i.currentKey,o=i.dialogTitle,l=i.isSetQuotaDialogOpen,c=i.isUpdateUserDialogOpen,d=i.isSetUserUploadRateLimitDialogOpen,u=i.isSetUserDownloadRateLimitDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("dl",{className:"m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Avatar")}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsx)("img",{src:r.avatar_url,alt:r.name,width:"80",className:"rounded"})}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Email")}),(0,v.jsx)("dd",{className:"info-item-content",children:r.email}),r.org_name&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Organization")}),(0,v.jsx)("dd",{className:"info-item-content",children:r.org_name})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Name")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.name||"--",(0,v.jsx)(Fe.A,{onClick:this.toggleSetNameDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Login ID")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.login_id||"--",(0,v.jsx)(Fe.A,{onClick:this.toggleSetUserLoginIDDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Contact Email")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.contact_email||"--",(0,v.jsx)(Fe.A,{onClick:this.toggleSetUserContactEmailDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Role")}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:n,currentSelectedOption:this.props.currentSelectedRoleOption,options:this.props.roleOptions,selectOption:this.props.updateRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Space Used / Quota")}),(0,v.jsxs)("dd",{className:"info-item-content",children:["".concat(m.Aq.bytesToSize(r.quota_usage)," / ").concat(r.quota_total>0?m.Aq.bytesToSize(r.quota_total):"--"),(0,v.jsx)(Fe.A,{onClick:this.toggleSetQuotaDialog})]}),p.amr&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Upload Rate Limit")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.upload_rate_limit>0?r.upload_rate_limit+" kB/s":"--",(0,v.jsx)(Fe.A,{onClick:this.toggleSetUserUploadRateLimitDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Download Rate Limit")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.download_rate_limit>0?r.download_rate_limit+" kB/s":"--",(0,v.jsx)(Fe.A,{onClick:this.toggleSetUserDownloadRateLimitDialog})]})]}),Qe&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Two-Factor Authentication")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.has_default_device?(0,v.jsxs)(ge.A,{children:[(0,v.jsx)("p",{className:"mb-1",children:(0,p.APU)("Status: enabled")}),(0,v.jsx)(y.A,{onClick:this.props.disable2FA,children:(0,p.APU)("Disable Two-Factor Authentication")})]}):(0,v.jsx)(ge.A,{children:(0,v.jsx)(y.A,{disabled:!0,children:(0,p.APU)("Disable Two-Factor Authentication")})}),(0,v.jsx)(ge.A,{check:!0,children:(0,v.jsxs)(De.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"checkbox",checked:r.is_force_2fa,onChange:this.props.toggleForce2fa}),(0,v.jsx)("span",{children:(0,p.APU)("Force Two-Factor Authentication")})]})})]})]})]}),l&&(0,v.jsx)(me.A,{updateQuota:this.updateQuota,toggle:this.toggleSetQuotaDialog}),p.amr&&d&&(0,v.jsx)(ze,{uploadOrDownload:"upload",updateUploadDownloadRateLimit:this.updateUploadDownloadRateLimit,toggle:this.toggleSetUserUploadRateLimitDialog}),p.amr&&u&&(0,v.jsx)(ze,{uploadOrDownload:"download",updateUploadDownloadRateLimit:this.updateUploadDownloadRateLimit,toggle:this.toggleSetUserDownloadRateLimitDialog}),c&&(0,v.jsx)(Ye,{dialogTitle:o,value:r[a],updateValue:this.updateValue,toggleDialog:this.toggleUpdateUserDialog})]})}}])}(l.Component),Ke=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).updateUser=function(e,t){var n=s.state.userInfo.email;U.H.sysAdminUpdateUser(n,e,t).then((function(t){var n=s.state.userInfo;n[e]=t.data[e],s.setState({userInfo:n}),He.B.dispatch(qe.T.SYNC_USERNAME,t.data.name),D.A.success((0,p.APU)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateRole=function(e){s.updateUser("role",e.value)},s.disable2FA=function(){var e=s.state.userInfo.email;U.H.sysAdminDeleteTwoFactorAuth(e).then((function(e){var t=s.state.userInfo;t.has_default_device=!1,s.setState({userInfo:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.toggleForce2fa=function(e){var t=s.state.userInfo.email,n=e.target.checked;U.H.sysAdminSetForceTwoFactorAuth(t,n).then((function(e){var t=s.state.userInfo;t.is_force_2fa=n,s.setState({userInfo:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.translateRole=function(e){switch(e){case"default":return(0,p.APU)("Default");case"guest":return(0,p.APU)("Guest");default:return e}},s.state={loading:!0,errorMsg:"",userInfo:{}},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);U.H.sysAdminGetUser(t).then((function(t){e.setState({loading:!1,userInfo:t.data}),He.B.dispatch(qe.T.SYNC_USERNAME,t.data.name)})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e,t=this,s=this.state.userInfo.role;return this.roleOptions=Ve.map((function(e){return{value:e,text:t.translateRole(e),isSelected:e==s}})),e=this.roleOptions.filter((function(e){return e.isSelected}))[0]||{value:s,text:this.translateRole(s),isSelected:!0},(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(We,{loading:this.state.loading,errorMsg:this.state.errorMsg,userInfo:this.state.userInfo,roleOptions:this.roleOptions,currentSelectedRoleOption:e,updateRole:this.updateRole,updateUser:this.updateUser,disable2FA:this.disable2FA,toggleForce2fa:this.toggleForce2fa})})})})})}}])}(l.Component),Xe=s(40898),$e=window.sysadmin.pageOptions.enableSysAdminViewRepo;C().extend(ve());var Je=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No libraries")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Size")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Last Update")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Ze,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteRepo:e.props.deleteRepo,transferRepo:e.props.transferRepo},s)}))})]})});return r.length?a:i}}])}(l.Component),Ze=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleDeleteDialog=function(){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteRepo=function(){s.props.deleteRepo(s.props.item.id)},s.toggleTransferDialog=function(){s.setState({isTransferDialogOpen:!s.state.isTransferDialogOpen})},s.transferRepo=function(e,t){s.props.transferRepo(s.props.item.id,e,t)},s.renderRepoName=function(){var e=s.props.item;return e.name?p.amr&&$e&&!e.encrypted?(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/libraries/").concat(e.id,"/"),children:e.name}):e.name:(0,p.APU)("Broken ({repo_id_placeholder})").replace("{repo_id_placeholder}",e.id)},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.APU)("Delete");break;case"Transfer":t=(0,p.APU)("Transfer")}return t},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteDialog();break;case"Transfer":s.toggleTransferDialog()}},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1,isTransferDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isTransferDialogOpen,i=m.Aq.getLibIconUrl(e),a=m.Aq.getLibIconTitle(e),o='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",c=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:i,title:a,alt:a,width:"24"})}),(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{children:C()(e.last_modified).fromNow()}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(je.A,{operations:["Delete","Transfer"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Library"),message:c,executeOperation:this.deleteRepo,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteDialog}),r&&(0,v.jsx)(Xe.A,{itemName:e.name,onTransferRepo:this.transferRepo,canTransferToDept:!1,toggleDialog:this.toggleTransferDialog})]})}}])}(l.Component),et=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).deleteRepo=function(e){U.H.sysAdminDeleteRepo(e).then((function(t){var n=s.state.repoList.filter((function(t){return t.id!=e}));s.setState({repoList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.transferRepo=function(e,t,n){U.H.sysAdminTransferRepo(e,t,n).then((function(t){var n=s.state.repoList.filter((function(t){return t.id!=e}));s.setState({repoList:n});var r=(0,p.APU)("Successfully transferred the library.");D.A.success(r)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",userInfo:{},repoList:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);U.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),U.H.sysAdminListReposByOwner(t).then((function(t){e.setState({loading:!1,repoList:t.data.repos})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsx)(l.Fragment,{children:(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Je,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList,deleteRepo:this.deleteRepo,transferRepo:this.transferRepo})})})})})}}])}(l.Component),tt=s(48738),st=s.n(tt),nt=window.sysadmin.pageOptions.enableSysAdminViewRepo;C().extend(ve());var rt=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center mt-4",children:s});var r=(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Share From")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Size")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Last Update")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(it,{item:e},t)}))})]});return n.length?r:(0,v.jsx)(Ae.A,{text:(0,p.APU)("No libraries")})}}])}(l.Component),it=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1})},s.renderRepoName=function(){var e=s.props.item;return e.name?p.amr&&nt&&!e.encrypted?(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/libraries/").concat(e.id,"/"),children:e.name}):e.name:(0,p.APU)("Broken ({repo_id_placeholder})").replace("{repo_id_placeholder}",e.id)},s.getOwnerLink=function(){var e,t=s.props.item,n=t.owner_email.indexOf("@seafile_group");if(-1==n)e=(0,v.jsx)(ye,{email:t.owner_email,name:t.owner_name});else{var r=t.owner_email.substring(0,n);e=(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/groups/").concat(r,"/libraries/"),children:t.owner_name})}return e},s.state={isHighlighted:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=m.Aq.getLibIconUrl(e),s=m.Aq.getLibIconTitle(e),n=this.state.isHighlighted;return(0,v.jsxs)("tr",{className:st()({"tr-highlight":n}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:t,title:s,alt:s,width:"24"})}),(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:this.getOwnerLink()}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{children:C()(e.last_modify).fromNow()})]})}}])}(l.Component),at=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).state={loading:!0,errorMsg:"",userInfo:{},repoList:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);U.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),U.H.sysAdminListShareInRepos(t).then((function(t){e.setState({loading:!1,repoList:t.data.repo_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(rt,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList})})})})})}}])}(l.Component),ot=at,lt=s(91611),ct=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No shared links")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Size")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Type")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Visits")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(dt,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteItem:e.props.deleteItem},s)}))})]})});return r.length?a:i}}])}(l.Component),dt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleLinkDialog=function(){s.setState({isLinkDialogOpen:!s.state.isLinkDialogOpen})},s.deleteItem=function(){s.props.deleteItem(s.props.item)},s.translateOperations=function(e){var t="";switch(e){case"View":t=(0,p.APU)("View");break;case"Delete":t=(0,p.APU)("Delete")}return t},s.onMenuItemClick=function(e){switch(e){case"View":s.toggleLinkDialog();break;case"Delete":s.deleteItem()}},s.getRoleText=function(){var e;switch(s.props.item.role){case"Owner":e=(0,p.APU)("Owner");break;case"Admin":e=(0,p.APU)("Admin");break;case"Member":e=(0,p.APU)("Member")}return e},s.getIconUrl=function(){var e=s.props.item;return"upload"==e.type||e.is_dir?m.Aq.getFolderIconUrl():m.Aq.getFileIconUrl(e.obj_name)},s.state={isOpIconShown:!1,highlight:!1,isLinkDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isLinkDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:this.getIconUrl(),alt:"",width:"24"})}),(0,v.jsx)("td",{children:"/"==e.obj_name?e.repo_name:e.obj_name}),"upload"==e.type?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("td",{}),(0,v.jsx)("td",{children:(0,p.APU)("Upload")})]}):(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("td",{children:e.is_dir?null:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{children:(0,p.APU)("Download")})]}),(0,v.jsx)("td",{children:e.view_cnt}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(je.A,{operations:["View","Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(lt.A,{link:e.link,toggleDialog:this.toggleLinkDialog})]})}}])}(l.Component),ut=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).deleteItem=function(e){var t=e.type,n=e.token;"download"==t?U.H.sysAdminDeleteShareLink(n).then((function(e){var t=s.state.shareLinkItems.filter((function(e){return e.token!=n}));s.setState({shareLinkItems:t}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)})):U.H.sysAdminDeleteUploadLink(n).then((function(e){var t=s.state.uploadLinkItems.filter((function(e){return e.token!=n}));s.setState({uploadLinkItems:t}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",userInfo:{},uploadLinkItems:[],shareLinkItems:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);U.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),U.H.sysAdminListShareLinksByUser(t).then((function(t){var s=t.data.share_link_list.map((function(e){return e.type="download",e}));s.sort((function(e,t){return e.is_dir?-1:1})),e.setState({loading:!1,shareLinkItems:s})})),U.H.sysAdminListUploadLinksByUser(t).then((function(t){var s=t.data.upload_link_list.map((function(e){return e.type="upload",e}));e.setState({loading:!1,uploadLinkItems:s})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.shareLinkItems,s=e.uploadLinkItems;return(0,v.jsx)(l.Fragment,{children:(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ct,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:[].concat(s,t),deleteItem:this.deleteItem})})})})})}}])}(l.Component),ht=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No groups")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Role")}),(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Created At")})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(gt,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem},s)}))})]})});return r.length?a:i}}])}(l.Component),gt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.getRoleText=function(){var e;switch(s.props.item.role){case"Owner":e=(0,p.APU)("Owner");break;case"Admin":e=(0,p.APU)("Admin");break;case"Member":e=(0,p.APU)("Member")}return e},s.state={highlight:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t="".concat(p.YcY,"sys/groups/").concat(e.id,"/libraries/");return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:t,children:e.name})}),(0,v.jsx)("td",{children:this.getRoleText()}),(0,v.jsx)("td",{children:C()(e.created_at).format("YYYY-MM-DD HH:mm")})]})})}}])}(l.Component),pt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).state={loading:!0,errorMsg:"",userInfo:{},items:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);U.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),U.H.sysAdminListGroupsJoinedByUser(t).then((function(t){e.setState({loading:!1,items:t.data.group_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsx)(l.Fragment,{children:(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ht,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.items})})})})})}}])}(l.Component),mt=s(20454),ft=s(72070),xt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onSelectSortOption=function(e){var t=e.value.split("-"),n=(0,k.default)(t,2),r=n[0],i=n[1];s.props.sortItems(r,i)},s.navItems=[{name:"database",urlPart:"users",text:(0,p.APU)("Database")}],p.eB6&&s.navItems.push({name:"ldap",urlPart:"users/ldap",text:(0,p.APU)("LDAP")},{name:"ldap-imported",urlPart:"users/ldap-imported",text:(0,p.APU)("LDAP(imported)")}),p.P95&&s.navItems.push({name:"admin",urlPart:"users/admins",text:(0,p.APU)("Admin")}),s.sortOptions=[{value:"quota_usage-asc",text:(0,p.APU)("Ascending by space used")},{value:"quota_usage-desc",text:(0,p.APU)("Descending by space used")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props,s=t.currentItem,n=t.sortBy,r=t.sortOrder,i="database"==s||"ldap-imported"==s,a=this.navItems.findIndex((function(e){return e.name===s}))||0,o=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),l=o[a],c=o.slice(0,a).reduce((function(e,t){return e+t}),0)+(2*a+1)*le.L2;return(0,v.jsxs)("div",{className:"cur-view-path tab-nav-container",children:[(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(l,"px"),"--indicator-offset":"".concat(c,"px")},children:this.navItems.map((function(t,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/").concat(t.urlPart,"/"),className:"m-0 nav-link".concat(s==t.name?" active":""),children:t.text})},n)}))}),i&&(0,v.jsx)(ft.A,{sortBy:n,sortOrder:r,sortOptions:this.sortOptions,onSelectSortOption:this.onSelectSortOption})]})}}])}(l.Component),vt=xt,At=s(46882),Pt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.openFileInput=function(){s.fileInputRef.current.click()},s.uploadFile=function(e){if(s.fileInputRef.current.files.length){var t=s.fileInputRef.current.files[0].name;if("xlsx"==t.substr(t.lastIndexOf(".")+1)){var n=s.fileInputRef.current.files[0];s.props.importUserInBatch(n),s.toggle()}else s.setState({errorMsg:(0,p.APU)("Please choose a .xlsx file.")})}},s.state={errorMsg:""},s.fileInputRef=l.createRef(),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state.errorMsg;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("Import users from a .xlsx file")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsx)("p",{children:(0,v.jsx)("a",{className:"text-secondary small",href:"".concat(p.YcY,"useradmin/batchadduser/example/"),children:(0,p.APU)("Download an example file")})}),(0,v.jsx)("button",{className:"btn btn-outline-primary",onClick:this.openFileInput,children:(0,p.APU)("Upload file")}),(0,v.jsx)("input",{className:"d-none",type:"file",onChange:this.uploadFile,ref:this.fileInputRef}),e&&(0,v.jsx)(At.A,{color:"danger",children:e})]}),(0,v.jsx)(Ne.A,{children:(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")})})]})}}])}(l.Component),jt=s(98702),St=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).translateRoles=function(e){switch(e){case"default":return(0,p.APU)("Default");case"guest":return(0,p.APU)("Guest");default:return e}},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)(jt.A,{isTextMode:this.props.isTextMode,isEditIconShow:this.props.isEditIconShow,options:this.props.roleOptions,currentOption:this.props.currentRole,onOptionChanged:this.props.onRoleChanged,translateOption:this.translateRoles})}}])}(l.Component),yt=St,Ut=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).checkSubmitBtnActive=function(){var e=s.state,t=e.email,n=e.password,r=e.passwordAgain,i=!0;i=!!(t.trim()&&n.trim()&&r.trim()),s.setState({isSubmitBtnActive:i})},s.toggle=function(){s.props.toggleDialog()},s.togglePasswordVisible=function(){s.setState({isPasswordVisible:!s.state.isPasswordVisible})},s.inputPassword=function(e){var t=e.target.value;s.setState({password:t,errorMsg:""},s.checkSubmitBtnActive)},s.inputPasswordAgain=function(e){var t=e.target.value;s.setState({passwordAgain:t,errorMsg:""},s.checkSubmitBtnActive)},s.generatePassword=function(){var e=m.Aq.generatePassword(8);s.setState({password:e,passwordAgain:e},s.checkSubmitBtnActive)},s.inputEmail=function(e){var t=e.target.value;s.setState({email:t},s.checkSubmitBtnActive)},s.inputName=function(e){var t=e.target.value;s.setState({name:t})},s.updateRole=function(e){s.setState({role:e})},s.handleSubmit=function(){var e=s.state,t=e.email,n=e.password,r=e.passwordAgain,i=e.name,a=e.role;if(n==r){var o={email:t.trim(),name:i.trim(),password:n.trim()};s.props.showRole&&(o.role=a),s.props.addUser(o),s.toggle()}else s.setState({errorMsg:(0,p.APU)("Passwords do not match.")})},s.state={errorMsg:"",isPasswordVisible:!1,password:"",passwordAgain:"",email:"",name:"",role:"default",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.dialogTitle,s=e.showRole,n=this.state,r=n.errorMsg,i=n.isPasswordVisible,a=n.email,o=n.name,l=n.role,c=n.password,d=n.passwordAgain,h=n.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:t||(0,p.APU)("Add Member")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsxs)(he.A,{autoComplete:"off",children:[(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Email")}),(0,v.jsx)(G.A,{value:a,onChange:this.inputEmail})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Name(optional)")}),(0,v.jsx)(G.A,{type:"text",value:o,onChange:this.inputName})]}),s&&(0,v.jsxs)(ge.A,{children:[(0,v.jsxs)(De.A,{children:[(0,p.APU)("Role"),(0,v.jsx)("span",{className:"small text-secondary ml-1 sf3-font sf3-font-tips",title:(0,p.APU)("You can also add a user as a guest, who will not be allowed to create libraries and groups.")})]}),(0,v.jsx)(yt,{isTextMode:!1,isEditIconShow:!1,currentRole:l,roleOptions:this.props.availableRoles,onRoleChanged:this.updateRole})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Password")}),(0,v.jsxs)(Ee.A,{children:[(0,v.jsx)(G.A,{autoComplete:"new-password",type:i?"text":"password",value:c||"",onChange:this.inputPassword}),(0,v.jsx)(y.A,{className:"mt-0",onClick:this.togglePasswordVisible,children:(0,v.jsx)("i",{className:"link-operation-icon sf3-font sf3-font-eye".concat(this.state.isPasswordVisible?"":"-slash")})}),(0,v.jsx)(y.A,{className:"mt-0",onClick:this.generatePassword,children:(0,v.jsx)("i",{className:"link-operation-icon sf3-font sf3-font-magic"})})]})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Password again")}),(0,v.jsx)(G.A,{type:i?"text":"password",value:d||"",onChange:this.inputPasswordAgain})]})]}),r&&(0,v.jsx)(At.A,{color:"danger",children:r})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!h,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Dt=s(98361),Nt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleSelectChange=function(e){s.setState({selectedUsers:e,isSubmitBtnActive:e.length>0})},s.handleSubmit=function(){s.props.addAdminInBatch(s.state.selectedUsers.map((function(e){return e.email}))),s.toggle()},s.state={selectedUsers:[],isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("Add Admin")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(Dt.A,{isMulti:!0,placeholder:(0,p.APU)("Search users"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),bt=(0,i.default)((function e(t){(0,r.default)(this,e),this.email=t.email,this.name=t.name,this.contact_email=t.contact_email,this.login_id=t.login_id,this.last_login=t.last_login,this.last_access_time=t.last_access_time,this.create_time=t.create_time,this.is_active=t.is_active,this.is_staff=t.is_staff,this.department=t.department,this.quota_total=t.quota_total,this.quota_usage=t.quota_usage,this.role=t.role,this.institution=t.institution,t.org_id&&(this.org_id=t.org_id),t.org_name&&(this.org_name=t.org_name),this.isSelected=!1})),wt=(0,i.default)((function e(t){(0,r.default)(this,e),this.email=t.email,this.name=t.name,this.contact_email=t.contact_email,this.login_id=t.login_id,this.last_login=t.last_login,this.last_access_time=t.last_access_time,this.create_time=t.create_time,this.is_active=t.is_active,this.is_staff=t.is_staff,this.quota_total=t.quota_total,this.quota_usage=t.quota_usage,this.admin_role=t.admin_role,this.isSelected=!1})),It=window.sysadmin.pageOptions.availableRoles,kt=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).translateRole=function(e){switch(e){case"":return(0,p.APU)("All");case"default":return(0,p.APU)("Default");case"guest":return(0,p.APU)("Guest");default:return e}},e.selectStatusOption=function(t){e.props.onStatusChange(t.value)},e.selectRoleOption=function(t){e.props.onRoleChange(t.value)},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.isActive,n=t.role;this.statusOptions=[{value:"",text:(0,p.APU)("All")},{value:"1",text:(0,p.APU)("Active")},{value:"0",text:(0,p.APU)("Inactive")}].map((function(e){return e.isSelected=s==e.value,e}));var r=this.statusOptions.filter((function(e){return e.isSelected}))[0];this.roleOptions=[""].concat(It).map((function(t){return{value:t,text:e.translateRole(t),isSelected:t==n}}));var i=this.roleOptions.filter((function(e){return e.isSelected}))[0]||{value:n,text:this.translateRole(n),isSelected:!0};return(0,v.jsxs)("div",{className:"users-filter-bar mt-4 mb-2 d-flex align-items-center",children:[(0,v.jsx)("span",{className:"filter-item mr-2",children:"".concat((0,p.APU)("Status"),":")}),(0,v.jsx)(Pe.A,{isDropdownToggleShown:!0,currentSelectedOption:r,options:this.statusOptions,selectOption:this.selectStatusOption}),(0,v.jsx)("span",{className:"filter-item mr-2 ml-4",children:"".concat((0,p.APU)("Role"),":")}),(0,v.jsx)(Pe.A,{isDropdownToggleShown:!0,currentSelectedOption:i,options:this.roleOptions,selectOption:this.selectRoleOption})]})}}])}(l.Component),Mt=kt,Ct=window.sysadmin.pageOptions.availableRoles,Lt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).initUserListFromURL=function(){var e=new URL(window.location).searchParams,t=s.state,n=t.is_active,r=t.role;s.setState({is_active:e.get("is_active")||n,role:e.get("role")||r},(function(){s.getUsersListByPage(s.props.currentPage)}))},s.onUserSelected=function(e){var t=!1,n=[],r=s.state.userList.map((function(s){return s.email===e.email&&(s.isSelected=!s.isSelected),1==s.isSelected?(t=!0,n.push(s)):n=n.filter((function(e){return e.email!=s.email})),s}));s.setState({userList:r,selectedUserList:n}),s.props.onHasUserSelected(t)},s.toggleSelectAllUsers=function(){if(s.state.isAllUsersSelected){var e=s.state.userList.map((function(e){return e.isSelected=!1,e}));s.setState({userList:e,isAllUsersSelected:!1,selectedUserList:[]}),s.props.onHasUserSelected(!1)}else{var t=s.state.userList.map((function(e){return e.isSelected=!0,e}));s.setState({userList:t,isAllUsersSelected:!0,selectedUserList:t}),s.props.onHasUserSelected(!0)}},s.getUserList=function(){U.H.sysAdminListAdmins().then((function(e){var t=e.data.admin_user_list.map((function(e){return new wt(e)}));s.setState({userList:t,loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.getUsersListByPage=function(e){var t=s.state,n=t.is_active,r=t.role,i=s.props,a=i.perPage,o=i.sortBy,l=i.sortOrder,c=i.isLDAPImported;U.H.sysAdminListUsers(e,a,c,o,l,n,r).then((function(t){var n=t.data.data.map((function(e){return new bt(e)}));s.setState({userList:n,loading:!1,hasNextPage:m.Aq.hasNextPage(e,a,t.data.total_count),currentPage:e})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.updateURLSearchParams=function(e){var t=new URL(location.href),s=new URLSearchParams(t.search);for(var n in e)s.set(n,e[n]);t.search=s.toString(),(0,h.oo)(t.toString())},s.onStatusChange=function(e){s.setState({is_active:e,currentPage:1},(function(){var t=s.props,n=t.currentPage,r=t.perPage;s.updateURLSearchParams({page:n,per_page:r,is_active:e}),s.getUsersListByPage(n)}))},s.onRoleChange=function(e){s.setState({role:e,currentPage:1},(function(){var t=s.props,n=t.currentPage,r=t.perPage;s.updateURLSearchParams({page:n,per_page:r,role:e}),s.getUsersListByPage(n)}))},s.deleteUser=function(e,t){U.H.sysAdminDeleteUser(e).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r});var i=(0,p.APU)("Deleted user %s");i=i.replace("%s",t),D.A.success(i)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.setUserQuotaInBatch=function(e){var t=s.state.selectedUserList.map((function(e){return e.email}));U.H.sysAdminSetUserQuotaInBatch(t,e).then((function(e){var t=s.state.userList.map((function(t){return e.data.success.forEach((function(e){t.email==e.email&&(t.quota_total=e.quota_total)})),t}));s.setState({userList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteUserInBatch=function(){var e=s.state.selectedUserList.map((function(e){return e.email}));U.H.sysAdminDeleteUserInBatch(e).then((function(t){if(t.data.success.length){var n=s.state.userList.filter((function(e){return!t.data.success.some((function(t){return t.email==e.email}))}));s.setState({userList:n}),s.props.onHasUserSelected(e.length!=t.data.success.length);var r=t.data.success.length,i=1==r?(0,p.APU)("Successfully deleted 1 user."):(0,p.APU)("Successfully deleted {user_number_placeholder} users.").replace("{user_number_placeholder}",r);D.A.success(i)}t.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);D.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.importUserInBatch=function(e){D.A.notify((0,p.APU)("It may take some time, please wait.")),U.H.sysAdminImportUserViaFile(e).then((function(e){if(e.data.success.length){var t=e.data.success.map((function(e){return void 0==e.institution&&(e.institution=""),new bt(e)}));s.setState({userList:t.concat(s.state.userList)})}e.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);D.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.addUser=function(e){D.A.notify((0,p.APU)("It may take some time, please wait."));var t=e.email,n=e.name,r=e.role,i=e.password;U.H.sysAdminAddUser(t,n,r,i).then((function(e){var t=s.state.userList;t.unshift(e.data),s.setState({userList:t}),D.A.success(e.data.add_user_tip)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getUsersListByPage(1)}))},s.updateUser=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};U.H.sysAdminUpdateUser(e,t,n,r).then((function(r){var i=s.state.userList.map((function(s){return s.email==e&&(s[t]=r.data[t]),s}));s.setState({userList:i});var a="is_active"==t&&n?r.data.update_status_tip:(0,p.APU)("Edit succeeded");D.A.success(a)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateAdminRole=function(e,t){U.H.sysAdminUpdateAdminRole(e,t).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.admin_role=t.data.role),s}));s.setState({userList:n}),D.A.success((0,p.APU)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.revokeAdmin=function(e,t){U.H.sysAdminUpdateUser(e,"is_staff",!1).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r}),D.A.success((0,p.APU)("Successfully revoked the admin permission of {placeholder}.").replace("{placeholder}",t))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.getCurrentNavItem=function(){var e=s.props,t=e.isAdmin,n=e.isLDAPImported,r="database";return t?r="admin":n&&(r="ldap-imported"),r},s.addAdminInBatch=function(e){U.H.sysAdminAddAdminInBatch(e).then((function(e){var t=e.data.success.map((function(e){return new wt(e)}));s.setState({userList:t.concat(s.state.userList)}),e.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);D.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",userList:[],hasNextPage:!1,selectedUserList:[],isAllUsersSelected:!1,is_active:"",role:""},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.props.isAdmin?this.getUserList():this.initUserListFromURL()}},{key:"componentDidUpdate",value:function(e){var t=this,s=this.props,n=s.isAdmin,r=s.sortBy,i=s.sortOrder,a=s.currentPage,o=s.perPage;e.isAdmin!==n&&this.setState({loading:!0},(function(){n?t.getUserList():t.initUserListFromURL()})),e.sortBy===r&&e.sortOrder===i&&e.currentPage===a||(this.updateURLSearchParams({page:a,per_page:o,order_by:r,direction:i}),this.getUsersListByPage(a))}},{key:"render",value:function(){var e=this.props,t=e.curTab,s=e.isAdmin,n=e.isLDAPImported,r=e.isImportUserDialogOpen,i=e.isAddUserDialogOpen,a=e.isBatchDeleteUserDialogOpen,o=e.isBatchSetQuotaDialogOpen,l=e.isBatchAddAdminDialogOpen,c=this.state,d=c.is_active,u=c.role;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"cur-view-content",children:["database"==t&&(0,v.jsx)(Mt,{isActive:d,role:u,onStatusChange:this.onStatusChange,onRoleChange:this.onRoleChange}),(0,v.jsx)(Oe,{isAdmin:s,isLDAPImported:n,loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,sortBy:this.props.sortBy,sortOrder:this.props.sortOrder,sortByQuotaUsage:this.sortByQuotaUsage,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.props.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getUsersListByPage,updateUser:this.updateUser,deleteUser:this.deleteUser,updateAdminRole:this.updateAdminRole,revokeAdmin:this.revokeAdmin,onUserSelected:this.onUserSelected,isAllUsersSelected:this.isAllUsersSelected,toggleSelectAllUsers:this.toggleSelectAllUsers})]}),r&&(0,v.jsx)(Pt,{toggle:this.props.toggleImportUserDialog,importUserInBatch:this.importUserInBatch}),i&&(0,v.jsx)(Ut,{dialogTitle:(0,p.APU)("Add User"),showRole:p.amr,availableRoles:Ct,addUser:this.addUser,toggleDialog:this.props.toggleAddUserDialog}),o&&(0,v.jsx)(me.A,{toggle:this.props.toggleBatchSetQuotaDialog,updateQuota:this.setUserQuotaInBatch}),a&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Users"),message:(0,p.APU)("Are you sure you want to delete the selected user(s) ?"),executeOperation:this.deleteUserInBatch,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.props.toggleBatchDeleteUserDialog}),l&&(0,v.jsx)(Nt,{addAdminInBatch:this.addAdminInBatch,toggle:this.toggleBatchAddAdminDialog})]})}}])}(l.Component),_t=Lt,Ot=s(33320),Rt=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)(_t,(0,n.default)({isAdmin:!0},this.props))}}])}(l.Component),Tt=Rt,Ft=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)(_t,(0,n.default)({isLDAPImported:!0},this.props))}}])}(l.Component),Et=Ft;C().extend(ve());var Bt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.curPerPage,i=e.hasNextPage,a=e.currentPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center mt-4",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No users")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"40%",children:(0,p.APU)("Email")}),(0,v.jsxs)("th",{width:"30%",children:[(0,p.APU)("Space Used")," / ",(0,p.APU)("Quota")]}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Last Login")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(zt,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),zt=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.email})}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(e.quota_usage)," / ").concat(e.quota_total>0?m.Aq.bytesToSize(e.quota_total):"--")}),(0,v.jsx)("td",{children:e.last_login?C()(e.last_login).fromNow():"--"})]})})}}])}(l.Component),Yt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getUsersListByPage=function(e){var t=s.state.perPage;U.H.sysAdminListLDAPUsers(e,t).then((function(t){s.setState({loading:!1,userList:t.data.ldap_user_list,hasNextPage:t.data.has_next_page,currentPage:e})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getUsersListByPage(1)}))},s.state={loading:!0,errorMsg:"",userList:{},hasNextPage:!1,currentPage:1,perPage:100},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getUsersListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(vt,{currentItem:"ldap"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Bt,{resetPerPage:this.resetPerPage,loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,getListByPage:this.getUsersListByPage})})]})})]})}}])}(l.Component),Ht=Yt,qt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"info",urlPart:"",text:(0,p.APU)("Info")},{name:"owned-repos",urlPart:"owned-libraries",text:(0,p.APU)("Owned Libraries")},{name:"shared-repos",urlPart:"shared-libraries",text:(0,p.APU)("Shared Libraries")},{name:"links",urlPart:"shared-links",text:(0,p.APU)("Shared Links")},{name:"groups",urlPart:"groups",text:(0,p.APU)("Groups")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props,s=t.currentItem,n=t.email,r=t.userName,i=this.navItems.findIndex((function(e){return e.name===s}))||0,a=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),o=a[i],l=a.slice(0,i).reduce((function(e,t){return e+t}),0)+(2*i+1)*le.L2;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/users/"),children:(0,p.APU)("Users")})," / ",r]})}),(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative mx-4",style:{"--indicator-width":"".concat(o,"px"),"--indicator-offset":"".concat(l,"px")},children:this.navItems.map((function(t,r){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[r]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/user/").concat(encodeURIComponent(n),"/").concat(t.urlPart),className:"nav-link m-0 ".concat(s==t.name?" active":""),children:t.text})},r)}))})]})}}])}(l.Component),Gt=qt,Qt=["email","children"],Vt=function(e){var t=Object.assign({},((0,mt.A)(e),e)),s=(0,l.useState)(""),r=(0,k.default)(s,2),i=r[0],a=r[1],o=(0,l.useState)("asc"),c=(0,k.default)(o,2),d=c[0],u=c[1],g=(0,l.useState)(100),m=(0,k.default)(g,2),f=m[0],x=m[1],A=(0,l.useState)(1),P=(0,k.default)(A,2),j=P[0],S=P[1],U=(0,l.useState)(!1),D=(0,k.default)(U,2),N=D[0],w=D[1],I=(0,l.useState)(!1),M=(0,k.default)(I,2),C=M[0],L=M[1],_=(0,l.useState)(!1),O=(0,k.default)(_,2),R=O[0],T=O[1],F=(0,l.useState)(!1),E=(0,k.default)(F,2),B=E[0],z=E[1],Y=(0,l.useState)(!1),H=(0,k.default)(Y,2),q=H[0],G=H[1],Q=(0,l.useState)(!1),V=(0,k.default)(Q,2),W=V[0],K=V[1],X=(0,h.zy)(),$=(0,l.useMemo)((function(){var e=X.pathname.split("/").filter(Boolean).pop(),t=e;return"users"===e?t="database":"admins"===e&&(t="admin"),{curTab:t,isAdmin:"admin"===t,isLDAPImported:"ldap-imported"===t}}),[X.pathname]),J=$.curTab,Z=$.isAdmin,ee=$.isLDAPImported,te=function(){L(!C)},se=function(){T(!R)},ne=function(){z(!B)},re=function(){G(!q)},ie=function(){K(!W)},ae={curTab:J,isAdmin:Z,isLDAPImported:ee,isAddUserDialogOpen:R,isImportUserDialogOpen:C,isBatchAddAdminDialogOpen:W,isBatchDeleteUserDialogOpen:q,isBatchSetQuotaDialogOpen:B,onHasUserSelected:function(e){w(e)},toggleAddUserDialog:se,toggleImportUserDialog:te,toggleBatchAddAdminDialog:ie,toggleBatchDeleteUserDialog:re,toggleBatchSetQuotaDialog:ne};return(0,l.useEffect)((function(){var e=new URL(window.location).searchParams;a(e.get("order_by")||i),u(e.get("direction")||d),S(parseInt(e.get("page")||j)),x(parseInt(e.get("per_page")||f))}),[]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:Z?null:(0,v.jsx)(Ot.A,{placeholder:(0,p.APU)("Search users"),submit:function(e){return(0,h.oo)("".concat(p.YcY,"sys/search-users/?query=").concat(encodeURIComponent(e)))}})},t),{},{children:N?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:ne,children:(0,p.APU)("Set Quota")}),(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:re,children:(0,p.APU)("Delete Users")})]}):Z?(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:ie,children:(0,p.APU)("Add Admin")}):ee?(0,v.jsx)("a",{className:"btn btn-secondary operation-item",href:"".concat(p.YcY,"sys/useradmin/export-excel/"),children:(0,p.APU)("Export Excel")}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:te,children:(0,p.APU)("Import Users")}),(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:se,children:(0,p.APU)("Add User")}),(0,v.jsx)("a",{className:"btn btn-secondary operation-item",href:"".concat(p.YcY,"sys/useradmin/export-excel/"),children:(0,p.APU)("Export Excel")})]})})),(0,v.jsx)(vt,{currentItem:J,sortBy:i,sortOrder:d,sortItems:function(e,t){a(e),u(t),S(1)}}),(0,v.jsxs)(h.Ix,{className:"d-flex overflow-hidden",children:[(0,v.jsx)(_t,(0,n.default)({default:!0,sortBy:i,sortOrder:d,perPage:f,currentPage:j},ae)),(0,v.jsx)(Tt,(0,n.default)({path:"admins"},ae)),(0,v.jsx)(Et,(0,n.default)({path:"ldap-imported"},ae)),(0,v.jsx)(Ht,(0,n.default)({path:"ldap"},ae))]})]})},Wt=function(e){var t=e.email,s=e.children,r=(0,oe.default)(e,Qt),i=(0,l.useState)(""),a=(0,k.default)(i,2),o=a[0],c=a[1],d=(0,h.zy)().pathname.split("/").filter(Boolean).pop(),u="info";return"owned-libraries"===d?u="owned-repos":"shared-libraries"===d?u="shared-repos":"shared-links"===d?u="links":"groups"===d&&(u="groups"),(0,l.useEffect)((function(){var e=He.B.subscribe(qe.T.SYNC_USERNAME,(function(e){c(e)}));return function(){e()}}),[]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},r)),(0,v.jsx)(Gt,{currentItem:u,email:t,userName:o}),s]})},Kt=s(40866),Xt=s(73606),$t=s(78125),Jt=s(35746),Zt=s(55909),es=s(38906),ts=s(10322),ss=s(89470),ns=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onMouseEnter=function(){s.setState({isOperationShow:!0})},s.onMouseLeave=function(){s.setState({isOperationShow:!1})},s.deleteShareItem=function(){var e=s.props.item;s.props.deleteShareItem(e.user_email)},s.onChangeUserPermission=function(e){var t=s.props.item;s.props.onChangeUserPermission(t,e)},s.state={isOperationShow:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=m.Aq.getSharedPermission(e);return(0,v.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{className:"name",children:e.user_name}),(0,v.jsx)("td",{children:(0,v.jsx)(ss.A,{repoID:e.repo_id,isTextMode:!0,autoFocus:!0,isEditIconShow:this.state.isOperationShow,currentPermission:t,permissions:this.props.permissions,onPermissionChanged:this.onChangeUserPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"sf2-icon-x3 action-icon ".concat(this.state.isOperationShow?"":"hide"),onClick:this.deleteShareItem,title:(0,p.APU)("Delete")})})]})}}])}(l.Component),rs=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props.items;return(0,v.jsx)("tbody",{children:t.map((function(t,s){return(0,v.jsx)(ns,{item:t,permissions:e.props.permissions,deleteShareItem:e.props.deleteShareItem,onChangeUserPermission:e.props.onChangeUserPermission},s)}))})}}])}(l.Component),is=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e}),s.options=[]},s.setPermission=function(e){s.setState({permission:e})},s.shareToUser=function(){var e=[],t=s.props.repoID;if(s.state.selectedUsers&&s.state.selectedUsers.length>0)for(var n=0;n<s.state.selectedUsers.length;n++)e[n]=s.state.selectedUsers[n].email;U.H.sysAdminAddRepoSharedItem(t,"user",e,s.state.permission).then((function(e){var t=[];if(e.data.failed.length>0)for(var n=0;n<e.data.failed.length;n++)t[n]=e.data.failed[n];var r=e.data.success;s.setState({errorMsg:t,sharedItems:s.state.sharedItems.concat(r),selectedUsers:[],permission:"rw"})})).catch((function(e){if(e.response){var t=(0,p.APU)("Library can not be shared to owner."),n=[];n.push(t),s.setState({errorMsg:n,selectedUsers:[]})}}))},s.deleteShareItem=function(e){var t=s.props.repoID;U.H.sysAdminDeleteRepoSharedItem(t,"user",e).then((function(t){s.setState({sharedItems:s.state.sharedItems.filter((function(t){return t.user_email!==e}))})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.onChangeUserPermission=function(e,t){var n=s.props.repoID,r=e.user_email;U.H.sysAdminUpdateRepoSharedItemPermission(n,"user",r,t).then((function(){s.updateSharedItems(e,t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateSharedItems=function(e,t){var n=e.user_name,r=s.state.sharedItems.map((function(e){var s=e.user_name;return n===s&&(e.permission=t,e.is_admin="admin"===t),e}));s.setState({sharedItems:r})},s.state={selectedUsers:[],errorMsg:[],permission:"rw",sharedItems:[],isLoading:!0},s.options=[],s.permissions=["rw","r"],p.amr&&s.permissions.push("admin","cloud-edit","preview"),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.repoID;U.H.sysAdminListRepoSharedItems(t,"user").then((function(t){0!==t.data.length?e.setState({sharedItems:t.data,isLoading:!1}):e.setState({isLoading:!1})})).catch((function(t){e.setState({isLoading:!1});var s=m.Aq.getErrorMsg(t);D.A.danger(s)}))}},{key:"render",value:function(){var e=this.state.sharedItems;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.APU)("User")}),(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsxs)("tbody",{children:[(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(Dt.A,{isMulti:!0,placeholder:(0,p.APU)("Search users"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsx)("td",{children:(0,v.jsx)(ss.A,{repoID:this.props.repoID,isTextMode:!1,isEditIconShow:!1,currentPermission:this.state.permission,permissions:this.permissions,onPermissionChanged:this.setPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.shareToUser,children:(0,p.APU)("Submit")})})]}),this.state.errorMsg.length>0&&this.state.errorMsg.map((function(e,t){var s="";return s=e.email?e.email+": "+e.error_msg:e,(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:3,children:(0,v.jsx)("p",{className:"error",children:s})})},t)}))]})]}),(0,v.jsx)("div",{className:"share-list-container",children:this.state.isLoading?(0,v.jsx)(N.A,{}):(0,v.jsx)(v.Fragment,{children:0===this.state.sharedItems.length?(0,v.jsx)(Ae.A,{text:(0,p.APU)("No share link"),className:"mt-8 mb-8"}):(0,v.jsxs)("table",{className:"table-thead-hidden",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.APU)("User")}),(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsx)(rs,{items:e,permissions:this.permissions,deleteShareItem:this.deleteShareItem,onChangeUserPermission:this.onChangeUserPermission})]})})})]})}}])}(l.Component),as=is,os=s(97011),ls=s(78405),cs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onMouseEnter=function(){s.setState({isOperationShow:!0})},s.onMouseLeave=function(){s.setState({isOperationShow:!1})},s.deleteShareItem=function(){var e=s.props.item;s.props.deleteShareItem(e.group_id)},s.onChangeUserPermission=function(e){var t=s.props.item;s.props.onChangeUserPermission(t,e)},s.state={isOperationShow:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=m.Aq.getSharedPermission(e);return(0,v.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{className:"name",children:e.group_name}),(0,v.jsx)("td",{children:(0,v.jsx)(ss.A,{repoID:e.repo_id,isTextMode:!0,autoFocus:!0,isEditIconShow:this.state.isOperationShow,currentPermission:t,permissions:this.props.permissions,onPermissionChanged:this.onChangeUserPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"sf2-icon-x3 action-icon ".concat(this.state.isOperationShow?"":"hide"),onClick:this.deleteShareItem,title:(0,p.APU)("Delete")})})]})}}])}(l.Component),ds=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props.items;return(0,v.jsx)("tbody",{children:t.map((function(t,s){return(0,v.jsx)(cs,{item:t,permissions:e.props.permissions,deleteShareItem:e.props.deleteShareItem,onChangeUserPermission:e.props.onChangeUserPermission},s)}))})}}])}(l.Component),us=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).loadOptions=function(){os.e.shareableGroups().then((function(e){s.options=[];for(var t=0;t<e.data.length;t++){var n={};n.name=e.data[t].name,n.value=e.data[t].name,n.id=e.data[t].id,n.label=e.data[t].name,s.options.push(n)}})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.onSelectOption=function(e){var t=s.state.selectedOptions.slice(0),n=t.findIndex((function(t){return t.id===e.id}));n>-1?t.splice(n,1):t.push(e),s.setState({selectedOptions:t})},s.onDeleteOption=function(e){var t=s.state.selectedOptions.slice(0),n=t.findIndex((function(t){return t.id===e.id}));n>-1&&t.splice(n,1),s.setState({selectedOptions:t})},s.listSharedGroups=function(){var e=s.props.repoID;U.H.sysAdminListRepoSharedItems(e,"group").then((function(e){0!==e.data.length?s.setState({sharedItems:e.data,isLoading:!1}):s.setState({isLoading:!1})})).catch((function(e){s.setState({isLoading:!1});var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.setPermission=function(e){s.setState({permission:e})},s.shareToGroup=function(){var e=s.props.repoID,t=s.state.selectedOptions;if(0!==t.length){var n=t.map((function(e){return e.id}));U.H.sysAdminAddRepoSharedItem(e,"group",n,s.state.permission).then((function(e){var t=[];if(e.data.failed.length>0)for(var n=0;n<e.data.failed.length;n++)t[n]=e.data.failed[n];var r=e.data.success;s.setState({errorMsg:t,sharedItems:s.state.sharedItems.concat(r),selectedOptions:[],permission:"rw"})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}},s.deleteShareItem=function(e){var t=s.props.repoID;U.H.sysAdminDeleteRepoSharedItem(t,"group",e).then((function(){s.setState({sharedItems:s.state.sharedItems.filter((function(t){return t.group_id!==e}))})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.onChangeUserPermission=function(e,t){var n=s.props.repoID,r=e.group_id;U.H.sysAdminUpdateRepoSharedItemPermission(n,"group",r,t).then((function(){s.updateSharedItems(e,t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateSharedItems=function(e,t){var n=e.group_id,r=s.state.sharedItems.map((function(e){var s=e.group_id;return n===s&&(e.permission=t,e.is_admin="admin"===t),e}));s.setState({sharedItems:r})},s.state={selectedOptions:[],errorMsg:[],permission:"rw",sharedItems:[],isLoading:!0},s.options=[],s.permissions=["rw","r"],p.amr&&s.permissions.push("admin","cloud-edit","preview"),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.loadOptions(),this.listSharedGroups()}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.APU)("Group")}),(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsxs)("tbody",{children:[(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(ls.A,{selectedOptions:this.state.selectedOptions,options:this.options,onSelectOption:this.onSelectOption,onDeleteOption:this.onDeleteOption,searchPlaceholder:(0,p.APU)("Search groups"),noOptionsPlaceholder:(0,p.APU)("No results"),isInModal:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)(ss.A,{repoID:this.props.repoID,isTextMode:!1,isEditIconShow:!1,currentPermission:this.state.permission,permissions:this.permissions,onPermissionChanged:this.setPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.shareToGroup,children:(0,p.APU)("Submit")})})]}),this.state.errorMsg.length>0&&this.state.errorMsg.map((function(e,t){var s=e.group_name+": "+e.error_msg;return(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:3,children:(0,v.jsx)("p",{className:"error",children:s})})},t)}))]})]}),(0,v.jsx)("div",{className:"share-list-container",children:this.state.isLoading?(0,v.jsx)(N.A,{}):(0,v.jsx)(v.Fragment,{children:0===this.state.sharedItems.length?(0,v.jsx)(Ae.A,{text:(0,p.APU)("No share link"),className:"mt-8 mb-8"}):(0,v.jsxs)("table",{className:"table-thead-hidden",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.APU)("Group")}),(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsx)(ds,{items:this.state.sharedItems,permissions:this.permissions,deleteShareItem:this.deleteShareItem,onChangeUserPermission:this.onChangeUserPermission})]})})})]})}}])}(l.Component),hs=(s(59625),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getInitialActiveTab=function(){return"shareToUser"},s.toggle=function(e){s.state.activeTab!==e&&s.setState({activeTab:e})},s.renderDirContent=function(){var e=s.state.activeTab,t=s.props,n=t.enableDirPrivateShare,r=t.isGroupOwnedRepo;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("div",{className:"share-dialog-side",children:(0,v.jsx)($t.A,{pills:!0,children:n&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Zt.A,{className:"shareToUser"===e?"active":"",onClick:s.toggle.bind(s,"shareToUser"),children:(0,p.APU)("Share to user")})}),(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Zt.A,{className:"shareToGroup"===e?"active":"",onClick:s.toggle.bind(s,"shareToGroup"),children:(0,p.APU)("Share to group")})})]})})}),(0,v.jsx)("div",{className:"share-dialog-main",children:(0,v.jsx)(es.A,{activeTab:s.state.activeTab,children:n&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(ts.A,{tabId:"shareToUser",children:(0,v.jsx)(as,{itemType:"library",isGroupOwnedRepo:r,itemPath:s.props.itemPath,repoID:s.props.repoID,isRepoOwner:s.state.isRepoOwner})}),(0,v.jsx)(ts.A,{tabId:"shareToGroup",children:(0,v.jsx)(us,{itemType:"library",isGroupOwnedRepo:r,itemPath:s.props.itemPath,repoID:s.props.repoID,isRepoOwner:s.state.isRepoOwner})})]})})})]})},s.state={activeTab:s.getInitialActiveTab(),isRepoOwner:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)("div",{children:(0,v.jsxs)(u.A,{isOpen:!0,style:p.zG5,className:"share-dialog",toggle:this.props.toggleDialog,children:[(0,v.jsxs)(be.A,{toggle:this.props.toggleDialog,children:[(0,p.APU)("Share")," ",(0,v.jsx)("span",{className:"op-target",title:this.props.itemName,children:this.props.itemName})]}),(0,v.jsx)(Ue.A,{className:"share-dialog-content",children:this.renderDirContent()})]})})}}])}(l.Component)),gs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).submit=function(){var e=s.state.keepDays;s.state.autoHistory&&(e=s.state.expireDays);var t=s.props.repoID;if(s.state.autoHistory&&Number(e)<=0)s.setState({errorInfo:(0,p.APU)("Please enter a non-negative integer")});else{var n=(0,p.APU)("Successfully set library history.");U.H.sysAdminUpdateRepoHistorySetting(t,parseInt(e)).then((function(e){D.A.success(n),s.setState({keepDays:e.data.keep_days}),s.props.toggleDialog()})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}},s.handleKeyDown=function(e){"Enter"===e.key&&(s.submit(),e.preventDefault())},s.onChange=function(e){var t=e.target.value;s.setState({keepDays:t,expireDays:t})},s.setLimitDays=function(e){"allHistory"===e?s.setState({keepDays:-1}):"noHistory"===e?s.setState({keepDays:0}):s.setState({disabled:!1}),s.setState({allHistory:"allHistory"===e,noHistory:"noHistory"===e,autoHistory:"autoHistory"===e})},s.state={keepDays:-1,expireDays:30,disabled:!0,allHistory:!0,noHistory:!1,autoHistory:!1,errorInfo:""},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetRepoHistorySetting(this.props.repoID).then((function(t){e.setState({keepDays:t.data.keep_days,allHistory:t.data.keep_days<0,noHistory:0===t.data.keep_days,autoHistory:t.data.keep_days>0,disabled:!(t.data.keep_days>0),expireDays:t.data.keep_days>0?t.data.keep_days:30})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}},{key:"render",value:function(){var e=this,t=this.props.itemName,s=(0,p.APU)("{placeholder} History Setting");return s=s.replace("{placeholder}",'<span class="op-target text-truncate mx-1">'+m.Aq.HTMLescape(t)+"</span>"),(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,v.jsx)(be.A,{toggle:this.props.toggleDialog,children:(0,v.jsx)("span",{dangerouslySetInnerHTML:{__html:s},className:"d-flex mw-100"})}),(0,v.jsx)(Ue.A,{children:(0,v.jsxs)(he.A,{children:[(0,v.jsxs)(ge.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"radio",name:"radio1",checked:this.state.allHistory,onChange:function(){e.setLimitDays("allHistory")}})," ",(0,v.jsx)(De.A,{children:(0,p.APU)("Keep full history")})]}),(0,v.jsxs)(ge.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"radio",name:"radio1",checked:this.state.noHistory,onChange:function(){e.setLimitDays("noHistory")}})," ",(0,v.jsx)(De.A,{children:(0,p.APU)("Don't keep history")})]}),(0,v.jsxs)(ge.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"radio",name:"radio1",checked:this.state.autoHistory,onChange:function(){e.setLimitDays("autoHistory")}})," ",(0,v.jsx)(De.A,{children:(0,p.APU)("Only keep a period of history:")}),(0,v.jsx)(G.A,{type:"text",className:"expire-input",value:this.state.expireDays,onChange:this.onChange,disabled:this.state.disabled,onKeyDown:this.handleKeyDown})," ",(0,v.jsx)(De.A,{children:(0,v.jsx)("span",{children:(0,p.APU)("days")})})]}),this.state.errorInfo&&(0,v.jsx)(At.A,{color:"danger",children:this.state.errorInfo})]})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.submit,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),ps=window.sysadmin.pageOptions.enableSysAdminViewRepo,ms=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.pageInfo,a=t.curPerPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No libraries")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsxs)("th",{width:"15%",children:[(0,p.APU)("Files")," / ",(0,p.APU)("Size")]}),(0,v.jsx)("th",{width:"32%",children:"ID"}),(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(fs,{repo:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,onDeleteRepo:e.props.onDeleteRepo,onTransferRepo:e.props.onTransferRepo,isWiki:e.props.isWiki},s)}))})]}),i&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:i.current_page,hasNextPage:i.has_next_page,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?c:o}}])}(l.Component),fs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onDeleteRepo=function(e){U.H.sysAdminDeleteRepo(e.id).then((function(t){s.props.onDeleteRepo(e),s.setState({isDeleteDialogOpen:!1,isRepoDeleted:!0});var n=(0,p.APU)("Successfully deleted {name}.").replace("{name}",e.name);D.A.success(n)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t),s.setState({isRepoDeleted:!1})}))},s.onTransferRepo=function(e,t){U.H.sysAdminTransferRepo(s.props.repo.id,e,t).then((function(e){s.props.onTransferRepo(e.data);var t=(0,p.APU)("Successfully transferred the library.");D.A.success(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.handleMouseOver=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseOut=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){switch(e){case"Share":s.toggleShareDialog();break;case"Delete":s.toggleDeleteDialog();break;case"Transfer":s.toggleTransferDialog();break;case"History Setting":s.toggleHistorySettingDialog()}},s.toggleShareDialog=function(){s.setState({isShareDialogOpen:!s.state.isShareDialogOpen})},s.toggleDeleteDialog=function(){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleTransferDialog=function(){s.setState({isTransferDialogOpen:!s.state.isTransferDialogOpen})},s.toggleHistorySettingDialog=function(){s.setState({isHistorySettingDialogOpen:!s.state.isHistorySettingDialogOpen})},s.renderRepoName=function(){var e=s.props.repo;return e.name?p.amr&&ps&&!e.encrypted?(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/libraries/").concat(e.id,"/"),children:e.name}):e.name:"--"},s.translateOperations=function(e){var t="";switch(e){case"Share":t=(0,p.APU)("Share");break;case"Delete":t=(0,p.APU)("Delete");break;case"Transfer":t=(0,p.APU)("Transfer");break;case"History Setting":t=(0,p.APU)("History Setting")}return t},s.getOperations=function(){var e=s.props.repo;if(s.props.isWiki)return["Delete"];var t=["Delete","Transfer"];return-1!=e.owner_email.indexOf("@seafile_group")?t=["Transfer"]:(e.encrypted||t.push("Share"),t.push("History Setting"),t)},s.state={isOpIconShown:!1,highlight:!1,isShareDialogOpen:!1,isDeleteDialogOpen:!1,isTransferDialogOpen:!1,isHistorySettingDialogOpen:!1,isRepoDeleted:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e,t=this.props.repo,s=this.state,n=s.isOpIconShown,r=s.isShareDialogOpen,i=s.isDeleteDialogOpen,a=s.isTransferDialogOpen,o=s.isHistorySettingDialogOpen,c=m.Aq.getLibIconUrl(t),d=m.Aq.getLibIconTitle(t),u=t.owner_email.indexOf("@seafile_group"),g=-1!=u;g&&(e=t.owner_email.substring(0,u));var f="";return this.props.isWiki&&(f=this.renderRepoName(),t.is_published&&(f=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:f}),(0,v.jsx)("a",{href:t.public_url,target:"_blank",rel:"noreferrer",children:"(Published)"})]}))),(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:c,title:d,alt:d,width:"24"})}),this.props.isWiki?(0,v.jsx)("td",{children:f}):(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:"".concat(t.file_count," / ").concat(m.Aq.bytesToSize(t.size))}),(0,v.jsx)("td",{children:t.id}),(0,v.jsx)("td",{children:g?(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/groups/").concat(e,"/libraries/"),children:t.owner_name}):(0,v.jsx)(ye,{email:t.owner_email,name:t.owner_name})}),(0,v.jsx)("td",{children:n&&(0,v.jsx)(je.A,{operations:this.getOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),r&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(hs,{itemName:t.name,itemPath:"/",repoID:t.id,isGroupOwnedRepo:g,repoEncrypted:t.encrypted,enableDirPrivateShare:!0,userPerm:t.permission,toggleDialog:this.toggleShareDialog})}),i&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(Xt.A,{repo:t,isRepoDeleted:this.state.isRepoDeleted,onDeleteRepo:this.onDeleteRepo,toggle:this.toggleDeleteDialog,isGetShare:!1})}),a&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(Xe.A,{itemName:t.name,onTransferRepo:this.onTransferRepo,toggleDialog:this.toggleTransferDialog,isSysAdmin:!0})}),o&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(gs,{repoID:t.id,itemName:t.name,toggleDialog:this.toggleHistorySettingDialog})})]})}}])}(l.Component),xs=ms,vs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getRepos=function(e){var t=s.state,n=t.name,r=t.perPage;s.getValueLength(n)<3?D.A.notify((0,p.APU)("Required at least three letters.")):U.H.sysAdminSearchRepos(n,e,r).then((function(e){s.setState({loading:!1,errorMsg:"",repos:e.data.repo_list,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.searchRepos=function(){var e=s.state.currentPage;s.getRepos(e)},s.onDeleteRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.onTransferRepo=function(e){var t=s.state.repos.map((function(t){return t.id==e.id?e:t}));s.setState({repos:t})},s.handleNameInputChange=function(e){s.setState({name:e.target.value,currentPage:1},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.name;s.setState({isSubmitBtnActive:e.trim()})},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.searchRepos())},s.resetPerPage=function(e){s.setState({perPage:e,currentPage:1},(function(){s.searchRepos()}))},s.state={name:"",currentPage:1,perPage:100,isSubmitBtnActive:!1,loading:!0,errorMsg:"",repos:[],pageInfo:{}},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(document.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({name:t.get("name_or_id")||"",perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getRepos(e.state.currentPage)}))}},{key:"getValueLength",value:function(e){for(var t,s=0,n=0,r=e.length;n<r;n++)10===(t=e.charCodeAt(n))?s+=2:t<127?s+=1:t>=128&&t<=2047?s+=2:t>=2048&&t<=65535&&(s+=3);return s}},{key:"render",value:function(){var e=this.state,t=e.name,s=e.isSubmitBtnActive;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Libraries")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Search Libraries")}),(0,v.jsx)("p",{className:"text-secondary small",children:(0,p.APU)("Tip: you can search by keyword in name or ID.")}),(0,v.jsxs)(he.A,{tag:"div",children:[(0,v.jsxs)(ge.A,{row:!0,children:[(0,v.jsx)(De.A,{for:"name",sm:1,children:(0,p.APU)("Name or ID")}),(0,v.jsx)(pe.A,{sm:5,children:(0,v.jsx)(G.A,{type:"text",name:"name",id:"name",value:t,onChange:this.handleNameInputChange,onKeyDown:this.handleKeyDown})})]}),(0,v.jsx)(ge.A,{row:!0,children:(0,v.jsx)(pe.A,{sm:{size:5,offset:1},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!s,onClick:this.searchRepos,children:(0,p.APU)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Result")}),(0,v.jsx)(xs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repos,pageInfo:this.state.pageInfo,curPerPage:this.state.perPage,getListByPage:this.getRepos,resetPerPage:this.resetPerPage,onDeleteRepo:this.onDeleteRepo,onTransferRepo:this.onTransferRepo})]})]})]})})]})}}])}(l.Component),As=s(90287),Ps=s(81617),js=function(){return(0,i.default)((function e(t){(0,r.default)(this,e),this.name=t.obj_name,this.mtime=t.last_update,this.size=t.file_size,this.is_file=t.is_file,this.type=t.type}),[{key:"isDir",value:function(){return!this.is_file}}])}(),Ss=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).onPathClick=function(t){var s=m.Aq.getEventData(t,"path");e.props.onPathClick(s)},e.turnPathToLink=function(t){var s=(t="/"===t[t.length-1]?t.slice(0,t.length-1):t).split("/"),n="";return s.map((function(t,r){return""===t?null:r===s.length-1?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("span",{className:"path-split",children:"/"}),(0,v.jsx)("span",{className:"path-file-name",children:t})]},r):(n+="/"+t,(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("span",{className:"path-split",children:"/"}),(0,v.jsx)("a",{className:"path-link","data-path":n,onClick:e.onPathClick,children:t})]},r))}))},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.isSystemRepo,s=e.currentPath,n=e.repoName,r=this.turnPathToLink(s);return(0,v.jsxs)("div",{className:"path-container",children:[t?(0,v.jsx)("a",{href:"".concat(p.YcY,"sys/system-library/"),children:(0,p.APU)("System")}):(0,v.jsx)("a",{href:"".concat(p.YcY,"sys/all-libraries/"),children:(0,p.APU)("All")}),(0,v.jsx)("span",{className:"path-split",children:"/"}),"/"===s||""===s?(0,v.jsx)("span",{className:"path-repo-name",children:n}):(0,v.jsx)("a",{className:"path-link","data-path":"/",onClick:this.onPathClick,children:n}),r]})}}])}(l.Component),ys=Ss;C().extend(ve());var Us=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.openFolder=function(){s.props.openFolder(s.props.dirent)},s.deleteDirent=function(){s.props.deleteDirent(s.props.dirent)},s.downloadDirent=function(){s.props.downloadDirent(s.props.dirent)},s.state={isHighlighted:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isHighlighted,n=this.props,r=n.dirent,i=n.fromSystemRepo,a=m.Aq.getDirentIcon(r);return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:st()({"tr-highlight":s}),onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{className:"text-center",children:(0,v.jsx)("img",{src:a,width:"24",alt:""})}),(0,v.jsx)("td",{children:r.is_file?r.name:(0,v.jsx)(h.N_,{to:"#",onClick:this.openFolder,children:r.name})}),(0,v.jsxs)("td",{children:[t&&i&&(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font",title:(0,p.APU)("Delete"),onClick:this.deleteDirent}),t&&r.is_file&&(0,v.jsx)("i",{className:"op-icon sf3-font sf3-font-download1",title:(0,p.APU)("Download"),onClick:this.downloadDirent})]}),(0,v.jsx)("td",{children:r.size}),(0,v.jsx)("td",{children:C()(r.mtime).fromNow()})]})})}}])}(l.Component),Ds=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.direntList;return s?(0,v.jsx)(N.A,{}):n?(0,v.jsx)("p",{className:"error text-center mt-4",children:n}):(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"55%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"10%"}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Size")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Last Update")})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Us,{dirent:t,openFolder:e.props.openFolder,deleteDirent:e.props.deleteDirent,downloadDirent:e.props.downloadDirent,fromSystemRepo:e.props.fromSystemRepo},s)}))})]})})}}])}(l.Component),Ns=Ds,bs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onPathClick=function(e){s.loadDirentList(e)},s.toggleNewFolderDialog=function(){s.setState({isNewFolderDialogOpen:!s.state.isNewFolderDialogOpen})},s.createNewFolder=function(e){var t=m.Aq.getFileName(e);U.H.sysAdminCreateSysRepoFolder(s.props.repoID,s.state.path,t).then((function(e){var t=new js(e.data),n=s.state.direntList;n.unshift(t),s.setState({direntList:n}),s.toggleNewFolderDialog()})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.openFolder=function(e){var t=m.Aq.joinPath(s.state.path,e.name);e.is_file||s.loadDirentList(t)},s.loadDirentList=function(e){var t=s.props.repoID;U.H.sysAdminListRepoDirents(t,e).then((function(n){var r=n.data,i=r.is_system_library,a=r.repo_name,o=r.dirent_list,l=[];o.forEach((function(e){var t=new js(e);l.push(t)})),s.setState({loading:!1,repoName:a,isSystemRepo:i,direntList:l,path:e},(function(){var n=p.YcY+"sys/libraries/"+t+"/"+encodeURIComponent(s.state.repoName)+m.Aq.encodePath(e);window.history.replaceState({url:n,path:e},e,n)}))})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteDirent=function(e){var t=m.Aq.joinPath(s.state.path,e.name);U.H.sysAdminDeleteRepoDirent(s.props.repoID,t).then((function(t){D.A.success((0,p.APU)("Successfully deleted 1 item."));var n=s.state.direntList.filter((function(t){return t.name!=e.name}));s.setState({direntList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.downloadDirent=function(e){var t=m.Aq.joinPath(s.state.path,e.name);U.H.sysAdminGetRepoFileDownloadURL(s.props.repoID,t).then((function(e){location.href=e.data.download_url})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.openFileInput=function(){s.fileInput.current.click()},s.onFileInputChange=function(){if(s.fileInput.current.files.length){var e=s.fileInput.current.files[0],t=s.state.path;U.H.sysAdminGetSysRepoItemUploadURL(t).then((function(n){var r=new FormData;r.append("parent_dir",t),r.append("file",e),As.A.post(n.data.upload_link,r).then((function(e){var t=e.data[0],n=new js({is_file:!0,obj_name:t.name,file_size:m.Aq.bytesToSize(t.size),last_update:(new Date).getTime()}),r=s.state.direntList,i=r.filter((function(e){return!e.is_file}));r.splice(i.length,0,n),s.setState({direntList:r})}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}},s.checkDuplicatedName=function(e){return s.state.direntList.some((function(t){return t.name===e}))},s.state={loading:!0,errorMsg:"",isSystemRepo:!1,repoName:"",path:"",direntList:[],isNewFolderDialogOpen:!1},s.fileInput=l.createRef(),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.loadDirentList("/")}},{key:"render",value:function(){var e=this.state,t=e.loading,s=e.errorMsg,r=e.repoName,i=e.direntList,a=e.isSystemRepo,o=e.path,c=e.isNewFolderDialogOpen,d=this.props.repoID;return(0,v.jsxs)(l.Fragment,{children:[a?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("input",{className:"d-none",type:"file",onChange:this.onFileInputChange,ref:this.fileInput}),(0,v.jsx)(y.A,{className:"operation-item",onClick:this.openFileInput,children:(0,p.APU)("Upload")}),(0,v.jsx)(y.A,{className:"operation-item",onClick:this.toggleNewFolderDialog,children:(0,p.APU)("New Folder")})]})})):(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path align-items-center",children:(0,v.jsx)(ys,{isSystemRepo:a,repoID:d,repoName:r,currentPath:o,onPathClick:this.onPathClick})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ns,{loading:t,errorMsg:s,fromSystemRepo:a,direntList:i,openFolder:this.openFolder,deleteDirent:this.deleteDirent,downloadDirent:this.downloadDirent})})]})}),c&&(0,v.jsx)(Ps.A,{parentPath:o,checkDuplicatedName:this.checkDuplicatedName,onAddFolder:this.createNewFolder,addFolderCancel:this.toggleNewFolderDialog})]})}}])}(l.Component),ws=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleRepoNameChange=function(e){e.target.value.trim()?s.setState({isSubmitBtnActive:!0}):s.setState({isSubmitBtnActive:!1}),s.setState({groupName:e.target.value})},s.handleSubmit=function(){var e=s.state.groupName.trim();s.props.createGroup(e,s.state.selectedUsers[0].email)},s.handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.toggle=function(){s.props.toggleDialog()},s.state={groupName:"",selectedUsers:[],errMessage:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,autoFocus:!1,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("New Group")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsx)(he.A,{children:(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{for:"groupName",children:(0,p.APU)("Name")}),(0,v.jsx)(G.A,{id:"groupName",onKeyDown:this.handleKeyDown,value:this.state.groupName,onChange:this.handleRepoNameChange,autoFocus:!0}),(0,v.jsxs)(De.A,{className:"mt-2",children:[(0,p.APU)("Owner"),(0,v.jsx)("span",{className:"small text-secondary ml-1",children:(0,p.APU)("(If left blank, owner will be admin)")})]}),(0,v.jsx)(Dt.A,{isMulti:!1,placeholder:(0,p.APU)("Select a user"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})]})}),this.state.errMessage&&(0,v.jsx)(At.A,{color:"danger",children:this.state.errMessage})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Is=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e,submitBtnDisabled:null==e})},s.submit=function(){if(s.state.selectedUsers){var e=s.state.selectedUsers[0].email;s.props.transferGroup(e),s.props.toggleDialog()}},s.state={selectedUsers:[],submitBtnDisabled:!0},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state.submitBtnDisabled,t='<span class="op-target">'+m.Aq.HTMLescape(this.props.groupName)+"</span>",s=(0,p.APU)("Transfer Group {placeholder} to").replace("{placeholder}",t);return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,v.jsx)(be.A,{toggle:this.props.toggleDialog,children:(0,v.jsx)("span",{dangerouslySetInnerHTML:{__html:s}})}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(Dt.A,{isMulti:!1,placeholder:(0,p.APU)("Select a user"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.submit,disabled:e,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),ks=s(52622);C().extend(ve());var Ms=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPage=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.pageInfo,a=t.curPerPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No groups")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"35%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"40%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Created At")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Cs,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteGroup:e.props.deleteGroup,transferGroup:e.props.transferGroup,changeGroup2Department:e.props.changeGroup2Department},s)}))})]}),i&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i.current_page,hasNextPage:i.has_next_page,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?c:o}}])}(l.Component),Cs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteDialog();break;case"Transfer":s.toggleTransferDialog();break;case"Change":s.toggleChangeDialog()}},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleTransferDialog=function(e){e&&e.preventDefault(),s.setState({isTransferDialogOpen:!s.state.isTransferDialogOpen})},s.toggleChangeDialog=function(e){e&&e.preventDefault(),s.setState({isChangeDialogOpen:!s.state.isChangeDialogOpen})},s.deleteGroup=function(){s.props.deleteGroup(s.props.item.id)},s.transferGroup=function(e){s.props.transferGroup(s.props.item.id,e)},s.changeGroup=function(){s.props.changeGroup2Department(s.props.item.id)},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.APU)("Delete");break;case"Transfer":t=(0,p.APU)("Transfer");break;case"Change":t=(0,p.APU)("Change to department")}return t},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1,isTransferDialogOpen:!1,isChangeDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isTransferDialogOpen,i=t.isChangeDialogOpen,a='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",o=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",a),c="".concat(p.YcY,"sys/groups/").concat(e.id,"/libraries/"),d=[];return d=p.amr?["Delete","Transfer","Change"]:["Delete","Transfer"],(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:c,children:e.name})}),(0,v.jsx)("td",{children:"system admin"==e.owner?"--":(0,v.jsx)(ye,{email:e.owner,name:e.owner_name})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{title:C()(e.created_at).format("dddd, MMMM D, YYYY h:mm:ss A"),children:C()(e.created_at).fromNow()})}),(0,v.jsx)("td",{children:s&&"system admin"!=e.owner&&(0,v.jsx)(je.A,{operations:d,translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Group"),message:o,executeOperation:this.deleteGroup,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteDialog}),r&&(0,v.jsx)(Is,{groupName:e.name,transferGroup:this.transferGroup,toggleDialog:this.toggleTransferDialog}),i&&(0,v.jsx)(ks.A,{groupName:e.name,changeGroup2Department:this.changeGroup,toggleDialog:this.toggleChangeDialog})]})}}])}(l.Component),Ls=Ms,_s=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleCreateGroupDialog=function(){s.setState({isCreateGroupDialogOpen:!s.state.isCreateGroupDialogOpen})},s.getGroupListByPage=function(e){U.H.sysAdminListAllGroups(e,s.state.perPage).then((function(e){s.setState({loading:!1,groupList:e.data.groups,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getGroupListByPage(1)}))},s.createGroup=function(e,t){U.H.sysAdminCreateNewGroup(e,t).then((function(e){var t=s.state.groupList;t.unshift(e.data),s.setState({groupList:t}),s.toggleCreateGroupDialog()})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteGroup=function(e){U.H.sysAdminDismissGroupByID(e).then((function(t){var n=s.state.groupList.filter((function(t){return t.id!=e}));s.setState({groupList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.transferGroup=function(e,t){U.H.sysAdminTransferGroup(t,e).then((function(t){var n=s.state.groupList.map((function(s){return s.id==e&&(s=t.data),s}));s.setState({groupList:n}),D.A.success((0,p.APU)("Successfully transferred the group."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.changeGroup2Department=function(e){U.H.sysAdminGroup2Department(e).then((function(t){var n=s.state.groupList.map((function(s){return s.id==e&&(s=t.data),s}));s.setState({groupList:n}),D.A.success((0,p.APU)("Successfully change the group"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.getSearch=function(){return(0,v.jsx)(Ot.A,{placeholder:(0,p.APU)("Search groups by name"),submit:s.searchGroups})},s.searchGroups=function(e){(0,h.oo)("".concat(p.YcY,"sys/search-groups/?name=").concat(encodeURIComponent(e)))},s.state={loading:!0,errorMsg:"",groupList:[],pageInfo:{},perPage:100,isCreateGroupDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,i=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||i),currentPage:parseInt(t.get("page")||r)},(function(){e.getGroupListByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state.isCreateGroupDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:this.getSearch()},this.props),{},{children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{className:"operation-item",onClick:this.toggleCreateGroupDialog,children:(0,p.APU)("New Group")}),(0,v.jsx)("a",{className:"btn btn-secondary operation-item",href:"".concat(p.YcY,"sys/groupadmin/export-excel/"),children:(0,p.APU)("Export Excel")})]})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Groups")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ls,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.groupList,pageInfo:this.state.pageInfo,deleteGroup:this.deleteGroup,transferGroup:this.transferGroup,changeGroup2Department:this.changeGroup2Department,getListByPage:this.getGroupListByPage,resetPerPage:this.resetPerPage,curPerPage:this.state.perPage})})]})}),e&&(0,v.jsx)(ws,{createGroup:this.createGroup,toggleDialog:this.toggleCreateGroupDialog})]})}}])}(l.Component),Os=_s,Rs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getGroups=function(){var e=s.state.name;U.H.sysAdminSearchGroups(e).then((function(e){s.setState({loading:!1,groupList:e.data.group_list})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteGroup=function(e){U.H.sysAdminDismissGroupByID(e).then((function(t){var n=s.state.groupList.filter((function(t){return t.id!=e}));s.setState({groupList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.transferGroup=function(e,t){U.H.sysAdminTransferGroup(t,e).then((function(t){var n=s.state.groupList.map((function(s){return s.id==e&&(s=t.data),s}));s.setState({groupList:n}),D.A.success((0,p.APU)("Successfully transferred the group."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.handleNameInputChange=function(e){s.setState({name:e.target.value},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.name;s.setState({isSubmitBtnActive:e.trim()})},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.getGroups())},s.state={name:"",isSubmitBtnActive:!1,loading:!0,errorMsg:"",groupList:[],pageInfo:null},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=new URL(document.location).searchParams;this.setState({name:e.get("name")||""},this.getGroups)}},{key:"render",value:function(){var e=this.state,t=e.name,s=e.isSubmitBtnActive;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Groups")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Search Groups")}),(0,v.jsx)("p",{className:"text-secondary small",children:(0,p.APU)("Tip: you can search by keyword in name.")}),(0,v.jsxs)(he.A,{tag:"div",children:[(0,v.jsxs)(ge.A,{row:!0,children:[(0,v.jsx)(De.A,{for:"name",sm:1,children:(0,p.APU)("Name")}),(0,v.jsx)(pe.A,{sm:5,children:(0,v.jsx)(G.A,{type:"text",name:"name",id:"name",value:t,onChange:this.handleNameInputChange,onKeyDown:this.handleKeyDown})})]}),(0,v.jsx)(ge.A,{row:!0,children:(0,v.jsx)(pe.A,{sm:{size:5,offset:1},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!s,onClick:this.getGroups,children:(0,p.APU)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Result")}),(0,v.jsx)(Ls,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.groupList,deleteGroup:this.deleteGroup,transferGroup:this.transferGroup})]})]})]})})]})}}])}(l.Component),Ts=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"repos",urlPart:"groups/"+s.props.groupID+"/libraries",text:(0,p.APU)("Libraries")},{name:"members",urlPart:"groups/"+s.props.groupID+"/members",text:(0,p.APU)("Members")}],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.groupName,s=e.currentItem;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/groups/"),children:(0,p.APU)("Groups")})," / ",t]})}),(0,v.jsx)("ul",{className:"nav border-bottom mx-4",children:this.navItems.map((function(e,t){return(0,v.jsx)("li",{className:"nav-item mr-2",children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/").concat(e.urlPart,"/"),className:"nav-link ".concat(s==e.name?" active":""),children:e.text})},t)}))})]})}}])}(l.Component),Fs=Ts,Es=window.sysadmin.pageOptions.enableSysAdminViewRepo,Bs=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No libraries")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Size")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Shared By")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(zs,{item:t,unshareRepo:e.props.unshareRepo},s)}))})]})});return r.length?a:i}}])}(l.Component),zs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleUnshareRepoDialog=function(){s.setState({isUnshareRepoDialogOpen:!s.state.isUnshareRepoDialogOpen})},s.unshareRepo=function(){var e=s.props.item;s.props.unshareRepo(e.repo_id,e.name),s.toggleUnshareRepoDialog()},s.renderRepoName=function(){var e=s.props.item,t=e;return t.id=e.repo_id,t.name?p.amr&&Es&&!t.encrypted?(0,v.jsx)("a",{href:"".concat(p.YcY,"sys/libraries/").concat(t.id,"/"),children:t.name}):t.name:"--"},s.state={isHighlighted:!1,isOpIconShown:!1,isUnshareRepoDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isUnshareRepoDialogOpen,n=e.isHighlighted,r=this.props.item,i=m.Aq.getLibIconUrl(r),a=m.Aq.getLibIconTitle(r),o='<span class="op-target">'+m.Aq.HTMLescape(r.name)+"</span>",c=(0,p.APU)("Are you sure you want to unshare {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:st()({"tr-highlight":n}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:i,title:a,alt:a,width:"24"})}),(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(r.size)}),(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:r.shared_by,name:r.shared_by_name})}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{role:"button",className:"op-icon sf2-icon-x3 ".concat(t?"":"invisible"),title:(0,p.APU)("Unshare"),onClick:this.toggleUnshareRepoDialog})})]}),s&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Unshare Library"),message:c,executeOperation:this.unshareRepo,confirmBtnText:(0,p.APU)("Unshare"),toggleDialog:this.toggleUnshareRepoDialog})]})}}])}(l.Component),Ys=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).unshareRepo=function(e,t){U.H.sysAdminUnshareRepoFromGroup(s.props.groupID,e).then((function(n){var r=s.state.repoList.filter((function(t){return t.repo_id!=e}));s.setState({repoList:r});var i=(0,p.APU)("Successfully unshared library {placeholder}").replace("{placeholder}",t);D.A.success(i)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",groupName:"",repoList:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminListGroupRepos(this.props.groupID).then((function(t){e.setState({loading:!1,repoList:t.data.libraries,groupName:t.data.group_name})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Fs,{groupID:this.props.groupID,groupName:this.state.groupName,currentItem:"repos"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Bs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList,unshareRepo:this.unshareRepo})})]})})]})}}])}(l.Component),Hs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e,isSubmitBtnDisabled:!e.length})},s.addMembers=function(){var e=s.state.selectedUsers.map((function(e){return e.email}));s.props.addMembers(e),s.props.toggle()},s.state={selectedUsers:[],isSubmitBtnDisabled:!0},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state.isSubmitBtnDisabled;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(be.A,{toggle:this.props.toggle,children:(0,p.APU)("Add Member")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(Dt.A,{isMulti:!0,placeholder:(0,p.APU)("Search users"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.addMembers,disabled:e,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),qs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.getPreviousPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.pageInfo,a=t.curPerPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No members")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"55%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Role")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Gs,{item:t,isItemFreezed:e.state.isItemFreezed,toggleItemFreezed:e.toggleItemFreezed,removeMember:e.props.removeMember,updateMemberRole:e.props.updateMemberRole},s)}))})]}),i&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:i.current_page,hasNextPage:i.has_next_page,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?c:o}}])}(l.Component),Gs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({highlighted:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({highlighted:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.removeMember=function(){var e=s.props.item;s.props.removeMember(e.email,e.name),s.toggleDeleteDialog()},s.updateMemberRole=function(e){s.props.updateMemberRole(s.props.item.email,e.value)},s.roleOptions=[{value:"Admin",text:(0,p.APU)("Admin"),isSelected:!1},{value:"Member",text:(0,p.APU)("Member"),isSelected:!1}],s.state={highlighted:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.highlighted,s=e.isDeleteDialogOpen,n=this.props.item,r='<span class="op-target">'+m.Aq.HTMLescape(n.name)+"</span>",i=(0,p.APU)("Are you sure you want to remove {placeholder} ?").replace("{placeholder}",r),a=n.role;this.roleOptions=this.roleOptions.map((function(e){return e.isSelected=e.value==a,e}));var o=this.roleOptions.filter((function(e){return e.isSelected}))[0];return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:t?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:n.avatar_url,alt:"",className:"rounded-circle",width:"24"})}),(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:n.email,name:n.name})}),(0,v.jsx)("td",{children:"Owner"==n.role?(0,p.APU)("Owner"):(0,v.jsx)(Pe.A,{isDropdownToggleShown:t,currentSelectedOption:o,options:this.roleOptions,selectOption:this.updateMemberRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("td",{children:"Owner"!=n.role&&(0,v.jsx)("i",{role:"button",className:"op-icon sf2-icon-x3 ".concat(t?"":"invisible"),title:(0,p.APU)("Remove"),onClick:this.toggleDeleteDialog})})]}),s&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Remove Member"),message:i,executeOperation:this.removeMember,confirmBtnText:(0,p.APU)("Remove"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),Qs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getListByPage=function(e){var t=s.state.perPage;U.H.sysAdminListGroupMembers(s.props.groupID,e,t).then((function(e){s.setState({loading:!1,memberList:e.data.members,groupName:e.data.group_name,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getListByPage(1)}))},s.toggleAddMemberDialog=function(){s.setState({isAddMemberDialogOpen:!s.state.isAddMemberDialogOpen})},s.addMembers=function(e){U.H.sysAdminAddGroupMember(s.props.groupID,e).then((function(e){var t=e.data.success;t.length&&(s.setState({memberList:t.concat(s.state.memberList)}),t.forEach((function(e){var t=(0,p.APU)("Successfully added {email_placeholder}").replace("{email_placeholder}",e.email);D.A.success(t)}))),e.data.failed.forEach((function(e){var t=(0,p.APU)("Failed to add {email_placeholder}: {error_msg_placeholder}").replace("{email_placeholder}",e.email).replace("{error_msg_placeholder}",e.error_msg);D.A.danger(t,{duration:3})}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.removeMember=function(e,t){U.H.sysAdminDeleteGroupMember(s.props.groupID,e).then((function(n){var r=s.state.memberList.filter((function(t){return t.email!=e}));s.setState({memberList:r}),D.A.success((0,p.APU)("Successfully removed {placeholder}.").replace("{placeholder}",t))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateMemberRole=function(e,t){var n="Admin"==t;U.H.sysAdminUpdateGroupMemberRole(s.props.groupID,e,n).then((function(n){var r=s.state.memberList.map((function(s){return s.email==e&&(s.role=t),s}));s.setState({memberList:r})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",groupName:"",memberList:[],pageInfo:{},currentPage:1,perPage:100,isAddMemberDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({currentPage:parseInt(t.get("page")||n),perPage:parseInt(t.get("per_page")||r)},(function(){e.getListByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state.isAddMemberDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddMemberDialog,children:(0,p.APU)("Add Member")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Fs,{currentItem:"members",groupID:this.props.groupID,groupName:this.state.groupName}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(qs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.memberList,removeMember:this.removeMember,updateMemberRole:this.updateMemberRole,pageInfo:this.state.pageInfo,curPerPage:this.state.perPage,getListByPage:this.getListByPage,resetPerPage:this.resetPerPage})})]})}),e&&(0,v.jsx)(Hs,{addMembers:this.addMembers,toggle:this.toggleAddMemberDialog})]})}}])}(l.Component),Vs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).setGroupQuota=function(){var e=s.state.quota;if(e.length&&/^[1-9]\d*$/im.test(e)||-2==e){s.setState({errMessage:""});var t=-2==s.state.quota?s.state.quota:1e6*s.state.quota;U.H.sysAdminUpdateDepartmentQuota(s.props.group.id,t).then((function(e){s.props.toggle(),s.props.onSetQuota(e.data)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}else{var n=(0,p.APU)("Quota is invalid.");s.setState({errMessage:n})}},s.handleChange=function(e){var t=e.target.value.trim();s.setState({quota:t})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.setGroupQuota(),e.preventDefault())},s.state={quota:"",errMessage:""},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.group,t=m.Aq.bytesToSize(e.quota),s=(0,p.APU)("The current quota for {group_name} is {quota}").replace("{group_name}",e.name).replace("{quota}",t);return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,v.jsx)(be.A,{toggle:this.props.toggle,children:(0,p.APU)("Set Quota")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsx)("p",{children:s}),(0,v.jsx)("p",{children:(0,p.APU)("Please enter a new quota")}),(0,v.jsxs)(Ee.A,{children:[(0,v.jsx)(G.A,{onKeyDown:this.handleKeyDown,value:this.state.quota,onChange:this.handleChange,autoFocus:!0}),(0,v.jsx)(Be.A,{children:"MB"})]}),(0,v.jsxs)("p",{className:"tip",children:[(0,v.jsx)("br",{}),(0,v.jsx)("span",{children:(0,p.APU)("An integer that is greater than 0 or equal to -2.")}),(0,v.jsx)("br",{}),(0,v.jsx)("span",{children:(0,p.APU)("Tip: -2 means no limit.")})]}),this.state.errMessage&&(0,v.jsx)("p",{className:"error",children:this.state.errMessage})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.setGroupQuota,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Ws=s(15097),Ks=s(685),Xs=s(77474),$s=s(47150),Js=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleSubmit=function(){s.validateName()&&U.H.sysAdminAddRepoInDepartment(s.props.groupID,s.state.repoName.trim()).then((function(e){s.props.toggle(),s.props.onAddNewRepo(e.data)})).catch((function(e){var t=m.Aq.getErrorMsg(e);s.setState({errMessage:t})}))},s.validateName=function(){var e="";return!!s.state.repoName.trim().length||(e=(0,p.APU)("Name is required"),s.setState({errMessage:e}),!1)},s.handleChange=function(e){s.setState({repoName:e.target.value})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.state={repoName:"",errMessage:""},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,v.jsx)(be.A,{toggle:this.props.toggle,children:(0,p.APU)("New Library")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsx)(he.A,{children:(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{for:"repoName",children:(0,p.APU)("Name")}),(0,v.jsx)(G.A,{id:"repoName",onKeyDown:this.handleKeyDown,value:this.state.repoName,onChange:this.handleChange,autoFocus:!0})]})}),this.state.errMessage&&(0,v.jsx)("p",{className:"error",children:this.state.errMessage})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Zs=s(60436),en=function(){return(0,i.default)((function e(t){(0,r.default)(this,e),this.id=t.id||"",this.name=t.name||"",this.children=t.children||[],this.parentNode=t.parentNode||null,this.orgId=t.orgId||"",this.quota=t.quota||-2}),[{key:"findNodeById",value:function(e){if(this.id===e)return this;for(var t=(0,Zs.default)(this.children);t.length>0;){var s=t.shift();if(s.id===e)return s;t.push.apply(t,(0,Zs.default)(s.children))}}},{key:"addChildren",value:function(e){var t;(t=this.children).push.apply(t,(0,Zs.default)(e))}},{key:"setChildren",value:function(e){this.children=e}},{key:"hasChildren",value:function(){return this.children.length>0}},{key:"deleteChildById",value:function(e){this.children=this.children.filter((function(t){return t.id!==e}))}}])}(),tn=s(5495),sn=s(69123),nn=s(65276),rn=s(34940);var an=function(e){var t=e.node,s=e.toggleDelete,n=e.toggleRename,r=e.toggleAddMembers,i=e.toggleAddDepartment,a=e.toggleAddLibrary,o=e.toggleSetQuotaDialog;return(0,v.jsxs)(nn.A,{modifiers:[{name:"preventOverflow",options:{boundary:document.body}}],className:"position-fixed",children:[(0,v.jsx)(rn.A,{onClick:function(){return i(t)},children:(0,p.APU)("Add sub-department")},"".concat(t.id,"-add-department")),(0,v.jsx)(rn.A,{onClick:function(){return a(t)},children:(0,p.APU)("Add Library")},"".concat(t.id,"-add-repo")),(0,v.jsx)(rn.A,{onClick:function(){return r(t)},children:(0,p.APU)("Add members")},"".concat(t.id,"-add-members")),(0,v.jsx)(rn.A,{onClick:function(){return n(t)},children:(0,p.APU)("Rename")},"".concat(t.id,"-rename")),(0,v.jsx)(rn.A,{onClick:function(){return s(t)},children:(0,p.APU)("Delete")},"".concat(t.id,"-delete")),(0,v.jsx)(rn.A,{onClick:function(){return o(t)},children:(0,p.APU)("Set quota")},"".concat(t.id,"-set-quota")),(0,v.jsx)(rn.A,{disabled:!0,children:"".concat((0,p.APU)("Department ID")," : ").concat(t.id)},"".concat(t.id,"-id"))]})},on=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleChildren=function(e){e.preventDefault(),e.stopPropagation(),s.state.isChildrenShow?s.setState({isChildrenShow:!1}):s.listSubDepartments()},s.listSubDepartments=function(){var e=s.props.node;s.props.listSubDepartments(e.id,(function(e){Array.isArray(e)&&0===e.length&&s.setState({isShowTreeIcon:!1}),s.setState({isChildrenShow:!0})}))},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.state.dropdownOpen||s.setState({active:!1})},s.renderTreeNodes=function(e){if(e.length>0)return e.map((function(e){return(0,v.jsx)(t,{node:e,onChangeDepartment:s.props.onChangeDepartment,checkedDepartmentId:s.props.checkedDepartmentId,listSubDepartments:s.props.listSubDepartments,toggleAddDepartment:s.props.toggleAddDepartment,toggleSetQuotaDialog:s.props.toggleSetQuotaDialog,toggleAddMembers:s.props.toggleAddMembers,toggleRename:s.props.toggleRename,toggleDelete:s.props.toggleDelete,toggleAddLibrary:s.props.toggleAddLibrary},e.id)}))},s.changeDept=function(e){var t=s.props,n=t.node,r=t.checkedDepartmentId,i=s.state.isChildrenShow;if(r!==n.id&&s.props.onChangeDepartment(e),r===n.id){if(i)return void s.setState({isChildrenShow:!1});s.listSubDepartments()}},s.state={isShowTreeIcon:!0,isChildrenShow:!1,dropdownOpen:!1,active:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){-1===this.props.node.id&&this.listSubDepartments()}},{key:"render",value:function(){var e=this,t=this.props,s=t.node,n=t.checkedDepartmentId,r=this.state,i=r.isChildrenShow,a=r.dropdownOpen,o=r.active,c=st()({"tree-node":!0,active:n===s.id});return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:c,onClick:function(){return e.changeDept(s.id)},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[this.state.isShowTreeIcon?(0,v.jsx)("span",{className:"departments-v2-tree-icon",onClick:function(t){return e.toggleChildren(t)},children:(0,v.jsx)("i",{className:"sf3-font sf3-font-down ".concat(i?"":"rotate-270")})}):(0,v.jsx)("span",{style:{width:24}}),(0,v.jsx)("span",{className:"departments-v2-tree-node-text text-truncate",children:s.name}),o&&(0,v.jsxs)(tn.A,{isOpen:a,toggle:function(t){return e.dropdownToggle(t)},direction:"down",className:"mr-2",children:[(0,v.jsx)(sn.A,{tag:"span",role:"button",className:"right-icon",title:(0,p.APU)("More operations"),"aria-label":(0,p.APU)("More operations"),"data-toggle":"dropdown",children:(0,v.jsx)("i",{className:"sf3-font sf3-font-more"})}),(0,v.jsx)(an,{node:s,toggleAddDepartment:this.props.toggleAddDepartment,toggleSetQuotaDialog:this.props.toggleSetQuotaDialog,toggleAddLibrary:this.props.toggleAddLibrary,toggleAddMembers:this.props.toggleAddMembers,toggleRename:this.props.toggleRename,toggleDelete:this.props.toggleDelete})]})]}),this.state.isChildrenShow&&(0,v.jsx)("div",{className:"tree-node-children",children:s.children&&this.renderTreeNodes(s.children)})]})}}])}(l.Component),ln=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.rootNodes,n=t.checkedDepartmentId;return(0,v.jsxs)("div",{className:"departments-tree-panel p-4",children:[s.map((function(t){return(0,v.jsx)(on,{node:t,checkedDepartmentId:n,onChangeDepartment:e.props.onChangeDepartment,listSubDepartments:e.props.listSubDepartments,toggleAddDepartment:e.props.toggleAddDepartment,toggleSetQuotaDialog:e.props.toggleSetQuotaDialog,toggleAddLibrary:e.props.toggleAddLibrary,toggleAddMembers:e.props.toggleAddMembers,toggleRename:e.props.toggleRename,toggleDelete:e.props.toggleDelete},t.id)})),(0,v.jsxs)("button",{className:"btn btn-secondary btn-block text-start border-0 font-weight-normal new-dept-btn shadow-none",onClick:function(){e.props.toggleAddDepartment(null)},children:[(0,v.jsx)("i",{className:"sf3-font sf3-font-new new-dept-btn-icon"}),(0,p.APU)("New Department")]})]})}}])}(l.Component),cn=ln,dn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).deleteRepo=function(){U.H.sysAdminDeleteRepoInDepartment(s.props.groupID,s.props.repo.repo_id).then((function(e){e.data.success&&(s.props.onRepoChanged(),s.props.toggle())})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.repo,t=(0,p.APU)("Are you sure you want to delete {placeholder} ?");return t=t.replace("{placeholder}",'<span class="op-target">'+m.Aq.HTMLescape(e.name||e.repo_name)+"</span>"),(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(be.A,{toggle:this.props.toggle,children:(0,p.APU)("Delete Library")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)("div",{dangerouslySetInnerHTML:{__html:t}})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.deleteRepo,children:(0,p.APU)("Delete")})]})]})}}])}(l.Component),un=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onMouseEnter=function(){s.props.isItemFreezed||s.setState({highlighted:!0})},s.onMouseLeave=function(){s.props.isItemFreezed||s.setState({highlighted:!1})},s.setMemberStaff=function(e){s.props.setMemberStaff(s.props.member.email,"Admin"===e.value)},s.deleteMember=function(){var e=s.props.member;s.props.deleteMember(e.email)},s.toggleDropdownMenu=function(){s.setState({isItemMenuShow:!s.state.isItemMenuShow},(function(){s.state.isItemMenuShow&&"function"===typeof s.props.freezeItem?s.props.freezeItem():s.state.isItemMenuShow||"function"!==typeof s.props.unfreezeItem||s.props.unfreezeItem()}))},s.toggleItemFreezed=function(e){e?s.props.freezeItem():(s.props.unfreezeItem(),s.setState({highlighted:!1}))},s.toggleDeleteMemberDialog=function(){s.setState({isDeleteMemberDialogOpen:!s.state.isDeleteMemberDialogOpen})},s.state={highlighted:!1,isItemMenuShow:!1},s.roleOptions=[{value:"Admin",text:(0,p.APU)("Admin"),isSelected:!1},{value:"Member",text:(0,p.APU)("Member"),isSelected:!1}],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.member,t=this.state,s=t.highlighted,n=t.isItemMenuShow,r=t.isDeleteMemberDialogOpen;this.roleOptions=this.roleOptions.map((function(t){return t.isSelected=t.value==e.role,t}));var i=this.roleOptions.filter((function(e){return e.isSelected}))[0];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("tr",{className:"departments-members-item ".concat(s?"tr-highlight":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{className:"avatar",src:e.avatar_url,alt:""})}),(0,v.jsx)("td",{className:"text-truncate",children:(0,v.jsx)("a",{href:"".concat(p.YcY,"sys/users/").concat(encodeURIComponent(e.email),"/"),children:e.name})}),(0,v.jsx)("td",{children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:s,currentSelectedOption:i,options:this.roleOptions,selectOption:this.setMemberStaff,toggleItemFreezed:this.toggleItemFreezed})}),(0,v.jsx)("td",{children:e.contact_email}),(0,v.jsx)("td",{children:s&&(0,v.jsxs)(tn.A,{isOpen:n,toggle:this.toggleDropdownMenu,direction:"down",children:[(0,v.jsx)(sn.A,{tag:"i",role:"button",className:"op-icon sf3-font sf3-font-more",title:(0,p.APU)("More operations"),"aria-label":(0,p.APU)("More operations"),"data-toggle":"dropdown"}),(0,v.jsx)(nn.A,{children:(0,v.jsx)(rn.A,{onClick:this.toggleDeleteMemberDialog,children:(0,p.APU)("Delete")})})]})})]}),r&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Member"),message:(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",'<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>"),executeOperation:this.deleteMember,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteMemberDialog})]})}}])}(l.Component),hn=window.sysadmin.pageOptions.enableSysAdminViewRepo,gn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onMouseEnter=function(){s.setState({highlight:!0})},s.onMouseLeave=function(){s.setState({highlight:!1})},s.state={highlight:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.repo,t=e.name||e.repo_name,s=this.state.highlight,n=m.Aq.getLibIconUrl(e);return(0,v.jsxs)("tr",{className:s?"tr-highlight":"",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:n,width:"24",alt:""})}),(0,v.jsx)("td",{children:hn?(0,v.jsx)("a",{href:"".concat(p.YcY,"sys/libraries/").concat(e.repo_id,"/").concat(encodeURIComponent(t),"/"),children:t}):(0,v.jsx)("span",{children:t})}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{className:"cursor-pointer text-center",onClick:this.props.showDeleteRepoDialog.bind(this,e),children:(0,v.jsx)("span",{className:"sf3-font-delete1 sf3-font op-icon ".concat(s?"":"vh"),title:(0,p.APU)("Delete")})})]})}}])}(l.Component),pn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).showDeleteRepoDialog=function(e){s.setState({showDeleteRepoDialog:!0,deletedRepo:e})},s.toggleCancel=function(){s.setState({showDeleteRepoDialog:!1,deletedRepo:{}})},s.onRepoChanged=function(){s.getRepos(s.props.checkedDepartmentId)},s.freezeItem=function(){s.setState({isItemFreezed:!0})},s.unfreezeItem=function(){s.setState({isItemFreezed:!1})},s.getCurrentDepartment=function(){var e=s.props,t=e.rootNodes,n=e.checkedDepartmentId;if(!t)return{};for(var r={},i=(0,Zs.default)(t);!r.id&&i.length>0;){var a=i.shift();a.id===n?r=a:a.children&&a.children.length>0&&i.push.apply(i,(0,Zs.default)(a.children))}return r},s.onSelectSortOption=function(e){var t=e.value.split("-"),n=(0,k.default)(t,2),r=n[0],i=n[1];s.props.sortItems(r,i)},s.changeActiveNav=function(e){s.setState({activeNav:e})},s.getRepos=function(e){s.props.getRepos(e,(function(e){s.setState({repos:e})}))},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.state={isItemFreezed:!1,activeNav:"members",repos:[],deletedRepo:{},showDeleteRepoDialog:!1,dropdownOpen:!1},s.sortOptions=[{value:"name-asc",text:(0,p.APU)("Ascending by name")},{value:"name-desc",text:(0,p.APU)("Descending by name")},{value:"role-asc",text:(0,p.APU)("Ascending by role")},{value:"role-desc",text:(0,p.APU)("Descending by role")}],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getRepos(this.props.checkedDepartmentId)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.checkedDepartmentId===e.checkedDepartmentId&&this.props.isAddNewRepo===e.isAddNewRepo||this.getRepos(e.checkedDepartmentId)}},{key:"render",value:function(){var e=this,t=this.state,s=t.activeNav,n=t.repos,r=this.props,i=r.membersList,a=r.isMembersListLoading,o=r.sortBy,l=r.sortOrder,c="members"==s,d=this.getCurrentDepartment();return(0,v.jsxs)("div",{className:"department-content-main d-flex flex-column",children:[(0,v.jsxs)("div",{className:"cur-view-path justify-content-start",children:[(0,v.jsx)("h4",{className:"sf-heading",children:d.name}),(0,v.jsxs)(tn.A,{isOpen:this.state.dropdownOpen,toggle:function(t){return e.dropdownToggle(t)},direction:"down",className:"department-dropdown-menu",children:[(0,v.jsx)(sn.A,{tag:"span",role:"button",className:"sf3-font-down sf3-font ml-1 sf-dropdown-toggle",title:(0,p.APU)("More operations"),"aria-label":(0,p.APU)("More operations"),"data-toggle":"dropdown"}),(0,v.jsx)(an,{node:d,toggleAddDepartment:this.props.toggleAddDepartment,toggleSetQuotaDialog:this.props.toggleSetQuotaDialog,toggleAddLibrary:this.props.toggleAddLibrary,toggleAddMembers:this.props.toggleAddMembers,toggleRename:this.props.toggleRename,toggleDelete:this.props.toggleDelete})]})]}),(0,v.jsxs)("div",{className:"cur-view-path tab-nav-container",children:[(0,v.jsxs)("ul",{className:"nav",children:[(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)("span",{className:"nav-link ".concat("members"===s?"active":""),onClick:function(){return e.changeActiveNav("members")},children:(0,p.APU)("Members")})}),(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)("span",{className:"nav-link ".concat("repos"===s?"active":""),onClick:function(){return e.changeActiveNav("repos")},children:(0,p.APU)("Libraries")})})]}),c&&(0,v.jsx)(ft.A,{sortBy:o,sortOrder:l,sortOptions:this.sortOptions,onSelectSortOption:this.onSelectSortOption})]}),"members"===s&&(0,v.jsx)("div",{className:"cur-view-content",children:a?(0,v.jsx)(N.A,{}):0==i.length?(0,v.jsx)(Ae.A,{text:(0,p.APU)("No members")}):(0,v.jsxs)("div",{className:"w-xs-250",children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"10%"}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Role")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Contact email")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:i.map((function(t,s){return(0,v.jsx)(un,{member:t,deleteMember:e.props.deleteMember,setMemberStaff:e.props.setMemberStaff,unfreezeItem:e.unfreezeItem,freezeItem:e.freezeItem,isItemFreezed:e.state.isItemFreezed},s)}))})]}),this.props.currentPageInfo&&(0,v.jsx)(K.A,{gotoPreviousPage:this.props.getPreviousPageList,gotoNextPage:this.props.getNextPageList,currentPage:this.props.currentPageInfo.current_page,hasNextPage:this.props.currentPageInfo.has_next_page,curPerPage:this.props.perPage,resetPerPage:this.props.resetPerPage,noURLUpdate:!0})]})}),"repos"===s&&(0,v.jsx)("div",{className:"cur-view-content",children:0==n.length?(0,v.jsx)(Ae.A,{text:(0,p.APU)("No libraries")}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"50%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Size")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsx)("tbody",{children:n.map((function(t,s){return(0,v.jsx)(gn,{repo:t,showDeleteRepoDialog:e.showDeleteRepoDialog},s)}))})]}),this.state.showDeleteRepoDialog&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(dn,{toggle:this.toggleCancel,onRepoChanged:this.onRepoChanged,repo:this.state.deletedRepo,groupID:this.props.checkedDepartmentId})})]})})]})}}])}(l.Component),mn=pn,fn=(s(2201),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onChangeDepartment=function(e){s.setState({checkedDepartmentId:e},s.loadDepartmentMembers(e))},s.loadDepartmentMembers=function(e){if(-1!==e){s.setState({isMembersListLoading:!0});var t=s.state,n=t.currentPage,r=t.perPage;U.H.sysAdminListGroupMembers(e,n,r).then((function(e){var t=e.data,n=t.members,r=t.page_info;s.setState({membersList:n,currentPageInfo:r,isMembersListLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}else s.setState({isMembersListLoading:!1,membersList:[]})},s.getPreviousPageList=function(){var e=s.state,t=e.checkedDepartmentId,n=e.currentPageInfo.current_page;s.setState({currentPage:n-1},(function(){s.loadDepartmentMembers(t)}))},s.getNextPageList=function(){var e=s.state,t=e.checkedDepartmentId,n=e.currentPageInfo.current_page;s.setState({currentPage:n+1},(function(){s.loadDepartmentMembers(t)}))},s.resetPerPage=function(e){s.setState({perPage:e,currentPage:1},(function(){var e=s.state.checkedDepartmentId;s.loadDepartmentMembers(e)}))},s.listSubDepartments=function(e,t){var n=s.state.rootNodes,r=null;n.forEach((function(t){r||(r=t.findNodeById(e))})),r&&U.H.sysAdminGetDepartmentInfo(e).then((function(e){var s=e.data.groups.map((function(e){return new en({id:e.id,name:e.name,parentGroupId:e.parent_group_id,orgId:e.org_id,parentNode:r,quota:e.quota})}));r.setChildren(s),t&&t(s)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.getRepos=function(e,t){U.H.sysAdminListGroupRepos(e).then((function(e){t&&t(e.data.libraries)})).catch((function(e){if(e.response&&404===e.response.status)t&&t(null);else{var s=m.Aq.getErrorMsg(e);D.A.danger(s)}}))},s.toggleAddLibrary=function(e){s.setState({operateNode:e,isShowAddRepoDialog:!s.state.isShowAddRepoDialog})},s.toggleAddDepartment=function(e){s.setState({operateNode:e,isAddDepartmentDialogShow:!s.state.isAddDepartmentDialogShow})},s.toggleSetQuotaDialog=function(e){s.setState({operateNode:e,isSetQuotaDialogShow:!s.state.isSetQuotaDialogShow})},s.toggleAddMembers=function(e){s.setState({operateNode:e,isAddMembersDialogShow:!s.state.isAddMembersDialogShow})},s.toggleRename=function(e){s.setState({operateNode:e,isRenameDepartmentDialogShow:!s.state.isRenameDepartmentDialogShow})},s.toggleDelete=function(e){s.setState({operateNode:e,isDeleteDepartmentDialogShow:!s.state.isDeleteDepartmentDialogShow})},s.addDepartment=function(e,t){e.addChildren([new en({id:t.id,name:t.name,parentNode:e,orgId:t.org_id})])},s.setRootNode=function(e){var t=new en({id:e.id,name:e.name,orgId:e.org_id}),n=s.state.rootNodes.slice(0);n.push(t),s.setState({rootNodes:n,checkedDepartmentId:t.id}),s.loadDepartmentMembers(t.id)},s.renameDepartment=function(e,t){e.id=t.id,e.name=t.name},s.onDelete=function(){var e=s.state,t=e.operateNode,n=e.checkedDepartmentId;U.H.sysAdminDeleteDepartment(t.id).then((function(){if(s.toggleDelete(),t.parentNode)t.parentNode.deleteChildById(t.id),t.id===n&&-1!==t.parentNode.id&&s.onChangeDepartment(t.parentNode.id);else{var e=s.state.rootNodes.slice(0),r=e.findIndex((function(e){return e.id===t.id}));e.splice(r,1),0===e.length?s.setState({rootNodes:e,checkedDepartmentId:-1}):(s.setState({rootNodes:e,checkedDepartmentId:e[0].id}),s.loadDepartmentMembers(e[0].id))}})).catch((function(e){if(e.response&&400===e.response.status)D.A.danger(e.response.data.error_msg);else{var t=m.Aq.getErrorMsg(e);D.A.danger(t)}}))},s.onMemberChanged=function(){var e=s.state,t=e.checkedDepartmentId,n=e.operateNode;t&&n&&t!==n.id||s.loadDepartmentMembers(n.id)},s.setMemberStaff=function(e,t){var n=s.state,r=n.checkedDepartmentId,i=n.membersList;U.H.sysAdminUpdateGroupMemberRole(r,e,t).then((function(t){var n=t.data,r=i.map((function(t){return t.email===e?n:t}));s.setState({membersList:r})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteMember=function(e){var t=s.state,n=t.checkedDepartmentId,r=t.membersList;U.H.sysAdminDeleteGroupMember(n,e).then((function(){var t=r.filter((function(t){return t.email!==e}));s.setState({membersList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.sortMembers=function(e,t,s){var n;switch("".concat(t,"-").concat(s)){case"name-asc":n=function(e,t){return m.Aq.compareTwoWord(e.name,t.name)};break;case"name-desc":n=function(e,t){return-m.Aq.compareTwoWord(e.name,t.name)};break;case"role-asc":n=function(e,t){return"Admin"==e.role?-1:1};break;case"role-desc":n=function(e,t){return"Admin"==e.role?1:-1}}return e.sort((function(e,t){return n(e,t)})),e},s.sortItems=function(e,t){s.setState({sortBy:e,sortOrder:t,membersList:s.sortMembers(s.state.membersList,e,t)})},s.onSetQuota=function(e){var t=s.state.rootNodes.slice(0);s._setQuota(t[0],e),s.setState({rootNodes:t})},s._setQuota=function(e,t){e.id===t.id?e.quota=t.quota:e.children.forEach((function(e){s._setQuota(e,t)}))},s.state={rootNodes:[],checkedDepartmentId:-1,operateNode:null,isSetQuotaDialogShow:!1,isAddDepartmentDialogShow:!1,isAddMembersDialogShow:!1,isRenameDepartmentDialogShow:!1,isDeleteDepartmentDialogShow:!1,isShowAddRepoDialog:!1,membersList:[],isTopDepartmentLoading:!1,isMembersListLoading:!1,sortBy:"",sortOrder:"",currentPageInfo:null,currentPage:1,perPage:100},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({isTopDepartmentLoading:!0},(function(){U.H.sysAdminListAllDepartments().then((function(t){var s=t.data.data;if(s&&s.length>0){var n=s.map((function(e){return new en({id:e.id,name:e.name,orgId:e.org_id,quota:e.quota})}));e.setState({rootNodes:n,checkedDepartmentId:n[0].id}),e.loadDepartmentMembers(n[0].id)}e.setState({isTopDepartmentLoading:!1})}))}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.rootNodes,r=t.operateNode,i=t.checkedDepartmentId,a=t.isAddDepartmentDialogShow,o=t.isAddMembersDialogShow,c=t.membersList,d=t.isMembersListLoading,u=t.isTopDepartmentLoading,h=t.isRenameDepartmentDialogShow,g=t.isDeleteDepartmentDialogShow,m=t.sortBy,f=t.sortOrder;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Departments")})}),(0,v.jsxs)("div",{className:"cur-view-content d-flex flex-row p-0",children:[u&&(0,v.jsx)(N.A,{}),!u&&s.length>0&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(cn,{rootNodes:s,checkedDepartmentId:i,onChangeDepartment:this.onChangeDepartment,listSubDepartments:this.listSubDepartments,toggleAddDepartment:this.toggleAddDepartment,toggleSetQuotaDialog:this.toggleSetQuotaDialog,toggleAddLibrary:this.toggleAddLibrary,toggleAddMembers:this.toggleAddMembers,toggleRename:this.toggleRename,toggleDelete:this.toggleDelete}),(0,v.jsx)(mn,{rootNodes:s,checkedDepartmentId:i,membersList:c,isMembersListLoading:d,isAddNewRepo:this.state.isAddNewRepo,setMemberStaff:this.setMemberStaff,deleteMember:this.deleteMember,sortItems:this.sortItems,sortBy:m,sortOrder:f,getRepos:this.getRepos,deleteGroup:this.deleteGroup,createGroup:this.createGroup,toggleAddDepartment:this.toggleAddDepartment,toggleSetQuotaDialog:this.toggleSetQuotaDialog,toggleAddLibrary:this.toggleAddLibrary,toggleAddMembers:this.toggleAddMembers,toggleRename:this.toggleRename,toggleDelete:this.toggleDelete,getPreviousPageList:this.getPreviousPageList,getNextPageList:this.getNextPageList,resetPerPage:this.resetPerPage,currentPageInfo:this.state.currentPageInfo,perPage:this.state.perPage})]}),!u&&0===s.length&&(0,v.jsx)("div",{className:"top-department-button-container h-100 w-100",children:(0,v.jsx)(y.A,{onClick:this.toggleAddDepartment.bind(this,null),children:(0,p.APU)("Enable departments feature")})})]})]})}),o&&(0,v.jsx)(Ks.A,{toggle:this.toggleAddMembers,nodeId:r.id,onMemberChanged:this.onMemberChanged}),h&&(0,v.jsx)(Xs.A,{node:r,toggle:this.toggleRename,renameDepartment:this.renameDepartment}),g&&(0,v.jsx)($s.A,{node:r,toggle:this.toggleDelete,onDelete:this.onDelete}),a&&(0,v.jsx)(Ws.A,{parentNode:r,toggle:this.toggleAddDepartment,addDepartment:this.addDepartment,setRootNode:this.setRootNode}),this.state.isShowAddRepoDialog&&(0,v.jsx)(Js,{toggle:this.toggleAddLibrary,onAddNewRepo:function(){e.setState({isAddNewRepo:!e.state.isAddNewRepo})},groupID:String(r.id)}),this.state.isSetQuotaDialogShow&&(0,v.jsx)(Vs,{group:r,onSetQuota:this.onSetQuota,toggle:this.toggleSetQuotaDialog})]})}}])}(l.Component)),xn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).checkSubmitBtnActive=function(){var e=s.state,t=e.name,n=e.email,r=e.password,i=e.passwordAgain,a=!0;a=""!=t.trim()&&""!=n.trim()&&""!=r.trim()&&""!=i.trim(),s.setState({isSubmitBtnActive:a})},s.toggle=function(){s.props.toggleDialog()},s.inputPassword=function(e){var t=e.target.value;s.setState({password:t},s.checkSubmitBtnActive)},s.inputPasswordAgain=function(e){var t=e.target.value;s.setState({passwordAgain:t},s.checkSubmitBtnActive)},s.inputEmail=function(e){var t=e.target.value;s.setState({email:t},s.checkSubmitBtnActive)},s.inputName=function(e){var t=e.target.value;s.setState({name:t},s.checkSubmitBtnActive)},s.handleSubmit=function(){var e=s.state,t=e.name,n=e.email,r=e.password;if(r==e.passwordAgain){var i={orgName:t.trim(),ownerEmail:n.trim(),password:r.trim()};s.props.addOrg(i),s.toggle()}else s.setState({errorMsg:(0,p.APU)("Passwords do not match.")})},s.state={name:"",email:"",password:"",passwordAgain:"",errorMsg:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.errorMsg,s=e.password,n=e.passwordAgain,r=e.email,i=e.name,a=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("Add Organization")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsxs)(he.A,{autoComplete:"off",children:[(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Name")}),(0,v.jsx)(G.A,{value:i,onChange:this.inputName})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsxs)(De.A,{children:[(0,p.APU)("Owner"),(0,v.jsx)("span",{className:"small text-secondary ml-1 sf3-font sf3-font-tips",title:(0,p.APU)("Owner can use admin panel in an organization, must be a new account.")})]}),(0,v.jsx)(G.A,{value:r,onChange:this.inputEmail})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Password")}),(0,v.jsx)(G.A,{type:"password",value:s,onChange:this.inputPassword})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Password again")}),(0,v.jsx)(G.A,{type:"password",value:n,onChange:this.inputPasswordAgain})]})]}),t&&(0,v.jsx)(At.A,{color:"danger",children:t})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!a,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),vn=window.sysadmin.pageOptions.availableRoles,An=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i="".concat((0,p.APU)("Created At")," / ").concat((0,p.APU)("Last Access"));if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No organizations")}),o=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Creator")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Role")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Space Used")}),(0,v.jsx)("th",{width:"20%",children:i}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Pn,{item:t,updateRole:e.props.updateRole,updateStatus:e.props.updateStatus,deleteOrg:e.props.deleteOrg,isItemFreezed:e.state.isItemFreezed,toggleItemFreezed:e.toggleItemFreezed},s)}))})]}),this.props.currentPage&&(0,v.jsx)(K.A,{currentPage:this.props.currentPage,hasNextPage:this.props.hasNextPage,curPerPage:this.props.curPerPage,resetPerPage:this.props.resetPerPage,gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage})]});return r.length?o:a}}])}(l.Component),Pn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({highlighted:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({highlighted:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen},(function(){s.state.isDeleteDialogOpen&&U.H.sysAdminGetOrg(s.props.item.org_id).then((function(e){var t='<span class="op-target">'+m.Aq.HTMLescape(e.data.org_name)+"</span>",n='<span class="op-target">'+m.Aq.HTMLescape(e.data.users_count)+"</span>",r='<span class="op-target">'+m.Aq.HTMLescape(e.data.repos_count)+"</span>",i=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",t)+"<br/>"+(0,p.APU)("{userCount} user(s) and {repoCount} libraries of this organization will also be deleted.").replace("{userCount}",n).replace("{repoCount}",r);s.setState({deleteDialogMsg:i})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}))},s.toggleConfirmInactiveDialog=function(){s.setState({isConfirmInactiveDialogOpen:!s.state.isConfirmInactiveDialogOpen})},s.translateStatus=function(e){switch(e){case"active":return(0,p.APU)("Active");case"inactive":return(0,p.APU)("Inactive")}},s.updateStatus=function(e){var t="active"==e.value;t&&D.A.notify((0,p.APU)("It may take some time, please wait.")),s.props.updateStatus(s.props.item.org_id,t)},s.setOrgInactive=function(){s.props.updateStatus(s.props.item.org_id,!1)},s.translateRole=function(e){switch(e){case"default":return(0,p.APU)("Default");case"guest":return(0,p.APU)("Guest");default:return e}},s.updateRole=function(e){s.props.updateRole(s.props.item.org_id,e.value)},s.deleteOrg=function(){D.A.notify((0,p.APU)("It may take some time, please wait.")),s.props.deleteOrg(s.props.item.org_id)},s.state={highlighted:!1,isDeleteDialogOpen:!1,deleteDialogMsg:"",isConfirmInactiveDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props.item,s=this.state,n=s.highlighted,r=s.isDeleteDialogOpen,i=s.deleteDialogMsg,a=s.isConfirmInactiveDialogOpen,o=t.role;this.roleOptions=vn.map((function(t){return{value:t,text:e.translateRole(t),isSelected:t==o}}));var c=this.roleOptions.filter((function(e){return e.isSelected}))[0],d=t.is_active?"active":"inactive";this.statusOptions=["active","inactive"].map((function(t){return{value:t,text:e.translateStatus(t),isSelected:t==d}}));var u=this.statusOptions.filter((function(e){return e.isSelected}))[0],g=(0,p.APU)("Are you sure you want to set {user_placeholder} inactive?").replace("{user_placeholder}",m.Aq.HTMLescape(t.org_name));return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:n?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/organizations/").concat(t.org_id,"/info/"),children:t.org_name})}),(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:t.creator_email,name:t.creator_name})}),(0,v.jsx)("td",{children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:n,currentSelectedOption:u,options:this.statusOptions,selectOption:this.updateStatus,toggleItemFreezed:this.props.toggleItemFreezed,operationBeforeSelect:t.is_active?this.toggleConfirmInactiveDialog:void 0})}),(0,v.jsx)("td",{children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:n,currentSelectedOption:c,options:this.roleOptions,selectOption:this.updateRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(t.quota_usage)," / ").concat(t.quota>0?m.Aq.bytesToSize(t.quota):"--")}),(0,v.jsxs)("td",{children:["".concat(C()(t.ctime).format("YYYY-MM-DD HH:mm:ss")," /"),(0,v.jsx)("br",{}),"".concat(t.last_activity_time?C()(t.last_activity_time).fromNow():"--"," ")]}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(n?"":"invisible"),title:(0,p.APU)("Delete"),onClick:this.toggleDeleteDialog})})]}),r&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Organization"),message:i,executeOperation:this.deleteOrg,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteDialog}),a&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Set organization inactive"),message:g,executeOperation:this.setOrgInactive,confirmBtnText:(0,p.APU)("Set"),toggleDialog:this.toggleConfirmInactiveDialog})]})}}])}(l.Component),jn=An,Sn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getItemsByPage=function(e){var t=s.state.perPage;U.H.sysAdminListOrgs(e,t).then((function(n){s.setState({loading:!1,orgList:n.data.organizations,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getItemsByPage(1)}))},s.toggleAddOrgDialog=function(){s.setState({isAddOrgDialogOpen:!s.state.isAddOrgDialogOpen})},s.updateStatus=function(e,t){var n={};n.isActive=t,U.H.sysAdminUpdateOrg(e,n).then((function(n){var r=s.state.orgList.map((function(s){return s.org_id==e&&(s.is_active=t),s}));s.setState({orgList:r}),D.A.success((0,p.APU)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateRole=function(e,t){var n={};n.role=t,U.H.sysAdminUpdateOrg(e,n).then((function(n){var r=s.state.orgList.map((function(s){return s.org_id==e&&(s.role=t),s}));s.setState({orgList:r}),D.A.success((0,p.APU)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.addOrg=function(e){var t=e.orgName,n=e.ownerEmail,r=e.password;U.H.sysAdminAddOrg(t,n,r).then((function(e){var t=s.state.orgList;t.unshift(e.data),s.setState({orgList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteOrg=function(e){U.H.sysAdminDeleteOrg(e).then((function(t){var n=s.state.orgList.filter((function(t){return t.org_id!=e}));s.setState({orgList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.getSearch=function(){return(0,v.jsx)(Ot.A,{placeholder:(0,p.APU)("Search organizations"),submit:s.searchItems})},s.searchItems=function(e){(0,h.oo)("".concat(p.YcY,"sys/search-organizations/?query=").concat(encodeURIComponent(e)))},s.state={loading:!0,errorMsg:"",orgList:[],currentPage:1,perPage:100,hasNextPage:!1,isAddOrgDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getItemsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state.isAddOrgDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:this.getSearch()},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddOrgDialog,children:(0,p.APU)("Add Organization")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Organizations")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(jn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.orgList,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getItemsByPage,updateRole:this.updateRole,updateStatus:this.updateStatus,deleteOrg:this.deleteOrg})})]})}),e&&(0,v.jsx)(xn,{addOrg:this.addOrg,toggleDialog:this.toggleAddOrgDialog})]})}}])}(l.Component),yn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getItems=function(){U.H.sysAdminSearchOrgs(s.state.query.trim()).then((function(e){s.setState({loading:!1,orgList:e.data.organization_list})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.updateRole=function(e,t){var n={};n.role=t,U.H.sysAdminUpdateOrg(e,n).then((function(n){var r=s.state.orgList.map((function(s){return s.org_id==e&&(s.role=t),s}));s.setState({orgList:r}),D.A.success((0,p.APU)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteOrg=function(e){U.H.sysAdminDeleteOrg(e).then((function(t){var n=s.state.orgList.filter((function(t){return t.org_id!=e}));s.setState({orgList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.handleInputChange=function(e){s.setState({query:e.target.value},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.query;s.setState({isSubmitBtnActive:e.trim()})},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.getItems())},s.state={query:"",isSubmitBtnActive:!1,loading:!0,errorMsg:"",orgList:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=new URL(document.location).searchParams;this.setState({query:e.get("query")||""},this.getItems)}},{key:"render",value:function(){var e=this.state,t=e.query,s=e.isSubmitBtnActive;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Organizations")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Search Organizations")}),(0,v.jsx)("p",{className:"text-secondary small",children:(0,p.APU)("Tip: you can search by keyword in name.")}),(0,v.jsxs)(he.A,{tag:"div",children:[(0,v.jsxs)(ge.A,{row:!0,children:[(0,v.jsx)(De.A,{for:"name",sm:1,children:(0,p.APU)("Name")}),(0,v.jsx)(pe.A,{sm:5,children:(0,v.jsx)(G.A,{type:"text",name:"query",id:"name",value:t,onChange:this.handleInputChange,onKeyDown:this.handleKeyDown})})]}),(0,v.jsx)(ge.A,{row:!0,children:(0,v.jsx)(pe.A,{sm:{size:5,offset:1},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!s,onClick:this.getItems,children:(0,p.APU)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.APU)("Result")}),(0,v.jsx)(jn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.orgList,updateRole:this.updateRole,deleteOrg:this.deleteOrg})]})]})]})})]})}}])}(l.Component),Un=s(97176),Dn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleInputChange=function(e){var t=e.target.value;s.setState({name:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateName(s.state.name.trim()),s.toggle()},s.state={name:s.props.name,isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.name,s=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("Set Name")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(he.A,{children:(0,v.jsx)(ge.A,{children:(0,v.jsx)(G.A,{type:"text",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleInputChange})})})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Nn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleInputChange=function(e){var t=e.target.value;s.setState({value:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateValue(s.state.value.trim()),s.toggle()},s.state={value:s.props.value,isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.value,s=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("Set max number of members")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(he.A,{children:(0,v.jsx)(ge.A,{children:(0,v.jsx)(G.A,{type:"text",className:"form-control",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleInputChange})})})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),bn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"info",urlPart:"info",text:(0,p.APU)("Info")},{name:"users",urlPart:"users",text:(0,p.APU)("Members")},{name:"groups",urlPart:"groups",text:(0,p.APU)("Groups")},{name:"repos",urlPart:"libraries",text:(0,p.APU)("Libraries")}],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.currentItem,s=e.orgID,n=e.orgName;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/organizations/"),children:(0,p.APU)("Organizations")})," / ",n]})}),(0,v.jsx)("ul",{className:"nav border-bottom mx-4",children:this.navItems.map((function(e,n){return(0,v.jsx)("li",{className:"nav-item mr-2",children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/organizations/").concat(s,"/").concat(e.urlPart,"/"),className:"nav-link ".concat(t==e.name?" active":""),children:e.text})},n)}))})]})}}])}(l.Component),wn=bn,In=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.toggleSetNameDialog=function(){s.setState({isSetNameDialogOpen:!s.state.isSetNameDialogOpen})},s.toggleSetMaxUserNumberDialog=function(){s.setState({isSetMaxUserNumberDialogOpen:!s.state.isSetMaxUserNumberDialogOpen})},s.state={isSetQuotaDialogOpen:!1,isSetNameDialogOpen:!1,isSetMaxUserNumberDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var n=this.props.orgInfo,r=n.org_name,i=n.users_count,a=n.max_user_number,o=n.groups_count,l=n.quota,c=n.quota_usage,d=n.enable_saml_login,u=n.metadata_url,h=n.domain,g=this.state,f=g.isSetQuotaDialogOpen,x=g.isSetNameDialogOpen,A=g.isSetMaxUserNumberDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("dl",{className:"m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Name")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r,(0,v.jsx)(Fe.A,{onClick:this.toggleSetNameDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Number of members")}),(0,v.jsx)("dd",{className:"info-item-content",children:i}),a&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Max number of members")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[a,(0,v.jsx)(Fe.A,{onClick:this.toggleSetMaxUserNumberDialog})]})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Number of groups")}),(0,v.jsx)("dd",{className:"info-item-content",children:o}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Space Used")}),(0,v.jsxs)("dd",{className:"info-item-content",children:["".concat(m.Aq.bytesToSize(c)," / ").concat(l>0?m.Aq.bytesToSize(l):"--"),(0,v.jsx)(Fe.A,{onClick:this.toggleSetQuotaDialog})]}),d&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("SAML Config")}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Un.A,{className:"my-4",children:[(0,v.jsx)(pe.A,{md:"4",children:"Identifier (Entity ID)"}),(0,v.jsx)(pe.A,{md:"6",children:"".concat(p.xW0,"/org/custom/").concat(this.props.orgID,"/saml2/metadata/")})]})}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Un.A,{className:"my-4",children:[(0,v.jsx)(pe.A,{md:"4",children:"Reply URL (Assertion Consumer Service URL)"}),(0,v.jsx)(pe.A,{md:"6",children:"".concat(p.xW0,"/org/custom/").concat(this.props.orgID,"/saml2/acs/")})]})}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Un.A,{className:"my-4",children:[(0,v.jsx)(pe.A,{md:"4",children:"SAML App Federation Metadata URL"}),(0,v.jsx)(pe.A,{md:"6",children:u})]})}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Un.A,{className:"my-4",children:[(0,v.jsx)(pe.A,{md:"4",children:(0,p.APU)("Email Domain")}),(0,v.jsx)(pe.A,{md:"6",children:h})]})})]})]}),f&&(0,v.jsx)(me.A,{updateQuota:this.props.updateQuota,toggle:this.toggleSetQuotaDialog}),x&&(0,v.jsx)(Dn,{name:r,updateName:this.props.updateName,toggle:this.toggleSetNameDialog}),A&&(0,v.jsx)(Nn,{value:a,updateValue:this.props.updateMaxUserNumber,toggle:this.toggleSetMaxUserNumberDialog})]})}}])}(l.Component),kn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).updateQuota=function(e){var t={quota:e};U.H.sysAdminUpdateOrg(s.props.orgID,t).then((function(e){var t=Object.assign(s.state.orgInfo,{quota:e.data.quota});s.setState({orgInfo:t}),D.A.success((0,p.APU)("Successfully set quota."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateName=function(e){var t={orgName:e};U.H.sysAdminUpdateOrg(s.props.orgID,t).then((function(e){var t=Object.assign(s.state.orgInfo,{org_name:e.data.org_name});s.setState({orgInfo:t}),D.A.success((0,p.APU)("Successfully set name."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateMaxUserNumber=function(e){var t={maxUserNumber:e};U.H.sysAdminUpdateOrg(s.props.orgID,t).then((function(e){var t=Object.assign(s.state.orgInfo,{max_user_number:e.data.max_user_number});s.setState({orgInfo:t}),D.A.success((0,p.APU)("Successfully set max number of members."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgInfo:{}},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({loading:!1,orgInfo:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.orgInfo;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wn,{currentItem:"info",orgID:this.props.orgID,orgName:e.org_name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(In,{orgID:this.props.orgID,loading:this.state.loading,errorMsg:this.state.errorMsg,orgInfo:this.state.orgInfo,updateQuota:this.updateQuota,updateName:this.updateName,updateMaxUserNumber:this.updateMaxUserNumber})})]})})]})}}])}(l.Component);C().extend(ve());var Mn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No members")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Role")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Space Used")}),(0,v.jsxs)("th",{width:"25%",children:[(0,p.APU)("Created At")," / ",(0,p.APU)("Last Login")]}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Cn,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,toggleItemFreezed:e.toggleItemFreezed,updateStatus:e.props.updateStatus,updateMembership:e.props.updateMembership,deleteUser:e.props.deleteUser},s)}))})]})});return r.length?a:i}}])}(l.Component),Cn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteDialog();break;case"Reset Password":s.toggleResetPasswordDialog()}},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleResetPasswordDialog=function(e){e&&e.preventDefault(),s.setState({isResetPasswordDialogOpen:!s.state.isResetPasswordDialogOpen})},s.toggleConfirmInactiveDialog=function(e){"active"!==(null===e||void 0===e?void 0:e.value)&&s.setState({isConfirmInactiveDialogOpen:!s.state.isConfirmInactiveDialogOpen})},s.updateStatus=function(e){s.props.updateStatus(s.props.item.email,e.value)},s.setUserInactive=function(e){s.props.updateStatus(s.props.item.email,"inactive",{keepSharing:e})},s.updateMembership=function(e){s.props.updateMembership(s.props.item.email,e.value)},s.deleteUser=function(){var e=s.props.item;s.props.deleteUser(e.org_id,e.email)},s.resetPassword=function(){U.H.sysAdminResetUserPassword(s.props.item.email).then((function(e){D.A.success(e.data.reset_tip)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.APU)("Delete");break;case"Reset Password":t=(0,p.APU)("Reset Password")}return t},s.translateStatus=function(e){switch(e){case"active":return(0,p.APU)("Active");case"inactive":return(0,p.APU)("Inactive")}},s.translateMembership=function(e){switch(e){case"Admin":return(0,p.APU)("Admin");case"Member":return(0,p.APU)("Member")}},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1,isResetPasswordDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props.item,s=this.state,n=s.highlight,r=s.isOpIconShown,i=s.isDeleteDialogOpen,a=s.isResetPasswordDialogOpen,o=s.isConfirmInactiveDialogOpen,c='<span class="op-target">'+m.Aq.HTMLescape(t.name)+"</span>",d=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",c),u=(0,p.APU)("Are you sure you want to reset the password of {placeholder} ?").replace("{placeholder}",c),h=t.active?"active":"inactive";this.statusOptions=["active","inactive"].map((function(t){return{value:t,text:e.translateStatus(t),isSelected:t==h}}));var g=this.statusOptions.filter((function(e){return e.isSelected}))[0],f=t.is_org_staff?"Admin":"Member";this.membershipOptions=["Admin","Member"].map((function(t){return{value:t,text:e.translateMembership(t),isSelected:t==f}}));var x=this.membershipOptions.filter((function(e){return e.isSelected}))[0];return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:t.email,name:t.name})}),(0,v.jsx)("td",{children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:n,currentSelectedOption:g,options:this.statusOptions,selectOption:this.updateStatus,toggleItemFreezed:this.props.toggleItemFreezed,operationBeforeSelect:t.active?this.toggleConfirmInactiveDialog:void 0})}),(0,v.jsx)("td",{children:(0,v.jsx)(Pe.A,{isDropdownToggleShown:n,currentSelectedOption:x,options:this.membershipOptions,selectOption:this.updateMembership,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(t.quota_usage)," / ").concat(t.quota_total>0?m.Aq.bytesToSize(t.quota_total):"--")}),(0,v.jsxs)("td",{children:[C()(t.create_time).format("YYYY-MM-DD HH:mm:ss")," / ",t.last_login?C()(t.last_login).fromNow():"--"]}),(0,v.jsx)("td",{children:r&&t.email!=p.Xh_&&(0,v.jsx)(je.A,{operations:["Delete","Reset Password"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),i&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Member"),message:d,executeOperation:this.deleteUser,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteDialog}),a&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Reset Password"),message:u,executeOperation:this.resetPassword,confirmBtnText:(0,p.APU)("Reset"),toggleDialog:this.toggleResetPasswordDialog}),o&&(0,v.jsx)(we,{toggleDialog:this.toggleConfirmInactiveDialog,onSubmit:this.setUserInactive})]})}}])}(l.Component),Ln=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleAddUserDialog=function(){s.setState({isAddUserDialogOpen:!s.state.isAddUserDialogOpen})},s.addUser=function(e){var t=e.email,n=e.name,r=e.password;U.H.sysAdminAddOrgUser(s.props.orgID,t,n,r).then((function(e){var t=s.state.userList;t.unshift(e.data),s.setState({userList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteUser=function(e,t){U.H.sysAdminDeleteOrgUser(e,t).then((function(e){var n=s.state.userList.filter((function(e){return e.email!=t}));s.setState({userList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateStatus=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="active"==t;U.H.sysAdminUpdateOrgUser(s.props.orgID,e,"active",r,n).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.active=t.data.active),s}));s.setState({userList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateMembership=function(e,t){var n="Admin"==t;U.H.sysAdminUpdateOrgUser(s.props.orgID,e,"is_org_staff",n).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.is_org_staff=t.data.is_org_staff),s}));s.setState({userList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgName:"",userList:[],isAddUserDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({orgName:t.data.org_name})})),U.H.sysAdminListOrgUsers(this.props.orgID).then((function(t){e.setState({loading:!1,userList:t.data.users})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.isAddUserDialogOpen,s=e.orgName;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddUserDialog,children:(0,p.APU)("Add Member")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wn,{currentItem:"users",orgID:this.props.orgID,orgName:s}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Mn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,updateStatus:this.updateStatus,updateMembership:this.updateMembership,deleteUser:this.deleteUser})})]})}),t&&(0,v.jsx)(Ut,{addUser:this.addUser,toggleDialog:this.toggleAddUserDialog})]})}}])}(l.Component),_n=Ln,On=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No groups")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Creator")}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Created At")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Rn,{item:t,deleteGroup:e.props.deleteGroup},s)}))})]})});return r.length?a:i}}])}(l.Component),Rn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleDeleteDialog=function(){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteGroup=function(){s.toggleDeleteDialog(),s.props.deleteGroup(s.props.item.group_id)},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isHighlighted,i='<span class="op-target">'+m.Aq.HTMLescape(e.group_name)+"</span>",a=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",i),o="".concat(p.YcY,"sys/groups/").concat(e.group_id,"/libraries/");return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:st()({"tr-highlight":r}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("a",{href:o,children:e.group_name})}),(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.creator_email,name:e.creator_name})}),(0,v.jsx)("td",{children:C()(e.created_at).format("YYYY-MM-DD HH:mm:ss")}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(s?"":"invisible"),title:(0,p.APU)("Delete"),onClick:this.toggleDeleteDialog})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Group"),message:a,executeOperation:this.deleteGroup,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),Tn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).deleteGroup=function(e){U.H.sysAdminDismissGroupByID(e).then((function(t){var n=s.state.groupList.filter((function(t){return t.group_id!=e}));s.setState({groupList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgName:"",groupList:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({orgName:t.data.org_name})})),U.H.sysAdminListOrgGroups(this.props.orgID).then((function(t){e.setState({loading:!1,groupList:t.data.group_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wn,{currentItem:"groups",orgID:this.props.orgID,orgName:this.state.orgName}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(On,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.groupList,deleteGroup:this.deleteGroup})})]})})]})}}])}(l.Component),Fn=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No libraries")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"35%",children:"ID"}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(En,{item:t,deleteRepo:e.props.deleteRepo},s)}))})]})});return r.length?a:i}}])}(l.Component),En=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteRepo=function(){s.props.deleteRepo(s.props.item.repo_id)},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isHighlighted,i=m.Aq.getLibIconUrl(e),a=m.Aq.getLibIconTitle(e),o='<span class="op-target">'+m.Aq.HTMLescape(e.repo_name)+"</span>",c=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:st()({"tr-highlight":r}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:i,title:a,alt:a,width:"24"})}),(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_id}),(0,v.jsx)("td",{children:e.owner_email?-1==e.owner_email.indexOf("@seafile_group")?(0,v.jsx)(ye,{email:e.owner_email,name:e.owner_name}):e.owner_name:"--"}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(s?"":"invisible"),title:(0,p.APU)("Delete"),onClick:this.toggleDeleteDialog})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Library"),message:c,executeOperation:this.deleteRepo,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),Bn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).deleteRepo=function(e){U.H.sysAdminDeleteRepo(e).then((function(t){var n=s.state.repoList.filter((function(t){return t.repo_id!=e}));s.setState({repoList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgName:"",repoList:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({orgName:t.data.org_name})})),U.H.sysAdminListOrgRepos(this.props.orgID).then((function(t){e.setState({loading:!1,repoList:t.data.repo_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wn,{currentItem:"repos",orgID:this.props.orgID,orgName:this.state.orgName}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Fn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList,deleteRepo:this.deleteRepo})})]})})]})}}])}(l.Component),zn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleChange=function(e){var t=e.target.value;s.setState({value:t,isSubmitBtnActive:""!=t.trim()})},s.handleSubmit=function(){s.toggle(),s.props.addInstitution(s.state.value.trim())},s.toggle=function(){s.props.toggle()},s.state={value:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("Add institution")}),(0,v.jsx)(Ue.A,{children:(0,v.jsxs)(he.A,{children:[(0,v.jsx)("p",{children:(0,p.APU)("Name")}),(0,v.jsx)(ge.A,{children:(0,v.jsx)(G.A,{name:"institution-name",value:this.state.value,onChange:this.handleChange})})]})}),(0,v.jsx)(Ne.A,{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.APU)("Submit")})})]})}}])}(l.Component);C().extend(ve());var Yn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.props.getInstitutionsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getInstitutionsByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.perPage,a=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var c=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No institutions")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"75%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Created At")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Hn,{item:t,deleteInstitution:e.props.deleteInstitution},s)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:o,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),Hn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteInstitution=function(){s.props.deleteInstitution(s.props.item.id)},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isHighlighted,i='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",a=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",i);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:st()({"tr-highlight":r}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/institutions/").concat(e.id,"/info/"),children:e.name})}),(0,v.jsx)("td",{children:C()(e.ctime).fromNow()}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(s?"":"invisible"),title:(0,p.APU)("Delete"),onClick:this.toggleDeleteDialog})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Institution"),message:a,executeOperation:this.deleteInstitution,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),qn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getInstitutionsByPage=function(e){var t=s.state.perPage;U.H.sysAdminListInstitutions(e,t).then((function(n){s.setState({loading:!1,institutionList:n.data.institution_list,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getInstitutionsByPage(s.initPage)}))},s.toggleAddInstitutionDialog=function(){s.setState({isAddInstitutionDialogOpen:!s.state.isAddInstitutionDialogOpen})},s.addInstitution=function(e){U.H.sysAdminAddInstitution(e).then((function(e){var t=s.state.institutionList;t.push(e.data),s.setState({institutionList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteInstitution=function(e){U.H.sysAdminDeleteInstitution(e).then((function(t){var n=s.state.institutionList.filter((function(t){return t.id!=e}));s.setState({institutionList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionList:[],perPage:100,currentPage:1,hasNextPage:!1,isAddInstitutionDialogOpen:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getInstitutionsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isAddInstitutionDialogOpen,s=e.hasNextPage,r=e.currentPage,i=e.perPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddInstitutionDialog,children:(0,p.APU)("Add Institution")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Institutions")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Yn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.institutionList,deleteInstitution:this.deleteInstitution,currentPage:r,perPage:i,hasNextPage:s,getInstitutionsByPage:this.getInstitutionsByPage,resetPerPage:this.resetPerPage})})]})}),t&&(0,v.jsx)(zn,{addInstitution:this.addInstitution,toggle:this.toggleAddInstitutionDialog})]})}}])}(l.Component),Gn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"info",urlPart:"info",text:(0,p.APU)("Info")},{name:"members",urlPart:"members",text:(0,p.APU)("Members")},{name:"admins",urlPart:"admins",text:(0,p.APU)("Admins")}],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.currentItem,s=e.institutionID,n=e.institutionName;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/institutions/"),children:(0,p.APU)("Institutions")})," / ",n]})}),(0,v.jsx)("ul",{className:"nav border-bottom mx-4",children:this.navItems.map((function(e,n){return(0,v.jsx)("li",{className:"nav-item mr-2",children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/institutions/").concat(s,"/").concat(e.urlPart,"/"),className:"nav-link ".concat(t==e.name?" active":""),children:e.text})},n)}))})]})}}])}(l.Component),Qn=Gn,Vn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.state={isSetQuotaDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.institutionInfo;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var r=n.name,i=n.user_count,a=n.quota_total,o=n.quota_used,l=this.state.isSetQuotaDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("dl",{className:"m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Name")}),(0,v.jsx)("dd",{className:"info-item-content",children:r}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Number of members")}),(0,v.jsx)("dd",{className:"info-item-content",children:i}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.APU)("Space Used")}),(0,v.jsxs)("dd",{className:"info-item-content",children:["".concat(m.Aq.bytesToSize(o)," / ").concat(a>0?m.Aq.bytesToSize(a):"--"),(0,v.jsx)(Fe.A,{onClick:this.toggleSetQuotaDialog})]})]}),l&&(0,v.jsx)(me.A,{updateQuota:this.props.updateQuota,toggle:this.toggleSetQuotaDialog})]})}}])}(l.Component),Wn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).updateQuota=function(e){U.H.sysAdminUpdateInstitution(s.props.institutionID,e).then((function(e){var t=Object.assign(s.state.institutionInfo,{quota_total:e.data.quota_total});s.setState({institutionInfo:t}),D.A.success((0,p.APU)("Successfully set quota."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionInfo:{}},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetInstitution(this.props.institutionID).then((function(t){e.setState({loading:!1,institutionInfo:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.institutionInfo;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Qn,{currentItem:"info",institutionID:this.props.institutionID,institutionName:e.name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Vn,{loading:this.state.loading,errorMsg:this.state.errorMsg,institutionInfo:this.state.institutionInfo,updateQuota:this.updateQuota})})]})})]})}}])}(l.Component),Kn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleSubmit=function(){if(s.state.selectedUsers){var e=s.state.selectedUsers.map((function(e){return e.email}));s.props.addUser(e)}},s.state={selectedUsers:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(be.A,{toggle:this.props.toggle,children:(0,p.APU)("Add Member")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(Dt.A,{placeholder:(0,p.APU)("Search users"),onSelectChange:this.handleSelectChange,isMulti:!0,className:"org-add-member-select",selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:(0,p.APU)("Submit")}),(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.APU)("Cancel")})]})]})}}])}(l.Component);C().extend(ve());var Xn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getInstitutionUsersByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getInstitutionUsersByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.perPage,a=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var c=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No members")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Space Used")}),(0,v.jsxs)("th",{width:"40%",children:[(0,p.APU)("Created At")," / ",(0,p.APU)("Last Login")]}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)($n,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,setAdmin:e.props.setAdmin,deleteUser:e.props.deleteUser},s)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:o,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),$n=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleSetAdminDialog=function(e){e&&e.preventDefault(),s.setState({isSetAdminDialogOpen:!s.state.isSetAdminDialogOpen})},s.setAdmin=function(){s.props.setAdmin(s.props.item.email)},s.onMenuItemClick=function(e){switch(e){case"Delete":s.props.deleteUser(s.props.item.email);break;case"Set Admin":s.toggleSetAdminDialog()}},s.getOperations=function(){var e=[];return s.props.item.is_institution_admin||e.push("Set Admin"),e.push("Delete"),e},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.APU)("Delete");break;case"Set Admin":t=(0,p.APU)("Set Admin")}return t},s.state={isOpIconShown:!1,highlight:!1,isSetAdminDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isSetAdminDialogOpen,r='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",i=(0,p.APU)("Are you sure you want to set {placeholder} as Admin?").replace("{placeholder}",r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.is_active?(0,p.APU)("Active"):(0,p.APU)("Inactive")}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(e.quota_usage)," / ").concat(e.quota_total>0?m.Aq.bytesToSize(e.quota_total):"--")}),(0,v.jsxs)("td",{children:[C()(e.create_time).format("YYYY-MM-DD HH:mm:ss")," / ",e.last_login?C()(e.last_login).fromNow():"--"]}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(je.A,{operations:this.getOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Set Admin"),message:i,executeOperation:this.setAdmin,toggleDialog:this.toggleSetAdminDialog,confirmBtnText:(0,p.APU)("Set Admin")})]})}}])}(l.Component),Jn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getInstitutionUsersByPage=function(e){var t=s.state.perPage;U.H.sysAdminListInstitutionUsers(s.props.institutionID,e,t).then((function(n){s.setState({loading:!1,userList:n.data.user_list,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.setAdmin=function(e){U.H.sysAdminUpdateInstitutionUser(s.props.institutionID,e,!0).then((function(t){var n=s.state.userList.map((function(t){return t.email==e&&(t.is_institution_admin=!0),t}));s.setState({userList:n}),D.A.success((0,p.APU)("Admin updated"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.toggleAddUserDialog=function(){s.setState({isAddUserDialogOpen:!s.state.isAddUserDialogOpen})},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getInstitutionUsersByPage(s.initPage)}))},s.addUser=function(e){U.H.sysAdminAddInstitutionUserBatch(s.props.institutionID,e).then((function(e){s.toggleAddUserDialog();var t=e.data.success,n=e.data.failed;if(t.length){var r=s.state.userList.concat(t);s.setState({userList:r})}n.forEach((function(e){D.A.danger(e.error_msg)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteUser=function(e){U.H.sysAdminDeleteInstitutionUser(s.props.institutionID,e).then((function(t){var n=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:n}),D.A.success((0,p.APU)("User deleted"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionName:"",userList:[],perPage:100,currentPage:1,hasNextPage:!1,isAddUserDialogOpen:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetInstitution(this.props.institutionID).then((function(t){e.setState({institutionName:t.data.name})}));var t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getInstitutionUsersByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isAddUserDialogOpen,s=e.institutionName,r=e.hasNextPage,i=e.currentPage,a=e.perPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddUserDialog,children:(0,p.APU)("Add Member")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Qn,{currentItem:"members",institutionID:this.props.institutionID,institutionName:s}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Xn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,setAdmin:this.setAdmin,deleteUser:this.deleteUser,currentPage:i,perPage:a,hasNextPage:r,getInstitutionUsersByPage:this.getInstitutionUsersByPage,resetPerPage:this.resetPerPage})})]})}),t&&(0,v.jsx)(Kn,{addUser:this.addUser,toggle:this.toggleAddUserDialog})]})}}])}(l.Component);C().extend(ve());var Zn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No admins")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Space Used")}),(0,v.jsxs)("th",{width:"40%",children:[(0,p.APU)("Created At")," / ",(0,p.APU)("Last Login")]}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(er,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,revokeAdmin:e.props.revokeAdmin,deleteUser:e.props.deleteUser},s)}))})]})});return r.length?a:i}}])}(l.Component),er=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleRevokeAdminDialog=function(e){e&&e.preventDefault(),s.setState({isRevokeAdminDialogOpen:!s.state.isRevokeAdminDialogOpen})},s.revokeAdmin=function(){s.props.revokeAdmin(s.props.item)},s.onMenuItemClick=function(e){if("Revoke Admin"===e)s.toggleRevokeAdminDialog()},s.translateOperations=function(e){var t="";if("Revoke Admin"===e)t=(0,p.APU)("Revoke Admin");return t},s.state={isOpIconShown:!1,highlight:!1,isRevokeAdminDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isRevokeAdminDialogOpen,r='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",i=(0,p.APU)("Are you sure you want to revoke the admin permission of {placeholder} ?").replace("{placeholder}",r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.is_active?(0,p.APU)("Active"):(0,p.APU)("Inactive")}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(e.quota_usage)," / ").concat(e.quota_total>0?m.Aq.bytesToSize(e.quota_total):"--")}),(0,v.jsxs)("td",{children:[C()(e.create_time).format("YYYY-MM-DD HH:mm:ss")," / ",e.last_login?C()(e.last_login).fromNow():"--"]}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(je.A,{operations:["Revoke Admin"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Revoke Admin"),message:i,executeOperation:this.revokeAdmin,confirmBtnText:(0,p.APU)("Revoke"),toggleDialog:this.toggleRevokeAdminDialog})]})}}])}(l.Component),tr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).revokeAdmin=function(e){var t=e.email,n=e.name;U.H.sysAdminUpdateInstitutionUser(s.props.institutionID,t,!1).then((function(e){var r=s.state.userList.filter((function(e){return e.email!=t}));s.setState({userList:r}),D.A.success((0,p.APU)("Successfully revoked the admin permission of {placeholder}.").replace("{placeholder}",n))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteUser=function(e){U.H.sysAdminDeleteInstitutionUser(s.props.institutionID,e).then((function(t){var n=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:n}),D.A.success((0,p.APU)("User deleted"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionName:"",userList:[],isAddUserDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetInstitution(this.props.institutionID).then((function(t){e.setState({institutionName:t.data.name})})),U.H.sysAdminListInstitutionAdmins(this.props.institutionID).then((function(t){e.setState({loading:!1,userList:t.data.user_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.institutionName;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Qn,{currentItem:"admins",institutionID:this.props.institutionID,institutionName:e}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Zn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,revokeAdmin:this.revokeAdmin,deleteUser:this.deleteUser})})]})})]})}}])}(l.Component),sr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleClickOutside=function(e){s.props.isOpen&&!s.userSelector.contains(e.target)&&s.props.onToggle()},s.onToggleClick=function(e){e.stopPropagation(),s.props.onToggle()},s.onQueryChange=function(e){var t=e.target.value;s.setState({query:t}),s.handleSearchUser(t)},s.handleSearchUser=function(e){e.trim()?(s.setState({isLoading:!0}),s.finalValue=e,setTimeout((function(){s.finalValue===e&&(s.props.searchUsersFunc&&s.props.searchUsersFunc(e).then((function(t){var n=t.data.user_list||t.data.users||[];s.setState({searchResults:n,isLoading:!1},(function(){s.props.searchGroupsFunc&&s.props.searchGroupsFunc(e).then((function(e){var t=e.data.group_list||e.data.groups||[];s.setState({searchResults:[].concat((0,Zs.default)(n),(0,Zs.default)(t))})}))}))})).catch((function(e){s.setState({isLoading:!1});var t=m.Aq.getErrorMsg(e);D.A.danger(t)})),s.props.searchGroupsFunc&&!s.props.searchUsersFunc&&s.props.searchGroupsFunc(e).then((function(e){var t=e.data.group_list||e.data.groups||[];s.setState({searchResults:t,isLoading:!1})})))}),500)):s.setState({searchResults:[]})},s.toggleSelectItem=function(e,t){e.stopPropagation(),s.props.onSelect(t,!1)},s.state={query:"",searchResults:[],isLoading:!1},s.dropdownRef=l.createRef(),s.finalValue="",s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClickOutside)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClickOutside)}},{key:"render",value:function(){var e=this,t=this.state,s=t.query,n=t.isLoading,r=t.searchResults,i=this.props,a=i.selectedItems,o=i.isOpen,l=s.trim()?r:this.props.items;return(0,v.jsxs)("div",{className:"position-relative d-inline-block ml-2",ref:this.dropdownRef,children:[(0,v.jsxs)("span",{className:"cur-activity-modifiers d-inline-block p-2 rounded",onClick:this.onToggleClick,children:[a.length>0?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:this.props.componentName+":"}),(0,v.jsx)("span",{className:"d-inline-block ml-1",children:a.map((function(e){return e.name})).join(", ")})]}):this.props.componentName,(0,v.jsx)("i",{className:"sf3-font sf3-font-down ml-2 toggle-icon"})]}),o&&(0,v.jsxs)("div",{className:"position-absolute activity-modifier-selector-container rounded shadow",ref:function(t){return e.userSelector=t},children:[(0,v.jsx)("ul",{className:"activity-selected-modifiers px-3 py-1 list-unstyled",children:a.map((function(t,s){return(0,v.jsxs)("li",{className:"activity-selected-modifier",children:[(0,v.jsx)("img",{src:t.avatar_url,className:"avatar w-5 h-5",alt:""}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name}),(0,v.jsx)("i",{className:"sf2-icon-close unselect-activity-user ml-2",onClick:function(s){e.toggleSelectItem(s,t)}})]},s)}))}),(0,v.jsx)("div",{className:"px-3 pt-3",children:(0,v.jsx)(G.A,{type:"text",placeholder:(0,p.APU)("Find users"),value:s,onChange:this.onQueryChange})}),(0,v.jsx)("ul",{className:"activity-user-list list-unstyled p-3 o-auto",children:n?(0,v.jsx)("li",{className:"text-center",children:(0,p.APU)("Loading...")}):0===l.length?(0,v.jsx)("li",{className:"text-center",children:s?(0,p.APU)("User not found"):(0,p.APU)("Enter characters to start searching")}):l.map((function(t,s){var n=a.some((function(e){return t.email&&e.email===t.email||t.id&&e.id===t.id}));return(0,v.jsxs)("li",{className:"activity-user-item h-6 p-1 rounded d-flex justify-content-between align-items-center",onClick:function(s){e.toggleSelectItem(s,t)},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("img",{src:t.avatar_url,className:"avatar w-5 h-5",alt:""}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name})]}),n&&(0,v.jsx)("i",{className:"sf2-icon-tick text-gray font-weight-bold"})]},s)}))})]})]})}}])}(l.Component),nr=sr;C().extend(ve());var rr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,i=e.currentPage,a=e.hasNextPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No login logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("IP")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Time")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(ir,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),ir=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.login_ip}),(0,v.jsx)("td",{children:e.log_success?(0,p.APU)("Success"):(0,p.APU)("Failed")}),(0,v.jsx)("td",{children:C()(e.login_time).fromNow()})]})}}])}(l.Component),ar=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers.map((function(e){return e.email}));U.H.sysAdminListLoginLogs(e,n,{email:r}).then((function(t){s.setState({logList:t.data.login_log_list,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,n,t.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleUserFilter=function(e){var t,n=s.state.selectedUsers;null===e?t=n:t=n.find((function(t){return t.email===e.email}))?n.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(n),[e]);s.setState({selectedUsers:t,currentPage:1})},s.toggleUserSelector=function(){var e=s.state.isUserSelectorOpen;s.setState({isUserSelectorOpen:!e},(function(){s.state.isUserSelectorOpen||s.getLogsByPage(1)}))},s.searchUsers=function(e){return U.H.sysAdminSearchUsers(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedUsers:[],isUserSelectorOpen:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.logList,s=e.currentPage,n=e.perPage,r=e.hasNextPage,i=e.availableUsers,a=e.selectedUsers;return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsx)(nr,{componentName:(0,p.APU)("Users"),items:i,selectedItems:a,onSelect:this.handleUserFilter,isOpen:this.state.isUserSelectorOpen,onToggle:this.toggleUserSelector,searchUsersFunc:this.searchUsers}),(0,v.jsx)(rr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:n,hasNextPage:r,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})})}}])}(l.Component),or=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleClickOutside=function(e){s.props.isOpen&&!s.repoSelector.contains(e.target)&&s.props.onToggle()},s.onToggleClick=function(e){e.stopPropagation(),s.props.onToggle()},s.onQueryChange=function(e){var t=e.target.value;s.setState({query:t}),s.searchRepos(t)},s.searchRepos=function(e){s.finalValue=e,e.length>0?(s.setState({isLoading:!0}),setTimeout((function(){s.finalValue===e&&s.props.searchReposFunc(e).then((function(e){var t=e.data.repo_list||e.data.repos||[];s.setState({searchResults:t,isLoading:!1})})).catch((function(e){s.setState({isLoading:!1});var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}),500)):s.setState({searchResults:[]})},s.toggleSelectItem=function(e,t){e.stopPropagation(),s.props.onSelect(t,!1)},s.state={query:"",isLoading:!1,searchResults:[]},s.dropdownRef=l.createRef(),s.finalValue="",s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClickOutside)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClickOutside)}},{key:"render",value:function(){var e=this,t=this.state,s=t.query,n=t.isLoading,r=t.searchResults,i=this.props,a=i.selectedItems,o=i.isOpen,l=s.trim()?r:this.props.items;return(0,v.jsxs)("div",{className:"position-relative d-inline-block",ref:this.dropdownRef,children:[(0,v.jsxs)("span",{className:"cur-activity-modifiers d-inline-block p-2 rounded",onClick:this.onToggleClick,children:[a.length>0?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:[(0,p.APU)("Libraries"),":"]}),(0,v.jsx)("span",{className:"d-inline-block ml-1",children:a.map((function(e){return e.name})).join(", ")})]}):(0,p.APU)("Libraries"),(0,v.jsx)("i",{className:"sf3-font sf3-font-down ml-2 toggle-icon"})]}),o&&(0,v.jsxs)("div",{className:"position-absolute activity-modifier-selector-container rounded shadow",ref:function(t){return e.repoSelector=t},children:[(0,v.jsx)("ul",{className:"activity-selected-modifiers px-3 py-1 list-unstyled",children:a.map((function(t,s){return(0,v.jsxs)("li",{className:"activity-selected-modifier",children:[(0,v.jsx)("i",{className:"fas fa-folder"}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name}),(0,v.jsx)("i",{className:"sf2-icon-close unselect-activity-user ml-2",onClick:function(s){e.toggleSelectItem(s,t)}})]},s)}))}),(0,v.jsx)("div",{className:"px-3 pt-3",children:(0,v.jsx)(G.A,{type:"text",placeholder:(0,p.APU)("Find libraries"),value:s,onChange:this.onQueryChange})}),(0,v.jsx)("ul",{className:"activity-user-list list-unstyled p-3 o-auto",children:n?(0,v.jsx)("li",{className:"text-center",children:(0,p.APU)("Loading...")}):0===l.length?(0,v.jsx)("li",{className:"text-center",children:s?(0,p.APU)("Library not found"):(0,p.APU)("Enter characters to start searching")}):l.map((function(t,s){var n=a.some((function(e){return e.id===t.id}));return(0,v.jsxs)("li",{className:"activity-user-item h-6 p-1 rounded d-flex justify-content-between align-items-center",onClick:function(s){e.toggleSelectItem(s,t)},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("i",{className:"fas fa-folder"}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name})]}),n&&(0,v.jsx)("i",{className:"sf2-icon-tick text-gray font-weight-bold"})]},s)}))})]})]})}}])}(l.Component),lr=or;C().extend(ve());var cr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.props.getLogsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getLogsByPage(s.props.currentPage+1)},s.toggleFreezeItem=function(e){s.setState({isItemFreezed:e})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.perPage,a=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var c=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No file access logs")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Type")}),(0,v.jsxs)("th",{width:"20%",children:[(0,p.APU)("IP")," / ",(0,p.APU)("Device")]}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Date")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Library")}),(0,v.jsxs)("th",{width:"15%",children:[(0,p.APU)("File")," / ",(0,p.APU)("Folder")]})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(dr,{item:t,isFreezed:e.state.isItemFreezed,toggleFreezeItem:e.toggleFreezeItem},s)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:o,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),dr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isFreezed||s.setState({isHighlighted:!0})},s.handleMouseLeave=function(){s.props.isFreezed||s.setState({isHighlighted:!1})},s.toggleFreezeItem=function(e){s.props.toggleFreezeItem(e),e||s.setState({isHighlighted:!1})},s.state={isHighlighted:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state.isHighlighted,t=this.props.item;return(0,v.jsxs)("tr",{className:e?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:t.email,name:t.name})}),(0,v.jsx)("td",{children:t.event_type}),(0,v.jsxs)("td",{children:[t.ip," / ",t.device||"--"]}),(0,v.jsx)("td",{children:C()(t.time).fromNow()}),(0,v.jsx)("td",{children:t.repo_name?t.repo_name:(0,p.APU)("Deleted")}),(0,v.jsx)("td",{children:t.file_or_dir_name})]})}}])}(l.Component),ur=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers,i=t.selectedRepos,a=r.map((function(e){return e.email})),o=i.map((function(e){return e.id}));U.H.sysAdminListFileAccessLogs(e,n,{email:a,repo:o}).then((function(t){s.setState({logList:t.data.file_access_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.updateURL=function(e){var t=new URL(location.href),s=new URLSearchParams(t.search);for(var n in e)null==e[n]?s.delete(n):s.set(n,e[n]);t.search=s.toString(),(0,h.oo)(t.toString())},s.handleUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=[]:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return U.H.sysAdminSearchUsers(e)},s.searchRepos=function(e){return U.H.sysAdminSearchRepos(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedUsers:[],availableRepos:[],selectedRepos:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,n=t.currentPage,r=t.perPage,i=t.hasNextPage,a=t.availableUsers,o=t.selectedUsers,l=t.availableRepos,c=t.selectedRepos,d=t.openSelector;return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(nr,{componentName:(0,p.APU)("Users"),items:a,selectedItems:o,onSelect:this.handleUserFilter,isOpen:"user"===d,onToggle:function(){return e.handleSelectorToggle("user")},searchUsersFunc:this.searchUsers}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(lr,{items:l,selectedItems:c,onSelect:this.handleRepoFilter,isOpen:"repo"===d,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(cr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:n,perPage:r,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})})}}])}(l.Component),hr=ur,gr=s(33e3);C().extend(ve());var pr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,i=e.currentPage,a=e.hasNextPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No file update logs")}),l=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Date")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Action")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(mr,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?l:o}}])}(l.Component),mr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.toggleCommitDetailsDialog=function(){s.setState({isCommitDetailsDialogOpen:!s.state.isCommitDetailsDialogOpen})},s.showCommitDetails=function(e){e.preventDefault(),s.setState({isCommitDetailsDialogOpen:!s.state.isCommitDetailsDialogOpen})},s.state={isOpIconShown:!1,isCommitDetailsDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:C()(e.time).fromNow()}),(0,v.jsx)("td",{children:e.repo_name?e.repo_name:(0,p.APU)("Deleted")}),(0,v.jsxs)("td",{children:[e.file_operation,e.repo_name&&!e.repo_encrypted&&(0,v.jsx)("a",{className:"ml-1",href:"#",onClick:this.showCommitDetails,children:(0,p.APU)("Details")})]})]}),this.state.isCommitDetailsDialogOpen&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(gr.A,{repoID:e.repo_id,commitID:e.commit_id,commitTime:e.time,toggleDialog:this.toggleCommitDetailsDialog})})]})}}])}(l.Component),fr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleExportExcelDialog=function(){s.setState({isExportExcelDialogOpen:!s.state.isExportExcelDialogOpen})},s.getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers,i=t.selectedRepos,a=r.map((function(e){return e.email})),o=i.map((function(e){return e.id}));U.H.sysAdminListFileUpdateLogs(e,n,{email:a,repo:o}).then((function(t){s.setState({logList:t.data.file_update_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=r:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return U.H.sysAdminSearchUsers(e)},s.searchRepos=function(e){return U.H.sysAdminSearchRepos(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedUsers:[],availableRepos:[],selectedRepos:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,n=t.currentPage,r=t.perPage,i=t.hasNextPage,a=t.availableUsers,o=t.selectedUsers,l=t.availableRepos,c=t.selectedRepos;return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(nr,{componentName:(0,p.APU)("Users"),items:a,selectedItems:o,onSelect:this.handleUserFilter,isOpen:"user"===this.state.openSelector,onToggle:function(){return e.handleSelectorToggle("user")},searchUsersFunc:this.searchUsers}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(lr,{items:l,selectedItems:c,onSelect:this.handleRepoFilter,isOpen:"repo"===this.state.openSelector,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(pr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:n,perPage:r,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})})}}])}(l.Component),xr=fr;C().extend(ve());var vr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,i=e.currentPage,a=e.hasNextPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No permission logs")}),l=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Share From")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Share To")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Actions")}),(0,v.jsx)("th",{width:"13%",children:(0,p.APU)("Permission")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"12%",children:(0,p.APU)("Folder")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Date")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Ar,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?l:o}}])}(l.Component),Ar=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).getActionTextByEType=function(e){return-1!=e.indexOf("add")?(0,p.APU)("Add"):-1!=e.indexOf("modify")?(0,p.APU)("Modify"):-1!=e.indexOf("delete")?(0,p.APU)("Delete"):""},e.getShareTo=function(e){switch(e.share_type){case"user":return(0,v.jsx)(ye,{email:e.to_user_email,name:e.to_user_name});case"group":case"department":return(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/groups/").concat(e.to_group_id,"/libraries/"),children:e.to_group_name});case"all":return(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"org/"),children:(0,p.APU)("All")});default:return(0,p.APU)("Deleted")}},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.from_user_email,name:e.from_user_name})}),(0,v.jsx)("td",{children:this.getShareTo(e)}),(0,v.jsx)("td",{children:this.getActionTextByEType(e.etype)}),(0,v.jsx)("td",{children:m.Aq.sharePerms(e.permission)}),(0,v.jsx)("td",{children:e.repo_name?e.repo_name:(0,p.APU)("Deleted")}),(0,v.jsx)("td",{children:e.folder}),(0,v.jsx)("td",{children:C()(e.date).fromNow()})]})}}])}(l.Component),Pr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleExportExcelDialog=function(){s.setState({isExportExcelDialogOpen:!s.state.isExportExcelDialogOpen})},s.getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedFromUsers,i=t.selectedToUsers,a=t.selectedToGroups,o=t.selectedRepos,l={from_email:r.map((function(e){return e.email})),to_email:i.map((function(e){return e.email})),to_group:a.map((function(e){return e.id})),repo:o.map((function(e){return e.id}))};U.H.sysAdminListSharePermissionLogs(e,n,l).then((function(t){s.setState({logList:t.data.share_permission_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleFromUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedFromUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedFromUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleToUserFilter=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=s.state,r=n.selectedToUsers,i=n.selectedToGroups,a=r,o=i;null===e?(a=r,o=i):e.email?a=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e]):o=i.find((function(t){return t.id===e.id}))?i.filter((function(t){return t.id!==e.id})):[].concat((0,Zs.default)(i),[e]);s.setState({selectedToUsers:a,selectedToGroups:o,currentPage:1},(function(){t&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=r:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return U.H.sysAdminSearchUsers(e)},s.searchRepos=function(e){return U.H.sysAdminSearchRepos(e)},s.searchGroups=function(e){return U.H.sysAdminSearchGroups(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedFromUsers:[],selectedToUsers:[],selectedToGroups:[],availableRepos:[],selectedRepos:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,n=t.currentPage,r=t.perPage,i=t.hasNextPage,a=t.availableUsers,o=t.selectedFromUsers,l=t.selectedToUsers,c=t.selectedToGroups,d=t.availableRepos,u=t.selectedRepos,h=t.openSelector;return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(nr,{componentName:(0,p.APU)("Share From"),items:a,selectedItems:o,onSelect:this.handleFromUserFilter,isOpen:"fromUser"===h,onToggle:function(){return e.handleSelectorToggle("fromUser")},searchUsersFunc:this.searchUsers}),(0,v.jsx)(nr,{componentName:(0,p.APU)("Share To"),items:a,selectedItems:[].concat((0,Zs.default)(l),(0,Zs.default)(c)),onSelect:this.handleToUserFilter,isOpen:"toUser"===h,onToggle:function(){return e.handleSelectorToggle("toUser")},searchUsersFunc:this.searchUsers,searchGroupsFunc:this.searchGroups}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(lr,{items:d,selectedItems:u,onSelect:this.handleRepoFilter,isOpen:"repo"===h,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(vr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:n,perPage:r,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})})}}])}(l.Component),jr=Pr;C().extend(ve());var Sr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,i=e.currentPage,a=e.hasNextPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No transfer logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Transfer From")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Transfer To")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Operator")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Date")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(yr,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),yr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.getTransferTo=function(e){switch(e.to_type){case"user":return(0,v.jsx)(ye,{email:e.to_user_email,name:e.to_user_name});case"group":return(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/groups/").concat(e.to_group_id,"/libraries/"),children:e.to_group_name});default:return(0,p.APU)("Deleted")}},s.getTransferFrom=function(e){switch(e.from_type){case"user":return(0,v.jsx)(ye,{email:e.from_user_email,name:e.from_user_name});case"group":return(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/groups/").concat(e.from_group_id,"/libraries/"),children:e.from_group_name});default:return(0,p.APU)("Deleted")}},s.getOperator=function(e){return(0,v.jsx)(ye,{email:e.operator_email,name:e.operator_name})},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:this.getTransferFrom(e)}),(0,v.jsx)("td",{children:this.getTransferTo(e)}),(0,v.jsx)("td",{children:this.getOperator(e)}),(0,v.jsx)("td",{children:e.repo_name?e.repo_name:(0,p.APU)("Deleted")}),(0,v.jsx)("td",{children:C()(e.date).fromNow()})]})}}])}(l.Component),Ur=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedFromUsers,i=t.selectedToUsers,a=t.selectedToGroups,o=t.selectedOperators,l=t.selectedRepos,c={from_email:r.filter((function(e){return e.email})).map((function(e){return e.email})),from_group:r.filter((function(e){return!e.email})).map((function(e){return e.id})),to_email:i.map((function(e){return e.email})),to_group:a.map((function(e){return e.to_group_id||e.id})),operator_email:o.map((function(e){return e.email})),repo:l.map((function(e){return e.id}))};U.H.sysAdminListFileTransferLogs(e,n,c).then((function(t){s.setState({logList:t.data.repo_transfer_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(t){s.setState({loading:!1,currentPage:e,errorMsg:m.Aq.getErrorMsg(t,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleFromUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedFromUsers;if(null===e)t=r;else if(e.email){t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e])}else{var i=e.id;if(r.find((function(e){return e.id===i})))t=r.filter((function(e){return e.id!==i}));else{var a={id:i,name:e.name,from_group_id:i,from_group_name:e.name};t=[].concat((0,Zs.default)(r),[a])}}s.setState({selectedFromUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleToUserFilter=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=s.state,r=n.selectedToUsers,i=n.selectedToGroups,a=r,o=i;if(null===e)a=r,o=i;else if(e.email){a=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e])}else{var l=e.to_group_id||e.id,c=e.to_group_name||e.name;if(i.find((function(e){return(e.to_group_id||e.id)===l})))o=i.filter((function(e){return(e.to_group_id||e.id)!==l}));else{var d={id:l,name:c,to_group_id:l,to_group_name:c};o=[].concat((0,Zs.default)(i),[d])}}s.setState({selectedToUsers:a,selectedToGroups:o,currentPage:1},(function(){t&&s.getLogsByPage(1)}))},s.handleOperatorFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedOperators;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedOperators:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=[]:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return U.H.sysAdminSearchUsers(e)},s.searchGroups=function(e){return U.H.sysAdminSearchGroups(e)},s.searchRepos=function(e){return U.H.sysAdminSearchRepos(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,availableUsers:[],selectedFromUsers:[],selectedToUsers:[],selectedToGroups:[],selectedOperators:[],openSelector:null,availableRepos:[],selectedRepos:[]},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,n=t.currentPage,r=t.perPage,i=t.hasNextPage,a=t.availableUsers,o=t.selectedFromUsers,l=t.selectedToUsers,c=t.selectedToGroups,d=t.selectedOperators,u=t.availableRepos,h=t.selectedRepos,g=t.openSelector,m=[].concat((0,Zs.default)(l),(0,Zs.default)(c.map((function(e){return{id:e.to_group_id||e.id,name:e.to_group_name||e.name,to_group_id:e.to_group_id||e.id,to_group_name:e.to_group_name||e.name}}))));return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(nr,{componentName:(0,p.APU)("Transfer From"),items:a,selectedItems:o,onSelect:this.handleFromUserFilter,isOpen:"fromUser"===g,onToggle:function(){return e.handleSelectorToggle("fromUser")},searchUsersFunc:this.searchUsers,searchGroupsFunc:this.searchGroups}),(0,v.jsx)(nr,{componentName:(0,p.APU)("Transfer To"),items:a,selectedItems:m,onSelect:this.handleToUserFilter,isOpen:"toUser"===g,onToggle:function(){return e.handleSelectorToggle("toUser")},searchUsersFunc:this.searchUsers,searchGroupsFunc:this.searchGroups}),(0,v.jsx)(nr,{componentName:(0,p.APU)("Operator"),items:a,selectedItems:d,onSelect:this.handleOperatorFilter,isOpen:"operator"===g,onToggle:function(){return e.handleSelectorToggle("operator")},searchUsersFunc:this.searchUsers}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(lr,{items:u,selectedItems:h,onSelect:this.handleRepoFilter,isOpen:"repo"===g,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(Sr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:n,perPage:r,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})})}}])}(l.Component),Dr=Ur;C().extend(ve());var Nr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,i=e.currentPage,a=e.hasNextPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No group invite logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("User")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Group")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Operator")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Action")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Date")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(br,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),br=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.getGroupName=function(e){return e.group_name?(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/groups/").concat(e.group_id,"/libraries/"),children:e.group_name}):(0,p.APU)("Deleted")},s.getActionTextByEType=function(e){return-1!=e.indexOf("group_member_add")?(0,p.APU)("Add member"):-1!=e.indexOf("group_member_delete")?(0,p.APU)("Delete member"):""},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.user_email,name:e.user_name})}),(0,v.jsx)("td",{children:this.getGroupName(e)}),(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.operator_email,name:e.operator_name})}),(0,v.jsx)("td",{children:this.getActionTextByEType(e.operation)}),(0,v.jsx)("td",{children:C()(e.date).fromNow()})]})}}])}(l.Component),wr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers,i=t.selectedOperators,a=t.selectedGroups,o={user_email:r.map((function(e){return e.email})),operator_email:i.map((function(e){return e.email})),group_id:a.map((function(e){return e.id}))};U.H.sysAdminListGroupInviteLogs(e,n,o).then((function(t){s.setState({logList:t.data.group_invite_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.handleUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleOperatorFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedOperators;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedOperators:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleGroupFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedGroups;null===e?t=r:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,Zs.default)(r),[e]);s.setState({selectedGroups:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return U.H.sysAdminSearchUsers(e)},s.searchGroups=function(e){return U.H.sysAdminSearchGroups(e)},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,availableUsers:[],selectedUsers:[],selectedOperators:[],selectedGroups:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,n=t.currentPage,r=t.perPage,i=t.hasNextPage,a=t.availableUsers,o=t.selectedUsers,l=t.selectedOperators,c=t.selectedGroups,d=t.openSelector;return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(nr,{componentName:(0,p.APU)("Member"),items:a,selectedItems:o,onSelect:this.handleUserFilter,isOpen:"user"===d,onToggle:function(){return e.handleSelectorToggle("user")},searchUsersFunc:this.searchUsers}),(0,v.jsx)(nr,{componentName:(0,p.APU)("Group"),items:a,selectedItems:c,onSelect:this.handleGroupFilter,isOpen:"group"===d,onToggle:function(){return e.handleSelectorToggle("group")},searchGroupsFunc:this.searchGroups}),(0,v.jsx)(nr,{componentName:(0,p.APU)("Operator"),items:a,selectedItems:l,onSelect:this.handleOperatorFilter,isOpen:"operator"===d,onToggle:function(){return e.handleSelectorToggle("operator")},searchUsersFunc:this.searchUsers})]}),(0,v.jsx)(Nr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:n,perPage:r,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})})}}])}(l.Component),Ir=wr,kr=s(72714),Mr=s(83970),Cr=s(15263),Lr=s(8123),_r=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleBtns=function(){s.setState({isBtnsShown:!s.state.isBtnsShown})},s.hideBtns=function(e){s.state.isBtnsShown&&(s.props.value!=s.state.value&&s.setState({value:s.props.value}),s.toggleBtns())},s.onInputChange=function(e){s.setState({value:e.target.value})},s.onSubmit=function(e){var t=s.state.value.trim();t!=s.props.value&&s.props.saveSetting(s.props.keyText,t),s.toggleBtns()},s.state={isBtnsShown:!1,value:s.props.value},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({value:e.value})}},{key:"render",value:function(){var e=this.state,t=e.isBtnsShown,s=e.value,n=this.props,r=n.helpTip,i=n.displayName,a=n.inputType;return(0,v.jsx)(Lr.A,{displayName:i,helpTip:r,mainContent:(0,v.jsx)(G.A,{type:a||"text",className:"textarea"==a?"web-setting-textarea":"",onChange:this.onInputChange,onFocus:this.toggleBtns,onBlur:this.hideBtns,value:s}),extraContent:t?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{color:"primary",className:"sf2-icon-tick web-setting-icon-btn web-setting-icon-btn-submit",onMouseDown:this.onSubmit,title:(0,p.APU)("Submit")}),(0,v.jsx)(y.A,{className:"ml-1 sf2-icon-x2 web-setting-icon-btn web-setting-icon-btn-cancel",title:(0,p.APU)("Cancel")})]}):null})}}])}(l.Component),Or=(s(37696),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).saveSetting=function(e,t){U.H.sysAdminSetSysSettingInfo(e,t).then((function(e){s.setState({config_dict:e.data}),D.A.success((0,p.APU)("System settings updated"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.postFile=function(e,t){var n;"Logo"==t?n=U.H.sysAdminUpdateLogo(e):"Favicon"==t?n=U.H.sysAdminUpdateFavicon(e):"loginBGImage"==t&&(n=U.H.sysAdminUpdateLoginBG(e)),n.then((function(e){"Logo"==t?s.setState({logoPath:e.data.logo_path}):"Favicon"==t?s.setState({faviconPath:e.data.favicon_path}):"loginBGImage"==t&&s.setState({loginBGPath:e.data.login_bg_image_path}),D.A.success((0,p.APU)("System settings updated"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",config_dict:null,logoPath:p.SGU+p.VIO,faviconPath:p.SGU+p.M$p,loginBGPath:p.SGU+p.sO},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetSysSettingInfo().then((function(t){e.setState({loading:!1,config_dict:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.loading,s=e.errorMsg,r=e.config_dict,i=e.logoPath,a=e.faviconPath,o=e.loginBGPath;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Settings")})}),(0,v.jsxs)("div",{className:"cur-view-content container mw-100",children:[t&&(0,v.jsx)(N.A,{}),s&&(0,v.jsx)("p",{className:"error text-center mt-4",children:s}),!t&&!s&&r&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("p",{className:"small text-secondary my-4",children:(0,p.APU)("Note: Settings via web interface are saved in database table (seahub-db/constance_config). They have a higher priority over the settings in config files.")}),(0,v.jsx)(kr.A,{headingText:(0,p.APU)("Branding"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(_r,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Site title"),keyText:"SITE_TITLE",value:r.SITE_TITLE,helpTip:(0,p.APU)("Site title shown in a browser tab")}),(0,v.jsx)(_r,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Site name"),keyText:"SITE_NAME",value:r.SITE_NAME,helpTip:(0,p.APU)("Site name used in email sending")}),(0,v.jsx)(Cr.A,{postFile:this.postFile,displayName:(0,p.APU)("Logo"),keyText:"Logo",filePath:i,fileWidth:256,fileHeight:64,helpTip:"logo.png, 256px * 64px"}),(0,v.jsx)(Cr.A,{postFile:this.postFile,displayName:(0,p.APU)("Favicon"),keyText:"Favicon",filePath:a,fileWidth:32,fileHeight:32,helpTip:"favicon.ico, 32px * 32px"}),(0,v.jsx)(Cr.A,{postFile:this.postFile,displayName:(0,p.APU)("Login background image"),keyText:"loginBGImage",filePath:o,fileWidth:240,fileHeight:160,helpTip:"login-bg.jpg, 2400px * 1600px"}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Enable branding CSS"),keyText:"ENABLE_BRANDING_CSS",value:r.ENABLE_BRANDING_CSS,helpTip:(0,p.APU)("Use custom CSS")}),(0,v.jsx)(_r,{inputType:"textarea",saveSetting:this.saveSetting,displayName:(0,p.APU)("Custom CSS"),keyText:"CUSTOM_CSS",value:r.CUSTOM_CSS,helpTip:""})]})}),(0,v.jsx)(kr.A,{headingText:(0,p.APU)("User"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Allow new registrations"),keyText:"ENABLE_SIGNUP",value:r.ENABLE_SIGNUP,helpTip:(0,p.APU)("Allow new user registrations. Uncheck this to prevent anyone from creating a new account.")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Activate after registration"),keyText:"ACTIVATE_AFTER_REGISTRATION",value:r.ACTIVATE_AFTER_REGISTRATION,helpTip:(0,p.APU)("Activate user immediately after registration. If unchecked, a user need to be activated by administrator or via activation email")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Send activation email"),keyText:"REGISTRATION_SEND_MAIL",value:r.REGISTRATION_SEND_MAIL,helpTip:(0,p.APU)("Send activation Email after user registration.")}),(0,v.jsx)(_r,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Keep sign in"),keyText:"LOGIN_REMEMBER_DAYS",value:r.LOGIN_REMEMBER_DAYS,helpTip:(0,p.APU)("Number of days that keep user sign in.")}),(0,v.jsx)(_r,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Login attempt limit"),keyText:"LOGIN_ATTEMPT_LIMIT",value:r.LOGIN_ATTEMPT_LIMIT,helpTip:(0,p.APU)("The maximum number of failed login attempts before showing CAPTCHA.")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Freeze user on login failed"),keyText:"FREEZE_USER_ON_LOGIN_FAILED",value:r.FREEZE_USER_ON_LOGIN_FAILED,helpTip:(0,p.APU)("Freeze user account when failed login attempts exceed limit.")})]})}),(0,v.jsx)(kr.A,{headingText:(0,p.APU)("Groups"),children:(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Enable\xa0sharing\xa0to\xa0all\xa0groups"),keyText:"ENABLE_SHARE_TO_ALL_GROUPS",value:r.ENABLE_SHARE_TO_ALL_GROUPS,helpTip:(0,p.APU)("Enable users to share libraries to any groups in the system.")})}),(0,v.jsx)(kr.A,{headingText:(0,p.APU)("Password"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Strong password"),keyText:"USER_STRONG_PASSWORD_REQUIRED",value:r.USER_STRONG_PASSWORD_REQUIRED,helpTip:(0,p.APU)("Force user to use a strong password when sign up or change password.")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Force password change"),keyText:"FORCE_PASSWORD_CHANGE",value:r.FORCE_PASSWORD_CHANGE,helpTip:(0,p.APU)("Force user to change password when account is newly added or reset by admin")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Enable two factor authentication"),keyText:"ENABLE_TWO_FACTOR_AUTH",value:r.ENABLE_TWO_FACTOR_AUTH,helpTip:(0,p.APU)("Enable two factor authentication")})]})}),(0,v.jsx)(kr.A,{headingText:(0,p.APU)("Library"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Library history"),keyText:"ENABLE_REPO_HISTORY_SETTING",value:r.ENABLE_REPO_HISTORY_SETTING,helpTip:(0,p.APU)("Allow users to change library history settings")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Encrypted library"),keyText:"ENABLE_ENCRYPTED_LIBRARY",value:r.ENABLE_ENCRYPTED_LIBRARY,helpTip:(0,p.APU)("Allow users to create encrypted libraries")}),(0,v.jsx)(_r,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Library password minimum length"),keyText:"REPO_PASSWORD_MIN_LENGTH",value:r.REPO_PASSWORD_MIN_LENGTH,helpTip:(0,p.APU)("The least number of characters an encrypted library password should include.")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Share/upload link force password"),keyText:"SHARE_LINK_FORCE_USE_PASSWORD",value:r.SHARE_LINK_FORCE_USE_PASSWORD,helpTip:(0,p.APU)("Force users to use password when generating share/upload link.")}),(0,v.jsx)(_r,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Share/upload link password minimum length"),keyText:"SHARE_LINK_PASSWORD_MIN_LENGTH",value:r.SHARE_LINK_PASSWORD_MIN_LENGTH,helpTip:(0,p.APU)("The least number of characters a share/upload link password should include.")}),(0,v.jsx)(_r,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Share/upload link password strength level"),keyText:"SHARE_LINK_PASSWORD_STRENGTH_LEVEL",value:r.SHARE_LINK_PASSWORD_STRENGTH_LEVEL,helpTip:(0,p.APU)("The level(1-4) of a share/upload link password's strength. For example, '3' means password must have at least 3 of the following: num, upper letter, lower letter and other symbols")}),(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Enable users to clean trash"),keyText:"ENABLE_USER_CLEAN_TRASH",value:r.ENABLE_USER_CLEAN_TRASH,helpTip:(0,p.APU)("Allow users to clean library trash")})]})}),(0,v.jsx)(kr.A,{headingText:(0,p.APU)("Online Preview"),children:(0,v.jsx)(_r,{inputType:"textarea",saveSetting:this.saveSetting,displayName:(0,p.APU)("Text file extensions"),keyText:"TEXT_PREVIEW_EXT",value:r.TEXT_PREVIEW_EXT,helpTip:(0,p.APU)("Extensions of text files that can be online previewed, each suffix is separated by a comma.")})}),(0,v.jsx)(kr.A,{headingText:(0,p.APU)("Sync"),children:(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Disable sync with any folder"),keyText:"DISABLE_SYNC_WITH_ANY_FOLDER",value:r.DISABLE_SYNC_WITH_ANY_FOLDER,helpTip:(0,p.APU)("If turn on, the desktop clients will not be able to sync a folder outside the default Seafile folder.")})}),p.amr&&(0,v.jsx)(kr.A,{headingText:(0,p.APU)("Terms"),children:(0,v.jsx)(Mr.A,{saveSetting:this.saveSetting,displayName:(0,p.APU)("Enable terms and conditions"),keyText:"ENABLE_TERMS_AND_CONDITIONS",value:r.ENABLE_TERMS_AND_CONDITIONS,helpTip:(0,p.APU)("Enable system admin to add Terms and Conditions, and all users will have to accept the terms.")})})]})]})]})})]})}}])}(l.Component)),Rr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleChange=function(e){var t=e.target.value;s.setState({value:t,isSubmitBtnActive:""!=t.trim()})},s.handleSubmit=function(){s.toggle(),s.props.addNotification(s.state.value.trim())},s.toggle=function(){s.props.toggle()},s.state={value:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("Add new notification")}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(he.A,{children:(0,v.jsx)(ge.A,{children:(0,v.jsx)(G.A,{type:"textarea",value:this.state.value,onChange:this.handleChange})})})}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),Tr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No notifications")}),a=(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"95%",children:(0,p.APU)("Notification Detail")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Fr,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteNotification:e.props.deleteNotification,setToCurrent:e.props.setToCurrent},s)}))})]});return r.length?a:i}}])}(l.Component),Fr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteNotification=function(){s.props.deleteNotification(s.props.item.id),s.toggleDeleteDialog()},s.setToCurrent=function(){s.props.setToCurrent(s.props.item.id)},s.onMenuItemClick=function(e){switch(e){case"Set to current":s.setToCurrent();break;case"Delete":s.toggleDeleteDialog()}},s.translateOperations=function(e){var t="";switch(e){case"Set to current":t=(0,p.APU)("Set to current");break;case"Delete":t=(0,p.APU)("Delete")}return t},s.getOperations=function(){var e=[];return s.props.item.is_current||e.push("Set to current"),e.push("Delete"),e},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsxs)("td",{children:[e.msg,e.is_current&&(0,v.jsx)("span",{className:"small text-orange",children:(0,p.APU)("(current notification)")})]}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(je.A,{operations:this.getOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Notification"),message:(0,p.APU)("Are you sure you want to delete the notification ?"),toggleDialog:this.toggleDeleteDialog,executeOperation:this.deleteNotification,confirmBtnText:(0,p.APU)("Delete")})]})}}])}(l.Component),Er=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleAddNotificationDialog=function(){s.setState({isAddNotificationDialogOpen:!s.state.isAddNotificationDialogOpen})},s.addNotification=function(e){U.H.sysAdminAddSysNotification(e).then((function(e){var t=s.state.notificationList;t.unshift(e.data.notification),s.setState({notificationList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteNotification=function(e){U.H.sysAdminDeleteSysNotification(e).then((function(t){var n=s.state.notificationList.filter((function(t){return t.id!=e}));s.setState({notificationList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.setToCurrent=function(e){U.H.sysAdminSetSysNotificationToCurrent(e).then((function(t){var n=s.state.notificationList.map((function(t){return t.id==e?t.is_current=!0:t.is_current=!1,t}));s.setState({notificationList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",notificationList:[],isAddNotificationDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminListAllSysNotifications().then((function(t){e.setState({loading:!1,notificationList:t.data.notifications})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.isAddNotificationDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddNotificationDialog,children:(0,p.APU)("Add new notification")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("All Notifications")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Tr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.notificationList,deleteNotification:this.deleteNotification,setToCurrent:this.setToCurrent})})]})}),e&&(0,v.jsx)(Rr,{addNotification:this.addNotification,toggle:this.toggleAddNotificationDialog})]})}}])}(l.Component),Br=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.records;return t?(0,v.jsx)("span",{className:"loading-icon loading-tip"}):s?(0,v.jsx)("p",{className:"error text-center",children:s}):(0,v.jsxs)("table",{width:"100%",className:"table table-hover table-vcenter",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"16%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"30%",children:"ID"}),(0,v.jsx)("th",{width:"30%",children:(0,p.APU)("Path")}),(0,v.jsx)("th",{width:"12%",children:(0,p.APU)("Label")}),(0,v.jsx)("th",{width:"12%",children:(0,p.APU)("Suggestion")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(zr,{record:e},t)}))})]})}}])}(l.Component),zr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).state={},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.record;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_id}),(0,v.jsx)("td",{children:e.path}),(0,v.jsx)("td",{children:e.detail.label}),(0,v.jsx)("td",{children:e.detail.suggestion})]})}}])}(l.Component),Yr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).state={loading:!0,errorMsg:"",records:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminListFileScanRecords().then((function(t){e.setState({loading:!1,records:t.data.record_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",id:"content-scan-records",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Content Scan Records")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Br,{loading:this.state.loading,errorMsg:this.state.errorMsg,records:this.state.records})})]})})]})}}])}(l.Component),Hr=s(55097),qr=s.n(Hr),Gr=s(94700),Qr=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.newUsersTempObj,n=t.checkedDepartmentId,r=t.isMembersListLoading,i=t.canCheckUserIds,a=this.props.membersList.map((function(t,r){var i=t.avatar;return i=t.avatar&&t.avatar.length>0?t.avatar.substring(0,t.avatar.length-1)+"100":p.YcY+"media/avatars/default.png",(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:!t.email&&(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:function(){return e.props.onUserChecked(t)},checked:t.userid in s?"checked":""})}),(0,v.jsx)("td",{children:(0,v.jsx)("img",{className:"avatar",src:i,alt:""})}),(0,v.jsx)("td",{children:t.name}),(0,v.jsx)("td",{children:t.mobile}),(0,v.jsx)("td",{children:t.contact_email}),(0,v.jsx)("td",{children:t.email&&(0,v.jsx)("i",{className:"sf2-icon-tick"})})]},n.toString()+t.userid)}));return(0,v.jsxs)("div",{className:"dir-content-main",children:[r&&(0,v.jsx)(N.A,{}),!r&&this.props.membersList.length>0&&(0,v.jsxs)(Gr.A,{hover:!0,children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%",children:i.length>0&&(0,v.jsx)("input",{type:"checkbox",className:"vam",checked:this.props.isCheckedAll,onChange:function(){return e.props.onAllUsersChecked()}})}),(0,v.jsx)("th",{width:"10%"}),(0,v.jsx)("th",{width:"20%",children:"\u540d\u79f0"}),(0,v.jsx)("th",{width:"20%",children:"\u624b\u673a\u53f7"}),(0,v.jsx)("th",{width:"30%",children:"\u90ae\u7bb1"}),(0,v.jsx)("th",{width:"15%",children:"\u5df2\u6dfb\u52a0"})]})}),(0,v.jsx)("tbody",{children:a})]}),!r&&0===this.props.membersList.length&&(0,v.jsxs)("div",{className:"message empty-tip text-center",children:[(0,v.jsx)("img",{src:"".concat(p.YcY,"media/img/member-list-empty-2x.png"),alt:""}),(0,v.jsx)("h4",{children:"\u6210\u5458\u5217\u8868\u4e3a\u7a7a"})]})]})}}])}(l.Component),Vr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleChildren=function(e){e.preventDefault(),e.stopPropagation(),s.setState({isChildrenShow:!s.state.isChildrenShow})},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.state.dropdownOpen||s.setState({active:!1})},s.importDepartmentDialogToggle=function(e){s.setState({active:!1}),s.props.importDepartmentDialogToggle(e)},s.renderTreeNodes=function(e){if(e.length>0)return e.map((function(e){return(0,v.jsx)(t,{department:e,isChildrenShow:s.state.isChildrenShow,onChangeDepartment:s.props.onChangeDepartment,checkedDepartmentId:s.props.checkedDepartmentId,importDepartmentDialogToggle:s.importDepartmentDialogToggle},e.id)}))},s.changeDept=function(e){var t=s.props,n=t.department,r=t.checkedDepartmentId;s.props.onChangeDepartment(e),r!==n.id||s.state.isChildrenShow||s.setState({isChildrenShow:!0})},s.state={isChildrenShow:!1,dropdownOpen:!1,active:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){0===this.props.index&&(this.setState({isChildrenShow:!0}),this.props.onChangeDepartment(this.props.department.id))}},{key:"render",value:function(){var e=this,t=this.props,s=t.isChildrenShow,n=t.department,r=t.checkedDepartmentId,i=st()({"folder-toggle-icon sf3-font sf3-font-down rotate-270":n.children&&this.state.isChildrenShow,"folder-toggle-icon sf3-font sf3-font-down":n.children&&!this.state.isChildrenShow}),a=st()({"tree-node-inner":!0,"tree-node-inner-hover":this.state.active,"tree-node-hight-light":r===n.id});return(0,v.jsxs)(l.Fragment,{children:[s&&(0,v.jsxs)("div",{className:a,onClick:function(){return e.changeDept(n.id)},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("span",{className:"tree-node-icon",onClick:function(t){return e.toggleChildren(t)},children:(0,v.jsx)("i",{className:i})}),(0,v.jsx)("span",{className:"tree-node-text",children:n.name}),p.amr&&(0,v.jsxs)(tn.A,{isOpen:this.state.dropdownOpen,toggle:function(t){return e.dropdownToggle(t)},direction:"down",style:this.state.active?{}:{opacity:0},children:[(0,v.jsx)(sn.A,{tag:"span",className:"cursor-pointer right-icon",title:(0,p.APU)("More operations"),"aria-label":(0,p.APU)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.dropdownOpen,children:(0,v.jsx)("i",{className:"sf3-font sf3-font-more"})}),(0,v.jsx)(nn.A,{className:"drop-list",children:(0,v.jsx)(rn.A,{onClick:this.importDepartmentDialogToggle.bind(this,n),id:n.id,children:"\u5bfc\u5165\u90e8\u95e8"})})]})]}),this.state.isChildrenShow&&(0,v.jsx)("div",{className:"department-children",children:n.children&&this.renderTreeNodes(n.children)})]})}}])}(l.Component),Wr=Vr,Kr=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props.departmentsTree;return(0,v.jsx)("div",{className:"dir-content-nav",children:(0,v.jsx)("div",{className:"tree-view p-4",children:this.props.isTreeLoading?(0,v.jsx)(N.A,{}):(0,v.jsx)(v.Fragment,{children:t.length>0&&t.map((function(t,s){return(0,v.jsx)(Wr,{index:s,department:t,isChildrenShow:!0,onChangeDepartment:e.props.onChangeDepartment,checkedDepartmentId:e.props.checkedDepartmentId,importDepartmentDialogToggle:e.props.importDepartmentDialogToggle},t.id)}))})})})}}])}(l.Component),Xr=Kr,$r=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.importDepartmentDialogToggle(null)},s.handleSubmit=function(){s.props.onImportDepartmentSubmit(),s.setState({isLoading:!0})},s.state={isLoading:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.departmentsCount,s=e.membersCount,n=e.departmentName;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsxs)(be.A,{toggle:this.toggle,children:[(0,v.jsx)("span",{children:"\u5bfc\u5165\u90e8\u95e8 "}),(0,v.jsx)("span",{className:"op-target",title:n,children:n})]}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsxs)("p",{children:["\u5c06\u8981\u5bfc\u5165 ",(0,v.jsx)("strong",{children:t})," \u4e2a\u90e8\u95e8\uff0c\u5176\u4e2d\u5305\u62ec ",(0,v.jsx)("strong",{children:s})," \u4e2a\u6210\u5458"]}),this.state.isLoading&&(0,v.jsx)(N.A,{})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:"\u53d6\u6d88"}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:"\u5bfc\u5165"})]})]})}}])}(l.Component),Jr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getDepartmentsTree=function(e){for(var t=[],s=[],n=0;n<e.length;n++)-1===t.indexOf(e[n].id)&&t.push(e[n].id),-1===s.indexOf(e[n].parentid)&&s.push(e[n].parentid);var r=s.filter((function(e){return-1!==t.indexOf(e)})),i=s.concat(r).filter((function(e){return-1===s.indexOf(e)||-1===r.indexOf(e)})),a=qr()(e);return a.filter((function(e){var t=a.filter((function(t){return e.id===t.parentid}));return t.length>0&&(e.children=t),-1!==i.indexOf(e.parentid)}))},s.getWorkWeixinDepartmentsList=function(e){U.H.sysAdminListWorkWeixinDepartments(e).then((function(t){if(t.data.department||!t.data.errmsg)if(e)s.setState({importDepartmentChildrenCount:t.data.department.length,importDepartmentMembersCount:s.state.membersTempObj[e].length});else{var n=s.getDepartmentsTree(t.data.department);s.setState({isTreeLoading:!1,departmentsTree:n})}else D.A.danger(t.data.errmsg)})).catch((function(e){s.handleError(e),s.setState({isTreeLoading:!1,isMembersListLoading:!1}),e.response&&403===e.response.status&&(window.location=p.YcY+"sys/useradmin/")}))},s.getWorkWeixinDepartmentMembersList=function(e){s.setState({isMembersListLoading:!0}),U.H.sysAdminListWorkWeixinDepartmentMembers(e,{fetch_child:!0}).then((function(t){var n=s.state.membersTempObj;n[e]=t.data.userlist;var r=s.getCanCheckUserIds(t.data.userlist);s.setState({membersTempObj:n,membersList:t.data.userlist,isMembersListLoading:!1,canCheckUserIds:r})})).catch((function(e){s.setState({isMembersListLoading:!1}),s.handleError(e)}))},s.getCanCheckUserIds=function(e){var t=[];return e.forEach((function(e){e.email||t.push(e.userid)})),t},s.onChangeDepartment=function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1,checkedDepartmentId:e}),e in s.state.membersTempObj){var t=s.getCanCheckUserIds(s.state.membersTempObj[e]);s.setState({membersList:s.state.membersTempObj[e],canCheckUserIds:t})}else s.getWorkWeixinDepartmentMembersList(e)},s.onUserChecked=function(e){if(-1!==s.state.canCheckUserIds.indexOf(e.userid)){var t=s.state.newUsersTempObj;e.userid in t?(delete t[e.userid],s.state.isCheckedAll&&s.setState({isCheckedAll:!1})):(t[e.userid]=e,Object.keys(t).length===s.state.canCheckUserIds.length&&s.setState({isCheckedAll:!0})),s.setState({newUsersTempObj:t})}},s.onAllUsersChecked=function(){s.setState({isCheckedAll:!s.state.isCheckedAll},(function(){if(s.state.isCheckedAll){for(var e={},t=s.state.membersList.filter((function(e){return-1!==s.state.canCheckUserIds.indexOf(e.userid)})),n=0;n<t.length;n++)e[t[n].userid]=t[n];s.setState({newUsersTempObj:e})}else s.setState({newUsersTempObj:{}})}))},s.onSubmit=function(){var e=s.state.newUsersTempObj;if("{}"!==JSON.stringify(e)){var t=[];for(var n in e)t.push(e[n]);0!==t.length?U.H.sysAdminAddWorkWeixinUsersBatch(t).then((function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1}),e.data.success&&s.handleSubmitSuccess(e.data.success),e.data.failed)for(var t=e.data.failed,n=0;n<t.length;n++)D.A.danger(t[n].name+" "+t[n].error_msg,{duration:3})})).catch((function(e){s.handleError(e)})):D.A.danger("\u672a\u9009\u62e9\u6210\u5458",{duration:3})}},s.handleSubmitSuccess=function(e){for(var t=s.state,n=t.membersTempObj,r=t.membersList,i=t.canCheckUserIds,a=0;a<e.length;a++){var o=e[a],l=o.userid,c=o.name,d=o.email;D.A.success(c+" \u6210\u529f\u5bfc\u5165",{duration:1}),-1!==i.indexOf(l)&&i.splice(i.indexOf(l),1);for(var u=0;u<r.length;u++)if(r[u].userid===l){r[u].email=d;break}for(var h in n)for(var g=0;g<n[h].length;g++)if(n[h][g].userid===l){n[h][g].email=d;break}}s.setState({membersTempObj:n,membersList:r,canCheckUserIds:i})},s.importDepartmentDialogToggle=function(e){s.setState({isImportDepartmentDialogShow:!s.state.isImportDepartmentDialogShow,importDepartment:e},(function(){e&&s.getWorkWeixinDepartmentsList(e.id)}))},s.onImportDepartmentSubmit=function(){var e=s.state.importDepartment;e&&U.H.sysAdminImportWorkWeixinDepartment(e.id).then((function(t){s.setState({isMembersListLoading:!0,checkedDepartmentId:e.id,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[]}),s.getWorkWeixinDepartmentMembersList(e.id),s.importDepartmentDialogToggle(null),t.data.success&&s.handleImportDepartmentSubmitSuccess(t.data.success),t.data.failed&&s.handleImportDepartmentSubmitFailed(t.data.failed)})).catch((function(e){s.handleError(e)}))},s.handleImportDepartmentSubmitSuccess=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?"\u90e8\u95e8 "+n.department_name+" \u5bfc\u5165\u6210\u529f":n.api_user_name+" \u5bfc\u5165\u6210\u529f";D.A.success(r,{duration:3})}},s.handleImportDepartmentSubmitFailed=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?n.department_name:n.api_user_name;D.A.danger(r+" "+n.msg,{duration:3})}},s.handleError=function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)},s.state={isTreeLoading:!0,isMembersListLoading:!0,departmentsTree:[],checkedDepartmentId:0,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[],isImportDepartmentDialogShow:!1,importDepartment:null,importDepartmentChildrenCount:0,importDepartmentMembersCount:0},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getWorkWeixinDepartmentsList(null)}},{key:"render",value:function(){var e=this.state,t=e.isImportDepartmentDialogShow,s=e.isTreeLoading,r=e.importDepartment,i=e.importDepartmentChildrenCount,a=e.importDepartmentMembersCount,o=!(!p.amr||!t||s||!r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:this.onSubmit,children:"\u5bfc\u5165\u7528\u6237"})})),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:"\u4f01\u4e1a\u5fae\u4fe1\u96c6\u6210"})}),(0,v.jsxs)("div",{className:"cur-view-content d-flex flex-row p-0",children:[(0,v.jsx)(Xr,{departmentsTree:this.state.departmentsTree,isTreeLoading:this.state.isTreeLoading,onChangeDepartment:this.onChangeDepartment,checkedDepartmentId:this.state.checkedDepartmentId,importDepartmentDialogToggle:this.importDepartmentDialogToggle}),(0,v.jsx)("div",{className:"dir-content-resize"}),(0,v.jsx)(Qr,{isMembersListLoading:this.state.isMembersListLoading,membersList:this.state.membersList,checkedDepartmentId:this.state.checkedDepartmentId,newUsersTempObj:this.state.newUsersTempObj,onUserChecked:this.onUserChecked,onAllUsersChecked:this.onAllUsersChecked,isCheckedAll:this.state.isCheckedAll,canCheckUserIds:this.state.canCheckUserIds})]})]})}),o&&(0,v.jsx)($r,{importDepartmentDialogToggle:this.importDepartmentDialogToggle,onImportDepartmentSubmit:this.onImportDepartmentSubmit,departmentsCount:i,membersCount:a,departmentName:r.name})]})}}])}(l.Component),Zr=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.newUsersTempObj,n=t.checkedDepartmentId,r=t.isMembersListLoading,i=t.canCheckUserIds,a=this.props.membersList.map((function(t,r){var i=t.avatar;return i=t.avatar&&t.avatar.length>0?t.avatar:p.YcY+"media/avatars/default.png",(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:!t.email&&(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:function(){return e.props.onUserChecked(t)},checked:t.userid in s?"checked":""})}),(0,v.jsx)("td",{children:(0,v.jsx)("img",{className:"avatar",src:i,alt:""})}),(0,v.jsx)("td",{children:t.name}),(0,v.jsx)("td",{children:t.mobile}),(0,v.jsx)("td",{children:t.contact_email}),(0,v.jsx)("td",{children:t.email&&(0,v.jsx)("i",{className:"sf2-icon-tick"})})]},n.toString()+t.userid)}));return(0,v.jsxs)("div",{className:"dir-content-main",children:[r&&(0,v.jsx)(N.A,{}),!r&&this.props.membersList.length>0&&(0,v.jsxs)(Gr.A,{hover:!0,children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%",children:i.length>0&&(0,v.jsx)("input",{type:"checkbox",className:"vam",checked:this.props.isCheckedAll,onChange:function(){return e.props.onAllUsersChecked()}})}),(0,v.jsx)("th",{width:"10%"}),(0,v.jsx)("th",{width:"20%",children:"\u540d\u79f0"}),(0,v.jsx)("th",{width:"20%",children:"\u624b\u673a\u53f7"}),(0,v.jsx)("th",{width:"30%",children:"\u90ae\u7bb1"}),(0,v.jsx)("th",{width:"15%",children:"\u5df2\u6dfb\u52a0"})]})}),(0,v.jsx)("tbody",{children:a})]}),!r&&0===this.props.membersList.length&&(0,v.jsxs)("div",{className:"message empty-tip text-center",children:[(0,v.jsx)("img",{src:"".concat(p.YcY,"media/img/member-list-empty-2x.png"),alt:""}),(0,v.jsx)("h4",{children:"\u6210\u5458\u5217\u8868\u4e3a\u7a7a"})]})]})}}])}(l.Component),ei=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleChildren=function(e){e.preventDefault(),e.stopPropagation(),s.setState({isChildrenShow:!s.state.isChildrenShow})},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.state.dropdownOpen||s.setState({active:!1})},s.importDepartmentDialogToggle=function(e){s.setState({active:!1}),s.props.importDepartmentDialogToggle(e)},s.renderTreeNodes=function(e){if(e.length>0)return e.map((function(e){return(0,v.jsx)(t,{department:e,isChildrenShow:s.state.isChildrenShow,onChangeDepartment:s.props.onChangeDepartment,checkedDepartmentId:s.props.checkedDepartmentId,importDepartmentDialogToggle:s.importDepartmentDialogToggle},e.id)}))},s.changeDept=function(e){var t=s.props,n=t.department,r=t.checkedDepartmentId;s.props.onChangeDepartment(e),r!==n.id||s.state.isChildrenShow||s.setState({isChildrenShow:!0})},s.state={isChildrenShow:!1,dropdownOpen:!1,active:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){0===this.props.index&&(this.setState({isChildrenShow:!0}),this.props.onChangeDepartment(this.props.department.id))}},{key:"render",value:function(){var e=this,t=this.props,s=t.isChildrenShow,n=t.department,r=t.checkedDepartmentId,i=st()({"folder-toggle-icon sf3-font sf3-font-down rotate-270":n.children&&this.state.isChildrenShow,"folder-toggle-icon sf3-font sf3-font-down":n.children&&!this.state.isChildrenShow}),a=st()({"tree-node-inner":!0,"tree-node-inner-hover":this.state.active,"tree-node-hight-light":r===n.id});return(0,v.jsxs)(l.Fragment,{children:[s&&(0,v.jsxs)("div",{className:a,onClick:function(){return e.changeDept(n.id)},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("span",{className:"tree-node-icon",onClick:function(t){return e.toggleChildren(t)},children:(0,v.jsx)("i",{className:i})}),(0,v.jsx)("span",{className:"tree-node-text",children:n.name}),p.amr&&(0,v.jsxs)(tn.A,{isOpen:this.state.dropdownOpen,toggle:function(t){return e.dropdownToggle(t)},direction:"down",style:this.state.active?{}:{opacity:0},children:[(0,v.jsx)(sn.A,{tag:"span",className:"cursor-pointer right-icon",title:(0,p.APU)("More operations"),"aria-label":(0,p.APU)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.dropdownOpen,children:(0,v.jsx)("i",{className:"sf3-font sf3-font-more"})}),(0,v.jsx)(nn.A,{className:"drop-list",children:(0,v.jsx)(rn.A,{onClick:this.importDepartmentDialogToggle.bind(this,n),id:n.id,children:"\u5bfc\u5165\u90e8\u95e8"})})]})]}),this.state.isChildrenShow&&(0,v.jsx)("div",{className:"department-children",children:n.children&&this.renderTreeNodes(n.children)})]})}}])}(l.Component),ti=ei,si=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props.departmentsTree;return(0,v.jsx)("div",{className:"dir-content-nav",children:(0,v.jsx)("div",{className:"tree-view p-4",children:this.props.isTreeLoading?(0,v.jsx)(N.A,{}):(0,v.jsx)(v.Fragment,{children:t.length>0&&t.map((function(t,s){return(0,v.jsx)(ti,{index:s,department:t,isChildrenShow:!0,onChangeDepartment:e.props.onChangeDepartment,checkedDepartmentId:e.props.checkedDepartmentId,importDepartmentDialogToggle:e.props.importDepartmentDialogToggle},t.id)}))})})})}}])}(l.Component),ni=si,ri=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.importDepartmentDialogToggle(null)},s.handleSubmit=function(){s.props.onImportDepartmentSubmit(),s.setState({isLoading:!0})},s.state={isLoading:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.departmentsCount,s=e.membersCount,n=e.departmentName;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsxs)(be.A,{toggle:this.toggle,children:[(0,v.jsx)("span",{children:"\u5bfc\u5165\u90e8\u95e8 "}),(0,v.jsx)("span",{className:"op-target",title:n,children:n})]}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsxs)("p",{children:["\u5c06\u8981\u5bfc\u5165 ",(0,v.jsx)("strong",{children:t})," \u4e2a\u90e8\u95e8\uff0c\u5176\u4e2d\u5305\u62ec ",(0,v.jsx)("strong",{children:s})," \u4e2a\u6210\u5458"]}),this.state.isLoading&&(0,v.jsx)(N.A,{})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:"\u53d6\u6d88"}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:"\u5bfc\u5165"})]})]})}}])}(l.Component),ii=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getDepartmentsTree=function(e){for(var t=[],s=[],n=0;n<e.length;n++)-1===t.indexOf(e[n].id)&&t.push(e[n].id),-1===s.indexOf(e[n].parentid)&&s.push(e[n].parentid);var r=s.filter((function(e){return-1!==t.indexOf(e)})),i=s.concat(r).filter((function(e){return-1===s.indexOf(e)||-1===r.indexOf(e)})),a=qr()(e);return a.filter((function(e){var t=a.filter((function(t){return e.id===t.parentid}));return t.length>0&&(e.children=t),-1!==i.indexOf(e.parentid)}))},s.getDingtalkDepartmentsList=function(e){U.H.sysAdminListDingtalkDepartments(e).then((function(t){if(t.data.department||!t.data.errmsg)if(e)s.setState({importDepartmentChildrenCount:t.data.department.length,importDepartmentMembersCount:s.state.membersTempObj[e].length});else{var n=s.getDepartmentsTree(t.data.department);s.setState({isTreeLoading:!1,departmentsTree:n})}else D.A.danger(t.data.errmsg)})).catch((function(e){s.handleError(e),s.setState({isTreeLoading:!1,isMembersListLoading:!1}),e.response&&403===e.response.status&&(window.location=p.YcY+"sys/useradmin/")}))},s.getDingtalkDepartmentMembersList=function(e){s.setState({isMembersListLoading:!0}),U.H.sysAdminListDingtalkDepartmentMembers(e).then((function(t){var n=s.state.membersTempObj;n[e]=t.data.userlist;var r=s.getCanCheckUserIds(t.data.userlist);s.setState({membersTempObj:n,membersList:t.data.userlist,isMembersListLoading:!1,canCheckUserIds:r})})).catch((function(e){s.setState({isMembersListLoading:!1}),s.handleError(e)}))},s.getCanCheckUserIds=function(e){var t=[];return e.forEach((function(e){e.email||t.push(e.userid)})),t},s.onChangeDepartment=function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1,checkedDepartmentId:e}),e in s.state.membersTempObj){var t=s.getCanCheckUserIds(s.state.membersTempObj[e]);s.setState({membersList:s.state.membersTempObj[e],canCheckUserIds:t})}else s.getDingtalkDepartmentMembersList(e)},s.onUserChecked=function(e){if(-1!==s.state.canCheckUserIds.indexOf(e.userid)){var t=s.state.newUsersTempObj;e.userid in t?(delete t[e.userid],s.state.isCheckedAll&&s.setState({isCheckedAll:!1})):(t[e.userid]=e,Object.keys(t).length===s.state.canCheckUserIds.length&&s.setState({isCheckedAll:!0})),s.setState({newUsersTempObj:t})}},s.onAllUsersChecked=function(){s.setState({isCheckedAll:!s.state.isCheckedAll},(function(){if(s.state.isCheckedAll){for(var e={},t=s.state.membersList.filter((function(e){return-1!==s.state.canCheckUserIds.indexOf(e.userid)})),n=0;n<t.length;n++)e[t[n].userid]=t[n];s.setState({newUsersTempObj:e})}else s.setState({newUsersTempObj:{}})}))},s.onSubmit=function(){var e=s.state.newUsersTempObj;if("{}"!==JSON.stringify(e)){var t=[];for(var n in e)t.push(e[n]);0!==t.length?U.H.sysAdminAddDingtalkUsersBatch(t).then((function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1}),e.data.success&&s.handleSubmitSuccess(e.data.success),e.data.failed)for(var t=e.data.failed,n=0;n<t.length;n++)D.A.danger(t[n].name+" "+t[n].error_msg,{duration:3})})).catch((function(e){s.handleError(e)})):D.A.danger("\u672a\u9009\u62e9\u6210\u5458",{duration:3})}},s.handleSubmitSuccess=function(e){for(var t=s.state,n=t.membersTempObj,r=t.membersList,i=t.canCheckUserIds,a=0;a<e.length;a++){var o=e[a],l=o.userid,c=o.name,d=o.email;D.A.success(c+" \u6210\u529f\u5bfc\u5165",{duration:1}),-1!==i.indexOf(l)&&i.splice(i.indexOf(l),1);for(var u=0;u<r.length;u++)if(r[u].userid===l){r[u].email=d;break}for(var h in n)for(var g=0;g<n[h].length;g++)if(n[h][g].userid===l){n[h][g].email=d;break}}s.setState({membersTempObj:n,membersList:r,canCheckUserIds:i})},s.importDepartmentDialogToggle=function(e){s.setState({isImportDepartmentDialogShow:!s.state.isImportDepartmentDialogShow,importDepartment:e},(function(){e&&s.getDingtalkDepartmentsList(e.id)}))},s.onImportDepartmentSubmit=function(){var e=s.state.importDepartment;e&&U.H.sysAdminImportDingtalkDepartment(e.id).then((function(t){s.setState({isMembersListLoading:!0,checkedDepartmentId:e.id,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[]}),s.getDingtalkDepartmentMembersList(e.id),s.importDepartmentDialogToggle(null),t.data.success&&s.handleImportDepartmentSubmitSuccess(t.data.success),t.data.failed&&s.handleImportDepartmentSubmitFailed(t.data.failed)})).catch((function(e){s.handleError(e)}))},s.handleImportDepartmentSubmitSuccess=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?"\u90e8\u95e8 "+n.department_name+" \u5bfc\u5165\u6210\u529f":n.api_user_name+" \u5bfc\u5165\u6210\u529f";D.A.success(r,{duration:3})}},s.handleImportDepartmentSubmitFailed=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?n.department_name:n.api_user_name;D.A.danger(r+" "+n.msg,{duration:3})}},s.handleError=function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)},s.state={isTreeLoading:!0,isMembersListLoading:!0,departmentsTree:[],checkedDepartmentId:0,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[],isImportDepartmentDialogShow:!1,importDepartment:null,importDepartmentChildrenCount:0,importDepartmentMembersCount:0},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getDingtalkDepartmentsList(null)}},{key:"render",value:function(){var e=this.state,t=e.isImportDepartmentDialogShow,s=e.isTreeLoading,r=e.importDepartment,i=e.importDepartmentChildrenCount,a=e.importDepartmentMembersCount,o=!(!p.amr||!t||s||!r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:this.onSubmit,children:"\u5bfc\u5165\u7528\u6237"})})),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:"\u9489\u9489\u96c6\u6210"})}),(0,v.jsxs)("div",{className:"cur-view-content d-flex flex-row p-0",children:[(0,v.jsx)(ni,{departmentsTree:this.state.departmentsTree,isTreeLoading:this.state.isTreeLoading,onChangeDepartment:this.onChangeDepartment,checkedDepartmentId:this.state.checkedDepartmentId,importDepartmentDialogToggle:this.importDepartmentDialogToggle}),(0,v.jsx)("div",{className:"dir-content-resize"}),(0,v.jsx)(Zr,{isMembersListLoading:this.state.isMembersListLoading,membersList:this.state.membersList,checkedDepartmentId:this.state.checkedDepartmentId,newUsersTempObj:this.state.newUsersTempObj,onUserChecked:this.onUserChecked,onAllUsersChecked:this.onAllUsersChecked,isCheckedAll:this.state.isCheckedAll,canCheckUserIds:this.state.canCheckUserIds})]})]})}),o&&(0,v.jsx)(ri,{importDepartmentDialogToggle:this.importDepartmentDialogToggle,onImportDepartmentSubmit:this.onImportDepartmentSubmit,departmentsCount:i,membersCount:a,departmentName:r.name})]})}}])}(l.Component);C().extend(ve());var ai=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getItemsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getItemsByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.curPerPage,a=t.hasNextPage,o=t.currentPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var c=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No invitations")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Inviter")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Accepter")}),(0,v.jsx)("th",{width:"9%",children:(0,p.APU)("Type")}),(0,v.jsx)("th",{width:"14%",children:(0,p.APU)("Invited at")}),(0,v.jsx)("th",{width:"14%",children:(0,p.APU)("Accepted at")}),(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Expired at")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(oi,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteItem:e.props.deleteItem},s)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:o,hasNextPage:a,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),oi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.deleteItem=function(){s.props.deleteItem(s.props.item)},s.translateOperations=function(e){var t="";if("Delete"===e)t=(0,p.APU)("Delete");return t},s.onMenuItemClick=function(e){if("Delete"===e)s.deleteItem()},s.getInviteTypeText=function(){var e="";switch(s.props.item.invite_type){case"Guest":case"guest":e=(0,p.APU)("Guest");break;case"Default":case"default":e=(0,p.APU)("Default");break;case"org":e=(0,p.APU)("Organization")}return e},s.state={isOpIconShown:!1,highlight:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state.isOpIconShown;return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.inviter_email,name:e.inviter_name})}),(0,v.jsx)("td",{children:e.accept_time?(0,v.jsx)(ye,{email:e.accepter_email,name:e.accepter_name}):e.accepter_email}),(0,v.jsx)("td",{children:this.getInviteTypeText()}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{title:C()(e.invite_time).format("dddd, MMMM D, YYYY h:mm:ss A"),children:C()(e.invite_time).fromNow()})}),(0,v.jsx)("td",{children:e.accept_time?(0,v.jsx)("span",{title:C()(e.accept_time).format("dddd, MMMM D, YYYY h:mm:ss A"),children:C()(e.accept_time).fromNow()}):"--"}),(0,v.jsx)("td",{children:e.is_expired?(0,v.jsx)("span",{className:"text-red",children:C()(e.expire_time).format("YYYY-MM-DD HH:mm")}):C()(e.expire_time).format("YYYY-MM-DD HH:mm")}),(0,v.jsx)("td",{children:t&&(0,v.jsx)(je.A,{operations:["Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]})})}}])}(l.Component),li=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getItemsByPage=function(e){var t=s.state.perPage;U.H.sysAdminListInvitations(e,t).then((function(n){s.setState({loading:!1,items:n.data.invitation_list,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count),currentPage:e})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteItem=function(e){var t=e.token;U.H.sysAdminDeleteInvitation(t).then((function(e){var n=s.state.items.filter((function(e){return e.token!=t}));s.setState({items:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteItemInBatch=function(){U.H.sysAdminDeleteExpiredInvitations().then((function(e){var t=s.state.items,n=s.state.items.filter((function(e){return!e.is_expired||e.accept_time}));n.length<t.length&&(s.setState({items:n}),D.A.success((0,p.APU)("Operation succeeded.")))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getItemsByPage(1)}))},s.state={loading:!0,errorMsg:"",items:[],totalItemCount:0,hasNextPage:!1,currentPage:1,perPage:100},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getItemsByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.deleteItemInBatch,children:(0,p.APU)("Delete Expired Invitations")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Invitations")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ai,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.items,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getItemsByPage:this.getItemsByPage,deleteItem:this.deleteItem})})]})})]})}}])}(l.Component),ci=s(67604),di=s(92203),ui=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onKeyDown=function(e){e.stopPropagation()},s.toggle=function(){if(s.state.isValueChanged){var e=s.getCurrentContent();s.props.onCommit(e)}s.props.onCloseEditorDialog()},s.onContentChanged=function(){return s.setState({isValueChanged:!0})},s.getCurrentContent=function(){return s.editorRef.current.getValue()},s.setSimpleEditorRef=function(e){s.simpleEditor=e},s.state={isValueChanged:!1},s.editorRef=l.createRef(),s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.content,s=e.title,n=void 0===s?(0,p.APU)("Terms"):s;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,onKeyDown:this.onKeyDown,wrapClassName:"conditions-editor-dialog-wrapper",className:"conditions-editor-dialog",contentClassName:"conditions-editor-dialog-content",size:"lg",style:{width:770},children:[(0,v.jsx)(be.A,{className:"conditions-editor-dialog-title",toggle:this.toggle,children:n}),(0,v.jsx)(Ue.A,{className:"conditions-editor-dialog-main",children:(0,v.jsx)(di.SimpleEditor,{ref:this.editorRef,value:t||"",onContentChanged:this.onContentChanged})})]})}}])}(l.Component),hi=ui,gi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleNameChange=function(e){s.setState({name:e.target.value})},s.handleVersionNumberChange=function(e){s.setState({versionNumber:e.target.value.trim()})},s.handleTextChange=function(e){s.setState({text:e.target.value.trim()})},s.setActive=function(){s.setState({isActive:!0})},s.setInActive=function(){s.setState({isActive:!1})},s.addTerm=function(){var e=s.state,t=e.name,n=e.versionNumber,r=e.text,i=e.isActive;""!==t?""!==n?isNaN(n)?s.setState({errMsg:(0,p.APU)("Version Number must be a number.")}):""!==r?s.props.isUpdate?s.props.updateTerm(t,n,r,i):s.props.addTerm(t,n,r,i):s.setState({errMsg:(0,p.APU)("Text is required.")}):s.setState({errMsg:(0,p.APU)("Version Number is required.")}):s.setState({errMsg:(0,p.APU)("Name is required.")})},s.onContentClick=function(){s.setState({isConditionsEditorDialogShow:!s.state.isConditionsEditorDialogShow})},s.onCloseEditorDialog=function(){s.setState({isConditionsEditorDialogShow:!1})},s.onUpdateContent=function(e){s.setState({text:e})},s.state={name:"",versionNumber:"",text:"",isActive:!0,errorMsg:"",isConditionsEditorDialogShow:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.oldTermObj;e&&this.setState({name:e.name,versionNumber:e.version_number,text:e.text,isActive:!(""===e.activate_time)})}},{key:"render",value:function(){var e=this.props.isUpdate?(0,p.APU)("Update Terms and Conditions"):(0,p.APU)("Add Terms and Conditions");return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(be.A,{toggle:this.props.toggle,children:e}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{for:"name",children:(0,p.APU)("Name")}),(0,v.jsx)(G.A,{id:"name",value:this.state.name,onChange:this.handleNameChange})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Version Number")}),(0,v.jsx)(G.A,{value:this.state.versionNumber,onChange:this.handleVersionNumberChange})]}),(0,v.jsxs)(ge.A,{className:"form-content",children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Text")}),(0,v.jsx)(ci.A,{content:this.state.text,onContentClick:this.onContentClick})]}),(0,v.jsxs)(ge.A,{tag:"fieldset",children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Activated")}),(0,v.jsx)(ge.A,{check:!0,children:(0,v.jsxs)(De.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"radio",checked:this.state.isActive,onChange:this.setActive})," ",(0,p.APU)("On")]})}),(0,v.jsx)(ge.A,{check:!0,children:(0,v.jsxs)(De.A,{check:!0,children:[(0,v.jsx)(G.A,{type:"radio",checked:!this.state.isActive,onChange:this.setInActive})," ",(0,p.APU)("Off")]})})]}),this.state.errMsg&&(0,v.jsx)(At.A,{color:"danger",children:this.state.errMsg})]}),(0,v.jsx)(Ne.A,{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.addTerm,children:(0,p.APU)("Submit")})})]}),this.state.isConditionsEditorDialogShow&&(0,v.jsx)(hi,{content:this.state.text,onCommit:this.onUpdateContent,onCloseEditorDialog:this.onCloseEditorDialog})]})}}])}(l.Component),pi=gi,mi=/\[.+\]\(\S+\)|<img src=(\S+).+\/>|!\[\]\(\S+\)|<\S+>/g,fi=/^<img src="(\S+)" .+\/>/,xi=/^!\[\]\((\S+)\)/,vi=/^\[.+\]\(\S+\)/,Ai=/^<\S+>$/,Pi=function(e){for(var t="",s=e.replace(mi,""),n=0;n<s.length&&("#"===s[n]||("\n"===s[n]?t+=" ":t+=s[n],30!==t.length));n++);var r=e.match(mi);if(r){var i=function(e){var t={links:[],images:[]};return e.forEach((function(e){if(e.search(vi)>=0||e.search(Ai)>=0)t.links.push(e);else{var s=e.match(fi),n=e.match(xi);s?t.images.push(s[1]):n&&t.images.push(n[1])}})),t}(r);return{previewText:t,images:i.images,links:i.links}}return{previewText:t,images:[],links:[]}},ji=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(n))).toggle=function(){e.props.onClosePreviewDialog()},e}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.title,s=void 0===t?(0,p.APU)("Terms"):t,n=e.content;return(0,v.jsxs)(u.A,{isOpen:!0,size:"lg",style:{width:600},wrapClassName:"conditions-perview-wrapper",toggle:this.toggle,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:s}),(0,v.jsx)(Ue.A,{children:(0,v.jsx)(ci.A,{content:n})})]})}}])}(l.Component),Si=ji;C().extend(ve());var yi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,isHighlighted:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,isHighlighted:!1})},s.toggleUpdateDialog=function(e){s.setState({isUpdateDialogOpen:!s.state.isUpdateDialogOpen})},s.toggleDeleteDialog=function(e){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleTermsContentDialog=function(e){s.setState({isTermsPreviewDialogOpen:!s.state.isTermsPreviewDialogOpen})},s.onMenuItemClick=function(e){switch(e){case"Update":s.toggleUpdateDialog();break;case"Delete":s.toggleDeleteDialog()}},s.onUnfreezedItem=function(){s.setState({isHighlighted:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.deleteTerm=function(){s.props.deleteTerm(s.props.item.id),s.toggleDeleteDialog()},s.updateTerm=function(e,t,n,r){s.props.updateTerm(s.props.item.id,e,t,n,r),s.toggleUpdateDialog()},s.translateOperations=function(e){var t="";switch(e){case"Update":t=(0,p.APU)("Update");break;case"Delete":t=(0,p.APU)("Delete")}return t},s.state={itemContent:"...",isHighlighted:!1,isOpIconShown:!1,isUpdateDialogOpen:!1,isDeleteDialogOpen:!1,isTermsPreviewDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.item.text;di.processor.process(t).then((function(t){var s=String(t);e.setState({itemContent:s})}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;if(e.item.text!==this.props.item.text){var s=e.item.text;di.processor.process(s).then((function(e){var s=String(e);t.setState({itemContent:s})}))}}},{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isDeleteDialogOpen,n=t.isUpdateDialogOpen,r=t.isTermsPreviewDialogOpen,i=t.isHighlighted,a=Pi(e.text),o='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",c=(0,p.APU)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:st()({"tr-highlight":i}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:e.name}),(0,v.jsx)("td",{children:e.version_number}),(0,v.jsx)("td",{className:"ellipsis",children:(0,v.jsx)("a",{href:"#",onClick:this.toggleTermsContentDialog,children:a.previewText})}),(0,v.jsx)("td",{children:C()(e.ctime).fromNow()}),(0,v.jsx)("td",{children:e.activate_time?C()(e.activate_time).fromNow():"--"}),(0,v.jsx)("td",{children:this.state.isOpIconShown&&(0,v.jsx)(je.A,{operations:["Update","Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),s&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete T&C"),message:c,toggleDialog:this.toggleDeleteDialog,executeOperation:this.deleteTerm,confirmBtnText:(0,p.APU)("Delete")})}),n&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(pi,{updateTerm:this.updateTerm,toggle:this.toggleUpdateDialog,isUpdate:!0,oldTermObj:e})}),r&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(Si,{content:e.text,onClosePreviewDialog:this.toggleTermsContentDialog})})]})}}])}(l.Component),Ui=yi,Di=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var i=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No terms and conditions")}),a=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Version")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Text")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Created")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Activated")}),(0,v.jsx)("th",{width:"5%"})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Ui,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteTerm:e.props.deleteTerm,updateTerm:e.props.updateTerm},s)}))})]})});return r.length?a:i}}])}(l.Component),Ni=Di,bi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).toggleAddTermDialog=function(){s.setState({isAddTermDialogOpen:!s.state.isAddTermDialogOpen})},s.addTerm=function(e,t,s,n){U.H.sysAdminAddTermAndCondition(e,t,s,n).then((function(e){location.reload()})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.updateTerm=function(e,t,n,r,i){U.H.sysAdminUpdateTermAndCondition(e,t,n,r,i).then((function(t){var n=s.state.termList.map((function(s){return s.id==e?t.data:s}));s.setState({termList:n}),D.A.success((0,p.APU)("Update succeeded."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.deleteTerm=function(e){U.H.sysAdminDeleteTermAndCondition(e).then((function(t){var n=s.state.termList.filter((function(t){return t.id!=e}));s.setState({termList:n}),D.A.success((0,p.APU)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={loading:!0,errorMsg:"",termList:[],isAddTermDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminListTermsAndConditions().then((function(t){e.setState({termList:t.data.term_and_condition_list,loading:!1})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.termList,s=e.isAddTermDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddTermDialog,children:(0,p.APU)("Add")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Terms and Conditions")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ni,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,deleteTerm:this.deleteTerm,updateTerm:this.updateTerm})})]})}),s&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(pi,{isUpdate:!1,addTerm:this.addTerm,toggle:this.toggleAddTermDialog})})]})}}])}(l.Component),wi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){s.props.handleFile(s.props.virusFile.virus_id,e)},s.translateOperations=function(e){var t="";switch(e){case"delete":t=(0,p.APU)("Delete");break;case"ignore":t=(0,p.APU)("Ignore");break;case"do-not-ignore":t=(0,p.APU)("Don't ignore")}return t},s.state={highlight:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.virusFile,t="",s=[];return e.has_deleted?t=(0,v.jsx)("span",{className:"text-green",children:(0,p.APU)("Deleted")}):e.has_ignored?(t=(0,v.jsx)("span",{className:"text-orange",children:(0,p.APU)("Ignored")}),s=["do-not-ignore"]):(t=(0,v.jsx)("span",{className:"text-red",children:(0,p.APU)("Unhandled")}),s=["delete","ignore"]),(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_owner}),(0,v.jsx)("td",{children:e.file_path}),(0,v.jsx)("td",{children:t}),(0,v.jsx)("td",{children:s.length>0&&this.state.isOpIconShown&&(0,v.jsx)(je.A,{operations:s,translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]})}}])}(l.Component),Ii=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.virusFiles,i=t.curPerPage,a=t.hasNextPage,o=t.currentPage;return s?(0,v.jsx)(N.A,{}):n?(0,v.jsx)("p",{className:"error text-center mt-4",children:n}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"27%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"28%",children:(0,p.APU)("Virus File")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(wi,{virusFile:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,handleFile:e.props.handleFile},s)}))})]}),r.length>0&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:o,hasNextPage:a,curPerPage:i,resetPerPage:this.props.resetPerPage})]})}}])}(l.Component),ki=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getListByPage=function(e){var t=s.state.perPage;U.H.sysAdminListVirusFiles(e,t).then((function(e){var t=e.data;s.setState({loading:!1,virusFiles:t.virus_file_list,hasNextPage:t.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getListByPage(1)}))},s.handleFile=function(e,t){var n;switch(t){case"delete":n=U.H.sysAdminDeleteVirusFile(e);break;case"ignore":n=U.H.sysAdminToggleIgnoreVirusFile(e,!0);break;case"do-not-ignore":n=U.H.sysAdminToggleIgnoreVirusFile(e,!1)}n.then((function(n){s.setState({virusFiles:s.state.virusFiles.map((function(s){return s.virus_id==e&&("delete"==t?s.has_deleted=!0:s=n.data.virus_file),s}))})})).catch((function(e){D.A.danger(m.Aq.getErrorMsg(e))}))},s.state={loading:!0,errorMsg:"",virusFiles:[],currentPage:1,perPage:100,hasNextPage:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ii,{loading:this.state.loading,errorMsg:this.state.errorMsg,virusFiles:this.state.virusFiles,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getListByPage,handleFile:this.handleFile})})})})}}])}(l.Component),Mi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){s.props.handleFile(s.props.virusFile.virus_id,e)},s.translateOperations=function(e){var t="";switch(e){case"delete":t=(0,p.APU)("Delete");break;case"ignore":t=(0,p.APU)("Ignore");break;case"do-not-ignore":t=(0,p.APU)("Don't ignore")}return t},s.toggleItemSelected=function(e){s.props.toggleItemSelected(s.props.virusFile,e.target.checked)},s.state={highlight:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.virusFile,t="",s=[];return e.has_deleted?t=(0,v.jsx)("span",{className:"text-green",children:(0,p.APU)("Deleted")}):e.has_ignored?(t=(0,v.jsx)("span",{className:"text-orange",children:(0,p.APU)("Ignored")}),s=["do-not-ignore"]):(t=(0,v.jsx)("span",{className:"text-red",children:(0,p.APU)("Unhandled")}),s=["delete","ignore"]),(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{className:"text-center",children:(0,v.jsx)("input",{type:"checkbox",checked:e.isSelected,onChange:this.toggleItemSelected})}),(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_owner}),(0,v.jsx)("td",{children:e.file_path}),(0,v.jsx)("td",{children:t}),(0,v.jsx)("td",{children:s.length>0&&this.state.isOpIconShown&&(0,v.jsx)(je.A,{operations:s,translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]})}}])}(l.Component),Ci=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.virusFiles,i=t.curPerPage,a=t.hasNextPage,o=t.currentPage,l=t.isAllItemsSelected;return s?(0,v.jsx)(N.A,{}):n?(0,v.jsx)("p",{className:"error text-center mt-4",children:n}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"3%",className:"text-center",children:(0,v.jsx)("input",{type:"checkbox",checked:l,onChange:this.props.toggleAllSelected})}),(0,v.jsx)("th",{width:"24%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"28%",children:(0,p.APU)("Virus File")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Mi,{virusFile:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,handleFile:e.props.handleFile,toggleItemSelected:e.props.toggleItemSelected},s)}))})]}),r.length>0&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:o,hasNextPage:a,curPerPage:i,resetPerPage:this.props.resetPerPage})]})}}])}(l.Component),Li=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getListByPage=function(e){var t=s.state.perPage;U.H.sysAdminListVirusFiles(e,t,!1).then((function(e){var t=e.data,n=t.virus_file_list.map((function(e){return e.isSelected=!1,e}));s.setState({loading:!1,virusFiles:n,hasNextPage:t.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getListByPage(1)}))},s.handleFile=function(e,t){var n;switch(t){case"delete":n=U.H.sysAdminDeleteVirusFile(e);break;case"ignore":n=U.H.sysAdminToggleIgnoreVirusFile(e,!0);break;case"do-not-ignore":n=U.H.sysAdminToggleIgnoreVirusFile(e,!1)}n.then((function(n){s.setState({virusFiles:s.state.virusFiles.map((function(s){return s.virus_id==e&&("delete"==t?s.has_deleted=!0:s=n.data.virus_file),s}))})})).catch((function(e){D.A.danger(m.Aq.getErrorMsg(e))}))},s.toggleAllSelected=function(){s.setState((function(e){return{isAllItemsSelected:!e.isAllItemsSelected,virusFiles:s.state.virusFiles.map((function(t){return t.isSelected=!e.isAllItemsSelected,t}))}}))},s.toggleItemSelected=function(e,t){s.setState({virusFiles:s.state.virusFiles.map((function(s){return s===e&&(s.isSelected=t),s}))},(function(){s.setState({isAllItemsSelected:!s.state.virusFiles.some((function(e){return!e.isSelected}))})}))},s.handleSelectedItems=function(e){var t=s.state.virusFiles.filter((function(t){return"delete-virus"==e?t.isSelected&&!t.has_deleted:t.isSelected&&!t.has_ignored})).map((function(e){return e.virus_id}));U.H.sysAdminBatchProcessVirusFiles(t,e).then((function(t){var n=s.state.virusFiles;t.data.success.forEach((function(t){var s=n.find((function(e){return e.virus_id==t.virus_id}));"delete-virus"==e?s.has_deleted=!0:s.has_ignored=!0})),s.setState({virusFiles:n}),t.data.failed.forEach((function(t){var s=n.find((function(e){return e.virus_id==t.virus_id})),r="delete-virus"==e?(0,p.APU)("Failed to delete %(virus_file) from library %(library): %(error_msg)"):(0,p.APU)("Failed to ignore %(virus_file) from library %(library): %(error_msg)");r=r.replace("%(virus_file)",s.file_path).replace("%(library)",s.repo_name).replace("%(error_msg)",t.error_msg),D.A.danger(r)}))})).catch((function(e){D.A.danger(m.Aq.getErrorMsg(e))}))},s.state={loading:!0,errorMsg:"",virusFiles:[],isAllItemsSelected:!1,selectedItems:[],currentPage:1,perPage:100,hasNextPage:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getListByPage(e.state.currentPage)})),this.unsubscribeHandleSelectedOp=He.B.subscribe(qe.T.HANDLE_SELECTED_OPERATIONS,(function(t){switch(t){case"delete-virus":e.deleteSelectedItems();break;case"ignore-virus":e.ignoreSelectedItems()}}))}},{key:"componentWillUnmount",value:function(){this.unsubscribeHandleSelectedOp()}},{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ci,{loading:this.state.loading,errorMsg:this.state.errorMsg,virusFiles:this.state.virusFiles,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getListByPage,handleFile:this.handleFile,isAllItemsSelected:this.state.isAllItemsSelected,toggleAllSelected:this.toggleAllSelected,toggleItemSelected:this.toggleItemSelected})})})})}}])}(l.Component);C().extend(ve());var _i=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.props.getLogsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getLogsByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,i=e.currentPage,a=e.hasNextPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No Admin operation logs")}),l=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Operation")}),(0,v.jsx)("th",{width:"50%",children:(0,p.APU)("Detail")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Time")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Oi,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?l:o}}])}(l.Component),Oi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getOperationText=function(e){switch(e){case"repo_create":return(0,p.APU)("Create Library");case"repo_delete":return(0,p.APU)("Delete Library");case"repo_transfer":return(0,p.APU)("Transfer Library");case"group_create":return(0,p.APU)("Create Group");case"group_transfer":return(0,p.APU)("Transfer Group");case"group_delete":return(0,p.APU)("Delete Group");case"user_add":return(0,p.APU)("Add User");case"user_delete":return(0,p.APU)("Delete User");case"user_migrate":return(0,p.APU)("Migrate User");case"group_member_add":return(0,p.APU)("Add User to Group");case"group_member_delete":return(0,p.APU)("Delete User from Group");default:return""}},s.getOperationDetail=function(e){var t=e.detail,s="";t.owner&&(s=p.YcY+"sys/users/"+encodeURIComponent(t.owner)+"/");var n="";t.email&&(n=p.YcY+"sys/users/"+encodeURIComponent(t.email)+"/");var r="",i="",a="";switch("repo_create"!=e.operation&&"repo_delete"!=e.operation&&"repo_transfer"!=e.operation||(i=p.YcY+"sys/libraries/"+t.id+"/"+encodeURIComponent(t.name)+"/"),"group_create"!=e.operation&&"group_delete"!=e.operation&&"group_transfer"!=e.operation||(a=p.YcY+"sys/groups/"+t.id+"/libraries/"),e.operation){case"repo_create":return r=(0,p.APU)("Created library {library_name} with {owner} as its owner").replace("{owner}",'<a href="'+s+'">'+t.owner+"</a>"),r=p.amr&&p.ZDj?r.replace("{library_name}",'<a href="'+i+'">'+m.Aq.HTMLescape(t.name)+"</a>"):r.replace("{library_name}",'<span class="font-weight-bold">'+m.Aq.HTMLescape(t.name)+"</span>");case"repo_delete":return r=(0,p.APU)("Deleted library {library_name}").replace("{library_name}",'<span class="font-weight-bold">'+m.Aq.HTMLescape(t.name)+"</span>");case"repo_transfer":return r=(0,p.APU)("Transferred library {library_name} from {user_from} to {user_to}").replace("{user_from}",'<span class="font-weight-bold">'+t.from+"</span>").replace("{user_to}",'<span class="font-weight-bold">'+t.to+"</span>"),r=p.amr&&p.ZDj?r.replace("{library_name}",'<a href="'+i+'">'+m.Aq.HTMLescape(t.name)+"</a>"):r.replace("{library_name}",'<span class="font-weight-bold">'+m.Aq.HTMLescape(t.name)+"</span>");case"group_create":return r=(0,p.APU)("Created group {group_name}").replace("{group_name}",'<a href="'+a+'">'+t.name+"</a>");case"group_transfer":return r=(0,p.APU)("Transferred group {group_name} from {user_from} to {user_to}").replace("{user_from}",'<span class="font-weight-bold">'+t.from+"</span>").replace("{user_to}",'<span class="font-weight-bold">'+t.to+"</span>").replace("{group_name}",'<a href="'+a+'">'+t.name+"</a>");case"group_delete":return r=(0,p.APU)("Deleted group {group_name}").replace("{group_name}",'<span class="font-weight-bold">'+t.name+"</span>");case"user_add":return r=(0,p.APU)("Added user {user}").replace("{user}",'<a href="'+n+'">'+t.email+"</a>");case"user_delete":return r=(0,p.APU)("Deleted user {user}").replace("{user}",'<span class="font-weight-bold">'+t.email+"</span>");case"user_migrate":return r=(0,p.APU)("User migrate from {user_from} to {user_to}").replace("{user_from}",'<span class="font-weight-bold">'+t.from+"</span>").replace("{user_to}",'<span class="font-weight-bold">'+t.to+"</span>");case"group_member_add":return r=(0,p.APU)("Added user {user} to group {group}").replace("{user}",'<span class="font-weight-bold">'+t.user+"</span>").replace("{group}",'<span class="font-weight-bold">'+t.name+"</span>");case"group_member_delete":return r=(0,p.APU)("Deleted user {user} from group {group}").replace("{user}",'<span class="font-weight-bold">'+t.user+"</span>").replace("{group}",'<span class="font-weight-bold">'+t.name+"</span>");default:return""}},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:this.getOperationText(e.operation)}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{dangerouslySetInnerHTML:{__html:this.getOperationDetail(e)}})}),(0,v.jsx)("td",{children:C()(e.datetime).fromNow()})]})}}])}(l.Component),Ri=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state.perPage;U.H.sysAdminListAdminLogs(e,t).then((function(n){s.setState({logList:n.data.data,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.logList,s=e.currentPage,n=e.perPage,r=e.hasNextPage;return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(_i,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:n,hasNextPage:r,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})})})})}}])}(l.Component);C().extend(ve());var Ti=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.props.getLogsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getLogsByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,i=e.currentPage,a=e.hasNextPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No Admin login logs")}),l=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("IP")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Status")}),(0,v.jsx)("th",{width:"25%",children:(0,p.APU)("Time")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Fi,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?l:o}}])}(l.Component),Fi=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.login_ip}),(0,v.jsx)("td",{children:e.login_success?(0,p.APU)("Success"):(0,p.APU)("Failed")}),(0,v.jsx)("td",{children:C()(e.login_time).fromNow()})]})}}])}(l.Component),Ei=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state.perPage;U.H.sysAdminListAdminLoginLogs(e,t).then((function(n){s.setState({logList:n.data.data,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.logList,s=e.currentPage,n=e.perPage,r=e.hasNextPage;return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ti,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:n,hasNextPage:r,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})})})})}}])}(l.Component),Bi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).listAbuseReports=function(){U.H.sysAdminListAbuseReports().then((function(e){s.setState({abuseReportList:e.data.abuse_report_list})})).catch((function(e){s.handleError(e)}))},s.updateAbuseReport=function(e,t){U.H.sysAdminUpdateAbuseReport(e,t).then((function(e){var n=s.state.abuseReportList.map((function(s,n){return s.id===t&&(s.handled=e.data.handled),s}));s.setState({abuseReportList:n})})).catch((function(e){s.handleError(e)}))},s.handleError=function(e){e.response?D.A.danger(e.response.data.error_msg||e.response.data.detail||(0,p.APU)("Error"),{duration:3}):D.A.danger((0,p.APU)("Please check the network."),{duration:3})},s.state={abuseReportList:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.listAbuseReports()}},{key:"render",value:function(){var e=this,t=this.state.abuseReportList.map((function(t,s){var n=(!t.handled).toString(),r=t.id,i=p.YcY+"lib/"+t.repo_id+"/file"+t.file_path;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:t.repo_name}),(0,v.jsx)("td",{children:(0,v.jsx)("a",{href:i,target:"_blank",rel:"noreferrer",children:t.file_path})}),(0,v.jsx)("td",{children:t.reporter}),(0,v.jsx)("td",{children:t.abuse_type}),(0,v.jsx)("td",{children:t.description}),(0,v.jsx)("td",{children:C()(t.time).format("YYYY-MM-DD")}),(0,v.jsx)("td",{children:(0,v.jsx)("p",{onClick:e.updateAbuseReport.bind(e,n,r),className:"op-target ellipsis ellipsis-op-target cursor-pointer",children:(0,p.APU)(t.handled.toString())})})]},s)}));return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.APU)("Abuse Reports")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("File")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Reporter")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Abuse Type")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Description")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Time")}),(0,v.jsx)("th",{width:"5%",children:(0,p.APU)("Handled")})]})}),(0,v.jsx)("tbody",{children:t})]})})]})})]})}}])}(l.Component),zi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"desktop",urlPart:"desktop",text:(0,p.APU)("Desktop")},{name:"mobile",urlPart:"mobile",text:(0,p.APU)("Mobile")}],p.amr&&s.navItems.push({name:"errors",urlPart:"errors",text:(0,p.APU)("Errors")}),s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props.currentItem,s=this.navItems.findIndex((function(e){return e.name===t}))||0,n=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),r=n[s],i=n.slice(0,s).reduce((function(e,t){return e+t}),0)+(2*s+1)*le.L2;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(r,"px"),"--indicator-offset":"".concat(i,"px")},children:this.navItems.map((function(s,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/devices/").concat(s.urlPart,"/"),className:"m-0 nav-link".concat(t==s.name?" active":""),children:s.text})},n)}))})})}}])}(l.Component),Yi=zi,Hi=["children"],qi=function(e){var t=e.children,s=(0,oe.default)(e,Hi),r=(0,l.useState)(!1),i=(0,k.default)(r,2),a=i[0],o=i[1],c=(0,h.zy)().pathname.split("/").filter(Boolean).pop(),d=(0,l.useCallback)((function(){U.H.sysAdminClearDeviceErrors().then((function(e){He.B.dispatch(qe.T.CLEAR_DEVICE_ERRORS),o(!1);var t=(0,p.APU)("Successfully cleaned all errors.");D.A.success(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))}),[]);return(0,l.useEffect)((function(){var e=He.B.subscribe(qe.T.SHOW_CLEAN_BTN,(function(){o(!0)}));return function(){e()}}),[]),(0,v.jsxs)(v.Fragment,{children:["errors"===c&&a?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},s),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:d,children:(0,p.APU)("Clean")})})):(0,v.jsx)(b.A,(0,n.default)({},s)),(0,v.jsx)(Yi,{currentItem:c}),t]})},Gi=s(96763);C().extend(ve());var Qi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPageDevicesList=function(){s.props.getDevicesListByPage(s.props.pageInfo.current_page-1)},s.getNextPageDevicesList=function(){s.props.getDevicesListByPage(s.props.pageInfo.current_page+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.pageInfo,i=e.curPerPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var a=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No connected devices")}),o=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"19%",children:(0,p.APU)("User")}),(0,v.jsxs)("th",{width:"19%",children:[(0,p.APU)("Platform")," / ",(0,p.APU)("Version")]}),(0,v.jsx)("th",{width:"19%",children:(0,p.APU)("Device Name")}),(0,v.jsx)("th",{width:"19%",children:(0,p.APU)("IP")}),(0,v.jsx)("th",{width:"19%",children:(0,p.APU)("Last Access")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Vi,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPageDevicesList,gotoNextPage:this.getNextPageDevicesList,currentPage:r.current_page,hasNextPage:r.has_next_page,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return n.length?o:a}}])}(l.Component),Vi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.handleUnlink=function(){s.props.item.is_desktop_client?s.toggleUnlinkDeviceDialog():s.unlinkDevice(!0)},s.toggleUnlinkDeviceDialog=function(){s.setState({isUnlinkDeviceDialogOpen:!s.state.isUnlinkDeviceDialogOpen})},s.unlinkDevice=function(e){var t=s.props.item,n=t.platform,r=t.device_id,i=t.user;U.H.sysAdminUnlinkDevice(n,r,i,e).then((function(e){s.setState({unlinked:!0});var t=(0,p.APU)("Successfully unlinked the device.");D.A.success(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.state={unlinked:!1,isHighlighted:!1,isOpIconShown:!1,isUnlinkDeviceDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.unlinked,n=t.isUnlinkDeviceDialogOpen,r=t.isHighlighted,i=t.isOpIconShown;return s?null:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:st()({"tr-highlight":r}),onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,onFocus:this.onMouseEnter,children:[(0,v.jsx)("td",{children:e.user_name}),(0,v.jsxs)("td",{children:[e.platform," / ",e.client_version]}),(0,v.jsx)("td",{children:e.device_name}),(0,v.jsx)("td",{children:e.last_login_ip}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{title:C()(e.last_accessed).format("dddd, MMMM D, YYYY h:mm:ss A"),children:C()(e.last_accessed).fromNow()})}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"sf3-font-delete1 sf3-font op-icon ".concat(i?"":"invisible"),title:(0,p.APU)("Unlink"),onClick:this.handleUnlink})})]}),n&&(0,v.jsx)(Gi.A,{unlinkDevice:this.unlinkDevice,toggleDialog:this.toggleUnlinkDeviceDialog})]})}}])}(l.Component),Wi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getDevicesListByPage=function(e){var t=s.props.devicesPlatform,n=s.state.perPage;U.H.sysAdminListDevices(t,e,n).then((function(e){s.setState({devicesData:e.data.devices,pageInfo:e.data.page_info,loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getDevicesListByPage(1)}))},s.state={loading:!0,errorMsg:"",devicesData:[],pageInfo:{},perPage:100},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,i=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||i),currentPage:parseInt(t.get("page")||r)},(function(){e.getDevicesListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Qi,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.devicesData,getDevicesListByPage:this.getDevicesListByPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,pageInfo:this.state.pageInfo})})}}])}(l.Component),Ki=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)(Wi,{devicesPlatform:"desktop"})})})}}])}(l.Component),Xi=function(e){function t(e){return(0,r.default)(this,t),(0,a.default)(this,t,[e])}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)(Wi,{devicesPlatform:"mobile"})})})}}])}(l.Component);C().extend(ve());var $i=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPageDeviceErrorsList=function(){s.props.getDeviceErrorsListByPage(s.props.pageInfo.current_page-1)},s.getNextPageDeviceErrorsList=function(){s.props.getDeviceErrorsListByPage(s.props.pageInfo.current_page+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.pageInfo,i=e.curPerPage;if(t)return(0,v.jsx)(N.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var a=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No sync errors")}),o=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"16%",children:(0,p.APU)("User")}),(0,v.jsxs)("th",{width:"20%",children:[(0,p.APU)("Device")," / ",(0,p.APU)("Version")]}),(0,v.jsx)("th",{width:"16%",children:(0,p.APU)("IP")}),(0,v.jsx)("th",{width:"16%",children:(0,p.APU)("Library")}),(0,v.jsx)("th",{width:"16%",children:(0,p.APU)("Error")}),(0,v.jsx)("th",{width:"16%",children:(0,p.APU)("Time")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Ji,{item:e},t)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPageDeviceErrorsList,gotoNextPage:this.getNextPageDeviceErrorsList,currentPage:r.current_page,hasNextPage:r.has_next_page,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return n.length?o:a}}])}(l.Component),Ji=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:e.email,name:e.name})}),(0,v.jsxs)("td",{children:[e.device_name," / ",e.client_version]}),(0,v.jsx)("td",{children:e.device_ip}),(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sysadmin/#libs/").concat(e.repo_id),children:e.repo_name})}),(0,v.jsx)("td",{children:e.error_msg}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"item-meta-info",title:C()(e.last_accessed).format("dddd, MMMM D, YYYY h:mm:ss A"),children:C()(e.error_time).fromNow()})})]})}}])}(l.Component),Zi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getDeviceErrorsListByPage=function(e){var t=s.state.perPage;U.H.sysAdminListDeviceErrors(e,t).then((function(e){s.setState({loading:!1,pageInfo:e.data.page_info}),e.data.device_errors.length>0&&He.B.dispatch(qe.T.SHOW_CLEAN_BTN)})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getDeviceErrorsListByPage(1)}))},s.state={loading:!0,errorMsg:"",pageInfo:{},perPage:100,deviceErrors:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,i=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||i),currentPage:parseInt(t.get("page")||r)},(function(){e.getDeviceErrorsListByPage(e.state.currentPage)})),this.unsubscribeClearDeviceErrors=He.B.subscribe(qe.T.CLEAR_DEVICE_ERRORS,(function(){return e.setState({deviceErrors:[]})}))}},{key:"componentWillUnmount",value:function(){this.unsubscribeClearDeviceErrors()}},{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)($i,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.deviceErrors,getDeviceErrorsListByPage:this.getDeviceErrorsListByPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,pageInfo:this.state.pageInfo})})})})}}])}(l.Component),ea=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onSelectSortOption=function(e){var t=e.value.split("-"),n=(0,k.default)(t,1)[0];s.props.sortItems(n)},s.navItems=[{name:"all-libraries",urlPart:"all-libraries",text:(0,p.APU)("All")},{name:"all-wikis",urlPart:"all-wikis",text:(0,p.APU)("Wikis")},{name:"system-library",urlPart:"system-library",text:(0,p.APU)("System")},{name:"trash-libraries",urlPart:"trash-libraries",text:(0,p.APU)("Trash")}],s.sortOptions=[{value:"file_count-desc",text:(0,p.APU)("Descending by files")},{value:"size-desc",text:(0,p.APU)("Descending by size")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props,s=t.currentItem,n=t.sortBy,r=t.sortOrder,i=void 0===r?"desc":r,a="all-libraries"==s||"all-wikis"==s,o=this.navItems.findIndex((function(e){return e.name===s}))||0,l=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),c=l[o],d=l.slice(0,o).reduce((function(e,t){return e+t}),0)+(2*o+1)*le.L2;return(0,v.jsxs)("div",{className:"cur-view-path tab-nav-container",children:[(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(c,"px"),"--indicator-offset":"".concat(d,"px")},children:this.navItems.map((function(t,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/").concat(t.urlPart,"/"),className:"m-0 nav-link".concat(s==t.name?" active":""),children:t.text})},n)}))}),a&&(0,v.jsx)(ft.A,{sortBy:n,sortOrder:i,sortOptions:this.sortOptions,onSelectSortOption:this.onSelectSortOption})]})}}])}(l.Component),ta=ea,sa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleRepoNameChange=function(e){var t=e.target.value;s.setState({repoName:t,isSubmitBtnActive:t.trim()})},s.handleSubmit=function(){var e=s.state,t=e.repoName,n=e.selectedUsers;s.props.createRepo(t.trim(),n[0].email),s.toggle()},s.handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.toggle=function(){s.props.toggleDialog()},s.state={repoName:"",selectedUsers:[],errMessage:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,autoFocus:!1,children:[(0,v.jsx)(be.A,{toggle:this.toggle,children:(0,p.APU)("New Library")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsxs)(he.A,{children:[(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{for:"repoName",children:(0,p.APU)("Name")}),(0,v.jsx)(G.A,{id:"repoName",onKeyDown:this.handleKeyDown,value:this.state.repoName,onChange:this.handleRepoNameChange,autoFocus:!0})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsxs)(De.A,{for:"userSelect",children:[(0,p.APU)("Owner"),(0,v.jsx)("span",{className:"small text-secondary ml-1",children:(0,p.APU)("(If left blank, owner will be admin)")})]}),(0,v.jsx)(Dt.A,{id:"userSelect",isMulti:!1,placeholder:(0,p.APU)("Select a user"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})]})]}),this.state.errMessage&&(0,v.jsx)(At.A,{color:"danger",children:this.state.errMessage})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.APU)("Submit")})]})]})}}])}(l.Component),na=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getReposByPage=function(e){var t=s.props,n=t.perPage,r=t.sortBy;s.isValidSortBy(r)&&U.H.sysAdminListAllRepos(e,n,r).then((function(e){s.setState({loading:!1,repos:e.data.repos,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.isValidSortBy=function(e){return["file_count-desc","size-desc",""].includes(e)},s.resetPerPage=function(e){s.props.onResetPerPage(e),s.getReposByPage(1)},s.createRepo=function(e,t){U.H.sysAdminCreateRepo(e,t).then((function(e){s.state.repos.unshift(e.data),s.setState({repos:s.state.repos})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.onDeleteRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.onTransferRepo=function(e){var t=s.state.repos.map((function(t){return t.id==e.id?e:t}));s.setState({repos:t})},s.state={loading:!0,errorMsg:"",repos:[],pageInfo:{},perPage:100},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getReposByPage(this.props.currentPage)}},{key:"componentDidUpdate",value:function(e,t){e.currentPage===this.props.currentPage&&e.sortBy===this.props.sortBy||this.getReposByPage(this.props.currentPage)}},{key:"render",value:function(){var e=this.props.isCreateRepoDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(xs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repos,pageInfo:this.state.pageInfo,curPerPage:this.props.perPage,getListByPage:this.getReposByPage,resetPerPage:this.resetPerPage,onDeleteRepo:this.onDeleteRepo,onTransferRepo:this.onTransferRepo})})})}),e&&(0,v.jsx)(sa,{createRepo:this.createRepo,toggleDialog:this.props.toggleCreateRepoDialog})]})}}])}(l.Component),ra=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getWikisByPage=function(e){var t=s.props,n=t.perPage,r=t.sortBy;U.H.sysAdminListAllWikis(e,n,r).then((function(e){s.setState({loading:!1,wikis:e.data.wikis,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.props.onResetPerPage(e),s.getWikisByPage(1)},s.onDeleteWiki=function(e){var t=s.state.wikis.filter((function(t){return t.id!=e.id}));s.setState({wikis:t})},s.onTransferWiki=function(e){var t=s.state.wikis.map((function(t){return t.id==e.id?e:t}));s.setState({wikis:t})},s.state={loading:!0,errorMsg:"",wikis:[],pageInfo:{}},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getWikisByPage(this.props.currentPage)}},{key:"componentDidUpdate",value:function(e,t){e.currentPage!==this.props.currentPage&&this.getWikisByPage(this.props.currentPage)}},{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(xs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.wikis,pageInfo:this.state.pageInfo,curPerPage:this.props.perPage,getListByPage:this.getWikisByPage,resetPerPage:this.resetPerPage,onDeleteRepo:this.onDeleteWiki,onTransferRepo:this.onTransferWiki,isWiki:!0})})})})}}])}(l.Component),ia=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items;return t?(0,v.jsx)(N.A,{}):s?(0,v.jsx)("p",{className:"error text-center",children:s}):(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"33%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"34%",children:"ID"}),(0,v.jsx)("th",{width:"33%",children:(0,p.APU)("Description")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(aa,{item:e},t)}))})]})})}}])}(l.Component),aa=function(e){function t(){return(0,r.default)(this,t),(0,a.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)("a",{href:"".concat(p.YcY,"sys/libraries/").concat(e.id,"/"),children:e.name})}),(0,v.jsx)("td",{children:e.id}),(0,v.jsx)("td",{children:e.description})]})}}])}(l.Component),oa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).state={loading:!0,errorMsg:"",items:[]},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this;U.H.sysAdminGetSystemRepoInfo().then((function(t){var s=[];s.push(t.data),e.setState({items:s,loading:!1})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ia,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.items})})})})}}])}(l.Component),la=window.sysadmin.pageOptions.trashReposExpireDays;C().extend(ve());var ca=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.pageInfo,a=t.curPerPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var o=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No deleted libraries")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("p",{className:"mt-4 small text-secondary",children:(0,p.APU)("Tip: libraries deleted {trashReposExpireDays} days ago will be cleaned automatically.").replace("{trashReposExpireDays}",la)}),(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"43%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"27%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"20%",children:(0,p.APU)("Deleted Time")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(da,{repo:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,onDeleteRepo:e.props.onDeleteRepo,onRestoreRepo:e.props.onRestoreRepo},s)}))})]}),i&&(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:i.current_page,hasNextPage:i.has_next_page,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?c:o}}])}(l.Component),da=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,isHighlighted:!0})},s.handleMouseOut=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,isHighlighted:!1})},s.onUnfreezedItem=function(){s.setState({isHighlighted:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onDeleteRepo=function(){var e=s.props.repo;U.H.sysAdminDeleteTrashRepo(e.id).then((function(t){s.props.onDeleteRepo(e);var n=(0,p.APU)("Successfully deleted {name}.").replace("{name}",e.name);D.A.success(n)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.onRestoreRepo=function(){var e=s.props.repo;U.H.sysAdminRestoreTrashRepo(e.id).then((function(t){s.props.onRestoreRepo(e);var n=(0,p.APU)("Successfully restored the library.");D.A.success(n)})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.toggleDeleteRepoDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteRepoDialogOpen:!s.state.isDeleteRepoDialogOpen})},s.toggleRestoreRepoDialog=function(e){e&&e.preventDefault(),s.setState({isRestoreRepoDialogOpen:!s.state.isRestoreRepoDialogOpen})},s.translateOperations=function(e){var t="";switch(e){case"Restore":t=(0,p.APU)("Restore");break;case"Delete":t=(0,p.APU)("Delete")}return t},s.onMenuItemClick=function(e){switch(e){case"Restore":s.toggleRestoreRepoDialog();break;case"Delete":s.toggleDeleteRepoDialog()}},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteRepoDialogOpen:!1,isRestoreRepoDialogOpen:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props.repo,t=this.state,s=t.isOpIconShown,n=t.isDeleteRepoDialogOpen,r=t.isRestoreRepoDialogOpen,i=t.isHighlighted,a=m.Aq.getLibIconUrl(e),o=m.Aq.getLibIconTitle(e),c='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>";return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:st()({"tr-highlight":i}),onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:a,title:o,alt:o,width:"24"})}),(0,v.jsx)("td",{children:e.name}),(0,v.jsx)("td",{children:-1==e.owner.indexOf("@seafile_group")?(0,v.jsx)(ye,{email:e.owner,name:e.owner_name}):e.group_name}),(0,v.jsx)("td",{children:C()(e.delete_time).fromNow()}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(je.A,{operations:["Restore","Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(fe.A,{title:(0,p.APU)("Delete Library"),message:(0,p.APU)("Are you sure you want to delete {placeholder} completely?").replace("{placeholder}",c),executeOperation:this.onDeleteRepo,confirmBtnText:(0,p.APU)("Delete"),toggleDialog:this.toggleDeleteRepoDialog})}),r&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(fe.A,{title:(0,p.APU)("Restore Library"),message:(0,p.APU)("Are you sure you want to restore {placeholder}?").replace("{placeholder}",c),executeOperation:this.onRestoreRepo,confirmBtnText:(0,p.APU)("Restore"),toggleDialog:this.toggleRestoreRepoDialog})})]})}}])}(l.Component),ua=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getReposByPage=function(e){var t=s.state.perPage;U.H.sysAdminListTrashRepos(e,t).then((function(e){s.setState({repos:e.data.repos,pageInfo:e.data.page_info,loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getReposByPage(1)}))},s.onDeleteRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.onRestoreRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.cleanTrash=function(){U.H.sysAdminCleanTrashRepos().then((function(e){s.setState({repos:[]}),D.A.success((0,p.APU)("Successfully cleared trash."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.getSearch=function(){return(0,v.jsx)(Ot.A,{placeholder:(0,p.APU)("Search libraries by owner"),submit:s.searchRepos})},s.searchRepos=function(e){U.H.sysAdminSearchTrashRepos(e).then((function(e){s.setState({repos:e.data.repos,pageInfo:null,errorMsg:"",loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.state={loading:!0,errorMsg:"",repos:[],pageInfo:{},perPage:100},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,i=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||i),currentPage:parseInt(t.get("page")||r)},(function(){e.getReposByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.props.isCleanTrashDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ca,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repos,pageInfo:this.state.pageInfo,onDeleteRepo:this.onDeleteRepo,onRestoreRepo:this.onRestoreRepo,getListByPage:this.getReposByPage,resetPerPage:this.resetPerPage,curPerPage:this.state.perPage})})})}),e&&(0,v.jsx)(fe.A,{title:(0,p.APU)("Clear Trash"),message:(0,p.APU)("Are you sure you want to clear trash?"),executeOperation:this.cleanTrash,confirmBtnText:(0,p.APU)("Clear"),toggleDialog:this.props.toggleCleanTrashDialog})]})}}])}(l.Component),ha=ua;C().extend(ve());var ga=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.props.getShareLinksByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getShareLinksByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.perPage,a=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var l=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No share links")}),c=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Token")}),(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Created At")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Visit count")}),(0,v.jsx)("th",{width:"11%",children:(0,p.APU)("Expiration")}),(0,v.jsx)("th",{width:"10%"})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(pa,{item:t,deleteShareLink:e.props.deleteShareLink},s)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:o,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?c:l}}])}(l.Component),pa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.deleteShareLink=function(){s.props.deleteShareLink(s.props.item.token)},s.renderExpiration=function(){var e=s.props.item;if(!e.expire_date)return"--";var t=C()(e.expire_date).format("YYYY-MM-DD"),n=C()(e.expire_date).format("YYYY-MM-DD HH:mm:ss");return(0,v.jsx)("span",{className:e.is_expired?"error":"",title:n,children:t})},s.state={isHighlighted:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isHighlighted,n=this.props.item;return(0,v.jsxs)("tr",{className:st()({"tr-highlight":s}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:n.obj_name}),(0,v.jsx)("td",{children:n.token}),(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:n.creator_email,name:n.creator_name})}),(0,v.jsx)("td",{children:C()(n.ctime).fromNow()}),(0,v.jsx)("td",{children:n.view_cnt}),(0,v.jsx)("td",{children:this.renderExpiration()}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(t?"":"invisible"),title:(0,p.APU)("Remove"),onClick:this.deleteShareLink})})]})}}])}(l.Component),ma=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getShareLinksByPage=function(e){var t=s.props,n=t.perPage,r=t.sortBy,i=t.sortOrder;U.H.sysAdminListShareLinks(e,n,r,i).then((function(t){s.setState({shareLinkList:t.data.share_link_list,loading:!1,hasNextPage:m.Aq.hasNextPage(e,n,t.data.count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteShareLink=function(e){U.H.sysAdminDeleteShareLink(e).then((function(t){var n=s.state.shareLinkList.filter((function(t){return t.token!=e}));s.setState({shareLinkList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.resetPerPage=function(e){s.props.onResetPerPage(e),s.getShareLinksByPage(s.initPage)},s.state={loading:!0,errorMsg:"",shareLinkList:[],perPage:100,hasNextPage:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getShareLinksByPage(this.props.currentPage)}},{key:"componentDidUpdate",value:function(e,t){var s=this.props,n=s.currentPage,r=s.sortBy,i=s.sortOrder;n===e.currentPage&&r===e.sortBy&&i===e.sortOrder||this.getShareLinksByPage(n)}},{key:"render",value:function(){var e=this.state,t=e.shareLinkList,s=e.currentPage,n=e.perPage,r=e.hasNextPage;return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ga,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:n,hasNextPage:r,getShareLinksByPage:this.getShareLinksByPage,resetPerPage:this.resetPerPage,deleteShareLink:this.deleteShareLink})})})})})}}])}(l.Component);C().extend(ve());var fa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getPreviousPage=function(){s.props.getUploadLinksByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getUploadLinksByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,i=t.perPage,a=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(N.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var c=(0,v.jsx)(Ae.A,{text:(0,p.APU)("No upload links")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Name")}),(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Token")}),(0,v.jsx)("th",{width:"18%",children:(0,p.APU)("Owner")}),(0,v.jsx)("th",{width:"15%",children:(0,p.APU)("Created At")}),(0,v.jsx)("th",{width:"10%",children:(0,p.APU)("Visit count")}),(0,v.jsx)("th",{width:"11%",children:(0,p.APU)("Expiration")}),(0,v.jsx)("th",{width:"10%"})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(xa,{item:t,deleteUploadLink:e.props.deleteUploadLink},s)}))})]}),(0,v.jsx)(K.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:o,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),xa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.deleteUploadLink=function(){s.props.deleteUploadLink(s.props.item.token)},s.renderExpiration=function(){var e=s.props.item;if(!e.expire_date)return"--";var t=C()(e.expire_date).format("YYYY-MM-DD"),n=C()(e.expire_date).format("YYYY-MM-DD HH:mm:ss");return(0,v.jsx)("span",{className:e.is_expired?"error":"",title:n,children:t})},s.state={isHighlighted:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isHighlighted,n=this.props.item;return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:st()({"tr-highlight":s}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:n.path}),(0,v.jsx)("td",{children:n.token}),(0,v.jsx)("td",{children:(0,v.jsx)(ye,{email:n.creator_email,name:n.creator_name})}),(0,v.jsx)("td",{children:C()(n.ctime).fromNow()}),(0,v.jsx)("td",{children:n.view_cnt}),(0,v.jsx)("td",{children:this.renderExpiration()}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(t?"":"invisible"),title:(0,p.APU)("Remove"),onClick:this.deleteUploadLink})})]})})}}])}(l.Component),va=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getUploadLinksByPage=function(e){var t=s.state.perPage;U.H.sysAdminListAllUploadLinks(e,t).then((function(n){s.setState({uploadLinkList:n.data.upload_link_list,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteUploadLink=function(e){U.H.sysAdminDeleteUploadLink(e).then((function(t){var n=s.state.uploadLinkList.filter((function(t){return t.token!=e}));s.setState({uploadLinkList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);D.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getUploadLinksByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",uploadLinkList:[],perPage:100,currentPage:1,hasNextPage:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getUploadLinksByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.uploadLinkList,s=e.currentPage,n=e.perPage,r=e.hasNextPage;return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsx)("div",{className:"cur-view-container",children:(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(fa,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:n,hasNextPage:r,getUploadLinksByPage:this.getUploadLinksByPage,resetPerPage:this.resetPerPage,deleteUploadLink:this.deleteUploadLink})})})})})}}])}(l.Component),Aa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).onSelectSortOption=function(e){var t=e.value.split("-"),n=(0,k.default)(t,2),r=n[0],i=n[1];s.props.sortItems(r,i)},s.navItems=[{name:"shareLinks",urlPart:"share-links",text:(0,p.APU)("Share Links")},{name:"uploadLinks",urlPart:"upload-links",text:(0,p.APU)("Upload Links")}],s.sortOptions=[{value:"ctime-asc",text:(0,p.APU)("Ascending by creation time")},{value:"ctime-desc",text:(0,p.APU)("Descending by creation time")},{value:"view_cnt-asc",text:(0,p.APU)("Ascending by visit count")},{value:"view_cnt-desc",text:(0,p.APU)("Descending by visit count")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props,s=t.currentItem,n=t.sortBy,r=t.sortOrder,i="shareLinks"==s,a=this.navItems.findIndex((function(e){return e.name===s}))||0,o=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),l=o[a],c=o.slice(0,a).reduce((function(e,t){return e+t}),0)+(2*a+1)*le.L2;return(0,v.jsxs)("div",{className:"cur-view-path tab-nav-container",children:[(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(l,"px"),"--indicator-offset":"".concat(c,"px")},children:this.navItems.map((function(t,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/").concat(t.urlPart,"/"),className:"m-0 nav-link".concat(s==t.name?" active":""),children:t.text})},n)}))}),i&&(0,v.jsx)(ft.A,{sortBy:n,sortOrder:r,sortOptions:this.sortOptions,onSelectSortOption:this.onSelectSortOption})]})}}])}(l.Component),Pa=Aa,ja={"share-links":"shareLinks","upload-links":"uploadLinks"},Sa=function(e){var t=Object.assign({},((0,mt.A)(e),e)),s=(0,l.useState)(""),r=(0,k.default)(s,2),i=r[0],a=r[1],o=(0,l.useState)("asc"),c=(0,k.default)(o,2),d=c[0],u=c[1],g=(0,l.useState)(100),m=(0,k.default)(g,2),f=m[0],x=m[1],A=(0,l.useState)(1),P=(0,k.default)(A,2),j=P[0],S=P[1],U=(0,l.useState)(!1),N=(0,k.default)(U,2),w=N[0],I=N[1],M=(0,l.useState)(!1),C=(0,k.default)(M,2),L=C[0],_=C[1],O=(0,h.zy)(),R=O.pathname.split("/").filter(Boolean).pop(),T="",F=(0,l.useMemo)((function(){return"all-libraries"===R||"trash-libraries"===R||"all-wikis"===R||"system-library"===R}),[R]);T=F?R:ja[R];var E=function(e){(function(e){for(var t,s=0,n=0,r=e.length;n<r;n++)10===(t=e.charCodeAt(n))?s+=2:t<127?s+=1:t>=128&&t<=2047?s+=2:t>=2048&&t<=65535&&(s+=3);return s})(e)<3?D.A.notify((0,p.APU)("Required at least three letters.")):(0,h.oo)("".concat(p.YcY,"sys/search-libraries/?name_or_id=").concat(encodeURIComponent(e)))},B=(0,l.useCallback)((function(){I(!w)}),[w]),z=(0,l.useCallback)((function(){_(!L)}),[L]),Y=function(e,t){a(e),u(t),S(1);var s=new URL(O.href),n=new URLSearchParams(s.search);n.set("page",1),n.set("order_by",e),t&&n.set("direction",t),s.search=n.toString(),(0,h.oo)(s.toString())},H=function(e){x(e),S(1)},q=(0,l.useCallback)((function(){a(""),u("asc"),x(100),S(1),I(!1),_(!1)}),[]);return(0,l.useEffect)((function(){var e=new URL(window.location).searchParams;a(e.get("order_by")||i),u(e.get("direction")||d),x(parseInt(e.get("per_page")||f)),S(parseInt(e.get("page")||j))}),[]),(0,l.useEffect)((function(){var e=F?"library":"link";q();!function(){var t=new URL(O.href),s="library"===e?["page","per_page"]:[],n=new URLSearchParams;Array.from(t.searchParams.entries()).forEach((function(e){var t=(0,k.default)(e,2),r=t[0],i=t[1];s.includes(r)&&n.set(r,i)})),t.search!==n.toString()&&(0,h.oo)(t.pathname+(n.toString()?"?".concat(n):""))}()}),[F]),(0,v.jsxs)(v.Fragment,{children:["all-libraries"===R&&(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:(0,v.jsx)(Ot.A,{placeholder:(0,p.APU)("Search libraries by name or ID"),submit:E})},t),{},{children:(0,v.jsxs)(y.A,{className:"btn btn-secondary operation-item",onClick:B,children:[(0,v.jsx)("i",{className:"sf3-font sf3-font-enlarge text-secondary mr-1"}),(0,p.APU)("New Library")]})})),"trash-libraries"===R&&(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},t),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:z,children:(0,p.APU)("Clean")})})),("all-wikis"===R||"system-library"===R)&&(0,v.jsx)(b.A,(0,n.default)({},t)),!F&&(0,v.jsx)(b.A,(0,n.default)({},t)),F?(0,v.jsx)(ta,{currentItem:T,sortBy:i,sortItems:Y}):(0,v.jsx)(Pa,{currentItem:T,sortBy:i,sortOrder:d,sortItems:Y}),(0,v.jsxs)(h.Ix,{className:"d-flex overflow-hidden",children:[(0,v.jsx)(na,{path:"all-libraries",sortBy:i,perPage:f,currentPage:j,onResetPerPage:H,isCreateRepoDialogOpen:w,toggleCreateRepoDialog:B}),(0,v.jsx)(ra,{path:"all-wikis",sortBy:i,perPage:f,currentPage:j,onResetPerPage:H}),(0,v.jsx)(oa,{path:"system-library"}),(0,v.jsx)(ha,{path:"trash-libraries",isCleanTrashDialogOpen:L,toggleCleanTrashDialog:z}),(0,v.jsx)(ma,{path:"share-links",onResetPerPage:H}),(0,v.jsx)(va,{path:"upload-links"})]})]})},ya=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"loginLogs",urlPart:"logs/login",text:(0,p.APU)("Login")},{name:"fileAccessLogs",urlPart:"logs/file-access",text:(0,p.APU)("File Access")},{name:"fileUpdateLogs",urlPart:"logs/file-update",text:(0,p.APU)("File Update")},{name:"sharePermissionLogs",urlPart:"logs/share-permission",text:(0,p.APU)("Permission")},{name:"fileTransfer",urlPart:"logs/repo-transfer",text:(0,p.APU)("Repo Transfer")},{name:"groupMember",urlPart:"logs/group-member-audit",text:(0,p.APU)("Group Member")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props.currentItem,s=this.navItems.findIndex((function(e){return e.name===t}))||0,n=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),r=n[s],i=n.slice(0,s).reduce((function(e,t){return e+t}),0)+(2*s+1)*le.L2;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(r,"px"),"--indicator-offset":"".concat(i,"px")},children:this.navItems.map((function(s,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/").concat(s.urlPart,"/"),className:"m-0 nav-link".concat(t==s.name?" active":""),children:s.text})},n)}))})})}}])}(l.Component),Ua=ya,Da=s(71361),Na=s(61599),ba=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).downloadExcel=function(){if(s.isValidDateStr())switch(s.props.logType){case"login":s.sysExportLogs("loginadmin");break;case"file-access":s.sysExportLogs("fileaudit");break;case"file-update":s.sysExportLogs("fileupdate");break;case"share-permission":s.sysExportLogs("permaudit")}},s.queryIOStatus=function(e,t){Da.E.queryIOStatus(e).then((function(n){!0===n.data.is_finished?(s.setState({isShowIODialog:!1}),s.props.toggle(),location.href=p.YcY+"sys/log/export-excel/?task_id="+e+"&log_type="+t):setTimeout((function(){s.queryIOStatus(e,t)}),1e3)})).catch((function(e){s.setState({isShowIODialog:!1}),D.A.danger((0,p.APU)("Failed to export. Please check whether the size of table attachments exceeds the limit."))}))},s.sysExportLogs=function(e){var t=s.state,n=t.startDateStr,r=t.endDateStr,i="";s.setState({isShowIODialog:!0},(function(){U.H.sysAdminExportLogsExcel(n,r,e).then((function(e){return i=e.data.task_id,s.setState({taskId:i}),Da.E.queryIOStatus(i)})).then((function(t){!0===t.data.is_finished?(s.setState({isShowIODialog:!1}),s.props.toggle(),location.href=p.YcY+"sys/log/export-excel/?task_id="+i+"&log_type="+e):s.queryIOStatus(i,e)})).catch((function(e){if(e.response&&500===e.response.status){var t=e.response.data?e.response.data.error_msg:null;t&&"Internal Server Error"!==t?D.A.danger(t):D.A.danger((0,p.APU)("Internal Server Error"))}else{var n=m.Aq.getErrorMsg(e);D.A.danger(n)}s.setState({isShowIODialog:!1}),s.props.toggle()}))}))},s.isValidDateStr=function(){var e=s.state,t=e.startDateStr,n=e.endDateStr;return!!(C()(t,"YYYY-MM-DD",!0).isValid()&&C()(n,"YYYY-MM-DD",!0).isValid()&&C()(t).isBefore(n))||(s.setState({errMsg:(0,p.APU)("Date Invalid.")}),!1)},s.handleStartChange=function(e){var t=e.target.value.trim();s.setState({startDateStr:t,errMsg:""})},s.handleEndChange=function(e){var t=e.target.value.trim();s.setState({endDateStr:t,errMsg:""})},s.onExportToggle=function(e){s.setState({isShowIODialog:!s.state.isShowIODialog}),s.props.toggle()},s.state={loading:!0,startDateStr:"",endDateStr:"",errMsg:"",taskId:"",isShowIODialog:!1},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[!this.state.isShowIODialog&&(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,v.jsx)(be.A,{toggle:this.props.toggle,children:(0,p.APU)("Choose date")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("Start date")}),(0,v.jsx)(G.A,{value:this.state.startDateStr,onChange:this.handleStartChange,placeholder:"yyyy-mm-dd",autoFocus:!0})]}),(0,v.jsxs)(ge.A,{children:[(0,v.jsx)(De.A,{children:(0,p.APU)("End date")}),(0,v.jsx)(G.A,{value:this.state.endDateStr,onChange:this.handleEndChange,placeholder:"yyyy-mm-dd"})]}),this.state.errMsg&&(0,v.jsx)(At.A,{className:"mt-2",color:"danger",children:(0,p.APU)(this.state.errMsg)})]}),(0,v.jsxs)(Ne.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.APU)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.downloadExcel,children:(0,p.APU)("Submit")})]})]}),this.state.isShowIODialog&&(0,v.jsx)(Na.A,{toggle:this.onExportToggle})]})}}])}(l.Component),wa=["children"],Ia={login:"loginLogs","file-access":"fileAccessLogs","file-update":"fileUpdateLogs","share-permission":"sharePermissionLogs","repo-transfer":"fileTransfer","group-member-audit":"groupMember"},ka=function(e){var t=e.children,s=(0,oe.default)(e,wa),r=(0,l.useState)(!1),i=(0,k.default)(r,2),a=i[0],o=i[1],c=(0,h.zy)().pathname.split("/").filter(Boolean).pop(),d=Ia[c],u=function(){o(!a)},g="fileTransfer"===d||"groupMember"===d;return(0,v.jsxs)(v.Fragment,{children:[g?(0,v.jsx)(b.A,(0,n.default)({},s)):(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},s),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:u,children:(0,p.APU)("Export Excel")})})),(0,v.jsx)(Ua,(0,n.default)({currentItem:d},s)),(0,v.jsx)("div",{className:"h-100 d-flex overflow-auto",children:t}),a&&(0,v.jsx)(Kt.A,{children:(0,v.jsx)(ba,{logType:d,toggle:u})})]})},Ma=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"all",urlPart:"all",text:(0,p.APU)("All")},{name:"unhandled",urlPart:"unhandled",text:(0,p.APU)("Unhandled")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props.currentItem,s=this.navItems.findIndex((function(e){return e.name===t}))||0,n=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),r=n[s],i=n.slice(0,s).reduce((function(e,t){return e+t}),0)+(2*s+1)*le.L2;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(r,"px"),"--indicator-offset":"".concat(i,"px")},children:this.navItems.map((function(s,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/virus-files/").concat(s.urlPart,"/"),className:"m-0 nav-link".concat(t==s.name?" active":""),children:s.text})},n)}))})})}}])}(l.Component),Ca=Ma,La=["children"],_a=function(e){var t=e.children,s=(0,oe.default)(e,La),r=(0,h.zy)().pathname.split("/").filter(Boolean).pop();return(0,v.jsxs)("div",{children:["unhandled"===r?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},s),{},{children:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(y.A,{onClick:function(){He.B.dispatch(qe.T.HANDLE_SELECTED_OPERATIONS,"delete-virus")},className:"operation-item",children:(0,p.APU)("Delete")}),(0,v.jsx)(y.A,{onClick:function(){He.B.dispatch(qe.T.HANDLE_SELECTED_OPERATIONS,"ignore-virus")},className:"operation-item",children:(0,p.APU)("Ignore")})]})})):(0,v.jsx)(b.A,(0,n.default)({},s)),(0,v.jsx)(Ca,{currentItem:r}),(0,v.jsx)("div",{className:"h-100 d-flex overflow-auto",children:t})]})},Oa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).navItems=[{name:"operation",urlPart:"admin-logs/operation",text:(0,p.APU)("Admin Operation Logs")},{name:"login",urlPart:"admin-logs/login",text:(0,p.APU)("Admin Login Logs")}],s.itemRefs=[],s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props.currentItem,s=this.navItems.findIndex((function(e){return e.name===t}))||0,n=this.itemRefs.map((function(e){return null===e||void 0===e?void 0:e.offsetWidth})),r=n[s],i=n.slice(0,s).reduce((function(e,t){return e+t}),0)+(2*s+1)*le.L2;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav nav-indicator-container position-relative",style:{"--indicator-width":"".concat(r,"px"),"--indicator-offset":"".concat(i,"px")},children:this.navItems.map((function(s,n){return(0,v.jsx)("li",{className:"nav-item mx-3",ref:function(t){return e.itemRefs[n]=t},children:(0,v.jsx)(h.N_,{to:"".concat(p.YcY,"sys/").concat(s.urlPart,"/"),className:"m-0 nav-link".concat(t==s.name?" active":""),children:s.text})},n)}))})})}}])}(l.Component),Ra=["children"],Ta=function(e){var t=e.children,s=(0,oe.default)(e,Ra),r=(0,h.zy)().pathname.split("/").filter(Boolean).pop();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},s)),(0,v.jsx)(Oa,{currentItem:r}),(0,v.jsx)("div",{className:"h-100 d-flex overflow-auto",children:t})]})},Fa=(s(16322),s(18291),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,a.default)(this,t,[e])).getCurrentTabForPageList=function(e){for(var t,s,n="".concat(p.YcY,"sys/"),r=0,i=e.length;r<i;r++){t=e[r].urlPartList,s=e[r].tab;for(var a=0,o=t.length;a<o;a++)if(-1!=location.href.indexOf("".concat(n).concat(t[a])))return s}},s.onCloseSidePanel=function(){s.setState({isSidePanelClosed:!s.state.isSidePanelClosed})},s.tabItemClick=function(e){s.setState({currentTab:e}),m.Aq.isDesktop()||s.state.isSidePanelClosed||s.setState({isSidePanelClosed:!0})},s.toggleSidePanel=function(){s.setState({isSidePanelClosed:!s.state.isSidePanelClosed})},s.state={isSidePanelClosed:!1,currentTab:"file-scan"},s}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){var e=window.location.href.split("/"),t=e[e.length-2],s=this.getCurrentTabForPageList([{tab:"devices",urlPartList:["desktop-devices","mobile-devices","device-errors"]},{tab:"libraries",urlPartList:["all-libraries","search-libraries","system-library","trash-libraries","libraries/"]},{tab:"statistic",urlPartList:["statistics/file","statistics/storage","statistics/user","statistics/traffic","statistics/reports","statistics/metrics"]},{tab:"users",urlPartList:["users/","search-users/"]},{tab:"groups",urlPartList:["groups/","search-groups/"]},{tab:"organizations",urlPartList:["organizations/","search-organizations/"]},{tab:"links",urlPartList:["share-links/","upload-links/"]},{tab:"institutions",urlPartList:["institutions/"]},{tab:"termsandconditions",urlPartList:["terms-and-conditions/"]},{tab:"departments",urlPartList:["departments/"]},{tab:"logs",urlPartList:["logs/"]},{tab:"virus-files",urlPartList:["virus-files/"]},{tab:"adminLogs",urlPartList:["admin-logs/"]}]);t=s||t,this.setState({currentTab:t})}},{key:"UNSAFE_componentWillMount",value:function(){m.Aq.isDesktop()||this.setState({isSidePanelClosed:!0})}},{key:"render",value:function(){var e=this.state,t=e.currentTab,s=e.isSidePanelClosed,r={toggleSidePanel:this.toggleSidePanel};return(0,v.jsxs)("div",{id:"main",className:"sys-admin",children:[(0,v.jsx)(P,{isSidePanelClosed:s,onCloseSidePanel:this.onCloseSidePanel,currentTab:t,tabItemClick:this.tabItemClick}),(0,v.jsx)(S,{children:(0,v.jsxs)(h.Ix,{className:"reach-router",children:[(0,v.jsx)(I,(0,n.default)({path:p.YcY+"sys/info"},r)),(0,v.jsxs)(ue,(0,n.default)((0,n.default)({path:"".concat(p.YcY,"sys/statistics/")},r),{},{children:[(0,v.jsx)(H,{path:"file"}),(0,v.jsx)(q,{path:"storage"}),(0,v.jsx)(Z,{path:"user"}),(0,v.jsx)(J,{path:"traffic"}),(0,v.jsx)(ee,{path:"reports"}),(0,v.jsx)(ae,{path:"metrics"})]})),(0,v.jsx)(Sa,(0,n.default)({path:"".concat(p.YcY,"sys/*")},r)),(0,v.jsx)(bs,(0,n.default)({path:"".concat(p.YcY,"sys/libraries/:repoID")},r)),(0,v.jsxs)(qi,(0,n.default)((0,n.default)({path:"".concat(p.YcY,"sys/devices/")},r),{},{children:[(0,v.jsx)(Ki,{path:"desktop"}),(0,v.jsx)(Xi,{path:"mobile"}),(0,v.jsx)(Zi,{path:"errors"})]})),(0,v.jsx)(vs,(0,n.default)({path:p.YcY+"sys/search-libraries"},r)),(0,v.jsx)(Or,(0,n.default)({path:p.YcY+"sys/web-settings"},r)),(0,v.jsx)(Er,(0,n.default)({path:p.YcY+"sys/notifications"},r)),(0,v.jsx)(Os,(0,n.default)({path:p.YcY+"sys/groups"},r)),(0,v.jsx)(Rs,(0,n.default)({path:p.YcY+"sys/search-groups"},r)),(0,v.jsx)(Ys,(0,n.default)({path:p.YcY+"sys/groups/:groupID/libraries"},r)),(0,v.jsx)(Qs,(0,n.default)({path:p.YcY+"sys/groups/:groupID/members"},r)),(0,v.jsx)(fn,(0,n.default)({path:p.YcY+"sys/departments/"},r)),(0,v.jsx)(Sn,(0,n.default)({path:p.YcY+"sys/organizations"},r)),(0,v.jsx)(yn,(0,n.default)({path:p.YcY+"sys/search-organizations"},r)),(0,v.jsx)(kn,(0,n.default)({path:p.YcY+"sys/organizations/:orgID/info"},r)),(0,v.jsx)(_n,(0,n.default)({path:p.YcY+"sys/organizations/:orgID/users"},r)),(0,v.jsx)(Tn,(0,n.default)({path:p.YcY+"sys/organizations/:orgID/groups"},r)),(0,v.jsx)(Bn,(0,n.default)({path:p.YcY+"sys/organizations/:orgID/libraries"},r)),(0,v.jsx)(qn,(0,n.default)({path:p.YcY+"sys/institutions"},r)),(0,v.jsx)(Wn,(0,n.default)({path:p.YcY+"sys/institutions/:institutionID/info"},r)),(0,v.jsx)(Jn,(0,n.default)({path:p.YcY+"sys/institutions/:institutionID/members"},r)),(0,v.jsx)(tr,(0,n.default)({path:p.YcY+"sys/institutions/:institutionID/admins"},r)),(0,v.jsxs)(ka,(0,n.default)((0,n.default)({path:"".concat(p.YcY,"sys/logs/")},r),{},{children:[(0,v.jsx)(ar,(0,n.default)({path:"login"},r)),(0,v.jsx)(hr,(0,n.default)({path:"file-access"},r)),(0,v.jsx)(Dr,(0,n.default)({path:"repo-transfer"},r)),(0,v.jsx)(Ir,(0,n.default)({path:"group-member-audit"},r)),(0,v.jsx)(xr,(0,n.default)({path:"file-update"},r)),(0,v.jsx)(jr,(0,n.default)({path:"share-permission"},r))]})),(0,v.jsxs)(Ta,(0,n.default)((0,n.default)({path:"".concat(p.YcY,"sys/admin-logs/")},r),{},{children:[(0,v.jsx)(Ri,{path:"operation"}),(0,v.jsx)(Ei,{path:"login"})]})),(0,v.jsx)(Vt,(0,n.default)({path:"".concat(p.YcY,"sys/users/*")},r)),(0,v.jsx)(Te,(0,n.default)({path:p.YcY+"sys/search-users"},r)),(0,v.jsxs)(Wt,(0,n.default)((0,n.default)({path:"".concat(p.YcY,"sys/user/:email/")},r),{},{children:[(0,v.jsx)(Ke,{path:"/"}),(0,v.jsx)(et,{path:"owned-libraries"}),(0,v.jsx)(ot,{path:"shared-libraries"}),(0,v.jsx)(ut,{path:"shared-links"}),(0,v.jsx)(pt,{path:"groups"})]})),(0,v.jsx)(li,(0,n.default)({path:p.YcY+"sys/invitations"},r)),(0,v.jsx)(bi,(0,n.default)({path:p.YcY+"sys/terms-and-conditions/"},r)),(0,v.jsxs)(_a,(0,n.default)((0,n.default)({path:"".concat(p.YcY,"sys/virus-files/")},r),{},{children:[(0,v.jsx)(ki,{path:"all"}),(0,v.jsx)(Li,{path:"unhandled"})]})),(0,v.jsx)(Yr,(0,n.default)({path:p.YcY+"sys/file-scan-records"},r)),(0,v.jsx)(Jr,(0,n.default)({path:p.YcY+"sys/work-weixin"},r)),(0,v.jsx)(ii,(0,n.default)({path:p.YcY+"sys/dingtalk"},r)),(0,v.jsx)(Bi,(0,n.default)({path:p.YcY+"sys/abuse-reports"},r))]})}),(0,v.jsx)(d.Ay,{query:"(max-width: 767.8px)",children:(0,v.jsx)(u.A,{zIndex:"1030",isOpen:!s,toggle:this.toggleSidePanel,contentClassName:"d-none"})})]})}}])}(l.Component));(0,c.createRoot)(document.getElementById("wrapper")).render((0,v.jsx)(g.I18nextProvider,{value:f.A,children:(0,v.jsx)(h.dP,{history:h.W7,children:(0,v.jsx)(Fa,{})})}))},32043:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(51925),c=s(40326),d=s(44414),u=function(e){function t(){return(0,n.default)(this,t),(0,i.default)(this,t,arguments)}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){return(0,d.jsxs)("div",{className:"main-panel-north ".concat(this.props.children?"border-left-show":""),children:[(0,d.jsxs)("div",{className:"cur-view-toolbar",children:[(0,d.jsx)("span",{className:"sf2-icon-menu side-nav-toggle hidden-md-up d-md-none",title:(0,c.APU)("Side Nav Menu"),onClick:this.props.toggleSidePanel}),(0,d.jsx)("div",{className:"operation",children:this.props.children})]}),(0,d.jsxs)("div",{className:"common-toolbar",children:[this.props.search&&this.props.search,(0,d.jsx)(l.A,{isAdminPanel:!0})]})]})}}])}(o.Component);t.A=u},33320:function(e,t,s){var n=s(23029),r=s(92901),i=s(39874),a=s(85501),o=s(9950),l=s(44414),c=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,i.default)(this,t,[e])).handleInputChange=function(e){s.setState({value:e.target.value})},s.handleKeyDown=function(e){"Enter"==e.key&&(e.preventDefault(),s.handleSubmit())},s.handleSubmit=function(){var e=s.state.value.trim();if(!e)return!1;s.props.submit(e)},s.state={value:""},s}return(0,a.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){return(0,l.jsxs)("div",{className:"input-icon",children:[(0,l.jsx)("i",{className:"d-flex input-icon-addon sf3-font sf3-font-search"}),(0,l.jsx)("input",{type:"text",className:"form-control search-input h-6 mr-1",style:{width:"17rem"},placeholder:this.props.placeholder,value:this.state.value,onChange:this.handleInputChange,onKeyDown:this.handleKeyDown,autoComplete:"off"})]})}}])}(o.Component);t.A=c},37696:function(){},2201:function(){},63864:function(){}},function(e){e.O(0,[4223],(function(){return t=98091,e(e.s=t);var t}));e.O()}]);