{"version":3,"sources":["components/history-list-view/history-list-item.js","components/history-list-view/history-list-view.js","pages/file-history/side-panel.js","pages/file-history/main-panel.js","file-history.js","../node_modules/@seafile/seafile-editor/dist/utils/diff/compare-strings.js","../node_modules/@seafile/seafile-editor/dist/utils/diff/diff.js","../node_modules/@seafile/seafile-editor/dist/viewer/diff-viewer.js"],"names":["moment","locale","window","app","config","lang","HistoryListItem","props","onMouseEnter","isItemFreezed","setState","isShowOperationIcon","onMouseLeave","onToggleClick","e","isMenuShow","state","onFreezedItemToggle","onItemClick","item","commit_id","currentItem","currentIndex","index","onItemRestore","onItemDownload","this","time","ctime","format","isHigtlightItem","objID","rev_file_id","url","URLDecorator","getUrl","type","filePath","className","onClick","creator_name","isOpen","toggle","tag","data-toggle","aria-expanded","alt","gettext","href","onItemDownLoad","React","Component","HistoryListView","componentDidMount","historyList","length","onScrollHandler","event","clientHeight","target","scrollHeight","isBottom","scrollTop","hasMore","reloadMore","preItem","onScroll","map","isReloadingData","SidePanel","currentPage","editUtilities","listFileHistoryRecords","PER_PAGE","then","res","updateResultState","data","commitId","revertFile","success","isLoading","refershFileList","message","toaster","historyInfo","isError","fileOwner","Error","initResultState","result","page","total_count","creator_email","require","MainPanel","onSearchedClick","Prism","highlightAll","renderingContent","scriptSource","mediaUrl","newMarkdownContent","oldMarkdownContent","FileHistory","searchedItem","Utils","handleSearchedItemClick","setDiffContent","onHistoryItemClick","axios","all","seafileAPI","getFileRevision","historyRepoID","path","spread","res1","getFileContent","content1","content2","id","title","fileName","ReactDOM","render","document","getElementById","compareTwoStrings","str1","str2","toUpperCase","pairs1","wordLetterPairs","pairs2","union","intersection","forEach","pair1","pair2","i","splice","flattenDeep","arr","Array","isArray","reduce","a","b","concat","letterPairs","str","pairs","max","substring","split","equalityFunctionForSlate","lodash","isEqual","Text","isText","text","includes","Node","children","defaultEqualityFunction","SlateDiff","_this","_classCallCheck","deepDiff","newNodes","oldNodes","equalFunc","depth","arguments","undefined","slateDiffNodes","nodeDepth","diff","Diff","ArrayDiff","diffElement","changeType","newItemData","diff_state","new_index","newIndex","old_index","node_depth","Object","assign","ADD","_newItemData","DELETE","_newItemData2","oldIndex","diffNodes","elementType","getTextDiff","newItem","oldItem","_newItemData3","push","getDiffDocument","deserialize","topSlateDiffNodes","splitTopDiffNodes","_createClass","key","value","newTextItem","oldTextItem","textNodes","nodes","textDiff","newText","oldText","marks","texts","StringDiff","textDiffArray","stringFragment","lastDiffState","textCharacter","markType","_objectSpread","_defineProperty","diffParagraph","newParagraph","cloneDeep","oldParagraph","newParagraphNodes","oldParagraphNodes","node","index1","paragraph_state","_this2","newSlateDiffNodes","splicedParagraph","splitDiffParagraph","splitTableDiffParagraph","_this3","tableRow","rowIndex","tablerows","tableCell","splicedParagraphNodes","ArrayDiffElement","opts","shouldDetectChange","similarityFunc","element","added","removed","replaced","common","newString","oldString","newLength","oldLength","n","o","table","Math","addCommon","addAdded","addRemoved","newArray","oldArray","callback","diffState","addReplaced","DiffViewer","_React$PureComponent","_props","_possibleConstructorReturn","_getPrototypeOf","call","renderDiffNode","createElement","renderNode","slateDiff","_inherits","LoadScript","SlateViewer","style","width","renderDiffElement","renderDiffLeaf","renderLeaf","PureComponent"],"mappings":"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","file":"static/js/fileHistory.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\n\nmoment.locale(window.app.config.lang);\n\nconst propTypes = {\n  index: PropTypes.number.isRequired,\n  item: PropTypes.object.isRequired,\n  currentItem: PropTypes.object,\n  isItemFreezed: PropTypes.bool.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n  onFreezedItemToggle: PropTypes.func.isRequired,\n};\n\nclass HistoryListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: true});\n    }\n  }\n\n  onMouseLeave = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: false});\n    }\n  }\n\n  onToggleClick = (e) => {\n    this.setState({isMenuShow: !this.state.isMenuShow});\n    this.props.onFreezedItemToggle();\n  }\n\n  onItemClick = () => {\n    this.setState({isShowOperationIcon: false});  //restore to default state\n    if (this.props.item.commit_id === this.props.currentItem.commit_id) {\n      return;\n    }\n    let currentIndex = this.props.index;\n    this.props.onItemClick(this.props.item, currentIndex);\n  }\n\n  onItemRestore = () => {\n    this.props.onItemRestore(this.props.currentItem);\n  }\n\n  onItemDownload = () => {\n    // nothing todo\n  }\n\n  render() {\n    if (!this.props.currentItem) {\n      return '';\n    }\n    let item = this.props.item;\n    let time = moment(item.ctime).format('YYYY-MM-DD HH:mm');\n    let isHigtlightItem = false;\n    if (this.props.item && this.props.currentItem) {\n      isHigtlightItem = this.props.item.commit_id === this.props.currentItem.commit_id;\n    }\n    let objID = this.props.currentItem.rev_file_id;\n    let url = URLDecorator.getUrl({type: 'download_historic_file', filePath: filePath, objID: objID});\n    return (\n      <li\n        className={`history-list-item ${isHigtlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onItemClick}\n      >\n        <div className=\"history-info\">\n          <div className=\"time\">{time}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{item.creator_name}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHigtlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryListItem.propTypes = propTypes;\n\nexport default HistoryListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport HisotyListItem from './history-list-item';\nimport Loading from '../loading';\n\nconst propTypes = {\n  hasMore: PropTypes.bool.isRequired,\n  isReloadingData: PropTypes.bool.isRequired,\n  historyList: PropTypes.array.isRequired,\n  reloadMore: PropTypes.func.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n};\n\nclass HistoryListView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isItemFreezed: false,\n      currentItem: null,\n    };\n  }\n\n  componentDidMount = () => {\n    let historyList = this.props.historyList;\n    if (historyList.length > 0) {\n      this.setState({currentItem: historyList[0]});\n      if (historyList === 1) {\n        this.props.onItemClick(historyList[0]);\n      } else {\n        this.props.onItemClick(historyList[0], historyList[1]);\n      }\n    }\n  }\n\n  onFreezedItemToggle = () => {\n    this.setState({isItemFreezed: !this.state.isItemFreezed});\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop    = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    let hasMore = this.props.hasMore;\n    if (isBottom && hasMore) {\n      this.props.reloadMore();\n    }\n  }\n\n  onItemClick = (item, currentIndex) => {\n    this.setState({currentItem: item});\n    if (currentIndex !== this.props.historyList.length) {\n      let preItem = this.props.historyList[currentIndex + 1];\n      this.props.onItemClick(item, preItem);\n    } else {\n      this.props.onItemClick(item);\n    }\n  }\n\n  render() {\n    return (\n      <ul className=\"history-list-container\" onScroll={this.onScrollHandler}>\n        {this.props.historyList.map((item, index) => {\n          return (\n            <HisotyListItem\n              key={index}\n              item={item}\n              index={index}\n              currentItem={this.state.currentItem}\n              isItemFreezed={this.state.isItemFreezed}\n              onItemClick={this.onItemClick}\n              onItemRestore={this.props.onItemRestore}\n              onFreezedItemToggle={this.onFreezedItemToggle}\n            />\n          );\n        })}\n        {this.props.isReloadingData && <li><Loading /></li>}\n      </ul>\n    );\n  }\n}\n\nHistoryListView.propTypes = propTypes;\n\nexport default HistoryListView;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, PER_PAGE, filePath } from '../../utils/constants';\nimport editUtilities from '../../utils/editor-utilities';\nimport Loading from '../../components/loading';\nimport HistoryListView from '../../components/history-list-view/history-list-view';\nimport toaster from '../../components/toast';\n\nconst propTypes = {\n  onItemClick: PropTypes.func.isRequired,\n};\n\nclass SidePanel extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      historyInfo: '',\n      currentPage: 1,\n      hasMore: false,\n      isLoading: true,\n      isError: false,\n      fileOwner: '',\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      let historyList = res.data;\n      if (historyList.length === 0) {\n        this.setState({isLoading: false});\n        throw Error('there has an error in server');\n      }\n      this.initResultState(res.data);\n    });\n  }\n\n  refershFileList() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      this.initResultState(res.data);\n    });\n  }\n\n  initResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: result.data,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email,\n      });\n    }\n  }\n\n  updateResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: [...this.state.historyInfo, ...result.data],\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email\n      });\n    }\n  }\n\n  reloadMore = () => {\n    if (!this.state.isReloadingData) {\n      let currentPage = this.state.currentPage + 1;\n      this.setState({\n        currentPage: currentPage,\n        isReloadingData: true,\n      });\n      editUtilities.listFileHistoryRecords(filePath, currentPage, PER_PAGE).then(res => {\n        this.updateResultState(res.data);\n        this.setState({isReloadingData: false});\n      });\n    }\n  }\n\n  onItemRestore = (currentItem) => {\n    let commitId = currentItem.commit_id;\n    editUtilities.revertFile(filePath, commitId).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n      let message = gettext('Successfully restored.');\n      toaster.success(message);\n    });\n  }\n\n  onItemClick =(item, preItem) => {\n    this.props.onItemClick(item, preItem);\n  }\n\n  render() {\n    return (\n      <div className=\"side-panel history-side-panel\">\n        <div className=\"side-panel-center\">\n          <div className=\"history-side-panel-title\">{gettext('History Versions')}</div>\n          <div className=\"history-body\">\n            {this.state.isLoading && <Loading />}\n            {this.state.historyInfo &&\n              <HistoryListView\n                hasMore={this.state.hasMore}\n                isReloadingData={this.state.isReloadingData}\n                historyList={this.state.historyInfo}\n                reloadMore={this.reloadMore}\n                onItemClick={this.onItemClick}\n                onItemRestore={this.onItemRestore}\n              />\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = propTypes;\n\nexport default SidePanel;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Prism from 'prismjs';\nimport Loading from '../../components/loading';\nimport { mediaUrl } from '../../utils/constants';\nimport DiffViewer from '@seafile/seafile-editor/dist/viewer/diff-viewer';\n\nrequire('@seafile/seafile-editor/dist/editor/code-highlight-package');\n\nconst contentClass = 'markdown-viewer-render-content';\nconst propTypes = {\n  renderingContent: PropTypes.bool.isRequired,\n  content: PropTypes.string,\n  newMarkdownContent: PropTypes.string.isRequired,\n  oldMarkdownContent: PropTypes.string.isRequired,\n};\n\nclass MainPanel extends React.Component {\n\n  componentDidMount() {\n    Prism.highlightAll();\n  }\n\n  onSearchedClick = () => {\n    //todos;\n  }\n\n  render() {\n    return (\n      <div className=\"main-panel\">\n        <div className=\"main-panel-center content-viewer\">\n          <div className={contentClass}>\n            {\n              this.props.renderingContent ?\n                (<Loading />) :\n                (<div className=\"diff-view article\">\n                  <DiffViewer\n                    scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n                    newMarkdownContent={this.props.newMarkdownContent}\n                    oldMarkdownContent={this.props.oldMarkdownContent}\n                  />\n                </div>)\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nMainPanel.propTypes = propTypes;\n\nexport default MainPanel;\n","import React, { Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport axios from 'axios';\nimport { fileName, historyRepoID } from './utils/constants';\nimport { Utils } from './utils/utils';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport SidePanel from './pages/file-history/side-panel';\nimport MainPanel from './pages/file-history/main-panel';\nimport { seafileAPI } from './utils/seafile-api';\n\nimport './css/layout.css';\nimport './css/file-history.css';\nimport './css/toolbar.css';\nimport './css/search.css';\n\nclass FileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      renderingContent: true,\n      newMarkdownContent: '',\n      oldMarkdownContent: ''\n    };\n  }\n\n  onSearchedClick = (searchedItem) => {\n    Utils.handleSearchedItemClick(searchedItem);\n  }\n\n  setDiffContent = (newMarkdownContent, oldMarkdownContent)=> {\n    this.setState({\n      renderingContent: false,\n      newMarkdownContent: newMarkdownContent,\n      oldMarkdownContent: oldMarkdownContent,\n    });\n  }\n\n\n  onHistoryItemClick = (item, preItem)=> {\n    this.setState({renderingContent: true});\n    if (preItem) {\n      axios.all([\n        seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path),\n        seafileAPI.getFileRevision(historyRepoID, preItem.commit_id, preItem.path)\n      ]).then(axios.spread((res, res1) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n          seafileAPI.getFileContent(res1.data)\n        ]).then(axios.spread((content1, content2) => {\n          this.setDiffContent(content1.data, content2.data);\n        }));\n      }));\n    } else {\n      seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path).then((res) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n        ]).then(axios.spread((content1) => {\n          this.setDiffContent(content1.data, '');\n        }));\n      });\n    }\n  }\n\n  render() {\n    return(\n      <Fragment>\n        <div id=\"header\" className=\"history-header\">\n          <div className=\"title\">\n            <a href=\"javascript:window.history.back()\" className=\"go-back\" title=\"Back\">\n              <span className=\"fas fa-chevron-left\"></span>\n            </a>\n            <span className=\"name\">{fileName}</span>\n          </div>\n          <div className='toolbar'>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n        </div>\n        <div id=\"main\" className=\"history-content\">\n          <MainPanel\n            newMarkdownContent={this.state.newMarkdownContent}\n            oldMarkdownContent={this.state.oldMarkdownContent}\n            renderingContent={this.state.renderingContent}\n          />\n          <SidePanel onItemClick={this.onHistoryItemClick}/>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nReactDOM.render (\n  <FileHistory />,\n  document.getElementById('wrapper')\n);\n","function compareTwoStrings(str1, str2) {\n  if (!str1.length && !str2.length) return 1; // if both are empty strings\n\n  if (!str1.length || !str2.length) return 0; // if only one is empty string\n\n  if (str1.toUpperCase() === str2.toUpperCase()) return 1; // identical\n\n  if (str1.length === 1 && str2.length === 1) return 0; // both are 1-letter strings\n\n  var pairs1 = wordLetterPairs(str1);\n  var pairs2 = wordLetterPairs(str2);\n  var union = pairs1.length + pairs2.length;\n  var intersection = 0;\n  pairs1.forEach(function (pair1) {\n    for (var i = 0, pair2; pair2 = pairs2[i]; i++) {\n      if (pair1 !== pair2) continue;\n      intersection++;\n      pairs2.splice(i, 1);\n      break;\n    }\n  });\n  return intersection * 2 / union;\n}\n\nfunction flattenDeep(arr) {\n  return Array.isArray(arr) ? arr.reduce(function (a, b) {\n    return a.concat(flattenDeep(b));\n  }, []) : [arr];\n}\n\nfunction letterPairs(str) {\n  var pairs = [];\n\n  for (var i = 0, max = str.length - 1; i < max; i++) {\n    pairs[i] = str.substring(i, i + 2);\n  }\n\n  return pairs;\n}\n\nfunction wordLetterPairs(str) {\n  var pairs = str.toUpperCase().split(' ').map(letterPairs);\n  return flattenDeep(pairs);\n}\n\nexport { compareTwoStrings };","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport lodash from 'lodash';\nimport { compareTwoStrings } from './compare-strings';\nimport { Node, Text } from 'slate';\nimport { deserialize } from '../slate2markdown';\n\nfunction equalityFunctionForSlate(a, b) {\n  if (a.type !== b.type) {\n    return false;\n  }\n\n  if (lodash.isEqual(a, b)) {\n    return true;\n  }\n\n  if (Text.isText(a) && Text.isText(b)) {\n    if (compareTwoStrings(a.text, b.text) >= 0.5) {\n      return 'changed';\n    } else {\n      return false;\n    }\n  }\n\n  if (a.type === b.type && (a.type.includes('ordered_list') || a.type.includes('unordered_list'))) {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n\n  if (a.type === b.type && (a.children.length > 1 || b.children.length > 1) && a.type === 'list_item') {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n\n  if (a.type === b.type && a.type === 'paragraph') {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n\n  if (a.type === b.type && a.type === 'table') {\n    if (compareTwoStrings(Node.text(a), Node.text(b)) >= 0.5) {\n      return 'changed';\n    }\n  }\n  /*\n   * the table diff is not the same as list diff,\n   * in the table, if the old table_line and the new table_line or the old table_cell and new table_cell are not equal\n   * the table_line or table_cells is set as changed, then the diff is expressed in the text of table_cell\n   * */\n\n\n  if (a.type === b.type && a.type === 'table_row') {\n    return 'changed';\n  }\n\n  if (a.type === b.type && a.type === 'table_cell') {\n    return 'changed';\n  }\n\n  return false;\n}\n\nfunction defaultEqualityFunction(a, b) {\n  return a === b;\n}\n\nvar SlateDiff = /*#__PURE__*/function () {\n  function SlateDiff() {\n    var _this = this;\n\n    _classCallCheck(this, SlateDiff);\n\n    this.deepDiff = function (newNodes, oldNodes, equalFunc) {\n      var depth = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var slateDiffNodes = []; // remeber current nodes depth\n\n      var nodeDepth = depth + 1;\n      var diff = new Diff({\n        equalFunc: equalFunc\n      });\n      diff.ArrayDiff(newNodes, oldNodes);\n\n      for (var i = 0; i < diff.diff.length; i++) {\n        var diffElement = diff.diff[i];\n        var changeType = diffElement.changeType;\n\n        if (changeType === 'common') {\n          var newItemData = {\n            diff_state: 'diff-common',\n            new_index: diffElement.newIndex,\n            old_index: -1,\n            node_depth: nodeDepth\n          };\n          diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, newItemData);\n        } else if (changeType === 'added') {\n          if (Text.isText(diffElement.item)) {\n            diffElement.item.ADD = true;\n          } else {\n            var _newItemData = {\n              diff_state: 'diff-added',\n              new_index: diffElement.newIndex,\n              old_index: -1,\n              node_depth: nodeDepth\n            };\n            diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, _newItemData);\n          }\n        } else if (changeType === 'removed') {\n          if (Text.isText(diffElement.item)) {\n            diffElement.item.DELETE = true;\n          } else {\n            var _newItemData2 = {\n              diff_state: 'diff-removed',\n              new_index: -1,\n              old_index: diffElement.oldIndex,\n              node_depth: nodeDepth\n            };\n            diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, _newItemData2);\n          }\n        } else if (changeType === 'replaced') {\n          var diffNodes = void 0,\n              elementType = diffElement.item.type || 'text';\n\n          if (elementType === 'text') {\n            // compare text diff leaves use getTextDiff function\n            diffNodes = _this.getTextDiff(diffElement.newItem, diffElement.oldItem);\n          } else if (elementType.includes('ordered_list') || elementType.includes('unordered_list') || elementType.includes('list_item')) {\n            diffNodes = _this.deepDiff(diffElement.newItem.children, diffElement.oldItem.children, equalFunc, nodeDepth);\n          } else if (elementType === 'table' || elementType === 'table_row' || elementType === 'table_cell') {\n            diffNodes = _this.deepDiff(diffElement.newItem.children, diffElement.oldItem.children, equalFunc, nodeDepth);\n          } else if (elementType === 'paragraph') {\n            // compare text or inline\n            diffNodes = _this.deepDiff(diffElement.newItem.children, diffElement.oldItem.children, equalFunc, nodeDepth);\n          }\n\n          if (Text.isText(diffElement.item)) {\n            diffElement.item = diffNodes;\n          } else {\n            var _newItemData3 = {\n              diff_state: 'diff-replaced',\n              new_index: -1,\n              old_index: diffElement.oldIndex,\n              node_depth: nodeDepth\n            };\n            diffElement.item.data = Object.assign(diffElement.item.data ? diffElement.item.data : {}, _newItemData3);\n            diffElement.item.children = diffNodes;\n          }\n        } // add diff nodes to document\n\n\n        if (Array.isArray(diffElement.item)) {\n          slateDiffNodes = slateDiffNodes.concat(diffElement.item);\n        } else {\n          slateDiffNodes.push(diffElement.item);\n        }\n      }\n\n      return slateDiffNodes;\n    };\n\n    this.getDiffDocument = function (newMarkdownContent, oldMarkdownContent) {\n      var newNodes = deserialize(newMarkdownContent);\n      var oldNodes = deserialize(oldMarkdownContent);\n\n      var topSlateDiffNodes = _this.deepDiff(newNodes, oldNodes, equalityFunctionForSlate); //handle replaced paragraph\n\n\n      topSlateDiffNodes = _this.splitTopDiffNodes(topSlateDiffNodes);\n      return topSlateDiffNodes;\n    };\n  }\n\n  _createClass(SlateDiff, [{\n    key: \"getTextDiff\",\n    value: function getTextDiff(newTextItem, oldTextItem) {\n      var textNodes = [];\n      var nodes = this.textDiff(newTextItem.text, oldTextItem.text);\n      textNodes = textNodes.concat(nodes);\n      return textNodes;\n    }\n  }, {\n    key: \"textDiff\",\n    value: function textDiff(newText, oldText) {\n      var marks = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      var texts = [];\n      var diff = new Diff({\n        equalFunc: defaultEqualityFunction\n      });\n      diff.StringDiff(newText, oldText);\n      var textDiffArray = diff.diff;\n      var stringFragment = '';\n      var lastDiffState = textDiffArray[0].changeType;\n      textDiffArray.forEach(function (textCharacter, index, textDiffArray) {\n        var markType = '';\n\n        if (lastDiffState === 'removed') {\n          markType = 'DELETE';\n        } else if (lastDiffState === 'added') {\n          markType = 'ADD';\n        }\n\n        if (lastDiffState === textCharacter.changeType) {\n          stringFragment += textCharacter.item;\n\n          if (index === textDiffArray.length - 1) {\n            texts.push(_objectSpread(_defineProperty({\n              text: stringFragment\n            }, markType, true), marks));\n          }\n        } else if (textCharacter.changeType !== lastDiffState) {\n          texts.push(_objectSpread(_objectSpread({\n            text: stringFragment\n          }, marks), {}, _defineProperty({}, markType, true)));\n          lastDiffState = textCharacter.changeType;\n          stringFragment = textCharacter.item;\n\n          if (index === textDiffArray.length - 1) {\n            if (lastDiffState === 'removed') {\n              markType = 'DELETE';\n            } else if (lastDiffState === 'added') {\n              markType = 'ADD';\n            }\n\n            texts.push(_objectSpread(_defineProperty({\n              text: stringFragment\n            }, markType, true), marks));\n          }\n        }\n      });\n      return texts;\n    }\n  }, {\n    key: \"splitDiffParagraph\",\n    value: function splitDiffParagraph(diffParagraph) {\n      // clone the replace paragraph to wrap the deleted and added nodes\n      var newParagraph = lodash.cloneDeep(diffParagraph),\n          oldParagraph = lodash.cloneDeep(diffParagraph),\n          // wrap new paragraph nodes and old paragraph nodes\n      newParagraphNodes = [],\n          oldParagraphNodes = []; // traverse paragraph nodes\n\n      diffParagraph.children.forEach(function (node, index1, nodes) {\n        if (node.type === 'link' || node.type === 'image') {\n          // if the node is inline node, like link\n          // if the inline is added\n          if (node.data.diff_state === 'diff-added') {\n            // push the inline node to new paragraph nodes\n            newParagraphNodes.push(node);\n          } else if (node.data.diff_state === 'diff-removed') {\n            // if the inline is added push the inline node to new paragraph nodes\n            oldParagraphNodes.push(node);\n          } else {\n            // if the inline node is common new paragraph node and old paragraph all push the inline node\n            newParagraphNodes.push(node);\n            oldParagraphNodes.push(node);\n          }\n        } else {\n          if (node.ADD) {\n            newParagraphNodes.push(node);\n          } else if (node.DELETE) {\n            oldParagraphNodes.push(node);\n          } else {\n            // push common text\n            newParagraphNodes.push(node);\n            oldParagraphNodes.push(node);\n          }\n        }\n      }); // set new paragraph and old paragraph nodes\n\n      newParagraph.children = newParagraphNodes;\n      oldParagraph.data.paragraph_state = 'old-paragraph';\n      newParagraph.data.paragraph_state = 'new-paragraph';\n      oldParagraph.children = oldParagraphNodes;\n      return [oldParagraph, newParagraph];\n    }\n  }, {\n    key: \"splitTopDiffNodes\",\n    value: function splitTopDiffNodes(slateDiffNodes) {\n      var _this2 = this;\n\n      // newSlateDiffNodes used to wrap the new slate nodes\n      var newSlateDiffNodes = []; // traverse slate top Nodes and find the paragraph handle it\n\n      slateDiffNodes.forEach(function (node) {\n        if (node.data.diff_state === 'diff-replaced' && node.type === 'paragraph') {\n          var splicedParagraph = _this2.splitDiffParagraph(node); // push the old and new paragraph node to newSlateDiffNodes\n\n\n          newSlateDiffNodes.push(splicedParagraph[0], splicedParagraph[1]);\n        } else if (node.data.diff_state === 'diff-replaced' && node.type === 'table') {\n          _this2.splitTableDiffParagraph(node);\n\n          newSlateDiffNodes.push(node);\n        } else {\n          newSlateDiffNodes.push(node);\n        }\n      });\n      return newSlateDiffNodes;\n    }\n  }, {\n    key: \"splitTableDiffParagraph\",\n    value: function splitTableDiffParagraph(node) {\n      var _this3 = this;\n\n      node.children.forEach(function (tableRow, rowIndex, tablerows) {\n        if (tableRow.data.diff_state === 'diff-replaced') {\n          tableRow.children.forEach(function (tableCell) {\n            if (tableCell.data.diff_state === 'diff-replaced') {\n              if (tableCell.children[0].data.diff_state === 'diff-replaced') {\n                var splicedParagraphNodes = _this3.splitDiffParagraph(tableCell.children[0]);\n\n                tableCell.children = splicedParagraphNodes;\n              }\n            }\n          });\n        }\n      });\n      return node;\n    }\n  }]);\n\n  return SlateDiff;\n}();\n\nvar ArrayDiffElement = /*#__PURE__*/function () {\n  function ArrayDiffElement(item, newIndex, oldIndex) {\n    _classCallCheck(this, ArrayDiffElement);\n\n    this.item = item;\n    this.newIndex = newIndex;\n    this.oldIndex = oldIndex;\n  }\n\n  _createClass(ArrayDiffElement, [{\n    key: \"added\",\n    value: function added() {\n      return this.oldIndex === undefined;\n    }\n  }, {\n    key: \"removed\",\n    value: function removed() {\n      return this.newIndex === undefined;\n    }\n  }, {\n    key: \"common\",\n    value: function common() {\n      return this.oldIndex !== undefined && this.newIndex !== undefined;\n    }\n  }]);\n\n  return ArrayDiffElement;\n}();\n\nvar Diff = /*#__PURE__*/function () {\n  function Diff(opts) {\n    _classCallCheck(this, Diff);\n\n    this.equalFunc = opts.equalFunc ? opts.equalFunc : defaultEqualityFunction;\n    if (opts.shouldDetectChange != undefined) this.shouldDetectChange = opts.shouldDetectChange;else this.shouldDetectChange = false;\n    this.similarityFunc = opts.similarityFunc;\n  }\n  /**\n   Appends an array item to the subsequence of items that were added in the new array.\n   @method  added\n   @param   item   The array item that was added.\n   **/\n\n\n  _createClass(Diff, [{\n    key: \"addAdded\",\n    value: function addAdded(item, newIndex) {\n      var element = new ArrayDiffElement(item, newIndex, undefined);\n      element.changeType = 'added';\n      this.added.push(element);\n      this.diff.push(element);\n    }\n    /**\n     Appends an array item to the subsequence of items that were removed from the old array.\n     @method  removed\n     @param   item     The array item that was added.\n     **/\n\n  }, {\n    key: \"addRemoved\",\n    value: function addRemoved(item, oldIndex) {\n      var element = new ArrayDiffElement(item, undefined, oldIndex);\n      this.removed.push(element);\n      element.changeType = 'removed';\n      this.diff.push(element);\n    }\n  }, {\n    key: \"addReplaced\",\n    value: function addReplaced(oldItem, newItem, oldIndex, newIndex) {\n      var element = new ArrayDiffElement(oldItem, newIndex, oldIndex);\n      element.newItem = newItem;\n      element.oldItem = oldItem;\n      element.changeType = 'replaced';\n      this.replaced.push(element);\n      this.diff.push(element);\n    }\n    /**\n     Appends an array item to the longest common subsequence between the new and old arrays.\n     @method  common\n     @param   item    The array item that was added.\n     **/\n\n  }, {\n    key: \"addCommon\",\n    value: function addCommon(oldItem, newItem, oldIndex, newIndex) {\n      var element = new ArrayDiffElement(oldItem, newIndex, oldIndex);\n      element.newItem = newItem;\n      element.changeType = 'common';\n      element.oldItem = oldItem;\n      this.common.push(element);\n      this.diff.push(element);\n    }\n  }, {\n    key: \"StringDiff\",\n    value: function StringDiff(newString, oldString) {\n      var newLength = newString.length;\n      var oldLength = oldString.length;\n      var n = 0;\n      var o = 0;\n      var table = [];\n      table[newLength] = [];\n\n      for (o = oldLength; o >= 0; table[newLength][o--] = 0) {\n        ;\n      }\n\n      for (n = newLength - 1; n >= 0; n--) {\n        table[n] = [];\n        table[n][oldLength] = 0;\n\n        for (o = oldLength - 1; o >= 0; o--) {\n          if (this.equalFunc(newString[n], oldString[o])) {\n            table[n][o] = table[n + 1][o + 1] + 1;\n          } else {\n            table[n][o] = Math.max(table[n + 1][o], table[n][o + 1]);\n          }\n        }\n      } // Fill in the subsequence arrays\n\n\n      this.common = [];\n      this.added = [];\n      this.removed = [];\n      this.replaced = [];\n      this.diff = [];\n      n = o = 0;\n\n      while (n < newLength && o < oldLength) {\n        var diffState = this.equalFunc(newString[n], oldString[o]);\n\n        if (diffState) {\n          var newItem = newString[n];\n          var oldItem = oldString[o];\n          this.addCommon(oldItem, newItem, o, n);\n          n++;\n          o++;\n        } else if (table[n + 1][o] >= table[n][o + 1]) {\n          this.addAdded(newString[n], n);\n          n++;\n        } else {\n          this.addRemoved(oldString[o], o);\n          o++;\n        }\n      }\n\n      for (; n < newLength; n++) {\n        this.addAdded(newString[n], n);\n      }\n\n      for (; o < oldLength; o++) {\n        this.addRemoved(oldString[o], o);\n      }\n    }\n  }, {\n    key: \"ArrayDiff\",\n    value: function ArrayDiff(newArray, oldArray, callback) {\n      //newArray = newArray.toArray();\n      //oldArray = oldArray.toArray();\n      var newLength = newArray.length;\n      var oldLength = oldArray.length;\n      var n = 0;\n      var o = 0;\n      var table = []; // Build out the table\n\n      table[newLength] = [];\n\n      for (o = oldLength; o >= 0; table[newLength][o--] = 0) {\n        ;\n      }\n\n      for (n = newLength - 1; n >= 0; n--) {\n        table[n] = [];\n        table[n][oldLength] = 0;\n\n        for (o = oldLength - 1; o >= 0; o--) {\n          if (this.equalFunc(newArray[n], oldArray[o])) {\n            table[n][o] = table[n + 1][o + 1] + 1;\n          } else {\n            table[n][o] = Math.max(table[n + 1][o], table[n][o + 1]);\n          }\n        }\n      } // Fill in the subsequence arrays\n\n\n      this.common = [];\n      this.added = [];\n      this.removed = [];\n      this.replaced = [];\n      this.diff = [];\n      n = o = 0;\n\n      while (n < newLength && o < oldLength) {\n        var diffState = this.equalFunc(newArray[n], oldArray[o]);\n\n        if (diffState) {\n          var newItem = newArray[n];\n          var oldItem = oldArray[o];\n\n          if (diffState === 'changed') {\n            this.addReplaced(oldItem, newItem, o, n);\n          } else {\n            //if (newItem.isVoid) {\n            this.addCommon(oldItem, newItem, o, n);\n          }\n\n          if (callback) {\n            callback('C', o, n);\n          }\n\n          n++;\n          o++;\n        } else if (table[n + 1][o] >= table[n][o + 1]) {\n          this.addAdded(newArray[n], n);\n\n          if (callback) {\n            callback('A', 0, n);\n          }\n\n          n++;\n        } else {\n          this.addRemoved(oldArray[o], o);\n\n          if (callback) {\n            callback('D', o, 0);\n          }\n\n          o++;\n        }\n      }\n\n      for (; n < newLength; n++) {\n        this.addAdded(newArray[n], n);\n\n        if (callback) {\n          callback('A', 0, n);\n        }\n      }\n\n      for (; o < oldLength; o++) {\n        this.addRemoved(oldArray[o], o);\n\n        if (callback) {\n          callback('D', o, 0);\n        }\n      }\n    }\n  }]);\n\n  return Diff;\n}();\n\nvar Diff3 = /*#__PURE__*/function () {\n  function Diff3(opts) {\n    _classCallCheck(this, Diff3);\n\n    opts = opts || {};\n    this.equalFunc = opts.equalFunc ? opts.equalFunc : defaultEqualityFunction;\n    if (opts.shouldDetectChange != undefined) this.shouldDetectChange = opts.shouldDetectChange;else this.shouldDetectChange = false;\n    this.similarityFunc = opts.similarityFunc;\n    this.chunks = [];\n    this.common = [];\n    this.added = [];\n    this.removed = [];\n    this.mergedArray = [];\n  }\n\n  _createClass(Diff3, [{\n    key: \"diff3\",\n    value: function diff3(oArray, aArray, bArray) {\n      this.oArray = oArray;\n      this.aArray = aArray;\n      this.bArray = bArray;\n      var oaDiff = new Diff({\n        equalFunc: this.equalFunc,\n        shouldDetectChange: this.shouldDetectChange,\n        similarityFunc: this.similarityFunc\n      });\n      oaDiff.ArrayDiff(aArray, oArray);\n      var obDiff = new Diff({\n        equalFunc: this.equalFunc,\n        shouldDetectChange: this.shouldDetectChange,\n        similarityFunc: this.similarityFunc\n      });\n      obDiff.ArrayDiff(bArray, oArray);\n      var M_oa = [];\n\n      for (var i = 0; i < oArray.length; i++) {\n        M_oa[i] = [];\n\n        for (var j = 0; j < aArray.length; j++) {\n          M_oa[i][j] = 0;\n        }\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = oaDiff.common[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var item = _step.value;\n          M_oa[item.oldIndex][item.newIndex] = 1;\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.M_oa = M_oa;\n      var M_ob = [];\n\n      for (var _i = 0; _i < oArray.length; _i++) {\n        M_ob[_i] = [];\n\n        for (var _j = 0; _j < bArray.length; _j++) {\n          M_ob[_i][_j] = 0;\n        }\n      }\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = obDiff.common[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var _item = _step2.value;\n          M_ob[_item.oldIndex][_item.newIndex] = 1;\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      this.M_ob = M_ob;\n      /*\n      console.log(\"M_oa\");\n      console.log(M_oa);\n      console.log(\"M_ob\");\n      console.log(M_ob);\n      */\n\n      var lo = 0;\n      var la = 0;\n      var lb = 0;\n      var finalStable = undefined; // while (true) {\n      //   // find i that the cursor at the three array not match\n      //   let i = 0;\n      //   var iFound = false;\n      //   while (true) {\n      //     if (M_oa[lo+i][la+i] == 0 || M_ob[lo+i][lb+i] == 0) {\n      //       iFound = true;\n      //       break;\n      //     }\n      //     i++;\n      //     if (lo+i == oArray.length || la+i == aArray.length ||\n      //       lb+i == bArray.length)\n      //       break;\n      //   }\n      //   if (iFound == false) {\n      //     // go out and output a final stable chunk\n      //     //console.log(\"iFound == false\");\n      //     finalStable = true;\n      //     break;\n      //   }\n      //\n      //   if (i > 0) {\n      //     //console.log(\"stable chunk \");\n      //     var chunk = {};\n      //     chunk.startO = lo;\n      //     chunk.startA = la;\n      //     chunk.startB = lb;\n      //     chunk.endO = lo+i-1;\n      //     chunk.endA = la+i-1;\n      //     chunk.endB = lb+i-1;\n      //     chunk.isStable = true;\n      //     this.chunks.push(chunk);\n      //     //printChunk(oArray, aArray, bArray, chunk);\n      //     lo = lo + i;\n      //     la = la + i;\n      //     lb = lb + i;\n      //     continue;\n      //   }\n      //\n      //   //console.log(\"unstable chunk \");\n      //   let o;\n      //   let a;\n      //   let b;\n      //   let found = false;\n      //   for (o = lo; o < oArray.length; o++) {\n      //     for (a = la; a < aArray.length; a++) {\n      //       if (M_oa[o][a] != true) {\n      //         continue;\n      //       }\n      //\n      //       for (b = lb; b < bArray.length; b++) {\n      //         if (M_ob[o][b] == true) {\n      //           found = true;\n      //           break;\n      //         }\n      //       }\n      //       if (found == true) {\n      //         break;\n      //       }\n      //     }\n      //     if (found == true) {\n      //       break;\n      //     }\n      //   }\n      //\n      //   if (found == true) {\n      //     let chunk = {}\n      //     chunk.startO = lo;\n      //     chunk.startA = la;\n      //     chunk.startB = lb;\n      //     chunk.endO = o-1;\n      //     chunk.endA = a-1;\n      //     chunk.endB = b-1;\n      //     chunk.isStable = false;\n      //     this.chunks.push(chunk);\n      //     //printChunk(oArray, aArray, bArray, chunk);\n      //     lo = o;\n      //     la = a;\n      //     lb = b;\n      //     continue;\n      //   } else {\n      //     // output a final unstable chunk\n      //     finalStable = false;\n      //     break;\n      //   }\n      // }\n      // output the final chunk\n\n      if (lo < oArray.length || la < aArray.length || lb < bArray.length) {\n        //console.log(\"final chunk \");\n        var chunk = {};\n        chunk.startO = lo;\n        chunk.endO = oArray.length - 1;\n        chunk.startA = la;\n        chunk.endA = aArray.length - 1;\n        chunk.startB = lb;\n        chunk.endB = bArray.length - 1;\n        chunk.isStable = finalStable;\n        this.chunks.push(chunk); //printChunk(oArray, aArray, bArray, chunk);\n      }\n    }\n  }, {\n    key: \"calPatchChunk\",\n    value: function calPatchChunk(chunk) {\n      for (var i = chunk.startA; i <= chunk.endA; ++i) {\n        // find if item also in O\n        var found = false;\n\n        for (var j = chunk.startO; j <= chunk.endO; ++j) {\n          if (this.M_oa[j][i] === 1) {\n            // The item in both A and O\n            // The item is removed by B\n            found = true;\n            break;\n          }\n        }\n\n        if (found === false) {\n          // the item not found in O\n          // the item is added or modifed in A\n          // keep\n          this.mergedArray.push(this.aArray[i]);\n        }\n      }\n\n      for (var _i2 = chunk.startB; _i2 <= chunk.endB; ++_i2) {\n        // find if item also in O\n        var found = false;\n\n        for (var _j2 = chunk.startO; _j2 <= chunk.endO; ++_j2) {\n          if (this.M_ob[_j2][_i2] === 1) {\n            // The item in both B and O\n            // the item is removed by A (or moved by A)\n            // do nothing\n            found = true;\n            break;\n          }\n        }\n\n        if (found) continue; // the matched item not found in O\n        // the item is added or modifed in B\n\n        this.mergedArray.push(this.bArray[_i2]);\n      }\n    }\n  }, {\n    key: \"calPatch\",\n    value: function calPatch() {\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.chunks[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var chunk = _step3.value;\n\n          if (chunk.isStable) {\n            for (var i = 0; i + chunk.startA <= chunk.endA; ++i) {\n              var c = {};\n              c.indexA = i + chunk.startA;\n              c.indexO = i + chunk.startO;\n              c.indexB = i + chunk.startB; //this.common.push(c);\n\n              this.mergedArray.push(this.aArray[c.indexA]);\n            }\n          }\n\n          if (!chunk.isStable) {\n            this.calPatchChunk(chunk);\n          }\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n    }\n  }]);\n\n  return Diff3;\n}();\n\nexport { Diff, Diff3, equalityFunctionForSlate, SlateDiff };","import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport React from 'react';\nimport { SlateDiff } from '../utils/diff';\nimport { renderNode, renderLeaf } from '../utils/render-slate';\nimport SlateViewer from '../viewer/slate-viewer';\nimport LoadScript from '../editor/load-script';\nimport '../css/diff-viewer.css';\n\nvar DiffViewer = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(DiffViewer, _React$PureComponent);\n\n  function DiffViewer(_props) {\n    var _this;\n\n    _classCallCheck(this, DiffViewer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DiffViewer).call(this, _props));\n\n    _this.renderDiffNode = function (props) {\n      var element = props.element;\n      var data = element.data ? element.data : {};\n      var diffState = data['diff_state'];\n      var nodeDepth = data['node_depth'];\n\n      if (diffState === 'diff-added') {\n        if (nodeDepth > 1) {\n          if (element.type === 'blockquote' || element.type === 'code_block') {\n            return React.createElement(\"div\", {\n              className: 'diff-added-container'\n            }, renderNode(props));\n          }\n\n          return renderNode(props);\n        } else {\n          return React.createElement(\"div\", {\n            className: 'diff-added'\n          }, renderNode(props));\n        }\n      } else if (diffState === 'diff-removed') {\n        if (nodeDepth > 1) {\n          if (element.type === 'blockquote' || element.type === 'code_block') {\n            return React.createElement(\"div\", {\n              className: 'diff-removed-container'\n            }, renderNode(props));\n          }\n\n          return renderNode(props);\n        } else {\n          return React.createElement(\"div\", {\n            className: 'diff-removed'\n          }, renderNode(props));\n        }\n      } else if (diffState === 'diff-replaced') {\n        if (nodeDepth > 1) {\n          return renderNode(props);\n        } else {\n          return React.createElement(\"div\", {\n            className: 'diff-replaced'\n          }, renderNode(props));\n        }\n      } else {\n        return renderNode(props);\n      }\n    };\n\n    _this.value = [];\n    _this.slateDiff = new SlateDiff();\n    return _this;\n  }\n\n  _createClass(DiffViewer, [{\n    key: \"render\",\n    value: function render() {\n      var newMarkdownContent = this.props.newMarkdownContent;\n      var oldMarkdownContent = this.props.oldMarkdownContent;\n      this.value = this.slateDiff.getDiffDocument(newMarkdownContent, oldMarkdownContent);\n      return React.createElement(LoadScript, {\n        scriptSource: this.props.scriptSource\n      }, React.createElement(SlateViewer, {\n        style: {\n          width: '100%'\n        },\n        renderDiffElement: this.renderDiffNode,\n        renderDiffLeaf: renderLeaf,\n        value: this.value\n      }));\n    }\n  }]);\n\n  return DiffViewer;\n}(React.PureComponent);\n\nexport default DiffViewer;"],"sourceRoot":""}