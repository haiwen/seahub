"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[252],{91114:function(t,e,i){var a=i(93433),s=i(15671),n=i(43144),o=i(60136),r=i(29388),d=i(47313),c=i(1168),l=i(21303),h=i(83854),m=i(4514),u=i(61805),f=i(14658),p=i(51282),g=i(93564),x=i(24213),v=i(70816),y=i.n(v),R=i(52522),j=i(13380),w=i(25417),_=i(72611),Z=i(57124),L=i(46417);y().locale(window.app.config.lang);var S=function(t){(0,o.Z)(i,t);var e=(0,r.Z)(i);function i(t){var a;return(0,s.Z)(this,i),(a=e.call(this,t)).onMouseEnter=function(){a.setState({active:!0})},a.onMouseLeave=function(){a.setState({active:!1})},a.onItemRestore=function(t){t.preventDefault(),a.props.onItemRestore(a.props.item)},a.state={active:!1},a}return(0,n.Z)(i,[{key:"render",value:function(){var t=this.props.item,e=R.Z.getUrl({type:"download_historic_file",filePath:u.bc,objID:t.rev_file_id}),i="".concat(u.ze,"profile/").concat(encodeURIComponent(t.creator_email),"/"),a="".concat(u.ze,"repo/").concat(u.y8,"/history/files/?obj_id=").concat(t.rev_file_id,"&commit_id=").concat(t.commit_id,"&p=").concat(h.cQ.encodePath(u.bc)),s="".concat(u.ze,"repo/text_diff/").concat(u.y8,"/?commit=").concat(t.commit_id,"&p=").concat(h.cQ.encodePath(u.bc)),n="".concat(u.ze,"repo/").concat(u.y8,"/snapshot/?commit_id=").concat(t.commit_id);return(0,L.jsx)(d.Fragment,{children:(0,L.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,className:this.state.active?"tr-highlight":"",children:[(0,L.jsxs)("td",{children:[(0,L.jsx)("span",{children:y()(t.ctime).format("YYYY-MM-DD HH:mm:ss")}),0===this.props.index&&(0,L.jsx)("span",{className:"ml-1",children:(0,u.ih)("(current version)")})]}),(0,L.jsxs)("td",{children:[(0,L.jsx)("img",{className:"avatar",src:t.creator_avatar_url,alt:""})," ",(0,L.jsx)("a",{href:i,target:"_blank",className:"username",rel:"noreferrer",children:t.creator_name})]}),(0,L.jsx)("td",{children:h.cQ.bytesToSize(t.size)}),(0,L.jsx)("td",{children:this.state.active&&(0,L.jsx)(C,{index:this.props.index,downloadUrl:e,viewUrl:a,diffUrl:s,snapshotURL:n,onItemRestore:this.onItemRestore,canDownload:this.props.canDownload,canCompare:this.props.canCompare})})]})})}}]),i}(d.Component),C=function(t){(0,o.Z)(i,t);var e=(0,r.Z)(i);function i(t){var a;return(0,s.Z)(this,i),(a=e.call(this,t)).dropdownToggle=function(){a.setState({dropdownOpen:!a.state.dropdownOpen})},a.state={dropdownOpen:!1},a}return(0,n.Z)(i,[{key:"render",value:function(){var t=this.props,e=t.index,i=t.downloadUrl,a=t.viewUrl,s=t.snapshotURL,n=t.onItemRestore,o=t.canDownload;return(0,L.jsxs)(j.Z,{isOpen:this.state.dropdownOpen,toggle:this.dropdownToggle,direction:"down",className:"mx-1 old-history-more-operation",children:[(0,L.jsx)(w.Z,{tag:"i",className:"fa fa-ellipsis-v",title:(0,u.ih)("More operations"),"aria-label":(0,u.ih)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.dropdownOpen}),(0,L.jsxs)(_.Z,{className:"drop-list",right:!0,children:[0!==e&&(0,L.jsx)("a",{href:"#",onClick:n,children:(0,L.jsx)(Z.Z,{children:(0,u.ih)("Restore")})}),o&&(0,L.jsx)("a",{href:i,children:(0,L.jsx)(Z.Z,{children:(0,u.ih)("Download")})}),(0,L.jsx)("a",{href:a,children:(0,L.jsx)(Z.Z,{children:(0,u.ih)("View")})}),0!=e&&(0,L.jsx)(Z.Z,{tag:"a",href:s,target:"_blank",children:(0,u.ih)("View Related Snapshot")})]})]})}}]),i}(d.PureComponent),k=S,O=(i(54890),i(98391),i(53379),function(t){(0,o.Z)(i,t);var e=(0,r.Z)(i);function i(t){var a;return(0,s.Z)(this,i),(a=e.call(this,t)).listNewHistoryRecords=function(t,e){f.Z.listFileHistoryRecords(t,1,e).then((function(t){if(!t.data)throw a.setState({isLoading:!1}),Error("There is an error in server.");a.initNewRecords(t.data)}))},a.listOldHistoryRecords=function(t,e){m.I.listOldFileHistoryRecords(t,e).then((function(t){if(!t.data)throw a.setState({isLoading:!1}),Error("There is an error in server.");a.initOldRecords(t.data)}))},a.onScrollHandler=function(t){var e=t.target.clientHeight,i=t.target.scrollHeight,s=e+t.target.scrollTop+1>=i,n=a.state.hasMore;s&&n&&a.reloadMore()},a.reloadMore=function(){if(!a.state.isReloadingData)if(u.YU){var t=a.state.currentPage+1;a.setState({currentPage:t,isReloadingData:!0}),f.Z.listFileHistoryRecords(u.bc,t,u.LZ).then((function(t){a.updateNewRecords(t.data)}))}else{var e=a.state.nextCommit,i=a.state.filePath,s=a.state.oldFilePath;a.setState({isReloadingData:!0}),s?m.I.listOldFileHistoryRecords(u.y8,s,e).then((function(t){a.updateOldRecords(t.data,s)})):m.I.listOldFileHistoryRecords(u.y8,i,e).then((function(t){a.updateOldRecords(t.data,i)}))}},a.onItemRestore=function(t){var e=t.commit_id,i=t.path;f.Z.revertFile(i,e).then((function(t){t.data.success&&(a.setState({isLoading:!0}),a.refershFileList())}))},a.onSearchedClick=function(t){h.cQ.handleSearchedItemClick(t)},a.goBack=function(t){t.preventDefault(),window.history.back()},a.state={historyList:[],currentPage:1,hasMore:!1,nextCommit:void 0,filePath:"",oldFilePath:"",isLoading:!0,isReloadingData:!1},a}return(0,n.Z)(i,[{key:"componentDidMount",value:function(){u.YU?this.listNewHistoryRecords(u.bc,u.LZ):this.listOldHistoryRecords(u.y8,u.bc)}},{key:"initNewRecords",value:function(t){var e=this;if(t.total_count<5)if(t.data.length){var i=t.data[t.data.length-1].commit_id,a=t.data[t.data.length-1].path,s=t.data[t.data.length-1].old_path;a=s||a,m.I.listOldFileHistoryRecords(u.y8,a,i).then((function(i){if(!i.data)throw e.setState({isLoading:!1}),Error("There is an error in server.");e.setState({historyList:t.data.concat(i.data.data.slice(1,i.data.data.length)),isLoading:!1})}))}else m.I.listOldFileHistoryRecords(u.y8,u.bc).then((function(t){if(!t.data)throw e.setState({isLoading:!1}),Error("There is an error in server.");e.setState({historyList:t.data.data,isLoading:!1})}));else this.setState({historyList:t.data,currentPage:t.page,hasMore:t.total_count>u.LZ*this.state.currentPage,isLoading:!1})}},{key:"initOldRecords",value:function(t){var e=this;t.data.length?this.setState({historyList:t.data,nextCommit:t.next_start_commit,filePath:t.data[t.data.length-1].path,oldFilePath:t.data[t.data.length-1].rev_renamed_old_path,isLoading:!1}):(this.setState({nextCommit:t.next_start_commit}),this.state.nextCommit?m.I.listOldFileHistoryRecords(u.y8,u.bc,this.state.nextCommit).then((function(t){e.initOldRecords(t.data)})):this.setState({isLoading:!1}))}},{key:"updateNewRecords",value:function(t){this.setState({historyList:[].concat((0,a.Z)(this.state.historyList),(0,a.Z)(t.data)),currentPage:t.page,hasMore:t.total_count>u.LZ*this.state.currentPage,isReloadingData:!1})}},{key:"updateOldRecords",value:function(t,e){var i=this;t.data.length?this.setState({historyList:[].concat((0,a.Z)(this.state.historyList),(0,a.Z)(t.data)),nextCommit:t.next_start_commit,filePath:t.data[t.data.length-1].path,oldFilePath:t.data[t.data.length-1].rev_renamed_old_path,isReloadingData:!1}):(this.setState({nextCommit:t.next_start_commit}),this.state.nextCommit&&m.I.listOldFileHistoryRecords(u.y8,e,this.state.nextCommit).then((function(t){i.updateOldRecords(t.data,e)})))}},{key:"refershFileList",value:function(){var t=this;u.YU?f.Z.listFileHistoryRecords(u.bc,1,u.LZ).then((function(e){t.initNewRecords(e.data)})):m.I.listOldFileHistoryRecords(u.y8,u.bc).then((function(e){t.initOldRecords(e.data)}))}},{key:"render",value:function(){var t=this;return(0,L.jsxs)(d.Fragment,{children:[(0,L.jsxs)("div",{id:"header",className:"old-history-header",children:[(0,L.jsx)(g.Z,{showCloseSidePanelIcon:!1}),(0,L.jsx)(x.Z,{onSearchedClick:this.onSearchedClick})]}),(0,L.jsx)("div",{id:"main",onScroll:this.onScrollHandler,children:(0,L.jsxs)("div",{className:"old-history-main",children:[(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("a",{href:"#",className:"go-back",title:"Back",onClick:this.goBack,children:(0,L.jsx)("span",{className:"fas fa-chevron-left"})}),(0,L.jsxs)("h2",{children:[(0,L.jsx)("span",{className:"file-name",children:u.Yp})," ",(0,u.ih)("History Versions")]})]}),(0,L.jsxs)(d.Fragment,{children:[(0,L.jsxs)("table",{className:"commit-list",children:[(0,L.jsx)("thead",{children:(0,L.jsxs)("tr",{children:[(0,L.jsx)("th",{width:"40%",children:(0,u.ih)("Time")}),(0,L.jsx)("th",{width:"30%",children:(0,u.ih)("Modifier")}),(0,L.jsx)("th",{width:"25%",children:(0,u.ih)("Size")}),(0,L.jsx)("th",{width:"5%"})]})}),!this.state.isLoading&&(0,L.jsx)("tbody",{children:this.state.historyList.map((function(e,i){return(0,L.jsx)(k,{item:e,index:i,canDownload:u.Rn,canCompare:u.My,onItemRestore:t.onItemRestore},i)}))})]}),(this.state.isReloadingData||this.state.isLoading)&&(0,L.jsx)(p.Z,{}),this.state.nextCommit&&!this.state.isLoading&&!this.state.isReloadingData&&(0,L.jsx)(l.Z,{className:"get-more-btn",onClick:this.reloadMore,children:(0,u.ih)("More")})]})]})})]})}}]),i}(d.Component));c.render((0,L.jsx)(O,{}),document.getElementById("wrapper"))}},function(t){t.O(0,[351],(function(){return e=91114,t(t.s=e);var e}));t.O()}]);