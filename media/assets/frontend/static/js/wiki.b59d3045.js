"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[747],{60925:function(e,t,n){n.d(t,{AE:function(){return c},SC:function(){return l},bg:function(){return a},cI:function(){return s}});var i=n(31725),o=n.n(i),r=n(77338),a="REACT_CONTEXTMENU_SHOW",s="REACT_CONTEXTMENU_HIDE";function d(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;"function"===typeof window.CustomEvent?n=new window.CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!0,t),i&&(i.dispatchEvent(n),o()(r.h,t))}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;d(a,o()({},e,{type:a}),t)}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;d(s,o()({},e,{type:s}),t)}},99832:function(e,t,n){var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(72791),d=n(17650),c=n(60925),l=n(77338),h=n(95996),p=n(80184),u=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).registerHandlers=function(){document.addEventListener("mousedown",o.handleOutsideClick),document.addEventListener("touchstart",o.handleOutsideClick),document.addEventListener("scroll",o.handleHide),document.addEventListener("contextmenu",o.handleHide),document.addEventListener("keydown",o.handleKeyNavigation),window.addEventListener("resize",o.handleHide)},o.unregisterHandlers=function(){document.removeEventListener("mousedown",o.handleOutsideClick),document.removeEventListener("touchstart",o.handleOutsideClick),document.removeEventListener("scroll",o.handleHide),document.removeEventListener("contextmenu",o.handleHide),document.removeEventListener("keydown",o.handleKeyNavigation),window.removeEventListener("resize",o.handleHide)},o.handleShow=function(e){if(e.detail.id===o.props.id){var t=e.detail.position,n=t.x,i=t.y,r=e.detail,a=r.currentObject,s=r.menuList;o.setState({isVisible:!0,x:n,y:i,currentObject:a,menuList:s}),o.registerHandlers(),(0,l._N)(o.props.onShowMenu,e)}},o.handleHide=function(e){!o.state.isVisible||e.detail&&e.detail.id&&e.detail.id!==o.props.id||(o.unregisterHandlers(),o.setState({isVisible:!1}),(0,l._N)(o.props.onHideMenu,e))},o.handleOutsideClick=function(e){o.menu.contains(e.target)||(0,c.SC)()},o.handleMouseLeave=function(e){e.preventDefault(),o.props.hideOnLeave&&(0,c.SC)()},o.handleContextMenu=function(e){o.handleHide(e)},o.handleKeyNavigation=function(e){!1!==o.state.isVisible&&(e.preventDefault(),o.hideMenu(e))},o.hideMenu=function(e){27!==e.keyCode&&13!==e.keyCode||(0,c.SC)()},o.getMenuPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={top:t,left:e};if(!o.menu)return n;var i=window,r=i.innerWidth,a=i.innerHeight,s=o.menu.getBoundingClientRect();return t+s.height>a&&(n.top-=s.height),e+s.width>r&&(n.left-=s.width),n.top<0&&(n.top=s.height<a?(a-s.height)/2:0),n.left<0&&(n.left=s.width<r?(r-s.width)/2:0),n},o.getRTLMenuPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={top:t,left:e};if(!o.menu)return n;var i=window,r=i.innerWidth,a=i.innerHeight,s=o.menu.getBoundingClientRect();return n.left=e-s.width,t+s.height>a&&(n.top-=s.height),n.left<0&&(n.left+=s.width),n.top<0&&(n.top=s.height<a?(a-s.height)/2:0),n.left+s.width>r&&(n.left=s.width<r?(r-s.width)/2:0),n},o.onMenuItemClick=function(e){e.stopPropagation();var t=h.c.getEventData(e,"operation"),n=o.state.currentObject;o.props.onMenuItemClick(t,n,e)},o.onContextMenu=function(e){e.stopPropagation()},o.state={x:0,y:0,isVisible:!1,currentObject:null,menuList:[]},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.listenId=d.Z.register(this.handleShow,this.handleHide)}},{key:"componentDidUpdate",value:function(){var e=this;if(this.state.isVisible){var t=window.requestAnimationFrame||setTimeout;t((function(){var n=e.state,i=n.x,o=n.y,r=e.props.rtl?e.getRTLMenuPosition(i,o):e.getMenuPosition(i,o),a=r.top,s=r.left;t((function(){e.menu&&(e.menu.style.top="".concat(a,"px"),e.menu.style.left="".concat(s,"px"),e.menu.style.opacity=1,e.menu.style.pointerEvents="auto")}))}))}else{if(!this.menu)return;this.menu.style.opacity=0,this.menu.style.pointerEvents="none"}}},{key:"componentWillUnmount",value:function(){this.listenId&&d.Z.unregister(this.listenId),this.unregisterHandlers()}},{key:"render",value:function(){var e=this;return(0,p.jsx)("div",{role:"menu",className:"seafile-contextmenu dropdown-menu",style:{position:"fixed",opacity:0,pointerEvents:"none",display:"block"},ref:function(t){e.menu=t},children:this.state.menuList.map((function(t,n){return"Divider"===t?(0,p.jsx)("div",{className:"seafile-divider dropdown-divider"},n):(0,p.jsx)("button",{className:"seafile-contextmenu-item dropdown-item","data-operation":t.key,onClick:e.onMenuItemClick,onContextMenu:e.onContextMenu,children:t.value},n)}))})}}]),n}(s.Component);t.Z=u},17650:function(e,t,n){var i=n(43144),o=n(15671),r=n(60925),a=n(77338),s=new((0,i.Z)((function e(){var t=this;(0,o.Z)(this,e),this.handleShowEvent=function(e){for(var n in t.callbacks)(0,a.Q$)(t.callbacks,n)&&t.callbacks[n].show(e)},this.handleHideEvent=function(e){for(var n in t.callbacks)(0,a.Q$)(t.callbacks,n)&&t.callbacks[n].hide(e)},this.register=function(e,n){var i=(0,a.EL)();return t.callbacks[i]={show:e,hide:n},i},this.unregister=function(e){e&&t.callbacks[e]&&delete t.callbacks[e]},this.callbacks={},a.Nq&&(window.addEventListener(r.bg,this.handleShowEvent),window.addEventListener(r.cI,this.handleHideEvent))})));t.Z=s},77338:function(e,t,n){function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return"function"===typeof e&&e.apply(void 0,n)}function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function r(){return Math.random().toString(36).substring(7)}n.d(t,{EL:function(){return r},Nq:function(){return s},Q$:function(){return o},_N:function(){return i},h:function(){return a}});var a={},s=Boolean("undefined"!==typeof window&&window.document&&window.document.createElement)},2169:function(e,t,n){var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(72791),d=n(17650),c=n(38358),l=n(20387),h=n(59508),p=n(52919),u=n(61599),f=n(53585),m=n(95996),v=n(80184),g=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).onShowMenu=function(){},o.onHideMenu=function(){o.state.isItemMenuShow&&(o.setState({isItemMenuShow:!1}),"function"===typeof o.props.unfreezeItem&&o.props.unfreezeItem())},o.onDropdownToggleKeyDown=function(e){"Enter"!=e.key&&"Space"!=e.key||o.onDropdownToggleClick(e)},o.onDropdownToggleClick=function(e){e.preventDefault(),e.stopPropagation(),o.toggleOperationMenu()},o.toggleOperationMenu=function(){o.setState({isItemMenuShow:!o.state.isItemMenuShow},(function(){o.state.isItemMenuShow&&"function"===typeof o.props.freezeItem?o.props.freezeItem():o.state.isItemMenuShow||"function"!==typeof o.props.unfreezeItem||o.props.unfreezeItem()}))},o.onMenuItemKeyDown=function(e){"Enter"!=e.key&&"Space"!=e.key||o.onMenuItemClick(e)},o.onMenuItemClick=function(e){var t=m.c.getEventData(e,"toggle"),n=o.props.item;o.props.onMenuItemClick(t,e,n)},o.state={menuList:[],isItemMenuShow:!1},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.props.isHandleContextMenuEvent&&(this.listenerId=d.Z.register(this.onShowMenu,this.onHideMenu));var e=this.props.item,t=this.props.getMenuList(e);this.setState({menuList:t})}},{key:"componentWillReceiveProps",value:function(e){var t=e.item;if(t.name!==this.props.item.name){var n=this.props.getMenuList(t);this.setState({menuList:n})}}},{key:"componentWillUnmount",value:function(){this.props.isHandleContextMenuEvent&&this.listenerId&&d.Z.unregister(this.listenerId)}},{key:"render",value:function(){var e=this,t=this.state.menuList,n=this.props,i=n.toggleClass,o=n.tagName;return i="sf-dropdown-toggle "+i,t.length?o&&"button"===o?(0,v.jsxs)(c.Z,{isOpen:this.state.isItemMenuShow,toggle:this.onDropdownToggleClick,children:[(0,v.jsx)(l.Z,{className:i,"data-toggle":"dropdown",title:(0,f.ih)("More Operations"),"aria-label":(0,f.ih)("More Operations"),"aria-expanded":this.state.isItemMenuShow,onKeyDown:this.onDropdownToggleKeyDown}),(0,v.jsx)(h.Z,{children:t.map((function(t,n){return"Divider"===t?(0,v.jsx)(p.Z,{divider:!0},n):(0,v.jsx)(p.Z,{"data-toggle":t.key,onClick:e.onMenuItemClick,onKeyDown:e.onMenuItemKeyDown,children:t.value},n)}))})]}):(0,v.jsxs)(u.Z,{isOpen:this.state.isItemMenuShow,toggle:this.onDropdownToggleClick,className:"vam",children:[(0,v.jsx)(l.Z,{tag:o||"i",role:"button",tabIndex:"0",className:i,title:(0,f.ih)("More Operations"),"data-toggle":"dropdown","aria-expanded":this.state.isItemMenuShow,"aria-label":(0,f.ih)("More Operations"),onKeyDown:this.onDropdownToggleKeyDown}),(0,v.jsx)(h.Z,{children:t.map((function(t,n){return"Divider"===t?(0,v.jsx)(p.Z,{divider:!0},n):(0,v.jsx)(p.Z,{"data-toggle":t.key,onClick:e.onMenuItemClick,onKeyDown:e.onMenuItemKeyDown,children:t.value},n)}))})]}):""}}]),n}(s.Component);g.defaultProps={isHandleContextMenuEvent:!0,toggleClass:"sf2-icon-caret-down"},t.Z=g},95046:function(e,t,n){n.d(t,{Z:function(){return v}});var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(72791),d=n(93191),c=n(53585),l=n(2169),h=n(95996),p=n(80184),u=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;(0,i.Z)(this,n),(o=t.call(this,e)).onMouseEnter=function(){o.props.isItemFreezed||o.setState({isShowOperationMenu:!0,isHighlight:!0})},o.onMouseOver=function(){o.props.isItemFreezed||o.setState({isShowOperationMenu:!0,isHighlight:!0})},o.onMouseLeave=function(){o.props.isItemFreezed||o.setState({isShowOperationMenu:!1,isHighlight:!1})},o.onNodeClick=function(){var e=o.props.node.object;if(e.isDir())o.props.onNodeClick(o.props.node);else{var t=h.c.getUserPermission(e.permission),n=t.isCustomPermission,i=t.customPermission;if(n){var r=i.permission,a=r.preview,s=r.modify;if(!a&&!s)return}o.props.onNodeClick(o.props.node)}},o.onLoadToggle=function(e){e.stopPropagation();var t=o.props.node;t.isExpanded?o.props.onNodeCollapse(t):o.props.onNodeExpanded(t)},o.onNodeDragStart=function(e){if(h.c.isIEBrower()||!o.canDrag)return!1;o.props.onNodeDragStart(e,o.props.node)},o.onNodeDragEnter=function(e){if(h.c.isIEBrower()||!o.canDrag)return!1;"dir"===o.props.node.object.type&&o.setState({isNodeDropShow:!0}),o.props.onNodeDragEnter(e,o.props.node)},o.onNodeDragMove=function(e){if(h.c.isIEBrower()||!o.canDrag)return!1;o.props.onNodeDragMove(e)},o.onNodeDragLeave=function(e){if(h.c.isIEBrower()||!o.canDrag)return!1;o.setState({isNodeDropShow:!1}),o.props.onNodeDragLeave(e,o.props.node)},o.onNodeDrop=function(e){if(h.c.isIEBrower()||!o.canDrag)return!1;e.stopPropagation(),o.setState({isNodeDropShow:!1}),o.props.onNodeDrop(e,o.props.node)},o.unfreezeItem=function(){o.setState({isShowOperationMenu:!1}),o.props.unfreezeItem()},o.onMenuItemClick=function(e,t,n){o.props.onMenuItemClick(e,n)},o.onItemMouseDown=function(e){e.stopPropagation(),e.button},o.onItemContextMenu=function(e){o.handleContextClick(e)},o.handleContextClick=function(e){o.props.handleContextClick(e,o.props.node),o.setState({isShowOperationMenu:!1})},o.getNodeTypeAndIcon=function(){var e=o.props.node,t="",n="";if("dir"===e.object.type)t=(0,p.jsx)("i",{className:"far fa-folder"}),n="dir";else{var i=e.object.name.lastIndexOf(".");if(-1===i)t=(0,p.jsx)("i",{className:"far fa-file"}),n="file";else{var r=e.object.name.slice(i).toLowerCase();".png"===r||".jpg"===r||".jpeg"===r||".gif"===r||".bmp"===r?(t=(0,p.jsx)("i",{className:"far fa-image"}),n="image"):".md"===r||".markdown"===r?(t=(0,p.jsx)("i",{className:"far fa-file-alt"}),n="file"):(t=(0,p.jsx)("i",{className:"far fa-file"}),n="file")}}return{icon:t,type:n}},o.calculateMenuList=function(e){var t=d.Z.NEW_FOLDER,n=d.Z.NEW_FILE,i=d.Z.COPY,r=d.Z.MOVE,a=d.Z.RENAME,s=d.Z.DELETE,c=d.Z.OPEN_VIA_CLIENT,l=[a,s,i,r,c];"dir"===e.object.type&&(l=[t,n,i,r,a,s]);var p=o.props.userPerm,u=h.c.getUserPermission(p),f=u.isCustomPermission,m=u.customPermission;if(!f)return l;l=[];var v=m.permission,g=v.create,k=v.modify,w=v.delete,x=v.copy;return"dir"===e.object.type&&g&&l.push(t,n),x&&l.push(i),k&&l.push(r,a),w&&l.push(s),"dir"!==e.object.type&&l.push(c),l},o.renderChildren=function(){var e=o.props,t=e.node,i=e.paddingLeft;return t.hasChildren()?(0,p.jsx)("div",{className:"children",style:{paddingLeft:i},children:t.children.map((function(e){return(0,p.jsx)(n,{node:e,paddingLeft:i,userPerm:o.props.userPerm,currentPath:o.props.currentPath,isNodeMenuShow:o.props.isNodeMenuShow,isItemFreezed:o.props.isItemFreezed,onNodeClick:o.props.onNodeClick,onNodeCollapse:o.props.onNodeCollapse,onNodeExpanded:o.props.onNodeExpanded,freezeItem:o.props.freezeItem,onMenuItemClick:o.props.onMenuItemClick,unfreezeItem:o.unfreezeItem,onNodeDragStart:o.props.onNodeDragStart,onNodeDragMove:o.props.onNodeDragMove,onNodeDrop:o.props.onNodeDrop,onNodeDragEnter:o.props.onNodeDragEnter,onNodeDragLeave:o.props.onNodeDragLeave,handleContextClick:o.props.handleContextClick},e.path)}))}):""},o.state={isHighlight:!1,isShowOperationMenu:!1,isNodeDropShow:!1};var r=e.userPerm;o.canDrag="rw"===r;var a=h.c.getUserPermission(r),s=a.isCustomPermission,c=a.customPermission;if(s){var l=c.permission.modify;o.canDrag=l}return o}return(0,o.Z)(n,[{key:"componentWillReceiveProps",value:function(e){e.isItemFreezed||this.setState({isShowOperationMenu:!1,isHighlight:!1})}},{key:"render",value:function(){var e=this.props,t=e.currentPath,n=e.node,i=e.isNodeMenuShow,o=e.userPerm,r=this.getNodeTypeAndIcon(),a=r.type,s=r.icon,d=this.state.isHighlight?"tree-node-inner-hover ":"";n.path===t&&(d="tree-node-hight-light");var u=h.c.getUserPermission(o).isCustomPermission;return(0,p.jsxs)("div",{className:"tree-node",children:[(0,p.jsxs)("div",{type:a,className:"tree-node-inner text-nowrap ".concat(d," ").concat("/"===n.path?"hide":""," ").concat(this.state.isNodeDropShow?"tree-node-drop":""),title:n.object.name,onMouseEnter:this.onMouseEnter,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,onMouseDown:this.onItemMouseDown,onContextMenu:this.onItemContextMenu,onClick:this.onNodeClick,children:[(0,p.jsx)("div",{className:"tree-node-text",draggable:this.canDrag,onDragStart:this.onNodeDragStart,onDragEnter:this.onNodeDragEnter,onDragLeave:this.onNodeDragLeave,onDragOver:this.onNodeDragMove,onDrop:this.onNodeDrop,children:n.object.name}),(0,p.jsxs)("div",{className:"left-icon",children:["dir"===a&&(!n.isLoaded||n.isLoaded&&n.hasChildren())&&(0,p.jsx)("i",{className:"folder-toggle-icon fa ".concat(n.isExpanded?"fa-caret-down":"fa-caret-right"),onMouseDown:function(e){return e.stopPropagation()},onClick:this.onLoadToggle}),(0,p.jsx)("i",{className:"tree-node-icon",children:s})]}),i&&(0,p.jsx)("div",{className:"right-icon",children:("rw"===o||c.rd||u)&&this.state.isShowOperationMenu&&(0,p.jsx)(l.Z,{item:this.props.node,toggleClass:"fas fa-ellipsis-v",getMenuList:this.calculateMenuList,onMenuItemClick:this.onMenuItemClick,freezeItem:this.props.freezeItem,unfreezeItem:this.unfreezeItem})})]}),n.isExpanded&&this.renderChildren()]})}}]),n}(s.Component),f=n(99832),m=n(60925),v=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;(0,i.Z)(this,n),(o=t.call(this,e)).onItemMove=function(e,t,n,i){o.props.onItemMove(e,t,n,i)},o.onNodeDragStart=function(e,t){if(h.c.isIEBrower())return!1;var n={nodeDirent:t.object,nodeParentPath:t.parentNode.path,nodeRootPath:t.path};n=JSON.stringify(n),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("applicaiton/drag-item-info",n)},o.onNodeDragEnter=function(e,t){if(h.c.isIEBrower()||!o.canDrop)return!1;e.persist(),"tree-view tree "===e.target.className&&o.setState({isTreeViewDropTipShow:!0})},o.onNodeDragMove=function(e){if(h.c.isIEBrower()||!o.canDrop)return!1;e.preventDefault(),e.dataTransfer.dropEffect="move"},o.onNodeDragLeave=function(e,t){if(h.c.isIEBrower()||!o.canDrop)return!1;"tree-view tree tree-view-drop"===e.target.className&&o.setState({isTreeViewDropTipShow:!1})},o.onContainerClick=function(e){(0,m.SC)()},o.onNodeClick=function(e){(0,m.SC)(),o.props.onNodeClick(e)},o.onNodeDrop=function(e,t){if(h.c.isIEBrower()||!o.canDrop)return!1;if(!e.dataTransfer.files.length){var n=e.dataTransfer.getData("applicaiton/drag-item-info"),i=n=JSON.parse(n),r=i.nodeDirent,a=i.nodeParentPath,s=i.nodeRootPath,d=t;if(Array.isArray(n))return d?void o.onMoveItems(n,d,o.props.currentRepoInfo,d.path):("/"===n[0].nodeParentPath||o.props.onItemsMove(o.props.currentRepoInfo,"/"),void o.setState({isTreeViewDropTipShow:!1}));if(!d)return"/"===a||o.onItemMove(o.props.currentRepoInfo,r,"/",a),void o.setState({isTreeViewDropTipShow:!1});if("dir"===d.object.type&&a!==d.path&&(a!==d.parentNode.path||d.object.name!==r.name)){if("dir"===d.object.type&&"dir"===r.type)if(d.parentNode.path!==a)if(h.c.getPaths(d.path).includes(s))return;o.onItemMove(o.props.currentRepoInfo,r,d.path,a)}}},o.onMoveItems=function(e,t,n,i){var r=[],a=h.c.getPaths(i);(e.forEach((function(e){var t=e.nodeRootPath;r.push(t)})),"dir"===t.object.type)&&(r.some((function(e){return e===i}))||e[0].nodeParentPath&&e[0].nodeParentPath===t.path||r.some((function(e){return a.includes(e)}))||o.props.onItemsMove(n,i))},o.freezeItem=function(){o.setState({isItemFreezed:!0})},o.unfreezeItem=function(){o.setState({isItemFreezed:!1})},o.onMenuItemClick=function(e,t){o.props.onMenuItemClick(e,t),(0,m.SC)()},o.onMouseDown=function(e){e.stopPropagation(),e.button},o.onContextMenu=function(e){e.preventDefault();var t=o.props.currentRepoInfo;if("admin"!==t.permission&&"rw"!==t.permission)return"";o.handleContextClick(e)},o.handleContextClick=function(e,t){if(e.preventDefault(),e.stopPropagation(),o.props.isNodeMenuShow){var n=e.clientX||e.touches&&e.touches[0].pageX,i=e.clientY||e.touches&&e.touches[0].pageY;o.props.posX&&(n-=o.props.posX),o.props.posY&&(i-=o.props.posY),(0,m.SC)();var r=o.getMenuList(t),a={id:"tree-node-contextmenu",position:{x:n,y:i},target:e.target,currentObject:t,menuList:r};(0,m.AE)(a)}},o.getMenuList=function(e){var t=[],n=d.Z.NEW_FOLDER,i=d.Z.NEW_FILE,r=d.Z.COPY,a=d.Z.MOVE,s=d.Z.RENAME,c=d.Z.DELETE,l=d.Z.OPEN_VIA_CLIENT;if(!e)return[n,i];t="dir"===e.object.type?[n,i,r,a,s,c]:[s,c,r,a,l];var p=o.props.userPerm,u=h.c.getUserPermission(p),f=u.isCustomPermission,m=u.customPermission;if(!f)return t;t=[];var v=m.permission,g=v.create,k=v.modify,w=v.delete,x=v.copy;return e?("dir"===e.object.type&&g&&t.push(n,i),x&&t.push(r),k&&t.push(a,s),w&&t.push(c),"dir"!==e.object.type&&t.push(l),t):(g&&t.push(n,i),t)},o.onShowMenu=function(){o.freezeItem()},o.onHideMenu=function(){o.unfreezeItem()},o.state={isItemFreezed:!1,isTreeViewDropTipShow:!1};var r=e.userPerm;o.canDrop="rw"===r;var a=h.c.getUserPermission(r),s=a.isCustomPermission,c=a.customPermission;if(s){var l=c.permission.modify;o.canDrop=l}return o}return(0,o.Z)(n,[{key:"render",value:function(){return(0,p.jsxs)("div",{className:"tree-view tree ".concat(this.state.isTreeViewDropTipShow&&this.canDrop?"tree-view-drop":""),onDrop:this.onNodeDrop,onDragEnter:this.onNodeDragEnter,onDragLeave:this.onNodeDragLeave,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onClick:this.onContainerClick,children:[(0,p.jsx)(u,{userPerm:this.props.userPerm,node:this.props.treeData.root,currentPath:this.props.currentPath,paddingLeft:20,isNodeMenuShow:this.props.isNodeMenuShow,isItemFreezed:this.state.isItemFreezed,onNodeClick:this.onNodeClick,onMenuItemClick:this.props.onMenuItemClick,onNodeExpanded:this.props.onNodeExpanded,onNodeCollapse:this.props.onNodeCollapse,onNodeDragStart:this.onNodeDragStart,freezeItem:this.freezeItem,unfreezeItem:this.unfreezeItem,onNodeDragMove:this.onNodeDragMove,onNodeDrop:this.onNodeDrop,onNodeDragEnter:this.onNodeDragEnter,onNodeDragLeave:this.onNodeDragLeave,handleContextClick:this.handleContextClick}),(0,p.jsx)(f.Z,{id:"tree-node-contextmenu",onMenuItemClick:this.onMenuItemClick,onHideMenu:this.onHideMenu,onShowMenu:this.onShowMenu})]})}}]),n}(s.Component)},50699:function(e,t,n){var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(72791),d=n(24753),c=n(53585),l=n(63446),h=n(95996),p=n(80184),u="wiki-page-content",f=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).getTitlesInfo=function(){var e=[],t=document.querySelectorAll('h1[id^="user-content"]')[0];if(t){var n=t.getAttribute("id"),i=n&&n.replace("user-content-","");i=i?"".concat(i," - ").concat(c.oF):c.oF,h.c.updateTabTitle(i)}for(var r=document.querySelectorAll('h2[id^="user-content"], h3[id^="user-content"]'),a=0;a<r.length;a++)e.push(r[a].offsetTop);o.titlesInfo=e},o.onLinkClick=function(e){e.preventDefault(),e.stopPropagation();var t="";if("A"!==e.target.tagName){for(var n=e.target.parentNode;"A"!==n.tagName;)n=n.parentNode;t=n.href}else t=e.target.href;o.props.onLinkClick(t)},o.onScrollHandler=function(){var e,t=o.markdownContainer.current.scrollTop+180,n=o.titlesInfo.length;if(t<=o.titlesInfo[0])return e=0,void o.setState({activeTitleIndex:e});if(t>o.titlesInfo[n-1])return e=o.titlesInfo.length-1,void o.setState({activeTitleIndex:e});for(var i=0;i<n;i++)if(!(t>o.titlesInfo[i])){e=i-1;break}o.setState({activeTitleIndex:e})},o.changeInlineNode=function(e){var t,n;if("image"==e.type&&c.O6){if(t=e.data.src,new RegExp(c.xx+"/lib/"+c.Jv+"/file.*raw=1").test(t)){var i=t.indexOf("/file"),r=t.indexOf("?");n=t.substring(i+5,r)}else{if(!/^\.\.\/*/.test(t)&&!/^\.\/*/.test(t))return;var a=o.props.path,s=a.slice(0,a.lastIndexOf("/"))+"/"+t;n=h.c.pathNormalize(s)}e.data.src=c.xx+"/view-image-via-public-wiki/?slug="+c.oF+"&path="+n}else if("link"==e.type)if(t=e.data.href,h.c.isInternalFileLink(t,c.Jv))if(h.c.isInternalMarkdownLink(t,c.Jv)){var d=h.c.getPathFromInternalMarkdownLink(t,c.Jv);e.data.href=c.xx+"/published/"+c.oF+d}else e.data.href=t.replace(/(.*)lib\/([-0-9a-f]{36})\/file(.*)/g,(function(e,t,n,i){return"".concat(t,"d/").concat(c.lI,"/files/?p=").concat(i,"&dl=1")}));else if(h.c.isInternalDirLink(t,c.Jv)){var l=h.c.getPathFromInternalDirLink(t,c.Jv);e.data.href=c.xx+"/published/"+c.oF+l}return e},o.modifyValueBeforeRender=function(e){return h.c.changeMarkdownNodes(e,o.changeInlineNode)},o.renderMarkdown=function(){var e=!0;return!1===o.props.isTOCShow&&(e=!1),o.props.isWiki?(0,p.jsx)(d.av,{showTOC:e,scriptSource:c.si+"js/mathjax/tex-svg.js",markdownContent:o.props.markdownContent,activeTitleIndex:o.state.activeTitleIndex,modifyValueBeforeRender:o.modifyValueBeforeRender}):(0,p.jsx)(d.av,{showTOC:e,scriptSource:c.si+"js/mathjax/tex-svg.js",markdownContent:o.props.markdownContent,activeTitleIndex:o.state.activeTitleIndex})},o.state={activeTitleIndex:0},o.markdownContainer=s.createRef(),o.links=[],o.titlesInfo=[],o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){var e=this;this.links=document.querySelectorAll(".".concat(u," a")),this.links.forEach((function(t){t.addEventListener("click",e.onLinkClick)})),this.getTitlesInfo()}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.props.markdownContent!==e.markdownContent&&this.links.forEach((function(e){e.removeEventListener("click",t.onLinkClick)}))}},{key:"componentDidUpdate",value:function(){var e=this;this.links=document.querySelectorAll(".".concat(u," a")),this.links.forEach((function(t){t.addEventListener("click",e.onLinkClick)})),0===this.titlesInfo.length&&this.getTitlesInfo()}},{key:"componentWillUnmount",value:function(){var e=this;this.links.forEach((function(t){t.removeEventListener("click",e.onLinkClick)}))}},{key:"render",value:function(){if(this.props.isFileLoading)return(0,p.jsx)(l.Z,{});var e="".concat(this.props.repoID?u+" w-100":u);return(0,p.jsx)("div",{ref:this.markdownContainer,className:"wiki-page-container",onScroll:this.onScrollHandler.bind(this),children:(0,p.jsxs)("div",{className:e,children:[this.props.children,this.renderMarkdown(),(0,p.jsxs)("p",{id:"wiki-page-last-modified",children:[(0,c.ih)("Last modified by")," ",this.props.latestContributor,", ",(0,p.jsx)("span",{children:this.props.lastModified})]})]})})}}]),n}(s.Component);d.av.defaultProps={isWiki:!1},t.Z=f},57430:function(e,t,n){var i=n(15671),o=n(43144),r=n(60136),a=n(29388),s=n(72791),d=n(54164),c=n(72426),l=n.n(c),h=n(24805),p=n.n(h),u=n(62298),f=n(53585),m=n(95996),v=n(22228),g=n(52423),k=n(84690),w=n(21761),x=n(263),C=n(63446),N=n(95046),D=n(24753),M=n(80184),y=function(){function e(t){var n=t.name,o=t.href,r=t.parentNode;(0,i.Z)(this,e),this.name=n,this.href=o,this.parentNode=r||null,this.children=[]}return(0,o.Z)(e,[{key:"setParent",value:function(e){this.parentNode=e}},{key:"addChildren",value:function(e){var t=this;e.forEach((function(e){e.setParent(t)})),this.children=e}}]),e}(),S=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).bindClickEvent=function(){o.links=document.querySelectorAll(".".concat("wiki-nav-content"," a")),o.links.forEach((function(e){e.addEventListener("click",o.onLinkClick)}))},o.removeClickEvent=function(){o.links.forEach((function(e){e.removeEventListener("click",o.onLinkClick)}))},o.onLinkClick=function(e){e.preventDefault();var t=e.target.getAttribute("data-path");if(t!==o.state.currentPath){t&&o.setState({currentPath:t});var n=o.getLink(e.target);n&&o.props.onLinkClick(n)}},o.getLink=function(e){var t=e.tagName;if(t&&"HTML"!==t)return"A"===t?e.href:o.getLink(e.parentNode)},o.changeInlineNode=function(e){var t;if("link"==e.type||"image"===e.type)if("image"==e.type&&f.O6){if(t=e.data.src,!new RegExp(f.xx+"/lib/"+f.Jv+"/file.*raw=1").test(t))return;var n=t.indexOf("/file"),i=t.indexOf("?"),o=t.substring(n+5,i);e.data.src=f.xx+"/view-image-via-public-wiki/?slug="+f.oF+"&path="+o}else if("link"==e.type){t=e.data.href;if(new RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/).test(t)){if(m.c.isInternalMarkdownLink(t,f.Jv)){var r=m.c.getPathFromInternalMarkdownLink(t,f.Jv);e.data.href=f.xx+"/published/"+f.oF+r}else if(m.c.isInternalDirLink(t,f.Jv)){var a=m.c.getPathFromInternalDirLink(t,f.Jv);e.data.href=f.xx+"/published/"+f.oF+a}}else e.data.href=f.xx+"/published/"+f.oF+"/"+t}return e},o.getRootNode=function(){var e=(0,D.vB)(o.props.indexContent);m.c.changeMarkdownNodes(e,o.changeInlineNode).forEach((function(e){if("unordered_list"===e.type||"ordered_list"===e.type){var t=o.transSlateToTree(e.children,o.treeRoot);o.setNodePath(t,"/"),o.treeRoot=t}}))},o.setNodePath=function(e,t){var n=e.name,i="/"===t?t+n:t+"/"+n;e.path=i,e.children.length>0&&e.children.forEach((function(e){o.setNodePath(e,i)}))},o.transSlateToTree=function(e,t){var n=e.map((function(e){if(2!==e.children.length||"unordered_list"!==e.children[1].type&&"ordered_list"!==e.children[1].type)return e.children[0]&&"paragraph"===e.children[0].type?o.transParagraph(e.children[0]):new y({name:"",href:""});var t=e.children[0],n=o.transParagraph(t),i=e.children[1];return o.transSlateToTree(i.children,n)}));return t.addChildren(n),t},o.transParagraph=function(e){var t;if(e.children[1]&&"link"===e.children[1].type){var n=e.children[1],i=n.children[0],o=i?i.text:"";t=new y({name:o,href:n.data.href})}else if(e.children[0]){var r=e.children[0],a=r.text?r.text:"";t=new y({name:a,href:""})}else t=new y({name:"",href:""});return t},o.links=[],o.treeRoot=new y({name:"",href:""}),o.state={currentPath:""},o}return(0,o.Z)(n,[{key:"componentWillMount",value:function(){this.getRootNode()}},{key:"componentDidMount",value:function(){this.bindClickEvent()}},{key:"componentWillReceiveProps",value:function(){this.removeClickEvent()}},{key:"componentDidUpdate",value:function(){this.bindClickEvent()}},{key:"componentWillUnmount",value:function(){this.removeClickEvent()}},{key:"render",value:function(){return(0,M.jsx)("div",{className:"mx-4 o-hidden",children:(0,M.jsx)(L,{node:this.treeRoot,bindClickEvent:this.bindClickEvent,currentPath:this.state.currentPath})})}}]),n}(s.Component),L=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).toggleExpanded=function(){o.setState({expanded:!o.state.expanded},(function(){o.state.expanded&&o.props.bindClickEvent()}))},o.renderLink=function(e){var t=e.href,n=e.name,i=e.path,r="wiki-nav-content ".concat(i===o.props.currentPath?"wiki-nav-content-highlight":"");return t&&n?(0,M.jsx)("div",{className:r,children:(0,M.jsx)("a",{href:t,"data-path":i,onClick:o.toggleExpanded,title:n,children:n})}):n?(0,M.jsx)("div",{className:"wiki-nav-content",children:(0,M.jsx)("span",{onClick:o.toggleExpanded,title:n,children:n})}):null},o.state={expanded:!1},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.node&&!this.props.node.parentNode&&this.setState({expanded:!0},(function(){e.props.bindClickEvent()}))}},{key:"render",value:function(){var e=this,t=this.props.node;return t.children.length>0?(0,M.jsxs)(s.Fragment,{children:[t.parentNode&&(0,M.jsxs)(s.Fragment,{children:[(0,M.jsx)("span",{className:"switch-btn",onClick:this.toggleExpanded,children:this.state.expanded?(0,M.jsx)("i",{className:"fa fa-caret-down"}):(0,M.jsx)("i",{className:"fa fa-caret-right"})}),this.renderLink(t)]}),this.state.expanded&&t.children.map((function(t,i){return(0,M.jsx)("div",{className:"pl-4 position-relative",children:(0,M.jsx)(n,{node:t,bindClickEvent:e.props.bindClickEvent,currentPath:e.props.currentPath})},i)}))]}):this.renderLink(t)}}]),n}(s.Component),I=S,E=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).renderIndexView=function(){return(0,M.jsx)(s.Fragment,{children:(0,M.jsxs)("div",{className:"wiki-pages-container",children:[(0,M.jsx)("div",{style:{marginTop:"2px"}}),(0,M.jsx)(I,{indexContent:o.props.indexContent,onLinkClick:o.props.onLinkClick})]})})},o.renderTreeView=function(){return(0,M.jsx)(s.Fragment,{children:(0,M.jsx)("div",{className:"wiki-pages-container",children:o.props.treeData&&(0,M.jsx)(N.Z,{treeData:o.props.treeData,currentPath:o.props.currentPath,isNodeMenuShow:o.isNodeMenuShow,onNodeClick:o.props.onNodeClick,onNodeCollapse:o.props.onNodeCollapse,onNodeExpanded:o.props.onNodeExpanded})})})},o.isNodeMenuShow=!1,o}return(0,o.Z)(n,[{key:"render",value:function(){return(0,M.jsxs)("div",{className:"side-panel wiki-side-panel ".concat(this.props.closeSideBar?"":"left-zero"),children:[(0,M.jsx)("div",{className:"side-panel-top panel-top",children:(0,M.jsx)(x.Z,{onCloseSidePanel:this.props.onCloseSide})}),(0,M.jsxs)("div",{id:"side-nav",className:"wiki-side-nav",role:"navigation",children:[this.props.isTreeDataLoading&&(0,M.jsx)(C.Z,{}),!this.props.isTreeDataLoading&&this.props.indexNode&&this.renderIndexView(),!this.props.isTreeDataLoading&&!this.props.indexNode&&this.renderTreeView(),f.b6&&f.rd&&(0,M.jsx)("div",{className:"text-left p-2",children:(0,M.jsx)("a",{href:f.ze+"library/"+f.Jv+"/"+f.oF+"/",className:"text-dark text-decoration-underline",children:(0,f.ih)("Go to Library")})})]})]})}}]),n}(s.Component),j=n(50699),P=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).onMouseEnter=function(){o.setState({highlight:!0})},o.onMouseLeave=function(){o.setState({highlight:!1})},o.onContextMenu=function(e){e.preventDefault(),e.stopPropagation()},o.onDirentClick=function(e){e.preventDefault(),o.props.onDirentClick(o.props.dirent)},o.state={highlight:!1},o}return(0,o.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.path,n=e.dirent,i=f.ze+"published"+m.c.joinPath(t,n.name),o=m.c.getDirentIcon(n);return m.c.isDesktop()?(0,M.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onContextMenu:this.onContextMenu,children:[(0,M.jsx)("td",{className:"text-center",children:(0,M.jsx)("img",{src:o,width:"24",alt:""})}),(0,M.jsx)("td",{className:"name",children:(0,M.jsx)("a",{href:i,onClick:this.onDirentClick,children:n.name})}),(0,M.jsx)("td",{children:n.size}),(0,M.jsx)("td",{children:n.mtime_relative})]}):(0,M.jsxs)("tr",{children:[(0,M.jsx)("td",{className:"text-center",children:(0,M.jsx)("img",{src:o,width:"24",alt:""})}),(0,M.jsxs)("td",{children:[(0,M.jsx)("a",{href:i,onClick:this.onDirentClick,children:n.name}),(0,M.jsx)("br",{}),(0,M.jsx)("span",{className:"item-meta-info",children:n.size}),(0,M.jsx)("span",{className:"item-meta-info",children:n.mtime_relative})]})]})}}]),n}(s.Component),b=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"render",value:function(){var e=this,t=m.c.isDesktop();return(0,M.jsxs)("table",{className:"table-hover ".concat(t?"":"table-thead-hidden"),children:[(0,M.jsx)("thead",{children:t?(0,M.jsxs)("tr",{children:[(0,M.jsx)("th",{style:{width:"4%"}}),(0,M.jsx)("th",{style:{width:"66%"},children:(0,f.ih)("Name")}),(0,M.jsx)("th",{style:{width:"15%"},children:(0,f.ih)("Size")}),(0,M.jsx)("th",{style:{width:"15%"},children:(0,f.ih)("Last Update")})]}):(0,M.jsxs)("tr",{children:[(0,M.jsx)("th",{width:"12%"}),(0,M.jsx)("th",{width:"88%"})]})}),(0,M.jsx)("tbody",{children:0!==this.props.direntList.length&&this.props.direntList.map((function(t,n){return(0,M.jsx)(P,{path:e.props.path,dirent:t,onDirentClick:e.props.onDirentClick},n)}))})]})}}]),n}(s.Component),Z=b,T=n(29561),F=n(43691),O=n(55516),z=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).onMenuClick=function(){e.props.onMenuClick()},e.onEditClick=function(t){t.preventDefault();var n=f.ze+"lib/"+f.Jv+"/file"+e.props.path+"?mode=edit";window.open(n)},e.onMainNavBarClick=function(t){var n=m.c.getEventData(t,"path");e.props.onMainNavBarClick(n)},e.renderNavPath=function(){var t=e.props.path.split("/"),n="";return t.map((function(i,o){return""===i?null:o===t.length-1?(0,M.jsxs)(s.Fragment,{children:[(0,M.jsx)("span",{className:"path-split",children:"/"}),(0,M.jsx)("span",{className:"path-file-name",children:i})]},o):(n+="/"+i,(0,M.jsxs)(s.Fragment,{children:[(0,M.jsx)("span",{className:"path-split",children:"/"}),(0,M.jsx)("a",{className:"path-link","data-path":n,onClick:e.onMainNavBarClick,children:i})]},o))}))},e}return(0,o.Z)(n,[{key:"render",value:function(){var e=this.props.onSearchedClick,t=(0,f.ih)("Search files in this library"),n=(0,M.jsx)("div",{className:"message err-tip",children:(0,f.ih)("Folder does not exist.")}),i=this.props.pathExist&&!this.props.isDataLoading&&this.props.isViewFile;return(0,M.jsxs)("div",{className:"main-panel wiki-main-panel",children:[(0,M.jsx)("div",{className:"main-panel-hide hide",children:this.props.content}),(0,M.jsxs)("div",{className:"main-panel-north panel-top ".concat("rw"===this.props.permission?"border-left-show":""),children:[!f.b6&&(0,M.jsxs)(s.Fragment,{children:[(0,M.jsx)("div",{className:"cur-view-toolbar",children:(0,M.jsx)("span",{className:"sf2-icon-menu hidden-md-up d-md-none side-nav-toggle",title:"Side Nav Menu",onClick:this.onMenuClick})}),(0,M.jsx)("div",{className:"common-toolbar",children:f._y&&(0,M.jsx)(T.Z,{isPublic:!0,repoID:f.Jv,onSearchedClick:e,placeholder:t})})]}),f.b6&&(0,M.jsxs)(s.Fragment,{children:[(0,M.jsxs)("div",{className:"cur-view-toolbar",children:[(0,M.jsx)("span",{className:"sf2-icon-menu hidden-md-up d-md-none side-nav-toggle",title:"Side Nav Menu",onClick:this.onMenuClick}),"rw"==this.props.permission&&(m.c.isDesktop()?(0,M.jsx)("button",{className:"btn btn-secondary operation-item",title:(0,f.ih)("Edit"),onClick:this.onEditClick,children:(0,f.ih)("Edit")}):(0,M.jsx)("span",{className:"fa fa-pencil-alt mobile-toolbar-icon",title:(0,f.ih)("Edit"),onClick:this.onEditClick,style:{fontSize:"1.1rem"}}))]}),(0,M.jsxs)("div",{className:"common-toolbar",children:[f._y&&(0,M.jsx)(T.Z,{isPublic:!0,repoID:f.Jv,onSearchedClick:e,placeholder:t}),(0,M.jsx)(F.Z,{}),(0,M.jsx)(O.Z,{})]})]})]}),(0,M.jsx)("div",{className:"main-panel-center",children:(0,M.jsxs)("div",{className:"cur-view-content ".concat(i?"o-hidden":""),children:[!this.props.pathExist&&n,this.props.pathExist&&this.props.isDataLoading&&(0,M.jsx)(C.Z,{}),i&&(0,M.jsx)(j.Z,{markdownContent:this.props.content,isFileLoading:this.props.isDataLoading,lastModified:this.props.lastModified,latestContributor:this.props.latestContributor,onLinkClick:this.props.onLinkClick,isWiki:!0,path:this.props.path}),!this.props.isDataLoading&&!this.props.isViewFile&&(0,M.jsx)(Z,{path:this.props.path,direntList:this.props.direntList,onDirentClick:this.props.onDirentClick})]})})]})}}]),n}(s.Component),B=z;n(28421),n(58108),n(29470);l().locale(f.KQ);var W=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).loadSidePanel=function(e){f.dP?o.loadIndexNode():(e="None"===f.zj?"/":e,o.loadNodeAndParentsByPath(e))},o.loadWikiData=function(e){if(o.pythonWrapper=document.getElementById("wiki-file-content"),"False"!==f.zj)if(o.removePythonWrapper(),"True"!==f.zj)if("None"!==f.zj||"/home.md"!==e){if("None"===f.zj){o.setState({pathExist:!1});var t=f.ze+"published/"+f.oF+m.c.encodePath(e);window.history.pushState({url:t,path:e},e,t)}}else o.showDir("/");else o.showDir(e);else o.setState({path:e})},o.loadIndexNode=function(){v.I.listWikiDir(f.oF,"/").then((function(e){var t=o.state.treeData;o.addFirstResponseListToNode(e.data.dirent_list,t.root);var n=t.getNodeByPath(o.indexPath);v.I.getWikiFileContent(f.oF,n.path).then((function(e){o.setState({treeData:t,indexNode:n,indexContent:e.data.content,isTreeDataLoading:!1})}))})).catch((function(){o.setState({isLoadFailed:!0})}))},o.showDir=function(e){o.removePythonWrapper(),o.loadDirentList(e);var t=f.ze+"published/"+f.oF+m.c.encodePath(e);window.history.pushState({url:t,path:e},e,t)},o.showFile=function(e){o.setState({isDataLoading:!0,isViewFile:!0,path:e}),o.removePythonWrapper(),v.I.getWikiFileContent(f.oF,e).then((function(e){var t=e.data;o.setState({isDataLoading:!1,content:t.content,permission:t.permission,lastModified:l().unix(t.last_modified).fromNow(),latestContributor:t.latest_contributor})}));var t=window.location.hash,n=f.ze+"published/"+f.oF+m.c.encodePath(e)+t;"/home.md"===e?window.history.replaceState({url:n,path:e},e,n):window.history.pushState({url:n,path:e},e,n)},o.loadDirentList=function(e){o.setState({isDataLoading:!0}),v.I.listWikiDir(f.oF,e).then((function(t){var n=t.data.dirent_list.map((function(e){return new g.Z(e)}));"/"===e&&(n=n.filter((function(e){if("dir"===e.type){var t=e.name.toLowerCase();return"drafts"!==t&&"images"!==t&&"downloads"!==t}return!0}))),n=m.c.sortDirents(n,"name","asc"),o.setState({path:e,isViewFile:!1,direntList:n,isDataLoading:!1})})).catch((function(){o.setState({isLoadFailed:!0})}))},o.loadTreeNodeByPath=function(e){var t=o.state.treeData.clone(),n=t.getNodeByPath(e);n.isLoaded?(t.getNodeByPath(n.parentNode.path).isExpanded=!0,o.setState({treeData:t,currentNode:n})):v.I.listWikiDir(f.oF,n.path).then((function(e){o.addResponseListToNode(e.data.dirent_list,n),t.getNodeByPath(n.parentNode.path).isExpanded=!0,o.setState({treeData:t,currentNode:n})}))},o.loadNodeAndParentsByPath=function(e){var t=o.state.treeData.clone();m.c.isMarkdownFile(e)&&(e=m.c.getDirName(e)),v.I.listWikiDir(f.oF,e,!0).then((function(e){for(var n=e.data.dirent_list,i={},r=0;r<n.length;r++){var a=n[r],s=a.parent_dir;i[s]||(i[s]=[]),i[s].push(a)}for(var d in i){var c=t.getNodeByPath(d);c.isLoaded||"/"!==c.path?c.isLoaded||o.addResponseListToNode(i[d],c):o.addFirstResponseListToNode(i[d],c)}o.setState({isTreeDataLoading:!1,treeData:t})})).catch((function(){o.setState({isLoadFailed:!0})}))},o.removePythonWrapper=function(){o.pythonWrapper&&(document.body.removeChild(o.pythonWrapper),o.pythonWrapper=null)},o.onConentLinkClick=function(e){e.preventDefault(),e.stopPropagation();var t="";if("A"!==e.target.tagName){for(var n=e.target.parentNode;"A"!==n.tagName;)n=n.parentNode;t=n.href}else t=e.target.href;o.onLinkClick(t)},o.onLinkClick=function(e){var t=e;if(m.c.isWikiInternalMarkdownLink(t,f.oF)){var n=m.c.getPathFromWikiInternalMarkdownLink(t,f.oF);o.showFile(n)}else if(m.c.isWikiInternalDirLink(t,f.oF)){var i=m.c.getPathFromWikiInternalDirLink(t,f.oF);o.showDir(i)}else window.location.href=t;o.state.closeSideBar||o.setState({closeSideBar:!0})},o.onpopstate=function(e){if(e.state&&e.state.path){var t=e.state.path;m.c.isMarkdownFile(t)?o.showFile(t):(o.loadDirentList(t),o.setState({path:t,isViewFile:!1}))}},o.onSearchedClick=function(e){var t=e.is_dir?e.path.slice(0,e.path.length-1):e.path;if(o.state.currentPath!==t){for(var n=-1,i=m.c.getPaths(t),r=0;r<i.length;r++){var a=o.state.treeData.getNodeByPath(a);if(!a){n=r;break}}if(-1===n){var s=o.state.treeData.clone(),d=s.getNodeByPath(e.path);w.Z.expandNode(d),o.setState({treeData:s})}else o.loadNodeAndParentsByPath(t);if(e.is_dir)o.showDir(t);else if(m.c.isMarkdownFile(t))o.showFile(t);else{var c=f.ze+"d/"+f.lI+"/files/?p="+m.c.encodePath(t);window.open("about:blank").location.href=c}}},o.onMenuClick=function(){o.setState({closeSideBar:!o.state.closeSideBar})},o.onMainNavBarClick=function(e){var t=o.state.treeData.clone(),n=t.getNodeByPath(e);t.expandNode(n),o.setState({treeData:t,currentNode:n}),o.showDir(n.path)},o.onDirentClick=function(e){var t=m.c.joinPath(o.state.path,e.name);if(e.isDir())o.loadTreeNodeByPath(t),o.showDir(t);else if(m.c.isMarkdownFile(t))o.showFile(t);else{var n=window.open("about:blank"),i=f.ze+"d/"+f.lI+"/files/?p="+m.c.encodePath(t);n.location.href=i}},o.onCloseSide=function(){o.setState({closeSideBar:!o.state.closeSideBar})},o.onNodeClick=function(e){if(o.state.pathExist||o.setState({pathExist:!0}),e.object.isDir()){if(!e.isLoaded){var t=o.state.treeData.clone();e=t.getNodeByPath(e.path),v.I.listWikiDir(f.oF,e.path).then((function(n){o.addResponseListToNode(n.data.dirent_list,e),t.collapseNode(e),o.setState({treeData:t})}))}if(e.path===o.state.path)if(e.isExpanded){var n=w.Z.collapseNode(o.state.treeData,e);o.setState({treeData:n})}else{var i=o.state.treeData.clone();e=i.getNodeByPath(e.path),i.expandNode(e),o.setState({treeData:i})}}if(e.path!==o.state.path)if(e.object.isDir())o.showDir(e.path);else if(m.c.isMarkdownFile(e.path))e.path!==o.state.path&&o.showFile(e.path),o.onCloseSide();else{var r=window.open("about:blank"),a=f.ze+"d/"+f.lI+"/files/?p="+m.c.encodePath(e.path);r.location.href=a}},o.onNodeCollapse=function(e){var t=w.Z.collapseNode(o.state.treeData,e);o.setState({treeData:t})},o.onNodeExpanded=function(e){var t=o.state.treeData.clone();(e=t.getNodeByPath(e.path)).isLoaded?(t.expandNode(e),o.setState({treeData:t})):v.I.listWikiDir(f.oF,e.path).then((function(n){o.addResponseListToNode(n.data.dirent_list,e),o.setState({treeData:t})}))},o.addFirstResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var n=e.map((function(e){return new g.Z(e)}));n=n.filter((function(e){if("dir"===e.type){var t=e.name.toLowerCase();return"drafts"!==t&&"images"!==t&&"downloads"!==t}return!0}));var i=(n=m.c.sortDirents(n,"name","asc")).map((function(e){return new k.Z({object:e})}));t.addChildren(i)},o.addResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var n=e.map((function(e){return new g.Z(e)})),i=(n=m.c.sortDirents(n,"name","asc")).map((function(e){return new k.Z({object:e})}));t.addChildren(i)},o.state={path:"",pathExist:!0,closeSideBar:!1,isViewFile:!0,isDataLoading:!1,direntList:[],content:"",permission:"",lastModified:"",latestContributor:"",isTreeDataLoading:!0,treeData:w.Z.buildTree(),currentNode:null,indexNode:null,indexContent:""},window.onpopstate=o.onpopstate,o.indexPath="/index.md",o.homePath="/home.md",o.pythonWrapper=null,o}return(0,o.Z)(n,[{key:"componentWillMount",value:function(){m.c.isDesktop()||this.setState({closeSideBar:!0})}},{key:"componentDidMount",value:function(){var e=this;this.loadSidePanel(f.OG),this.loadWikiData(f.OG),this.links=document.querySelectorAll("#wiki-file-content a"),this.links.forEach((function(t){return t.addEventListener("click",e.onConentLinkClick)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.links.forEach((function(t){return t.removeEventListener("click",e.onConentLinkClick)}))}},{key:"render",value:function(){return(0,M.jsxs)("div",{id:"main",className:"wiki-main",children:[(0,M.jsx)(E,{isTreeDataLoading:this.state.isTreeDataLoading,closeSideBar:this.state.closeSideBar,currentPath:this.state.path,treeData:this.state.treeData,indexNode:this.state.indexNode,indexContent:this.state.indexContent,onCloseSide:this.onCloseSide,onNodeClick:this.onNodeClick,onNodeCollapse:this.onNodeCollapse,onNodeExpanded:this.onNodeExpanded,onLinkClick:this.onLinkClick}),(0,M.jsx)(B,{path:this.state.path,pathExist:this.state.pathExist,isViewFile:this.state.isViewFile,isDataLoading:this.state.isDataLoading,content:this.state.content,permission:this.state.permission,lastModified:this.state.lastModified,latestContributor:this.state.latestContributor,direntList:this.state.direntList,onLinkClick:this.onLinkClick,onMenuClick:this.onMenuClick,onSearchedClick:this.onSearchedClick,onMainNavBarClick:this.onMainNavBarClick,onDirentClick:this.onDirentClick}),(0,M.jsx)(p(),{query:"(max-width: 767.8px)",children:(0,M.jsx)(u.Z,{isOpen:!this.state.closeSideBar,toggle:this.onCloseSide,contentClassName:"d-none"})})]})}}]),n}(s.Component);d.render((0,M.jsx)(W,{}),document.getElementById("wrapper"))}},function(e){e.O(0,[351],(function(){return t=57430,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=wiki.b59d3045.js.map