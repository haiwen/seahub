"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[7583],{86335:function(e,t,s){s.d(t,{A:function(){return u}});var n=s(60436),r=s(89379),a=s(5544),i=s(9950),o=s(5223),l=s(44414),c=function(e){var t=e.data,s=e.position,n=(0,i.useState)(s),o=(0,a.default)(n,2),c=o[0],d=o[1],u=(0,i.useRef)(null);(0,i.useEffect)((function(){var e=u.current.getBoundingClientRect(),t=e.height,n=e.width,a=s||{},i=a.left,o=a.top,l=(0,r.default)({},s);o+t>window.innerHeight-10&&(l.top="unset",l.bottom=10),i+n>window.innerWidth-10&&(l.left="unset",l.right=10),d(l)}),[s]);var h=t.title,g=t.records;return(0,l.jsxs)("div",{className:"sf-chart-tooltip",ref:u,style:c,children:[(0,l.jsx)("div",{className:"sf-chart-tooltip-title",children:h}),g.map((function(e){return(0,l.jsxs)("div",{className:"sf-chart-tooltip-item",children:[(0,l.jsx)("div",{className:"sf-chart-tooltip-item-marker",style:{backgroundColor:e.color}}),(0,l.jsx)("div",{className:"sf-chart-tooltip-item-name",children:e.name}),(0,l.jsx)("div",{className:"sf-chart-tooltip-item-value",children:e.value})]},e.color)}))]})},d=function(e,t){var s=function(e,t){return Math.max(1,Math.floor(e.length/(t/100)))}(e,t);return e.filter((function(e,t){return t%s===0})).map((function(e){return e.name}))},u=function(e){var t=e.data,s=void 0===t?[]:t,u=e.legends,h=void 0===u?[]:u,g=e.title,p=void 0===g?"":g,m=e.margin,f=void 0===m?{top:60,right:30,bottom:30,left:30}:m,x=e.ySuggestedMax,v=void 0===x?0:x,A=e.getDisplayValue,j=void 0===A?function(e){return e}:A,P=(0,i.useState)({display:!1,position:{x:0,y:0}}),S=(0,a.default)(P,2),y=S[0],D=S[1],N=(0,i.useRef)(null),w=(0,i.useRef)(null),b=(0,i.useRef)([]),I=(0,i.useRef)(null),k=(0,i.useRef)(null),C=(0,i.useRef)(null),M=(0,i.useMemo)((function(){return h.map((function(e){var t=e.key;return(0,r.default)((0,r.default)({},e),{},{values:s.map((function(e){return{key:t,name:e.name,value:e[t]}}))})}))}),[s,h]),L=(0,i.useCallback)((function(e,t){var s=t.height;return o.l78(e).tickSizeOuter(0).tickSize(s).tickFormat("")}),[]),_=(0,i.useCallback)((function(e,t){var s=t.width;return o.V4s(e).ticks(5).tickSize(-s).tickFormat("")}),[]),O=(0,i.useCallback)((function(e,t,r,a){var i=o.T9B(s,(function(e){return Math.max.apply(Math,(0,n.default)(a.map((function(t){return e[t.key]||0}))))}));v&&(i=Math.max(v,i));var l=o.Cmz(0,i,5)[1];r.domain([0,l])}),[v,s]),U=(0,i.useCallback)((function(){var e=.8*N.current.getBoundingClientRect().width,t=.5*e,n={height:t-f.top-f.bottom,width:e-f.left-f.right},r=o.Ltv(w.current).attr("width",e).attr("height",t).append("g").attr("transform","translate(".concat(f.left,", ").concat(f.top,")")),a=s.map((function(e){return e.name}));return{svg:r,x:o.hqK().domain(a).range([0,n.width]).padding(.1),y:o.m4Y().range([n.height,0]),tickValues:d(s,n.width),style:n}}),[s,f]),T=(0,i.useCallback)((function(e,t,s,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:500;k.current.transition().duration(r).call(o.l78(t).tickSizeOuter(0).tickValues(n)),C.current.transition().duration(r).call(o.V4s(s).tickSizeInner(0).ticks(5).tickFormat(j))}),[j]),R=(0,i.useCallback)((function(e,t,s,n,r,a){var i=r.height,o=e.append("g").attr("class","axis");k.current=o.append("g").attr("class","axis-x").attr("transform","translate(0, ".concat(i,")")),C.current=o.append("g").attr("class","axis-y"),T(e,t,s,n,0)}),[T]),F=(0,i.useCallback)((function(e,t,s,n,r,a){var i=r.height,o=r.width,l=e.append("g").attr("class","grid"),c=l.append("g").attr("class","grid-x").call(L(t,{height:i})),d=l.append("line").attr("class","grid-x-tip-line d-none").attr("y1",0).attr("y2",i);c.selectAll(".tick").append("rect").attr("class","tick-interaction").attr("x",-2.5).attr("y",0).attr("width",5).attr("height",i).attr("fill","transparent").attr("pointer-events","all").on("mouseover",(function(s,n){var r;if(d.attr("x1",t(n)).attr("x2",t(n)).classed("d-none",!1),e.selectAll(".dot").filter((function(e){return e.name===n})).classed("highlight-dot",!0),(null===(r=I.current)||void 0===r?void 0:r.title)!==n){var a=[];M.forEach((function(e){var t=e.values.find((function(e){return e.name===n}));t&&a.push({color:e.color,name:e.name,value:j(t.value)})})),I.current={records:a,title:n}}D({display:!0,position:{left:s.pageX+10,top:s.pageY+10}})})).on("mouseout",(function(t,s){d.classed("d-none",!0),e.selectAll(".dot").classed("highlight-dot",!1),D({display:!1,position:{left:0,top:0}}),I.current=null})),l.append("g").attr("class","grid-y").call(_(s,{width:o})).selectAll(".tick").classed("d-none",(function(e,t){return 0===t}))}),[M,j,L,_]),E=(0,i.useCallback)((function(e,t,s,n,r,a){r.height,r.width;var i=o.n8j().x((function(e){return t(e.name)||0})).y((function(e){return s(e.value)||0})).curve(o.lUB),l=e.select(".groups").empty()?e.append("g").attr("class","groups"):e.select(".groups"),c=l.selectAll(".group").data(a).enter().append("g").attr("class","group");c.append("path").attr("class","line").attr("d",(function(e){return i(e.values)})).attr("fill","none").attr("stroke",(function(e){return e.color})),c.each((function(e){o.Ltv(this).selectAll(".dot").data(e.values).enter().append("circle").attr("class","dot").attr("cx",(function(e){return t(e.name)||0})).attr("cy",(function(e){return s(e.value)||0})).attr("fill",e.color)})),l.selectAll(".line").classed("fade-line",(function(e){return b.current.includes(e.key)})).attr("d",(function(e){return i(e.values)})).transition().duration(500),l.selectAll(".dot").classed("fade-dot",(function(e){return b.current.includes(e.key)})).attr("cx",(function(e){return t(e.name)||0})).attr("cy",(function(e){return s(e.value)||0})).transition().duration(500),l.exit().remove()}),[]),B=(0,i.useCallback)((function(e,t,s,r,a,i){var l=a.height,c=a.width,d=e.append("text").attr("class","legend-text-measurer").style("visibility","hidden").style("font-size","12px"),u=h.map((function(e){var t=e.name;return d.text(t),d.node().getComputedTextLength()}));d.remove();var g=u.reduce((function(e,t){return e+t}),0)+44*h.length-16,p=(c-g)/2,m=e.append("g").attr("class","legends").selectAll(".legend").data(i).enter().append("g").attr("class","legend").classed("hidden-legend",(function(e){return b.current.includes(e.key)})).on("click",(function(a,i){b.current.includes(i.key)?b.current=b.current.filter((function(e){return e!==i.key})):b.current=[].concat((0,n.default)(b.current),[i.key]),o.Ltv(this).classed("hidden-legend",b.current.includes(i.key)),q(e,t,s,r,{height:l,width:c})}));m.append("rect").attr("x",(function(e,t){return p+u.slice(0,t).reduce((function(e,t){return e+t}),0)+44*t})).attr("y",-20).attr("width",20).attr("height",6).attr("rx",3).attr("fill",(function(e){return e.color})).attr("class","legend-color"),m.append("rect").attr("x",(function(e,t){return p+u.slice(0,t).reduce((function(e,t){return e+t}),0)+44*t+20})).attr("y",-26.5).attr("width",8).attr("height",16.5).attr("class","legend-gap"),m.append("text").attr("x",(function(e,t){return p+u.slice(0,t).reduce((function(e,t){return e+t}),0)+44*t+28})).attr("y",-20).attr("dy","7px").text((function(e){return e.name})).attr("class","legend-text")}),[h,q]),z=(0,i.useCallback)((function(e,t,s,n,r){r.height;var a=r.width;p&&e.append("text").attr("class","title").attr("x",a/2).attr("y",-40).text(p)}),[p]),q=(0,i.useCallback)((function(e,t,s,n,r){var a=r.width,i=r.height,o=h.filter((function(e){return!b.current.includes(e.key)}));O(e,t,s,o),T(e,t,s,n),e.select(".grid-x").transition().duration(500).call(L(t,{height:i})),e.select(".grid-y").transition().duration(500).call(_(s,{width:a})),E(e,t,s,n,{width:a,height:i},M)}),[h,M,O,T,L,_,E]),H=(0,i.useCallback)((function(e,t,s,n,r){var a=h.filter((function(e){return!b.current.includes(e.key)}));O(e,t,s,a),R(e,t,s,n,r),F(e,t,s,n,r),E(e,t,s,n,r,M),B(e,t,s,n,r,M),z(e,t,s,n,r)}),[h,M,O,R,F,E,B,z]),Y=(0,i.useCallback)((function(){var e=U(),t=e.svg,s=e.x,n=e.y,r=e.tickValues,a=e.style;H(t,s,n,r,a)}),[U,H]),G=(0,i.useCallback)((function(){w.current&&o.Ltv(w.current).selectAll("*").remove()}),[]),Q=(0,i.useCallback)((function(){G(),Y()}),[]);return(0,i.useEffect)((function(){return window.addEventListener("resize",Q),function(){G(),window.removeEventListener("resize",Q)}}),[Q]),(0,i.useEffect)((function(){Y()}),[]),(0,l.jsxs)("div",{className:"sf-chart w-100 h-100",ref:N,children:[(0,l.jsx)("svg",{ref:w}),y.display&&(0,l.jsx)(c,{data:I.current,position:y.position})]})}},52622:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(65604),g=s(40326),p=s(20338),m=s(44414),f=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).submit=function(){s.props.changeGroup2Department(),s.props.toggleDialog()},s.state={selectedOption:null},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e='<span class="op-target">'+h.Aq.HTMLescape(this.props.groupName)+"</span>",t=(0,g.AP)("Are you sure to change group {placeholder} to department ?").replace("{placeholder}",e);return(0,m.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,m.jsx)(p.A,{toggle:this.props.toggleDialog,children:(0,g.AP)("Change group to department")}),(0,m.jsx)(c.A,{children:(0,m.jsx)("p",{dangerouslySetInnerHTML:{__html:t}})}),(0,m.jsxs)(d.A,{children:[(0,m.jsx)(u.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,g.AP)("Cancel")}),(0,m.jsx)(u.A,{color:"primary",onClick:this.submit,children:(0,g.AP)("Submit")})]})]})}}])}(o.Component);t.A=f},61314:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(5495),c=s(69123),d=s(65276),u=s(34940),h=s(40326),g=s(65604),p=s(44414),m=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).onMenuItemClick=function(e){var t=g.Aq.getEventData(e,"op");s.props.onMenuItemClick(t)},s.onDropdownToggleClick=function(e){s.toggleOperationMenu(e)},s.toggleOperationMenu=function(e){s.setState({isItemMenuShow:!s.state.isItemMenuShow},(function(){s.state.isItemMenuShow?s.props.onFreezedItem():s.props.onUnfreezedItem()}))},s.state={isItemMenuShow:!1},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.operations,n=t.translateOperations;return(0,p.jsxs)(l.A,{isOpen:this.state.isItemMenuShow,toggle:this.toggleOperationMenu,children:[(0,p.jsx)(c.A,{tag:"i",className:"sf3-font sf3-font-more op-icon",title:(0,h.AP)("More operations"),"aria-label":(0,h.AP)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.isItemMenuShow}),(0,p.jsx)(d.A,{className:"my-1 mr-2",children:s.map((function(t,s){return(0,p.jsx)(u.A,{"data-op":t,onClick:e.onMenuItemClick,children:n(t)},s)}))})]})}}])}(o.Component);t.A=m},61599:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(40326),u=s(9961),h=s(20338),g=(s(8008),s(44414)),p=function(e){function t(){var e;(0,n.default)(this,t);for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return(e=(0,a.default)(this,t,[].concat(r))).toggle=function(){e.props.toggle()},e}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){return(0,g.jsxs)(l.A,{className:"seahub-io-dialog",isOpen:!0,toggle:this.toggle,children:[(0,g.jsx)(h.A,{toggle:this.toggle,children:(0,d.AP)("Exporting")}),(0,g.jsx)(c.A,{children:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(u.A,{}),(0,g.jsx)("div",{className:"seahub-io-dialog-parsing-text",children:(0,d.AP)("Exporting...")})]})})]})}}])}(o.Component);t.A=p},91611:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(25328),g=s(40326),p=s(4086),m=s(20338),f=s(44414),x=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).copyToClipboard=function(){(0,h.A)(s.props.link),s.props.toggleDialog(),p.A.success((0,g.AP)("The link is copied to the clipboard."),{duration:2})},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.props,t=e.link,s=e.toggleDialog;return(0,f.jsxs)(l.A,{isOpen:!0,toggle:s,children:[(0,f.jsx)(m.A,{toggle:s,children:(0,g.AP)("Link")}),(0,f.jsx)(c.A,{children:(0,f.jsx)("a",{href:t,children:t})}),(0,f.jsxs)(d.A,{children:[(0,f.jsx)(u.A,{color:"primary",onClick:this.copyToClipboard,children:(0,g.AP)("Copy")}),(0,f.jsx)(u.A,{color:"secondary",onClick:s,children:(0,g.AP)("Close")})]})]})}}])}(o.Component);t.A=x},15097:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(39708),u=s(79969),h=s(91646),g=s(65488),p=s(6754),m=s(34322),f=s(4086),x=s(40326),v=s(65604),A=s(43825),j=s(2662),P=s(20338),S=s(44414),y=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).onKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.handleChange=function(e){s.setState({departName:e.target.value},(function(){s.setState({isSubmitBtnActive:!!s.state.departName.trim()})}))},s.handleSubmit=function(){var e=(0,v.yS)(s.state.departName.trim());if(e.isValid){var t=s.props,n=t.orgID,r=t.parentNode,a=r?r.id:-1,i=s.state.departName.trim();(n?j.k.orgAdminAddDepartGroup(n,a,i):A.H.sysAdminAddNewDepartment(a,i)).then((function(e){r?s.props.addDepartment(r,e.data):s.props.setRootNode(e.data),s.props.toggle()})).catch((function(e){var t=v.Aq.getErrorMsg(e);f.A.danger(t)}))}else s.setState({errMessage:e.message})},s.state={departName:"",isSubmitBtnActive:!1},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e,t=this.props.parentNode,s=this.state.isSubmitBtnActive;return e=t?(0,x.AP)("Add department at")+" "+t.name:(0,x.AP)("Create top department"),(0,S.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,S.jsx)(P.A,{toggle:this.props.toggle,children:e}),(0,S.jsx)(c.A,{children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(u.A,{children:[(0,S.jsx)(h.A,{for:"departmentName",children:(0,x.AP)("Name")}),(0,S.jsx)(g.A,{id:"departmentName",name:"department-name",onKeyDown:this.onKeyDown,value:this.state.departName,onChange:this.handleChange,autoFocus:!0})]})})}),(0,S.jsxs)(p.A,{children:[(0,S.jsx)(m.A,{color:"secondary",onClick:this.props.toggle,children:(0,x.AP)("Cancel")}),(0,S.jsx)(m.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,x.AP)("Submit")})]})]})}}])}(o.Component);t.A=y},47150:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(40326),g=s(20338),p=s(44414),m=function(e){function t(){return(0,n.default)(this,t),(0,a.default)(this,t,arguments)}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.props,t=e.node,s=e.toggle;return(0,p.jsxs)(l.A,{isOpen:!0,toggle:s,children:[(0,p.jsx)(g.A,{toggle:s,children:(0,h.AP)("Delete department")}),(0,p.jsx)(c.A,{children:(0,p.jsxs)("p",{children:[(0,h.AP)("Are you sure to delete")," ",(0,p.jsx)("b",{children:t.name})," ?"]})}),(0,p.jsxs)(d.A,{children:[(0,p.jsx)(u.A,{color:"secondary",onMouseDown:s,children:(0,h.AP)("Cancel")}),(0,p.jsx)(u.A,{color:"primary",onMouseDown:this.props.onDelete,children:(0,h.AP)("Delete")})]})]})}}])}(o.Component);t.A=m},77474:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(39708),u=s(79969),h=s(91646),g=s(65488),p=s(6754),m=s(34322),f=s(4086),x=s(40326),v=s(65604),A=s(43825),j=s(2662),P=s(20338),S=s(44414),y=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).onKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.handleChange=function(e){var t=e.target.value;s.setState({departName:t},(function(){s.setState({isSubmitBtnActive:!!s.state.departName.trim()})}))},s.handleSubmit=function(){var e=(0,v.yS)(s.state.departName.trim());if(e.isValid){var t=s.props,n=t.node,r=t.orgID,a=s.state.departName.trim();(r?j.k.orgAdminUpdateDepartGroup(r,n.id,a):A.H.sysAdminRenameDepartment(n.id,a)).then((function(e){s.props.renameDepartment(n,e.data),s.props.toggle()})).catch((function(e){var t=v.Aq.getErrorMsg(e);f.A.danger(t)}))}else s.setState({errMessage:e.message})},s.state={departName:e.node.name,isSubmitBtnActive:!1},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.isSubmitBtnActive;return(0,S.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,S.jsx)(P.A,{toggle:this.props.toggle,children:(0,x.AP)("Rename")}),(0,S.jsx)(c.A,{children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(u.A,{children:[(0,S.jsx)(h.A,{for:"departmentName",children:(0,x.AP)("Name")}),(0,S.jsx)(g.A,{id:"departmentName",name:"department-name",onKeyDown:this.onKeyDown,value:this.state.departName,onChange:this.handleChange,autoFocus:!0})]})})}),(0,S.jsxs)(p.A,{children:[(0,S.jsx)(m.A,{color:"secondary",onClick:this.props.toggle,children:(0,x.AP)("Cancel")}),(0,S.jsx)(m.A,{color:"primary",onClick:this.handleSubmit,disabled:!e,children:(0,x.AP)("Submit")})]})]})}}])}(o.Component);t.A=y},43226:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(39708),u=s(79969),h=s(35077),g=s(65488),p=s(3898),m=s(6754),f=s(34322),x=s(40326),v=s(20338),A=s(44414),j=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleQuotaChange=function(e){var t=e.target.value;s.setState({quota:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateQuota(s.state.quota.trim()),s.toggle()},s.state={quota:"",isSubmitBtnActive:!1},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state,t=e.quota,s=e.isSubmitBtnActive;return(0,A.jsxs)(l.A,{isOpen:!0,toggle:this.toggle,children:[(0,A.jsx)(v.A,{toggle:this.toggle,children:(0,x.AP)("Set Quota")}),(0,A.jsx)(c.A,{children:(0,A.jsx)(d.A,{children:(0,A.jsxs)(u.A,{children:[(0,A.jsxs)(h.A,{children:[(0,A.jsx)(g.A,{type:"text",className:"form-control",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleQuotaChange}),(0,A.jsx)(p.A,{children:"MB"})]}),(0,A.jsxs)("p",{className:"small text-secondary mt-2 mb-2",children:[(0,x.AP)("An integer that is greater than or equal to 0."),(0,A.jsx)("br",{}),(0,x.AP)("Tip: 0 means default limit")]})]})})}),(0,A.jsxs)(m.A,{children:[(0,A.jsx)(f.A,{color:"secondary",onClick:this.toggle,children:(0,x.AP)("Cancel")}),(0,A.jsx)(f.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,x.AP)("Submit")})]})]})}}])}(o.Component);t.A=j},685:function(e,t,s){s.d(t,{A:function(){return j}});var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(8081),c=s(10877),d=s(6754),u=s(34322),h=s(4086),g=s(40326),p=s(43825),m=s(2662),f=s(65604),x=s(98361),v=s(20338),A=s(44414),j=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleSubmit=function(){var e=s.state.selectedUsers.map((function(e){return e.email}));if(0!==e.length){s.setState({errMessage:""});var t=s.props,n=t.nodeId,r=t.orgID;(r?m.k.orgAdminAddGroupMember(r,n,e):p.H.sysAdminAddGroupMember(n,e)).then((function(e){s.setState({selectedUsers:[]}),e.data.failed.length>0&&s.setState({errMsgs:e.data.failed.map((function(e){return e.error_msg}))}),e.data.success.length>0&&(s.props.onMemberChanged(),s.props.toggle())})).catch((function(e){var t=f.Aq.getErrorMsg(e);h.A.danger(t)}))}},s.state={selectedUsers:[],errMsgs:""},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.errMsgs;return(0,A.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,A.jsx)(v.A,{toggle:this.props.toggle,children:(0,g.AP)("Add members")}),(0,A.jsxs)(c.A,{children:[(0,A.jsx)(x.A,{placeholder:(0,g.AP)("Search users"),onSelectChange:this.handleSelectChange,isMulti:!0,selectedUsers:this.state.selectedUsers}),e.length>0&&(0,A.jsx)("ul",{className:"list-unstyled",children:e.map((function(e,t){return(0,A.jsx)("li",{className:"error mt-2",children:e},t)}))})]}),(0,A.jsxs)(d.A,{children:[(0,A.jsx)(u.A,{color:"secondary",onClick:this.props.toggle,children:(0,g.AP)("Cancel")}),(0,A.jsx)(u.A,{color:"primary",onClick:this.handleSubmit,children:(0,g.AP)("Submit")})]})]})}}])}(o.Component)},96763:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(40326),c=s(8081),d=s(10877),u=s(6754),h=s(34322),g=s(20338),p=s(44414),m=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).handleInputChange=function(e){s.setState({inputChecked:e.target.checked})},s.unlinkDevice=function(){s.props.toggleDialog(),s.props.unlinkDevice(s.state.inputChecked)},s.state={inputChecked:!1},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.inputChecked,t=this.props.toggleDialog;return(0,p.jsxs)(c.A,{isOpen:!0,toggle:t,children:[(0,p.jsx)(g.A,{toggle:t,children:(0,l.AP)("Unlink device")}),(0,p.jsxs)(d.A,{children:[(0,p.jsx)("p",{children:(0,l.AP)("Are you sure you want to unlink this device?")}),l.am&&(0,p.jsxs)("div",{className:"d-flex align-items-center",children:[(0,p.jsx)("input",{id:"delete-files",className:"mr-1",type:"checkbox",checked:e,onChange:this.handleInputChange}),(0,p.jsx)("label",{htmlFor:"delete-files",className:"m-0",children:(0,l.AP)("Delete files from this device the next time it comes online.")})]})]}),(0,p.jsxs)(u.A,{children:[(0,p.jsx)(h.A,{color:"secondary",onClick:t,children:(0,l.AP)("Cancel")}),(0,p.jsx)(h.A,{color:"primary",onClick:this.unlinkDevice,children:(0,l.AP)("Unlink")})]})]})}}])}(o.Component);t.A=m},83970:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(65488),c=s(8123),d=s(44414),u=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).onInputChange=function(e){var t=e.target.checked,n=t?1:0;s.setState({inputChecked:t}),s.props.saveSetting(s.props.keyText,n)},s.state={inputChecked:s.props.value},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.state.inputChecked,t=this.props,s=t.helpTip,n=t.displayName;return(0,d.jsx)(c.A,{displayName:n,mainClassName:"d-flex",mainContent:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.A,{className:"ml-0",checked:e,type:"checkbox",onChange:this.onInputChange}),(0,d.jsx)("p",{className:"ml-2",children:s})]})})}}])}(o.Component);t.A=u},15263:function(e,t,s){var n=s(9950),r=s(34322),a=s(40326),i=s(8123),o=s(44414);t.A=function(e){var t=(0,n.useRef)(null),s=e.helpTip,l=e.filePath,c=e.fileWidth,d=e.fileHeight,u=e.displayName;return(0,o.jsx)(i.A,{displayName:u,helpTip:s,mainContent:(0,o.jsx)("img",{src:l+"?t="+(new Date).getTime(),alt:u,width:c,height:d,className:"mb-1"}),extraContent:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.A,{color:"secondary",onClick:function(){t.current.click()},children:(0,a.AP)("Change")}),(0,o.jsx)("input",{className:"d-none",type:"file",onChange:function(){if(t.current.files.length){var s=t.current.files[0];e.postFile(s,e.keyText)}},ref:t})]})})}},72714:function(e,t,s){s(9950);var n=s(44414);t.A=function(e){var t=e.headingText,s=e.children;return(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:t}),s]})}},8123:function(e,t,s){s(9950);var n=s(97176),r=s(46114),a=s(91646),i=s(44414);t.A=function(e){var t=e.helpTip,s=e.displayName,o=e.mainContent,l=e.extraContent,c=e.mainClassName,d=void 0===c?"":c;return(0,i.jsxs)(n.A,{className:"my-4",children:[(0,i.jsx)(r.A,{md:"3",children:(0,i.jsx)(a.A,{className:"web-setting-label",children:s})}),(0,i.jsxs)(r.A,{md:"5",className:d,children:[o,t&&(0,i.jsx)("p",{className:"small text-secondary mt-1",children:t})]}),(0,i.jsx)(r.A,{md:"4",children:l})]})}},79611:function(e,t,s){var n=s(89379),r=s(23029),a=s(92901),i=s(39874),o=s(85501),l=s(9950),c=s(1352),d=s(53496),u=s(8081),h=s(14894),g=s(67818),p=s(40326),m=s(65604),f=s(66945),x=s(49403),v=s(44414),A=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).getActiveClass=function(t){return e.props.currentTab==t?"active":""},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this;return(0,v.jsxs)("div",{className:"side-panel ".concat(this.props.isSidePanelClosed?"":"left-zero"),children:[(0,v.jsx)("div",{className:"side-panel-north",children:(0,v.jsx)(x.A,{onCloseSidePanel:this.props.onCloseSidePanel})}),(0,v.jsx)("div",{className:"side-panel-center",children:(0,v.jsx)("div",{className:"side-nav",children:(0,v.jsxs)("div",{className:"side-nav-con",children:[(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("System Admin")}),(0,v.jsxs)("ul",{className:"nav nav-pills flex-column nav-container",children:[p.Tr&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("info")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("info")),to:p.Yc+"sys/info/",onClick:function(){return e.props.tabItemClick("info")},children:[(0,v.jsx)("span",{className:"sf2-icon-info","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Info")})]})}),(p.am||!p.Ez)&&p.m$&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("statistic")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("statistic")),to:p.Yc+"sys/statistics/file/",onClick:function(){return e.props.tabItemClick("statistic")},children:[(0,v.jsx)("span",{className:"sf2-icon-histogram","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Statistic")})]})}),p.Iw&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("devices")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("devices")),to:p.Yc+"sys/desktop-devices/",onClick:function(){return e.props.tabItemClick("devices")},children:[(0,v.jsx)("span",{className:"sf2-icon-monitor","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Devices")})]})}),p.sh&&p.s4&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("web-settings")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("web-settings")),to:p.Yc+"sys/web-settings/",onClick:function(){return e.props.tabItemClick("web-settings")},children:[(0,v.jsx)("span",{className:"sf2-icon-cog2","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Settings")})]})}),p.$j&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("libraries")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("libraries")),to:p.Yc+"sys/all-libraries/",onClick:function(){return e.props.tabItemClick("libraries")},children:[(0,v.jsx)("span",{className:"sf2-icon-library","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Libraries")})]})}),p.jR&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("users")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("users")),to:p.Yc+"sys/users/",onClick:function(){return e.props.tabItemClick("users")},children:[(0,v.jsx)("span",{className:"sf2-icon-user","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Users")})]})}),p.XV&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("groups")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("groups")),to:p.Yc+"sys/groups/",onClick:function(){return e.props.tabItemClick("groups")},children:[(0,v.jsx)("span",{className:"sf2-icon-group","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Groups")})]})}),p.am&&p.XV&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("departments")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("departments")),to:p.Yc+"sys/departments/",onClick:function(){return e.props.tabItemClick("departments")},children:[(0,v.jsx)("span",{className:"sf2-icon-organization","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Departments")})]})}),p.wA&&p.Iw&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("organizations")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("organizations")),to:p.Yc+"sys/organizations/",onClick:function(){return e.props.tabItemClick("organizations")},children:[(0,v.jsx)("span",{className:"sf2-icon-organization","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Organizations")})]})}),p.am&&p.Oq&&p.Iw&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("institutions")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("institutions")),to:p.Yc+"sys/institutions/",onClick:function(){return e.props.tabItemClick("institutions")},children:[(0,v.jsx)("span",{className:"sf2-icon-organization","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Institutions")})]})}),p.Iw&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("notifications")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("notifications")),to:p.Yc+"sys/notifications/",onClick:function(){return e.props.tabItemClick("notifications")},children:[(0,v.jsx)("span",{className:"sf2-icon-msgs","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Notifications")})]})}),p.Iw&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("links")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("links")),to:p.Yc+"sys/share-links/",onClick:function(){return e.props.tabItemClick("links")},children:[(0,v.jsx)("span",{className:"sf2-icon-link","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Links")})]})}),p.w4&&p.ju&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("logs")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("logs")),to:p.Yc+"sys/logs/login",onClick:function(){return e.props.tabItemClick("logs")},children:[(0,v.jsx)("span",{className:"sf2-icon-clock","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Logs")})]})}),p.am&&p.Iw&&p.n5&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("file-scan-records")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("file-scan-records")),to:p.Yc+"sys/file-scan-records/",onClick:function(){return e.props.tabItemClick("file-scan-records")},children:[(0,v.jsx)("span",{className:"sf2-icon-security","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("File Scan")})]})}),p.am&&p.Iw&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("virus-files")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("virus-files")),to:p.Yc+"sys/virus-files/all/",onClick:function(){return e.props.tabItemClick("virus-files")},children:[(0,v.jsx)("span",{className:"sf2-icon-security","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Virus Scan")})]})}),p.am&&p.JC&&p.Iw&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("invitations")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("invitations")),to:p.Yc+"sys/invitations/",onClick:function(){return e.props.tabItemClick("invitations")},children:[(0,v.jsx)("span",{className:"sf2-icon-invite","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Invitations")})]})}),p.Iw&&p.a8&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("termsandconditions")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("termsandconditions")),to:p.Yc+"sys/terms-and-conditions/",onClick:function(){return e.props.tabItemClick("termsandconditions")},children:[(0,v.jsx)("span",{className:"sf2-icon-wiki","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Terms and Conditions")})]})}),p.am&&p.hP&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("adminLogs")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("adminLogs")),to:p.Yc+"sys/admin-logs/operation",onClick:function(){return e.props.tabItemClick("adminLogs")},children:[(0,v.jsx)("span",{className:"sf2-icon-admin-log","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Admin Logs")})]})}),p.Iw&&p.Lp&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("work-weixin")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("work-weixin")),to:p.Yc+"sys/work-weixin/",onClick:function(){return e.props.tabItemClick("work-weixin")},children:[(0,v.jsx)("span",{className:"sf3-font-enterprise-wechat sf3-font","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:"\u4f01\u4e1a\u5fae\u4fe1\u96c6\u6210"})]})}),p.Iw&&p.MT&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("dingtalk")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("dingtalk")),to:p.Yc+"sys/dingtalk/",onClick:function(){return e.props.tabItemClick("dingtalk")},children:[(0,v.jsx)("span",{className:"sf3-font-dingtalk sf3-font","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:"\u9489\u9489\u96c6\u6210"})]})}),p.Iw&&p.DY&&(0,v.jsx)("li",{className:"nav-item ".concat(this.getActiveClass("abuse-reports")),children:(0,v.jsxs)(h.N_,{className:"nav-link ellipsis ".concat(this.getActiveClass("abuse-reports")),to:p.Yc+"sys/abuse-reports/",onClick:function(){return e.props.tabItemClick("abuse-reports")},children:[(0,v.jsx)("span",{className:"sf2-icon-monitor","aria-hidden":"true"}),(0,v.jsx)("span",{className:"nav-text",children:(0,p.AP)("Abuse Reports")})]})})]})]})})})]})}}])}(l.Component),j=A,P=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsx)("div",{className:"main-panel",children:this.props.children})}}])}(l.Component),S=P,y=s(34322),D=s(43825),N=s(4086),w=s(9961),b=s(32043),I=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).uploadLicenseFile=function(e){if(s.fileInput.current.files.length){var t=s.fileInput.current.files[0];D.H.sysAdminUploadLicense(t).then((function(e){var t=s.state.sysInfo;Object.assign(t,e.data,{with_license:!0}),s.setState({sysInfo:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}},s.openFileInput=function(){s.fileInput.current.click()},s.renderLicenseDescString=function(e,t,s){return"life-time"==e?"zh-cn"==window.app.config.lang?"\u6c38\u4e45\u6388\u6743\u7ed9 "+t+"\uff0c\u6280\u672f\u652f\u6301\u670d\u52a1\u81f3 "+s+" \u5230\u671f":(0,p.AP)("licensed to {placeholder_license_to}, upgrade service expired in {placeholder_license_expiration}").replace("{placeholder_license_to}",t).replace("{placeholder_license_expiration}",s):(0,p.AP)("licensed to {placeholder_license_to}, expires on {placeholder_license_expiration}").replace("{placeholder_license_to}",t).replace("{placeholder_license_expiration}",s)},s.state={loading:!0,errorMsg:"",sysInfo:{}},s.fileInput=l.createRef(),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetSysInfo().then((function(t){e.setState({loading:!1,sysInfo:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.sysInfo,t=e.license_mode,s=e.license_to,r=e.license_expiration,a=e.org_count,i=e.repos_count,o=e.total_files_count,c=e.total_storage,d=e.total_devices_count,u=e.current_connected_devices_count,h=e.license_maxusers,g=e.multi_tenancy_enabled,f=e.active_users_count,x=e.users_count,A=e.groups_count,j=e.with_license,P=this.state,S=P.loading,D=P.errorMsg;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container system-admin-info",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Info")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[S&&(0,v.jsx)(w.A,{}),D&&(0,v.jsx)("p",{className:"error text-center mt-4",children:D}),!S&&!D&&(0,v.jsxs)("dl",{className:"flex-1 m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("System Info")}),p.am?(0,v.jsxs)("dd",{className:"info-item-content",children:[(0,p.AP)("Professional Edition"),j&&" "+this.renderLicenseDescString(t,s,r),(0,v.jsx)("br",{}),p.gv&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{type:"button",className:"mt-2",onClick:this.openFileInput,children:(0,p.AP)("Upload license")}),(0,v.jsx)("input",{className:"d-none",type:"file",onChange:this.uploadLicenseFile,ref:this.fileInput})]})]}):(0,v.jsxs)("dd",{className:"info-item-content",children:[(0,p.AP)("Community Edition"),(0,v.jsx)("a",{className:"ml-1",href:"https://manual.seafile.com/latest/setup/migrate_ce_to_pro_with_docker/",target:"_blank",rel:"noreferrer",children:(0,p.AP)("Upgrade to Pro Edition")})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Version")}),(0,v.jsx)("dd",{className:"info-item-content",children:p.si}),(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.AP)("Libraries")," / ",(0,p.AP)("Files")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[i," / ",o]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Storage Used")}),(0,v.jsx)("dd",{className:"info-item-content",children:m.Aq.bytesToSize(c)}),(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.AP)("Total Devices")," / ",(0,p.AP)("Current Connected Devices")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[d," / ",u]}),p.am?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.AP)("Activated Users")," / ",(0,p.AP)("Total Users")," / ",(0,p.AP)("Limits")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[f," / ",x," / ",j?h:"--"]})]}):(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("dt",{className:"info-item-heading",children:[(0,p.AP)("Activated Users")," / ",(0,p.AP)("Total Users")]}),(0,v.jsxs)("dd",{className:"info-item-content",children:[f," / ",x]})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Groups")}),(0,v.jsx)("dd",{className:"info-item-content",children:A}),g&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Organizations")}),(0,v.jsx)("dd",{className:"info-item-content",children:a})]})]})]})]})})]})}}])}(l.Component),k=I,C=s(5544),M=s(4159),L=s.n(M),_=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"fileStatistic",urlPart:"statistics/file",text:(0,p.AP)("File")},{name:"storageStatistic",urlPart:"statistics/storage",text:(0,p.AP)("Storage")},{name:"usersStatistic",urlPart:"statistics/user",text:(0,p.AP)("Users")},{name:"trafficStatistic",urlPart:"statistics/traffic",text:(0,p.AP)("Traffic")},{name:"reportsStatistic",urlPart:"statistics/reports",text:(0,p.AP)("Reports")},{name:"metricsStatistic",urlPart:"statistics/metrics",text:(0,p.AP)("Metrics")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component),O=s(64467),U=s(29343),T=s(52544),R=s(86547),F=s.n(R),E=s(81139),B=(s(33731),s(9516),s(19617),"YYYY-MM-DD"),z=function(e){function t(e){var s;(0,r.default)(this,t),s=(0,i.default)(this,t,[e]);var n=window.app.config.lang,a=L()();return a="zh-cn"===n?a.locale("zh-cn"):a.locale("en-gb"),s.defaultCalendarValue=a.clone(),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=(0,v.jsx)(T.A,{defaultValue:this.defaultCalendarValue,disabledDate:e.disabledDate,format:B,locale:(0,E.r)()});return(0,v.jsx)(F(),{calendar:t,value:e.value,onChange:e.onChange,children:function(e){var t=e.value;return(0,v.jsx)("span",{children:(0,v.jsx)("input",{placeholder:"yyyy-mm-dd",tabIndex:"-1",readOnly:!0,value:t&&t.format(B)||"",className:"form-control system-statistic-input"})})}})}}])}(l.Component),q=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).changeActive=function(e){if(s.state.statisticType!==e){var t,n=L()().format("YYYY-MM-DD 00:00:00");switch(e){case"oneWeek":t=L()().subtract(6,"d").format("YYYY-MM-DD 00:00:00");break;case"oneMonth":t=L()().subtract(29,"d").format("YYYY-MM-DD 00:00:00");break;case"oneYear":t=L()().subtract(364,"d").format("YYYY-MM-DD 00:00:00")}s.setState({statisticType:e});s.props.getActivesFiles(t,n,"day")}},s.disabledStartDate=function(e){if(!e)return!1;var t=L()().format(),n=s.state.endValue;return n?n.isBefore(e)||L()(e).format()>t:t<L()(e).format()},s.disabledEndDate=function(e){if(!e)return!1;var t=L()().format(),n=s.state.startValue;return n?e.isBefore(n)||L()(e).format()>t:t<L()(e).format()},s.onChange=function(e,t){s.setState((0,O.default)({},e,t))},s.onSubmit=function(){var e=s.state,t=e.startValue,n=e.endValue;if(t&&n){s.setState({statisticType:"itemButton"});var r=L()(t).format("YYYY-MM-DD 00:00:00"),a=L()(n).format("YYYY-MM-DD 00:00:00");s.props.getActivesFiles(r,a,"day")}},s.state={statisticType:"oneWeek",startValue:null,endValue:null},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=L()().format("YYYY-MM-DD 00:00:00"),t=L()().subtract(6,"d").format("YYYY-MM-DD 00:00:00");this.props.getActivesFiles(t,e,"day")}},{key:"render",value:function(){var e=this.state,t=e.statisticType,s=e.endValue,n=e.startValue;return(0,v.jsxs)(l.Fragment,{children:[this.props.children,(0,v.jsxs)("div",{className:"system-statistic-time-range",children:[(0,v.jsxs)(U.A,{size:"sm",className:"sys-stat-tool",children:[(0,v.jsx)(y.A,{className:"font-weight-normal ".concat("oneWeek"===t?"item-active":""),onClick:this.changeActive.bind(this,"oneWeek"),children:(0,p.AP)("7 Days")}),(0,v.jsx)(y.A,{className:"font-weight-normal ".concat("oneMonth"===t?"item-active":""),onClick:this.changeActive.bind(this,"oneMonth"),children:(0,p.AP)("30 Days")}),(0,v.jsx)(y.A,{className:"font-weight-normal ".concat("oneYear"===t?"item-active":""),onClick:this.changeActive.bind(this,"oneYear"),children:(0,p.AP)("1 Year")})]}),(0,v.jsxs)("div",{className:"system-statistic-input-container",children:[(0,v.jsx)(z,{disabledDate:this.disabledStartDate,value:n,onChange:this.onChange.bind(this,"startValue")}),(0,v.jsx)("span",{className:"system-statistic-connect",children:"-"}),(0,v.jsx)(z,{disabledDate:this.disabledEndDate,value:s,onChange:this.onChange.bind(this,"endValue")}),(0,v.jsx)(y.A,{color:"primary",size:"sm",className:"system-statistic-button",onClick:this.onSubmit,children:(0,p.AP)("Submit")})]})]})]})}}])}(l.Component),H=s(86335),Y=(s(63864),function(e){var t=(0,l.useState)(!0),s=(0,C.default)(t,2),r=s[0],a=s[1],i=(0,l.useState)([]),o=(0,C.default)(i,2),c=o[0],d=o[1],u=(0,l.useMemo)((function(){return[{key:"added",color:"#57cd6b",name:(0,p.AP)("Added")},{key:"visited",color:"#fd913a",name:(0,p.AP)("Visited")},{key:"modified",color:"#72c3fc",name:(0,p.AP)("Modified")},{key:"deleted",color:"#f75356",name:(0,p.AP)("Deleted")}]}),[]),h=(0,l.useCallback)((function(e,t,s){a(!0),D.H.sysAdminStatisticFiles(e,t,s).then((function(e){var t=Array.isArray(e.data)?e.data.map((function(e){var t=e.added,s=e.deleted,n=e.modified,r=e.visited,a=e.datetime;return{name:L()(a).format("YYYY-MM-DD"),added:t,deleted:s,modified:n,visited:r}})):[];a(!1),d(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}),[]);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},e)),(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(_,{currentItem:"fileStatistic"}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsx)(q,{getActivesFiles:h}),r&&(0,v.jsx)(w.A,{}),!r&&c.length>0&&(0,v.jsx)(H.A,{title:(0,p.AP)("File Operations"),data:c,legends:u})]})]})]})}),G=function(e){var t=(0,l.useState)(!0),s=(0,C.default)(t,2),r=s[0],a=s[1],i=(0,l.useState)([]),o=(0,C.default)(i,2),c=o[0],d=o[1],u=(0,l.useMemo)((function(){return[{key:"total_storage",name:(0,p.AP)("Total Storage"),color:"#fd913a"}]}),[]),h=(0,l.useMemo)((function(){return 1e7}),[]),g=(0,l.useCallback)((function(e,t,s){a(!0),D.H.sysAdminStatisticStorages(e,t,s).then((function(e){var t=Array.isArray(e.data)?e.data.map((function(e){var t=e.total_storage,s=e.datetime;return{name:L()(s).format("YYYY-MM-DD"),total_storage:t}})):[];d(t),a(!1)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}),[]),f=(0,l.useCallback)((function(e){return m.Aq.bytesToSize(e)}),[]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},e)),(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(_,{currentItem:"storageStatistic"}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsx)(q,{getActivesFiles:g}),r&&(0,v.jsx)(w.A,{}),!r&&c.length>0&&(0,v.jsx)(H.A,{title:(0,p.AP)("Total Storage"),legends:u,data:c,margin:{top:60,right:30,bottom:30,left:60},ySuggestedMax:h,getDisplayValue:f})]})]})]})},Q=s(65488),V=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.type,s=e.sortBy,n="asc"==e.sortOrder?(0,v.jsx)("span",{className:"sf3-font sf3-font-down rotate-180 d-inline-block"}):(0,v.jsx)("span",{className:"sf3-font sf3-font-down"});return(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"16%",children:"user"==t?(0,p.AP)("User"):(0,p.AP)("Organization")}),(0,v.jsx)("th",{width:"11%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"sync_file_upload"),children:[(0,p.AP)("Sync Upload")," ","sync_file_upload"===s&&n]})}),(0,v.jsx)("th",{width:"14%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"sync_file_download"),children:[(0,p.AP)("Sync Download")," ","sync_file_download"===s&&n]})}),(0,v.jsx)("th",{width:"11%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"web_file_upload"),children:[(0,p.AP)("Web Upload")," ","web_file_upload"===s&&n]})}),(0,v.jsx)("th",{width:"14%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"web_file_download"),children:[(0,p.AP)("Web Download")," ","web_file_download"===s&&n]})}),(0,v.jsx)("th",{width:"17%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"link_file_upload"),children:[(0,p.AP)("Share link upload")," ","link_file_upload"===s&&n]})}),(0,v.jsx)("th",{width:"17%",children:(0,v.jsxs)("div",{className:"d-block table-sort-op cursor-pointer",onClick:this.props.sortItems.bind(this,"link_file_download"),children:[(0,p.AP)("Share link download")," ","link_file_download"===s&&n]})})]})}),(0,v.jsx)("tbody",{children:this.props.children})]})}}])}(l.Component),W=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).trafficName=function(){var t=e.props,s=t.userTrafficItem;switch(t.type){case"user":return s.name?(0,v.jsx)("a",{href:p.Yc+"sys/users/"+s.email+"/",children:s.name}):(0,v.jsx)("span",{children:"--"});case"org":return s.org_name?(0,v.jsx)("a",{href:p.Yc+"sys/organizations/"+s.org_id+"/info/",children:s.org_name}):(0,v.jsx)("span",{children:"--"})}},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.userTrafficItem,t=m.Aq.bytesToSize(e.sync_file_upload),s=m.Aq.bytesToSize(e.sync_file_download),n=m.Aq.bytesToSize(e.web_file_upload),r=m.Aq.bytesToSize(e.web_file_download),a=m.Aq.bytesToSize(e.link_file_upload),i=m.Aq.bytesToSize(e.link_file_download);return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:this.trafficName()}),(0,v.jsx)("td",{children:t}),(0,v.jsx)("td",{children:s}),(0,v.jsx)("td",{children:n}),(0,v.jsx)("td",{children:r}),(0,v.jsx)("td",{children:a}),(0,v.jsx)("td",{children:i})]})}}])}(l.Component),K=W,X=s(62376),$=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.getTrafficList(s.state.month,s.state.currentPage-1)},s.getNextPage=function(){s.getTrafficList(s.state.month,s.state.currentPage+1)},s.handleChange=function(e){var t=e.target.value;s.setState({month:t})},s.handleKeyPress=function(e){var t=s.state.month;if("Enter"===e.key){if(!/^([012]\d{3})(0[1-9]|1[012])$/.test(t)){var n=(0,p.AP)("Invalid month, should be yyyymm.");return void s.setState({errorMessage:n})}s.getTrafficList(t,s.initPage),e.target.blur(),e.preventDefault()}},s.getTrafficList=function(e,t){var n=s.state,r=n.perPage,a=n.sortBy,i=n.sortOrder,o="asc"==i?a:"".concat(a,"_").concat(i);s.setState({isLoading:!0,errorMessage:""}),D.H.sysAdminListOrgTraffic(e,t,r,o).then((function(n){var r=n.data.org_monthly_traffic_list.slice(0);s.setState({month:e,currentPage:t,orgTrafficList:r,hasNextPage:n.data.has_next_page,isLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.sortItems=function(e){s.setState({sortBy:e,sortOrder:"asc"==s.state.sortOrder?"desc":"asc"},(function(){var e=s.state,t=e.month,n=e.currentPage;s.getTrafficList(t,n)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getTrafficList(s.initMonth,s.initPage)}))},s.state={orgTrafficList:[],perPage:100,currentPage:1,hasNextPage:!1,month:L()().format("YYYYMM"),isLoading:!1,errorMessage:"",sortBy:"link_file_download",sortOrder:"desc"},s.initPage=1,s.initMonth=L()().format("YYYYMM"),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getTrafficList(e.initMonth,e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isLoading,s=e.errorMessage,n=e.orgTrafficList,r=e.currentPage,a=e.hasNextPage,i=e.perPage,o=e.sortBy,c=e.sortOrder;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mt-4",children:[(0,v.jsx)("span",{className:"statistic-reports-tip",children:(0,p.AP)("Month:")}),(0,v.jsx)(Q.A,{className:"statistic-reports-input",defaultValue:L()().format("YYYYMM"),onChange:this.handleChange,onKeyPress:this.handleKeyPress}),s&&(0,v.jsx)("div",{className:"error",children:s})]}),t&&(0,v.jsx)(w.A,{}),!t&&(0,v.jsx)(V,{type:"org",sortItems:this.sortItems,sortBy:o,sortOrder:c,children:n.length>0&&n.map((function(e,t){return(0,v.jsx)(K,{userTrafficItem:e,type:"org"},t)}))}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:r,hasNextPage:a,curPerPage:i,resetPerPage:this.resetPerPage})]})}}])}(l.Component),J=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.getTrafficList(s.state.month,s.state.currentPage-1)},s.getNextPage=function(){s.getTrafficList(s.state.month,s.state.currentPage+1)},s.handleChange=function(e){var t=e.target.value;s.setState({month:t})},s.handleKeyPress=function(e){var t=s.state.month;if("Enter"===e.key){if(!/^([012]\d{3})(0[1-9]|1[012])$/.test(t)){var n=(0,p.AP)("Invalid month, should be yyyymm.");return void s.setState({errorMessage:n})}s.getTrafficList(t,s.initPage),e.target.blur(),e.preventDefault()}},s.getTrafficList=function(e,t){var n=s.state,r=n.perPage,a=n.sortBy,i=n.sortOrder,o="asc"==i?a:"".concat(a,"_").concat(i);s.setState({isLoading:!0,errorMessage:""}),D.H.sysAdminListUserTraffic(e,t,r,o).then((function(n){var r=n.data.user_monthly_traffic_list.slice(0);s.setState({month:e,currentPage:t,userTrafficList:r,hasNextPage:n.data.has_next_page,isLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.sortItems=function(e){s.setState({sortBy:e,sortOrder:"asc"==s.state.sortOrder?"desc":"asc"},(function(){var e=s.state,t=e.month,n=e.currentPage;s.getTrafficList(t,n)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getTrafficList(s.initMonth,s.initPage)}))},s.state={userTrafficList:[],hasNextPage:!1,perPage:100,currentPage:1,month:L()().format("YYYYMM"),isLoading:!1,errorMessage:"",sortBy:"link_file_download",sortOrder:"desc"},s.initPage=1,s.initMonth=L()().format("YYYYMM"),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getTrafficList(e.initMonth,e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isLoading,s=e.errorMessage,n=e.userTrafficList,r=e.currentPage,a=e.hasNextPage,i=e.perPage,o=e.sortBy,c=e.sortOrder;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mt-4",children:[(0,v.jsx)("span",{className:"statistic-reports-tip",children:(0,p.AP)("Month:")}),(0,v.jsx)(Q.A,{className:"statistic-reports-input",defaultValue:L()().format("YYYYMM"),onChange:this.handleChange,onKeyPress:this.handleKeyPress}),s&&(0,v.jsx)("div",{className:"error",children:s})]}),t&&(0,v.jsx)(w.A,{}),!t&&(0,v.jsx)(V,{type:"user",sortItems:this.sortItems,sortBy:o,sortOrder:c,children:n.length>0&&n.map((function(e,t){return(0,v.jsx)(K,{userTrafficItem:e,type:"user"},t)}))}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:r,hasNextPage:a,curPerPage:i,resetPerPage:this.resetPerPage})]})}}])}(l.Component),Z=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).changeTabActive=function(e){s.setState({tabActive:e})},s.getActivesFiles=function(e,t,n){s.setState({isLoading:!0}),D.H.sysAdminStatisticTraffic(e,t,n).then((function(e){var t=[],n=[],r=[],a=[],i=e.data;Array.isArray(i)&&i.forEach((function(e){var s=e.datetime,i=L()(s).format("YYYY-MM-DD");n.push({name:i,upload:e["web-file-upload"],download:e["web-file-download"]}),r.push({name:i,upload:e["link-file-upload"],download:e["link-file-download"]}),a.push({name:i,upload:e["sync-file-upload"],download:e["sync-file-download"]}),t.push({name:i,upload:e["link-file-upload"]+e["sync-file-upload"]+e["web-file-upload"],download:e["link-file-download"]+e["sync-file-download"]+e["web-file-download"]})})),s.setState({linkData:r,syncData:a,webData:n,totalData:t,isLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.renderCommonTool=function(){var e=s.state.tabActive;return"system"===e?(0,v.jsx)(q,{getActivesFiles:s.getActivesFiles,children:(0,v.jsxs)("div",{className:"statistic-traffic-tab",children:[(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("system"===e?"active":""),onClick:s.changeTabActive.bind(s,"system"),children:(0,p.AP)("System")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("user"===e?"active":""),onClick:s.changeTabActive.bind(s,"user"),children:(0,p.AP)("Users")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("organizations"===e?"active":""),onClick:s.changeTabActive.bind(s,"organizations"),children:(0,p.AP)("Organizations")})]})}):(0,v.jsxs)("div",{className:"statistic-traffic-tab",children:[(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("system"===e?"active":""),onClick:s.changeTabActive.bind(s,"system"),children:(0,p.AP)("System")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("user"===e?"active":""),onClick:s.changeTabActive.bind(s,"user"),children:(0,p.AP)("Users")}),(0,v.jsx)("div",{className:"statistic-traffic-tab-item ".concat("organizations"===e?"active":""),onClick:s.changeTabActive.bind(s,"organizations"),children:(0,p.AP)("Organizations")})]})},s.getDisplayValue=function(e){return m.Aq.bytesToSize(e)},s.legends=[{key:"upload",name:(0,p.AP)("Upload"),color:"#fd913a"},{key:"download",name:(0,p.AP)("Download"),color:"#57cd6b"}],s.state={totalData:[],linkData:[],syncData:[],webData:[],isLoading:!0,tabActive:"system"},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.totalData,s=e.linkData,r=e.syncData,a=e.webData,i=e.isLoading,o=e.tabActive;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(_,{currentItem:"trafficStatistic"}),(0,v.jsxs)("div",{className:"cur-view-content",children:[this.renderCommonTool(),i&&(0,v.jsx)(w.A,{}),!i&&"system"===o&&(0,v.jsxs)("div",{className:"statistic-traffic-chart-container",children:[t.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(H.A,{legends:this.legends,data:t,title:(0,p.AP)("Total Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})}),a.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(H.A,{legends:this.legends,data:a,title:(0,p.AP)("Web Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})}),s.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(H.A,{legends:this.legends,data:s,title:(0,p.AP)("Share Link Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})}),r.length>0&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)(H.A,{legends:this.legends,data:r,title:(0,p.AP)("Sync Traffic"),ySuggestedMax:1e7,margin:{top:60,right:30,bottom:30,left:60},getDisplayValue:this.getDisplayValue})})]}),!i&&"user"===o&&(0,v.jsx)(J,{}),!i&&"organizations"===o&&(0,v.jsx)($,{})]})]})]})}}])}(l.Component),ee=function(e){var t=(0,l.useState)(!0),s=(0,C.default)(t,2),r=s[0],a=s[1],i=(0,l.useState)([]),o=(0,C.default)(i,2),c=o[0],d=o[1],u=(0,l.useMemo)((function(){return[{key:"count",name:(0,p.AP)("Active Users"),color:"#fd913a"}]}),[]),h=(0,l.useMemo)((function(){return 10}),[]),g=(0,l.useCallback)((function(e,t,s){a(!0),D.H.sysAdminStatisticActiveUsers(e,t,s).then((function(e){var t=Array.isArray(e.data)?e.data.map((function(e){var t=e.count,s=e.datetime;return{name:L()(s).format("YYYY-MM-DD"),count:t}})):[];d(t),a(!1)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}),[]);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},e)),(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(_,{currentItem:"usersStatistic"}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsx)(q,{getActivesFiles:g}),r&&(0,v.jsx)(w.A,{}),!r&&c.length>0&&(0,v.jsx)(H.A,{title:(0,p.AP)("Active Users"),legends:u,data:c,ySuggestedMax:h})]})]})]})},te=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleChange=function(e){var t=e.target.value;s.setState({month:t})},s.onGenerateReports=function(e){var t=p.xW+p.Yc+"api/v2.1/admin/statistics/",n=s.state.month;if(n){if("month"===e){if(!/^([012]\d{3})(0[1-9]|1[012])$/.test(n)){var r=(0,p.AP)("Invalid month, should be yyyymm.");return void s.setState({errorMessage:r})}}switch(e){case"month":t+="system-user-traffic/excel/?month="+n;break;case"storage":t+="system-user-storage/excel/?"}s.setState({errorMessage:""}),window.location.href=new URL(t)}else{var a=(0,p.AP)("It is required.");s.setState({errorMessage:a})}},s.state={month:L()().format("YYYYMM"),errorMessage:""},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state.errorMessage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(_,{currentItem:"reportsStatistic"}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"statistic-reports",children:[(0,v.jsx)("div",{className:"statistic-reports-title",children:(0,p.AP)("Monthly User Traffic")}),(0,v.jsxs)("div",{className:"d-flex align-items-center mt-4",children:[(0,v.jsx)("span",{className:"statistic-reports-tip",children:(0,p.AP)("Month:")}),(0,v.jsx)(Q.A,{className:"statistic-reports-input",defaultValue:L()().format("YYYYMM"),onChange:this.handleChange}),(0,v.jsx)(y.A,{className:"statistic-reports-submit operation-item",onClick:this.onGenerateReports.bind(this,"month"),children:(0,p.AP)("Create Report")})]}),e&&(0,v.jsx)("div",{className:"error",children:e})]}),(0,v.jsxs)("div",{className:"statistic-reports",children:[(0,v.jsx)("div",{className:"statistic-reports-title",children:(0,p.AP)("User Storage")}),(0,v.jsx)(y.A,{className:"mt-4 operation-item",onClick:this.onGenerateReports.bind(this,"storage"),children:(0,p.AP)("Create Report")})]})]})]})]})}}])}(l.Component),se=s(36755),ne=s(10467),re=s(24591),ae=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleTooltip=function(e){s.setState((function(t){return{tooltipOpen:t.tooltipOpen===e?null:e}}))},s.handleRowHover=function(e){s.setState({hoveredRow:e})},s.handleRowLeave=function(){s.setState({hoveredRow:null})},s.state={hoveredRow:null,tooltipOpen:null},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.componentName,n=t.metrics,r=this.state,a=r.hoveredRow,i=r.tooltipOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("tr",{className:"component-header",children:(0,v.jsx)("td",{colSpan:"4",children:(0,v.jsx)("div",{className:"component-title",children:(0,v.jsx)("span",{children:s})})})}),n.map((function(t){return t.data_points.map((function(s,n){var r="".concat(t.name,"-").concat(s.labels.node,"-").concat(n);return(0,v.jsxs)("tr",{className:"metric-row",children:[(0,v.jsx)("td",{onMouseEnter:function(){return e.handleRowHover(r)},onMouseLeave:e.handleRowLeave,children:(0,v.jsx)("div",{className:"metric-info",children:(0,v.jsxs)("div",{className:"metric-name",children:[t.name.substring(t.name.indexOf("_")+1),t.help&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("i",{className:"sf3-font-help sf3-font",id:r,"aria-hidden":"true",style:{visibility:a===r?"visible":"hidden"}}),(0,v.jsx)(re.A,{placement:"right",isOpen:i===r&&a===r,toggle:function(){return e.toggleTooltip(r)},target:r,delay:{show:200,hide:0},fade:!0,className:"metric-tooltip",hideArrow:!0,children:t.help})]})]})})}),(0,v.jsx)("td",{children:s.labels.node}),(0,v.jsx)("td",{className:"metric-value",children:s.value}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"collected-time",children:L()(s.labels.collected_at).format("YYYY-MM-DD HH:mm:ss")})})]},r)}))}))]})}}])}(l.Component),ie=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).groupMetricsByComponent=function(e){var t={};return e.forEach((function(e){e.data_points&&e.data_points.length>0&&e.data_points.forEach((function(s){var r=s.labels.component||"Other";t[r]||(t[r]=[]);var a=t[r].find((function(t){return t.name===e.name}));a?a.data_points.push(s):t[r].push((0,n.default)((0,n.default)({},e),{},{data_points:[s]}))}))})),t},s.getMetrics=(0,ne.default)((0,se.default)().mark((function e(){var t,n;return(0,se.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.setState({loading:!0}),e.prev=1,e.next=4,D.H.sysAdminStatisticMetrics();case 4:t=e.sent,n=s.groupMetricsByComponent(t.data.metrics),s.setState({metrics:t.data.metrics,groupedMetrics:n,loading:!1}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),s.setState({error:"Failed to get metric data",loading:!1});case 12:case"end":return e.stop()}}),e,null,[[1,9]])}))),s.state={metrics:[],loading:!0,error:null,groupedMetrics:{}},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.getMetrics()}},{key:"render",value:function(){var e=this.state,t=e.groupedMetrics,s=e.loading,r=e.error;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsxs)("div",{className:"",children:[(0,v.jsx)(_,{currentItem:"metricsStatistic"}),(0,v.jsx)("div",{className:"cur-metrics-content",children:s?(0,v.jsx)("div",{className:"loading-icon loading-tip"}):r?(0,v.jsx)("div",{className:"error text-danger",children:r}):(0,v.jsx)("div",{className:"metrics-container",children:(0,v.jsx)("div",{className:"card",children:(0,v.jsx)("div",{className:"card-body",children:(0,v.jsxs)("table",{className:"table table-striped mb-0",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"40%",children:(0,p.AP)("Metrics")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Node")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Value")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Collected time")})]})}),(0,v.jsx)("tbody",{children:Object.entries(t).map((function(e){var t=(0,C.default)(e,2),s=t[0],n=t[1];return(0,v.jsx)(ae,{componentName:s,metrics:n},s)}))})]})})})})})]})]})}}])}(l.Component);document.head.insertAdjacentHTML("beforeend","\n  <style>\n    .cur-metrics-content {\n      padding: 10px 16px;\n      border: none;\n    }\n\n    .cur-metrics-content .card {\n      margin-bottom: 20px;\n    }\n\n    .component-metrics-card .card-header {\n      background-color: #fff;\n      padding: 16px 20px;\n    }\n    \n    .metric-info {\n      display: flex;\n      flex-direction: column;\n    }\n    \n    .metric-name {\n      font-size: 14px;\n    }\n\n    .metrics-container {\n      padding: 0;\n    }\n    \n    .metrics-container .loading-tip {\n      margin: 100px auto;\n      text-align: center;\n    }\n\n    .card {\n      box-shadow: none;\n      border: none;\n    }\n\n    .card-body {\n      border: none;\n      padding: 0;\n    }\n\n    .component-header {\n      background-color: #fafafa !important;\n    }\n\n    .component-header td {\n      padding-top: 24px !important;\n      padding-bottom: 2px !important;\n      }\n\n    .component-title {\n      color: #212529;\n      font-size: 16px;\n      font-weight: 500;\n    }\n\n    .metric-row td {\n      padding: 0;\n      font-size: 14px;\n    }\n\n    .metrics-container .table {\n      margin-bottom: 0;\n      border: none;\n    }\n\n    .metrics-container .table td {\n      vertical-align: middle;\n      background-color: #fff;\n      border-bottom: 1px solid #e8e8e8;\n      padding-left: 8px;\n    }\n\n    .metrics-container .table th {\n      background-color: #fff;\n      border-bottom: 1px solid #e8e8e8;\n      color: #666;\n      font-size: 14px;\n    }\n\n    .sf3-font-help {\n      font-size: 14px;\n      color: #666;\n      margin-left: 4px;\n      opacity: 0.7;\n      transition: opacity 0.2s;\n\n    }\n  </style>\n");var oe=ie,le=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"desktop",urlPart:"desktop-devices",text:(0,p.AP)("Desktop")},{name:"mobile",urlPart:"mobile-devices",text:(0,p.AP)("Mobile")}],p.am&&s.navItems.push({name:"errors",urlPart:"device-errors",text:(0,p.AP)("Errors")}),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component),ce=le,de=s(37609),ue=s.n(de),he=s(48738),ge=s.n(he),pe=s(43066),me=s(96763);L().extend(ue());var fe=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPageDevicesList=function(){s.props.getDevicesListByPage(s.props.pageInfo.current_page-1)},s.getNextPageDevicesList=function(){s.props.getDevicesListByPage(s.props.pageInfo.current_page+1)},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.pageInfo,a=e.curPerPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var i=(0,v.jsx)(pe.A,{text:(0,p.AP)("No connected devices")}),o=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"19%",children:(0,p.AP)("User")}),(0,v.jsxs)("th",{width:"19%",children:[(0,p.AP)("Platform")," / ",(0,p.AP)("Version")]}),(0,v.jsx)("th",{width:"19%",children:(0,p.AP)("Device Name")}),(0,v.jsx)("th",{width:"19%",children:(0,p.AP)("IP")}),(0,v.jsx)("th",{width:"19%",children:(0,p.AP)("Last Access")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(xe,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPageDevicesList,gotoNextPage:this.getNextPageDevicesList,currentPage:r.current_page,hasNextPage:r.has_next_page,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return n.length?o:i}}])}(l.Component),xe=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.handleUnlink=function(){s.props.item.is_desktop_client?s.toggleUnlinkDeviceDialog():s.unlinkDevice(!0)},s.toggleUnlinkDeviceDialog=function(){s.setState({isUnlinkDeviceDialogOpen:!s.state.isUnlinkDeviceDialogOpen})},s.unlinkDevice=function(e){var t=s.props.item,n=t.platform,r=t.device_id,a=t.user;D.H.sysAdminUnlinkDevice(n,r,a,e).then((function(e){s.setState({unlinked:!0});var t=(0,p.AP)("Successfully unlinked the device.");N.A.success(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={unlinked:!1,isHighlighted:!1,isOpIconShown:!1,isUnlinkDeviceDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.unlinked,n=t.isUnlinkDeviceDialogOpen,r=t.isHighlighted,a=t.isOpIconShown;return s?null:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:ge()({"tr-highlight":r}),onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,onFocus:this.onMouseEnter,children:[(0,v.jsx)("td",{children:e.user_name}),(0,v.jsxs)("td",{children:[e.platform," / ",e.client_version]}),(0,v.jsx)("td",{children:e.device_name}),(0,v.jsx)("td",{children:e.last_login_ip}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{title:L()(e.last_accessed).format("dddd, MMMM D, YYYY h:mm:ss A"),children:L()(e.last_accessed).fromNow()})}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"sf3-font-delete1 sf3-font op-icon ".concat(a?"":"invisible"),title:(0,p.AP)("Unlink"),onClick:this.handleUnlink})})]}),n&&(0,v.jsx)(me.A,{unlinkDevice:this.unlinkDevice,toggleDialog:this.toggleUnlinkDeviceDialog})]})}}])}(l.Component),ve=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getDevicesListByPage=function(e){var t=s.props.devicesPlatform,n=s.state.perPage;D.H.sysAdminListDevices(t,e,n).then((function(e){s.setState({devicesData:e.data.devices,pageInfo:e.data.page_info,loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getDevicesListByPage(1)}))},s.state={loading:!0,errorMsg:"",devicesData:[],pageInfo:{},perPage:100},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,a=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||a),currentPage:parseInt(t.get("page")||r)},(function(){e.getDevicesListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(fe,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.devicesData,getDevicesListByPage:this.getDevicesListByPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,pageInfo:this.state.pageInfo})})}}])}(l.Component),Ae=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(ce,{currentItem:"desktop"}),(0,v.jsx)(ve,{devicesPlatform:"desktop"})]})})]})}}])}(l.Component),je=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(ce,{currentItem:"mobile"}),(0,v.jsx)(ve,{devicesPlatform:"mobile"})]})})]})}}])}(l.Component),Pe=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/users/").concat(encodeURIComponent(this.props.email),"/"),children:this.props.name})}}])}(l.Component),Se=Pe;L().extend(ue());var ye=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPageDeviceErrorsList=function(){s.props.getDeviceErrorsListByPage(s.props.pageInfo.current_page-1)},s.getNextPageDeviceErrorsList=function(){s.props.getDeviceErrorsListByPage(s.props.pageInfo.current_page+1)},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.pageInfo,a=e.curPerPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var i=(0,v.jsx)(pe.A,{text:(0,p.AP)("No sync errors")}),o=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"16%",children:(0,p.AP)("User")}),(0,v.jsxs)("th",{width:"20%",children:[(0,p.AP)("Device")," / ",(0,p.AP)("Version")]}),(0,v.jsx)("th",{width:"16%",children:(0,p.AP)("IP")}),(0,v.jsx)("th",{width:"16%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"16%",children:(0,p.AP)("Error")}),(0,v.jsx)("th",{width:"16%",children:(0,p.AP)("Time")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(De,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPageDeviceErrorsList,gotoNextPage:this.getNextPageDeviceErrorsList,currentPage:r.current_page,hasNextPage:r.has_next_page,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return n.length?o:i}}])}(l.Component),De=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.name})}),(0,v.jsxs)("td",{children:[e.device_name," / ",e.client_version]}),(0,v.jsx)("td",{children:e.device_ip}),(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sysadmin/#libs/").concat(e.repo_id),children:e.repo_name})}),(0,v.jsx)("td",{children:e.error_msg}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"item-meta-info",title:L()(e.last_accessed).format("dddd, MMMM D, YYYY h:mm:ss A"),children:L()(e.error_time).fromNow()})})]})}}])}(l.Component),Ne=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getDeviceErrorsListByPage=function(e){var t=s.state.perPage;D.H.sysAdminListDeviceErrors(e,t).then((function(e){s.setState({loading:!1,devicesErrors:e.data.device_errors,pageInfo:e.data.page_info,isCleanBtnShown:e.data.device_errors.length>0})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.clean=function(){D.H.sysAdminClearDeviceErrors().then((function(e){s.setState({devicesErrors:[],isCleanBtnShown:!1});var t=(0,p.AP)("Successfully cleaned all errors.");N.A.success(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getDeviceErrorsListByPage(1)}))},s.state={loading:!0,errorMsg:"",devicesErrors:[],isCleanBtnShown:!1,pageInfo:{},perPage:100},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,a=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||a),currentPage:parseInt(t.get("page")||r)},(function(){e.getDeviceErrorsListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[this.state.isCleanBtnShown?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:this.clean,children:(0,p.AP)("Clean")})})):(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(ce,{currentItem:"errors"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ye,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.devicesErrors,getDeviceErrorsListByPage:this.getDeviceErrorsListByPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,pageInfo:this.state.pageInfo})})]})})]})}}])}(l.Component),we=s(43226),be=s(10877),Ie=s(46882),ke=s(6754),Ce=s(20338),Me=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.openFileInput=function(){s.fileInputRef.current.click()},s.uploadFile=function(e){if(s.fileInputRef.current.files.length){var t=s.fileInputRef.current.files[0].name;if("xlsx"==t.substr(t.lastIndexOf(".")+1)){var n=s.fileInputRef.current.files[0];s.props.importUserInBatch(n),s.toggle()}else s.setState({errorMsg:(0,p.AP)("Please choose a .xlsx file.")})}},s.state={errorMsg:""},s.fileInputRef=l.createRef(),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state.errorMsg;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("Import users from a .xlsx file")}),(0,v.jsxs)(be.A,{children:[(0,v.jsx)("p",{children:(0,v.jsx)("a",{className:"text-secondary small",href:"".concat(p.Yc,"useradmin/batchadduser/example/"),children:(0,p.AP)("Download an example file")})}),(0,v.jsx)("button",{className:"btn btn-outline-primary",onClick:this.openFileInput,children:(0,p.AP)("Upload file")}),(0,v.jsx)("input",{className:"d-none",type:"file",onChange:this.uploadFile,ref:this.fileInputRef}),e&&(0,v.jsx)(Ie.A,{color:"danger",children:e})]}),(0,v.jsx)(ke.A,{children:(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")})})]})}}])}(l.Component),Le=s(39708),_e=s(79969),Oe=s(91646),Ue=s(35077),Te=s(98702),Re=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).translateRoles=function(e){switch(e){case"default":return(0,p.AP)("Default");case"guest":return(0,p.AP)("Guest");default:return e}},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsx)(Te.A,{isTextMode:this.props.isTextMode,isEditIconShow:this.props.isEditIconShow,options:this.props.roleOptions,currentOption:this.props.currentRole,onOptionChanged:this.props.onRoleChanged,translateOption:this.translateRoles})}}])}(l.Component),Fe=Re,Ee=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).checkSubmitBtnActive=function(){var e=s.state,t=e.email,n=e.password,r=e.passwordAgain,a=!0;a=!!(t.trim()&&n.trim()&&r.trim()),s.setState({isSubmitBtnActive:a})},s.toggle=function(){s.props.toggleDialog()},s.togglePasswordVisible=function(){s.setState({isPasswordVisible:!s.state.isPasswordVisible})},s.inputPassword=function(e){var t=e.target.value;s.setState({password:t,errorMsg:""},s.checkSubmitBtnActive)},s.inputPasswordAgain=function(e){var t=e.target.value;s.setState({passwordAgain:t,errorMsg:""},s.checkSubmitBtnActive)},s.generatePassword=function(){var e=m.Aq.generatePassword(8);s.setState({password:e,passwordAgain:e},s.checkSubmitBtnActive)},s.inputEmail=function(e){var t=e.target.value;s.setState({email:t},s.checkSubmitBtnActive)},s.inputName=function(e){var t=e.target.value;s.setState({name:t})},s.updateRole=function(e){s.setState({role:e})},s.handleSubmit=function(){var e=s.state,t=e.email,n=e.password,r=e.passwordAgain,a=e.name,i=e.role;if(n==r){var o={email:t.trim(),name:a.trim(),password:n.trim()};s.props.showRole&&(o.role=i),s.props.addUser(o),s.toggle()}else s.setState({errorMsg:(0,p.AP)("Passwords do not match.")})},s.state={errorMsg:"",isPasswordVisible:!1,password:"",passwordAgain:"",email:"",name:"",role:"default",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.dialogTitle,s=e.showRole,n=this.state,r=n.errorMsg,a=n.isPasswordVisible,i=n.email,o=n.name,l=n.role,c=n.password,d=n.passwordAgain,h=n.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:t||(0,p.AP)("Add Member")}),(0,v.jsxs)(be.A,{children:[(0,v.jsxs)(Le.A,{autoComplete:"off",children:[(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Email")}),(0,v.jsx)(Q.A,{value:i,onChange:this.inputEmail})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Name(optional)")}),(0,v.jsx)(Q.A,{type:"text",value:o,onChange:this.inputName})]}),s&&(0,v.jsxs)(_e.A,{children:[(0,v.jsxs)(Oe.A,{children:[(0,p.AP)("Role"),(0,v.jsx)("span",{className:"small text-secondary ml-1 sf3-font sf3-font-tips",title:(0,p.AP)("You can also add a user as a guest, who will not be allowed to create libraries and groups.")})]}),(0,v.jsx)(Fe,{isTextMode:!1,isEditIconShow:!1,currentRole:l,roleOptions:this.props.availableRoles,onRoleChanged:this.updateRole})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Password")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsx)(Q.A,{autoComplete:"new-password",type:a?"text":"password",value:c||"",onChange:this.inputPassword}),(0,v.jsx)(y.A,{className:"mt-0",onClick:this.togglePasswordVisible,children:(0,v.jsx)("i",{className:"link-operation-icon sf3-font sf3-font-eye".concat(this.state.isPasswordVisible?"":"-slash")})}),(0,v.jsx)(y.A,{className:"mt-0",onClick:this.generatePassword,children:(0,v.jsx)("i",{className:"link-operation-icon sf3-font sf3-font-magic"})})]})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Password again")}),(0,v.jsx)(Q.A,{type:a?"text":"password",value:d||"",onChange:this.inputPasswordAgain})]})]}),r&&(0,v.jsx)(Ie.A,{color:"danger",children:r})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!h,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),Be=s(98361),ze=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleSelectChange=function(e){s.setState({selectedUsers:e,isSubmitBtnActive:e.length>0})},s.handleSubmit=function(){s.props.addAdminInBatch(s.state.selectedUsers.map((function(e){return e.email}))),s.toggle()},s.state={selectedUsers:[],isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("Add Admin")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Be.A,{isMulti:!0,placeholder:(0,p.AP)("Search users"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),qe=s(82487),He=(0,a.default)((function e(t){(0,r.default)(this,e),this.email=t.email,this.name=t.name,this.contact_email=t.contact_email,this.login_id=t.login_id,this.last_login=t.last_login,this.last_access_time=t.last_access_time,this.create_time=t.create_time,this.is_active=t.is_active,this.is_staff=t.is_staff,this.department=t.department,this.quota_total=t.quota_total,this.quota_usage=t.quota_usage,this.role=t.role,this.institution=t.institution,t.org_id&&(this.org_id=t.org_id),t.org_name&&(this.org_name=t.org_name),this.isSelected=!1})),Ye=(0,a.default)((function e(t){(0,r.default)(this,e),this.email=t.email,this.name=t.name,this.contact_email=t.contact_email,this.login_id=t.login_id,this.last_login=t.last_login,this.last_access_time=t.last_access_time,this.create_time=t.create_time,this.is_active=t.is_active,this.is_staff=t.is_staff,this.quota_total=t.quota_total,this.quota_usage=t.quota_usage,this.admin_role=t.admin_role,this.isSelected=!1})),Ge=s(33320),Qe=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"database",urlPart:"users",text:(0,p.AP)("Database")}],p.eB&&s.navItems.push({name:"ldap",urlPart:"users/ldap",text:(0,p.AP)("LDAP")},{name:"ldap-imported",urlPart:"users/ldap-imported",text:(0,p.AP)("LDAP(imported)")}),p.gv&&s.navItems.push({name:"admin",urlPart:"users/admins",text:(0,p.AP)("Admin")}),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component),Ve=Qe,We=s(66149),Ke=window.sysadmin.pageOptions.availableRoles,Xe=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).translateRole=function(e){switch(e){case"":return(0,p.AP)("All");case"default":return(0,p.AP)("Default");case"guest":return(0,p.AP)("Guest");default:return e}},e.selectStatusOption=function(t){e.props.onStatusChange(t.value)},e.selectRoleOption=function(t){e.props.onRoleChange(t.value)},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.isActive,n=t.role;this.statusOptions=[{value:"",text:(0,p.AP)("All")},{value:"1",text:(0,p.AP)("Active")},{value:"0",text:(0,p.AP)("Inactive")}].map((function(e){return e.isSelected=s==e.value,e}));var r=this.statusOptions.filter((function(e){return e.isSelected}))[0];this.roleOptions=[""].concat(Ke).map((function(t){return{value:t,text:e.translateRole(t),isSelected:t==n}}));var a=this.roleOptions.filter((function(e){return e.isSelected}))[0]||{value:n,text:this.translateRole(n),isSelected:!0};return(0,v.jsxs)("div",{className:"users-filter-bar mt-4 mb-2 d-flex align-items-center",children:[(0,v.jsx)("span",{className:"filter-item mr-2",children:"".concat((0,p.AP)("Status"),":")}),(0,v.jsx)(We.A,{isDropdownToggleShown:!0,currentSelectedOption:r,options:this.statusOptions,selectOption:this.selectStatusOption}),(0,v.jsx)("span",{className:"filter-item mr-2 ml-4",children:"".concat((0,p.AP)("Role"),":")}),(0,v.jsx)(We.A,{isDropdownToggleShown:!0,currentSelectedOption:a,options:this.roleOptions,selectOption:this.selectRoleOption})]})}}])}(l.Component),$e=Xe,Je=s(61314),Ze=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleOptionChange=function(e){s.setState({keepSharing:"true"===e.target.value})},s.submit=function(){s.props.onSubmit(s.state.keepSharing),s.props.toggleDialog()},s.state={keepSharing:!0},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggleDialog,children:(0,p.AP)("Set user inactive")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Le.A,{children:(0,v.jsxs)(_e.A,{tag:"fieldset",children:[(0,v.jsx)("p",{children:(0,p.AP)("Do you want to keep the sharing relationships?")}),(0,v.jsx)(_e.A,{check:!0,children:(0,v.jsxs)(Oe.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"radio",name:"keepSharing",value:"true",checked:!0===this.state.keepSharing,onChange:this.handleOptionChange,className:"mr-2"}),(0,p.AP)("Keep sharing")]})}),(0,v.jsx)(_e.A,{check:!0,children:(0,v.jsxs)(Oe.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"radio",name:"keepSharing",value:"false",checked:!1===this.state.keepSharing,onChange:this.handleOptionChange,className:"mr-2"}),(0,p.AP)("Do not keep sharing")]})})]})})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.submit,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),et=window.sysadmin.pageOptions,tt=et.availableRoles,st=et.availableAdminRoles,nt=et.institutions;L().extend(ue());var rt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.sortByQuotaUsage=function(e){e.preventDefault(),s.props.sortByQuotaUsage()},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.isAdmin,n=t.loading,r=t.errorMsg,a=t.items,i=t.isAllUsersSelected,o=t.curPerPage,c=t.hasNextPage,d=t.currentPage,u=t.sortBy,h=t.sortOrder;if(n)return(0,v.jsx)(w.A,{});if(r)return(0,v.jsx)("p",{className:"error text-center mt-4",children:r});var g,m=[];g=""==u?(0,v.jsx)("span",{className:"sf3-font sf3-font-sort3"}):(0,v.jsx)("span",{className:"sf3-font ".concat("asc"==h?"sf3-font-down rotate-180 d-inline-block":"sf3-font-down")});var f=(0,p.AP)("Space Used"),x=void 0!=u?(0,v.jsxs)("a",{className:"d-inline-block table-sort-op",href:"#",onClick:this.sortByQuotaUsage,children:[f," ",g]}):f,A=(0,v.jsxs)(l.Fragment,{children:[x," / ".concat((0,p.AP)("Quota"))]}),j="".concat((0,p.AP)("Name")," / ").concat((0,p.AP)("Contact Email")),P="".concat((0,p.AP)("Created At")," / ").concat((0,p.AP)("Last Login")," / ").concat((0,p.AP)("Last Access"));p.am?m.push({width:"20%",text:j},{width:"15%",text:(0,p.AP)("Status")},{width:"15%",text:(0,p.AP)("Role")}):m.push({width:"30%",text:j},{width:"20%",text:(0,p.AP)("Status")}),p.Oq&&!s?m.push({width:"14%",text:A},{width:"14%",text:(0,p.AP)("Institution")},{width:"14%",text:P},{width:"5%",text:""}):m.push({width:"20%",text:A},{width:"22%",text:P},{width:"5%",text:""});var S=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"3%",className:"pl-2",children:(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:this.props.toggleSelectAllUsers,checked:i})}),m.map((function(e,t){return(0,v.jsx)("th",{width:e.width,children:e.text},t)}))]})}),(0,v.jsx)("tbody",{children:a.map((function(t,s){return s<e.props.curPerPage?(0,v.jsx)(at,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,toggleItemFreezed:e.toggleItemFreezed,updateUser:e.props.updateUser,deleteUser:e.props.deleteUser,updateAdminRole:e.props.updateAdminRole,revokeAdmin:e.props.revokeAdmin,onUserSelected:e.props.onUserSelected,isAdmin:e.props.isAdmin,isLDAPImported:e.props.isLDAPImported},s):null}))})]}),!this.props.isAdmin&&!this.props.isSearchResult&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:d,hasNextPage:c,curPerPage:o,resetPerPage:this.props.resetPerPage})]});return(0,v.jsx)("div",{children:a.length?S:(0,v.jsx)(pe.A,{text:(0,p.AP)("No users")})})}}])}(l.Component),at=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.toggleDeleteUserDialog=function(){s.setState({isDeleteUserDialogOpen:!s.state.isDeleteUserDialogOpen})},s.toggleResetUserPasswordDialog=function(){s.setState({isResetUserPasswordDialogOpen:!s.state.isResetUserPasswordDialogOpen})},s.toggleRevokeAdminDialog=function(){s.setState({isRevokeAdminDialogOpen:!s.state.isRevokeAdminDialogOpen})},s.toggleConfirmInactiveDialog=function(e){"active"!==(null===e||void 0===e?void 0:e.value)&&s.setState({isConfirmInactiveDialogOpen:!s.state.isConfirmInactiveDialogOpen})},s.onUserSelected=function(){s.props.onUserSelected(s.props.item)},s.updateStatus=function(e){var t="active"==e.value;t&&N.A.notify((0,p.AP)("It may take some time, please wait.")),s.props.updateUser(s.props.item.email,"is_active",t)},s.setUserInactive=function(e){s.props.updateUser(s.props.item.email,"is_active",!1,{keep_sharing:e}),s.toggleConfirmInactiveDialog()},s.updateRole=function(e){s.props.updateUser(s.props.item.email,"role",e.value)},s.updateAdminRole=function(e){s.props.updateAdminRole(s.props.item.email,e.value)},s.translateRole=function(e){switch(e){case"default":return(0,p.AP)("Default");case"guest":return(0,p.AP)("Guest");default:return e}},s.translateAdminRole=function(e){switch(e){case"default_admin":return(0,p.AP)("Default Admin");case"system_admin":return(0,p.AP)("System Admin");case"daily_admin":return(0,p.AP)("Daily Admin");case"audit_admin":return(0,p.AP)("Audit Admin");default:return e}},s.translateStatus=function(e){switch(e){case"active":return(0,p.AP)("Active");case"inactive":return(0,p.AP)("Inactive")}},s.updateInstitution=function(e){s.props.updateUser(s.props.item.email,"institution",e.value)},s.updateQuota=function(e){s.props.updateUser(s.props.item.email,"quota_total",e)},s.deleteUser=function(){N.A.notify((0,p.AP)("It may take some time, please wait.")),s.props.deleteUser(s.props.item.email,s.props.item.name)},s.resetPassword=function(){N.A.notify((0,p.AP)("It may take some time, please wait.")),D.H.sysAdminResetUserPassword(s.props.item.email).then((function(e){N.A.success(e.data.reset_tip)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.revokeAdmin=function(){var e=s.props.item;s.props.revokeAdmin(e.email,e.name)},s.getMenuOperations=function(){var e=s.props,t=e.isAdmin,n=e.isLDAPImported,r=e.isSearchResult,a=e.item,i=["Delete"];return(!n||r&&"db"==a.source)&&i.push("Reset Password"),t&&(i=["Revoke Admin"]),i},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.AP)("Delete");break;case"Reset Password":t=(0,p.AP)("Reset Password");break;case"Revoke Admin":t=(0,p.AP)("Revoke Admin")}return t},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteUserDialog();break;case"Reset Password":s.toggleResetUserPasswordDialog();break;case"Revoke Admin":s.toggleRevokeAdminDialog()}},s.state={isOpIconShown:!1,highlight:!1,isSetQuotaDialogOpen:!1,isDeleteUserDialogOpen:!1,isResetUserPasswordDialogOpen:!1,isRevokeAdminDialogOpen:!1,isConfirmInactiveDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.item,n=t.isAdmin,r=this.state,a=r.highlight,i=r.isOpIconShown,o=r.isSetQuotaDialogOpen,c=r.isDeleteUserDialogOpen,d=r.isResetUserPasswordDialogOpen,u=r.isRevokeAdminDialogOpen,g=r.isConfirmInactiveDialogOpen,f='<span class="op-target">'+m.Aq.HTMLescape(s.name)+"</span>",x=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",f),A=(0,p.AP)("Are you sure you want to reset the password of {placeholder} ?").replace("{placeholder}",f),j=(0,p.AP)("Are you sure you want to revoke the admin permission of {placeholder} ?").replace("{placeholder}",f),P=s.is_active?"active":"inactive";this.statusOptions=["active","inactive"].map((function(t){return{value:t,text:e.translateStatus(t),isSelected:t==P}}));var S,y,D,N=this.statusOptions.filter((function(e){return e.isSelected}))[0];if(n){var w=s.admin_role;this.adminRoleOptions=st.map((function(t){return{value:t,text:e.translateAdminRole(t),isSelected:t==w}})),S=this.adminRoleOptions.filter((function(e){return e.isSelected}))[0]}else{var b=s.role;this.roleOptions=tt.map((function(t){return{value:t,text:e.translateRole(t),isSelected:t==b}})),y=this.roleOptions.filter((function(e){return e.isSelected}))[0]||{value:b,text:this.translateRole(b),isSelected:!0}}if(p.Oq&&!n){var I=s.institution;this.instOptions=nt.map((function(e){return{value:e,text:e,isSelected:e==I}})),D=this.instOptions.filter((function(e){return e.isSelected}))[0]}return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{className:"pl-2",children:(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:this.onUserSelected,checked:s.isSelected})}),(0,v.jsxs)("td",{children:[(0,v.jsx)(Se,{email:s.email,name:s.name}),s.contact_email&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("br",{}),s.contact_email]}),s.org_id&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("br",{}),(0,v.jsxs)(h.N_,{to:"".concat(p.Yc,"sys/organizations/").concat(s.org_id,"/info/"),children:["(",s.org_name,")"]})]})]}),(0,v.jsx)("td",{children:(0,v.jsx)(We.A,{isDropdownToggleShown:a,currentSelectedOption:N,options:this.statusOptions,selectOption:this.updateStatus,toggleItemFreezed:this.props.toggleItemFreezed,operationBeforeSelect:s.is_active?this.toggleConfirmInactiveDialog:void 0})}),p.am&&(0,v.jsx)("td",{children:n?(0,v.jsx)(We.A,{isDropdownToggleShown:a,currentSelectedOption:S,options:this.adminRoleOptions,selectOption:this.updateAdminRole,toggleItemFreezed:this.props.toggleItemFreezed}):(0,v.jsx)(We.A,{isDropdownToggleShown:a,currentSelectedOption:y,options:this.roleOptions,selectOption:this.updateRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsxs)("td",{children:["".concat(m.Aq.bytesToSize(s.quota_usage)," / ").concat(s.quota_total>0?m.Aq.bytesToSize(s.quota_total):"--"),(0,v.jsx)("i",{title:(0,p.AP)("Edit"),className:"sf3-font sf3-font-rename op-icon ml-1 ".concat(i?"":"invisible"),onClick:this.toggleSetQuotaDialog})]}),p.Oq&&!n&&(0,v.jsx)("td",{children:(0,v.jsx)(We.A,{isDropdownToggleShown:a&&nt.length>0,currentSelectedOption:D,options:this.instOptions,selectOption:this.updateInstitution,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsxs)("td",{children:["".concat(s.create_time?L()(s.create_time).format("YYYY-MM-DD HH:mm"):"--"," /"),(0,v.jsx)("br",{}),"".concat(s.last_login?L()(s.last_login).fromNow():"--"),(0,v.jsx)("br",{}),"".concat(s.last_access_time?L()(s.last_access_time).fromNow():"--")]}),(0,v.jsx)("td",{children:s.email!=p.Xh&&i&&(0,v.jsx)(Je.A,{operations:this.getMenuOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),o&&(0,v.jsx)(we.A,{toggle:this.toggleSetQuotaDialog,updateQuota:this.updateQuota}),c&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete User"),message:x,executeOperation:this.deleteUser,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteUserDialog}),d&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Reset Password"),message:A,executeOperation:this.resetPassword,confirmBtnText:(0,p.AP)("Reset"),toggleDialog:this.toggleResetUserPasswordDialog}),u&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Revoke Admin"),message:j,executeOperation:this.revokeAdmin,confirmBtnText:(0,p.AP)("Revoke"),toggleDialog:this.toggleRevokeAdminDialog}),g&&(0,v.jsx)(Ze,{toggleDialog:this.toggleConfirmInactiveDialog,onSubmit:this.setUserInactive})]})}}])}(l.Component),it=rt,ot=window.sysadmin.pageOptions.availableRoles,lt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleImportUserDialog=function(){s.setState({isImportUserDialogOpen:!s.state.isImportUserDialogOpen})},s.toggleAddUserDialog=function(){s.setState({isAddUserDialogOpen:!s.state.isAddUserDialogOpen})},s.toggleBatchSetQuotaDialog=function(){s.setState({isBatchSetQuotaDialogOpen:!s.state.isBatchSetQuotaDialogOpen})},s.toggleBatchDeleteUserDialog=function(){s.setState({isBatchDeleteUserDialogOpen:!s.state.isBatchDeleteUserDialogOpen})},s.onUserSelected=function(e){var t=!1,n=[],r=s.state.userList.map((function(s){return s.email===e.email&&(s.isSelected=!s.isSelected),1==s.isSelected?(t=!0,n.push(s)):n=n.filter((function(e){return e.email!=s.email})),s}));s.setState({userList:r,hasUserSelected:t,selectedUserList:n})},s.toggleSelectAllUsers=function(){if(s.state.isAllUsersSelected){var e=s.state.userList.map((function(e){return e.isSelected=!1,e}));s.setState({userList:e,hasUserSelected:!1,isAllUsersSelected:!1,selectedUserList:[]})}else{var t=s.state.userList.map((function(e){return e.isSelected=!0,e}));s.setState({userList:t,hasUserSelected:!0,isAllUsersSelected:!0,selectedUserList:t})}},s.getUserList=function(){D.H.sysAdminListAdmins().then((function(e){var t=e.data.admin_user_list.map((function(e){return new Ye(e)}));s.setState({userList:t,loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.getUsersListByPage=function(e){var t=s.state,n=t.perPage,r=t.sortBy,a=t.sortOrder,i=t.is_active,o=t.role,l=s.props.isLDAPImported;D.H.sysAdminListUsers(e,n,l,r,a,i,o).then((function(t){var r=t.data.data.map((function(e){return new He(e)}));s.setState({userList:r,loading:!1,hasNextPage:m.Aq.hasNextPage(e,n,t.data.total_count),currentPage:e})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.updateURLSearchParams=function(e){var t=new URL(location.href),s=new URLSearchParams(t.search);for(var n in e)s.set(n,e[n]);t.search=s.toString(),(0,h.oo)(t.toString())},s.onStatusChange=function(e){s.setState({is_active:e,currentPage:1},(function(){var t=s.state,n=t.currentPage,r=t.perPage;s.updateURLSearchParams({page:n,per_page:r,is_active:e}),s.getUsersListByPage(n)}))},s.onRoleChange=function(e){s.setState({role:e,currentPage:1},(function(){var t=s.state,n=t.currentPage,r=t.perPage;s.updateURLSearchParams({page:n,per_page:r,role:e}),s.getUsersListByPage(n)}))},s.sortByQuotaUsage=function(){s.setState({sortBy:"quota_usage",sortOrder:"asc"==s.state.sortOrder?"desc":"asc",currentPage:1},(function(){var e=s.state,t=e.currentPage,n=e.perPage,r=e.sortBy,a=e.sortOrder;s.updateURLSearchParams({page:t,per_page:n,order_by:r,direction:a}),s.getUsersListByPage(t)}))},s.deleteUser=function(e,t){D.H.sysAdminDeleteUser(e).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r});var a=(0,p.AP)("Deleted user %s");a=a.replace("%s",t),N.A.success(a)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.setUserQuotaInBatch=function(e){var t=s.state.selectedUserList.map((function(e){return e.email}));D.H.sysAdminSetUserQuotaInBatch(t,e).then((function(e){var t=s.state.userList.map((function(t){return e.data.success.forEach((function(e){t.email==e.email&&(t.quota_total=e.quota_total)})),t}));s.setState({userList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteUserInBatch=function(){var e=s.state.selectedUserList.map((function(e){return e.email}));D.H.sysAdminDeleteUserInBatch(e).then((function(t){if(t.data.success.length){var n=s.state.userList.filter((function(e){return!t.data.success.some((function(t){return t.email==e.email}))}));s.setState({userList:n,hasUserSelected:e.length!=t.data.success.length});var r=t.data.success.length,a=1==r?(0,p.AP)("Successfully deleted 1 user."):(0,p.AP)("Successfully deleted {user_number_placeholder} users.").replace("{user_number_placeholder}",r);N.A.success(a)}t.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);N.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.importUserInBatch=function(e){N.A.notify((0,p.AP)("It may take some time, please wait.")),D.H.sysAdminImportUserViaFile(e).then((function(e){if(e.data.success.length){var t=e.data.success.map((function(e){return void 0==e.institution&&(e.institution=""),new He(e)}));s.setState({userList:t.concat(s.state.userList)})}e.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);N.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.addUser=function(e){N.A.notify((0,p.AP)("It may take some time, please wait."));var t=e.email,n=e.name,r=e.role,a=e.password;D.H.sysAdminAddUser(t,n,r,a).then((function(e){var t=s.state.userList;t.unshift(e.data),s.setState({userList:t}),N.A.success(e.data.add_user_tip)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getUsersListByPage(1)}))},s.updateUser=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};D.H.sysAdminUpdateUser(e,t,n,r).then((function(r){var a=s.state.userList.map((function(s){return s.email==e&&(s[t]=r.data[t]),s}));s.setState({userList:a});var i="is_active"==t&&n?r.data.update_status_tip:(0,p.AP)("Edit succeeded");N.A.success(i)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateAdminRole=function(e,t){D.H.sysAdminUpdateAdminRole(e,t).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.admin_role=t.data.role),s}));s.setState({userList:n}),N.A.success((0,p.AP)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.revokeAdmin=function(e,t){D.H.sysAdminUpdateUser(e,"is_staff",!1).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r}),N.A.success((0,p.AP)("Successfully revoked the admin permission of {placeholder}.").replace("{placeholder}",t))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.getOperationsForAll=function(){var e=s.props,t=e.isAdmin,n=e.isLDAPImported;return t?(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:s.toggleBatchAddAdminDialog,children:(0,p.AP)("Add Admin")}):n?(0,v.jsx)("a",{className:"btn btn-secondary operation-item",href:"".concat(p.Yc,"sys/useradmin/export-excel/"),children:(0,p.AP)("Export Excel")}):(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:s.toggleImportUserDialog,children:(0,p.AP)("Import Users")}),(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:s.toggleAddUserDialog,children:(0,p.AP)("Add User")}),(0,v.jsx)("a",{className:"btn btn-secondary operation-item",href:"".concat(p.Yc,"sys/useradmin/export-excel/"),children:(0,p.AP)("Export Excel")})]})},s.getCurrentNavItem=function(){var e=s.props,t=e.isAdmin,n=e.isLDAPImported,r="database";return t?r="admin":n&&(r="ldap-imported"),r},s.toggleBatchAddAdminDialog=function(){s.setState({isBatchAddAdminDialogOpen:!s.state.isBatchAddAdminDialogOpen})},s.addAdminInBatch=function(e){D.H.sysAdminAddAdminInBatch(e).then((function(e){var t=e.data.success.map((function(e){return new Ye(e)}));s.setState({userList:t.concat(s.state.userList)}),e.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);N.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.getSearch=function(){return s.props.isAdmin?null:(0,v.jsx)(Ge.A,{placeholder:(0,p.AP)("Search users"),submit:s.searchItems})},s.searchItems=function(e){(0,h.oo)("".concat(p.Yc,"sys/search-users/?query=").concat(encodeURIComponent(e)))},s.state={loading:!0,errorMsg:"",userList:[],hasNextPage:!1,currentPage:1,perPage:100,hasUserSelected:!1,selectedUserList:[],isAllUsersSelected:!1,isImportUserDialogOpen:!1,isAddUserDialogOpen:!1,isBatchSetQuotaDialogOpen:!1,isBatchDeleteUserDialogOpen:!1,isBatchAddAdminDialogOpen:!1,is_active:"",role:""},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.props.isAdmin)this.getUserList();else{var t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage,a=s.sortBy,i=void 0===a?"":a,o=s.sortOrder,l=void 0===o?"asc":o,c=s.is_active,d=s.role;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n),sortBy:t.get("order_by")||i,sortOrder:t.get("direction")||l,is_active:t.get("is_active")||c,role:t.get("role")||d},(function(){e.getUsersListByPage(e.state.currentPage)}))}}},{key:"render",value:function(){var e=this.props,t=e.isAdmin,s=e.isLDAPImported,r=this.state,a=r.is_active,i=r.role,o=r.hasUserSelected,c=r.isImportUserDialogOpen,d=r.isAddUserDialogOpen,u=r.isBatchDeleteUserDialogOpen,h=r.isBatchSetQuotaDialogOpen,g=r.isBatchAddAdminDialogOpen,m=this.getCurrentNavItem();return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:this.getSearch()},this.props),{},{children:o?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleBatchSetQuotaDialog,children:(0,p.AP)("Set Quota")}),(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleBatchDeleteUserDialog,children:(0,p.AP)("Delete Users")})]}):this.getOperationsForAll()})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Ve,{currentItem:m}),(0,v.jsxs)("div",{className:"cur-view-content",children:["database"==m&&(0,v.jsx)($e,{isActive:a,role:i,onStatusChange:this.onStatusChange,onRoleChange:this.onRoleChange}),(0,v.jsx)(it,{isAdmin:t,isLDAPImported:s,loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortByQuotaUsage:this.sortByQuotaUsage,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getUsersListByPage,updateUser:this.updateUser,deleteUser:this.deleteUser,updateAdminRole:this.updateAdminRole,revokeAdmin:this.revokeAdmin,onUserSelected:this.onUserSelected,isAllUsersSelected:this.isAllUsersSelected,toggleSelectAllUsers:this.toggleSelectAllUsers})]})]})}),c&&(0,v.jsx)(Me,{toggle:this.toggleImportUserDialog,importUserInBatch:this.importUserInBatch}),d&&(0,v.jsx)(Ee,{dialogTitle:(0,p.AP)("Add User"),showRole:p.am,availableRoles:ot,addUser:this.addUser,toggleDialog:this.toggleAddUserDialog}),h&&(0,v.jsx)(we.A,{toggle:this.toggleBatchSetQuotaDialog,updateQuota:this.setUserQuotaInBatch}),u&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Users"),message:(0,p.AP)("Are you sure you want to delete the selected user(s) ?"),executeOperation:this.deleteUserInBatch,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleBatchDeleteUserDialog}),g&&(0,v.jsx)(ze,{addAdminInBatch:this.addAdminInBatch,toggle:this.toggleBatchAddAdminDialog})]})}}])}(l.Component),ct=lt,dt=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsx)(ct,(0,n.default)({isAdmin:!0},this.props))}}])}(l.Component),ut=dt,ht=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsx)(ct,(0,n.default)({isLDAPImported:!0},this.props))}}])}(l.Component),gt=ht;L().extend(ue());var pt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.curPerPage,a=e.hasNextPage,i=e.currentPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center mt-4",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No users")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"40%",children:(0,p.AP)("Email")}),(0,v.jsxs)("th",{width:"30%",children:[(0,p.AP)("Space Used")," / ",(0,p.AP)("Quota")]}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Last Login")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(mt,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:a,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),mt=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.email})}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(e.quota_usage)," / ").concat(e.quota_total>0?m.Aq.bytesToSize(e.quota_total):"--")}),(0,v.jsx)("td",{children:e.last_login?L()(e.last_login).fromNow():"--"})]})})}}])}(l.Component),ft=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getUsersListByPage=function(e){var t=s.state.perPage;D.H.sysAdminListLDAPUsers(e,t).then((function(t){s.setState({loading:!1,userList:t.data.ldap_user_list,hasNextPage:t.data.has_next_page,currentPage:e})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getUsersListByPage(1)}))},s.state={loading:!0,errorMsg:"",userList:{},hasNextPage:!1,currentPage:1,perPage:100},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getUsersListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Ve,{currentItem:"ldap"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(pt,{resetPerPage:this.resetPerPage,loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,getListByPage:this.getUsersListByPage})})]})})]})}}])}(l.Component),xt=ft,vt=s(46114),At=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleBatchSetQuotaDialog=function(){s.setState({isBatchSetQuotaDialogOpen:!s.state.isBatchSetQuotaDialogOpen})},s.toggleBatchDeleteUserDialog=function(){s.setState({isBatchDeleteUserDialogOpen:!s.state.isBatchDeleteUserDialogOpen})},s.onUserSelected=function(e){var t=!1,n=[],r=s.state.userList.map((function(s){return s.email===e.email&&(s.isSelected=!s.isSelected),1==s.isSelected?(t=!0,n.push(s)):n=n.filter((function(e){return e.email!=s.email})),s}));s.setState({userList:r,hasUserSelected:t,selectedUserList:n})},s.toggleSelectAllUsers=function(){if(s.state.isAllUsersSelected){var e=s.state.userList.map((function(e){return e.isSelected=!1,e}));s.setState({userList:e,hasUserSelected:!1,isAllUsersSelected:!1,selectedUserList:[]})}else{var t=s.state.userList.map((function(e){return e.isSelected=!0,e}));s.setState({userList:t,hasUserSelected:!0,isAllUsersSelected:!0,selectedUserList:t})}},s.getItems=function(e){D.H.sysAdminSearchUsers(s.state.query.trim(),e,s.state.perPage).then((function(e){s.setState({userList:e.data.user_list,loading:!1,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getItems(1)}))},s.deleteUser=function(e,t){D.H.sysAdminDeleteUser(e).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r});var a=(0,p.AP)("Deleted user %s");a=a.replace("%s",t),N.A.success(a)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.setUserQuotaInBatch=function(e){var t=s.state.selectedUserList.map((function(e){return e.email}));D.H.sysAdminSetUserQuotaInBatch(t,e).then((function(e){var t=s.state.userList.map((function(t){return e.data.success.forEach((function(e){t.email==e.email&&(t.quota_total=e.quota_total)})),t}));s.setState({userList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteUserInBatch=function(){var e=s.state.selectedUserList.map((function(e){return e.email}));D.H.sysAdminDeleteUserInBatch(e).then((function(t){if(t.data.success.length){var n=s.state.userList.filter((function(e){return!t.data.success.some((function(t){return t.email==e.email}))}));s.setState({userList:n,hasUserSelected:e.length!=t.data.success.length});var r=t.data.success.length,a=1==r?(0,p.AP)("Successfully deleted 1 user."):(0,p.AP)("Successfully deleted {user_number_placeholder} users.").replace("{user_number_placeholder}",r);N.A.success(a)}t.data.failed.forEach((function(e){var t="".concat(e.email,": ").concat(e.error_msg);N.A.danger(t)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateUser=function(e,t,n,r){D.H.sysAdminUpdateUser(e,t,n,r).then((function(r){var a=s.state.userList.map((function(s){return s.email==e&&(s[t]=r.data[t]),s}));s.setState({userList:a});var i="is_active"==t&&n?r.data.update_status_tip:(0,p.AP)("Edit succeeded");N.A.success(i)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateAdminRole=function(e,t){D.H.sysAdminUpdateAdminRole(e,t).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.admin_role=t.data.role),s}));s.setState({userList:n}),N.A.success((0,p.AP)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.revokeAdmin=function(e,t){D.H.sysAdminUpdateUser(e,"is_staff",!1).then((function(n){var r=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:r}),N.A.success((0,p.AP)("Successfully revoked the admin permission of {placeholder}.").replace("{placeholder}",t))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.handleInputChange=function(e){s.setState({query:e.target.value},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.query;s.setState({isSubmitBtnActive:e.trim()})},s.getPreviousPageList=function(){s.getItems(s.state.pageInfo.current_page-1)},s.getNextPageList=function(){s.getItems(s.state.pageInfo.current_page+1)},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.getItems(1))},s.state={query:"",isSubmitBtnActive:!1,loading:!0,errorMsg:"",userList:[],pageInfo:{has_next_page:!1,current_page:1},currentPage:1,perPage:100,hasUserSelected:!1,selectedUserList:[],isAllUsersSelected:!1,isBatchSetQuotaDialogOpen:!1,isBatchDeleteUserDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(document.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({query:t.get("query")||"",currentPage:parseInt(t.get("page")||n),perPage:parseInt(t.get("per_page")||r)},(function(){e.getItems(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.query,r=t.isSubmitBtnActive,a=this.state,i=a.hasUserSelected,o=a.isBatchDeleteUserDialogOpen,c=a.isBatchSetQuotaDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[i?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleBatchSetQuotaDialog,children:(0,p.AP)("Set Quota")}),(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleBatchDeleteUserDialog,children:(0,p.AP)("Delete Users")})]})})):(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Users")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Search Users")}),(0,v.jsxs)(Le.A,{tag:"div",children:[(0,v.jsx)(_e.A,{row:!0,children:(0,v.jsx)(vt.A,{sm:5,children:(0,v.jsx)(Q.A,{type:"text",name:"query",value:s,placeholder:(0,p.AP)("Search users"),onChange:this.handleInputChange,onKeyDown:this.handleKeyDown})})}),(0,v.jsx)(_e.A,{row:!0,children:(0,v.jsx)(vt.A,{sm:{size:5},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!r,onClick:function(){return e.getItems(1)},children:(0,p.AP)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Result")}),(0,v.jsx)(it,{isLDAPImported:!1,isAdmin:!1,isSearchResult:!0,loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,curPerPage:this.state.perPage,updateUser:this.updateUser,deleteUser:this.deleteUser,updateAdminRole:this.updateAdminRole,revokeAdmin:this.revokeAdmin,onUserSelected:this.onUserSelected,isAllUsersSelected:this.isAllUsersSelected,toggleSelectAllUsers:this.toggleSelectAllUsers})]})]})]})}),c&&(0,v.jsx)(we.A,{toggle:this.toggleBatchSetQuotaDialog,updateQuota:this.setUserQuotaInBatch}),o&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Users"),message:(0,p.AP)("Are you sure you want to delete the selected user(s) ?"),executeOperation:this.deleteUserInBatch,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleBatchDeleteUserDialog}),this.state.pageInfo&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:this.state.pageInfo.current_page,hasNextPage:this.state.pageInfo.has_next_page,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage})]})}}])}(l.Component),jt=At,Pt=s(60096),St=s(3898),yt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleRateLimitChange=function(e){var t=e.target.value;s.setState({rateLimit:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateUploadDownloadRateLimit(s.props.uploadOrDownload,s.state.rateLimit.trim()),s.toggle()},s.state={rateLimit:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.rateLimit,s=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:"upload"==this.props.uploadOrDownload?(0,p.AP)("Set Upload Rate Limit"):(0,p.AP)("Set Download Rate Limit")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Le.A,{children:(0,v.jsxs)(_e.A,{children:[(0,v.jsxs)(Ue.A,{children:[(0,v.jsx)(Q.A,{type:"text",className:"form-control",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleRateLimitChange}),(0,v.jsx)(St.A,{children:"kB/s"})]}),(0,v.jsxs)("p",{className:"small text-secondary mt-2 mb-2",children:[(0,p.AP)("An integer that is greater than or equal to 0."),(0,v.jsx)("br",{}),(0,p.AP)("Tip: 0 means default limit")]})]})})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),Dt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleInputChange=function(e){var t=e.target.value;s.setState({value:t})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateValue(s.state.value.trim()),s.props.toggleDialog()},s.state={value:s.props.value,isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.toggleDialog;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:e,children:[(0,v.jsx)(Ce.A,{toggle:e,children:this.props.dialogTitle}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Le.A,{children:(0,v.jsx)(_e.A,{children:(0,v.jsx)(Q.A,{type:"text",value:this.state.value,onKeyDown:this.handleKeyDown,onChange:this.handleInputChange})})})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:e,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),Nt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"info",urlPart:"",text:(0,p.AP)("Info")},{name:"owned-repos",urlPart:"owned-libraries",text:(0,p.AP)("Owned Libraries")},{name:"shared-repos",urlPart:"shared-libraries",text:(0,p.AP)("Shared Libraries")},{name:"links",urlPart:"shared-links",text:(0,p.AP)("Shared Links")},{name:"groups",urlPart:"groups",text:(0,p.AP)("Groups")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.currentItem,s=e.email,n=e.userName;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/users/"),children:(0,p.AP)("Users")})," / ",n]})}),(0,v.jsx)("ul",{className:"nav border-bottom mx-4",children:this.navItems.map((function(e,n){return(0,v.jsx)("li",{className:"nav-item mr-2",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/users/").concat(encodeURIComponent(s),"/").concat(e.urlPart),className:"nav-link ".concat(t==e.name?" active":""),children:e.text})},n)}))})]})}}])}(l.Component),wt=Nt,bt=window.sysadmin.pageOptions,It=bt.twoFactorAuthEnabled,kt=bt.availableRoles,Ct=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.toggleSetUserUploadRateLimitDialog=function(){s.setState({isSetUserUploadRateLimitDialogOpen:!s.state.isSetUserUploadRateLimitDialogOpen})},s.toggleSetUserDownloadRateLimitDialog=function(){s.setState({isSetUserDownloadRateLimitDialogOpen:!s.state.isSetUserDownloadRateLimitDialogOpen})},s.updateQuota=function(e){s.props.updateUser("quota_total",e)},s.updateUploadDownloadRateLimit=function(e,t){"upload"==e&&s.props.updateUser("upload_rate_limit",t),"download"==e&&s.props.updateUser("download_rate_limit",t)},s.toggleDialog=function(e,t){s.setState({currentKey:e,dialogTitle:t,isUpdateUserDialogOpen:!s.state.isUpdateUserDialogOpen})},s.toggleSetNameDialog=function(){s.toggleDialog("name",(0,p.AP)("Set Name"))},s.toggleSetUserLoginIDDialog=function(){s.toggleDialog("login_id",(0,p.AP)("Set Login ID"))},s.toggleSetUserContactEmailDialog=function(){s.toggleDialog("contact_email",(0,p.AP)("Set Contact Email"))},s.updateValue=function(e){s.props.updateUser(s.state.currentKey,e)},s.toggleUpdateUserDialog=function(){s.toggleDialog("","")},s.state={currentKey:"",dialogTitle:"",isSetQuotaDialogOpen:!1,isSetUserUploadRateLimitDialogOpen:!1,isSetUserDownloadRateLimitDialogOpen:!1,isUpdateUserDialogOpen:!1,highlight:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=this.state.highlight;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center mt-4",children:s});var r=this.props.userInfo,a=this.state,i=a.currentKey,o=a.dialogTitle,l=a.isSetQuotaDialogOpen,c=a.isUpdateUserDialogOpen,d=a.isSetUserUploadRateLimitDialogOpen,u=a.isSetUserDownloadRateLimitDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("dl",{className:"m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Avatar")}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsx)("img",{src:r.avatar_url,alt:r.name,width:"80",className:"rounded"})}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Email")}),(0,v.jsx)("dd",{className:"info-item-content",children:r.email}),r.org_name&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Organization")}),(0,v.jsx)("dd",{className:"info-item-content",children:r.org_name})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Name")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.name||"--",(0,v.jsx)(Pt.A,{onClick:this.toggleSetNameDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Login ID")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.login_id||"--",(0,v.jsx)(Pt.A,{onClick:this.toggleSetUserLoginIDDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Contact Email")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.contact_email||"--",(0,v.jsx)(Pt.A,{onClick:this.toggleSetUserContactEmailDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Role")}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsx)(We.A,{isDropdownToggleShown:n,currentSelectedOption:this.props.currentSelectedRoleOption,options:this.props.roleOptions,selectOption:this.props.updateRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Space Used / Quota")}),(0,v.jsxs)("dd",{className:"info-item-content",children:["".concat(m.Aq.bytesToSize(r.quota_usage)," / ").concat(r.quota_total>0?m.Aq.bytesToSize(r.quota_total):"--"),(0,v.jsx)(Pt.A,{onClick:this.toggleSetQuotaDialog})]}),p.am&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Upload Rate Limit")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.upload_rate_limit>0?r.upload_rate_limit+" kB/s":"--",(0,v.jsx)(Pt.A,{onClick:this.toggleSetUserUploadRateLimitDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Download Rate Limit")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.download_rate_limit>0?r.download_rate_limit+" kB/s":"--",(0,v.jsx)(Pt.A,{onClick:this.toggleSetUserDownloadRateLimitDialog})]})]}),It&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Two-Factor Authentication")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r.has_default_device?(0,v.jsxs)(_e.A,{children:[(0,v.jsx)("p",{className:"mb-1",children:(0,p.AP)("Status: enabled")}),(0,v.jsx)(y.A,{onClick:this.props.disable2FA,children:(0,p.AP)("Disable Two-Factor Authentication")})]}):(0,v.jsx)(_e.A,{children:(0,v.jsx)(y.A,{disabled:!0,children:(0,p.AP)("Disable Two-Factor Authentication")})}),(0,v.jsx)(_e.A,{check:!0,children:(0,v.jsxs)(Oe.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"checkbox",checked:r.is_force_2fa,onChange:this.props.toggleForce2fa}),(0,v.jsx)("span",{children:(0,p.AP)("Force Two-Factor Authentication")})]})})]})]})]}),l&&(0,v.jsx)(we.A,{updateQuota:this.updateQuota,toggle:this.toggleSetQuotaDialog}),p.am&&d&&(0,v.jsx)(yt,{uploadOrDownload:"upload",updateUploadDownloadRateLimit:this.updateUploadDownloadRateLimit,toggle:this.toggleSetUserUploadRateLimitDialog}),p.am&&u&&(0,v.jsx)(yt,{uploadOrDownload:"download",updateUploadDownloadRateLimit:this.updateUploadDownloadRateLimit,toggle:this.toggleSetUserDownloadRateLimitDialog}),c&&(0,v.jsx)(Dt,{dialogTitle:o,value:r[i],updateValue:this.updateValue,toggleDialog:this.toggleUpdateUserDialog})]})}}])}(l.Component),Mt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).updateUser=function(e,t){var n=s.state.userInfo.email;D.H.sysAdminUpdateUser(n,e,t).then((function(t){var n=s.state.userInfo;n[e]=t.data[e],s.setState({userInfo:n}),N.A.success((0,p.AP)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateRole=function(e){s.updateUser("role",e.value)},s.disable2FA=function(){var e=s.state.userInfo.email;D.H.sysAdminDeleteTwoFactorAuth(e).then((function(e){var t=s.state.userInfo;t.has_default_device=!1,s.setState({userInfo:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.toggleForce2fa=function(e){var t=s.state.userInfo.email,n=e.target.checked;D.H.sysAdminSetForceTwoFactorAuth(t,n).then((function(e){var t=s.state.userInfo;t.is_force_2fa=n,s.setState({userInfo:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.translateRole=function(e){switch(e){case"default":return(0,p.AP)("Default");case"guest":return(0,p.AP)("Guest");default:return e}},s.state={loading:!0,errorMsg:"",userInfo:{}},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);D.H.sysAdminGetUser(t).then((function(t){e.setState({loading:!1,userInfo:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e,t=this,s=this.state.userInfo,r=s.role;return this.roleOptions=kt.map((function(e){return{value:e,text:t.translateRole(e),isSelected:e==r}})),e=this.roleOptions.filter((function(e){return e.isSelected}))[0]||{value:r,text:this.translateRole(r),isSelected:!0},(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wt,{currentItem:"info",email:this.props.email,userName:s.name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ct,{loading:this.state.loading,errorMsg:this.state.errorMsg,userInfo:this.state.userInfo,roleOptions:this.roleOptions,currentSelectedRoleOption:e,updateRole:this.updateRole,updateUser:this.updateUser,disable2FA:this.disable2FA,toggleForce2fa:this.toggleForce2fa})})]})})]})}}])}(l.Component),Lt=s(40898),_t=window.sysadmin.pageOptions.enableSysAdminViewRepo;L().extend(ue());var Ot=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No libraries")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Size")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Last Update")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Ut,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteRepo:e.props.deleteRepo,transferRepo:e.props.transferRepo},s)}))})]})});return r.length?i:a}}])}(l.Component),Ut=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleDeleteDialog=function(){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteRepo=function(){s.props.deleteRepo(s.props.item.id)},s.toggleTransferDialog=function(){s.setState({isTransferDialogOpen:!s.state.isTransferDialogOpen})},s.transferRepo=function(e,t){s.props.transferRepo(s.props.item.id,e,t)},s.renderRepoName=function(){var e=s.props.item;return e.name?p.am&&_t&&!e.encrypted?(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/libraries/").concat(e.id,"/"),children:e.name}):e.name:(0,p.AP)("Broken ({repo_id_placeholder})").replace("{repo_id_placeholder}",e.id)},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.AP)("Delete");break;case"Transfer":t=(0,p.AP)("Transfer")}return t},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteDialog();break;case"Transfer":s.toggleTransferDialog()}},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1,isTransferDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isTransferDialogOpen,a=m.Aq.getLibIconUrl(e),i=m.Aq.getLibIconTitle(e),o='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",c=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:a,title:i,alt:i,width:"24"})}),(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{children:L()(e.last_modified).fromNow()}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(Je.A,{operations:["Delete","Transfer"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Library"),message:c,executeOperation:this.deleteRepo,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteDialog}),r&&(0,v.jsx)(Lt.A,{itemName:e.name,onTransferRepo:this.transferRepo,canTransferToDept:!1,toggleDialog:this.toggleTransferDialog})]})}}])}(l.Component),Tt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).deleteRepo=function(e){D.H.sysAdminDeleteRepo(e).then((function(t){var n=s.state.repoList.filter((function(t){return t.id!=e}));s.setState({repoList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.transferRepo=function(e,t,n){D.H.sysAdminTransferRepo(e,t,n).then((function(t){var n=s.state.repoList.filter((function(t){return t.id!=e}));s.setState({repoList:n});var r=(0,p.AP)("Successfully transferred the library.");N.A.success(r)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",userInfo:{},repoList:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);D.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),D.H.sysAdminListReposByOwner(t).then((function(t){e.setState({loading:!1,repoList:t.data.repos})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wt,{currentItem:"owned-repos",email:this.props.email,userName:this.state.userInfo.name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ot,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList,deleteRepo:this.deleteRepo,transferRepo:this.transferRepo})})]})})]})}}])}(l.Component),Rt=window.sysadmin.pageOptions.enableSysAdminViewRepo;L().extend(ue());var Ft=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center mt-4",children:s});var r=(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Share From")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Size")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Last Update")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Et,{item:e},t)}))})]});return n.length?r:(0,v.jsx)(pe.A,{text:(0,p.AP)("No libraries")})}}])}(l.Component),Et=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1})},s.renderRepoName=function(){var e=s.props.item;return e.name?p.am&&Rt&&!e.encrypted?(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/libraries/").concat(e.id,"/"),children:e.name}):e.name:(0,p.AP)("Broken ({repo_id_placeholder})").replace("{repo_id_placeholder}",e.id)},s.getOwnerLink=function(){var e,t=s.props.item,n=t.owner_email.indexOf("@seafile_group");if(-1==n)e=(0,v.jsx)(Se,{email:t.owner_email,name:t.owner_name});else{var r=t.owner_email.substring(0,n);e=(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/groups/").concat(r,"/libraries/"),children:t.owner_name})}return e},s.state={isHighlighted:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=m.Aq.getLibIconUrl(e),s=m.Aq.getLibIconTitle(e),n=this.state.isHighlighted;return(0,v.jsxs)("tr",{className:ge()({"tr-highlight":n}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:t,title:s,alt:s,width:"24"})}),(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:this.getOwnerLink()}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{children:L()(e.last_modify).fromNow()})]})}}])}(l.Component),Bt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).state={loading:!0,errorMsg:"",userInfo:{},repoList:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);D.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),D.H.sysAdminListShareInRepos(t).then((function(t){e.setState({loading:!1,repoList:t.data.repo_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wt,{currentItem:"shared-repos",email:this.props.email,userName:this.state.userInfo.name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ft,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList})})]})})]})}}])}(l.Component),zt=Bt,qt=s(91611),Ht=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No shared links")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Size")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Type")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Visits")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Yt,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteItem:e.props.deleteItem},s)}))})]})});return r.length?i:a}}])}(l.Component),Yt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleLinkDialog=function(){s.setState({isLinkDialogOpen:!s.state.isLinkDialogOpen})},s.deleteItem=function(){s.props.deleteItem(s.props.item)},s.translateOperations=function(e){var t="";switch(e){case"View":t=(0,p.AP)("View");break;case"Delete":t=(0,p.AP)("Delete")}return t},s.onMenuItemClick=function(e){switch(e){case"View":s.toggleLinkDialog();break;case"Delete":s.deleteItem()}},s.getRoleText=function(){var e;switch(s.props.item.role){case"Owner":e=(0,p.AP)("Owner");break;case"Admin":e=(0,p.AP)("Admin");break;case"Member":e=(0,p.AP)("Member")}return e},s.getIconUrl=function(){var e=s.props.item;return"upload"==e.type||e.is_dir?m.Aq.getFolderIconUrl():m.Aq.getFileIconUrl(e.obj_name)},s.state={isOpIconShown:!1,highlight:!1,isLinkDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isLinkDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:this.getIconUrl(),alt:"",width:"24"})}),(0,v.jsx)("td",{children:"/"==e.obj_name?e.repo_name:e.obj_name}),"upload"==e.type?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("td",{}),(0,v.jsx)("td",{children:(0,p.AP)("Upload")})]}):(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("td",{children:e.is_dir?null:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{children:(0,p.AP)("Download")})]}),(0,v.jsx)("td",{children:e.view_cnt}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(Je.A,{operations:["View","Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(qt.A,{link:e.link,toggleDialog:this.toggleLinkDialog})]})}}])}(l.Component),Gt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).deleteItem=function(e){var t=e.type,n=e.token;"download"==t?D.H.sysAdminDeleteShareLink(n).then((function(e){var t=s.state.shareLinkItems.filter((function(e){return e.token!=n}));s.setState({shareLinkItems:t}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)})):D.H.sysAdminDeleteUploadLink(n).then((function(e){var t=s.state.uploadLinkItems.filter((function(e){return e.token!=n}));s.setState({uploadLinkItems:t}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",userInfo:{},uploadLinkItems:[],shareLinkItems:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);D.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),D.H.sysAdminListShareLinksByUser(t).then((function(t){var s=t.data.share_link_list.map((function(e){return e.type="download",e}));s.sort((function(e,t){return e.is_dir?-1:1})),e.setState({loading:!1,shareLinkItems:s})})),D.H.sysAdminListUploadLinksByUser(t).then((function(t){var s=t.data.upload_link_list.map((function(e){return e.type="upload",e}));e.setState({loading:!1,uploadLinkItems:s})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.shareLinkItems,s=e.uploadLinkItems;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wt,{currentItem:"links",email:this.props.email,userName:this.state.userInfo.name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ht,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:[].concat(s,t),deleteItem:this.deleteItem})})]})})]})}}])}(l.Component),Qt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No groups")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Role")}),(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Created At")})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Vt,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem},s)}))})]})});return r.length?i:a}}])}(l.Component),Vt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.getRoleText=function(){var e;switch(s.props.item.role){case"Owner":e=(0,p.AP)("Owner");break;case"Admin":e=(0,p.AP)("Admin");break;case"Member":e=(0,p.AP)("Member")}return e},s.state={highlight:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t="".concat(p.Yc,"sys/groups/").concat(e.id,"/libraries/");return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:t,children:e.name})}),(0,v.jsx)("td",{children:this.getRoleText()}),(0,v.jsx)("td",{children:L()(e.created_at).format("YYYY-MM-DD HH:mm")})]})})}}])}(l.Component),Wt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).state={loading:!0,errorMsg:"",userInfo:{},items:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=decodeURIComponent(this.props.email);D.H.sysAdminGetUser(t).then((function(t){e.setState({userInfo:t.data})})),D.H.sysAdminListGroupsJoinedByUser(t).then((function(t){e.setState({loading:!1,items:t.data.group_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(wt,{currentItem:"groups",email:this.props.email,userName:this.state.userInfo.name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Qt,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.items})})]})})]})}}])}(l.Component),Kt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleRepoNameChange=function(e){var t=e.target.value;s.setState({repoName:t,isSubmitBtnActive:t.trim()})},s.handleSubmit=function(){var e=s.state,t=e.repoName,n=e.selectedUsers;s.props.createRepo(t.trim(),n[0].email),s.toggle()},s.handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.toggle=function(){s.props.toggleDialog()},s.state={repoName:"",selectedUsers:[],errMessage:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,autoFocus:!1,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("New Library")}),(0,v.jsxs)(be.A,{children:[(0,v.jsxs)(Le.A,{children:[(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{for:"repoName",children:(0,p.AP)("Name")}),(0,v.jsx)(Q.A,{id:"repoName",onKeyDown:this.handleKeyDown,value:this.state.repoName,onChange:this.handleRepoNameChange,autoFocus:!0})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsxs)(Oe.A,{for:"userSelect",children:[(0,p.AP)("Owner"),(0,v.jsx)("span",{className:"small text-secondary ml-1",children:(0,p.AP)("(If left blank, owner will be admin)")})]}),(0,v.jsx)(Be.A,{id:"userSelect",isMulti:!1,placeholder:(0,p.AP)("Select a user"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})]})]}),this.state.errMessage&&(0,v.jsx)(Ie.A,{color:"danger",children:this.state.errMessage})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),Xt=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"all",urlPart:"all-libraries",text:(0,p.AP)("All")},{name:"wikis",urlPart:"all-wikis",text:(0,p.AP)("Wikis")},{name:"system",urlPart:"system-library",text:(0,p.AP)("System")},{name:"trash",urlPart:"trash-libraries",text:(0,p.AP)("Trash")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component),$t=Xt,Jt=s(40866),Zt=s(73606),es=s(78125),ts=s(35746),ss=s(55909),ns=s(38906),rs=s(10322),as=s(89470),is=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onMouseEnter=function(){s.setState({isOperationShow:!0})},s.onMouseLeave=function(){s.setState({isOperationShow:!1})},s.deleteShareItem=function(){var e=s.props.item;s.props.deleteShareItem(e.user_email)},s.onChangeUserPermission=function(e){var t=s.props.item;s.props.onChangeUserPermission(t,e)},s.state={isOperationShow:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=m.Aq.getSharedPermission(e);return(0,v.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{className:"name",children:e.user_name}),(0,v.jsx)("td",{children:(0,v.jsx)(as.A,{repoID:e.repo_id,isTextMode:!0,autoFocus:!0,isEditIconShow:this.state.isOperationShow,currentPermission:t,permissions:this.props.permissions,onPermissionChanged:this.onChangeUserPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"sf2-icon-x3 action-icon ".concat(this.state.isOperationShow?"":"hide"),onClick:this.deleteShareItem,title:(0,p.AP)("Delete")})})]})}}])}(l.Component),os=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props.items;return(0,v.jsx)("tbody",{children:t.map((function(t,s){return(0,v.jsx)(is,{item:t,permissions:e.props.permissions,deleteShareItem:e.props.deleteShareItem,onChangeUserPermission:e.props.onChangeUserPermission},s)}))})}}])}(l.Component),ls=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e}),s.options=[]},s.setPermission=function(e){s.setState({permission:e})},s.shareToUser=function(){var e=[],t=s.props.repoID;if(s.state.selectedUsers&&s.state.selectedUsers.length>0)for(var n=0;n<s.state.selectedUsers.length;n++)e[n]=s.state.selectedUsers[n].email;D.H.sysAdminAddRepoSharedItem(t,"user",e,s.state.permission).then((function(e){var t=[];if(e.data.failed.length>0)for(var n=0;n<e.data.failed.length;n++)t[n]=e.data.failed[n];var r=e.data.success;s.setState({errorMsg:t,sharedItems:s.state.sharedItems.concat(r),selectedUsers:[],permission:"rw"})})).catch((function(e){if(e.response){var t=(0,p.AP)("Library can not be shared to owner."),n=[];n.push(t),s.setState({errorMsg:n,selectedUsers:[]})}}))},s.deleteShareItem=function(e){var t=s.props.repoID;D.H.sysAdminDeleteRepoSharedItem(t,"user",e).then((function(t){s.setState({sharedItems:s.state.sharedItems.filter((function(t){return t.user_email!==e}))})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.onChangeUserPermission=function(e,t){var n=s.props.repoID,r=e.user_email;D.H.sysAdminUpdateRepoSharedItemPermission(n,"user",r,t).then((function(){s.updateSharedItems(e,t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateSharedItems=function(e,t){var n=e.user_name,r=s.state.sharedItems.map((function(e){var s=e.user_name;return n===s&&(e.permission=t,e.is_admin="admin"===t),e}));s.setState({sharedItems:r})},s.state={selectedUsers:[],errorMsg:[],permission:"rw",sharedItems:[],isLoading:!0},s.options=[],s.permissions=["rw","r"],p.am&&s.permissions.push("admin","cloud-edit","preview"),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.repoID;D.H.sysAdminListRepoSharedItems(t,"user").then((function(t){0!==t.data.length?e.setState({sharedItems:t.data,isLoading:!1}):e.setState({isLoading:!1})})).catch((function(t){e.setState({isLoading:!1});var s=m.Aq.getErrorMsg(t);N.A.danger(s)}))}},{key:"render",value:function(){var e=this.state.sharedItems;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.AP)("User")}),(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsxs)("tbody",{children:[(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(Be.A,{isMulti:!0,placeholder:(0,p.AP)("Search users"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsx)("td",{children:(0,v.jsx)(as.A,{repoID:this.props.repoID,isTextMode:!1,isEditIconShow:!1,currentPermission:this.state.permission,permissions:this.permissions,onPermissionChanged:this.setPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.shareToUser,children:(0,p.AP)("Submit")})})]}),this.state.errorMsg.length>0&&this.state.errorMsg.map((function(e,t){var s="";return s=e.email?e.email+": "+e.error_msg:e,(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:3,children:(0,v.jsx)("p",{className:"error",children:s})})},t)}))]})]}),(0,v.jsx)("div",{className:"share-list-container",children:this.state.isLoading?(0,v.jsx)(w.A,{}):(0,v.jsx)(v.Fragment,{children:0===this.state.sharedItems.length?(0,v.jsx)(pe.A,{text:(0,p.AP)("No share link"),className:"mt-8 mb-8"}):(0,v.jsxs)("table",{className:"table-thead-hidden",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.AP)("User")}),(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsx)(os,{items:e,permissions:this.permissions,deleteShareItem:this.deleteShareItem,onChangeUserPermission:this.onChangeUserPermission})]})})})]})}}])}(l.Component),cs=ls,ds=s(97011),us=s(78405),hs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onMouseEnter=function(){s.setState({isOperationShow:!0})},s.onMouseLeave=function(){s.setState({isOperationShow:!1})},s.deleteShareItem=function(){var e=s.props.item;s.props.deleteShareItem(e.group_id)},s.onChangeUserPermission=function(e){var t=s.props.item;s.props.onChangeUserPermission(t,e)},s.state={isOperationShow:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=m.Aq.getSharedPermission(e);return(0,v.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{className:"name",children:e.group_name}),(0,v.jsx)("td",{children:(0,v.jsx)(as.A,{repoID:e.repo_id,isTextMode:!0,autoFocus:!0,isEditIconShow:this.state.isOperationShow,currentPermission:t,permissions:this.props.permissions,onPermissionChanged:this.onChangeUserPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"sf2-icon-x3 action-icon ".concat(this.state.isOperationShow?"":"hide"),onClick:this.deleteShareItem,title:(0,p.AP)("Delete")})})]})}}])}(l.Component),gs=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props.items;return(0,v.jsx)("tbody",{children:t.map((function(t,s){return(0,v.jsx)(hs,{item:t,permissions:e.props.permissions,deleteShareItem:e.props.deleteShareItem,onChangeUserPermission:e.props.onChangeUserPermission},s)}))})}}])}(l.Component),ps=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).loadOptions=function(){ds.e.shareableGroups().then((function(e){s.options=[];for(var t=0;t<e.data.length;t++){var n={};n.name=e.data[t].name,n.value=e.data[t].name,n.id=e.data[t].id,n.label=e.data[t].name,s.options.push(n)}})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.onSelectOption=function(e){var t=s.state.selectedOptions.slice(0),n=t.findIndex((function(t){return t.id===e.id}));n>-1?t.splice(n,1):t.push(e),s.setState({selectedOptions:t})},s.onDeleteOption=function(e){var t=s.state.selectedOptions.slice(0),n=t.findIndex((function(t){return t.id===e.id}));n>-1&&t.splice(n,1),s.setState({selectedOptions:t})},s.listSharedGroups=function(){var e=s.props.repoID;D.H.sysAdminListRepoSharedItems(e,"group").then((function(e){0!==e.data.length?s.setState({sharedItems:e.data,isLoading:!1}):s.setState({isLoading:!1})})).catch((function(e){s.setState({isLoading:!1});var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.setPermission=function(e){s.setState({permission:e})},s.shareToGroup=function(){var e=s.props.repoID,t=s.state.selectedOptions;if(0!==t.length){var n=t.map((function(e){return e.id}));D.H.sysAdminAddRepoSharedItem(e,"group",n,s.state.permission).then((function(e){var t=[];if(e.data.failed.length>0)for(var n=0;n<e.data.failed.length;n++)t[n]=e.data.failed[n];var r=e.data.success;s.setState({errorMsg:t,sharedItems:s.state.sharedItems.concat(r),selectedOptions:[],permission:"rw"})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}},s.deleteShareItem=function(e){var t=s.props.repoID;D.H.sysAdminDeleteRepoSharedItem(t,"group",e).then((function(){s.setState({sharedItems:s.state.sharedItems.filter((function(t){return t.group_id!==e}))})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.onChangeUserPermission=function(e,t){var n=s.props.repoID,r=e.group_id;D.H.sysAdminUpdateRepoSharedItemPermission(n,"group",r,t).then((function(){s.updateSharedItems(e,t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateSharedItems=function(e,t){var n=e.group_id,r=s.state.sharedItems.map((function(e){var s=e.group_id;return n===s&&(e.permission=t,e.is_admin="admin"===t),e}));s.setState({sharedItems:r})},s.state={selectedOptions:[],errorMsg:[],permission:"rw",sharedItems:[],isLoading:!0},s.options=[],s.permissions=["rw","r"],p.am&&s.permissions.push("admin","cloud-edit","preview"),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.loadOptions(),this.listSharedGroups()}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.AP)("Group")}),(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsxs)("tbody",{children:[(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(us.A,{selectedOptions:this.state.selectedOptions,options:this.options,onSelectOption:this.onSelectOption,onDeleteOption:this.onDeleteOption,searchPlaceholder:(0,p.AP)("Search groups"),noOptionsPlaceholder:(0,p.AP)("No results"),isInModal:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)(as.A,{repoID:this.props.repoID,isTextMode:!1,isEditIconShow:!1,currentPermission:this.state.permission,permissions:this.permissions,onPermissionChanged:this.setPermission,isSysAdmin:!0})}),(0,v.jsx)("td",{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.shareToGroup,children:(0,p.AP)("Submit")})})]}),this.state.errorMsg.length>0&&this.state.errorMsg.map((function(e,t){var s=e.group_name+": "+e.error_msg;return(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:3,children:(0,v.jsx)("p",{className:"error",children:s})})},t)}))]})]}),(0,v.jsx)("div",{className:"share-list-container",children:this.state.isLoading?(0,v.jsx)(w.A,{}):(0,v.jsx)(v.Fragment,{children:0===this.state.sharedItems.length?(0,v.jsx)(pe.A,{text:(0,p.AP)("No share link"),className:"mt-8 mb-8"}):(0,v.jsxs)("table",{className:"table-thead-hidden",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"50%",children:(0,p.AP)("Group")}),(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Permission")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsx)(gs,{items:this.state.sharedItems,permissions:this.permissions,deleteShareItem:this.deleteShareItem,onChangeUserPermission:this.onChangeUserPermission})]})})})]})}}])}(l.Component),ms=(s(59625),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getInitialActiveTab=function(){return"shareToUser"},s.toggle=function(e){s.state.activeTab!==e&&s.setState({activeTab:e})},s.renderDirContent=function(){var e=s.state.activeTab,t=s.props,n=t.enableDirPrivateShare,r=t.isGroupOwnedRepo;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("div",{className:"share-dialog-side",children:(0,v.jsx)(es.A,{pills:!0,children:n&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(ts.A,{children:(0,v.jsx)(ss.A,{className:"shareToUser"===e?"active":"",onClick:s.toggle.bind(s,"shareToUser"),children:(0,p.AP)("Share to user")})}),(0,v.jsx)(ts.A,{children:(0,v.jsx)(ss.A,{className:"shareToGroup"===e?"active":"",onClick:s.toggle.bind(s,"shareToGroup"),children:(0,p.AP)("Share to group")})})]})})}),(0,v.jsx)("div",{className:"share-dialog-main",children:(0,v.jsx)(ns.A,{activeTab:s.state.activeTab,children:n&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(rs.A,{tabId:"shareToUser",children:(0,v.jsx)(cs,{itemType:"library",isGroupOwnedRepo:r,itemPath:s.props.itemPath,repoID:s.props.repoID,isRepoOwner:s.state.isRepoOwner})}),(0,v.jsx)(rs.A,{tabId:"shareToGroup",children:(0,v.jsx)(ps,{itemType:"library",isGroupOwnedRepo:r,itemPath:s.props.itemPath,repoID:s.props.repoID,isRepoOwner:s.state.isRepoOwner})})]})})})]})},s.state={activeTab:s.getInitialActiveTab(),isRepoOwner:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsx)("div",{children:(0,v.jsxs)(u.A,{isOpen:!0,style:p.zG,className:"share-dialog",toggle:this.props.toggleDialog,children:[(0,v.jsxs)(Ce.A,{toggle:this.props.toggleDialog,children:[(0,p.AP)("Share")," ",(0,v.jsx)("span",{className:"op-target",title:this.props.itemName,children:this.props.itemName})]}),(0,v.jsx)(be.A,{className:"share-dialog-content",children:this.renderDirContent()})]})})}}])}(l.Component)),fs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).submit=function(){var e=s.state.keepDays;s.state.autoHistory&&(e=s.state.expireDays);var t=s.props.repoID;if(s.state.autoHistory&&Number(e)<=0)s.setState({errorInfo:(0,p.AP)("Please enter a non-negative integer")});else{var n=(0,p.AP)("Successfully set library history.");D.H.sysAdminUpdateRepoHistorySetting(t,parseInt(e)).then((function(e){N.A.success(n),s.setState({keepDays:e.data.keep_days}),s.props.toggleDialog()})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}},s.handleKeyDown=function(e){"Enter"===e.key&&(s.submit(),e.preventDefault())},s.onChange=function(e){var t=e.target.value;s.setState({keepDays:t,expireDays:t})},s.setLimitDays=function(e){"allHistory"===e?s.setState({keepDays:-1}):"noHistory"===e?s.setState({keepDays:0}):s.setState({disabled:!1}),s.setState({allHistory:"allHistory"===e,noHistory:"noHistory"===e,autoHistory:"autoHistory"===e})},s.state={keepDays:-1,expireDays:30,disabled:!0,allHistory:!0,noHistory:!1,autoHistory:!1,errorInfo:""},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetRepoHistorySetting(this.props.repoID).then((function(t){e.setState({keepDays:t.data.keep_days,allHistory:t.data.keep_days<0,noHistory:0===t.data.keep_days,autoHistory:t.data.keep_days>0,disabled:!(t.data.keep_days>0),expireDays:t.data.keep_days>0?t.data.keep_days:30})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}},{key:"render",value:function(){var e=this,t=this.props.itemName,s=(0,p.AP)("{placeholder} History Setting");return s=s.replace("{placeholder}",'<span class="op-target text-truncate mx-1">'+m.Aq.HTMLescape(t)+"</span>"),(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggleDialog,children:(0,v.jsx)("span",{dangerouslySetInnerHTML:{__html:s},className:"d-flex mw-100"})}),(0,v.jsx)(be.A,{children:(0,v.jsxs)(Le.A,{children:[(0,v.jsxs)(_e.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"radio",name:"radio1",checked:this.state.allHistory,onChange:function(){e.setLimitDays("allHistory")}})," ",(0,v.jsx)(Oe.A,{children:(0,p.AP)("Keep full history")})]}),(0,v.jsxs)(_e.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"radio",name:"radio1",checked:this.state.noHistory,onChange:function(){e.setLimitDays("noHistory")}})," ",(0,v.jsx)(Oe.A,{children:(0,p.AP)("Don't keep history")})]}),(0,v.jsxs)(_e.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"radio",name:"radio1",checked:this.state.autoHistory,onChange:function(){e.setLimitDays("autoHistory")}})," ",(0,v.jsx)(Oe.A,{children:(0,p.AP)("Only keep a period of history:")}),(0,v.jsx)(Q.A,{type:"text",className:"expire-input",value:this.state.expireDays,onChange:this.onChange,disabled:this.state.disabled,onKeyDown:this.handleKeyDown})," ",(0,v.jsx)(Oe.A,{children:(0,v.jsx)("span",{children:(0,p.AP)("days")})})]}),this.state.errorInfo&&(0,v.jsx)(Ie.A,{color:"danger",children:this.state.errorInfo})]})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.submit,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),xs=window.sysadmin.pageOptions.enableSysAdminViewRepo,vs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.sortByFileCount=function(e){e.preventDefault(),s.props.sortItems("file_count")},s.sortBySize=function(e){e.preventDefault(),s.props.sortItems("size")},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.pageInfo,i=t.curPerPage,o=t.sortBy;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var c=(0,v.jsx)(pe.A,{text:(0,p.AP)("No libraries")}),d=(0,v.jsx)("span",{className:"sf3-font sf3-font-sort3"}),u=(0,v.jsx)("span",{className:"sf3-font sf3-font-down"}),h=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"15%",children:void 0!=o?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("a",{className:"d-inline-block table-sort-op",href:"#",onClick:this.sortByFileCount,children:[(0,p.AP)("Files")," ","file_count"==o?u:d]})," / ",(0,v.jsxs)("a",{className:"d-inline-block table-sort-op",href:"#",onClick:this.sortBySize,children:[(0,p.AP)("Size")," ","size"==o?u:d]})]}):(0,v.jsxs)(v.Fragment,{children:[(0,p.AP)("Files")," / ",(0,p.AP)("Size")]})}),(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("th",{width:"32%",children:"ID"}),(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"5%"})]})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(As,{repo:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,onDeleteRepo:e.props.onDeleteRepo,onTransferRepo:e.props.onTransferRepo,isWiki:e.props.isWiki},s)}))})]}),a&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:a.current_page,hasNextPage:a.has_next_page,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?h:c}}])}(l.Component),As=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onDeleteRepo=function(e){D.H.sysAdminDeleteRepo(e.id).then((function(t){s.props.onDeleteRepo(e),s.setState({isDeleteDialogOpen:!1,isRepoDeleted:!0});var n=(0,p.AP)("Successfully deleted {name}.").replace("{name}",e.name);N.A.success(n)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t),s.setState({isRepoDeleted:!1})}))},s.onTransferRepo=function(e,t){D.H.sysAdminTransferRepo(s.props.repo.id,e,t).then((function(e){s.props.onTransferRepo(e.data);var t=(0,p.AP)("Successfully transferred the library.");N.A.success(t)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.handleMouseOver=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseOut=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){switch(e){case"Share":s.toggleShareDialog();break;case"Delete":s.toggleDeleteDialog();break;case"Transfer":s.toggleTransferDialog();break;case"History Setting":s.toggleHistorySettingDialog()}},s.toggleShareDialog=function(){s.setState({isShareDialogOpen:!s.state.isShareDialogOpen})},s.toggleDeleteDialog=function(){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleTransferDialog=function(){s.setState({isTransferDialogOpen:!s.state.isTransferDialogOpen})},s.toggleHistorySettingDialog=function(){s.setState({isHistorySettingDialogOpen:!s.state.isHistorySettingDialogOpen})},s.renderRepoName=function(){var e=s.props.repo;return e.name?p.am&&xs&&!e.encrypted?(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/libraries/").concat(e.id,"/"),children:e.name}):e.name:"--"},s.translateOperations=function(e){var t="";switch(e){case"Share":t=(0,p.AP)("Share");break;case"Delete":t=(0,p.AP)("Delete");break;case"Transfer":t=(0,p.AP)("Transfer");break;case"History Setting":t=(0,p.AP)("History Setting")}return t},s.getOperations=function(){var e=s.props.repo;if(s.props.isWiki)return["Delete"];var t=["Delete","Transfer"];return-1!=e.owner_email.indexOf("@seafile_group")?t=["Transfer"]:(e.encrypted||t.push("Share"),t.push("History Setting"),t)},s.state={isOpIconShown:!1,highlight:!1,isShareDialogOpen:!1,isDeleteDialogOpen:!1,isTransferDialogOpen:!1,isHistorySettingDialogOpen:!1,isRepoDeleted:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e,t=this.props.repo,s=this.state,n=s.isOpIconShown,r=s.isShareDialogOpen,a=s.isDeleteDialogOpen,i=s.isTransferDialogOpen,o=s.isHistorySettingDialogOpen,c=m.Aq.getLibIconUrl(t),d=m.Aq.getLibIconTitle(t),u=t.owner_email.indexOf("@seafile_group"),g=-1!=u;g&&(e=t.owner_email.substring(0,u));var f="";return this.props.isWiki&&(f=this.renderRepoName(),t.is_published&&(f=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:f}),(0,v.jsx)("a",{href:t.public_url,target:"_blank",rel:"noreferrer",children:"(Published)"})]}))),(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:c,title:d,alt:d,width:"24"})}),this.props.isWiki?(0,v.jsx)("td",{children:f}):(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:"".concat(t.file_count," / ").concat(m.Aq.bytesToSize(t.size))}),(0,v.jsx)("td",{children:t.id}),(0,v.jsx)("td",{children:g?(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/groups/").concat(e,"/libraries/"),children:t.owner_name}):(0,v.jsx)(Se,{email:t.owner_email,name:t.owner_name})}),(0,v.jsx)("td",{children:n&&(0,v.jsx)(Je.A,{operations:this.getOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),r&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(ms,{itemName:t.name,itemPath:"/",repoID:t.id,isGroupOwnedRepo:g,repoEncrypted:t.encrypted,enableDirPrivateShare:!0,userPerm:t.permission,toggleDialog:this.toggleShareDialog})}),a&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Zt.A,{repo:t,isRepoDeleted:this.state.isRepoDeleted,onDeleteRepo:this.onDeleteRepo,toggle:this.toggleDeleteDialog,isGetShare:!1})}),i&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Lt.A,{itemName:t.name,onTransferRepo:this.onTransferRepo,toggleDialog:this.toggleTransferDialog,isSysAdmin:!0})}),o&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(fs,{repoID:t.id,itemName:t.name,toggleDialog:this.toggleHistorySettingDialog})})]})}}])}(l.Component),js=vs,Ps=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleCreateRepoDialog=function(){s.setState({isCreateRepoDialogOpen:!s.state.isCreateRepoDialogOpen})},s.getReposByPage=function(e){var t=s.state,n=t.perPage,r=t.sortBy;D.H.sysAdminListAllRepos(e,n,r).then((function(e){s.setState({loading:!1,repos:e.data.repos,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.sortItems=function(e){s.setState({currentPage:1,sortBy:e},(function(){var e=new URL(location.href),t=new URLSearchParams(e.search),n=s.state,r=n.currentPage,a=n.sortBy;t.set("page",r),t.set("order_by",a),e.search=t.toString(),(0,h.oo)(e.toString()),s.getReposByPage(r)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getReposByPage(1)}))},s.createRepo=function(e,t){D.H.sysAdminCreateRepo(e,t).then((function(e){s.state.repos.unshift(e.data),s.setState({repos:s.state.repos})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.onDeleteRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.onTransferRepo=function(e){var t=s.state.repos.map((function(t){return t.id==e.id?e:t}));s.setState({repos:t})},s.getSearch=function(){return(0,v.jsx)(Ge.A,{placeholder:(0,p.AP)("Search libraries by name or ID"),submit:s.searchRepos})},s.searchRepos=function(e){s.getValueLength(e)<3?N.A.notify((0,p.AP)("Required at least three letters.")):(0,h.oo)("".concat(p.Yc,"sys/search-libraries/?name_or_id=").concat(encodeURIComponent(e)))},s.state={loading:!0,errorMsg:"",repos:[],pageInfo:{},perPage:100,sortBy:"",isCreateRepoDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,a=s.perPage,i=s.sortBy;this.setState({sortBy:t.get("order_by")||i,perPage:parseInt(t.get("per_page")||a),currentPage:parseInt(t.get("page")||r)},(function(){e.getReposByPage(e.state.currentPage)}))}},{key:"getValueLength",value:function(e){for(var t,s=0,n=0,r=e.length;n<r;n++)10===(t=e.charCodeAt(n))?s+=2:t<127?s+=1:t>=128&&t<=2047?s+=2:t>=2048&&t<=65535&&(s+=3);return s}},{key:"render",value:function(){var e=this.state.isCreateRepoDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:this.getSearch()},this.props),{},{children:(0,v.jsxs)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleCreateRepoDialog,children:[(0,v.jsx)("i",{className:"sf3-font sf3-font-enlarge text-secondary mr-1"}),(0,p.AP)("New Library")]})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)($t,{currentItem:"all"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(js,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repos,sortBy:this.state.sortBy,sortItems:this.sortItems,pageInfo:this.state.pageInfo,curPerPage:this.state.perPage,getListByPage:this.getReposByPage,resetPerPage:this.resetPerPage,onDeleteRepo:this.onDeleteRepo,onTransferRepo:this.onTransferRepo})})]})}),e&&(0,v.jsx)(Kt,{createRepo:this.createRepo,toggleDialog:this.toggleCreateRepoDialog})]})}}])}(l.Component),Ss=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getWikisByPage=function(e){var t=s.state,n=t.perPage,r=t.sortBy;D.H.sysAdminListAllWikis(e,n,r).then((function(e){s.setState({loading:!1,wikis:e.data.wikis,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.sortItems=function(e){s.setState({currentPage:1,sortBy:e},(function(){var e=new URL(location.href),t=new URLSearchParams(e.search),n=s.state,r=n.currentPage,a=n.sortBy;t.set("page",r),t.set("order_by",a),e.search=t.toString(),(0,h.oo)(e.toString()),s.getWikisByPage(r)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getWikisByPage(1)}))},s.onDeleteWiki=function(e){var t=s.state.wikis.filter((function(t){return t.id!=e.id}));s.setState({wikis:t})},s.onTransferWiki=function(e){var t=s.state.wikis.map((function(t){return t.id==e.id?e:t}));s.setState({wikis:t})},s.state={loading:!0,errorMsg:"",wikis:[],pageInfo:{},perPage:100,sortBy:""},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,a=s.perPage,i=s.sortBy;this.setState({sortBy:t.get("order_by")||i,perPage:parseInt(t.get("per_page")||a),currentPage:parseInt(t.get("page")||r)},(function(){e.getWikisByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)($t,{currentItem:"wikis"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(js,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.wikis,sortBy:this.state.sortBy,sortItems:this.sortItems,pageInfo:this.state.pageInfo,curPerPage:this.state.perPage,getListByPage:this.getWikisByPage,resetPerPage:this.resetPerPage,onDeleteRepo:this.onDeleteWiki,onTransferRepo:this.onTransferWiki,isWiki:!0})})]})})]})}}])}(l.Component),ys=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items;return t?(0,v.jsx)(w.A,{}):s?(0,v.jsx)("p",{className:"error text-center",children:s}):(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"33%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"34%",children:"ID"}),(0,v.jsx)("th",{width:"33%",children:(0,p.AP)("Description")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Ds,{item:e},t)}))})]})})}}])}(l.Component),Ds=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/libraries/").concat(e.id,"/"),children:e.name})}),(0,v.jsx)("td",{children:e.id}),(0,v.jsx)("td",{children:e.description})]})}}])}(l.Component),Ns=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).state={loading:!0,errorMsg:"",items:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetSystemRepoInfo().then((function(t){var s=[];s.push(t.data),e.setState({items:s,loading:!1})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)($t,{currentItem:"system"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ys,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.items})})]})})]})}}])}(l.Component),ws=window.sysadmin.pageOptions.trashReposExpireDays;L().extend(ue());var bs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.pageInfo,i=t.curPerPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No deleted libraries")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("p",{className:"mt-4 small text-secondary",children:(0,p.AP)("Tip: libraries deleted {trashReposExpireDays} days ago will be cleaned automatically.").replace("{trashReposExpireDays}",ws)}),(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"43%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"27%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Deleted Time")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Is,{repo:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,onDeleteRepo:e.props.onDeleteRepo,onRestoreRepo:e.props.onRestoreRepo},s)}))})]}),a&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:a.current_page,hasNextPage:a.has_next_page,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?c:o}}])}(l.Component),Is=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,isHighlighted:!0})},s.handleMouseOut=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,isHighlighted:!1})},s.onUnfreezedItem=function(){s.setState({isHighlighted:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onDeleteRepo=function(){var e=s.props.repo;D.H.sysAdminDeleteTrashRepo(e.id).then((function(t){s.props.onDeleteRepo(e);var n=(0,p.AP)("Successfully deleted {name}.").replace("{name}",e.name);N.A.success(n)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.onRestoreRepo=function(){var e=s.props.repo;D.H.sysAdminRestoreTrashRepo(e.id).then((function(t){s.props.onRestoreRepo(e);var n=(0,p.AP)("Successfully restored the library.");N.A.success(n)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.toggleDeleteRepoDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteRepoDialogOpen:!s.state.isDeleteRepoDialogOpen})},s.toggleRestoreRepoDialog=function(e){e&&e.preventDefault(),s.setState({isRestoreRepoDialogOpen:!s.state.isRestoreRepoDialogOpen})},s.translateOperations=function(e){var t="";switch(e){case"Restore":t=(0,p.AP)("Restore");break;case"Delete":t=(0,p.AP)("Delete")}return t},s.onMenuItemClick=function(e){switch(e){case"Restore":s.toggleRestoreRepoDialog();break;case"Delete":s.toggleDeleteRepoDialog()}},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteRepoDialogOpen:!1,isRestoreRepoDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.repo,t=this.state,s=t.isOpIconShown,n=t.isDeleteRepoDialogOpen,r=t.isRestoreRepoDialogOpen,a=t.isHighlighted,i=m.Aq.getLibIconUrl(e),o=m.Aq.getLibIconTitle(e),c='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>";return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:ge()({"tr-highlight":a}),onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:i,title:o,alt:o,width:"24"})}),(0,v.jsx)("td",{children:e.name}),(0,v.jsx)("td",{children:-1==e.owner.indexOf("@seafile_group")?(0,v.jsx)(Se,{email:e.owner,name:e.owner_name}):e.group_name}),(0,v.jsx)("td",{children:L()(e.delete_time).fromNow()}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(Je.A,{operations:["Restore","Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Library"),message:(0,p.AP)("Are you sure you want to delete {placeholder} completely?").replace("{placeholder}",c),executeOperation:this.onDeleteRepo,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteRepoDialog})}),r&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(qe.A,{title:(0,p.AP)("Restore Library"),message:(0,p.AP)("Are you sure you want to restore {placeholder}?").replace("{placeholder}",c),executeOperation:this.onRestoreRepo,confirmBtnText:(0,p.AP)("Restore"),toggleDialog:this.toggleRestoreRepoDialog})})]})}}])}(l.Component),ks=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleCleanTrashDialog=function(){s.setState({isCleanTrashDialogOpen:!s.state.isCleanTrashDialogOpen})},s.getReposByPage=function(e){var t=s.state.perPage;D.H.sysAdminListTrashRepos(e,t).then((function(e){s.setState({repos:e.data.repos,pageInfo:e.data.page_info,loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getReposByPage(1)}))},s.onDeleteRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.onRestoreRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.cleanTrash=function(){D.H.sysAdminCleanTrashRepos().then((function(e){s.setState({repos:[]}),N.A.success((0,p.AP)("Successfully cleared trash."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.getSearch=function(){return(0,v.jsx)(Ge.A,{placeholder:(0,p.AP)("Search libraries by owner"),submit:s.searchRepos})},s.searchRepos=function(e){D.H.sysAdminSearchTrashRepos(e).then((function(e){s.setState({repos:e.data.repos,pageInfo:null,errorMsg:"",loading:!1})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.state={loading:!0,errorMsg:"",repos:[],pageInfo:{},perPage:100,isCleanTrashDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,a=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||a),currentPage:parseInt(t.get("page")||r)},(function(){e.getReposByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state.isCleanTrashDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[this.state.repos.length?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:this.toggleCleanTrashDialog,children:(0,p.AP)("Clean")})})):(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)($t,{currentItem:"trash"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(bs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repos,pageInfo:this.state.pageInfo,onDeleteRepo:this.onDeleteRepo,onRestoreRepo:this.onRestoreRepo,getListByPage:this.getReposByPage,resetPerPage:this.resetPerPage,curPerPage:this.state.perPage})})]})}),e&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Clear Trash"),message:(0,p.AP)("Are you sure you want to clear trash?"),executeOperation:this.cleanTrash,confirmBtnText:(0,p.AP)("Clear"),toggleDialog:this.toggleCleanTrashDialog})]})}}])}(l.Component),Cs=ks,Ms=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getRepos=function(e){var t=s.state,n=t.name,r=t.perPage;s.getValueLength(n)<3?N.A.notify((0,p.AP)("Required at least three letters.")):D.H.sysAdminSearchRepos(n,e,r).then((function(e){s.setState({loading:!1,errorMsg:"",repos:e.data.repo_list,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.searchRepos=function(){var e=s.state.currentPage;s.getRepos(e)},s.onDeleteRepo=function(e){var t=s.state.repos.filter((function(t){return t.id!=e.id}));s.setState({repos:t})},s.onTransferRepo=function(e){var t=s.state.repos.map((function(t){return t.id==e.id?e:t}));s.setState({repos:t})},s.handleNameInputChange=function(e){s.setState({name:e.target.value,currentPage:1},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.name;s.setState({isSubmitBtnActive:e.trim()})},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.searchRepos())},s.resetPerPage=function(e){s.setState({perPage:e,currentPage:1},(function(){s.searchRepos()}))},s.state={name:"",currentPage:1,perPage:100,isSubmitBtnActive:!1,loading:!0,errorMsg:"",repos:[],pageInfo:{}},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(document.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({name:t.get("name_or_id")||"",perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getRepos(e.state.currentPage)}))}},{key:"getValueLength",value:function(e){for(var t,s=0,n=0,r=e.length;n<r;n++)10===(t=e.charCodeAt(n))?s+=2:t<127?s+=1:t>=128&&t<=2047?s+=2:t>=2048&&t<=65535&&(s+=3);return s}},{key:"render",value:function(){var e=this.state,t=e.name,s=e.isSubmitBtnActive;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Libraries")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Search Libraries")}),(0,v.jsx)("p",{className:"text-secondary small",children:(0,p.AP)("Tip: you can search by keyword in name or ID.")}),(0,v.jsxs)(Le.A,{tag:"div",children:[(0,v.jsxs)(_e.A,{row:!0,children:[(0,v.jsx)(Oe.A,{for:"name",sm:1,children:(0,p.AP)("Name or ID")}),(0,v.jsx)(vt.A,{sm:5,children:(0,v.jsx)(Q.A,{type:"text",name:"name",id:"name",value:t,onChange:this.handleNameInputChange,onKeyDown:this.handleKeyDown})})]}),(0,v.jsx)(_e.A,{row:!0,children:(0,v.jsx)(vt.A,{sm:{size:5,offset:1},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!s,onClick:this.searchRepos,children:(0,p.AP)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Result")}),(0,v.jsx)(js,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repos,pageInfo:this.state.pageInfo,curPerPage:this.state.perPage,getListByPage:this.getRepos,resetPerPage:this.resetPerPage,onDeleteRepo:this.onDeleteRepo,onTransferRepo:this.onTransferRepo})]})]})]})})]})}}])}(l.Component),Ls=s(90287),_s=s(81617),Os=function(){return(0,a.default)((function e(t){(0,r.default)(this,e),this.name=t.obj_name,this.mtime=t.last_update,this.size=t.file_size,this.is_file=t.is_file}),[{key:"isDir",value:function(){return!this.is_file}}])}(),Us=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).onPathClick=function(t){var s=m.Aq.getEventData(t,"path");e.props.onPathClick(s)},e.turnPathToLink=function(t){var s=(t="/"===t[t.length-1]?t.slice(0,t.length-1):t).split("/"),n="";return s.map((function(t,r){return""===t?null:r===s.length-1?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("span",{className:"path-split",children:"/"}),(0,v.jsx)("span",{className:"path-file-name",children:t})]},r):(n+="/"+t,(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("span",{className:"path-split",children:"/"}),(0,v.jsx)("a",{className:"path-link","data-path":n,onClick:e.onPathClick,children:t})]},r))}))},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.isSystemRepo,s=e.currentPath,n=e.repoName,r=this.turnPathToLink(s);return(0,v.jsxs)("div",{className:"path-container",children:[t?(0,v.jsx)("a",{href:"".concat(p.Yc,"sys/system-library/"),children:(0,p.AP)("System")}):(0,v.jsx)("a",{href:"".concat(p.Yc,"sys/all-libraries/"),children:(0,p.AP)("All")}),(0,v.jsx)("span",{className:"path-split",children:"/"}),"/"===s||""===s?(0,v.jsx)("span",{className:"path-repo-name",children:n}):(0,v.jsx)("a",{className:"path-link","data-path":"/",onClick:this.onPathClick,children:n}),r]})}}])}(l.Component),Ts=Us;L().extend(ue());var Rs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.openFolder=function(){s.props.openFolder(s.props.dirent)},s.deleteDirent=function(){s.props.deleteDirent(s.props.dirent)},s.downloadDirent=function(){s.props.downloadDirent(s.props.dirent)},s.state={isHighlighted:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isHighlighted,n=this.props,r=n.dirent,a=n.fromSystemRepo,i=m.Aq.getDirentIcon(r);return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:ge()({"tr-highlight":s}),onMouseEnter:this.handleMouseOver,onMouseLeave:this.handleMouseOut,children:[(0,v.jsx)("td",{className:"text-center",children:(0,v.jsx)("img",{src:i,width:"24",alt:""})}),(0,v.jsx)("td",{children:r.is_file?r.name:(0,v.jsx)(h.N_,{to:"#",onClick:this.openFolder,children:r.name})}),(0,v.jsxs)("td",{children:[t&&a&&(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font",title:(0,p.AP)("Delete"),onClick:this.deleteDirent}),t&&r.is_file&&(0,v.jsx)("i",{className:"op-icon sf3-font sf3-font-download1",title:(0,p.AP)("Download"),onClick:this.downloadDirent})]}),(0,v.jsx)("td",{children:r.size}),(0,v.jsx)("td",{children:L()(r.mtime).fromNow()})]})})}}])}(l.Component),Fs=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.direntList;return s?(0,v.jsx)(w.A,{}):n?(0,v.jsx)("p",{className:"error text-center mt-4",children:n}):(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"55%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"10%"}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Size")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Last Update")})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Rs,{dirent:t,openFolder:e.props.openFolder,deleteDirent:e.props.deleteDirent,downloadDirent:e.props.downloadDirent,fromSystemRepo:e.props.fromSystemRepo},s)}))})]})})}}])}(l.Component),Es=Fs,Bs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onPathClick=function(e){s.loadDirentList(e)},s.toggleNewFolderDialog=function(){s.setState({isNewFolderDialogOpen:!s.state.isNewFolderDialogOpen})},s.createNewFolder=function(e){var t=m.Aq.getFileName(e);D.H.sysAdminCreateSysRepoFolder(s.props.repoID,s.state.path,t).then((function(e){var t=new Os(e.data),n=s.state.direntList;n.unshift(t),s.setState({direntList:n}),s.toggleNewFolderDialog()})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.openFolder=function(e){var t=m.Aq.joinPath(s.state.path,e.name);e.is_file||s.loadDirentList(t)},s.loadDirentList=function(e){var t=s.props.repoID;D.H.sysAdminListRepoDirents(t,e).then((function(n){var r=n.data,a=r.is_system_library,i=r.repo_name,o=r.dirent_list,l=[];o.forEach((function(e){var t=new Os(e);l.push(t)})),s.setState({loading:!1,repoName:i,isSystemRepo:a,direntList:l,path:e},(function(){var n=p.Yc+"sys/libraries/"+t+"/"+encodeURIComponent(s.state.repoName)+m.Aq.encodePath(e);window.history.replaceState({url:n,path:e},e,n)}))})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteDirent=function(e){var t=m.Aq.joinPath(s.state.path,e.name);D.H.sysAdminDeleteRepoDirent(s.props.repoID,t).then((function(t){N.A.success((0,p.AP)("Successfully deleted 1 item."));var n=s.state.direntList.filter((function(t){return t.name!=e.name}));s.setState({direntList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.downloadDirent=function(e){var t=m.Aq.joinPath(s.state.path,e.name);D.H.sysAdminGetRepoFileDownloadURL(s.props.repoID,t).then((function(e){location.href=e.data.download_url})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.openFileInput=function(){s.fileInput.current.click()},s.onFileInputChange=function(){if(s.fileInput.current.files.length){var e=s.fileInput.current.files[0],t=s.state.path;D.H.sysAdminGetSysRepoItemUploadURL(t).then((function(n){var r=new FormData;r.append("parent_dir",t),r.append("file",e),Ls.A.post(n.data.upload_link,r).then((function(e){var t=e.data[0],n=new Os({is_file:!0,obj_name:t.name,file_size:m.Aq.bytesToSize(t.size),last_update:(new Date).getTime()}),r=s.state.direntList,a=r.filter((function(e){return!e.is_file}));r.splice(a.length,0,n),s.setState({direntList:r})}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}},s.checkDuplicatedName=function(e){return s.state.direntList.some((function(t){return t.name===e}))},s.state={loading:!0,errorMsg:"",isSystemRepo:!1,repoName:"",path:"",direntList:[],isNewFolderDialogOpen:!1},s.fileInput=l.createRef(),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.loadDirentList("/")}},{key:"render",value:function(){var e=this.state,t=e.loading,s=e.errorMsg,r=e.repoName,a=e.direntList,i=e.isSystemRepo,o=e.path,c=e.isNewFolderDialogOpen,d=this.props.repoID;return(0,v.jsxs)(l.Fragment,{children:[i?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("input",{className:"d-none",type:"file",onChange:this.onFileInputChange,ref:this.fileInput}),(0,v.jsx)(y.A,{className:"operation-item",onClick:this.openFileInput,children:(0,p.AP)("Upload")}),(0,v.jsx)(y.A,{className:"operation-item",onClick:this.toggleNewFolderDialog,children:(0,p.AP)("New Folder")})]})})):(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path align-items-center",children:(0,v.jsx)(Ts,{isSystemRepo:i,repoID:d,repoName:r,currentPath:o,onPathClick:this.onPathClick})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Es,{loading:t,errorMsg:s,fromSystemRepo:i,direntList:a,openFolder:this.openFolder,deleteDirent:this.deleteDirent,downloadDirent:this.downloadDirent})})]})}),c&&(0,v.jsx)(_s.A,{parentPath:o,checkDuplicatedName:this.checkDuplicatedName,onAddFolder:this.createNewFolder,addFolderCancel:this.toggleNewFolderDialog})]})}}])}(l.Component),zs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleRepoNameChange=function(e){e.target.value.trim()?s.setState({isSubmitBtnActive:!0}):s.setState({isSubmitBtnActive:!1}),s.setState({groupName:e.target.value})},s.handleSubmit=function(){var e=s.state.groupName.trim();s.props.createGroup(e,s.state.selectedUsers[0].email)},s.handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.toggle=function(){s.props.toggleDialog()},s.state={groupName:"",selectedUsers:[],errMessage:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,autoFocus:!1,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("New Group")}),(0,v.jsxs)(be.A,{children:[(0,v.jsx)(Le.A,{children:(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{for:"groupName",children:(0,p.AP)("Name")}),(0,v.jsx)(Q.A,{id:"groupName",onKeyDown:this.handleKeyDown,value:this.state.groupName,onChange:this.handleRepoNameChange,autoFocus:!0}),(0,v.jsxs)(Oe.A,{className:"mt-2",children:[(0,p.AP)("Owner"),(0,v.jsx)("span",{className:"small text-secondary ml-1",children:(0,p.AP)("(If left blank, owner will be admin)")})]}),(0,v.jsx)(Be.A,{isMulti:!1,placeholder:(0,p.AP)("Select a user"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})]})}),this.state.errMessage&&(0,v.jsx)(Ie.A,{color:"danger",children:this.state.errMessage})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),qs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e,submitBtnDisabled:null==e})},s.submit=function(){if(s.state.selectedUsers){var e=s.state.selectedUsers[0].email;s.props.transferGroup(e),s.props.toggleDialog()}},s.state={selectedUsers:[],submitBtnDisabled:!0},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state.submitBtnDisabled,t='<span class="op-target">'+m.Aq.HTMLescape(this.props.groupName)+"</span>",s=(0,p.AP)("Transfer Group {placeholder} to").replace("{placeholder}",t);return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggleDialog,children:(0,v.jsx)("span",{dangerouslySetInnerHTML:{__html:s}})}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Be.A,{isMulti:!1,placeholder:(0,p.AP)("Select a user"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggleDialog,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.submit,disabled:e,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),Hs=s(52622);L().extend(ue());var Ys=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPage=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.pageInfo,i=t.curPerPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No groups")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"35%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"40%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Created At")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Gs,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteGroup:e.props.deleteGroup,transferGroup:e.props.transferGroup,changeGroup2Department:e.props.changeGroup2Department},s)}))})]}),a&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a.current_page,hasNextPage:a.has_next_page,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?c:o}}])}(l.Component),Gs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteDialog();break;case"Transfer":s.toggleTransferDialog();break;case"Change":s.toggleChangeDialog()}},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleTransferDialog=function(e){e&&e.preventDefault(),s.setState({isTransferDialogOpen:!s.state.isTransferDialogOpen})},s.toggleChangeDialog=function(e){e&&e.preventDefault(),s.setState({isChangeDialogOpen:!s.state.isChangeDialogOpen})},s.deleteGroup=function(){s.props.deleteGroup(s.props.item.id)},s.transferGroup=function(e){s.props.transferGroup(s.props.item.id,e)},s.changeGroup=function(){s.props.changeGroup2Department(s.props.item.id)},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.AP)("Delete");break;case"Transfer":t=(0,p.AP)("Transfer");break;case"Change":t=(0,p.AP)("Change to department")}return t},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1,isTransferDialogOpen:!1,isChangeDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isTransferDialogOpen,a=t.isChangeDialogOpen,i='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",o=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",i),c="".concat(p.Yc,"sys/groups/").concat(e.id,"/libraries/"),d=[];return d=p.am?["Delete","Transfer","Change"]:["Delete","Transfer"],(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:c,children:e.name})}),(0,v.jsx)("td",{children:"system admin"==e.owner?"--":(0,v.jsx)(Se,{email:e.owner,name:e.owner_name})}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{title:L()(e.created_at).format("dddd, MMMM D, YYYY h:mm:ss A"),children:L()(e.created_at).fromNow()})}),(0,v.jsx)("td",{children:s&&"system admin"!=e.owner&&(0,v.jsx)(Je.A,{operations:d,translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Group"),message:o,executeOperation:this.deleteGroup,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteDialog}),r&&(0,v.jsx)(qs,{groupName:e.name,transferGroup:this.transferGroup,toggleDialog:this.toggleTransferDialog}),a&&(0,v.jsx)(Hs.A,{groupName:e.name,changeGroup2Department:this.changeGroup,toggleDialog:this.toggleChangeDialog})]})}}])}(l.Component),Qs=Ys,Vs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleCreateGroupDialog=function(){s.setState({isCreateGroupDialogOpen:!s.state.isCreateGroupDialogOpen})},s.getGroupListByPage=function(e){D.H.sysAdminListAllGroups(e,s.state.perPage).then((function(e){s.setState({loading:!1,groupList:e.data.groups,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getGroupListByPage(1)}))},s.createGroup=function(e,t){D.H.sysAdminCreateNewGroup(e,t).then((function(e){var t=s.state.groupList;t.unshift(e.data),s.setState({groupList:t}),s.toggleCreateGroupDialog()})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteGroup=function(e){D.H.sysAdminDismissGroupByID(e).then((function(t){var n=s.state.groupList.filter((function(t){return t.id!=e}));s.setState({groupList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.transferGroup=function(e,t){D.H.sysAdminTransferGroup(t,e).then((function(t){var n=s.state.groupList.map((function(s){return s.id==e&&(s=t.data),s}));s.setState({groupList:n}),N.A.success((0,p.AP)("Successfully transferred the group."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.changeGroup2Department=function(e){D.H.sysAdminGroup2Department(e).then((function(t){var n=s.state.groupList.map((function(s){return s.id==e&&(s=t.data),s}));s.setState({groupList:n}),N.A.success((0,p.AP)("Successfully change the group"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.getSearch=function(){return(0,v.jsx)(Ge.A,{placeholder:(0,p.AP)("Search groups by name"),submit:s.searchGroups})},s.searchGroups=function(e){(0,h.oo)("".concat(p.Yc,"sys/search-groups/?name=").concat(encodeURIComponent(e)))},s.state={loading:!0,errorMsg:"",groupList:[],pageInfo:{},perPage:100,isCreateGroupDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=void 0===n?1:n,a=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||a),currentPage:parseInt(t.get("page")||r)},(function(){e.getGroupListByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state.isCreateGroupDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:this.getSearch()},this.props),{},{children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{className:"operation-item",onClick:this.toggleCreateGroupDialog,children:(0,p.AP)("New Group")}),(0,v.jsx)("a",{className:"btn btn-secondary operation-item",href:"".concat(p.Yc,"sys/groupadmin/export-excel/"),children:(0,p.AP)("Export Excel")})]})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Groups")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Qs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.groupList,pageInfo:this.state.pageInfo,deleteGroup:this.deleteGroup,transferGroup:this.transferGroup,changeGroup2Department:this.changeGroup2Department,getListByPage:this.getGroupListByPage,resetPerPage:this.resetPerPage,curPerPage:this.state.perPage})})]})}),e&&(0,v.jsx)(zs,{createGroup:this.createGroup,toggleDialog:this.toggleCreateGroupDialog})]})}}])}(l.Component),Ws=Vs,Ks=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getGroups=function(){var e=s.state.name;D.H.sysAdminSearchGroups(e).then((function(e){s.setState({loading:!1,groupList:e.data.group_list})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteGroup=function(e){D.H.sysAdminDismissGroupByID(e).then((function(t){var n=s.state.groupList.filter((function(t){return t.id!=e}));s.setState({groupList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.transferGroup=function(e,t){D.H.sysAdminTransferGroup(t,e).then((function(t){var n=s.state.groupList.map((function(s){return s.id==e&&(s=t.data),s}));s.setState({groupList:n}),N.A.success((0,p.AP)("Successfully transferred the group."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.handleNameInputChange=function(e){s.setState({name:e.target.value},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.name;s.setState({isSubmitBtnActive:e.trim()})},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.getGroups())},s.state={name:"",isSubmitBtnActive:!1,loading:!0,errorMsg:"",groupList:[],pageInfo:null},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=new URL(document.location).searchParams;this.setState({name:e.get("name")||""},this.getGroups)}},{key:"render",value:function(){var e=this.state,t=e.name,s=e.isSubmitBtnActive;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Groups")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Search Groups")}),(0,v.jsx)("p",{className:"text-secondary small",children:(0,p.AP)("Tip: you can search by keyword in name.")}),(0,v.jsxs)(Le.A,{tag:"div",children:[(0,v.jsxs)(_e.A,{row:!0,children:[(0,v.jsx)(Oe.A,{for:"name",sm:1,children:(0,p.AP)("Name")}),(0,v.jsx)(vt.A,{sm:5,children:(0,v.jsx)(Q.A,{type:"text",name:"name",id:"name",value:t,onChange:this.handleNameInputChange,onKeyDown:this.handleKeyDown})})]}),(0,v.jsx)(_e.A,{row:!0,children:(0,v.jsx)(vt.A,{sm:{size:5,offset:1},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!s,onClick:this.getGroups,children:(0,p.AP)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Result")}),(0,v.jsx)(Qs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.groupList,deleteGroup:this.deleteGroup,transferGroup:this.transferGroup})]})]})]})})]})}}])}(l.Component),Xs=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"repos",urlPart:"groups/"+s.props.groupID+"/libraries",text:(0,p.AP)("Libraries")},{name:"members",urlPart:"groups/"+s.props.groupID+"/members",text:(0,p.AP)("Members")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.groupName,s=e.currentItem;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/groups/"),children:(0,p.AP)("Groups")})," / ",t]})}),(0,v.jsx)("ul",{className:"nav border-bottom mx-4",children:this.navItems.map((function(e,t){return(0,v.jsx)("li",{className:"nav-item mr-2",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(e.urlPart,"/"),className:"nav-link ".concat(s==e.name?" active":""),children:e.text})},t)}))})]})}}])}(l.Component),$s=Xs,Js=window.sysadmin.pageOptions.enableSysAdminViewRepo,Zs=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No libraries")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Size")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Shared By")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(en,{item:t,unshareRepo:e.props.unshareRepo},s)}))})]})});return r.length?i:a}}])}(l.Component),en=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleUnshareRepoDialog=function(){s.setState({isUnshareRepoDialogOpen:!s.state.isUnshareRepoDialogOpen})},s.unshareRepo=function(){var e=s.props.item;s.props.unshareRepo(e.repo_id,e.name),s.toggleUnshareRepoDialog()},s.renderRepoName=function(){var e=s.props.item,t=e;return t.id=e.repo_id,t.name?p.am&&Js&&!t.encrypted?(0,v.jsx)("a",{href:"".concat(p.Yc,"sys/libraries/").concat(t.id,"/"),children:t.name}):t.name:"--"},s.state={isHighlighted:!1,isOpIconShown:!1,isUnshareRepoDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isUnshareRepoDialogOpen,n=e.isHighlighted,r=this.props.item,a=m.Aq.getLibIconUrl(r),i=m.Aq.getLibIconTitle(r),o='<span class="op-target">'+m.Aq.HTMLescape(r.name)+"</span>",c=(0,p.AP)("Are you sure you want to unshare {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:ge()({"tr-highlight":n}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:a,title:i,alt:i,width:"24"})}),(0,v.jsx)("td",{children:this.renderRepoName()}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(r.size)}),(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:r.shared_by,name:r.shared_by_name})}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{role:"button",className:"op-icon sf2-icon-x3 ".concat(t?"":"invisible"),title:(0,p.AP)("Unshare"),onClick:this.toggleUnshareRepoDialog})})]}),s&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Unshare Library"),message:c,executeOperation:this.unshareRepo,confirmBtnText:(0,p.AP)("Unshare"),toggleDialog:this.toggleUnshareRepoDialog})]})}}])}(l.Component),tn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).unshareRepo=function(e,t){D.H.sysAdminUnshareRepoFromGroup(s.props.groupID,e).then((function(n){var r=s.state.repoList.filter((function(t){return t.repo_id!=e}));s.setState({repoList:r});var a=(0,p.AP)("Successfully unshared library {placeholder}").replace("{placeholder}",t);N.A.success(a)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",groupName:"",repoList:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminListGroupRepos(this.props.groupID).then((function(t){e.setState({loading:!1,repoList:t.data.libraries,groupName:t.data.group_name})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)($s,{groupID:this.props.groupID,groupName:this.state.groupName,currentItem:"repos"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Zs,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList,unshareRepo:this.unshareRepo})})]})})]})}}])}(l.Component),sn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e,isSubmitBtnDisabled:!e.length})},s.addMembers=function(){var e=s.state.selectedUsers.map((function(e){return e.email}));s.props.addMembers(e),s.props.toggle()},s.state={selectedUsers:[],isSubmitBtnDisabled:!0},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state.isSubmitBtnDisabled;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggle,children:(0,p.AP)("Add Member")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Be.A,{isMulti:!0,placeholder:(0,p.AP)("Search users"),onSelectChange:this.handleSelectChange,selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.addMembers,disabled:e,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),nn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.getPreviousPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page-1)},s.getNextPageList=function(){s.props.getListByPage(s.props.pageInfo.current_page+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.pageInfo,i=t.curPerPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No members")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"55%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Role")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(rn,{item:t,isItemFreezed:e.state.isItemFreezed,toggleItemFreezed:e.toggleItemFreezed,removeMember:e.props.removeMember,updateMemberRole:e.props.updateMemberRole},s)}))})]}),a&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPageList,gotoNextPage:this.getNextPageList,currentPage:a.current_page,hasNextPage:a.has_next_page,curPerPage:i,resetPerPage:this.props.resetPerPage})]});return r.length?c:o}}])}(l.Component),rn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({highlighted:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({highlighted:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.removeMember=function(){var e=s.props.item;s.props.removeMember(e.email,e.name),s.toggleDeleteDialog()},s.updateMemberRole=function(e){s.props.updateMemberRole(s.props.item.email,e.value)},s.roleOptions=[{value:"Admin",text:(0,p.AP)("Admin"),isSelected:!1},{value:"Member",text:(0,p.AP)("Member"),isSelected:!1}],s.state={highlighted:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.highlighted,s=e.isDeleteDialogOpen,n=this.props.item,r='<span class="op-target">'+m.Aq.HTMLescape(n.name)+"</span>",a=(0,p.AP)("Are you sure you want to remove {placeholder} ?").replace("{placeholder}",r),i=n.role;this.roleOptions=this.roleOptions.map((function(e){return e.isSelected=e.value==i,e}));var o=this.roleOptions.filter((function(e){return e.isSelected}))[0];return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:t?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:n.avatar_url,alt:"",className:"rounded-circle",width:"24"})}),(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:n.email,name:n.name})}),(0,v.jsx)("td",{children:"Owner"==n.role?(0,p.AP)("Owner"):(0,v.jsx)(We.A,{isDropdownToggleShown:t,currentSelectedOption:o,options:this.roleOptions,selectOption:this.updateMemberRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("td",{children:"Owner"!=n.role&&(0,v.jsx)("i",{role:"button",className:"op-icon sf2-icon-x3 ".concat(t?"":"invisible"),title:(0,p.AP)("Remove"),onClick:this.toggleDeleteDialog})})]}),s&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Remove Member"),message:a,executeOperation:this.removeMember,confirmBtnText:(0,p.AP)("Remove"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),an=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getListByPage=function(e){var t=s.state.perPage;D.H.sysAdminListGroupMembers(s.props.groupID,e,t).then((function(e){s.setState({loading:!1,memberList:e.data.members,groupName:e.data.group_name,pageInfo:e.data.page_info})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getListByPage(1)}))},s.toggleAddMemberDialog=function(){s.setState({isAddMemberDialogOpen:!s.state.isAddMemberDialogOpen})},s.addMembers=function(e){D.H.sysAdminAddGroupMember(s.props.groupID,e).then((function(e){var t=e.data.success;t.length&&(s.setState({memberList:t.concat(s.state.memberList)}),t.forEach((function(e){var t=(0,p.AP)("Successfully added {email_placeholder}").replace("{email_placeholder}",e.email);N.A.success(t)}))),e.data.failed.forEach((function(e){var t=(0,p.AP)("Failed to add {email_placeholder}: {error_msg_placeholder}").replace("{email_placeholder}",e.email).replace("{error_msg_placeholder}",e.error_msg);N.A.danger(t,{duration:3})}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.removeMember=function(e,t){D.H.sysAdminDeleteGroupMember(s.props.groupID,e).then((function(n){var r=s.state.memberList.filter((function(t){return t.email!=e}));s.setState({memberList:r}),N.A.success((0,p.AP)("Successfully removed {placeholder}.").replace("{placeholder}",t))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateMemberRole=function(e,t){var n="Admin"==t;D.H.sysAdminUpdateGroupMemberRole(s.props.groupID,e,n).then((function(n){var r=s.state.memberList.map((function(s){return s.email==e&&(s.role=t),s}));s.setState({memberList:r})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",groupName:"",memberList:[],pageInfo:{},currentPage:1,perPage:100,isAddMemberDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({currentPage:parseInt(t.get("page")||n),perPage:parseInt(t.get("per_page")||r)},(function(){e.getListByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state.isAddMemberDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddMemberDialog,children:(0,p.AP)("Add Member")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)($s,{currentItem:"members",groupID:this.props.groupID,groupName:this.state.groupName}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(nn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.memberList,removeMember:this.removeMember,updateMemberRole:this.updateMemberRole,pageInfo:this.state.pageInfo,curPerPage:this.state.perPage,getListByPage:this.getListByPage,resetPerPage:this.resetPerPage})})]})}),e&&(0,v.jsx)(sn,{addMembers:this.addMembers,toggle:this.toggleAddMemberDialog})]})}}])}(l.Component),on=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).setGroupQuota=function(){var e=s.state.quota;if(e.length&&/^[1-9]\d*$/im.test(e)||-2==e){s.setState({errMessage:""});var t=-2==s.state.quota?s.state.quota:1e6*s.state.quota;D.H.sysAdminUpdateDepartmentQuota(s.props.group.id,t).then((function(e){s.props.toggle(),s.props.onSetQuota(e.data)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}else{var n=(0,p.AP)("Quota is invalid.");s.setState({errMessage:n})}},s.handleChange=function(e){var t=e.target.value.trim();s.setState({quota:t})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.setGroupQuota(),e.preventDefault())},s.state={quota:"",errMessage:""},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.group,t=m.Aq.bytesToSize(e.quota),s=(0,p.AP)("The current quota for {group_name} is {quota}").replace("{group_name}",e.name).replace("{quota}",t);return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggle,children:(0,p.AP)("Set Quota")}),(0,v.jsxs)(be.A,{children:[(0,v.jsx)("p",{children:s}),(0,v.jsx)("p",{children:(0,p.AP)("Please enter a new quota")}),(0,v.jsxs)(Ue.A,{children:[(0,v.jsx)(Q.A,{onKeyDown:this.handleKeyDown,value:this.state.quota,onChange:this.handleChange,autoFocus:!0}),(0,v.jsx)(St.A,{children:"MB"})]}),(0,v.jsxs)("p",{className:"tip",children:[(0,v.jsx)("br",{}),(0,v.jsx)("span",{children:(0,p.AP)("An integer that is greater than 0 or equal to -2.")}),(0,v.jsx)("br",{}),(0,v.jsx)("span",{children:(0,p.AP)("Tip: -2 means no limit.")})]}),this.state.errMessage&&(0,v.jsx)("p",{className:"error",children:this.state.errMessage})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.setGroupQuota,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),ln=s(15097),cn=s(685),dn=s(77474),un=s(47150),hn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleSubmit=function(){s.validateName()&&D.H.sysAdminAddRepoInDepartment(s.props.groupID,s.state.repoName.trim()).then((function(e){s.props.toggle(),s.props.onAddNewRepo(e.data)})).catch((function(e){var t=m.Aq.getErrorMsg(e);s.setState({errMessage:t})}))},s.validateName=function(){var e="";return!!s.state.repoName.trim().length||(e=(0,p.AP)("Name is required"),s.setState({errMessage:e}),!1)},s.handleChange=function(e){s.setState({repoName:e.target.value})},s.handleKeyDown=function(e){"Enter"===e.key&&(s.handleSubmit(),e.preventDefault())},s.state={repoName:"",errMessage:""},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggle,children:(0,p.AP)("New Library")}),(0,v.jsxs)(be.A,{children:[(0,v.jsx)(Le.A,{children:(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{for:"repoName",children:(0,p.AP)("Name")}),(0,v.jsx)(Q.A,{id:"repoName",onKeyDown:this.handleKeyDown,value:this.state.repoName,onChange:this.handleChange,autoFocus:!0})]})}),this.state.errMessage&&(0,v.jsx)("p",{className:"error",children:this.state.errMessage})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),gn=s(60436),pn=function(){return(0,a.default)((function e(t){(0,r.default)(this,e),this.id=t.id||"",this.name=t.name||"",this.children=t.children||[],this.parentNode=t.parentNode||null,this.orgId=t.orgId||"",this.quota=t.quota||-2}),[{key:"findNodeById",value:function(e){if(this.id===e)return this;for(var t=(0,gn.default)(this.children);t.length>0;){var s=t.shift();if(s.id===e)return s;t.push.apply(t,(0,gn.default)(s.children))}}},{key:"addChildren",value:function(e){var t;(t=this.children).push.apply(t,(0,gn.default)(e))}},{key:"setChildren",value:function(e){this.children=e}},{key:"hasChildren",value:function(){return this.children.length>0}},{key:"deleteChildById",value:function(e){this.children=this.children.filter((function(t){return t.id!==e}))}}])}(),mn=s(5495),fn=s(69123),xn=s(65276),vn=s(34940);var An=function(e){var t=e.node,s=e.toggleDelete,n=e.toggleRename,r=e.toggleAddMembers,a=e.toggleAddDepartment,i=e.toggleAddLibrary,o=e.toggleSetQuotaDialog;return(0,v.jsxs)(xn.A,{modifiers:[{name:"preventOverflow",options:{boundary:document.body}}],className:"position-fixed",children:[(0,v.jsx)(vn.A,{onClick:function(){return a(t)},children:(0,p.AP)("Add sub-department")},"".concat(t.id,"-add-department")),(0,v.jsx)(vn.A,{onClick:function(){return i(t)},children:(0,p.AP)("Add Library")},"".concat(t.id,"-add-repo")),(0,v.jsx)(vn.A,{onClick:function(){return r(t)},children:(0,p.AP)("Add members")},"".concat(t.id,"-add-members")),(0,v.jsx)(vn.A,{onClick:function(){return n(t)},children:(0,p.AP)("Rename")},"".concat(t.id,"-rename")),(0,v.jsx)(vn.A,{onClick:function(){return s(t)},children:(0,p.AP)("Delete")},"".concat(t.id,"-delete")),(0,v.jsx)(vn.A,{onClick:function(){return o(t)},children:(0,p.AP)("Set quota")},"".concat(t.id,"-set-quota")),(0,v.jsx)(vn.A,{disabled:!0,children:"".concat((0,p.AP)("Department ID")," : ").concat(t.id)},"".concat(t.id,"-id"))]})},jn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleChildren=function(e){e.preventDefault(),e.stopPropagation(),s.state.isChildrenShow?s.setState({isChildrenShow:!1}):s.listSubDepartments()},s.listSubDepartments=function(){var e=s.props.node;s.props.listSubDepartments(e.id,(function(e){Array.isArray(e)&&0===e.length&&s.setState({isShowTreeIcon:!1}),s.setState({isChildrenShow:!0})}))},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.state.dropdownOpen||s.setState({active:!1})},s.renderTreeNodes=function(e){if(e.length>0)return e.map((function(e){return(0,v.jsx)(t,{node:e,onChangeDepartment:s.props.onChangeDepartment,checkedDepartmentId:s.props.checkedDepartmentId,listSubDepartments:s.props.listSubDepartments,toggleAddDepartment:s.props.toggleAddDepartment,toggleSetQuotaDialog:s.props.toggleSetQuotaDialog,toggleAddMembers:s.props.toggleAddMembers,toggleRename:s.props.toggleRename,toggleDelete:s.props.toggleDelete,toggleAddLibrary:s.props.toggleAddLibrary},e.id)}))},s.changeDept=function(e){var t=s.props,n=t.node,r=t.checkedDepartmentId,a=s.state.isChildrenShow;if(r!==n.id&&s.props.onChangeDepartment(e),r===n.id){if(a)return void s.setState({isChildrenShow:!1});s.listSubDepartments()}},s.state={isShowTreeIcon:!0,isChildrenShow:!1,dropdownOpen:!1,active:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){-1===this.props.node.id&&this.listSubDepartments()}},{key:"render",value:function(){var e=this,t=this.props,s=t.node,n=t.checkedDepartmentId,r=this.state,a=r.isChildrenShow,i=r.dropdownOpen,o=r.active,c=ge()({"tree-node":!0,active:n===s.id});return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:c,onClick:function(){return e.changeDept(s.id)},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[this.state.isShowTreeIcon?(0,v.jsx)("span",{className:"departments-v2-tree-icon",onClick:function(t){return e.toggleChildren(t)},children:(0,v.jsx)("i",{className:"sf3-font sf3-font-down ".concat(a?"":"rotate-270")})}):(0,v.jsx)("span",{style:{width:24}}),(0,v.jsx)("span",{className:"departments-v2-tree-node-text text-truncate",children:s.name}),o&&(0,v.jsxs)(mn.A,{isOpen:i,toggle:function(t){return e.dropdownToggle(t)},direction:"down",className:"mr-2",children:[(0,v.jsx)(fn.A,{tag:"span",role:"button",className:"right-icon",title:(0,p.AP)("More operations"),"aria-label":(0,p.AP)("More operations"),"data-toggle":"dropdown",children:(0,v.jsx)("i",{className:"sf3-font sf3-font-more"})}),(0,v.jsx)(An,{node:s,toggleAddDepartment:this.props.toggleAddDepartment,toggleSetQuotaDialog:this.props.toggleSetQuotaDialog,toggleAddLibrary:this.props.toggleAddLibrary,toggleAddMembers:this.props.toggleAddMembers,toggleRename:this.props.toggleRename,toggleDelete:this.props.toggleDelete})]})]}),this.state.isChildrenShow&&(0,v.jsx)("div",{className:"tree-node-children",children:s.children&&this.renderTreeNodes(s.children)})]})}}])}(l.Component),Pn=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.rootNodes,n=t.checkedDepartmentId;return(0,v.jsxs)("div",{className:"departments-tree-panel p-4",children:[s.map((function(t){return(0,v.jsx)(jn,{node:t,checkedDepartmentId:n,onChangeDepartment:e.props.onChangeDepartment,listSubDepartments:e.props.listSubDepartments,toggleAddDepartment:e.props.toggleAddDepartment,toggleSetQuotaDialog:e.props.toggleSetQuotaDialog,toggleAddLibrary:e.props.toggleAddLibrary,toggleAddMembers:e.props.toggleAddMembers,toggleRename:e.props.toggleRename,toggleDelete:e.props.toggleDelete},t.id)})),(0,v.jsxs)("button",{className:"btn btn-secondary btn-block text-start border-0 font-weight-normal new-dept-btn shadow-none",onClick:function(){e.props.toggleAddDepartment(null)},children:[(0,v.jsx)("i",{className:"sf3-font sf3-font-new new-dept-btn-icon"}),(0,p.AP)("New Department")]})]})}}])}(l.Component),Sn=Pn,yn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).deleteRepo=function(){D.H.sysAdminDeleteRepoInDepartment(s.props.groupID,s.props.repo.repo_id).then((function(e){e.data.success&&(s.props.onRepoChanged(),s.props.toggle())})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.repo,t=(0,p.AP)("Are you sure you want to delete {placeholder} ?");return t=t.replace("{placeholder}",'<span class="op-target">'+m.Aq.HTMLescape(e.name||e.repo_name)+"</span>"),(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggle,children:(0,p.AP)("Delete Library")}),(0,v.jsx)(be.A,{children:(0,v.jsx)("div",{dangerouslySetInnerHTML:{__html:t}})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.deleteRepo,children:(0,p.AP)("Delete")})]})]})}}])}(l.Component),Dn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onMouseEnter=function(){s.props.isItemFreezed||s.setState({highlighted:!0})},s.onMouseLeave=function(){s.props.isItemFreezed||s.setState({highlighted:!1})},s.setMemberStaff=function(e){s.props.setMemberStaff(s.props.member.email,"Admin"===e.value)},s.deleteMember=function(){var e=s.props.member;s.props.deleteMember(e.email)},s.toggleDropdownMenu=function(){s.setState({isItemMenuShow:!s.state.isItemMenuShow},(function(){s.state.isItemMenuShow&&"function"===typeof s.props.freezeItem?s.props.freezeItem():s.state.isItemMenuShow||"function"!==typeof s.props.unfreezeItem||s.props.unfreezeItem()}))},s.toggleItemFreezed=function(e){e?s.props.freezeItem():(s.props.unfreezeItem(),s.setState({highlighted:!1}))},s.toggleDeleteMemberDialog=function(){s.setState({isDeleteMemberDialogOpen:!s.state.isDeleteMemberDialogOpen})},s.state={highlighted:!1,isItemMenuShow:!1},s.roleOptions=[{value:"Admin",text:(0,p.AP)("Admin"),isSelected:!1},{value:"Member",text:(0,p.AP)("Member"),isSelected:!1}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.member,t=this.state,s=t.highlighted,n=t.isItemMenuShow,r=t.isDeleteMemberDialogOpen;this.roleOptions=this.roleOptions.map((function(t){return t.isSelected=t.value==e.role,t}));var a=this.roleOptions.filter((function(e){return e.isSelected}))[0];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("tr",{className:"departments-members-item ".concat(s?"tr-highlight":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{className:"avatar",src:e.avatar_url,alt:""})}),(0,v.jsx)("td",{className:"text-truncate",children:(0,v.jsx)("a",{href:"".concat(p.Yc,"sys/users/").concat(encodeURIComponent(e.email),"/"),children:e.name})}),(0,v.jsx)("td",{children:(0,v.jsx)(We.A,{isDropdownToggleShown:s,currentSelectedOption:a,options:this.roleOptions,selectOption:this.setMemberStaff,toggleItemFreezed:this.toggleItemFreezed})}),(0,v.jsx)("td",{children:e.contact_email}),(0,v.jsx)("td",{children:s&&(0,v.jsxs)(mn.A,{isOpen:n,toggle:this.toggleDropdownMenu,direction:"down",children:[(0,v.jsx)(fn.A,{tag:"i",role:"button",className:"op-icon sf3-font sf3-font-more",title:(0,p.AP)("More operations"),"aria-label":(0,p.AP)("More operations"),"data-toggle":"dropdown"}),(0,v.jsx)(xn.A,{children:(0,v.jsx)(vn.A,{onClick:this.toggleDeleteMemberDialog,children:(0,p.AP)("Delete")})})]})})]}),r&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Member"),message:(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",'<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>"),executeOperation:this.deleteMember,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteMemberDialog})]})}}])}(l.Component),Nn=window.sysadmin.pageOptions.enableSysAdminViewRepo,wn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onMouseEnter=function(){s.setState({highlight:!0})},s.onMouseLeave=function(){s.setState({highlight:!1})},s.state={highlight:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.repo,t=e.name||e.repo_name,s=this.state.highlight,n=m.Aq.getLibIconUrl(e);return(0,v.jsxs)("tr",{className:s?"tr-highlight":"",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:n,width:"24",alt:""})}),(0,v.jsx)("td",{children:Nn?(0,v.jsx)("a",{href:"".concat(p.Yc,"sys/libraries/").concat(e.repo_id,"/").concat(encodeURIComponent(t),"/"),children:t}):(0,v.jsx)("span",{children:t})}),(0,v.jsx)("td",{children:m.Aq.bytesToSize(e.size)}),(0,v.jsx)("td",{className:"cursor-pointer text-center",onClick:this.props.showDeleteRepoDialog.bind(this,e),children:(0,v.jsx)("span",{className:"sf3-font-delete1 sf3-font op-icon ".concat(s?"":"vh"),title:(0,p.AP)("Delete")})})]})}}])}(l.Component),bn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).showDeleteRepoDialog=function(e){s.setState({showDeleteRepoDialog:!0,deletedRepo:e})},s.toggleCancel=function(){s.setState({showDeleteRepoDialog:!1,deletedRepo:{}})},s.onRepoChanged=function(){s.getRepos(s.props.checkedDepartmentId)},s.freezeItem=function(){s.setState({isItemFreezed:!0})},s.unfreezeItem=function(){s.setState({isItemFreezed:!1})},s.getCurrentDepartment=function(){var e=s.props,t=e.rootNodes,n=e.checkedDepartmentId;if(!t)return{};for(var r={},a=(0,gn.default)(t);!r.id&&a.length>0;){var i=a.shift();i.id===n?r=i:i.children&&i.children.length>0&&a.push.apply(a,(0,gn.default)(i.children))}return r},s.sortByName=function(e){e.preventDefault();var t=s.props.sortOrder;t="asc"===t?"desc":"asc",s.props.sortItems("name",t)},s.sortByRole=function(e){e.preventDefault();var t=s.props.sortOrder;t="asc"===t?"desc":"asc",s.props.sortItems("role",t)},s.changeActiveNav=function(e){s.setState({activeNav:e})},s.getRepos=function(e){s.props.getRepos(e,(function(e){s.setState({repos:e})}))},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.state={isItemFreezed:!1,activeNav:"members",repos:[],deletedRepo:{},showDeleteRepoDialog:!1,dropdownOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.getRepos(this.props.checkedDepartmentId)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.checkedDepartmentId===e.checkedDepartmentId&&this.props.isAddNewRepo===e.isAddNewRepo||this.getRepos(e.checkedDepartmentId)}},{key:"render",value:function(){var e=this,t=this.state,s=t.activeNav,n=t.repos,r=this.props,a=r.membersList,i=r.isMembersListLoading,o=r.sortBy,l=r.sortOrder,c="name"===o,d="role"===o,u=(0,v.jsx)("span",{className:"sort-dirent sf3-font sf3-font-down ".concat("asc"===l?"rotate-180":"")}),h=this.getCurrentDepartment();return(0,v.jsxs)("div",{className:"department-content-main d-flex flex-column",children:[(0,v.jsxs)("div",{className:"cur-view-path justify-content-start",children:[(0,v.jsx)("h4",{className:"sf-heading",children:h.name}),(0,v.jsxs)(mn.A,{isOpen:this.state.dropdownOpen,toggle:function(t){return e.dropdownToggle(t)},direction:"down",className:"department-dropdown-menu",children:[(0,v.jsx)(fn.A,{tag:"span",role:"button",className:"sf3-font-down sf3-font ml-1 sf-dropdown-toggle",title:(0,p.AP)("More operations"),"aria-label":(0,p.AP)("More operations"),"data-toggle":"dropdown"}),(0,v.jsx)(An,{node:h,toggleAddDepartment:this.props.toggleAddDepartment,toggleSetQuotaDialog:this.props.toggleSetQuotaDialog,toggleAddLibrary:this.props.toggleAddLibrary,toggleAddMembers:this.props.toggleAddMembers,toggleRename:this.props.toggleRename,toggleDelete:this.props.toggleDelete})]})]}),(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsxs)("ul",{className:"nav",children:[(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)("span",{className:"nav-link ".concat("members"===s?"active":""),onClick:function(){return e.changeActiveNav("members")},children:(0,p.AP)("Members")})}),(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)("span",{className:"nav-link ".concat("repos"===s?"active":""),onClick:function(){return e.changeActiveNav("repos")},children:(0,p.AP)("Libraries")})})]})}),"members"===s&&(0,v.jsx)("div",{className:"cur-view-content",children:i?(0,v.jsx)(w.A,{}):0==a.length?(0,v.jsx)(pe.A,{text:(0,p.AP)("No members")}):(0,v.jsxs)("div",{className:"w-xs-250",children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"10%"}),(0,v.jsxs)("th",{width:"25%",onClick:this.sortByName,children:[(0,p.AP)("Name")," ",c&&u]}),(0,v.jsxs)("th",{width:"25%",onClick:this.sortByRole,children:[(0,p.AP)("Role")," ",d&&u]}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Contact email")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:a.map((function(t,s){return(0,v.jsx)(Dn,{member:t,deleteMember:e.props.deleteMember,setMemberStaff:e.props.setMemberStaff,unfreezeItem:e.unfreezeItem,freezeItem:e.freezeItem,isItemFreezed:e.state.isItemFreezed},s)}))})]}),this.props.currentPageInfo&&(0,v.jsx)(X.A,{gotoPreviousPage:this.props.getPreviousPageList,gotoNextPage:this.props.getNextPageList,currentPage:this.props.currentPageInfo.current_page,hasNextPage:this.props.currentPageInfo.has_next_page,curPerPage:this.props.perPage,resetPerPage:this.props.resetPerPage,noURLUpdate:!0})]})}),"repos"===s&&(0,v.jsx)("div",{className:"cur-view-content",children:0==n.length?(0,v.jsx)(pe.A,{text:(0,p.AP)("No libraries")}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"50%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Size")}),(0,v.jsx)("th",{width:"15%"})]})}),(0,v.jsx)("tbody",{children:n.map((function(t,s){return(0,v.jsx)(wn,{repo:t,showDeleteRepoDialog:e.showDeleteRepoDialog},s)}))})]}),this.state.showDeleteRepoDialog&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(yn,{toggle:this.toggleCancel,onRepoChanged:this.onRepoChanged,repo:this.state.deletedRepo,groupID:this.props.checkedDepartmentId})})]})})]})}}])}(l.Component),In=bn,kn=(s(2201),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onChangeDepartment=function(e){s.setState({checkedDepartmentId:e},s.loadDepartmentMembers(e))},s.loadDepartmentMembers=function(e){if(-1!==e){s.setState({isMembersListLoading:!0});var t=s.state,n=t.currentPage,r=t.perPage;D.H.sysAdminListGroupMembers(e,n,r).then((function(e){var t=e.data,n=t.members,r=t.page_info;s.setState({membersList:n,currentPageInfo:r,isMembersListLoading:!1})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}else s.setState({isMembersListLoading:!1,membersList:[]})},s.getPreviousPageList=function(){var e=s.state,t=e.checkedDepartmentId,n=e.currentPageInfo.current_page;s.setState({currentPage:n-1},(function(){s.loadDepartmentMembers(t)}))},s.getNextPageList=function(){var e=s.state,t=e.checkedDepartmentId,n=e.currentPageInfo.current_page;s.setState({currentPage:n+1},(function(){s.loadDepartmentMembers(t)}))},s.resetPerPage=function(e){s.setState({perPage:e,currentPage:1},(function(){var e=s.state.checkedDepartmentId;s.loadDepartmentMembers(e)}))},s.listSubDepartments=function(e,t){var n=s.state.rootNodes,r=null;n.forEach((function(t){r||(r=t.findNodeById(e))})),r&&D.H.sysAdminGetDepartmentInfo(e).then((function(e){var s=e.data.groups.map((function(e){return new pn({id:e.id,name:e.name,parentGroupId:e.parent_group_id,orgId:e.org_id,parentNode:r,quota:e.quota})}));r.setChildren(s),t&&t(s)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.getRepos=function(e,t){D.H.sysAdminListGroupRepos(e).then((function(e){t&&t(e.data.libraries)})).catch((function(e){if(e.response&&404===e.response.status)t&&t(null);else{var s=m.Aq.getErrorMsg(e);N.A.danger(s)}}))},s.toggleAddLibrary=function(e){s.setState({operateNode:e,isShowAddRepoDialog:!s.state.isShowAddRepoDialog})},s.toggleAddDepartment=function(e){s.setState({operateNode:e,isAddDepartmentDialogShow:!s.state.isAddDepartmentDialogShow})},s.toggleSetQuotaDialog=function(e){s.setState({operateNode:e,isSetQuotaDialogShow:!s.state.isSetQuotaDialogShow})},s.toggleAddMembers=function(e){s.setState({operateNode:e,isAddMembersDialogShow:!s.state.isAddMembersDialogShow})},s.toggleRename=function(e){s.setState({operateNode:e,isRenameDepartmentDialogShow:!s.state.isRenameDepartmentDialogShow})},s.toggleDelete=function(e){s.setState({operateNode:e,isDeleteDepartmentDialogShow:!s.state.isDeleteDepartmentDialogShow})},s.addDepartment=function(e,t){e.addChildren([new pn({id:t.id,name:t.name,parentNode:e,orgId:t.org_id})])},s.setRootNode=function(e){var t=new pn({id:e.id,name:e.name,orgId:e.org_id}),n=s.state.rootNodes.slice(0);n.push(t),s.setState({rootNodes:n,checkedDepartmentId:t.id}),s.loadDepartmentMembers(t.id)},s.renameDepartment=function(e,t){e.id=t.id,e.name=t.name},s.onDelete=function(){var e=s.state,t=e.operateNode,n=e.checkedDepartmentId;D.H.sysAdminDeleteDepartment(t.id).then((function(){if(s.toggleDelete(),t.parentNode)t.parentNode.deleteChildById(t.id),t.id===n&&-1!==t.parentNode.id&&s.onChangeDepartment(t.parentNode.id);else{var e=s.state.rootNodes.slice(0),r=e.findIndex((function(e){return e.id===t.id}));e.splice(r,1),0===e.length?s.setState({rootNodes:e,checkedDepartmentId:-1}):(s.setState({rootNodes:e,checkedDepartmentId:e[0].id}),s.loadDepartmentMembers(e[0].id))}})).catch((function(e){if(e.response&&400===e.response.status)N.A.danger(e.response.data.error_msg);else{var t=m.Aq.getErrorMsg(e);N.A.danger(t)}}))},s.onMemberChanged=function(){var e=s.state,t=e.checkedDepartmentId,n=e.operateNode;t&&n&&t!==n.id||s.loadDepartmentMembers(n.id)},s.setMemberStaff=function(e,t){var n=s.state,r=n.checkedDepartmentId,a=n.membersList;D.H.sysAdminUpdateGroupMemberRole(r,e,t).then((function(t){var n=t.data,r=a.map((function(t){return t.email===e?n:t}));s.setState({membersList:r})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteMember=function(e){var t=s.state,n=t.checkedDepartmentId,r=t.membersList;D.H.sysAdminDeleteGroupMember(n,e).then((function(){var t=r.filter((function(t){return t.email!==e}));s.setState({membersList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.sortMembers=function(e,t,s){var n;switch("".concat(t,"-").concat(s)){case"name-asc":n=function(e,t){return m.Aq.compareTwoWord(e.name,t.name)};break;case"name-desc":n=function(e,t){return-m.Aq.compareTwoWord(e.name,t.name)};break;case"role-asc":n=function(e,t){return"Admin"==e.role?-1:1};break;case"role-desc":n=function(e,t){return"Admin"==e.role?1:-1}}return e.sort((function(e,t){return n(e,t)})),e},s.sortItems=function(e,t){s.setState({sortBy:e,sortOrder:t,membersList:s.sortMembers(s.state.membersList,e,t)})},s.onSetQuota=function(e){var t=s.state.rootNodes.slice(0);s._setQuota(t[0],e),s.setState({rootNodes:t})},s._setQuota=function(e,t){e.id===t.id?e.quota=t.quota:e.children.forEach((function(e){s._setQuota(e,t)}))},s.state={rootNodes:[],checkedDepartmentId:-1,operateNode:null,isSetQuotaDialogShow:!1,isAddDepartmentDialogShow:!1,isAddMembersDialogShow:!1,isRenameDepartmentDialogShow:!1,isDeleteDepartmentDialogShow:!1,isShowAddRepoDialog:!1,membersList:[],isTopDepartmentLoading:!1,isMembersListLoading:!1,sortBy:"name",sortOrder:"asc",currentPageInfo:null,currentPage:1,perPage:100},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({isTopDepartmentLoading:!0},(function(){D.H.sysAdminListAllDepartments().then((function(t){var s=t.data.data;if(s&&s.length>0){var n=s.map((function(e){return new pn({id:e.id,name:e.name,orgId:e.org_id,quota:e.quota})}));e.setState({rootNodes:n,checkedDepartmentId:n[0].id}),e.loadDepartmentMembers(n[0].id)}e.setState({isTopDepartmentLoading:!1})}))}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.rootNodes,r=t.operateNode,a=t.checkedDepartmentId,i=t.isAddDepartmentDialogShow,o=t.isAddMembersDialogShow,c=t.membersList,d=t.isMembersListLoading,u=t.isTopDepartmentLoading,h=t.isRenameDepartmentDialogShow,g=t.isDeleteDepartmentDialogShow,m=t.sortBy,f=t.sortOrder;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Departments")})}),(0,v.jsxs)("div",{className:"cur-view-content d-flex flex-row p-0",children:[u&&(0,v.jsx)(w.A,{}),!u&&s.length>0&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Sn,{rootNodes:s,checkedDepartmentId:a,onChangeDepartment:this.onChangeDepartment,listSubDepartments:this.listSubDepartments,toggleAddDepartment:this.toggleAddDepartment,toggleSetQuotaDialog:this.toggleSetQuotaDialog,toggleAddLibrary:this.toggleAddLibrary,toggleAddMembers:this.toggleAddMembers,toggleRename:this.toggleRename,toggleDelete:this.toggleDelete}),(0,v.jsx)(In,{rootNodes:s,checkedDepartmentId:a,membersList:c,isMembersListLoading:d,isAddNewRepo:this.state.isAddNewRepo,setMemberStaff:this.setMemberStaff,deleteMember:this.deleteMember,sortItems:this.sortItems,sortBy:m,sortOrder:f,getRepos:this.getRepos,deleteGroup:this.deleteGroup,createGroup:this.createGroup,toggleAddDepartment:this.toggleAddDepartment,toggleSetQuotaDialog:this.toggleSetQuotaDialog,toggleAddLibrary:this.toggleAddLibrary,toggleAddMembers:this.toggleAddMembers,toggleRename:this.toggleRename,toggleDelete:this.toggleDelete,getPreviousPageList:this.getPreviousPageList,getNextPageList:this.getNextPageList,resetPerPage:this.resetPerPage,currentPageInfo:this.state.currentPageInfo,perPage:this.state.perPage})]}),!u&&0===s.length&&(0,v.jsx)("div",{className:"top-department-button-container h-100 w-100",children:(0,v.jsx)(y.A,{onClick:this.toggleAddDepartment.bind(this,null),children:(0,p.AP)("Enable departments feature")})})]})]})}),o&&(0,v.jsx)(cn.A,{toggle:this.toggleAddMembers,nodeId:r.id,onMemberChanged:this.onMemberChanged}),h&&(0,v.jsx)(dn.A,{node:r,toggle:this.toggleRename,renameDepartment:this.renameDepartment}),g&&(0,v.jsx)(un.A,{node:r,toggle:this.toggleDelete,onDelete:this.onDelete}),i&&(0,v.jsx)(ln.A,{parentNode:r,toggle:this.toggleAddDepartment,addDepartment:this.addDepartment,setRootNode:this.setRootNode}),this.state.isShowAddRepoDialog&&(0,v.jsx)(hn,{toggle:this.toggleAddLibrary,onAddNewRepo:function(){e.setState({isAddNewRepo:!e.state.isAddNewRepo})},groupID:String(r.id)}),this.state.isSetQuotaDialogShow&&(0,v.jsx)(on,{group:r,onSetQuota:this.onSetQuota,toggle:this.toggleSetQuotaDialog})]})}}])}(l.Component)),Cn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"shareLinks",urlPart:"share-links",text:(0,p.AP)("Share Links")},{name:"uploadLinks",urlPart:"upload-links",text:(0,p.AP)("Upload Links")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component),Mn=Cn;L().extend(ue());var Ln=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.props.getShareLinksByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getShareLinksByPage(s.props.currentPage+1)},s.sortByTime=function(e){e.preventDefault(),s.props.sortItems("ctime")},s.sortByCount=function(e){e.preventDefault(),s.props.sortItems("view_cnt")},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.perPage,i=t.currentPage,o=t.hasNextPage,c=t.sortBy,d=t.sortOrder;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var u=(0,v.jsx)(pe.A,{text:(0,p.AP)("No share links")}),h=(0,v.jsx)("span",{className:"sf3-font sf3-font-sort3"}),g=(0,v.jsx)("span",{className:"sf3-font ".concat("asc"==d?"sf3-font-down rotate-180 d-inline-block":"sf3-font-down")}),m=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Token")}),(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"15%",children:(0,v.jsxs)("a",{className:"d-inline-block table-sort-op",href:"#",onClick:this.sortByTime,children:[(0,p.AP)("Created At")," ","ctime"==c?g:h]})}),(0,v.jsx)("th",{width:"10%",children:(0,v.jsxs)("a",{className:"d-inline-block table-sort-op",href:"#",onClick:this.sortByCount,children:[(0,p.AP)("Visit count")," ","view_cnt"==c?g:h]})}),(0,v.jsx)("th",{width:"11%",children:(0,p.AP)("Expiration")}),(0,v.jsx)("th",{width:"10%"})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(_n,{item:t,deleteShareLink:e.props.deleteShareLink},s)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:o,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?m:u}}])}(l.Component),_n=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.deleteShareLink=function(){s.props.deleteShareLink(s.props.item.token)},s.renderExpiration=function(){var e=s.props.item;if(!e.expire_date)return"--";var t=L()(e.expire_date).format("YYYY-MM-DD"),n=L()(e.expire_date).format("YYYY-MM-DD HH:mm:ss");return(0,v.jsx)("span",{className:e.is_expired?"error":"",title:n,children:t})},s.state={isHighlighted:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isHighlighted,n=this.props.item;return(0,v.jsxs)("tr",{className:ge()({"tr-highlight":s}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:n.obj_name}),(0,v.jsx)("td",{children:n.token}),(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:n.creator_email,name:n.creator_name})}),(0,v.jsx)("td",{children:L()(n.ctime).fromNow()}),(0,v.jsx)("td",{children:n.view_cnt}),(0,v.jsx)("td",{children:this.renderExpiration()}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(t?"":"invisible"),title:(0,p.AP)("Remove"),onClick:this.deleteShareLink})})]})}}])}(l.Component),On=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getShareLinksByPage=function(e){var t=s.state,n=t.perPage,r=t.sortBy,a=t.sortOrder;D.H.sysAdminListShareLinks(e,n,r,a).then((function(t){s.setState({shareLinkList:t.data.share_link_list,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,n,t.data.count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.sortItems=function(e){s.setState({currentPage:1,sortBy:e,sortOrder:"asc"==s.state.sortOrder?"desc":"asc"},(function(){var e=new URL(location.href),t=new URLSearchParams(e.search),n=s.state,r=n.currentPage,a=n.sortBy,i=n.sortOrder;t.set("page",r),t.set("order_by",a),t.set("direction",i),e.search=t.toString(),(0,h.oo)(e.toString()),s.getShareLinksByPage(r)}))},s.deleteShareLink=function(e){D.H.sysAdminDeleteShareLink(e).then((function(t){var n=s.state.shareLinkList.filter((function(t){return t.token!=e}));s.setState({shareLinkList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getShareLinksByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",shareLinkList:[],perPage:100,currentPage:1,hasNextPage:!1,sortBy:"",sortOrder:"asc"},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage,a=s.sortBy,i=s.sortOrder;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n),sortBy:t.get("order_by")||a,sortOrder:t.get("direction")||i},(function(){e.getShareLinksByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.shareLinkList,s=e.currentPage,r=e.perPage,a=e.hasNextPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Mn,{currentItem:"shareLinks"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ln,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:r,hasNextPage:a,getShareLinksByPage:this.getShareLinksByPage,resetPerPage:this.resetPerPage,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortItems:this.sortItems,deleteShareLink:this.deleteShareLink})})]})})]})}}])}(l.Component);L().extend(ue());var Un=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.props.getUploadLinksByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getUploadLinksByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.perPage,i=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var c=(0,v.jsx)(pe.A,{text:(0,p.AP)("No upload links")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Token")}),(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Created At")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Visit count")}),(0,v.jsx)("th",{width:"11%",children:(0,p.AP)("Expiration")}),(0,v.jsx)("th",{width:"10%"})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Tn,{item:t,deleteUploadLink:e.props.deleteUploadLink},s)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:o,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),Tn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.deleteUploadLink=function(){s.props.deleteUploadLink(s.props.item.token)},s.renderExpiration=function(){var e=s.props.item;if(!e.expire_date)return"--";var t=L()(e.expire_date).format("YYYY-MM-DD"),n=L()(e.expire_date).format("YYYY-MM-DD HH:mm:ss");return(0,v.jsx)("span",{className:e.is_expired?"error":"",title:n,children:t})},s.state={isHighlighted:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.isOpIconShown,s=e.isHighlighted,n=this.props.item;return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:ge()({"tr-highlight":s}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:n.path}),(0,v.jsx)("td",{children:n.token}),(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:n.creator_email,name:n.creator_name})}),(0,v.jsx)("td",{children:L()(n.ctime).fromNow()}),(0,v.jsx)("td",{children:n.view_cnt}),(0,v.jsx)("td",{children:this.renderExpiration()}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(t?"":"invisible"),title:(0,p.AP)("Remove"),onClick:this.deleteUploadLink})})]})})}}])}(l.Component),Rn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getUploadLinksByPage=function(e){var t=s.state.perPage;D.H.sysAdminListAllUploadLinks(e,t).then((function(n){s.setState({uploadLinkList:n.data.upload_link_list,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteUploadLink=function(e){D.H.sysAdminDeleteUploadLink(e).then((function(t){var n=s.state.uploadLinkList.filter((function(t){return t.token!=e}));s.setState({uploadLinkList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getUploadLinksByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",uploadLinkList:[],perPage:100,currentPage:1,hasNextPage:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getUploadLinksByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.uploadLinkList,s=e.currentPage,r=e.perPage,a=e.hasNextPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Mn,{currentItem:"uploadLinks"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Un,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:r,hasNextPage:a,getUploadLinksByPage:this.getUploadLinksByPage,resetPerPage:this.resetPerPage,deleteUploadLink:this.deleteUploadLink})})]})})]})}}])}(l.Component),Fn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).checkSubmitBtnActive=function(){var e=s.state,t=e.name,n=e.email,r=e.password,a=e.passwordAgain,i=!0;i=""!=t.trim()&&""!=n.trim()&&""!=r.trim()&&""!=a.trim(),s.setState({isSubmitBtnActive:i})},s.toggle=function(){s.props.toggleDialog()},s.inputPassword=function(e){var t=e.target.value;s.setState({password:t},s.checkSubmitBtnActive)},s.inputPasswordAgain=function(e){var t=e.target.value;s.setState({passwordAgain:t},s.checkSubmitBtnActive)},s.inputEmail=function(e){var t=e.target.value;s.setState({email:t},s.checkSubmitBtnActive)},s.inputName=function(e){var t=e.target.value;s.setState({name:t},s.checkSubmitBtnActive)},s.handleSubmit=function(){var e=s.state,t=e.name,n=e.email,r=e.password;if(r==e.passwordAgain){var a={orgName:t.trim(),ownerEmail:n.trim(),password:r.trim()};s.props.addOrg(a),s.toggle()}else s.setState({errorMsg:(0,p.AP)("Passwords do not match.")})},s.state={name:"",email:"",password:"",passwordAgain:"",errorMsg:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.errorMsg,s=e.password,n=e.passwordAgain,r=e.email,a=e.name,i=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("Add Organization")}),(0,v.jsxs)(be.A,{children:[(0,v.jsxs)(Le.A,{autoComplete:"off",children:[(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Name")}),(0,v.jsx)(Q.A,{value:a,onChange:this.inputName})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsxs)(Oe.A,{children:[(0,p.AP)("Owner"),(0,v.jsx)("span",{className:"small text-secondary ml-1 sf3-font sf3-font-tips",title:(0,p.AP)("Owner can use admin panel in an organization, must be a new account.")})]}),(0,v.jsx)(Q.A,{value:r,onChange:this.inputEmail})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Password")}),(0,v.jsx)(Q.A,{type:"password",value:s,onChange:this.inputPassword})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Password again")}),(0,v.jsx)(Q.A,{type:"password",value:n,onChange:this.inputPasswordAgain})]})]}),t&&(0,v.jsx)(Ie.A,{color:"danger",children:t})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!i,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),En=window.sysadmin.pageOptions.availableRoles,Bn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a="".concat((0,p.AP)("Created At")," / ").concat((0,p.AP)("Last Access"));if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var i=(0,v.jsx)(pe.A,{text:(0,p.AP)("No organizations")}),o=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Creator")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Role")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Space Used")}),(0,v.jsx)("th",{width:"20%",children:a}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(zn,{item:t,updateRole:e.props.updateRole,updateStatus:e.props.updateStatus,deleteOrg:e.props.deleteOrg,isItemFreezed:e.state.isItemFreezed,toggleItemFreezed:e.toggleItemFreezed},s)}))})]}),this.props.currentPage&&(0,v.jsx)(X.A,{currentPage:this.props.currentPage,hasNextPage:this.props.hasNextPage,curPerPage:this.props.curPerPage,resetPerPage:this.props.resetPerPage,gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage})]});return r.length?o:i}}])}(l.Component),zn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({highlighted:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({highlighted:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen},(function(){s.state.isDeleteDialogOpen&&D.H.sysAdminGetOrg(s.props.item.org_id).then((function(e){var t='<span class="op-target">'+m.Aq.HTMLescape(e.data.org_name)+"</span>",n='<span class="op-target">'+m.Aq.HTMLescape(e.data.users_count)+"</span>",r='<span class="op-target">'+m.Aq.HTMLescape(e.data.repos_count)+"</span>",a=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",t)+"<br/>"+(0,p.AP)("{userCount} user(s) and {repoCount} libraries of this organization will also be deleted.").replace("{userCount}",n).replace("{repoCount}",r);s.setState({deleteDialogMsg:a})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}))},s.toggleConfirmInactiveDialog=function(){s.setState({isConfirmInactiveDialogOpen:!s.state.isConfirmInactiveDialogOpen})},s.translateStatus=function(e){switch(e){case"active":return(0,p.AP)("Active");case"inactive":return(0,p.AP)("Inactive")}},s.updateStatus=function(e){var t="active"==e.value;t&&N.A.notify((0,p.AP)("It may take some time, please wait.")),s.props.updateStatus(s.props.item.org_id,t)},s.setOrgInactive=function(){s.props.updateStatus(s.props.item.org_id,!1)},s.translateRole=function(e){switch(e){case"default":return(0,p.AP)("Default");case"guest":return(0,p.AP)("Guest");default:return e}},s.updateRole=function(e){s.props.updateRole(s.props.item.org_id,e.value)},s.deleteOrg=function(){N.A.notify((0,p.AP)("It may take some time, please wait.")),s.props.deleteOrg(s.props.item.org_id)},s.state={highlighted:!1,isDeleteDialogOpen:!1,deleteDialogMsg:"",isConfirmInactiveDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props.item,s=this.state,n=s.highlighted,r=s.isDeleteDialogOpen,a=s.deleteDialogMsg,i=s.isConfirmInactiveDialogOpen,o=t.role;this.roleOptions=En.map((function(t){return{value:t,text:e.translateRole(t),isSelected:t==o}}));var c=this.roleOptions.filter((function(e){return e.isSelected}))[0],d=t.is_active?"active":"inactive";this.statusOptions=["active","inactive"].map((function(t){return{value:t,text:e.translateStatus(t),isSelected:t==d}}));var u=this.statusOptions.filter((function(e){return e.isSelected}))[0],g=(0,p.AP)("Are you sure you want to set {user_placeholder} inactive?").replace("{user_placeholder}",m.Aq.HTMLescape(t.org_name));return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:n?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/organizations/").concat(t.org_id,"/info/"),children:t.org_name})}),(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:t.creator_email,name:t.creator_name})}),(0,v.jsx)("td",{children:(0,v.jsx)(We.A,{isDropdownToggleShown:n,currentSelectedOption:u,options:this.statusOptions,selectOption:this.updateStatus,toggleItemFreezed:this.props.toggleItemFreezed,operationBeforeSelect:t.is_active?this.toggleConfirmInactiveDialog:void 0})}),(0,v.jsx)("td",{children:(0,v.jsx)(We.A,{isDropdownToggleShown:n,currentSelectedOption:c,options:this.roleOptions,selectOption:this.updateRole,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(t.quota_usage)," / ").concat(t.quota>0?m.Aq.bytesToSize(t.quota):"--")}),(0,v.jsxs)("td",{children:["".concat(L()(t.ctime).format("YYYY-MM-DD HH:mm:ss")," /"),(0,v.jsx)("br",{}),"".concat(t.last_activity_time?L()(t.last_activity_time).fromNow():"--"," ")]}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(n?"":"invisible"),title:(0,p.AP)("Delete"),onClick:this.toggleDeleteDialog})})]}),r&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Organization"),message:a,executeOperation:this.deleteOrg,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteDialog}),i&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Set organization inactive"),message:g,executeOperation:this.setOrgInactive,confirmBtnText:(0,p.AP)("Set"),toggleDialog:this.toggleConfirmInactiveDialog})]})}}])}(l.Component),qn=Bn,Hn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getItemsByPage=function(e){var t=s.state.perPage;D.H.sysAdminListOrgs(e,t).then((function(n){s.setState({loading:!1,orgList:n.data.organizations,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getItemsByPage(1)}))},s.toggleAddOrgDialog=function(){s.setState({isAddOrgDialogOpen:!s.state.isAddOrgDialogOpen})},s.updateStatus=function(e,t){var n={};n.isActive=t,D.H.sysAdminUpdateOrg(e,n).then((function(n){var r=s.state.orgList.map((function(s){return s.org_id==e&&(s.is_active=t),s}));s.setState({orgList:r}),N.A.success((0,p.AP)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateRole=function(e,t){var n={};n.role=t,D.H.sysAdminUpdateOrg(e,n).then((function(n){var r=s.state.orgList.map((function(s){return s.org_id==e&&(s.role=t),s}));s.setState({orgList:r}),N.A.success((0,p.AP)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.addOrg=function(e){var t=e.orgName,n=e.ownerEmail,r=e.password;D.H.sysAdminAddOrg(t,n,r).then((function(e){var t=s.state.orgList;t.unshift(e.data),s.setState({orgList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteOrg=function(e){D.H.sysAdminDeleteOrg(e).then((function(t){var n=s.state.orgList.filter((function(t){return t.org_id!=e}));s.setState({orgList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.getSearch=function(){return(0,v.jsx)(Ge.A,{placeholder:(0,p.AP)("Search organizations"),submit:s.searchItems})},s.searchItems=function(e){(0,h.oo)("".concat(p.Yc,"sys/search-organizations/?query=").concat(encodeURIComponent(e)))},s.state={loading:!0,errorMsg:"",orgList:[],currentPage:1,perPage:100,hasNextPage:!1,isAddOrgDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getItemsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state.isAddOrgDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({search:this.getSearch()},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddOrgDialog,children:(0,p.AP)("Add Organization")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Organizations")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(qn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.orgList,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getItemsByPage,updateRole:this.updateRole,updateStatus:this.updateStatus,deleteOrg:this.deleteOrg})})]})}),e&&(0,v.jsx)(Fn,{addOrg:this.addOrg,toggleDialog:this.toggleAddOrgDialog})]})}}])}(l.Component),Yn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getItems=function(){D.H.sysAdminSearchOrgs(s.state.query.trim()).then((function(e){s.setState({loading:!1,orgList:e.data.organization_list})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.updateRole=function(e,t){var n={};n.role=t,D.H.sysAdminUpdateOrg(e,n).then((function(n){var r=s.state.orgList.map((function(s){return s.org_id==e&&(s.role=t),s}));s.setState({orgList:r}),N.A.success((0,p.AP)("Edit succeeded"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteOrg=function(e){D.H.sysAdminDeleteOrg(e).then((function(t){var n=s.state.orgList.filter((function(t){return t.org_id!=e}));s.setState({orgList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.handleInputChange=function(e){s.setState({query:e.target.value},s.checkSubmitBtnActive)},s.checkSubmitBtnActive=function(){var e=s.state.query;s.setState({isSubmitBtnActive:e.trim()})},s.handleKeyDown=function(e){13===e.keyCode&&(s.state.isSubmitBtnActive&&s.getItems())},s.state={query:"",isSubmitBtnActive:!1,loading:!0,errorMsg:"",orgList:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=new URL(document.location).searchParams;this.setState({query:e.get("query")||""},this.getItems)}},{key:"render",value:function(){var e=this.state,t=e.query,s=e.isSubmitBtnActive;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Organizations")})}),(0,v.jsxs)("div",{className:"cur-view-content",children:[(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Search Organizations")}),(0,v.jsx)("p",{className:"text-secondary small",children:(0,p.AP)("Tip: you can search by keyword in name.")}),(0,v.jsxs)(Le.A,{tag:"div",children:[(0,v.jsxs)(_e.A,{row:!0,children:[(0,v.jsx)(Oe.A,{for:"name",sm:1,children:(0,p.AP)("Name")}),(0,v.jsx)(vt.A,{sm:5,children:(0,v.jsx)(Q.A,{type:"text",name:"query",id:"name",value:t,onChange:this.handleInputChange,onKeyDown:this.handleKeyDown})})]}),(0,v.jsx)(_e.A,{row:!0,children:(0,v.jsx)(vt.A,{sm:{size:5,offset:1},children:(0,v.jsx)("button",{className:"btn btn-outline-primary",disabled:!s,onClick:this.getItems,children:(0,p.AP)("Submit")})})})]})]}),(0,v.jsxs)("div",{className:"mt-4 mb-6",children:[(0,v.jsx)("h4",{className:"border-bottom font-weight-normal mb-2 pb-1",children:(0,p.AP)("Result")}),(0,v.jsx)(qn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.orgList,updateRole:this.updateRole,deleteOrg:this.deleteOrg})]})]})]})})]})}}])}(l.Component),Gn=s(97176),Qn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleInputChange=function(e){var t=e.target.value;s.setState({name:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateName(s.state.name.trim()),s.toggle()},s.state={name:s.props.name,isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.name,s=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("Set Name")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Le.A,{children:(0,v.jsx)(_e.A,{children:(0,v.jsx)(Q.A,{type:"text",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleInputChange})})})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),Vn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.toggle()},s.handleInputChange=function(e){var t=e.target.value;s.setState({value:t,isSubmitBtnActive:""!=t.trim()})},s.handleKeyDown=function(e){"Enter"==e.key&&(s.handleSubmit(),e.preventDefault())},s.handleSubmit=function(){s.props.updateValue(s.state.value.trim()),s.toggle()},s.state={value:s.props.value,isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state,t=e.value,s=e.isSubmitBtnActive;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("Set max number of members")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Le.A,{children:(0,v.jsx)(_e.A,{children:(0,v.jsx)(Q.A,{type:"text",className:"form-control",value:t,onKeyDown:this.handleKeyDown,onChange:this.handleInputChange})})})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!s,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),Wn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"info",urlPart:"info",text:(0,p.AP)("Info")},{name:"users",urlPart:"users",text:(0,p.AP)("Members")},{name:"groups",urlPart:"groups",text:(0,p.AP)("Groups")},{name:"repos",urlPart:"libraries",text:(0,p.AP)("Libraries")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.currentItem,s=e.orgID,n=e.orgName;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/organizations/"),children:(0,p.AP)("Organizations")})," / ",n]})}),(0,v.jsx)("ul",{className:"nav border-bottom mx-4",children:this.navItems.map((function(e,n){return(0,v.jsx)("li",{className:"nav-item mr-2",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/organizations/").concat(s,"/").concat(e.urlPart,"/"),className:"nav-link ".concat(t==e.name?" active":""),children:e.text})},n)}))})]})}}])}(l.Component),Kn=Wn,Xn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.toggleSetNameDialog=function(){s.setState({isSetNameDialogOpen:!s.state.isSetNameDialogOpen})},s.toggleSetMaxUserNumberDialog=function(){s.setState({isSetMaxUserNumberDialogOpen:!s.state.isSetMaxUserNumberDialogOpen})},s.state={isSetQuotaDialogOpen:!1,isSetNameDialogOpen:!1,isSetMaxUserNumberDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var n=this.props.orgInfo,r=n.org_name,a=n.users_count,i=n.max_user_number,o=n.groups_count,l=n.quota,c=n.quota_usage,d=n.enable_saml_login,u=n.metadata_url,h=n.domain,g=this.state,f=g.isSetQuotaDialogOpen,x=g.isSetNameDialogOpen,A=g.isSetMaxUserNumberDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("dl",{className:"m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Name")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[r,(0,v.jsx)(Pt.A,{onClick:this.toggleSetNameDialog})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Number of members")}),(0,v.jsx)("dd",{className:"info-item-content",children:a}),i&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Max number of members")}),(0,v.jsxs)("dd",{className:"info-item-content",children:[i,(0,v.jsx)(Pt.A,{onClick:this.toggleSetMaxUserNumberDialog})]})]}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Number of groups")}),(0,v.jsx)("dd",{className:"info-item-content",children:o}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Space Used")}),(0,v.jsxs)("dd",{className:"info-item-content",children:["".concat(m.Aq.bytesToSize(c)," / ").concat(l>0?m.Aq.bytesToSize(l):"--"),(0,v.jsx)(Pt.A,{onClick:this.toggleSetQuotaDialog})]}),d&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("SAML Config")}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Gn.A,{className:"my-4",children:[(0,v.jsx)(vt.A,{md:"4",children:"Identifier (Entity ID)"}),(0,v.jsx)(vt.A,{md:"6",children:"".concat(p.xW,"/org/custom/").concat(this.props.orgID,"/saml2/metadata/")})]})}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Gn.A,{className:"my-4",children:[(0,v.jsx)(vt.A,{md:"4",children:"Reply URL (Assertion Consumer Service URL)"}),(0,v.jsx)(vt.A,{md:"6",children:"".concat(p.xW,"/org/custom/").concat(this.props.orgID,"/saml2/acs/")})]})}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Gn.A,{className:"my-4",children:[(0,v.jsx)(vt.A,{md:"4",children:"SAML App Federation Metadata URL"}),(0,v.jsx)(vt.A,{md:"6",children:u})]})}),(0,v.jsx)("dd",{className:"info-item-content",children:(0,v.jsxs)(Gn.A,{className:"my-4",children:[(0,v.jsx)(vt.A,{md:"4",children:(0,p.AP)("Email Domain")}),(0,v.jsx)(vt.A,{md:"6",children:h})]})})]})]}),f&&(0,v.jsx)(we.A,{updateQuota:this.props.updateQuota,toggle:this.toggleSetQuotaDialog}),x&&(0,v.jsx)(Qn,{name:r,updateName:this.props.updateName,toggle:this.toggleSetNameDialog}),A&&(0,v.jsx)(Vn,{value:i,updateValue:this.props.updateMaxUserNumber,toggle:this.toggleSetMaxUserNumberDialog})]})}}])}(l.Component),$n=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).updateQuota=function(e){var t={quota:e};D.H.sysAdminUpdateOrg(s.props.orgID,t).then((function(e){var t=Object.assign(s.state.orgInfo,{quota:e.data.quota});s.setState({orgInfo:t}),N.A.success((0,p.AP)("Successfully set quota."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateName=function(e){var t={orgName:e};D.H.sysAdminUpdateOrg(s.props.orgID,t).then((function(e){var t=Object.assign(s.state.orgInfo,{org_name:e.data.org_name});s.setState({orgInfo:t}),N.A.success((0,p.AP)("Successfully set name."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateMaxUserNumber=function(e){var t={maxUserNumber:e};D.H.sysAdminUpdateOrg(s.props.orgID,t).then((function(e){var t=Object.assign(s.state.orgInfo,{max_user_number:e.data.max_user_number});s.setState({orgInfo:t}),N.A.success((0,p.AP)("Successfully set max number of members."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgInfo:{}},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({loading:!1,orgInfo:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.orgInfo;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Kn,{currentItem:"info",orgID:this.props.orgID,orgName:e.org_name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Xn,{orgID:this.props.orgID,loading:this.state.loading,errorMsg:this.state.errorMsg,orgInfo:this.state.orgInfo,updateQuota:this.updateQuota,updateName:this.updateName,updateMaxUserNumber:this.updateMaxUserNumber})})]})})]})}}])}(l.Component);L().extend(ue());var Jn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleItemFreezed=function(e){s.setState({isItemFreezed:e})},s.onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No members")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Role")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Space Used")}),(0,v.jsxs)("th",{width:"25%",children:[(0,p.AP)("Created At")," / ",(0,p.AP)("Last Login")]}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Zn,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,toggleItemFreezed:e.toggleItemFreezed,updateStatus:e.props.updateStatus,updateMembership:e.props.updateMembership,deleteUser:e.props.deleteUser},s)}))})]})});return r.length?i:a}}])}(l.Component),Zn=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){switch(e){case"Delete":s.toggleDeleteDialog();break;case"Reset Password":s.toggleResetPasswordDialog()}},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleResetPasswordDialog=function(e){e&&e.preventDefault(),s.setState({isResetPasswordDialogOpen:!s.state.isResetPasswordDialogOpen})},s.toggleConfirmInactiveDialog=function(e){"active"!==(null===e||void 0===e?void 0:e.value)&&s.setState({isConfirmInactiveDialogOpen:!s.state.isConfirmInactiveDialogOpen})},s.updateStatus=function(e){s.props.updateStatus(s.props.item.email,e.value)},s.setUserInactive=function(e){s.props.updateStatus(s.props.item.email,"inactive",{keepSharing:e})},s.updateMembership=function(e){s.props.updateMembership(s.props.item.email,e.value)},s.deleteUser=function(){var e=s.props.item;s.props.deleteUser(e.org_id,e.email)},s.resetPassword=function(){D.H.sysAdminResetUserPassword(s.props.item.email).then((function(e){N.A.success(e.data.reset_tip)})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.AP)("Delete");break;case"Reset Password":t=(0,p.AP)("Reset Password")}return t},s.translateStatus=function(e){switch(e){case"active":return(0,p.AP)("Active");case"inactive":return(0,p.AP)("Inactive")}},s.translateMembership=function(e){switch(e){case"Admin":return(0,p.AP)("Admin");case"Member":return(0,p.AP)("Member")}},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1,isResetPasswordDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props.item,s=this.state,n=s.highlight,r=s.isOpIconShown,a=s.isDeleteDialogOpen,i=s.isResetPasswordDialogOpen,o=s.isConfirmInactiveDialogOpen,c='<span class="op-target">'+m.Aq.HTMLescape(t.name)+"</span>",d=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",c),u=(0,p.AP)("Are you sure you want to reset the password of {placeholder} ?").replace("{placeholder}",c),h=t.active?"active":"inactive";this.statusOptions=["active","inactive"].map((function(t){return{value:t,text:e.translateStatus(t),isSelected:t==h}}));var g=this.statusOptions.filter((function(e){return e.isSelected}))[0],f=t.is_org_staff?"Admin":"Member";this.membershipOptions=["Admin","Member"].map((function(t){return{value:t,text:e.translateMembership(t),isSelected:t==f}}));var x=this.membershipOptions.filter((function(e){return e.isSelected}))[0];return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:t.email,name:t.name})}),(0,v.jsx)("td",{children:(0,v.jsx)(We.A,{isDropdownToggleShown:n,currentSelectedOption:g,options:this.statusOptions,selectOption:this.updateStatus,toggleItemFreezed:this.props.toggleItemFreezed,operationBeforeSelect:t.active?this.toggleConfirmInactiveDialog:void 0})}),(0,v.jsx)("td",{children:(0,v.jsx)(We.A,{isDropdownToggleShown:n,currentSelectedOption:x,options:this.membershipOptions,selectOption:this.updateMembership,toggleItemFreezed:this.props.toggleItemFreezed})}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(t.quota_usage)," / ").concat(t.quota_total>0?m.Aq.bytesToSize(t.quota_total):"--")}),(0,v.jsxs)("td",{children:[L()(t.create_time).format("YYYY-MM-DD HH:mm:ss")," / ",t.last_login?L()(t.last_login).fromNow():"--"]}),(0,v.jsx)("td",{children:r&&t.email!=p.Xh&&(0,v.jsx)(Je.A,{operations:["Delete","Reset Password"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),a&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Member"),message:d,executeOperation:this.deleteUser,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteDialog}),i&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Reset Password"),message:u,executeOperation:this.resetPassword,confirmBtnText:(0,p.AP)("Reset"),toggleDialog:this.toggleResetPasswordDialog}),o&&(0,v.jsx)(Ze,{toggleDialog:this.toggleConfirmInactiveDialog,onSubmit:this.setUserInactive})]})}}])}(l.Component),er=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleAddUserDialog=function(){s.setState({isAddUserDialogOpen:!s.state.isAddUserDialogOpen})},s.addUser=function(e){var t=e.email,n=e.name,r=e.password;D.H.sysAdminAddOrgUser(s.props.orgID,t,n,r).then((function(e){var t=s.state.userList;t.unshift(e.data),s.setState({userList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteUser=function(e,t){D.H.sysAdminDeleteOrgUser(e,t).then((function(e){var n=s.state.userList.filter((function(e){return e.email!=t}));s.setState({userList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateStatus=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="active"==t;D.H.sysAdminUpdateOrgUser(s.props.orgID,e,"active",r,n).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.active=t.data.active),s}));s.setState({userList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateMembership=function(e,t){var n="Admin"==t;D.H.sysAdminUpdateOrgUser(s.props.orgID,e,"is_org_staff",n).then((function(t){var n=s.state.userList.map((function(s){return s.email==e&&(s.is_org_staff=t.data.is_org_staff),s}));s.setState({userList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgName:"",userList:[],isAddUserDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({orgName:t.data.org_name})})),D.H.sysAdminListOrgUsers(this.props.orgID).then((function(t){e.setState({loading:!1,userList:t.data.users})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.isAddUserDialogOpen,s=e.orgName;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddUserDialog,children:(0,p.AP)("Add Member")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Kn,{currentItem:"users",orgID:this.props.orgID,orgName:s}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Jn,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,updateStatus:this.updateStatus,updateMembership:this.updateMembership,deleteUser:this.deleteUser})})]})}),t&&(0,v.jsx)(Ee,{addUser:this.addUser,toggleDialog:this.toggleAddUserDialog})]})}}])}(l.Component),tr=er,sr=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No groups")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Creator")}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Created At")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(nr,{item:t,deleteGroup:e.props.deleteGroup},s)}))})]})});return r.length?i:a}}])}(l.Component),nr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleDeleteDialog=function(){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteGroup=function(){s.toggleDeleteDialog(),s.props.deleteGroup(s.props.item.group_id)},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isHighlighted,a='<span class="op-target">'+m.Aq.HTMLescape(e.group_name)+"</span>",i=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",a),o="".concat(p.Yc,"sys/groups/").concat(e.group_id,"/libraries/");return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:ge()({"tr-highlight":r}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("a",{href:o,children:e.group_name})}),(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.creator_email,name:e.creator_name})}),(0,v.jsx)("td",{children:L()(e.created_at).format("YYYY-MM-DD HH:mm:ss")}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(s?"":"invisible"),title:(0,p.AP)("Delete"),onClick:this.toggleDeleteDialog})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Group"),message:i,executeOperation:this.deleteGroup,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),rr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).deleteGroup=function(e){D.H.sysAdminDismissGroupByID(e).then((function(t){var n=s.state.groupList.filter((function(t){return t.group_id!=e}));s.setState({groupList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgName:"",groupList:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({orgName:t.data.org_name})})),D.H.sysAdminListOrgGroups(this.props.orgID).then((function(t){e.setState({loading:!1,groupList:t.data.group_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Kn,{currentItem:"groups",orgID:this.props.orgID,orgName:this.state.orgName}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(sr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.groupList,deleteGroup:this.deleteGroup})})]})})]})}}])}(l.Component),ar=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No libraries")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%"}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"35%",children:"ID"}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"10%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(ir,{item:t,deleteRepo:e.props.deleteRepo},s)}))})]})});return r.length?i:a}}])}(l.Component),ir=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteRepo=function(){s.props.deleteRepo(s.props.item.repo_id)},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isHighlighted,a=m.Aq.getLibIconUrl(e),i=m.Aq.getLibIconTitle(e),o='<span class="op-target">'+m.Aq.HTMLescape(e.repo_name)+"</span>",c=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:ge()({"tr-highlight":r}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)("img",{src:a,title:i,alt:i,width:"24"})}),(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_id}),(0,v.jsx)("td",{children:e.owner_email?-1==e.owner_email.indexOf("@seafile_group")?(0,v.jsx)(Se,{email:e.owner_email,name:e.owner_name}):e.owner_name:"--"}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(s?"":"invisible"),title:(0,p.AP)("Delete"),onClick:this.toggleDeleteDialog})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Library"),message:c,executeOperation:this.deleteRepo,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),or=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).deleteRepo=function(e){D.H.sysAdminDeleteRepo(e).then((function(t){var n=s.state.repoList.filter((function(t){return t.repo_id!=e}));s.setState({repoList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",orgName:"",repoList:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetOrg(this.props.orgID).then((function(t){e.setState({orgName:t.data.org_name})})),D.H.sysAdminListOrgRepos(this.props.orgID).then((function(t){e.setState({loading:!1,repoList:t.data.repo_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Kn,{currentItem:"repos",orgID:this.props.orgID,orgName:this.state.orgName}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ar,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.repoList,deleteRepo:this.deleteRepo})})]})})]})}}])}(l.Component),lr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleChange=function(e){var t=e.target.value;s.setState({value:t,isSubmitBtnActive:""!=t.trim()})},s.handleSubmit=function(){s.toggle(),s.props.addInstitution(s.state.value.trim())},s.toggle=function(){s.props.toggle()},s.state={value:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("Add institution")}),(0,v.jsx)(be.A,{children:(0,v.jsxs)(Le.A,{children:[(0,v.jsx)("p",{children:(0,p.AP)("Name")}),(0,v.jsx)(_e.A,{children:(0,v.jsx)(Q.A,{name:"institution-name",value:this.state.value,onChange:this.handleChange})})]})}),(0,v.jsx)(ke.A,{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.AP)("Submit")})})]})}}])}(l.Component);L().extend(ue());var cr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.props.getInstitutionsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getInstitutionsByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.perPage,i=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var c=(0,v.jsx)(pe.A,{text:(0,p.AP)("No institutions")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"75%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Created At")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(dr,{item:t,deleteInstitution:e.props.deleteInstitution},s)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:o,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),dr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.setState({isHighlighted:!0,isOpIconShown:!0})},s.handleMouseLeave=function(){s.setState({isHighlighted:!1,isOpIconShown:!1})},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteInstitution=function(){s.props.deleteInstitution(s.props.item.id)},s.state={isHighlighted:!1,isOpIconShown:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen,r=t.isHighlighted,a='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",i=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",a);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:ge()({"tr-highlight":r}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/institutions/").concat(e.id,"/info/"),children:e.name})}),(0,v.jsx)("td",{children:L()(e.ctime).fromNow()}),(0,v.jsx)("td",{children:(0,v.jsx)("i",{className:"op-icon sf3-font-delete1 sf3-font ".concat(s?"":"invisible"),title:(0,p.AP)("Delete"),onClick:this.toggleDeleteDialog})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Institution"),message:i,executeOperation:this.deleteInstitution,confirmBtnText:(0,p.AP)("Delete"),toggleDialog:this.toggleDeleteDialog})]})}}])}(l.Component),ur=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getInstitutionsByPage=function(e){var t=s.state.perPage;D.H.sysAdminListInstitutions(e,t).then((function(n){s.setState({loading:!1,institutionList:n.data.institution_list,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getInstitutionsByPage(s.initPage)}))},s.toggleAddInstitutionDialog=function(){s.setState({isAddInstitutionDialogOpen:!s.state.isAddInstitutionDialogOpen})},s.addInstitution=function(e){D.H.sysAdminAddInstitution(e).then((function(e){var t=s.state.institutionList;t.push(e.data),s.setState({institutionList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteInstitution=function(e){D.H.sysAdminDeleteInstitution(e).then((function(t){var n=s.state.institutionList.filter((function(t){return t.id!=e}));s.setState({institutionList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionList:[],perPage:100,currentPage:1,hasNextPage:!1,isAddInstitutionDialogOpen:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getInstitutionsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isAddInstitutionDialogOpen,s=e.hasNextPage,r=e.currentPage,a=e.perPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddInstitutionDialog,children:(0,p.AP)("Add Institution")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Institutions")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(cr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.institutionList,deleteInstitution:this.deleteInstitution,currentPage:r,perPage:a,hasNextPage:s,getInstitutionsByPage:this.getInstitutionsByPage,resetPerPage:this.resetPerPage})})]})}),t&&(0,v.jsx)(lr,{addInstitution:this.addInstitution,toggle:this.toggleAddInstitutionDialog})]})}}])}(l.Component),hr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"info",urlPart:"info",text:(0,p.AP)("Info")},{name:"members",urlPart:"members",text:(0,p.AP)("Members")},{name:"admins",urlPart:"admins",text:(0,p.AP)("Admins")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.currentItem,s=e.institutionID,n=e.institutionName;return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsxs)("h3",{className:"sf-heading",children:[(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/institutions/"),children:(0,p.AP)("Institutions")})," / ",n]})}),(0,v.jsx)("ul",{className:"nav border-bottom mx-4",children:this.navItems.map((function(e,n){return(0,v.jsx)("li",{className:"nav-item mr-2",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/institutions/").concat(s,"/").concat(e.urlPart,"/"),className:"nav-link ".concat(t==e.name?" active":""),children:e.text})},n)}))})]})}}])}(l.Component),gr=hr,pr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleSetQuotaDialog=function(){s.setState({isSetQuotaDialogOpen:!s.state.isSetQuotaDialogOpen})},s.state={isSetQuotaDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.institutionInfo;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var r=n.name,a=n.user_count,i=n.quota_total,o=n.quota_used,l=this.state.isSetQuotaDialogOpen;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("dl",{className:"m-0",children:[(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Name")}),(0,v.jsx)("dd",{className:"info-item-content",children:r}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Number of members")}),(0,v.jsx)("dd",{className:"info-item-content",children:a}),(0,v.jsx)("dt",{className:"info-item-heading",children:(0,p.AP)("Space Used")}),(0,v.jsxs)("dd",{className:"info-item-content",children:["".concat(m.Aq.bytesToSize(o)," / ").concat(i>0?m.Aq.bytesToSize(i):"--"),(0,v.jsx)(Pt.A,{onClick:this.toggleSetQuotaDialog})]})]}),l&&(0,v.jsx)(we.A,{updateQuota:this.props.updateQuota,toggle:this.toggleSetQuotaDialog})]})}}])}(l.Component),mr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).updateQuota=function(e){D.H.sysAdminUpdateInstitution(s.props.institutionID,e).then((function(e){var t=Object.assign(s.state.institutionInfo,{quota_total:e.data.quota_total});s.setState({institutionInfo:t}),N.A.success((0,p.AP)("Successfully set quota."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionInfo:{}},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetInstitution(this.props.institutionID).then((function(t){e.setState({loading:!1,institutionInfo:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.institutionInfo;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(gr,{currentItem:"info",institutionID:this.props.institutionID,institutionName:e.name}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(pr,{loading:this.state.loading,errorMsg:this.state.errorMsg,institutionInfo:this.state.institutionInfo,updateQuota:this.updateQuota})})]})})]})}}])}(l.Component),fr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleSelectChange=function(e){s.setState({selectedUsers:e})},s.handleSubmit=function(){if(s.state.selectedUsers){var e=s.state.selectedUsers.map((function(e){return e.email}));s.props.addUser(e)}},s.state={selectedUsers:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggle,children:(0,p.AP)("Add Member")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Be.A,{placeholder:(0,p.AP)("Search users"),onSelectChange:this.handleSelectChange,isMulti:!0,className:"org-add-member-select",selectedUsers:this.state.selectedUsers})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:(0,p.AP)("Submit")}),(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.AP)("Cancel")})]})]})}}])}(l.Component);L().extend(ue());var xr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getInstitutionUsersByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getInstitutionUsersByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.perPage,i=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var c=(0,v.jsx)(pe.A,{text:(0,p.AP)("No members")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Space Used")}),(0,v.jsxs)("th",{width:"40%",children:[(0,p.AP)("Created At")," / ",(0,p.AP)("Last Login")]}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(vr,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,setAdmin:e.props.setAdmin,deleteUser:e.props.deleteUser},s)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:o,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),vr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleSetAdminDialog=function(e){e&&e.preventDefault(),s.setState({isSetAdminDialogOpen:!s.state.isSetAdminDialogOpen})},s.setAdmin=function(){s.props.setAdmin(s.props.item.email)},s.onMenuItemClick=function(e){switch(e){case"Delete":s.props.deleteUser(s.props.item.email);break;case"Set Admin":s.toggleSetAdminDialog()}},s.getOperations=function(){var e=[];return s.props.item.is_institution_admin||e.push("Set Admin"),e.push("Delete"),e},s.translateOperations=function(e){var t="";switch(e){case"Delete":t=(0,p.AP)("Delete");break;case"Set Admin":t=(0,p.AP)("Set Admin")}return t},s.state={isOpIconShown:!1,highlight:!1,isSetAdminDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isSetAdminDialogOpen,r='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",a=(0,p.AP)("Are you sure you want to set {placeholder} as Admin?").replace("{placeholder}",r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.is_active?(0,p.AP)("Active"):(0,p.AP)("Inactive")}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(e.quota_usage)," / ").concat(e.quota_total>0?m.Aq.bytesToSize(e.quota_total):"--")}),(0,v.jsxs)("td",{children:[L()(e.create_time).format("YYYY-MM-DD HH:mm:ss")," / ",e.last_login?L()(e.last_login).fromNow():"--"]}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(Je.A,{operations:this.getOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Set Admin"),message:a,executeOperation:this.setAdmin,toggleDialog:this.toggleSetAdminDialog,confirmBtnText:(0,p.AP)("Set Admin")})]})}}])}(l.Component),Ar=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getInstitutionUsersByPage=function(e){var t=s.state.perPage;D.H.sysAdminListInstitutionUsers(s.props.institutionID,e,t).then((function(n){s.setState({loading:!1,userList:n.data.user_list,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.setAdmin=function(e){D.H.sysAdminUpdateInstitutionUser(s.props.institutionID,e,!0).then((function(t){var n=s.state.userList.map((function(t){return t.email==e&&(t.is_institution_admin=!0),t}));s.setState({userList:n}),N.A.success((0,p.AP)("Admin updated"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.toggleAddUserDialog=function(){s.setState({isAddUserDialogOpen:!s.state.isAddUserDialogOpen})},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getInstitutionUsersByPage(s.initPage)}))},s.addUser=function(e){D.H.sysAdminAddInstitutionUserBatch(s.props.institutionID,e).then((function(e){s.toggleAddUserDialog();var t=e.data.success,n=e.data.failed;if(t.length){var r=s.state.userList.concat(t);s.setState({userList:r})}n.forEach((function(e){N.A.danger(e.error_msg)}))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteUser=function(e){D.H.sysAdminDeleteInstitutionUser(s.props.institutionID,e).then((function(t){var n=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:n}),N.A.success((0,p.AP)("User deleted"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionName:"",userList:[],perPage:100,currentPage:1,hasNextPage:!1,isAddUserDialogOpen:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetInstitution(this.props.institutionID).then((function(t){e.setState({institutionName:t.data.name})}));var t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getInstitutionUsersByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.isAddUserDialogOpen,s=e.institutionName,r=e.hasNextPage,a=e.currentPage,i=e.perPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddUserDialog,children:(0,p.AP)("Add Member")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(gr,{currentItem:"members",institutionID:this.props.institutionID,institutionName:s}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(xr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,setAdmin:this.setAdmin,deleteUser:this.deleteUser,currentPage:a,perPage:i,hasNextPage:r,getInstitutionUsersByPage:this.getInstitutionUsersByPage,resetPerPage:this.resetPerPage})})]})}),t&&(0,v.jsx)(fr,{addUser:this.addUser,toggle:this.toggleAddUserDialog})]})}}])}(l.Component);L().extend(ue());var jr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No admins")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Space Used")}),(0,v.jsxs)("th",{width:"40%",children:[(0,p.AP)("Created At")," / ",(0,p.AP)("Last Login")]}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Pr,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,revokeAdmin:e.props.revokeAdmin,deleteUser:e.props.deleteUser},s)}))})]})});return r.length?i:a}}])}(l.Component),Pr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleRevokeAdminDialog=function(e){e&&e.preventDefault(),s.setState({isRevokeAdminDialogOpen:!s.state.isRevokeAdminDialogOpen})},s.revokeAdmin=function(){s.props.revokeAdmin(s.props.item)},s.onMenuItemClick=function(e){if("Revoke Admin"===e)s.toggleRevokeAdminDialog()},s.translateOperations=function(e){var t="";if("Revoke Admin"===e)t=(0,p.AP)("Revoke Admin");return t},s.state={isOpIconShown:!1,highlight:!1,isRevokeAdminDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isRevokeAdminDialogOpen,r='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",a=(0,p.AP)("Are you sure you want to revoke the admin permission of {placeholder} ?").replace("{placeholder}",r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.is_active?(0,p.AP)("Active"):(0,p.AP)("Inactive")}),(0,v.jsx)("td",{children:"".concat(m.Aq.bytesToSize(e.quota_usage)," / ").concat(e.quota_total>0?m.Aq.bytesToSize(e.quota_total):"--")}),(0,v.jsxs)("td",{children:[L()(e.create_time).format("YYYY-MM-DD HH:mm:ss")," / ",e.last_login?L()(e.last_login).fromNow():"--"]}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(Je.A,{operations:["Revoke Admin"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Revoke Admin"),message:a,executeOperation:this.revokeAdmin,confirmBtnText:(0,p.AP)("Revoke"),toggleDialog:this.toggleRevokeAdminDialog})]})}}])}(l.Component),Sr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).revokeAdmin=function(e){var t=e.email,n=e.name;D.H.sysAdminUpdateInstitutionUser(s.props.institutionID,t,!1).then((function(e){var r=s.state.userList.filter((function(e){return e.email!=t}));s.setState({userList:r}),N.A.success((0,p.AP)("Successfully revoked the admin permission of {placeholder}.").replace("{placeholder}",n))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteUser=function(e){D.H.sysAdminDeleteInstitutionUser(s.props.institutionID,e).then((function(t){var n=s.state.userList.filter((function(t){return t.email!=e}));s.setState({userList:n}),N.A.success((0,p.AP)("User deleted"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",institutionName:"",userList:[],isAddUserDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetInstitution(this.props.institutionID).then((function(t){e.setState({institutionName:t.data.name})})),D.H.sysAdminListInstitutionAdmins(this.props.institutionID).then((function(t){e.setState({loading:!1,userList:t.data.user_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.institutionName;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(gr,{currentItem:"admins",institutionID:this.props.institutionID,institutionName:e}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(jr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.userList,revokeAdmin:this.revokeAdmin,deleteUser:this.deleteUser})})]})})]})}}])}(l.Component),yr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"loginLogs",urlPart:"logs/login",text:(0,p.AP)("Login")},{name:"fileAccessLogs",urlPart:"logs/file-access",text:(0,p.AP)("File Access")},{name:"fileUpdateLogs",urlPart:"logs/file-update",text:(0,p.AP)("File Update")},{name:"sharePermissionLogs",urlPart:"logs/share-permission",text:(0,p.AP)("Permission")},{name:"fileTransfer",urlPart:"logs/repo-transfer",text:(0,p.AP)("Repo Transfer")},{name:"groupMember",urlPart:"logs/group-member-audit",text:(0,p.AP)("Group Member")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component),Dr=yr,Nr=s(71361),wr=s(61599),br=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).downloadExcel=function(){if(s.isValidDateStr())switch(s.props.logType){case"login":s.sysExportLogs("loginadmin");break;case"fileAccess":s.sysExportLogs("fileaudit");break;case"fileUpdate":s.sysExportLogs("fileupdate");break;case"sharePermission":s.sysExportLogs("permaudit")}},s.queryIOStatus=function(e,t){Nr.E.queryIOStatus(e).then((function(n){!0===n.data.is_finished?(s.setState({isShowIODialog:!1}),s.props.toggle(),location.href=p.Yc+"sys/log/export-excel/?task_id="+e+"&log_type="+t):setTimeout((function(){s.queryIOStatus(e,t)}),1e3)})).catch((function(e){s.setState({isShowIODialog:!1}),N.A.danger((0,p.AP)("Failed to export. Please check whether the size of table attachments exceeds the limit."))}))},s.sysExportLogs=function(e){var t=s.state,n=t.startDateStr,r=t.endDateStr,a="";s.setState({isShowIODialog:!0},(function(){D.H.sysAdminExportLogsExcel(n,r,e).then((function(e){return a=e.data.task_id,s.setState({taskId:a}),Nr.E.queryIOStatus(a)})).then((function(t){!0===t.data.is_finished?(s.setState({isShowIODialog:!1}),s.props.toggle(),location.href=p.Yc+"sys/log/export-excel/?task_id="+a+"&log_type="+e):s.queryIOStatus(a,e)})).catch((function(e){if(e.response&&500===e.response.status){var t=e.response.data?e.response.data.error_msg:null;t&&"Internal Server Error"!==t?N.A.danger(t):N.A.danger((0,p.AP)("Internal Server Error"))}else{var n=m.Aq.getErrorMsg(e);N.A.danger(n)}s.setState({isShowIODialog:!1}),s.props.toggle()}))}))},s.isValidDateStr=function(){var e=s.state,t=e.startDateStr,n=e.endDateStr;return!!(L()(t,"YYYY-MM-DD",!0).isValid()&&L()(n,"YYYY-MM-DD",!0).isValid()&&L()(t).isBefore(n))||(s.setState({errMsg:(0,p.AP)("Date Invalid.")}),!1)},s.handleStartChange=function(e){var t=e.target.value.trim();s.setState({startDateStr:t,errMsg:""})},s.handleEndChange=function(e){var t=e.target.value.trim();s.setState({endDateStr:t,errMsg:""})},s.onExportToggle=function(e){s.setState({isShowIODialog:!s.state.isShowIODialog}),s.props.toggle()},s.state={loading:!0,startDateStr:"",endDateStr:"",errMsg:"",taskId:"",isShowIODialog:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[!this.state.isShowIODialog&&(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,autoFocus:!1,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggle,children:(0,p.AP)("Choose date")}),(0,v.jsxs)(be.A,{children:[(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Start date")}),(0,v.jsx)(Q.A,{value:this.state.startDateStr,onChange:this.handleStartChange,placeholder:"yyyy-mm-dd",autoFocus:!0})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("End date")}),(0,v.jsx)(Q.A,{value:this.state.endDateStr,onChange:this.handleEndChange,placeholder:"yyyy-mm-dd"})]}),this.state.errMsg&&(0,v.jsx)(Ie.A,{className:"mt-2",color:"danger",children:(0,p.AP)(this.state.errMsg)})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.props.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.downloadExcel,children:(0,p.AP)("Submit")})]})]}),this.state.isShowIODialog&&(0,v.jsx)(wr.A,{toggle:this.onExportToggle})]})}}])}(l.Component),Ir=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleClickOutside=function(e){s.props.isOpen&&!s.userSelector.contains(e.target)&&s.props.onToggle()},s.onToggleClick=function(e){e.stopPropagation(),s.props.onToggle()},s.onQueryChange=function(e){var t=e.target.value;s.setState({query:t}),s.handleSearchUser(t)},s.handleSearchUser=function(e){e.trim()?(s.setState({isLoading:!0}),s.finalValue=e,setTimeout((function(){s.finalValue===e&&(s.props.searchUsersFunc&&s.props.searchUsersFunc(e).then((function(t){var n=t.data.user_list||t.data.users||[];s.setState({searchResults:n,isLoading:!1},(function(){s.props.searchGroupsFunc&&s.props.searchGroupsFunc(e).then((function(e){var t=e.data.group_list||e.data.groups||[];s.setState({searchResults:[].concat((0,gn.default)(n),(0,gn.default)(t))})}))}))})).catch((function(e){s.setState({isLoading:!1});var t=m.Aq.getErrorMsg(e);N.A.danger(t)})),s.props.searchGroupsFunc&&!s.props.searchUsersFunc&&s.props.searchGroupsFunc(e).then((function(e){var t=e.data.group_list||e.data.groups||[];s.setState({searchResults:t,isLoading:!1})})))}),500)):s.setState({searchResults:[]})},s.toggleSelectItem=function(e,t){e.stopPropagation(),s.props.onSelect(t,!1)},s.state={query:"",searchResults:[],isLoading:!1},s.dropdownRef=l.createRef(),s.finalValue="",s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClickOutside)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClickOutside)}},{key:"render",value:function(){var e=this,t=this.state,s=t.query,n=t.isLoading,r=t.searchResults,a=this.props,i=a.selectedItems,o=a.isOpen,l=s.trim()?r:this.props.items;return(0,v.jsxs)("div",{className:"position-relative d-inline-block ml-2",ref:this.dropdownRef,children:[(0,v.jsxs)("span",{className:"cur-activity-modifiers d-inline-block p-2 rounded",onClick:this.onToggleClick,children:[i.length>0?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:this.props.componentName+":"}),(0,v.jsx)("span",{className:"d-inline-block ml-1",children:i.map((function(e){return e.name})).join(", ")})]}):this.props.componentName,(0,v.jsx)("i",{className:"sf3-font sf3-font-down ml-2 toggle-icon"})]}),o&&(0,v.jsxs)("div",{className:"position-absolute activity-modifier-selector-container rounded shadow",ref:function(t){return e.userSelector=t},children:[(0,v.jsx)("ul",{className:"activity-selected-modifiers px-3 py-1 list-unstyled",children:i.map((function(t,s){return(0,v.jsxs)("li",{className:"activity-selected-modifier",children:[(0,v.jsx)("img",{src:t.avatar_url,className:"avatar w-5 h-5",alt:""}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name}),(0,v.jsx)("i",{className:"sf2-icon-close unselect-activity-user ml-2",onClick:function(s){e.toggleSelectItem(s,t)}})]},s)}))}),(0,v.jsx)("div",{className:"px-3 pt-3",children:(0,v.jsx)(Q.A,{type:"text",placeholder:(0,p.AP)("Find users"),value:s,onChange:this.onQueryChange})}),(0,v.jsx)("ul",{className:"activity-user-list list-unstyled p-3 o-auto",children:n?(0,v.jsx)("li",{className:"text-center",children:(0,p.AP)("Loading...")}):0===l.length?(0,v.jsx)("li",{className:"text-center",children:s?(0,p.AP)("User not found"):(0,p.AP)("Enter characters to start searching")}):l.map((function(t,s){var n=i.some((function(e){return t.email&&e.email===t.email||t.id&&e.id===t.id}));return(0,v.jsxs)("li",{className:"activity-user-item h-6 p-1 rounded d-flex justify-content-between align-items-center",onClick:function(s){e.toggleSelectItem(s,t)},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("img",{src:t.avatar_url,className:"avatar w-5 h-5",alt:""}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name})]}),n&&(0,v.jsx)("i",{className:"sf2-icon-tick text-gray font-weight-bold"})]},s)}))})]})]})}}])}(l.Component),kr=Ir;L().extend(ue());var Cr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,a=e.currentPage,i=e.hasNextPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No login logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("IP")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Time")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Mr,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),Mr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.login_ip}),(0,v.jsx)("td",{children:e.log_success?(0,p.AP)("Success"):(0,p.AP)("Failed")}),(0,v.jsx)("td",{children:L()(e.login_time).fromNow()})]})}}])}(l.Component),Lr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleExportExcelDialog=function(){s.setState({isExportExcelDialogOpen:!s.state.isExportExcelDialogOpen})},s.getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers.map((function(e){return e.email}));D.H.sysAdminListLoginLogs(e,n,{email:r}).then((function(t){s.setState({logList:t.data.login_log_list,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,n,t.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleUserFilter=function(e){var t,n=s.state.selectedUsers;null===e?t=n:t=n.find((function(t){return t.email===e.email}))?n.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(n),[e]);s.setState({selectedUsers:t,currentPage:1})},s.toggleUserSelector=function(){var e=s.state.isUserSelectorOpen;s.setState({isUserSelectorOpen:!e},(function(){s.state.isUserSelectorOpen||s.getLogsByPage(1)}))},s.searchUsers=function(e){return D.H.sysAdminSearchUsers(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedUsers:[],isUserSelectorOpen:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.logList,s=e.currentPage,r=e.perPage,a=e.hasNextPage,i=e.isExportExcelDialogOpen,o=e.availableUsers,c=e.selectedUsers;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleExportExcelDialog,children:(0,p.AP)("Export Excel")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Dr,{currentItem:"loginLogs"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(kr,{componentName:(0,p.AP)("Users"),items:o,selectedItems:c,onSelect:this.handleUserFilter,isOpen:this.state.isUserSelectorOpen,onToggle:this.toggleUserSelector,searchUsersFunc:this.searchUsers}),(0,v.jsx)(Cr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:r,hasNextPage:a,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})]})}),i&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(br,{logType:"login",toggle:this.toggleExportExcelDialog})})]})}}])}(l.Component),_r=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleClickOutside=function(e){s.props.isOpen&&!s.repoSelector.contains(e.target)&&s.props.onToggle()},s.onToggleClick=function(e){e.stopPropagation(),s.props.onToggle()},s.onQueryChange=function(e){var t=e.target.value;s.setState({query:t}),s.searchRepos(t)},s.searchRepos=function(e){s.finalValue=e,e.length>0?(s.setState({isLoading:!0}),setTimeout((function(){s.finalValue===e&&s.props.searchReposFunc(e).then((function(e){var t=e.data.repo_list||e.data.repos||[];s.setState({searchResults:t,isLoading:!1})})).catch((function(e){s.setState({isLoading:!1});var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))}),500)):s.setState({searchResults:[]})},s.toggleSelectItem=function(e,t){e.stopPropagation(),s.props.onSelect(t,!1)},s.state={query:"",isLoading:!1,searchResults:[]},s.dropdownRef=l.createRef(),s.finalValue="",s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClickOutside)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClickOutside)}},{key:"render",value:function(){var e=this,t=this.state,s=t.query,n=t.isLoading,r=t.searchResults,a=this.props,i=a.selectedItems,o=a.isOpen,l=s.trim()?r:this.props.items;return(0,v.jsxs)("div",{className:"position-relative d-inline-block",ref:this.dropdownRef,children:[(0,v.jsxs)("span",{className:"cur-activity-modifiers d-inline-block p-2 rounded",onClick:this.onToggleClick,children:[i.length>0?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:[(0,p.AP)("Libraries"),":"]}),(0,v.jsx)("span",{className:"d-inline-block ml-1",children:i.map((function(e){return e.name})).join(", ")})]}):(0,p.AP)("Libraries"),(0,v.jsx)("i",{className:"sf3-font sf3-font-down ml-2 toggle-icon"})]}),o&&(0,v.jsxs)("div",{className:"position-absolute activity-modifier-selector-container rounded shadow",ref:function(t){return e.repoSelector=t},children:[(0,v.jsx)("ul",{className:"activity-selected-modifiers px-3 py-1 list-unstyled",children:i.map((function(t,s){return(0,v.jsxs)("li",{className:"activity-selected-modifier",children:[(0,v.jsx)("i",{className:"fas fa-folder"}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name}),(0,v.jsx)("i",{className:"sf2-icon-close unselect-activity-user ml-2",onClick:function(s){e.toggleSelectItem(s,t)}})]},s)}))}),(0,v.jsx)("div",{className:"px-3 pt-3",children:(0,v.jsx)(Q.A,{type:"text",placeholder:(0,p.AP)("Find libraries"),value:s,onChange:this.onQueryChange})}),(0,v.jsx)("ul",{className:"activity-user-list list-unstyled p-3 o-auto",children:n?(0,v.jsx)("li",{className:"text-center",children:(0,p.AP)("Loading...")}):0===l.length?(0,v.jsx)("li",{className:"text-center",children:s?(0,p.AP)("Library not found"):(0,p.AP)("Enter characters to start searching")}):l.map((function(t,s){var n=i.some((function(e){return e.id===t.id}));return(0,v.jsxs)("li",{className:"activity-user-item h-6 p-1 rounded d-flex justify-content-between align-items-center",onClick:function(s){e.toggleSelectItem(s,t)},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("i",{className:"fas fa-folder"}),(0,v.jsx)("span",{className:"activity-user-name ml-2",children:t.name})]}),n&&(0,v.jsx)("i",{className:"sf2-icon-tick text-gray font-weight-bold"})]},s)}))})]})]})}}])}(l.Component),Or=_r;L().extend(ue());var Ur=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.props.getLogsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getLogsByPage(s.props.currentPage+1)},s.toggleFreezeItem=function(e){s.setState({isItemFreezed:e})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.perPage,i=t.currentPage,o=t.hasNextPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var c=(0,v.jsx)(pe.A,{text:(0,p.AP)("No file access logs")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Type")}),(0,v.jsxs)("th",{width:"20%",children:[(0,p.AP)("IP")," / ",(0,p.AP)("Device")]}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Date")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Library")}),(0,v.jsxs)("th",{width:"15%",children:[(0,p.AP)("File")," / ",(0,p.AP)("Folder")]})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Tr,{item:t,isFreezed:e.state.isItemFreezed,toggleFreezeItem:e.toggleFreezeItem},s)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:i,hasNextPage:o,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),Tr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isFreezed||s.setState({isHighlighted:!0})},s.handleMouseLeave=function(){s.props.isFreezed||s.setState({isHighlighted:!1})},s.toggleFreezeItem=function(e){s.props.toggleFreezeItem(e),e||s.setState({isHighlighted:!1})},s.state={isHighlighted:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.state.isHighlighted,t=this.props.item;return(0,v.jsxs)("tr",{className:e?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:t.email,name:t.name})}),(0,v.jsx)("td",{children:t.event_type}),(0,v.jsxs)("td",{children:[t.ip," / ",t.device||"--"]}),(0,v.jsx)("td",{children:L()(t.time).fromNow()}),(0,v.jsx)("td",{children:t.repo_name?t.repo_name:(0,p.AP)("Deleted")}),(0,v.jsx)("td",{children:t.file_or_dir_name})]})}}])}(l.Component),Rr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleExportExcelDialog=function(){s.setState({isExportExcelDialogOpen:!s.state.isExportExcelDialogOpen})},s.getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers,a=t.selectedRepos,i=r.map((function(e){return e.email})),o=a.map((function(e){return e.id}));D.H.sysAdminListFileAccessLogs(e,n,{email:i,repo:o}).then((function(t){s.setState({logList:t.data.file_access_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.updateURL=function(e){var t=new URL(location.href),s=new URLSearchParams(t.search);for(var n in e)null==e[n]?s.delete(n):s.set(n,e[n]);t.search=s.toString(),(0,h.oo)(t.toString())},s.handleUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e]);s.setState({selectedUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=[]:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,gn.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return D.H.sysAdminSearchUsers(e)},s.searchRepos=function(e){return D.H.sysAdminSearchRepos(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedUsers:[],availableRepos:[],selectedRepos:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,r=t.currentPage,a=t.perPage,i=t.hasNextPage,o=t.isExportExcelDialogOpen,c=t.availableUsers,d=t.selectedUsers,u=t.availableRepos,h=t.selectedRepos,g=t.openSelector;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleExportExcelDialog,children:(0,p.AP)("Export Excel")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Dr,{currentItem:"fileAccessLogs"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(kr,{componentName:(0,p.AP)("Users"),items:c,selectedItems:d,onSelect:this.handleUserFilter,isOpen:"user"===g,onToggle:function(){return e.handleSelectorToggle("user")},searchUsersFunc:this.searchUsers}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(Or,{items:u,selectedItems:h,onSelect:this.handleRepoFilter,isOpen:"repo"===g,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(Ur,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:r,perPage:a,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})]})}),o&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(br,{logType:"fileAccess",toggle:this.toggleExportExcelDialog})})]})}}])}(l.Component),Fr=Rr,Er=s(33e3);L().extend(ue());var Br=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,a=e.currentPage,i=e.hasNextPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No file update logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Date")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Action")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(zr,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),zr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.toggleCommitDetailsDialog=function(){s.setState({isCommitDetailsDialogOpen:!s.state.isCommitDetailsDialogOpen})},s.showCommitDetails=function(e){e.preventDefault(),s.setState({isCommitDetailsDialogOpen:!s.state.isCommitDetailsDialogOpen})},s.state={isOpIconShown:!1,isCommitDetailsDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:L()(e.time).fromNow()}),(0,v.jsx)("td",{children:e.repo_name?e.repo_name:(0,p.AP)("Deleted")}),(0,v.jsxs)("td",{children:[e.file_operation,e.repo_name&&!e.repo_encrypted&&(0,v.jsx)("a",{className:"ml-1",href:"#",onClick:this.showCommitDetails,children:(0,p.AP)("Details")})]})]}),this.state.isCommitDetailsDialogOpen&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Er.A,{repoID:e.repo_id,commitID:e.commit_id,commitTime:e.time,toggleDialog:this.toggleCommitDetailsDialog})})]})}}])}(l.Component),qr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleExportExcelDialog=function(){s.setState({isExportExcelDialogOpen:!s.state.isExportExcelDialogOpen})},s.getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers,a=t.selectedRepos,i=r.map((function(e){return e.email})),o=a.map((function(e){return e.id}));D.H.sysAdminListFileUpdateLogs(e,n,{email:i,repo:o}).then((function(t){s.setState({logList:t.data.file_update_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e]);s.setState({selectedUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=r:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,gn.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return D.H.sysAdminSearchUsers(e)},s.searchRepos=function(e){return D.H.sysAdminSearchRepos(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedUsers:[],availableRepos:[],selectedRepos:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,r=t.currentPage,a=t.perPage,i=t.hasNextPage,o=t.isExportExcelDialogOpen,c=t.availableUsers,d=t.selectedUsers,u=t.availableRepos,h=t.selectedRepos;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleExportExcelDialog,children:(0,p.AP)("Export Excel")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Dr,{currentItem:"fileUpdateLogs"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(kr,{componentName:(0,p.AP)("Users"),items:c,selectedItems:d,onSelect:this.handleUserFilter,isOpen:"user"===this.state.openSelector,onToggle:function(){return e.handleSelectorToggle("user")},searchUsersFunc:this.searchUsers}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(Or,{items:u,selectedItems:h,onSelect:this.handleRepoFilter,isOpen:"repo"===this.state.openSelector,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(Br,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:r,perPage:a,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})]})}),o&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(br,{logType:"fileUpdate",toggle:this.toggleExportExcelDialog})})]})}}])}(l.Component),Hr=qr;L().extend(ue());var Yr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,a=e.currentPage,i=e.hasNextPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No permission logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Share From")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Share To")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Actions")}),(0,v.jsx)("th",{width:"13%",children:(0,p.AP)("Permission")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"12%",children:(0,p.AP)("Folder")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Date")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Gr,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),Gr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).getActionTextByEType=function(e){return-1!=e.indexOf("add")?(0,p.AP)("Add"):-1!=e.indexOf("modify")?(0,p.AP)("Modify"):-1!=e.indexOf("delete")?(0,p.AP)("Delete"):""},e.getShareTo=function(e){switch(e.share_type){case"user":return(0,v.jsx)(Se,{email:e.to_user_email,name:e.to_user_name});case"group":case"department":return(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/groups/").concat(e.to_group_id,"/libraries/"),children:e.to_group_name});case"all":return(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"org/"),children:(0,p.AP)("All")});default:return(0,p.AP)("Deleted")}},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.from_user_email,name:e.from_user_name})}),(0,v.jsx)("td",{children:this.getShareTo(e)}),(0,v.jsx)("td",{children:this.getActionTextByEType(e.etype)}),(0,v.jsx)("td",{children:m.Aq.sharePerms(e.permission)}),(0,v.jsx)("td",{children:e.repo_name?e.repo_name:(0,p.AP)("Deleted")}),(0,v.jsx)("td",{children:e.folder}),(0,v.jsx)("td",{children:L()(e.date).fromNow()})]})}}])}(l.Component),Qr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleExportExcelDialog=function(){s.setState({isExportExcelDialogOpen:!s.state.isExportExcelDialogOpen})},s.getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedFromUsers,a=t.selectedToUsers,i=t.selectedToGroups,o=t.selectedRepos,l={from_email:r.map((function(e){return e.email})),to_email:a.map((function(e){return e.email})),to_group:i.map((function(e){return e.id})),repo:o.map((function(e){return e.id}))};D.H.sysAdminListSharePermissionLogs(e,n,l).then((function(t){s.setState({logList:t.data.share_permission_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleFromUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedFromUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e]);s.setState({selectedFromUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleToUserFilter=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=s.state,r=n.selectedToUsers,a=n.selectedToGroups,i=r,o=a;null===e?(i=r,o=a):e.email?i=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e]):o=a.find((function(t){return t.id===e.id}))?a.filter((function(t){return t.id!==e.id})):[].concat((0,gn.default)(a),[e]);s.setState({selectedToUsers:i,selectedToGroups:o,currentPage:1},(function(){t&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=r:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,gn.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return D.H.sysAdminSearchUsers(e)},s.searchRepos=function(e){return D.H.sysAdminSearchRepos(e)},s.searchGroups=function(e){return D.H.sysAdminSearchGroups(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,isExportExcelDialogOpen:!1,availableUsers:[],selectedFromUsers:[],selectedToUsers:[],selectedToGroups:[],availableRepos:[],selectedRepos:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,r=t.currentPage,a=t.perPage,i=t.hasNextPage,o=t.isExportExcelDialogOpen,c=t.availableUsers,d=t.selectedFromUsers,u=t.selectedToUsers,h=t.selectedToGroups,g=t.availableRepos,m=t.selectedRepos,f=t.openSelector;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleExportExcelDialog,children:(0,p.AP)("Export Excel")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Dr,{currentItem:"sharePermissionLogs"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(kr,{componentName:(0,p.AP)("Share From"),items:c,selectedItems:d,onSelect:this.handleFromUserFilter,isOpen:"fromUser"===f,onToggle:function(){return e.handleSelectorToggle("fromUser")},searchUsersFunc:this.searchUsers}),(0,v.jsx)(kr,{componentName:(0,p.AP)("Share To"),items:c,selectedItems:[].concat((0,gn.default)(u),(0,gn.default)(h)),onSelect:this.handleToUserFilter,isOpen:"toUser"===f,onToggle:function(){return e.handleSelectorToggle("toUser")},searchUsersFunc:this.searchUsers,searchGroupsFunc:this.searchGroups}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(Or,{items:g,selectedItems:m,onSelect:this.handleRepoFilter,isOpen:"repo"===f,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(Yr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:r,perPage:a,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})]})}),o&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(br,{logType:"sharePermission",toggle:this.toggleExportExcelDialog})})]})}}])}(l.Component),Vr=Qr;L().extend(ue());var Wr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,a=e.currentPage,i=e.hasNextPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No transfer logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Transfer From")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Transfer To")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Operator")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Date")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Kr,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),Kr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.getTransferTo=function(e){switch(e.to_type){case"user":return(0,v.jsx)(Se,{email:e.to_user_email,name:e.to_user_name});case"group":return(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/groups/").concat(e.to_group_id,"/libraries/"),children:e.to_group_name});default:return(0,p.AP)("Deleted")}},s.getTransferFrom=function(e){switch(e.from_type){case"user":return(0,v.jsx)(Se,{email:e.from_user_email,name:e.from_user_name});case"group":return(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/groups/").concat(e.from_group_id,"/libraries/"),children:e.from_group_name});default:return(0,p.AP)("Deleted")}},s.getOperator=function(e){return(0,v.jsx)(Se,{email:e.operator_email,name:e.operator_name})},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:this.getTransferFrom(e)}),(0,v.jsx)("td",{children:this.getTransferTo(e)}),(0,v.jsx)("td",{children:this.getOperator(e)}),(0,v.jsx)("td",{children:e.repo_name?e.repo_name:(0,p.AP)("Deleted")}),(0,v.jsx)("td",{children:L()(e.date).fromNow()})]})}}])}(l.Component),Xr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedFromUsers,a=t.selectedToUsers,i=t.selectedToGroups,o=t.selectedOperators,l=t.selectedRepos,c={from_email:r.filter((function(e){return e.email})).map((function(e){return e.email})),from_group:r.filter((function(e){return!e.email})).map((function(e){return e.id})),to_email:a.map((function(e){return e.email})),to_group:i.map((function(e){return e.to_group_id||e.id})),operator_email:o.map((function(e){return e.email})),repo:l.map((function(e){return e.id}))};D.H.sysAdminListFileTransferLogs(e,n,c).then((function(t){s.setState({logList:t.data.repo_transfer_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(t){s.setState({loading:!1,currentPage:e,errorMsg:m.Aq.getErrorMsg(t,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.handleFromUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedFromUsers;if(null===e)t=r;else if(e.email){t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e])}else{var a=e.id;if(r.find((function(e){return e.id===a})))t=r.filter((function(e){return e.id!==a}));else{var i={id:a,name:e.name,from_group_id:a,from_group_name:e.name};t=[].concat((0,gn.default)(r),[i])}}s.setState({selectedFromUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleToUserFilter=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=s.state,r=n.selectedToUsers,a=n.selectedToGroups,i=r,o=a;if(null===e)i=r,o=a;else if(e.email){i=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e])}else{var l=e.to_group_id||e.id,c=e.to_group_name||e.name;if(a.find((function(e){return(e.to_group_id||e.id)===l})))o=a.filter((function(e){return(e.to_group_id||e.id)!==l}));else{var d={id:l,name:c,to_group_id:l,to_group_name:c};o=[].concat((0,gn.default)(a),[d])}}s.setState({selectedToUsers:i,selectedToGroups:o,currentPage:1},(function(){t&&s.getLogsByPage(1)}))},s.handleOperatorFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedOperators;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e]);s.setState({selectedOperators:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.handleRepoFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedRepos;null===e?t=[]:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,gn.default)(r),[e]);s.setState({selectedRepos:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return D.H.sysAdminSearchUsers(e)},s.searchGroups=function(e){return D.H.sysAdminSearchGroups(e)},s.searchRepos=function(e){return D.H.sysAdminSearchRepos(e)},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,availableUsers:[],selectedFromUsers:[],selectedToUsers:[],selectedToGroups:[],selectedOperators:[],openSelector:null,availableRepos:[],selectedRepos:[]},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,r=t.currentPage,a=t.perPage,i=t.hasNextPage,o=t.availableUsers,c=t.selectedFromUsers,d=t.selectedToUsers,u=t.selectedToGroups,h=t.selectedOperators,g=t.availableRepos,m=t.selectedRepos,f=t.openSelector,x=[].concat((0,gn.default)(d),(0,gn.default)(u.map((function(e){return{id:e.to_group_id||e.id,name:e.to_group_name||e.name,to_group_id:e.to_group_id||e.id,to_group_name:e.to_group_name||e.name}}))));return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Dr,{currentItem:"fileTransfer"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(kr,{componentName:(0,p.AP)("Transfer From"),items:o,selectedItems:c,onSelect:this.handleFromUserFilter,isOpen:"fromUser"===f,onToggle:function(){return e.handleSelectorToggle("fromUser")},searchUsersFunc:this.searchUsers,searchGroupsFunc:this.searchGroups}),(0,v.jsx)(kr,{componentName:(0,p.AP)("Transfer To"),items:o,selectedItems:x,onSelect:this.handleToUserFilter,isOpen:"toUser"===f,onToggle:function(){return e.handleSelectorToggle("toUser")},searchUsersFunc:this.searchUsers,searchGroupsFunc:this.searchGroups}),(0,v.jsx)(kr,{componentName:(0,p.AP)("Operator"),items:o,selectedItems:h,onSelect:this.handleOperatorFilter,isOpen:"operator"===f,onToggle:function(){return e.handleSelectorToggle("operator")},searchUsersFunc:this.searchUsers}),(0,v.jsx)("div",{className:"mx-3"}),(0,v.jsx)(Or,{items:g,selectedItems:m,onSelect:this.handleRepoFilter,isOpen:"repo"===f,onToggle:function(){return e.handleSelectorToggle("repo")},searchReposFunc:this.searchRepos})]}),(0,v.jsx)(Wr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:r,perPage:a,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})]})})]})}}])}(l.Component),$r=Xr;L().extend(ue());var Jr=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).getPreviousPage=function(){e.props.getLogsByPage(e.props.currentPage-1)},e.getNextPage=function(){e.props.getLogsByPage(e.props.currentPage+1)},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,a=e.currentPage,i=e.hasNextPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No group invite logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("User")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Group")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Operator")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Action")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Date")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(Zr,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),Zr=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseOver=function(){s.setState({isOpIconShown:!0})},s.handleMouseOut=function(){s.setState({isOpIconShown:!1})},s.getGroupName=function(e){return e.group_name?(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/groups/").concat(e.group_id,"/libraries/"),children:e.group_name}):(0,p.AP)("Deleted")},s.getActionTextByEType=function(e){return-1!=e.indexOf("group_member_add")?(0,p.AP)("Add member"):-1!=e.indexOf("group_member_delete")?(0,p.AP)("Delete member"):""},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.user_email,name:e.user_name})}),(0,v.jsx)("td",{children:this.getGroupName(e)}),(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.operator_email,name:e.operator_name})}),(0,v.jsx)("td",{children:this.getActionTextByEType(e.operation)}),(0,v.jsx)("td",{children:L()(e.date).fromNow()})]})}}])}(l.Component),ea=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state,n=t.perPage,r=t.selectedUsers,a=t.selectedOperators,i=t.selectedGroups,o={user_email:r.map((function(e){return e.email})),operator_email:a.map((function(e){return e.email})),group_id:i.map((function(e){return e.id}))};D.H.sysAdminListGroupInviteLogs(e,n,o).then((function(t){s.setState({logList:t.data.group_invite_log_list,loading:!1,currentPage:e,hasNextPage:t.data.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.handleUserFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedUsers;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e]);s.setState({selectedUsers:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleOperatorFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedOperators;null===e?t=r:t=r.find((function(t){return t.email===e.email}))?r.filter((function(t){return t.email!==e.email})):[].concat((0,gn.default)(r),[e]);s.setState({selectedOperators:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleGroupFilter=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=s.state.selectedGroups;null===e?t=r:t=r.find((function(t){return t.id===e.id}))?r.filter((function(t){return t.id!==e.id})):[].concat((0,gn.default)(r),[e]);s.setState({selectedGroups:t,currentPage:1},(function(){n&&s.getLogsByPage(1)}))},s.handleSelectorToggle=function(e){var t=s.state.openSelector===e;s.setState({openSelector:t?null:e},(function(){t&&s.getLogsByPage(1)}))},s.searchUsers=function(e){return D.H.sysAdminSearchUsers(e)},s.searchGroups=function(e){return D.H.sysAdminSearchGroups(e)},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1,availableUsers:[],selectedUsers:[],selectedOperators:[],selectedGroups:[],openSelector:null},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.logList,r=t.currentPage,a=t.perPage,i=t.hasNextPage,o=t.availableUsers,c=t.selectedUsers,d=t.selectedOperators,u=t.selectedGroups,h=t.openSelector;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(Dr,{currentItem:"groupMember"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,v.jsx)(kr,{componentName:(0,p.AP)("Member"),items:o,selectedItems:c,onSelect:this.handleUserFilter,isOpen:"user"===h,onToggle:function(){return e.handleSelectorToggle("user")},searchUsersFunc:this.searchUsers}),(0,v.jsx)(kr,{componentName:(0,p.AP)("Group"),items:o,selectedItems:u,onSelect:this.handleGroupFilter,isOpen:"group"===h,onToggle:function(){return e.handleSelectorToggle("group")},searchGroupsFunc:this.searchGroups}),(0,v.jsx)(kr,{componentName:(0,p.AP)("Operator"),items:o,selectedItems:d,onSelect:this.handleOperatorFilter,isOpen:"operator"===h,onToggle:function(){return e.handleSelectorToggle("operator")},searchUsersFunc:this.searchUsers})]}),(0,v.jsx)(Jr,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:s,currentPage:r,perPage:a,hasNextPage:i,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})]})})]})})]})}}])}(l.Component),ta=ea,sa=s(72714),na=s(83970),ra=s(15263),aa=s(8123),ia=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleBtns=function(){s.setState({isBtnsShown:!s.state.isBtnsShown})},s.hideBtns=function(e){s.state.isBtnsShown&&(s.props.value!=s.state.value&&s.setState({value:s.props.value}),s.toggleBtns())},s.onInputChange=function(e){s.setState({value:e.target.value})},s.onSubmit=function(e){var t=s.state.value.trim();t!=s.props.value&&s.props.saveSetting(s.props.keyText,t),s.toggleBtns()},s.state={isBtnsShown:!1,value:s.props.value},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({value:e.value})}},{key:"render",value:function(){var e=this.state,t=e.isBtnsShown,s=e.value,n=this.props,r=n.helpTip,a=n.displayName,i=n.inputType;return(0,v.jsx)(aa.A,{displayName:a,helpTip:r,mainContent:(0,v.jsx)(Q.A,{type:i||"text",className:"textarea"==i?"web-setting-textarea":"",onChange:this.onInputChange,onFocus:this.toggleBtns,onBlur:this.hideBtns,value:s}),extraContent:t?(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{color:"primary",className:"sf2-icon-tick web-setting-icon-btn web-setting-icon-btn-submit",onMouseDown:this.onSubmit,title:(0,p.AP)("Submit")}),(0,v.jsx)(y.A,{className:"ml-1 sf2-icon-x2 web-setting-icon-btn web-setting-icon-btn-cancel",title:(0,p.AP)("Cancel")})]}):null})}}])}(l.Component),oa=(s(37696),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).saveSetting=function(e,t){D.H.sysAdminSetSysSettingInfo(e,t).then((function(e){s.setState({config_dict:e.data}),N.A.success((0,p.AP)("System settings updated"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.postFile=function(e,t){var n;"Logo"==t?n=D.H.sysAdminUpdateLogo(e):"Favicon"==t?n=D.H.sysAdminUpdateFavicon(e):"loginBGImage"==t&&(n=D.H.sysAdminUpdateLoginBG(e)),n.then((function(e){"Logo"==t?s.setState({logoPath:e.data.logo_path}):"Favicon"==t?s.setState({faviconPath:e.data.favicon_path}):"loginBGImage"==t&&s.setState({loginBGPath:e.data.login_bg_image_path}),N.A.success((0,p.AP)("System settings updated"))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",config_dict:null,logoPath:p.SG+p.VI,faviconPath:p.SG+p.M$,loginBGPath:p.SG+p.sO},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminGetSysSettingInfo().then((function(t){e.setState({loading:!1,config_dict:t.data})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.loading,s=e.errorMsg,r=e.config_dict,a=e.logoPath,i=e.faviconPath,o=e.loginBGPath;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Settings")})}),(0,v.jsxs)("div",{className:"cur-view-content container mw-100",children:[t&&(0,v.jsx)(w.A,{}),s&&(0,v.jsx)("p",{className:"error text-center mt-4",children:s}),!t&&!s&&r&&(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)("p",{className:"small text-secondary my-4",children:(0,p.AP)("Note: Settings via web interface are saved in database table (seahub-db/constance_config). They have a higher priority over the settings in config files.")}),(0,v.jsx)(sa.A,{headingText:(0,p.AP)("Branding"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(ia,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Site title"),keyText:"SITE_TITLE",value:r.SITE_TITLE,helpTip:(0,p.AP)("Site title shown in a browser tab")}),(0,v.jsx)(ia,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Site name"),keyText:"SITE_NAME",value:r.SITE_NAME,helpTip:(0,p.AP)("Site name used in email sending")}),(0,v.jsx)(ra.A,{postFile:this.postFile,displayName:(0,p.AP)("Logo"),keyText:"Logo",filePath:a,fileWidth:256,fileHeight:64,helpTip:"logo.png, 256px * 64px"}),(0,v.jsx)(ra.A,{postFile:this.postFile,displayName:(0,p.AP)("Favicon"),keyText:"Favicon",filePath:i,fileWidth:32,fileHeight:32,helpTip:"favicon.ico, 32px * 32px"}),(0,v.jsx)(ra.A,{postFile:this.postFile,displayName:(0,p.AP)("Login background image"),keyText:"loginBGImage",filePath:o,fileWidth:240,fileHeight:160,helpTip:"login-bg.jpg, 2400px * 1600px"}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Enable branding CSS"),keyText:"ENABLE_BRANDING_CSS",value:r.ENABLE_BRANDING_CSS,helpTip:(0,p.AP)("Use custom CSS")}),(0,v.jsx)(ia,{inputType:"textarea",saveSetting:this.saveSetting,displayName:(0,p.AP)("Custom CSS"),keyText:"CUSTOM_CSS",value:r.CUSTOM_CSS,helpTip:""})]})}),(0,v.jsx)(sa.A,{headingText:(0,p.AP)("User"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Allow new registrations"),keyText:"ENABLE_SIGNUP",value:r.ENABLE_SIGNUP,helpTip:(0,p.AP)("Allow new user registrations. Uncheck this to prevent anyone from creating a new account.")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Activate after registration"),keyText:"ACTIVATE_AFTER_REGISTRATION",value:r.ACTIVATE_AFTER_REGISTRATION,helpTip:(0,p.AP)("Activate user immediately after registration. If unchecked, a user need to be activated by administrator or via activation email")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Send activation email"),keyText:"REGISTRATION_SEND_MAIL",value:r.REGISTRATION_SEND_MAIL,helpTip:(0,p.AP)("Send activation Email after user registration.")}),(0,v.jsx)(ia,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Keep sign in"),keyText:"LOGIN_REMEMBER_DAYS",value:r.LOGIN_REMEMBER_DAYS,helpTip:(0,p.AP)("Number of days that keep user sign in.")}),(0,v.jsx)(ia,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Login attempt limit"),keyText:"LOGIN_ATTEMPT_LIMIT",value:r.LOGIN_ATTEMPT_LIMIT,helpTip:(0,p.AP)("The maximum number of failed login attempts before showing CAPTCHA.")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Freeze user on login failed"),keyText:"FREEZE_USER_ON_LOGIN_FAILED",value:r.FREEZE_USER_ON_LOGIN_FAILED,helpTip:(0,p.AP)("Freeze user account when failed login attempts exceed limit.")})]})}),(0,v.jsx)(sa.A,{headingText:(0,p.AP)("Groups"),children:(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Enable\xa0sharing\xa0to\xa0all\xa0groups"),keyText:"ENABLE_SHARE_TO_ALL_GROUPS",value:r.ENABLE_SHARE_TO_ALL_GROUPS,helpTip:(0,p.AP)("Enable users to share libraries to any groups in the system.")})}),(0,v.jsx)(sa.A,{headingText:(0,p.AP)("Password"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Strong password"),keyText:"USER_STRONG_PASSWORD_REQUIRED",value:r.USER_STRONG_PASSWORD_REQUIRED,helpTip:(0,p.AP)("Force user to use a strong password when sign up or change password.")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Force password change"),keyText:"FORCE_PASSWORD_CHANGE",value:r.FORCE_PASSWORD_CHANGE,helpTip:(0,p.AP)("Force user to change password when account is newly added or reset by admin")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Enable two factor authentication"),keyText:"ENABLE_TWO_FACTOR_AUTH",value:r.ENABLE_TWO_FACTOR_AUTH,helpTip:(0,p.AP)("Enable two factor authentication")})]})}),(0,v.jsx)(sa.A,{headingText:(0,p.AP)("Library"),children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Library history"),keyText:"ENABLE_REPO_HISTORY_SETTING",value:r.ENABLE_REPO_HISTORY_SETTING,helpTip:(0,p.AP)("Allow users to change library history settings")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Encrypted library"),keyText:"ENABLE_ENCRYPTED_LIBRARY",value:r.ENABLE_ENCRYPTED_LIBRARY,helpTip:(0,p.AP)("Allow users to create encrypted libraries")}),(0,v.jsx)(ia,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Library password minimum length"),keyText:"REPO_PASSWORD_MIN_LENGTH",value:r.REPO_PASSWORD_MIN_LENGTH,helpTip:(0,p.AP)("The least number of characters an encrypted library password should include.")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Share/upload link force password"),keyText:"SHARE_LINK_FORCE_USE_PASSWORD",value:r.SHARE_LINK_FORCE_USE_PASSWORD,helpTip:(0,p.AP)("Force users to use password when generating share/upload link.")}),(0,v.jsx)(ia,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Share/upload link password minimum length"),keyText:"SHARE_LINK_PASSWORD_MIN_LENGTH",value:r.SHARE_LINK_PASSWORD_MIN_LENGTH,helpTip:(0,p.AP)("The least number of characters a share/upload link password should include.")}),(0,v.jsx)(ia,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Share/upload link password strength level"),keyText:"SHARE_LINK_PASSWORD_STRENGTH_LEVEL",value:r.SHARE_LINK_PASSWORD_STRENGTH_LEVEL,helpTip:(0,p.AP)("The level(1-4) of a share/upload link password's strength. For example, '3' means password must have at least 3 of the following: num, upper letter, lower letter and other symbols")}),(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Enable users to clean trash"),keyText:"ENABLE_USER_CLEAN_TRASH",value:r.ENABLE_USER_CLEAN_TRASH,helpTip:(0,p.AP)("Allow users to clean library trash")})]})}),(0,v.jsx)(sa.A,{headingText:(0,p.AP)("Online Preview"),children:(0,v.jsx)(ia,{inputType:"textarea",saveSetting:this.saveSetting,displayName:(0,p.AP)("Text file extensions"),keyText:"TEXT_PREVIEW_EXT",value:r.TEXT_PREVIEW_EXT,helpTip:(0,p.AP)("Extensions of text files that can be online previewed, each suffix is separated by a comma.")})}),(0,v.jsx)(sa.A,{headingText:(0,p.AP)("Sync"),children:(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Disable sync with any folder"),keyText:"DISABLE_SYNC_WITH_ANY_FOLDER",value:r.DISABLE_SYNC_WITH_ANY_FOLDER,helpTip:(0,p.AP)("If turn on, the desktop clients will not be able to sync a folder outside the default Seafile folder.")})}),p.am&&(0,v.jsx)(sa.A,{headingText:(0,p.AP)("Terms"),children:(0,v.jsx)(na.A,{saveSetting:this.saveSetting,displayName:(0,p.AP)("Enable terms and conditions"),keyText:"ENABLE_TERMS_AND_CONDITIONS",value:r.ENABLE_TERMS_AND_CONDITIONS,helpTip:(0,p.AP)("Enable system admin to add Terms and Conditions, and all users will have to accept the terms.")})})]})]})]})})]})}}])}(l.Component)),la=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleChange=function(e){var t=e.target.value;s.setState({value:t,isSubmitBtnActive:""!=t.trim()})},s.handleSubmit=function(){s.toggle(),s.props.addNotification(s.state.value.trim())},s.toggle=function(){s.props.toggle()},s.state={value:"",isSubmitBtnActive:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:(0,p.AP)("Add new notification")}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Le.A,{children:(0,v.jsx)(_e.A,{children:(0,v.jsx)(Q.A,{type:"textarea",value:this.state.value,onChange:this.handleChange})})})}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:(0,p.AP)("Cancel")}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,disabled:!this.state.isSubmitBtnActive,children:(0,p.AP)("Submit")})]})]})}}])}(l.Component),ca=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No notifications")}),i=(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"95%",children:(0,p.AP)("Notification Detail")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(da,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteNotification:e.props.deleteNotification,setToCurrent:e.props.setToCurrent},s)}))})]});return r.length?i:a}}])}(l.Component),da=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.toggleDeleteDialog=function(e){e&&e.preventDefault(),s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.deleteNotification=function(){s.props.deleteNotification(s.props.item.id),s.toggleDeleteDialog()},s.setToCurrent=function(){s.props.setToCurrent(s.props.item.id)},s.onMenuItemClick=function(e){switch(e){case"Set to current":s.setToCurrent();break;case"Delete":s.toggleDeleteDialog()}},s.translateOperations=function(e){var t="";switch(e){case"Set to current":t=(0,p.AP)("Set to current");break;case"Delete":t=(0,p.AP)("Delete")}return t},s.getOperations=function(){var e=[];return s.props.item.is_current||e.push("Set to current"),e.push("Delete"),e},s.state={isOpIconShown:!1,highlight:!1,isDeleteDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isOpIconShown,n=t.isDeleteDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsxs)("td",{children:[e.msg,e.is_current&&(0,v.jsx)("span",{className:"small text-orange",children:(0,p.AP)("(current notification)")})]}),(0,v.jsx)("td",{children:s&&(0,v.jsx)(Je.A,{operations:this.getOperations(),translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),n&&(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete Notification"),message:(0,p.AP)("Are you sure you want to delete the notification ?"),toggleDialog:this.toggleDeleteDialog,executeOperation:this.deleteNotification,confirmBtnText:(0,p.AP)("Delete")})]})}}])}(l.Component),ua=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleAddNotificationDialog=function(){s.setState({isAddNotificationDialogOpen:!s.state.isAddNotificationDialogOpen})},s.addNotification=function(e){D.H.sysAdminAddSysNotification(e).then((function(e){var t=s.state.notificationList;t.unshift(e.data.notification),s.setState({notificationList:t})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteNotification=function(e){D.H.sysAdminDeleteSysNotification(e).then((function(t){var n=s.state.notificationList.filter((function(t){return t.id!=e}));s.setState({notificationList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.setToCurrent=function(e){D.H.sysAdminSetSysNotificationToCurrent(e).then((function(t){var n=s.state.notificationList.map((function(t){return t.id==e?t.is_current=!0:t.is_current=!1,t}));s.setState({notificationList:n})})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",notificationList:[],isAddNotificationDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminListAllSysNotifications().then((function(t){e.setState({loading:!1,notificationList:t.data.notifications})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state.isAddNotificationDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddNotificationDialog,children:(0,p.AP)("Add new notification")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("All Notifications")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ca,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.notificationList,deleteNotification:this.deleteNotification,setToCurrent:this.setToCurrent})})]})}),e&&(0,v.jsx)(la,{addNotification:this.addNotification,toggle:this.toggleAddNotificationDialog})]})}}])}(l.Component),ha=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.records;return t?(0,v.jsx)("span",{className:"loading-icon loading-tip"}):s?(0,v.jsx)("p",{className:"error text-center",children:s}):(0,v.jsxs)("table",{width:"100%",className:"table table-hover table-vcenter",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"16%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"30%",children:"ID"}),(0,v.jsx)("th",{width:"30%",children:(0,p.AP)("Path")}),(0,v.jsx)("th",{width:"12%",children:(0,p.AP)("Label")}),(0,v.jsx)("th",{width:"12%",children:(0,p.AP)("Suggestion")})]})}),(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(ga,{record:e},t)}))})]})}}])}(l.Component),ga=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).state={},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.record;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_id}),(0,v.jsx)("td",{children:e.path}),(0,v.jsx)("td",{children:e.detail.label}),(0,v.jsx)("td",{children:e.detail.suggestion})]})}}])}(l.Component),pa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).state={loading:!0,errorMsg:"",records:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminListFileScanRecords().then((function(t){e.setState({loading:!1,records:t.data.record_list})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",id:"content-scan-records",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Content Scan Records")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ha,{loading:this.state.loading,errorMsg:this.state.errorMsg,records:this.state.records})})]})})]})}}])}(l.Component),ma=s(55097),fa=s.n(ma),xa=s(94700),va=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.newUsersTempObj,n=t.checkedDepartmentId,r=t.isMembersListLoading,a=t.canCheckUserIds,i=this.props.membersList.map((function(t,r){var a=t.avatar;return a=t.avatar&&t.avatar.length>0?t.avatar.substring(0,t.avatar.length-1)+"100":p.Yc+"media/avatars/default.png",(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:!t.email&&(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:function(){return e.props.onUserChecked(t)},checked:t.userid in s?"checked":""})}),(0,v.jsx)("td",{children:(0,v.jsx)("img",{className:"avatar",src:a,alt:""})}),(0,v.jsx)("td",{children:t.name}),(0,v.jsx)("td",{children:t.mobile}),(0,v.jsx)("td",{children:t.contact_email}),(0,v.jsx)("td",{children:t.email&&(0,v.jsx)("i",{className:"sf2-icon-tick"})})]},n.toString()+t.userid)}));return(0,v.jsxs)("div",{className:"dir-content-main",children:[r&&(0,v.jsx)(w.A,{}),!r&&this.props.membersList.length>0&&(0,v.jsxs)(xa.A,{hover:!0,children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%",children:a.length>0&&(0,v.jsx)("input",{type:"checkbox",className:"vam",checked:this.props.isCheckedAll,onChange:function(){return e.props.onAllUsersChecked()}})}),(0,v.jsx)("th",{width:"10%"}),(0,v.jsx)("th",{width:"20%",children:"\u540d\u79f0"}),(0,v.jsx)("th",{width:"20%",children:"\u624b\u673a\u53f7"}),(0,v.jsx)("th",{width:"30%",children:"\u90ae\u7bb1"}),(0,v.jsx)("th",{width:"15%",children:"\u5df2\u6dfb\u52a0"})]})}),(0,v.jsx)("tbody",{children:i})]}),!r&&0===this.props.membersList.length&&(0,v.jsxs)("div",{className:"message empty-tip text-center",children:[(0,v.jsx)("img",{src:"".concat(p.Yc,"media/img/member-list-empty-2x.png"),alt:""}),(0,v.jsx)("h4",{children:"\u6210\u5458\u5217\u8868\u4e3a\u7a7a"})]})]})}}])}(l.Component),Aa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleChildren=function(e){e.preventDefault(),e.stopPropagation(),s.setState({isChildrenShow:!s.state.isChildrenShow})},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.state.dropdownOpen||s.setState({active:!1})},s.importDepartmentDialogToggle=function(e){s.setState({active:!1}),s.props.importDepartmentDialogToggle(e)},s.renderTreeNodes=function(e){if(e.length>0)return e.map((function(e){return(0,v.jsx)(t,{department:e,isChildrenShow:s.state.isChildrenShow,onChangeDepartment:s.props.onChangeDepartment,checkedDepartmentId:s.props.checkedDepartmentId,importDepartmentDialogToggle:s.importDepartmentDialogToggle},e.id)}))},s.changeDept=function(e){var t=s.props,n=t.department,r=t.checkedDepartmentId;s.props.onChangeDepartment(e),r!==n.id||s.state.isChildrenShow||s.setState({isChildrenShow:!0})},s.state={isChildrenShow:!1,dropdownOpen:!1,active:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){0===this.props.index&&(this.setState({isChildrenShow:!0}),this.props.onChangeDepartment(this.props.department.id))}},{key:"render",value:function(){var e=this,t=this.props,s=t.isChildrenShow,n=t.department,r=t.checkedDepartmentId,a=ge()({"folder-toggle-icon sf3-font sf3-font-down rotate-270":n.children&&this.state.isChildrenShow,"folder-toggle-icon sf3-font sf3-font-down":n.children&&!this.state.isChildrenShow}),i=ge()({"tree-node-inner":!0,"tree-node-inner-hover":this.state.active,"tree-node-hight-light":r===n.id});return(0,v.jsxs)(l.Fragment,{children:[s&&(0,v.jsxs)("div",{className:i,onClick:function(){return e.changeDept(n.id)},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("span",{className:"tree-node-icon",onClick:function(t){return e.toggleChildren(t)},children:(0,v.jsx)("i",{className:a})}),(0,v.jsx)("span",{className:"tree-node-text",children:n.name}),p.am&&(0,v.jsxs)(mn.A,{isOpen:this.state.dropdownOpen,toggle:function(t){return e.dropdownToggle(t)},direction:"down",style:this.state.active?{}:{opacity:0},children:[(0,v.jsx)(fn.A,{tag:"span",className:"cursor-pointer right-icon",title:(0,p.AP)("More operations"),"aria-label":(0,p.AP)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.dropdownOpen,children:(0,v.jsx)("i",{className:"sf3-font sf3-font-more"})}),(0,v.jsx)(xn.A,{className:"drop-list",children:(0,v.jsx)(vn.A,{onClick:this.importDepartmentDialogToggle.bind(this,n),id:n.id,children:"\u5bfc\u5165\u90e8\u95e8"})})]})]}),this.state.isChildrenShow&&(0,v.jsx)("div",{className:"department-children",children:n.children&&this.renderTreeNodes(n.children)})]})}}])}(l.Component),ja=Aa,Pa=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props.departmentsTree;return(0,v.jsx)("div",{className:"dir-content-nav",children:(0,v.jsx)("div",{className:"tree-view p-4",children:this.props.isTreeLoading?(0,v.jsx)(w.A,{}):(0,v.jsx)(v.Fragment,{children:t.length>0&&t.map((function(t,s){return(0,v.jsx)(ja,{index:s,department:t,isChildrenShow:!0,onChangeDepartment:e.props.onChangeDepartment,checkedDepartmentId:e.props.checkedDepartmentId,importDepartmentDialogToggle:e.props.importDepartmentDialogToggle},t.id)}))})})})}}])}(l.Component),Sa=Pa,ya=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.importDepartmentDialogToggle(null)},s.handleSubmit=function(){s.props.onImportDepartmentSubmit(),s.setState({isLoading:!0})},s.state={isLoading:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.departmentsCount,s=e.membersCount,n=e.departmentName;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsxs)(Ce.A,{toggle:this.toggle,children:[(0,v.jsx)("span",{children:"\u5bfc\u5165\u90e8\u95e8 "}),(0,v.jsx)("span",{className:"op-target",title:n,children:n})]}),(0,v.jsxs)(be.A,{children:[(0,v.jsxs)("p",{children:["\u5c06\u8981\u5bfc\u5165 ",(0,v.jsx)("strong",{children:t})," \u4e2a\u90e8\u95e8\uff0c\u5176\u4e2d\u5305\u62ec ",(0,v.jsx)("strong",{children:s})," \u4e2a\u6210\u5458"]}),this.state.isLoading&&(0,v.jsx)(w.A,{})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:"\u53d6\u6d88"}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:"\u5bfc\u5165"})]})]})}}])}(l.Component),Da=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getDepartmentsTree=function(e){for(var t=[],s=[],n=0;n<e.length;n++)-1===t.indexOf(e[n].id)&&t.push(e[n].id),-1===s.indexOf(e[n].parentid)&&s.push(e[n].parentid);var r=s.filter((function(e){return-1!==t.indexOf(e)})),a=s.concat(r).filter((function(e){return-1===s.indexOf(e)||-1===r.indexOf(e)})),i=fa()(e);return i.filter((function(e){var t=i.filter((function(t){return e.id===t.parentid}));return t.length>0&&(e.children=t),-1!==a.indexOf(e.parentid)}))},s.getWorkWeixinDepartmentsList=function(e){D.H.sysAdminListWorkWeixinDepartments(e).then((function(t){if(t.data.department||!t.data.errmsg)if(e)s.setState({importDepartmentChildrenCount:t.data.department.length,importDepartmentMembersCount:s.state.membersTempObj[e].length});else{var n=s.getDepartmentsTree(t.data.department);s.setState({isTreeLoading:!1,departmentsTree:n})}else N.A.danger(t.data.errmsg)})).catch((function(e){s.handleError(e),s.setState({isTreeLoading:!1,isMembersListLoading:!1}),e.response&&403===e.response.status&&(window.location=p.Yc+"sys/useradmin/")}))},s.getWorkWeixinDepartmentMembersList=function(e){s.setState({isMembersListLoading:!0}),D.H.sysAdminListWorkWeixinDepartmentMembers(e,{fetch_child:!0}).then((function(t){var n=s.state.membersTempObj;n[e]=t.data.userlist;var r=s.getCanCheckUserIds(t.data.userlist);s.setState({membersTempObj:n,membersList:t.data.userlist,isMembersListLoading:!1,canCheckUserIds:r})})).catch((function(e){s.setState({isMembersListLoading:!1}),s.handleError(e)}))},s.getCanCheckUserIds=function(e){var t=[];return e.forEach((function(e){e.email||t.push(e.userid)})),t},s.onChangeDepartment=function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1,checkedDepartmentId:e}),e in s.state.membersTempObj){var t=s.getCanCheckUserIds(s.state.membersTempObj[e]);s.setState({membersList:s.state.membersTempObj[e],canCheckUserIds:t})}else s.getWorkWeixinDepartmentMembersList(e)},s.onUserChecked=function(e){if(-1!==s.state.canCheckUserIds.indexOf(e.userid)){var t=s.state.newUsersTempObj;e.userid in t?(delete t[e.userid],s.state.isCheckedAll&&s.setState({isCheckedAll:!1})):(t[e.userid]=e,Object.keys(t).length===s.state.canCheckUserIds.length&&s.setState({isCheckedAll:!0})),s.setState({newUsersTempObj:t})}},s.onAllUsersChecked=function(){s.setState({isCheckedAll:!s.state.isCheckedAll},(function(){if(s.state.isCheckedAll){for(var e={},t=s.state.membersList.filter((function(e){return-1!==s.state.canCheckUserIds.indexOf(e.userid)})),n=0;n<t.length;n++)e[t[n].userid]=t[n];s.setState({newUsersTempObj:e})}else s.setState({newUsersTempObj:{}})}))},s.onSubmit=function(){var e=s.state.newUsersTempObj;if("{}"!==JSON.stringify(e)){var t=[];for(var n in e)t.push(e[n]);0!==t.length?D.H.sysAdminAddWorkWeixinUsersBatch(t).then((function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1}),e.data.success&&s.handleSubmitSuccess(e.data.success),e.data.failed)for(var t=e.data.failed,n=0;n<t.length;n++)N.A.danger(t[n].name+" "+t[n].error_msg,{duration:3})})).catch((function(e){s.handleError(e)})):N.A.danger("\u672a\u9009\u62e9\u6210\u5458",{duration:3})}},s.handleSubmitSuccess=function(e){for(var t=s.state,n=t.membersTempObj,r=t.membersList,a=t.canCheckUserIds,i=0;i<e.length;i++){var o=e[i],l=o.userid,c=o.name,d=o.email;N.A.success(c+" \u6210\u529f\u5bfc\u5165",{duration:1}),-1!==a.indexOf(l)&&a.splice(a.indexOf(l),1);for(var u=0;u<r.length;u++)if(r[u].userid===l){r[u].email=d;break}for(var h in n)for(var g=0;g<n[h].length;g++)if(n[h][g].userid===l){n[h][g].email=d;break}}s.setState({membersTempObj:n,membersList:r,canCheckUserIds:a})},s.importDepartmentDialogToggle=function(e){s.setState({isImportDepartmentDialogShow:!s.state.isImportDepartmentDialogShow,importDepartment:e},(function(){e&&s.getWorkWeixinDepartmentsList(e.id)}))},s.onImportDepartmentSubmit=function(){var e=s.state.importDepartment;e&&D.H.sysAdminImportWorkWeixinDepartment(e.id).then((function(t){s.setState({isMembersListLoading:!0,checkedDepartmentId:e.id,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[]}),s.getWorkWeixinDepartmentMembersList(e.id),s.importDepartmentDialogToggle(null),t.data.success&&s.handleImportDepartmentSubmitSuccess(t.data.success),t.data.failed&&s.handleImportDepartmentSubmitFailed(t.data.failed)})).catch((function(e){s.handleError(e)}))},s.handleImportDepartmentSubmitSuccess=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?"\u90e8\u95e8 "+n.department_name+" \u5bfc\u5165\u6210\u529f":n.api_user_name+" \u5bfc\u5165\u6210\u529f";N.A.success(r,{duration:3})}},s.handleImportDepartmentSubmitFailed=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?n.department_name:n.api_user_name;N.A.danger(r+" "+n.msg,{duration:3})}},s.handleError=function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)},s.state={isTreeLoading:!0,isMembersListLoading:!0,departmentsTree:[],checkedDepartmentId:0,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[],isImportDepartmentDialogShow:!1,importDepartment:null,importDepartmentChildrenCount:0,importDepartmentMembersCount:0},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.getWorkWeixinDepartmentsList(null)}},{key:"render",value:function(){var e=this.state,t=e.isImportDepartmentDialogShow,s=e.isTreeLoading,r=e.importDepartment,a=e.importDepartmentChildrenCount,i=e.importDepartmentMembersCount,o=!(!p.am||!t||s||!r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:this.onSubmit,children:"\u5bfc\u5165\u7528\u6237"})})),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:"\u4f01\u4e1a\u5fae\u4fe1\u96c6\u6210"})}),(0,v.jsxs)("div",{className:"cur-view-content d-flex flex-row p-0",children:[(0,v.jsx)(Sa,{departmentsTree:this.state.departmentsTree,isTreeLoading:this.state.isTreeLoading,onChangeDepartment:this.onChangeDepartment,checkedDepartmentId:this.state.checkedDepartmentId,importDepartmentDialogToggle:this.importDepartmentDialogToggle}),(0,v.jsx)("div",{className:"dir-content-resize"}),(0,v.jsx)(va,{isMembersListLoading:this.state.isMembersListLoading,membersList:this.state.membersList,checkedDepartmentId:this.state.checkedDepartmentId,newUsersTempObj:this.state.newUsersTempObj,onUserChecked:this.onUserChecked,onAllUsersChecked:this.onAllUsersChecked,isCheckedAll:this.state.isCheckedAll,canCheckUserIds:this.state.canCheckUserIds})]})]})}),o&&(0,v.jsx)(ya,{importDepartmentDialogToggle:this.importDepartmentDialogToggle,onImportDepartmentSubmit:this.onImportDepartmentSubmit,departmentsCount:a,membersCount:i,departmentName:r.name})]})}}])}(l.Component),Na=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.newUsersTempObj,n=t.checkedDepartmentId,r=t.isMembersListLoading,a=t.canCheckUserIds,i=this.props.membersList.map((function(t,r){var a=t.avatar;return a=t.avatar&&t.avatar.length>0?t.avatar:p.Yc+"media/avatars/default.png",(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:!t.email&&(0,v.jsx)("input",{type:"checkbox",className:"vam",onChange:function(){return e.props.onUserChecked(t)},checked:t.userid in s?"checked":""})}),(0,v.jsx)("td",{children:(0,v.jsx)("img",{className:"avatar",src:a,alt:""})}),(0,v.jsx)("td",{children:t.name}),(0,v.jsx)("td",{children:t.mobile}),(0,v.jsx)("td",{children:t.contact_email}),(0,v.jsx)("td",{children:t.email&&(0,v.jsx)("i",{className:"sf2-icon-tick"})})]},n.toString()+t.userid)}));return(0,v.jsxs)("div",{className:"dir-content-main",children:[r&&(0,v.jsx)(w.A,{}),!r&&this.props.membersList.length>0&&(0,v.jsxs)(xa.A,{hover:!0,children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"5%",children:a.length>0&&(0,v.jsx)("input",{type:"checkbox",className:"vam",checked:this.props.isCheckedAll,onChange:function(){return e.props.onAllUsersChecked()}})}),(0,v.jsx)("th",{width:"10%"}),(0,v.jsx)("th",{width:"20%",children:"\u540d\u79f0"}),(0,v.jsx)("th",{width:"20%",children:"\u624b\u673a\u53f7"}),(0,v.jsx)("th",{width:"30%",children:"\u90ae\u7bb1"}),(0,v.jsx)("th",{width:"15%",children:"\u5df2\u6dfb\u52a0"})]})}),(0,v.jsx)("tbody",{children:i})]}),!r&&0===this.props.membersList.length&&(0,v.jsxs)("div",{className:"message empty-tip text-center",children:[(0,v.jsx)("img",{src:"".concat(p.Yc,"media/img/member-list-empty-2x.png"),alt:""}),(0,v.jsx)("h4",{children:"\u6210\u5458\u5217\u8868\u4e3a\u7a7a"})]})]})}}])}(l.Component),wa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleChildren=function(e){e.preventDefault(),e.stopPropagation(),s.setState({isChildrenShow:!s.state.isChildrenShow})},s.dropdownToggle=function(e){e.stopPropagation(),s.setState({dropdownOpen:!s.state.dropdownOpen})},s.onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.state.dropdownOpen||s.setState({active:!1})},s.importDepartmentDialogToggle=function(e){s.setState({active:!1}),s.props.importDepartmentDialogToggle(e)},s.renderTreeNodes=function(e){if(e.length>0)return e.map((function(e){return(0,v.jsx)(t,{department:e,isChildrenShow:s.state.isChildrenShow,onChangeDepartment:s.props.onChangeDepartment,checkedDepartmentId:s.props.checkedDepartmentId,importDepartmentDialogToggle:s.importDepartmentDialogToggle},e.id)}))},s.changeDept=function(e){var t=s.props,n=t.department,r=t.checkedDepartmentId;s.props.onChangeDepartment(e),r!==n.id||s.state.isChildrenShow||s.setState({isChildrenShow:!0})},s.state={isChildrenShow:!1,dropdownOpen:!1,active:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){0===this.props.index&&(this.setState({isChildrenShow:!0}),this.props.onChangeDepartment(this.props.department.id))}},{key:"render",value:function(){var e=this,t=this.props,s=t.isChildrenShow,n=t.department,r=t.checkedDepartmentId,a=ge()({"folder-toggle-icon sf3-font sf3-font-down rotate-270":n.children&&this.state.isChildrenShow,"folder-toggle-icon sf3-font sf3-font-down":n.children&&!this.state.isChildrenShow}),i=ge()({"tree-node-inner":!0,"tree-node-inner-hover":this.state.active,"tree-node-hight-light":r===n.id});return(0,v.jsxs)(l.Fragment,{children:[s&&(0,v.jsxs)("div",{className:i,onClick:function(){return e.changeDept(n.id)},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,v.jsx)("span",{className:"tree-node-icon",onClick:function(t){return e.toggleChildren(t)},children:(0,v.jsx)("i",{className:a})}),(0,v.jsx)("span",{className:"tree-node-text",children:n.name}),p.am&&(0,v.jsxs)(mn.A,{isOpen:this.state.dropdownOpen,toggle:function(t){return e.dropdownToggle(t)},direction:"down",style:this.state.active?{}:{opacity:0},children:[(0,v.jsx)(fn.A,{tag:"span",className:"cursor-pointer right-icon",title:(0,p.AP)("More operations"),"aria-label":(0,p.AP)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.dropdownOpen,children:(0,v.jsx)("i",{className:"sf3-font sf3-font-more"})}),(0,v.jsx)(xn.A,{className:"drop-list",children:(0,v.jsx)(vn.A,{onClick:this.importDepartmentDialogToggle.bind(this,n),id:n.id,children:"\u5bfc\u5165\u90e8\u95e8"})})]})]}),this.state.isChildrenShow&&(0,v.jsx)("div",{className:"department-children",children:n.children&&this.renderTreeNodes(n.children)})]})}}])}(l.Component),ba=wa,Ia=function(e){function t(){return(0,r.default)(this,t),(0,i.default)(this,t,arguments)}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props.departmentsTree;return(0,v.jsx)("div",{className:"dir-content-nav",children:(0,v.jsx)("div",{className:"tree-view p-4",children:this.props.isTreeLoading?(0,v.jsx)(w.A,{}):(0,v.jsx)(v.Fragment,{children:t.length>0&&t.map((function(t,s){return(0,v.jsx)(ba,{index:s,department:t,isChildrenShow:!0,onChangeDepartment:e.props.onChangeDepartment,checkedDepartmentId:e.props.checkedDepartmentId,importDepartmentDialogToggle:e.props.importDepartmentDialogToggle},t.id)}))})})})}}])}(l.Component),ka=Ia,Ca=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggle=function(){s.props.importDepartmentDialogToggle(null)},s.handleSubmit=function(){s.props.onImportDepartmentSubmit(),s.setState({isLoading:!0})},s.state={isLoading:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.departmentsCount,s=e.membersCount,n=e.departmentName;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,children:[(0,v.jsxs)(Ce.A,{toggle:this.toggle,children:[(0,v.jsx)("span",{children:"\u5bfc\u5165\u90e8\u95e8 "}),(0,v.jsx)("span",{className:"op-target",title:n,children:n})]}),(0,v.jsxs)(be.A,{children:[(0,v.jsxs)("p",{children:["\u5c06\u8981\u5bfc\u5165 ",(0,v.jsx)("strong",{children:t})," \u4e2a\u90e8\u95e8\uff0c\u5176\u4e2d\u5305\u62ec ",(0,v.jsx)("strong",{children:s})," \u4e2a\u6210\u5458"]}),this.state.isLoading&&(0,v.jsx)(w.A,{})]}),(0,v.jsxs)(ke.A,{children:[(0,v.jsx)(y.A,{color:"secondary",onClick:this.toggle,children:"\u53d6\u6d88"}),(0,v.jsx)(y.A,{color:"primary",onClick:this.handleSubmit,children:"\u5bfc\u5165"})]})]})}}])}(l.Component),Ma=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getDepartmentsTree=function(e){for(var t=[],s=[],n=0;n<e.length;n++)-1===t.indexOf(e[n].id)&&t.push(e[n].id),-1===s.indexOf(e[n].parentid)&&s.push(e[n].parentid);var r=s.filter((function(e){return-1!==t.indexOf(e)})),a=s.concat(r).filter((function(e){return-1===s.indexOf(e)||-1===r.indexOf(e)})),i=fa()(e);return i.filter((function(e){var t=i.filter((function(t){return e.id===t.parentid}));return t.length>0&&(e.children=t),-1!==a.indexOf(e.parentid)}))},s.getDingtalkDepartmentsList=function(e){D.H.sysAdminListDingtalkDepartments(e).then((function(t){if(t.data.department||!t.data.errmsg)if(e)s.setState({importDepartmentChildrenCount:t.data.department.length,importDepartmentMembersCount:s.state.membersTempObj[e].length});else{var n=s.getDepartmentsTree(t.data.department);s.setState({isTreeLoading:!1,departmentsTree:n})}else N.A.danger(t.data.errmsg)})).catch((function(e){s.handleError(e),s.setState({isTreeLoading:!1,isMembersListLoading:!1}),e.response&&403===e.response.status&&(window.location=p.Yc+"sys/useradmin/")}))},s.getDingtalkDepartmentMembersList=function(e){s.setState({isMembersListLoading:!0}),D.H.sysAdminListDingtalkDepartmentMembers(e).then((function(t){var n=s.state.membersTempObj;n[e]=t.data.userlist;var r=s.getCanCheckUserIds(t.data.userlist);s.setState({membersTempObj:n,membersList:t.data.userlist,isMembersListLoading:!1,canCheckUserIds:r})})).catch((function(e){s.setState({isMembersListLoading:!1}),s.handleError(e)}))},s.getCanCheckUserIds=function(e){var t=[];return e.forEach((function(e){e.email||t.push(e.userid)})),t},s.onChangeDepartment=function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1,checkedDepartmentId:e}),e in s.state.membersTempObj){var t=s.getCanCheckUserIds(s.state.membersTempObj[e]);s.setState({membersList:s.state.membersTempObj[e],canCheckUserIds:t})}else s.getDingtalkDepartmentMembersList(e)},s.onUserChecked=function(e){if(-1!==s.state.canCheckUserIds.indexOf(e.userid)){var t=s.state.newUsersTempObj;e.userid in t?(delete t[e.userid],s.state.isCheckedAll&&s.setState({isCheckedAll:!1})):(t[e.userid]=e,Object.keys(t).length===s.state.canCheckUserIds.length&&s.setState({isCheckedAll:!0})),s.setState({newUsersTempObj:t})}},s.onAllUsersChecked=function(){s.setState({isCheckedAll:!s.state.isCheckedAll},(function(){if(s.state.isCheckedAll){for(var e={},t=s.state.membersList.filter((function(e){return-1!==s.state.canCheckUserIds.indexOf(e.userid)})),n=0;n<t.length;n++)e[t[n].userid]=t[n];s.setState({newUsersTempObj:e})}else s.setState({newUsersTempObj:{}})}))},s.onSubmit=function(){var e=s.state.newUsersTempObj;if("{}"!==JSON.stringify(e)){var t=[];for(var n in e)t.push(e[n]);0!==t.length?D.H.sysAdminAddDingtalkUsersBatch(t).then((function(e){if(s.setState({newUsersTempObj:{},isCheckedAll:!1}),e.data.success&&s.handleSubmitSuccess(e.data.success),e.data.failed)for(var t=e.data.failed,n=0;n<t.length;n++)N.A.danger(t[n].name+" "+t[n].error_msg,{duration:3})})).catch((function(e){s.handleError(e)})):N.A.danger("\u672a\u9009\u62e9\u6210\u5458",{duration:3})}},s.handleSubmitSuccess=function(e){for(var t=s.state,n=t.membersTempObj,r=t.membersList,a=t.canCheckUserIds,i=0;i<e.length;i++){var o=e[i],l=o.userid,c=o.name,d=o.email;N.A.success(c+" \u6210\u529f\u5bfc\u5165",{duration:1}),-1!==a.indexOf(l)&&a.splice(a.indexOf(l),1);for(var u=0;u<r.length;u++)if(r[u].userid===l){r[u].email=d;break}for(var h in n)for(var g=0;g<n[h].length;g++)if(n[h][g].userid===l){n[h][g].email=d;break}}s.setState({membersTempObj:n,membersList:r,canCheckUserIds:a})},s.importDepartmentDialogToggle=function(e){s.setState({isImportDepartmentDialogShow:!s.state.isImportDepartmentDialogShow,importDepartment:e},(function(){e&&s.getDingtalkDepartmentsList(e.id)}))},s.onImportDepartmentSubmit=function(){var e=s.state.importDepartment;e&&D.H.sysAdminImportDingtalkDepartment(e.id).then((function(t){s.setState({isMembersListLoading:!0,checkedDepartmentId:e.id,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[]}),s.getDingtalkDepartmentMembersList(e.id),s.importDepartmentDialogToggle(null),t.data.success&&s.handleImportDepartmentSubmitSuccess(t.data.success),t.data.failed&&s.handleImportDepartmentSubmitFailed(t.data.failed)})).catch((function(e){s.handleError(e)}))},s.handleImportDepartmentSubmitSuccess=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?"\u90e8\u95e8 "+n.department_name+" \u5bfc\u5165\u6210\u529f":n.api_user_name+" \u5bfc\u5165\u6210\u529f";N.A.success(r,{duration:3})}},s.handleImportDepartmentSubmitFailed=function(e){for(var t=0,s=e.length;t<s;t++){var n=e[t],r="department"===n.type?n.department_name:n.api_user_name;N.A.danger(r+" "+n.msg,{duration:3})}},s.handleError=function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)},s.state={isTreeLoading:!0,isMembersListLoading:!0,departmentsTree:[],checkedDepartmentId:0,membersTempObj:{},membersList:[],newUsersTempObj:{},isCheckedAll:!1,canCheckUserIds:[],isImportDepartmentDialogShow:!1,importDepartment:null,importDepartmentChildrenCount:0,importDepartmentMembersCount:0},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.getDingtalkDepartmentsList(null)}},{key:"render",value:function(){var e=this.state,t=e.isImportDepartmentDialogShow,s=e.isTreeLoading,r=e.importDepartment,a=e.importDepartmentChildrenCount,i=e.importDepartmentMembersCount,o=!(!p.am||!t||s||!r);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"operation-item",onClick:this.onSubmit,children:"\u5bfc\u5165\u7528\u6237"})})),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:"\u9489\u9489\u96c6\u6210"})}),(0,v.jsxs)("div",{className:"cur-view-content d-flex flex-row p-0",children:[(0,v.jsx)(ka,{departmentsTree:this.state.departmentsTree,isTreeLoading:this.state.isTreeLoading,onChangeDepartment:this.onChangeDepartment,checkedDepartmentId:this.state.checkedDepartmentId,importDepartmentDialogToggle:this.importDepartmentDialogToggle}),(0,v.jsx)("div",{className:"dir-content-resize"}),(0,v.jsx)(Na,{isMembersListLoading:this.state.isMembersListLoading,membersList:this.state.membersList,checkedDepartmentId:this.state.checkedDepartmentId,newUsersTempObj:this.state.newUsersTempObj,onUserChecked:this.onUserChecked,onAllUsersChecked:this.onAllUsersChecked,isCheckedAll:this.state.isCheckedAll,canCheckUserIds:this.state.canCheckUserIds})]})]})}),o&&(0,v.jsx)(Ca,{importDepartmentDialogToggle:this.importDepartmentDialogToggle,onImportDepartmentSubmit:this.onImportDepartmentSubmit,departmentsCount:a,membersCount:i,departmentName:r.name})]})}}])}(l.Component);L().extend(ue());var La=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getItemsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getItemsByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items,a=t.curPerPage,i=t.hasNextPage,o=t.currentPage;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center mt-4",children:n});var c=(0,v.jsx)(pe.A,{text:(0,p.AP)("No invitations")}),d=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Inviter")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Accepter")}),(0,v.jsx)("th",{width:"9%",children:(0,p.AP)("Type")}),(0,v.jsx)("th",{width:"14%",children:(0,p.AP)("Invited at")}),(0,v.jsx)("th",{width:"14%",children:(0,p.AP)("Accepted at")}),(0,v.jsx)("th",{width:"18%",children:(0,p.AP)("Expired at")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(_a,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteItem:e.props.deleteItem},s)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:o,hasNextPage:i,curPerPage:a,resetPerPage:this.props.resetPerPage})]});return r.length?d:c}}])}(l.Component),_a=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.deleteItem=function(){s.props.deleteItem(s.props.item)},s.translateOperations=function(e){var t="";if("Delete"===e)t=(0,p.AP)("Delete");return t},s.onMenuItemClick=function(e){if("Delete"===e)s.deleteItem()},s.getInviteTypeText=function(){var e="";switch(s.props.item.invite_type){case"Guest":case"guest":e=(0,p.AP)("Guest");break;case"Default":case"default":e=(0,p.AP)("Default");break;case"org":e=(0,p.AP)("Organization")}return e},s.state={isOpIconShown:!1,highlight:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item,t=this.state.isOpIconShown;return(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.inviter_email,name:e.inviter_name})}),(0,v.jsx)("td",{children:e.accept_time?(0,v.jsx)(Se,{email:e.accepter_email,name:e.accepter_name}):e.accepter_email}),(0,v.jsx)("td",{children:this.getInviteTypeText()}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{title:L()(e.invite_time).format("dddd, MMMM D, YYYY h:mm:ss A"),children:L()(e.invite_time).fromNow()})}),(0,v.jsx)("td",{children:e.accept_time?(0,v.jsx)("span",{title:L()(e.accept_time).format("dddd, MMMM D, YYYY h:mm:ss A"),children:L()(e.accept_time).fromNow()}):"--"}),(0,v.jsx)("td",{children:e.is_expired?(0,v.jsx)("span",{className:"text-red",children:L()(e.expire_time).format("YYYY-MM-DD HH:mm")}):L()(e.expire_time).format("YYYY-MM-DD HH:mm")}),(0,v.jsx)("td",{children:t&&(0,v.jsx)(Je.A,{operations:["Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]})})}}])}(l.Component),Oa=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getItemsByPage=function(e){var t=s.state.perPage;D.H.sysAdminListInvitations(e,t).then((function(n){s.setState({loading:!1,items:n.data.invitation_list,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count),currentPage:e})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.deleteItem=function(e){var t=e.token;D.H.sysAdminDeleteInvitation(t).then((function(e){var n=s.state.items.filter((function(e){return e.token!=t}));s.setState({items:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteItemInBatch=function(){D.H.sysAdminDeleteExpiredInvitations().then((function(e){var t=s.state.items,n=s.state.items.filter((function(e){return!e.is_expired||e.accept_time}));n.length<t.length&&(s.setState({items:n}),N.A.success((0,p.AP)("Operation succeeded.")))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getItemsByPage(1)}))},s.state={loading:!0,errorMsg:"",items:[],totalItemCount:0,hasNextPage:!1,currentPage:1,perPage:100},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getItemsByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.deleteItemInBatch,children:(0,p.AP)("Delete Expired Invitations")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Invitations")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(La,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.items,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getItemsByPage:this.getItemsByPage,deleteItem:this.deleteItem})})]})})]})}}])}(l.Component),Ua=s(67604),Ta=s(92203),Ra=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onKeyDown=function(e){e.stopPropagation()},s.toggle=function(){if(s.state.isValueChanged){var e=s.getCurrentContent();s.props.onCommit(e)}s.props.onCloseEditorDialog()},s.onContentChanged=function(){return s.setState({isValueChanged:!0})},s.getCurrentContent=function(){return s.editorRef.current.getValue()},s.setSimpleEditorRef=function(e){s.simpleEditor=e},s.state={isValueChanged:!1},s.editorRef=l.createRef(),s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.content,s=e.title,n=void 0===s?(0,p.AP)("Terms"):s;return(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.toggle,onKeyDown:this.onKeyDown,wrapClassName:"conditions-editor-dialog-wrapper",className:"conditions-editor-dialog",contentClassName:"conditions-editor-dialog-content",size:"lg",style:{width:770},children:[(0,v.jsx)(Ce.A,{className:"conditions-editor-dialog-title",toggle:this.toggle,children:n}),(0,v.jsx)(be.A,{className:"conditions-editor-dialog-main",children:(0,v.jsx)(Ta.SimpleEditor,{ref:this.editorRef,value:t||"",onContentChanged:this.onContentChanged})})]})}}])}(l.Component),Fa=Ra,Ea=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleNameChange=function(e){s.setState({name:e.target.value})},s.handleVersionNumberChange=function(e){s.setState({versionNumber:e.target.value.trim()})},s.handleTextChange=function(e){s.setState({text:e.target.value.trim()})},s.setActive=function(){s.setState({isActive:!0})},s.setInActive=function(){s.setState({isActive:!1})},s.addTerm=function(){var e=s.state,t=e.name,n=e.versionNumber,r=e.text,a=e.isActive;""!==t?""!==n?isNaN(n)?s.setState({errMsg:(0,p.AP)("Version Number must be a number.")}):""!==r?s.props.isUpdate?s.props.updateTerm(t,n,r,a):s.props.addTerm(t,n,r,a):s.setState({errMsg:(0,p.AP)("Text is required.")}):s.setState({errMsg:(0,p.AP)("Version Number is required.")}):s.setState({errMsg:(0,p.AP)("Name is required.")})},s.onContentClick=function(){s.setState({isConditionsEditorDialogShow:!s.state.isConditionsEditorDialogShow})},s.onCloseEditorDialog=function(){s.setState({isConditionsEditorDialogShow:!1})},s.onUpdateContent=function(e){s.setState({text:e})},s.state={name:"",versionNumber:"",text:"",isActive:!0,errorMsg:"",isConditionsEditorDialogShow:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.oldTermObj;e&&this.setState({name:e.name,versionNumber:e.version_number,text:e.text,isActive:!(""===e.activate_time)})}},{key:"render",value:function(){var e=this.props.isUpdate?(0,p.AP)("Update Terms and Conditions"):(0,p.AP)("Add Terms and Conditions");return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)(u.A,{isOpen:!0,toggle:this.props.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.props.toggle,children:e}),(0,v.jsxs)(be.A,{children:[(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{for:"name",children:(0,p.AP)("Name")}),(0,v.jsx)(Q.A,{id:"name",value:this.state.name,onChange:this.handleNameChange})]}),(0,v.jsxs)(_e.A,{children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Version Number")}),(0,v.jsx)(Q.A,{value:this.state.versionNumber,onChange:this.handleVersionNumberChange})]}),(0,v.jsxs)(_e.A,{className:"form-content",children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Text")}),(0,v.jsx)(Ua.A,{content:this.state.text,onContentClick:this.onContentClick})]}),(0,v.jsxs)(_e.A,{tag:"fieldset",children:[(0,v.jsx)(Oe.A,{children:(0,p.AP)("Activated")}),(0,v.jsx)(_e.A,{check:!0,children:(0,v.jsxs)(Oe.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"radio",checked:this.state.isActive,onChange:this.setActive})," ",(0,p.AP)("On")]})}),(0,v.jsx)(_e.A,{check:!0,children:(0,v.jsxs)(Oe.A,{check:!0,children:[(0,v.jsx)(Q.A,{type:"radio",checked:!this.state.isActive,onChange:this.setInActive})," ",(0,p.AP)("Off")]})})]}),this.state.errMsg&&(0,v.jsx)(Ie.A,{color:"danger",children:this.state.errMsg})]}),(0,v.jsx)(ke.A,{children:(0,v.jsx)(y.A,{color:"primary",onClick:this.addTerm,children:(0,p.AP)("Submit")})})]}),this.state.isConditionsEditorDialogShow&&(0,v.jsx)(Fa,{content:this.state.text,onCommit:this.onUpdateContent,onCloseEditorDialog:this.onCloseEditorDialog})]})}}])}(l.Component),Ba=Ea,za=/\[.+\]\(\S+\)|<img src=(\S+).+\/>|!\[\]\(\S+\)|<\S+>/g,qa=/^<img src="(\S+)" .+\/>/,Ha=/^!\[\]\((\S+)\)/,Ya=/^\[.+\]\(\S+\)/,Ga=/^<\S+>$/,Qa=function(e){for(var t="",s=e.replace(za,""),n=0;n<s.length&&("#"===s[n]||("\n"===s[n]?t+=" ":t+=s[n],30!==t.length));n++);var r=e.match(za);if(r){var a=function(e){var t={links:[],images:[]};return e.forEach((function(e){if(e.search(Ya)>=0||e.search(Ga)>=0)t.links.push(e);else{var s=e.match(qa),n=e.match(Ha);s?t.images.push(s[1]):n&&t.images.push(n[1])}})),t}(r);return{previewText:t,images:a.images,links:a.links}}return{previewText:t,images:[],links:[]}},Va=function(e){function t(){var e;(0,r.default)(this,t);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=(0,i.default)(this,t,[].concat(n))).toggle=function(){e.props.onClosePreviewDialog()},e}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.title,s=void 0===t?(0,p.AP)("Terms"):t,n=e.content;return(0,v.jsxs)(u.A,{isOpen:!0,size:"lg",style:{width:600},wrapClassName:"conditions-perview-wrapper",toggle:this.toggle,children:[(0,v.jsx)(Ce.A,{toggle:this.toggle,children:s}),(0,v.jsx)(be.A,{children:(0,v.jsx)(Ua.A,{content:n})})]})}}])}(l.Component),Wa=Va;L().extend(ue());var Ka=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,isHighlighted:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,isHighlighted:!1})},s.toggleUpdateDialog=function(e){s.setState({isUpdateDialogOpen:!s.state.isUpdateDialogOpen})},s.toggleDeleteDialog=function(e){s.setState({isDeleteDialogOpen:!s.state.isDeleteDialogOpen})},s.toggleTermsContentDialog=function(e){s.setState({isTermsPreviewDialogOpen:!s.state.isTermsPreviewDialogOpen})},s.onMenuItemClick=function(e){switch(e){case"Update":s.toggleUpdateDialog();break;case"Delete":s.toggleDeleteDialog()}},s.onUnfreezedItem=function(){s.setState({isHighlighted:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.deleteTerm=function(){s.props.deleteTerm(s.props.item.id),s.toggleDeleteDialog()},s.updateTerm=function(e,t,n,r){s.props.updateTerm(s.props.item.id,e,t,n,r),s.toggleUpdateDialog()},s.translateOperations=function(e){var t="";switch(e){case"Update":t=(0,p.AP)("Update");break;case"Delete":t=(0,p.AP)("Delete")}return t},s.state={itemContent:"...",isHighlighted:!1,isOpIconShown:!1,isUpdateDialogOpen:!1,isDeleteDialogOpen:!1,isTermsPreviewDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.item.text;Ta.processor.process(t).then((function(t){var s=String(t);e.setState({itemContent:s})}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;if(e.item.text!==this.props.item.text){var s=e.item.text;Ta.processor.process(s).then((function(e){var s=String(e);t.setState({itemContent:s})}))}}},{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.isDeleteDialogOpen,n=t.isUpdateDialogOpen,r=t.isTermsPreviewDialogOpen,a=t.isHighlighted,i=Qa(e.text),o='<span class="op-target">'+m.Aq.HTMLescape(e.name)+"</span>",c=(0,p.AP)("Are you sure you want to delete {placeholder} ?").replace("{placeholder}",o);return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("tr",{className:ge()({"tr-highlight":a}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:e.name}),(0,v.jsx)("td",{children:e.version_number}),(0,v.jsx)("td",{className:"ellipsis",children:(0,v.jsx)("a",{href:"#",onClick:this.toggleTermsContentDialog,children:i.previewText})}),(0,v.jsx)("td",{children:L()(e.ctime).fromNow()}),(0,v.jsx)("td",{children:e.activate_time?L()(e.activate_time).fromNow():"--"}),(0,v.jsx)("td",{children:this.state.isOpIconShown&&(0,v.jsx)(Je.A,{operations:["Update","Delete"],translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]}),s&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(qe.A,{title:(0,p.AP)("Delete T&C"),message:c,toggleDialog:this.toggleDeleteDialog,executeOperation:this.deleteTerm,confirmBtnText:(0,p.AP)("Delete")})}),n&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Ba,{updateTerm:this.updateTerm,toggle:this.toggleUpdateDialog,isUpdate:!0,oldTermObj:e})}),r&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Wa,{content:e.text,onClosePreviewDialog:this.toggleTermsContentDialog})})]})}}])}(l.Component),Xa=Ka,$a=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.items;if(s)return(0,v.jsx)(w.A,{});if(n)return(0,v.jsx)("p",{className:"error text-center",children:n});var a=(0,v.jsx)(pe.A,{text:(0,p.AP)("No terms and conditions")}),i=(0,v.jsx)(l.Fragment,{children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Version")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Text")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Created")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Activated")}),(0,v.jsx)("th",{width:"5%"})]})}),r&&(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(Xa,{item:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,deleteTerm:e.props.deleteTerm,updateTerm:e.props.updateTerm},s)}))})]})});return r.length?i:a}}])}(l.Component),Ja=$a,Za=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).toggleAddTermDialog=function(){s.setState({isAddTermDialogOpen:!s.state.isAddTermDialogOpen})},s.addTerm=function(e,t,s,n){D.H.sysAdminAddTermAndCondition(e,t,s,n).then((function(e){location.reload()})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.updateTerm=function(e,t,n,r,a){D.H.sysAdminUpdateTermAndCondition(e,t,n,r,a).then((function(t){var n=s.state.termList.map((function(s){return s.id==e?t.data:s}));s.setState({termList:n}),N.A.success((0,p.AP)("Update succeeded."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.deleteTerm=function(e){D.H.sysAdminDeleteTermAndCondition(e).then((function(t){var n=s.state.termList.filter((function(t){return t.id!=e}));s.setState({termList:n}),N.A.success((0,p.AP)("Successfully deleted 1 item."))})).catch((function(e){var t=m.Aq.getErrorMsg(e);N.A.danger(t)}))},s.state={loading:!0,errorMsg:"",termList:[],isAddTermDialogOpen:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this;D.H.sysAdminListTermsAndConditions().then((function(t){e.setState({termList:t.data.term_and_condition_list,loading:!1})})).catch((function(t){e.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(t,!0)})}))}},{key:"render",value:function(){var e=this.state,t=e.termList,s=e.isAddTermDialogOpen;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsx)(y.A,{className:"btn btn-secondary operation-item",onClick:this.toggleAddTermDialog,children:(0,p.AP)("Add")})})),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Terms and Conditions")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(Ja,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,deleteTerm:this.deleteTerm,updateTerm:this.updateTerm})})]})}),s&&(0,v.jsx)(Jt.A,{children:(0,v.jsx)(Ba,{isUpdate:!1,addTerm:this.addTerm,toggle:this.toggleAddTermDialog})})]})}}])}(l.Component),ei=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"all",urlPart:"all",text:(0,p.AP)("All")},{name:"unhandled",urlPart:"unhandled",text:(0,p.AP)("Unhandled")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/virus-files/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component),ti=ei,si=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){s.props.handleFile(s.props.virusFile.virus_id,e)},s.translateOperations=function(e){var t="";switch(e){case"delete":t=(0,p.AP)("Delete");break;case"ignore":t=(0,p.AP)("Ignore");break;case"do-not-ignore":t=(0,p.AP)("Don't ignore")}return t},s.state={highlight:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.virusFile,t="",s=[];return e.has_deleted?t=(0,v.jsx)("span",{className:"text-green",children:(0,p.AP)("Deleted")}):e.has_ignored?(t=(0,v.jsx)("span",{className:"text-orange",children:(0,p.AP)("Ignored")}),s=["do-not-ignore"]):(t=(0,v.jsx)("span",{className:"text-red",children:(0,p.AP)("Unhandled")}),s=["delete","ignore"]),(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_owner}),(0,v.jsx)("td",{children:e.file_path}),(0,v.jsx)("td",{children:t}),(0,v.jsx)("td",{children:s.length>0&&this.state.isOpIconShown&&(0,v.jsx)(Je.A,{operations:s,translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]})}}])}(l.Component),ni=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.virusFiles,a=t.curPerPage,i=t.hasNextPage,o=t.currentPage;return s?(0,v.jsx)(w.A,{}):n?(0,v.jsx)("p",{className:"error text-center mt-4",children:n}):(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"27%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"28%",children:(0,p.AP)("Virus File")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(si,{virusFile:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,handleFile:e.props.handleFile},s)}))})]}),r.length>0&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:o,hasNextPage:i,curPerPage:a,resetPerPage:this.props.resetPerPage})]})}}])}(l.Component),ri=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getListByPage=function(e){var t=s.state.perPage;D.H.sysAdminListVirusFiles(e,t).then((function(e){var t=e.data;s.setState({loading:!1,virusFiles:t.virus_file_list,hasNextPage:t.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getListByPage(1)}))},s.handleFile=function(e,t){var n;switch(t){case"delete":n=D.H.sysAdminDeleteVirusFile(e);break;case"ignore":n=D.H.sysAdminToggleIgnoreVirusFile(e,!0);break;case"do-not-ignore":n=D.H.sysAdminToggleIgnoreVirusFile(e,!1)}n.then((function(n){s.setState({virusFiles:s.state.virusFiles.map((function(s){return s.virus_id==e&&("delete"==t?s.has_deleted=!0:s=n.data.virus_file),s}))})})).catch((function(e){N.A.danger(m.Aq.getErrorMsg(e))}))},s.state={loading:!0,errorMsg:"",virusFiles:[],currentPage:1,perPage:100,hasNextPage:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(ti,{currentItem:"all"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ni,{loading:this.state.loading,errorMsg:this.state.errorMsg,virusFiles:this.state.virusFiles,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getListByPage,handleFile:this.handleFile})})]})})]})}}])}(l.Component),ai=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).handleMouseEnter=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!0,highlight:!0})},s.handleMouseLeave=function(){s.props.isItemFreezed||s.setState({isOpIconShown:!1,highlight:!1})},s.onUnfreezedItem=function(){s.setState({highlight:!1,isOpIconShow:!1}),s.props.onUnfreezedItem()},s.onMenuItemClick=function(e){s.props.handleFile(s.props.virusFile.virus_id,e)},s.translateOperations=function(e){var t="";switch(e){case"delete":t=(0,p.AP)("Delete");break;case"ignore":t=(0,p.AP)("Ignore");break;case"do-not-ignore":t=(0,p.AP)("Don't ignore")}return t},s.toggleItemSelected=function(e){s.props.toggleItemSelected(s.props.virusFile,e.target.checked)},s.state={highlight:!1,isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.virusFile,t="",s=[];return e.has_deleted?t=(0,v.jsx)("span",{className:"text-green",children:(0,p.AP)("Deleted")}):e.has_ignored?(t=(0,v.jsx)("span",{className:"text-orange",children:(0,p.AP)("Ignored")}),s=["do-not-ignore"]):(t=(0,v.jsx)("span",{className:"text-red",children:(0,p.AP)("Unhandled")}),s=["delete","ignore"]),(0,v.jsxs)("tr",{className:this.state.highlight?"tr-highlight":"",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[(0,v.jsx)("td",{className:"text-center",children:(0,v.jsx)("input",{type:"checkbox",checked:e.isSelected,onChange:this.toggleItemSelected})}),(0,v.jsx)("td",{children:e.repo_name}),(0,v.jsx)("td",{children:e.repo_owner}),(0,v.jsx)("td",{children:e.file_path}),(0,v.jsx)("td",{children:t}),(0,v.jsx)("td",{children:s.length>0&&this.state.isOpIconShown&&(0,v.jsx)(Je.A,{operations:s,translateOperations:this.translateOperations,onMenuItemClick:this.onMenuItemClick,onFreezedItem:this.props.onFreezedItem,onUnfreezedItem:this.onUnfreezedItem})})]})}}])}(l.Component),ii=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).onFreezedItem=function(){s.setState({isItemFreezed:!0})},s.onUnfreezedItem=function(){s.setState({isItemFreezed:!1})},s.getPreviousPage=function(){s.props.getListByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getListByPage(s.props.currentPage+1)},s.state={isItemFreezed:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.loading,n=t.errorMsg,r=t.virusFiles,a=t.curPerPage,i=t.hasNextPage,o=t.currentPage,c=t.isAllItemsSelected;return s?(0,v.jsx)(w.A,{}):n?(0,v.jsx)("p",{className:"error text-center mt-4",children:n}):(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"3%",className:"text-center",children:(0,v.jsx)("input",{type:"checkbox",checked:c,onChange:this.props.toggleAllSelected})}),(0,v.jsx)("th",{width:"24%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Owner")}),(0,v.jsx)("th",{width:"28%",children:(0,p.AP)("Virus File")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"5%"})]})}),(0,v.jsx)("tbody",{children:r.map((function(t,s){return(0,v.jsx)(ai,{virusFile:t,isItemFreezed:e.state.isItemFreezed,onFreezedItem:e.onFreezedItem,onUnfreezedItem:e.onUnfreezedItem,handleFile:e.props.handleFile,toggleItemSelected:e.props.toggleItemSelected},s)}))})]}),r.length>0&&(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:o,hasNextPage:i,curPerPage:a,resetPerPage:this.props.resetPerPage})]})}}])}(l.Component),oi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getListByPage=function(e){var t=s.state.perPage;D.H.sysAdminListVirusFiles(e,t,!1).then((function(e){var t=e.data,n=t.virus_file_list.map((function(e){return e.isSelected=!1,e}));s.setState({loading:!1,virusFiles:n,hasNextPage:t.has_next_page})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){s.getListByPage(1)}))},s.handleFile=function(e,t){var n;switch(t){case"delete":n=D.H.sysAdminDeleteVirusFile(e);break;case"ignore":n=D.H.sysAdminToggleIgnoreVirusFile(e,!0);break;case"do-not-ignore":n=D.H.sysAdminToggleIgnoreVirusFile(e,!1)}n.then((function(n){s.setState({virusFiles:s.state.virusFiles.map((function(s){return s.virus_id==e&&("delete"==t?s.has_deleted=!0:s=n.data.virus_file),s}))})})).catch((function(e){N.A.danger(m.Aq.getErrorMsg(e))}))},s.toggleAllSelected=function(){s.setState((function(e){return{isAllItemsSelected:!e.isAllItemsSelected,virusFiles:s.state.virusFiles.map((function(t){return t.isSelected=!e.isAllItemsSelected,t}))}}))},s.toggleItemSelected=function(e,t){s.setState({virusFiles:s.state.virusFiles.map((function(s){return s===e&&(s.isSelected=t),s}))},(function(){s.setState({isAllItemsSelected:!s.state.virusFiles.some((function(e){return!e.isSelected}))})}))},s.handleSelectedItems=function(e){var t=s.state.virusFiles.filter((function(t){return"delete-virus"==e?t.isSelected&&!t.has_deleted:t.isSelected&&!t.has_ignored})).map((function(e){return e.virus_id}));D.H.sysAdminBatchProcessVirusFiles(t,e).then((function(t){var n=s.state.virusFiles;t.data.success.forEach((function(t){var s=n.find((function(e){return e.virus_id==t.virus_id}));"delete-virus"==e?s.has_deleted=!0:s.has_ignored=!0})),s.setState({virusFiles:n}),t.data.failed.forEach((function(t){var s=n.find((function(e){return e.virus_id==t.virus_id})),r="delete-virus"==e?(0,p.AP)("Failed to delete %(virus_file) from library %(library): %(error_msg)"):(0,p.AP)("Failed to ignore %(virus_file) from library %(library): %(error_msg)");r=r.replace("%(virus_file)",s.file_path).replace("%(library)",s.repo_name).replace("%(error_msg)",t.error_msg),N.A.danger(r)}))})).catch((function(e){N.A.danger(m.Aq.getErrorMsg(e))}))},s.deleteSelectedItems=function(){s.handleSelectedItems("delete-virus")},s.ignoreSelectedItems=function(){s.handleSelectedItems("ignore-virus")},s.state={loading:!0,errorMsg:"",virusFiles:[],isAllItemsSelected:!1,selectedItems:[],currentPage:1,perPage:100,hasNextPage:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getListByPage(e.state.currentPage)}))}},{key:"render",value:function(){return(0,v.jsxs)(l.Fragment,{children:[this.state.virusFiles.some((function(e){return e.isSelected}))?(0,v.jsx)(b.A,(0,n.default)((0,n.default)({},this.props),{},{children:(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(y.A,{onClick:this.deleteSelectedItems,className:"operation-item",children:(0,p.AP)("Delete")}),(0,v.jsx)(y.A,{onClick:this.ignoreSelectedItems,className:"operation-item",children:(0,p.AP)("Ignore")})]})})):(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(ti,{currentItem:"unhandled"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ii,{loading:this.state.loading,errorMsg:this.state.errorMsg,virusFiles:this.state.virusFiles,currentPage:this.state.currentPage,hasNextPage:this.state.hasNextPage,curPerPage:this.state.perPage,resetPerPage:this.resetPerPage,getListByPage:this.getListByPage,handleFile:this.handleFile,isAllItemsSelected:this.state.isAllItemsSelected,toggleAllSelected:this.toggleAllSelected,toggleItemSelected:this.toggleItemSelected})})]})})]})}}])}(l.Component),li=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).navItems=[{name:"adminOperationLogs",urlPart:"admin-logs/operation",text:(0,p.AP)("Admin Operation Logs")},{name:"adminLoginLogs",urlPart:"admin-logs/login",text:(0,p.AP)("Admin Login Logs")}],s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.currentItem;return(0,v.jsx)("div",{className:"cur-view-path tab-nav-container",children:(0,v.jsx)("ul",{className:"nav",children:this.navItems.map((function(t,s){return(0,v.jsx)("li",{className:"nav-item",children:(0,v.jsx)(h.N_,{to:"".concat(p.Yc,"sys/").concat(t.urlPart,"/"),className:"nav-link".concat(e==t.name?" active":""),children:t.text})},s)}))})})}}])}(l.Component);L().extend(ue());var ci=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.props.getLogsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getLogsByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,a=e.currentPage,i=e.hasNextPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No Admin operation logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Operation")}),(0,v.jsx)("th",{width:"50%",children:(0,p.AP)("Detail")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Time")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(di,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),di=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getOperationText=function(e){switch(e){case"repo_create":return(0,p.AP)("Create Library");case"repo_delete":return(0,p.AP)("Delete Library");case"repo_transfer":return(0,p.AP)("Transfer Library");case"group_create":return(0,p.AP)("Create Group");case"group_transfer":return(0,p.AP)("Transfer Group");case"group_delete":return(0,p.AP)("Delete Group");case"user_add":return(0,p.AP)("Add User");case"user_delete":return(0,p.AP)("Delete User");case"user_migrate":return(0,p.AP)("Migrate User");case"group_member_add":return(0,p.AP)("Add User to Group");case"group_member_delete":return(0,p.AP)("Delete User from Group");default:return""}},s.getOperationDetail=function(e){var t=e.detail,s="";t.owner&&(s=p.Yc+"sys/users/"+encodeURIComponent(t.owner)+"/");var n="";t.email&&(n=p.Yc+"sys/users/"+encodeURIComponent(t.email)+"/");var r="",a="",i="";switch("repo_create"!=e.operation&&"repo_delete"!=e.operation&&"repo_transfer"!=e.operation||(a=p.Yc+"sys/libraries/"+t.id+"/"+encodeURIComponent(t.name)+"/"),"group_create"!=e.operation&&"group_delete"!=e.operation&&"group_transfer"!=e.operation||(i=p.Yc+"sys/groups/"+t.id+"/libraries/"),e.operation){case"repo_create":return r=(0,p.AP)("Created library {library_name} with {owner} as its owner").replace("{owner}",'<a href="'+s+'">'+t.owner+"</a>"),r=p.am&&p.ZD?r.replace("{library_name}",'<a href="'+a+'">'+m.Aq.HTMLescape(t.name)+"</a>"):r.replace("{library_name}",'<span class="font-weight-bold">'+m.Aq.HTMLescape(t.name)+"</span>");case"repo_delete":return r=(0,p.AP)("Deleted library {library_name}").replace("{library_name}",'<span class="font-weight-bold">'+m.Aq.HTMLescape(t.name)+"</span>");case"repo_transfer":return r=(0,p.AP)("Transferred library {library_name} from {user_from} to {user_to}").replace("{user_from}",'<span class="font-weight-bold">'+t.from+"</span>").replace("{user_to}",'<span class="font-weight-bold">'+t.to+"</span>"),r=p.am&&p.ZD?r.replace("{library_name}",'<a href="'+a+'">'+m.Aq.HTMLescape(t.name)+"</a>"):r.replace("{library_name}",'<span class="font-weight-bold">'+m.Aq.HTMLescape(t.name)+"</span>");case"group_create":return r=(0,p.AP)("Created group {group_name}").replace("{group_name}",'<a href="'+i+'">'+t.name+"</a>");case"group_transfer":return r=(0,p.AP)("Transferred group {group_name} from {user_from} to {user_to}").replace("{user_from}",'<span class="font-weight-bold">'+t.from+"</span>").replace("{user_to}",'<span class="font-weight-bold">'+t.to+"</span>").replace("{group_name}",'<a href="'+i+'">'+t.name+"</a>");case"group_delete":return r=(0,p.AP)("Deleted group {group_name}").replace("{group_name}",'<span class="font-weight-bold">'+t.name+"</span>");case"user_add":return r=(0,p.AP)("Added user {user}").replace("{user}",'<a href="'+n+'">'+t.email+"</a>");case"user_delete":return r=(0,p.AP)("Deleted user {user}").replace("{user}",'<span class="font-weight-bold">'+t.email+"</span>");case"user_migrate":return r=(0,p.AP)("User migrate from {user_from} to {user_to}").replace("{user_from}",'<span class="font-weight-bold">'+t.from+"</span>").replace("{user_to}",'<span class="font-weight-bold">'+t.to+"</span>");case"group_member_add":return r=(0,p.AP)("Added user {user} to group {group}").replace("{user}",'<span class="font-weight-bold">'+t.user+"</span>").replace("{group}",'<span class="font-weight-bold">'+t.name+"</span>");case"group_member_delete":return r=(0,p.AP)("Deleted user {user} from group {group}").replace("{user}",'<span class="font-weight-bold">'+t.user+"</span>").replace("{group}",'<span class="font-weight-bold">'+t.name+"</span>");default:return""}},s.state={isOpIconShown:!1},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:this.getOperationText(e.operation)}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{dangerouslySetInnerHTML:{__html:this.getOperationDetail(e)}})}),(0,v.jsx)("td",{children:L()(e.datetime).fromNow()})]})}}])}(l.Component),ui=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state.perPage;D.H.sysAdminListAdminLogs(e,t).then((function(n){s.setState({logList:n.data.data,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.logList,s=e.currentPage,r=e.perPage,a=e.hasNextPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(li,{currentItem:"adminOperationLogs"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(ci,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:r,hasNextPage:a,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})})]})})]})}}])}(l.Component);L().extend(ue());var hi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getPreviousPage=function(){s.props.getLogsByPage(s.props.currentPage-1)},s.getNextPage=function(){s.props.getLogsByPage(s.props.currentPage+1)},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.loading,s=e.errorMsg,n=e.items,r=e.perPage,a=e.currentPage,i=e.hasNextPage;if(t)return(0,v.jsx)(w.A,{});if(s)return(0,v.jsx)("p",{className:"error text-center",children:s});var o=(0,v.jsx)(pe.A,{text:(0,p.AP)("No Admin login logs")}),c=(0,v.jsxs)(l.Fragment,{children:[(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Name")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("IP")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Status")}),(0,v.jsx)("th",{width:"25%",children:(0,p.AP)("Time")})]})}),n&&(0,v.jsx)("tbody",{children:n.map((function(e,t){return(0,v.jsx)(gi,{item:e},t)}))})]}),(0,v.jsx)(X.A,{gotoPreviousPage:this.getPreviousPage,gotoNextPage:this.getNextPage,currentPage:a,hasNextPage:i,curPerPage:r,resetPerPage:this.props.resetPerPage})]});return n.length?c:o}}])}(l.Component),gi=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,t,[e])}return(0,o.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.item;return(0,v.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[(0,v.jsx)("td",{children:(0,v.jsx)(Se,{email:e.email,name:e.name})}),(0,v.jsx)("td",{children:e.login_ip}),(0,v.jsx)("td",{children:e.login_success?(0,p.AP)("Success"):(0,p.AP)("Failed")}),(0,v.jsx)("td",{children:L()(e.login_time).fromNow()})]})}}])}(l.Component),pi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getLogsByPage=function(e){var t=s.state.perPage;D.H.sysAdminListAdminLoginLogs(e,t).then((function(n){s.setState({logList:n.data.data,loading:!1,currentPage:e,hasNextPage:m.Aq.hasNextPage(e,t,n.data.total_count)})})).catch((function(e){s.setState({loading:!1,errorMsg:m.Aq.getErrorMsg(e,!0)})}))},s.resetPerPage=function(e){s.setState({perPage:e},(function(){return s.getLogsByPage(s.initPage)}))},s.state={loading:!0,errorMsg:"",logList:[],perPage:100,currentPage:1,hasNextPage:!1},s.initPage=1,s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location).searchParams,s=this.state,n=s.currentPage,r=s.perPage;this.setState({perPage:parseInt(t.get("per_page")||r),currentPage:parseInt(t.get("page")||n)},(function(){e.getLogsByPage(e.state.currentPage)}))}},{key:"render",value:function(){var e=this.state,t=e.logList,s=e.currentPage,r=e.perPage,a=e.hasNextPage;return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center flex-row",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)(li,{currentItem:"adminLoginLogs"}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsx)(hi,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:t,currentPage:s,perPage:r,hasNextPage:a,getLogsByPage:this.getLogsByPage,resetPerPage:this.resetPerPage})})]})})]})}}])}(l.Component),mi=function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).listAbuseReports=function(){D.H.sysAdminListAbuseReports().then((function(e){s.setState({abuseReportList:e.data.abuse_report_list})})).catch((function(e){s.handleError(e)}))},s.updateAbuseReport=function(e,t){D.H.sysAdminUpdateAbuseReport(e,t).then((function(e){var n=s.state.abuseReportList.map((function(s,n){return s.id===t&&(s.handled=e.data.handled),s}));s.setState({abuseReportList:n})})).catch((function(e){s.handleError(e)}))},s.handleError=function(e){e.response?N.A.danger(e.response.data.error_msg||e.response.data.detail||(0,p.AP)("Error"),{duration:3}):N.A.danger((0,p.AP)("Please check the network."),{duration:3})},s.state={abuseReportList:[]},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.listAbuseReports()}},{key:"render",value:function(){var e=this,t=this.state.abuseReportList.map((function(t,s){var n=(!t.handled).toString(),r=t.id,a=p.Yc+"lib/"+t.repo_id+"/file"+t.file_path;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:t.repo_name}),(0,v.jsx)("td",{children:(0,v.jsx)("a",{href:a,target:"_blank",rel:"noreferrer",children:t.file_path})}),(0,v.jsx)("td",{children:t.reporter}),(0,v.jsx)("td",{children:t.abuse_type}),(0,v.jsx)("td",{children:t.description}),(0,v.jsx)("td",{children:L()(t.time).format("YYYY-MM-DD")}),(0,v.jsx)("td",{children:(0,v.jsx)("p",{onClick:e.updateAbuseReport.bind(e,n,r),className:"op-target ellipsis ellipsis-op-target cursor-pointer",children:(0,p.AP)(t.handled.toString())})})]},s)}));return(0,v.jsxs)(l.Fragment,{children:[(0,v.jsx)(b.A,(0,n.default)({},this.props)),(0,v.jsx)("div",{className:"main-panel-center",children:(0,v.jsxs)("div",{className:"cur-view-container",children:[(0,v.jsx)("div",{className:"cur-view-path",children:(0,v.jsx)("h3",{className:"sf-heading",children:(0,p.AP)("Abuse Reports")})}),(0,v.jsx)("div",{className:"cur-view-content",children:(0,v.jsxs)("table",{className:"table-hover",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Library")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("File")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Reporter")}),(0,v.jsx)("th",{width:"15%",children:(0,p.AP)("Abuse Type")}),(0,v.jsx)("th",{width:"20%",children:(0,p.AP)("Description")}),(0,v.jsx)("th",{width:"10%",children:(0,p.AP)("Time")}),(0,v.jsx)("th",{width:"5%",children:(0,p.AP)("Handled")})]})}),(0,v.jsx)("tbody",{children:t})]})})]})})]})}}])}(l.Component),fi=(s(16322),s(18291),function(e){function t(e){var s;return(0,r.default)(this,t),(s=(0,i.default)(this,t,[e])).getCurrentTabForPageList=function(e){for(var t,s,n="".concat(p.Yc,"sys/"),r=0,a=e.length;r<a;r++){t=e[r].urlPartList,s=e[r].tab;for(var i=0,o=t.length;i<o;i++)if(-1!=location.href.indexOf("".concat(n).concat(t[i])))return s}},s.onCloseSidePanel=function(){s.setState({isSidePanelClosed:!s.state.isSidePanelClosed})},s.tabItemClick=function(e){s.setState({currentTab:e}),m.Aq.isDesktop()||s.state.isSidePanelClosed||s.setState({isSidePanelClosed:!0})},s.toggleSidePanel=function(){s.setState({isSidePanelClosed:!s.state.isSidePanelClosed})},s.state={isSidePanelClosed:!1,currentTab:"file-scan"},s}return(0,o.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){var e=window.location.href.split("/"),t=e[e.length-2],s=this.getCurrentTabForPageList([{tab:"devices",urlPartList:["desktop-devices","mobile-devices","device-errors"]},{tab:"libraries",urlPartList:["all-libraries","search-libraries","system-library","trash-libraries","libraries/"]},{tab:"statistic",urlPartList:["statistics/file","statistics/storage","statistics/user","statistics/traffic","statistics/reports","statistics/metrics"]},{tab:"users",urlPartList:["users/","search-users/"]},{tab:"groups",urlPartList:["groups/","search-groups/"]},{tab:"organizations",urlPartList:["organizations/","search-organizations/"]},{tab:"links",urlPartList:["share-links/","upload-links/"]},{tab:"institutions",urlPartList:["institutions/"]},{tab:"termsandconditions",urlPartList:["terms-and-conditions/"]},{tab:"departments",urlPartList:["departments/"]},{tab:"logs",urlPartList:["logs/"]},{tab:"virus-files",urlPartList:["virus-files/"]},{tab:"adminLogs",urlPartList:["admin-logs/"]}]);t=s||t,this.setState({currentTab:t})}},{key:"UNSAFE_componentWillMount",value:function(){m.Aq.isDesktop()||this.setState({isSidePanelClosed:!0})}},{key:"render",value:function(){var e=this.state,t=e.currentTab,s=e.isSidePanelClosed,r={toggleSidePanel:this.toggleSidePanel};return(0,v.jsxs)("div",{id:"main",className:"sys-admin",children:[(0,v.jsx)(j,{isSidePanelClosed:s,onCloseSidePanel:this.onCloseSidePanel,currentTab:t,tabItemClick:this.tabItemClick}),(0,v.jsx)(S,{children:(0,v.jsxs)(h.Ix,{className:"reach-router",children:[(0,v.jsx)(k,(0,n.default)({path:p.Yc+"sys/info"},r)),(0,v.jsx)(Y,(0,n.default)({path:p.Yc+"sys/statistics/file"},r)),(0,v.jsx)(G,(0,n.default)({path:p.Yc+"sys/statistics/storage"},r)),(0,v.jsx)(ee,(0,n.default)({path:p.Yc+"sys/statistics/user"},r)),(0,v.jsx)(Z,(0,n.default)({path:p.Yc+"sys/statistics/traffic"},r)),(0,v.jsx)(te,(0,n.default)({path:p.Yc+"sys/statistics/reports"},r)),(0,v.jsx)(oe,(0,n.default)({path:p.Yc+"sys/statistics/metrics"},r)),(0,v.jsx)(Ae,(0,n.default)({path:p.Yc+"sys/desktop-devices"},r)),(0,v.jsx)(je,(0,n.default)({path:p.Yc+"sys/mobile-devices"},r)),(0,v.jsx)(Ne,(0,n.default)({path:p.Yc+"sys/device-errors"},r)),(0,v.jsx)(Ps,(0,n.default)({path:p.Yc+"sys/all-libraries"},r)),(0,v.jsx)(Ss,(0,n.default)({path:p.Yc+"sys/all-wikis"},r)),(0,v.jsx)(Ns,(0,n.default)({path:p.Yc+"sys/system-library"},r)),(0,v.jsx)(Cs,(0,n.default)({path:p.Yc+"sys/trash-libraries"},r)),(0,v.jsx)(Ms,(0,n.default)({path:p.Yc+"sys/search-libraries"},r)),(0,v.jsx)(Bs,(0,n.default)({path:p.Yc+"sys/libraries/:repoID/*"},r)),(0,v.jsx)(oa,(0,n.default)({path:p.Yc+"sys/web-settings"},r)),(0,v.jsx)(ua,(0,n.default)({path:p.Yc+"sys/notifications"},r)),(0,v.jsx)(Ws,(0,n.default)({path:p.Yc+"sys/groups"},r)),(0,v.jsx)(Ks,(0,n.default)({path:p.Yc+"sys/search-groups"},r)),(0,v.jsx)(tn,(0,n.default)({path:p.Yc+"sys/groups/:groupID/libraries"},r)),(0,v.jsx)(an,(0,n.default)({path:p.Yc+"sys/groups/:groupID/members"},r)),(0,v.jsx)(kn,(0,n.default)({path:p.Yc+"sys/departments/"},r)),(0,v.jsx)(On,(0,n.default)({path:p.Yc+"sys/share-links"},r)),(0,v.jsx)(Rn,(0,n.default)({path:p.Yc+"sys/upload-links"},r)),(0,v.jsx)(Hn,(0,n.default)({path:p.Yc+"sys/organizations"},r)),(0,v.jsx)(Yn,(0,n.default)({path:p.Yc+"sys/search-organizations"},r)),(0,v.jsx)($n,(0,n.default)({path:p.Yc+"sys/organizations/:orgID/info"},r)),(0,v.jsx)(tr,(0,n.default)({path:p.Yc+"sys/organizations/:orgID/users"},r)),(0,v.jsx)(rr,(0,n.default)({path:p.Yc+"sys/organizations/:orgID/groups"},r)),(0,v.jsx)(or,(0,n.default)({path:p.Yc+"sys/organizations/:orgID/libraries"},r)),(0,v.jsx)(ur,(0,n.default)({path:p.Yc+"sys/institutions"},r)),(0,v.jsx)(mr,(0,n.default)({path:p.Yc+"sys/institutions/:institutionID/info"},r)),(0,v.jsx)(Ar,(0,n.default)({path:p.Yc+"sys/institutions/:institutionID/members"},r)),(0,v.jsx)(Sr,(0,n.default)({path:p.Yc+"sys/institutions/:institutionID/admins"},r)),(0,v.jsx)(Lr,(0,n.default)({path:p.Yc+"sys/logs/login"},r)),(0,v.jsx)(Fr,(0,n.default)({path:p.Yc+"sys/logs/file-access"},r)),(0,v.jsx)($r,(0,n.default)({path:p.Yc+"sys/logs/repo-transfer"},r)),(0,v.jsx)(ta,(0,n.default)({path:p.Yc+"sys/logs/group-member-audit"},r)),(0,v.jsx)(Hr,(0,n.default)({path:p.Yc+"sys/logs/file-update"},r)),(0,v.jsx)(Vr,(0,n.default)({path:p.Yc+"sys/logs/share-permission"},r)),(0,v.jsx)(ui,(0,n.default)({path:p.Yc+"sys/admin-logs/operation"},r)),(0,v.jsx)(pi,(0,n.default)({path:p.Yc+"sys/admin-logs/login"},r)),(0,v.jsx)(ct,(0,n.default)({path:p.Yc+"sys/users"},r)),(0,v.jsx)(ut,(0,n.default)({path:p.Yc+"sys/users/admins"},r)),(0,v.jsx)(gt,(0,n.default)({path:p.Yc+"sys/users/ldap-imported"},r)),(0,v.jsx)(xt,(0,n.default)({path:p.Yc+"sys/users/ldap"},r)),(0,v.jsx)(jt,(0,n.default)({path:p.Yc+"sys/search-users"},r)),(0,v.jsx)(Mt,(0,n.default)({path:p.Yc+"sys/users/:email"},r)),(0,v.jsx)(Tt,(0,n.default)({path:p.Yc+"sys/users/:email/owned-libraries"},r)),(0,v.jsx)(zt,(0,n.default)({path:p.Yc+"sys/users/:email/shared-libraries"},r)),(0,v.jsx)(Gt,(0,n.default)({path:p.Yc+"sys/users/:email/shared-links"},r)),(0,v.jsx)(Wt,(0,n.default)({path:p.Yc+"sys/users/:email/groups"},r)),(0,v.jsx)(Oa,(0,n.default)({path:p.Yc+"sys/invitations"},r)),(0,v.jsx)(Za,(0,n.default)({path:p.Yc+"sys/terms-and-conditions/"},r)),(0,v.jsx)(ri,(0,n.default)({path:p.Yc+"sys/virus-files/all"},r)),(0,v.jsx)(oi,(0,n.default)({path:p.Yc+"sys/virus-files/unhandled"},r)),(0,v.jsx)(pa,(0,n.default)({path:p.Yc+"sys/file-scan-records"},r)),(0,v.jsx)(Da,(0,n.default)({path:p.Yc+"sys/work-weixin"},r)),(0,v.jsx)(Ma,(0,n.default)({path:p.Yc+"sys/dingtalk"},r)),(0,v.jsx)(mi,(0,n.default)({path:p.Yc+"sys/abuse-reports"},r))]})}),(0,v.jsx)(d.Ay,{query:"(max-width: 767.8px)",children:(0,v.jsx)(u.A,{zIndex:"1030",isOpen:!s,toggle:this.toggleSidePanel,contentClassName:"d-none"})})]})}}])}(l.Component));(0,c.createRoot)(document.getElementById("wrapper")).render((0,v.jsx)(g.I18nextProvider,{value:f.A,children:(0,v.jsx)(h.dP,{history:h.W7,children:(0,v.jsx)(fi,{})})}))},32043:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(51925),c=s(40326),d=s(44414),u=function(e){function t(){return(0,n.default)(this,t),(0,a.default)(this,t,arguments)}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){return(0,d.jsxs)("div",{className:"main-panel-north ".concat(this.props.children?"border-left-show":""),children:[(0,d.jsxs)("div",{className:"cur-view-toolbar",children:[(0,d.jsx)("span",{className:"sf2-icon-menu side-nav-toggle hidden-md-up d-md-none",title:(0,c.AP)("Side Nav Menu"),onClick:this.props.toggleSidePanel}),(0,d.jsx)("div",{className:"operation",children:this.props.children})]}),(0,d.jsxs)("div",{className:"common-toolbar",children:[this.props.search&&this.props.search,(0,d.jsx)(l.A,{isAdminPanel:!0})]})]})}}])}(o.Component);t.A=u},33320:function(e,t,s){var n=s(23029),r=s(92901),a=s(39874),i=s(85501),o=s(9950),l=s(44414),c=function(e){function t(e){var s;return(0,n.default)(this,t),(s=(0,a.default)(this,t,[e])).handleInputChange=function(e){s.setState({value:e.target.value})},s.handleKeyDown=function(e){"Enter"==e.key&&(e.preventDefault(),s.handleSubmit())},s.handleSubmit=function(){var e=s.state.value.trim();if(!e)return!1;s.props.submit(e)},s.state={value:""},s}return(0,i.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){return(0,l.jsxs)("div",{className:"input-icon",children:[(0,l.jsx)("i",{className:"d-flex input-icon-addon sf3-font sf3-font-search"}),(0,l.jsx)("input",{type:"text",className:"form-control search-input h-6 mr-1",style:{width:"17rem"},placeholder:this.props.placeholder,value:this.state.value,onChange:this.handleInputChange,onKeyDown:this.handleKeyDown,autoComplete:"off"})]})}}])}(o.Component);t.A=c},37696:function(){},2201:function(){},63864:function(){}},function(e){e.O(0,[4223],(function(){return t=79611,e(e.s=t);var t}));e.O()}]);