"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[9370],{17015:function(e,t,i){var a=i(60436),n=i(23029),s=i(92901),r=i(39874),o=i(85501),d=i(9950),l=i(1352),c=i(34322),h=i(65604),u=i(97011),f=i(40326),m=i(75511),p=i(9961),g=i(49403),v=i(72991),x=i(4159),y=i.n(x),j=i(57354),R=i(5495),k=i(69123),w=i(65276),_=i(34940),I=i(44414);y().locale(window.app.config.lang);var C=function(e){function t(e){var i;return(0,n.default)(this,t),(i=(0,r.default)(this,t,[e])).onMouseEnter=function(){i.setState({active:!0})},i.onMouseLeave=function(){i.setState({active:!1})},i.onItemRestore=function(e){e.preventDefault(),i.props.onItemRestore(i.props.item)},i.state={active:!1},i}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props.item,t=j.A.getUrl({type:"download_historic_file",filePath:f.s$t,objID:e.rev_file_id}),i="".concat(f.YcY,"profile/").concat(encodeURIComponent(e.creator_email),"/"),a="".concat(f.YcY,"repo/").concat(f.IId,"/history/files/?obj_id=").concat(e.rev_file_id,"&commit_id=").concat(e.commit_id,"&p=").concat(h.Aq.encodePath(f.s$t)),n="".concat(f.YcY,"repo/text_diff/").concat(f.IId,"/?commit=").concat(e.commit_id,"&p=").concat(h.Aq.encodePath(f.s$t)),s="".concat(f.YcY,"repo/").concat(f.IId,"/snapshot/?commit_id=").concat(e.commit_id);return(0,I.jsx)(d.Fragment,{children:(0,I.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,className:this.state.active?"tr-highlight":"",children:[(0,I.jsxs)("td",{children:[(0,I.jsx)("span",{children:y()(e.ctime).format("YYYY-MM-DD HH:mm:ss")}),0===this.props.index&&(0,I.jsx)("span",{className:"ml-1",children:(0,f.APU)("(current version)")})]}),(0,I.jsxs)("td",{children:[(0,I.jsx)("img",{className:"avatar",src:e.creator_avatar_url,alt:""})," ",(0,I.jsx)("a",{href:i,target:"_blank",className:"username",rel:"noreferrer",children:e.creator_name})]}),(0,I.jsx)("td",{children:h.Aq.bytesToSize(e.size)}),(0,I.jsx)("td",{children:this.state.active&&(0,I.jsx)(F,{index:this.props.index,downloadUrl:t,viewUrl:a,diffUrl:n,snapshotURL:s,onItemRestore:this.onItemRestore,canDownload:this.props.canDownload,canCompare:this.props.canCompare})})]})})}}])}(d.Component),F=function(e){function t(e){var i;return(0,n.default)(this,t),(i=(0,r.default)(this,t,[e])).dropdownToggle=function(){i.setState({dropdownOpen:!i.state.dropdownOpen})},i.state={dropdownOpen:!1},i}return(0,o.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props,t=e.index,i=e.downloadUrl,a=e.viewUrl,n=e.snapshotURL,s=e.onItemRestore,r=e.canDownload;return(0,I.jsxs)(R.A,{isOpen:this.state.dropdownOpen,toggle:this.dropdownToggle,direction:"down",className:"mx-1 old-history-more-operation",children:[(0,I.jsx)(k.A,{tag:"i",className:"sf3-font sf3-font-more op-icon",title:(0,f.APU)("More operations"),"aria-label":(0,f.APU)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.dropdownOpen}),(0,I.jsxs)(w.A,{className:"drop-list",children:[0!==t&&(0,I.jsx)("a",{href:"#",onClick:s,children:(0,I.jsx)(_.A,{children:(0,f.APU)("Restore")})}),r&&(0,I.jsx)("a",{href:i,children:(0,I.jsx)(_.A,{children:(0,f.APU)("Download")})}),(0,I.jsx)("a",{href:a,children:(0,I.jsx)(_.A,{children:(0,f.APU)("View")})}),0!=t&&(0,I.jsx)(_.A,{tag:"a",href:n,target:"_blank",children:(0,f.APU)("View Related Snapshot")})]})]})}}])}(d.PureComponent),A=C,L=(i(16322),i(18291),i(81848),function(e){function t(e){var i;return(0,n.default)(this,t),(i=(0,r.default)(this,t,[e])).listNewHistoryRecords=function(e,t){m.A.listFileHistoryRecords(e,1,t).then((function(e){if(!e.data)throw i.setState({isLoading:!1}),Error("There is an error in server.");i.initNewRecords(e.data)}))},i.listOldHistoryRecords=function(e,t){u.e.listOldFileHistoryRecords(e,t).then((function(e){if(!e.data)throw i.setState({isLoading:!1}),Error("There is an error in server.");i.initOldRecords(e.data)}))},i.onScrollHandler=function(e){var t=e.target.clientHeight,a=e.target.scrollHeight,n=t+e.target.scrollTop+1>=a,s=i.state.hasMore;n&&s&&i.reloadMore()},i.reloadMore=function(){if(!i.state.isReloadingData)if(f.EUo){var e=i.state.currentPage+1;i.setState({currentPage:e,isReloadingData:!0}),m.A.listFileHistoryRecords(f.s$t,e,f.EKj).then((function(e){i.updateNewRecords(e.data)}))}else{var t=i.state.nextCommit,a=i.state.filePath,n=i.state.oldFilePath;i.setState({isReloadingData:!0}),n?u.e.listOldFileHistoryRecords(f.IId,n,t).then((function(e){i.updateOldRecords(e.data,n)})):u.e.listOldFileHistoryRecords(f.IId,a,t).then((function(e){i.updateOldRecords(e.data,a)}))}},i.onItemRestore=function(e){var t=e.commit_id,a=e.path;m.A.revertFile(a,t).then((function(e){e.data.success&&(i.setState({isLoading:!0}),i.refreshFileList())}))},i.onSearchedClick=function(e){h.Aq.handleSearchedItemClick(e)},i.goBack=function(e){e.preventDefault(),window.history.back()},i.state={historyList:[],currentPage:1,hasMore:!1,nextCommit:void 0,filePath:"",oldFilePath:"",isLoading:!0,isReloadingData:!1},i}return(0,o.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){f.EUo?this.listNewHistoryRecords(f.s$t,f.EKj):this.listOldHistoryRecords(f.IId,f.s$t)}},{key:"initNewRecords",value:function(e){var t=this;if(e.total_count<5)if(e.data.length){var i=e.data[e.data.length-1].commit_id,a=e.data[e.data.length-1].path,n=e.data[e.data.length-1].old_path;a=n||a,u.e.listOldFileHistoryRecords(f.IId,a,i).then((function(i){if(!i.data)throw t.setState({isLoading:!1}),Error("There is an error in server.");t.setState({historyList:e.data.concat(i.data.data.slice(1,i.data.data.length)),isLoading:!1})}))}else u.e.listOldFileHistoryRecords(f.IId,f.s$t).then((function(e){if(!e.data)throw t.setState({isLoading:!1}),Error("There is an error in server.");t.setState({historyList:e.data.data,isLoading:!1})}));else this.setState({historyList:e.data,currentPage:e.page,hasMore:e.total_count>f.EKj*this.state.currentPage,isLoading:!1})}},{key:"initOldRecords",value:function(e){var t=this;e.data.length?this.setState({historyList:e.data,nextCommit:e.next_start_commit,filePath:e.data[e.data.length-1].path,oldFilePath:e.data[e.data.length-1].rev_renamed_old_path,isLoading:!1}):(this.setState({nextCommit:e.next_start_commit}),this.state.nextCommit?u.e.listOldFileHistoryRecords(f.IId,f.s$t,this.state.nextCommit).then((function(e){t.initOldRecords(e.data)})):this.setState({isLoading:!1}))}},{key:"updateNewRecords",value:function(e){this.setState({historyList:[].concat((0,a.default)(this.state.historyList),(0,a.default)(e.data)),currentPage:e.page,hasMore:e.total_count>f.EKj*this.state.currentPage,isReloadingData:!1})}},{key:"updateOldRecords",value:function(e,t){var i=this;e.data.length?this.setState({historyList:[].concat((0,a.default)(this.state.historyList),(0,a.default)(e.data)),nextCommit:e.next_start_commit,filePath:e.data[e.data.length-1].path,oldFilePath:e.data[e.data.length-1].rev_renamed_old_path,isReloadingData:!1}):(this.setState({nextCommit:e.next_start_commit}),this.state.nextCommit&&u.e.listOldFileHistoryRecords(f.IId,t,this.state.nextCommit).then((function(e){i.updateOldRecords(e.data,t)})))}},{key:"refreshFileList",value:function(){var e=this;f.EUo?m.A.listFileHistoryRecords(f.s$t,1,f.EKj).then((function(t){e.initNewRecords(t.data)})):u.e.listOldFileHistoryRecords(f.IId,f.s$t).then((function(t){e.initOldRecords(t.data)}))}},{key:"render",value:function(){var e=this;return(0,I.jsxs)(d.Fragment,{children:[(0,I.jsxs)("div",{id:"header",className:"old-history-header",children:[(0,I.jsx)(g.A,{showCloseSidePanelIcon:!1}),(0,I.jsx)(v.A,{onSearchedClick:this.onSearchedClick})]}),(0,I.jsx)("div",{id:"main",onScroll:this.onScrollHandler,children:(0,I.jsxs)("div",{className:"old-history-main",children:[(0,I.jsxs)(d.Fragment,{children:[(0,I.jsx)("a",{href:"#",className:"go-back",title:"Back",onClick:this.goBack,children:(0,I.jsx)("span",{className:"sf3-font sf3-font-down rotate-90 d-inline-block"})}),(0,I.jsxs)("h2",{children:[(0,I.jsx)("span",{className:"file-name",children:f.MdH})," ",(0,f.APU)("History Versions")]})]}),(0,I.jsxs)(d.Fragment,{children:[(0,I.jsxs)("table",{className:"commit-list",children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{width:"40%",children:(0,f.APU)("Time")}),(0,I.jsx)("th",{width:"30%",children:(0,f.APU)("Modifier")}),(0,I.jsx)("th",{width:"25%",children:(0,f.APU)("Size")}),(0,I.jsx)("th",{width:"5%"})]})}),!this.state.isLoading&&(0,I.jsx)("tbody",{children:this.state.historyList.map((function(t,i){return(0,I.jsx)(A,{item:t,index:i,canDownload:f.vXX,canCompare:f.QdL,onItemRestore:e.onItemRestore},i)}))})]}),(this.state.isReloadingData||this.state.isLoading)&&(0,I.jsx)(p.A,{}),this.state.nextCommit&&!this.state.isLoading&&!this.state.isReloadingData&&(0,I.jsx)(c.A,{className:"get-more-btn",onClick:this.reloadMore,children:(0,f.APU)("More")})]})]})})]})}}])}(d.Component));(0,l.createRoot)(document.getElementById("wrapper")).render((0,I.jsx)(L,{}))},75511:function(e,t,i){var a=i(23029),n=i(92901),s=i(40326),r=i(97011),o=new(function(){return(0,n.default)((function e(){(0,a.default)(this,e)}),[{key:"listRepoDir",value:function(){return r.e.listDir(s.GCj,"/",{recursive:!0}).then((function(e){return e.data.dirent_list.map((function(e){return{name:e.name,type:"dir"===e.type?"dir":"file",isExpanded:"dir"===e.type,parent_path:e.parent_dir,last_update_time:e.mtime,permission:e.permission,size:e.size}}))}))}},{key:"deleteFile",value:function(e){return r.e.deleteFile(s.GCj,e)}},{key:"renameFile",value:function(e,t){return r.e.renameFile(s.GCj,e,t)}},{key:"createDir",value:function(e){return r.e.createDir(s.GCj,e)}},{key:"deleteDir",value:function(e){return r.e.deleteDir(s.GCj,e)}},{key:"renameDir",value:function(e,t){return r.e.renameDir(s.GCj,e,t)}},{key:"getWikiFileContent",value:function(e,t){return r.e.getWikiFileContent(e,t)}},{key:"getSource",value:function(){return r.e.getSource()}},{key:"searchFiles",value:function(e,t){return r.e.searchFiles(e,t)}},{key:"getAccountInfo",value:function(){return r.e.getAccountInfo()}},{key:"getFileDownloadLink",value:function(e){return r.e.getFileDownloadLink(s.IId,e)}},{key:"getFileContent",value:function(e){return r.e.getFileContent(e)}},{key:"listFileHistoryRecords",value:function(e,t,i){return r.e.listFileHistoryRecords(s.IId,e,t,i)}},{key:"revertFile",value:function(e,t){return r.e.revertFile(s.IId,e,t)}},{key:"zipDownload",value:function(e,t){return r.e.zipDownload(s.GCj,e,t)}},{key:"queryZipProgress",value:function(e){return r.e.queryZipProgress(e)}},{key:"cancelZipTask",value:function(e){return r.e.cancelZipTask(e)}}])}());t.A=o}},function(e){e.O(0,[4223],(function(){return t=17015,e(e.s=t);var t}));e.O()}]);