"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[7866],{88002:function(e,t,n){n.d(t,{A:function(){return f}});var a=n(23029),i=n(92901),s=n(39874),o=n(85501),r=n(9950),l=n(8081),d=n(10877),c=n(40326),p=n(20338),h=n(44414),u=function(e){function t(){return(0,a.A)(this,t),(0,s.A)(this,t,arguments)}return(0,o.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.asyncOperationProgress,a=e.asyncOperatedFilesLength,i="move"===t?(0,c.AP)("Move {num} items"):(0,c.AP)("Copy {num} items");i=i.replace("{num}",a);var s={width:n+"%",lineHeight:"40px",textAlign:"left"};return(0,h.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggleDialog,className:"copy-move-dirent-progress-dialog",children:[(0,h.jsx)(p.A,{toggle:this.props.toggleDialog,children:i}),(0,h.jsx)(d.A,{children:(0,h.jsx)("div",{className:"progress",children:(0,h.jsx)("div",{className:"progress-bar pl-2",role:"progressbar",style:s,"aria-valuenow":n,"aria-valuemin":"0","aria-valuemax":"100",children:n+"%"})})})]})}}])}(r.Component),f=u},2949:function(e,t,n){n.d(t,{Tb:function(){return a},W1:function(){return o},Ys:function(){return s},nj:function(){return i}});var a="list",i="grid",s="metadata",o="tags"},93355:function(e,t,n){n.d(t,{A:function(){return P}});var a=n(23029),i=n(92901),s=n(39874),o=n(85501),r=n(9950),l=n(40866),d=n(8081),c=n(10877),p=n(6754),h=n(34322),u=n(4159),f=n.n(u),m=n(40326),g=n(97011),v=n(65604),x=n(4086),j=n(20338),A=n(44414),b=function(e){function t(e){var n;return(0,a.A)(this,t),(n=(0,s.A)(this,t,[e])).onFileTagChanged=function(e){var t=e.parent_path,a={name:e.filename},i="/"===t?t+e.filename:t+"/"+e.filename;n.props.onFileTagChanged(a,i)},n.onDeleteTaggedFile=function(e){var t=n.props.repoID,a=e.file_tag_id;g.e.deleteFileTag(t,a).then((function(t){n.getTaggedFiles(),n.props.updateUsedRepoTags(),n.props.onFileTagChanged&&!e.file_deleted&&n.onFileTagChanged(e)})).catch((function(e){var t=v.Aq.getErrorMsg(e);x.A.danger(t)}))},n.getTaggedFiles=function(){var e=n.props,t=e.repoID,a=e.currentTag,i=e.shareLinkToken;(i?g.e.getShareLinkTaggedFiles(i,a.id):g.e.listTaggedFiles(t,a.id)).then((function(e){var t=[];void 0!==e.data.tagged_files&&e.data.tagged_files.forEach((function(e){var n=e;t.push(n)})),n.setState({taggedFileList:t})})).catch((function(e){var t=v.Aq.getErrorMsg(e);x.A.danger(t)}))},n.state={taggedFileList:[]},n}return(0,o.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){this.getTaggedFiles()}},{key:"render",value:function(){var e=this,t=this.state.taggedFileList;return(0,A.jsxs)(d.A,{isOpen:!0,style:{maxWidth:"678px"},children:[(0,A.jsx)(j.A,{toggle:this.props.onClose,children:(0,m.AP)("Tagged Files")}),(0,A.jsx)(c.A,{className:"dialog-list-container",children:(0,A.jsxs)("table",{children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{width:"50%",className:"ellipsis",children:(0,m.AP)("Name")}),(0,A.jsx)("th",{width:"20%",children:(0,m.AP)("Size")}),(0,A.jsx)("th",{width:"22%",children:(0,m.AP)("Last Update")}),(0,A.jsx)("th",{width:"8%"})]})}),(0,A.jsx)("tbody",{children:t.map((function(t,n){return(0,A.jsx)(N,{repoID:e.props.repoID,taggedFile:t,onDeleteTaggedFile:e.onDeleteTaggedFile,shareLinkToken:e.props.shareLinkToken,enableFileDownload:e.props.enableFileDownload},n)}))})]})}),(0,A.jsx)(p.A,{children:(0,A.jsx)(h.A,{color:"secondary",onClick:this.props.toggleCancel,children:(0,m.AP)("Close")})})]})}}])}(r.Component),N=function(e){function t(e){var n;return(0,a.A)(this,t),(n=(0,s.A)(this,t,[e])).onMouseEnter=function(){n.setState({active:!0})},n.onMouseLeave=function(){n.setState({active:!1})},n.deleteFile=function(e){e.preventDefault(),n.props.onDeleteTaggedFile(n.props.taggedFile)},n.state={active:!1},n}return(0,o.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.taggedFile,n=e.shareLinkToken,a=e.enableFileDownload,i=t.parent_path?v.Aq.joinPath(t.parent_path,t.filename):"",s=n?m.Yc+"d/"+n+"/files/?p="+v.Aq.encodePath(i):m.Yc+"lib/"+this.props.repoID+"/file"+v.Aq.encodePath(i);return(0,A.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onMouseEnter,children:[t.file_deleted?(0,A.jsx)(r.Fragment,{children:(0,A.jsxs)("td",{colSpan:"3",className:"name",children:[t.filename," ",(0,A.jsx)("span",{style:{color:"red"},children:(0,m.AP)("deleted")})]})}):(0,A.jsxs)(r.Fragment,{children:[(0,A.jsx)("td",{children:(0,A.jsx)("a",{href:s,target:"_blank",className:"d-inline-block w-100 ellipsis",title:t.filename,rel:"noreferrer",children:t.filename})}),(0,A.jsx)("td",{children:v.Aq.bytesToSize(t.size)}),(0,A.jsx)("td",{children:f().unix(t.mtime).fromNow()})]}),(0,A.jsxs)("td",{children:[!n&&(0,A.jsx)("a",{href:"#",role:"button","aria-label":(0,m.AP)("Delete"),title:(0,m.AP)("Delete"),className:"action-icon sf2-icon-x3".concat(this.state.active?"":" invisible"),onClick:this.deleteFile}),n&&a&&(0,A.jsx)("a",{className:"action-icon sf2-icon-download".concat(this.state.active?"":" invisible"),href:"".concat(s,"&dl=1"),title:(0,m.AP)("Download"),"aria-label":(0,m.AP)("Download")})]})]})}}])}(r.Component),y=n(75150),S=n(72249),k=n(3866),w=function(){var e=(0,y.n)().enableMetadata;return(0,A.jsx)("div",{className:"repo-info-bar-migrate mt-2",children:e?(0,A.jsxs)(A.Fragment,{children:[(0,m.AP)("Tips: There are tags of old version. Please migrate tags to new version."),(0,A.jsx)(h.A,{color:"link",size:"sm",tag:"a",onClick:function(){S.B.dispatch(k.T.OPEN_TREE_PANEL,(function(){return S.B.dispatch(k.T.OPEN_LIBRARY_SETTINGS_TAGS)}))},children:(0,m.AP)("Migrate")})]}):(0,A.jsx)(A.Fragment,{children:(0,m.AP)("Tips: These are tags of old version. The feature is deprecated and can no longer be used.")})})},P=function(e){function t(e){var n;return(0,a.A)(this,t),(n=(0,s.A)(this,t,[e])).onListTaggedFiles=function(e){n.setState({currentTag:e,isListTaggedFileShow:!n.state.isListTaggedFileShow})},n.onCloseDialog=function(){n.setState({isListTaggedFileShow:!1})},n.state={currentTag:null,isListTaggedFileShow:!1},n}return(0,o.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.repoID,a=t.usedRepoTags,i=t.className,s=t.shareLinkToken;return(0,A.jsxs)("div",{className:"repo-info-bar ".concat(i||""),children:[a.length>0&&(0,A.jsx)("ul",{className:"used-tag-list",children:a.map((function(t){return(0,A.jsxs)("li",{className:"used-tag-item",children:[(0,A.jsx)("span",{className:"used-tag",style:{backgroundColor:t.color}}),(0,A.jsx)("span",{className:"used-tag-name",title:t.name,children:t.name}),(0,A.jsx)("button",{type:"button",className:"used-tag-files border-0 bg-transparent",onClick:e.onListTaggedFiles.bind(e,t),children:t.fileCount>1?t.fileCount+" files":t.fileCount+" file"})]},t.id)}))}),this.state.isListTaggedFileShow&&(0,A.jsx)(l.A,{children:(0,A.jsx)(b,{repoID:n,currentTag:this.state.currentTag,onClose:this.onCloseDialog,toggleCancel:this.onListTaggedFiles,updateUsedRepoTags:this.props.updateUsedRepoTags,onFileTagChanged:this.props.onFileTagChanged,shareLinkToken:s,enableFileDownload:this.props.enableFileDownload})}),!s&&(0,A.jsx)(w,{})]})}}])}(r.Component)},72070:function(e,t,n){var a=n(89379),i=n(23029),s=n(92901),o=n(39874),r=n(85501),l=n(9950),d=n(5495),c=n(69123),p=n(65276),h=n(34940),u=n(40326),f=(n(55351),n(44414)),m=function(e){function t(e){var n;return(0,i.A)(this,t),(n=(0,o.A)(this,t,[e])).toggleDropdownMenu=function(){n.setState({isDropdownMenuOpen:!n.state.isDropdownMenuOpen})},n.sortOptions=n.props.sortOptions||[{value:"name-asc",text:(0,u.AP)("By name ascending")},{value:"name-desc",text:(0,u.AP)("By name descending")},{value:"size-asc",text:(0,u.AP)("By size ascending")},{value:"size-desc",text:(0,u.AP)("By size descending")},{value:"time-asc",text:(0,u.AP)("By time ascending")},{value:"time-desc",text:(0,u.AP)("By time descending")}],n.state={isDropdownMenuOpen:!1},n}return(0,r.A)(t,e),(0,s.A)(t,[{key:"render",value:function(){var e=this,t=this.state.isDropdownMenuOpen,n=this.props,i=n.sortBy,s=n.sortOrder,o=this.sortOptions.map((function(e){return(0,a.A)((0,a.A)({},e),{},{isSelected:e.value=="".concat(i,"-").concat(s)})}));return(0,f.jsxs)(d.A,{isOpen:t,toggle:this.toggleDropdownMenu,children:[(0,f.jsx)(c.A,{tag:"span","data-toggle":"dropdown",title:(0,u.AP)("Switch sort mode"),"aria-label":(0,u.AP)("Switch sort mode"),"aria-expanded":t,children:(0,f.jsxs)("span",{className:"cur-view-path-btn px-1",role:"button",children:[(0,f.jsx)("i",{className:"sf3-font-sort2 sf3-font"}),(0,f.jsx)("i",{className:"sf3-font-down sf3-font"})]})}),(0,f.jsx)(p.A,{className:"mt-1",children:o.map((function(t,n){return(0,f.jsxs)(h.A,{onClick:e.props.onSelectSortOption.bind(e,t),className:"pl-5 position-relative",children:[t.isSelected&&(0,f.jsx)("i",{className:"dropdown-item-tick sf2-icon-tick"}),t.text]},n)}))})]})}}])}(l.Component);t.A=m},75299:function(e,t,n){n.d(t,{A:function(){return g}});var a=n(23029),i=n(92901),s=n(39874),o=n(85501),r=n(9950),l=n(5495),d=n(69123),c=n(65276),p=n(34940),h=n(65604),u=n(40326),f=n(2949),m=n(44414),g=function(e){function t(e){var n;return(0,a.A)(this,t),(n=(0,s.A)(this,t,[e])).onKeyDown=function(e){(e.ctrlKey||e.metaKey)&&e.shiftKey&&(49===e.keyCode?n.props.switchViewMode(f.Tb):50===e.keyCode&&n.props.switchViewMode(f.nj))},n.toggleDropdownMenu=function(){n.setState({isDropdownMenuOpen:!n.state.isDropdownMenuOpen})},n.state={isDropdownMenuOpen:!1},n}return(0,o.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown)}},{key:"render",value:function(){var e=this,t=this.state.isDropdownMenuOpen,n=this.props.currentViewMode,a=h.Aq.isMac()?"\u21e7 \u2318":"Ctrl + Shift +",i=[{icon:"list-view",text:(0,u.AP)("List view"),value:f.Tb,shortcut:"".concat(a," 1")},{icon:"grid-view",text:(0,u.AP)("Grid view"),value:f.nj,shortcut:"".concat(a," 2")}];return(0,m.jsxs)(l.A,{isOpen:t,toggle:this.toggleDropdownMenu,id:"cur-view-change-mode-dropdown",children:[(0,m.jsx)(d.A,{tag:"span","data-toggle":"dropdown",title:(0,u.AP)("Switch view mode"),"aria-label":(0,u.AP)("Switch view mode"),"aria-expanded":t,children:(0,m.jsxs)("span",{className:"cur-view-path-btn px-1",children:[(0,m.jsx)("span",{className:"sf3-font sf3-font-".concat(n,"-view")}),(0,m.jsx)("span",{className:"sf3-font sf3-font-down"})]})}),(0,m.jsx)(c.A,{className:"mt-1",children:i.map((function(t,a){return(0,m.jsx)(p.A,{className:"p-0",onClick:e.props.switchViewMode.bind(e,t.value),children:(0,m.jsxs)("div",{className:"view-modes-dropdown-wrapper",children:[(0,m.jsx)("span",{className:"view-modes-dropdown-tick",children:n===t.value&&(0,m.jsx)("i",{className:"sf2-icon-tick"})}),(0,m.jsxs)("span",{className:"view-modes-dropdown-content",children:[(0,m.jsx)("span",{className:"sf3-font-".concat(t.icon," sf3-font mr-2")}),(0,m.jsx)("span",{children:t.text})]}),(0,m.jsx)("span",{className:"view-modes-dropdown-shortcut ml-4",children:t.shortcut})]})},a)}))})]})}}])}(r.Component)},54901:function(e,t,n){var a=n(90675),i=n(10467),s=n(5544),o=n(60436),r=n(23029),l=n(92901),d=n(39874),c=n(85501),p=n(9950),h=n(1352),u=n(5495),f=n(69123),m=n(65276),g=n(34940),v=n(4159),x=n.n(v),j=n(37609),A=n.n(j),b=n(51925),N=n(40326),y=n(65604),S=n(97011),k=n(9961),w=n(4086),P=n(40866),C=n(16670),F=n(24778),D=n(68238),I=n.n(D),M=n(72517),L=n.n(M),T=n(44414),_="uploading",U="error",O="isSaving",z="uploaded",E=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).onUploadCancel=function(e){e.preventDefault(),n.props.onUploadCancel(n.props.resumableFile)},n.onUploadRetry=function(e){e.preventDefault(),n.props.onUploadRetry(n.props.resumableFile)},n.formatFileSize=function(e){return"number"!==typeof e?"":e>=1e9?(e/1e9).toFixed(1)+" G":e>=1e6?(e/1e6).toFixed(1)+" M":e>=1e3?(e/1e3).toFixed(1)+" K":e.toFixed(1)+" B"},n.state={uploadState:_},n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.resumableFile,n=_;t.error?n=U:(0!==t.remainingTime||t.isSaved||(n=O),t.isSaved&&(n=z)),this.setState({uploadState:n})}},{key:"render",value:function(){var e=this.props.resumableFile,t=Math.round(100*e.progress()),n=e.error;return(0,T.jsxs)("tr",{className:"file-upload-item",children:[(0,T.jsx)("td",{className:"upload-name",children:(0,T.jsx)("div",{className:"ellipsis",children:e.newFileName})}),(0,T.jsx)("td",{children:(0,T.jsx)("span",{className:"file-size",children:this.formatFileSize(e.size)})}),(0,T.jsxs)("td",{className:"upload-progress",children:[(this.state.uploadState===_||this.state.uploadState===O)&&(0,T.jsxs)(p.Fragment,{children:[e.size>=1e8&&(0,T.jsxs)(p.Fragment,{children:[e.isUploading()&&(0,T.jsxs)("div",{className:"progress-container",children:[(0,T.jsx)("div",{className:"progress",children:(0,T.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})}),-1===e.remainingTime&&(0,T.jsx)("div",{className:"progress-text",children:(0,N.AP)("Preparing to upload...")}),e.remainingTime>0&&(0,T.jsxs)("div",{className:"progress-text",children:[(0,N.AP)("Remaining")," ",y.Aq.formatTime(e.remainingTime)]}),0===e.remainingTime&&(0,T.jsx)("div",{className:"progress-text",children:(0,N.AP)("Saving...")})]}),!e.isUploading()&&(0,T.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,T.jsx)("div",{className:"progress",children:(0,T.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),e.size<1e8&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,T.jsx)("div",{className:"progress",children:(0,T.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})}),this.state.uploadState===_&&(0,T.jsxs)(T.Fragment,{children:[0==t&&(0,T.jsx)("p",{className:"progress-text mb-0",children:(0,N.AP)("Waiting...")}),t>0&&(0,T.jsx)("p",{className:"progress-text mb-0",children:"".concat((0,N.AP)("Uploading...")," ").concat(t,"%")})]}),this.state.uploadState===O&&(0,T.jsx)("p",{className:"progress-text mb-0",children:(0,N.AP)("Saving...")})]})]}),this.state.uploadState===z&&(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)("span",{className:"upload-success-icon sf2-icon-tick mr-2"}),(0,T.jsx)("span",{className:"upload-success-msg",children:(0,N.AP)("Uploaded")})]}),this.state.uploadState===U&&(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)("span",{className:"upload-failure-icon sf3-font sf3-font-info mr-2"}),(0,T.jsx)("span",{className:"upload-failure-msg",dangerouslySetInnerHTML:{__html:n}})]})]}),(0,T.jsx)("td",{className:"upload-operation",children:(0,T.jsxs)(p.Fragment,{children:[this.state.uploadState===_&&(0,T.jsx)("a",{href:"#",onClick:this.onUploadCancel,role:"button",children:(0,N.AP)("Cancel")}),this.state.uploadState===U&&(0,T.jsx)("a",{href:"#",onClick:this.onUploadRetry,role:"button",children:(0,N.AP)("Retry")})]})})]})}}])}(p.Component),R=function(e){function t(){return(0,r.A)(this,t),(0,d.A)(this,t,arguments)}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){var e=this.props.file;return(0,T.jsxs)("tr",{className:"file-upload-item",children:[(0,T.jsx)("td",{className:"upload-name",children:(0,T.jsx)("div",{className:"ellipsis",title:e.name,children:e.name})}),(0,T.jsx)("td",{children:y.Aq.bytesToSize(e.size)}),(0,T.jsx)("td",{children:(0,T.jsxs)("div",{className:"d-flex align-items-center",children:[(0,T.jsx)("span",{className:"upload-failure-icon sf3-font sf3-font-info mr-2"}),(0,T.jsx)("span",{className:"upload-failure-msg",children:(0,N.AP)("File too large")})]})}),(0,T.jsx)("td",{})]})}}])}(p.Component),B=R,q=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).onCancelAllUploading=function(){n.props.onCancelAllUploading()},n.onMinimizeUpload=function(e){e.nativeEvent.stopImmediatePropagation(),n.setState({isMinimized:!n.state.isMinimized})},n.onCloseUpload=function(e){e.nativeEvent.stopImmediatePropagation(),n.props.onCloseUploadDialog()},n.state={isMinimized:!1},n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){var e,t=this,n=this.props,a=n.totalProgress,i=n.retryFileList,s=n.uploadBitrate,o=n.uploadFileList,r=n.forbidUploadFileList,l=n.isUploading,d=(0,N.AP)("{uploaded_files_num}/{all_files_num} Files").replace("{uploaded_files_num}",o.filter((function(e){return e.isSaved})).length).replace("{all_files_num}",o.length);if(!l){var c=o.filter((function(e){return e.error})).length+r.length;c>0&&(e=(0,N.AP)("{failed_files_num} file(s) failed to upload").replace("{failed_files_num}",c))}return(0,T.jsxs)("div",{className:"uploader-list-view mw-100",style:{height:this.state.isMinimized?document.querySelector(".uploader-list-header").offsetHeight:"20rem"},children:[(0,T.jsxs)("div",{className:"uploader-list-header flex-shrink-0",children:[(0,T.jsx)("div",{children:l?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("span",{children:(0,N.AP)("File Uploading...")}),(0,T.jsx)("span",{className:"ml-2",children:"".concat(a,"% (").concat(y.Aq.formatBitRate(s),")")}),(0,T.jsx)("div",{className:"progress",children:(0,T.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(a,"%")},"aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100"})})]}):(0,T.jsx)(T.Fragment,{children:e?(0,T.jsx)("p",{className:"m-0 error",children:e}):(0,T.jsx)("p",{className:"m-0",children:(0,N.AP)("All files uploaded")})})}),(0,T.jsxs)("div",{className:"upload-dialog-op-container",children:[(0,T.jsx)("span",{className:"sf2-icon-minus upload-dialog-op",onClick:this.onMinimizeUpload}),!l&&(0,T.jsx)("span",{className:"sf2-icon-x1 upload-dialog-op",onClick:this.onCloseUpload})]})]}),(0,T.jsxs)("div",{className:"uploader-list-content",children:[(0,T.jsxs)("div",{className:"d-flex justify-content-between align-items-center border-bottom uploader-content-bar",children:[o.length>0&&(0,T.jsx)("span",{children:d}),(0,T.jsxs)("div",{className:"ml-auto",children:[(0,T.jsx)("button",{className:"btn btn-lg border-0 background-transparent px-0",onClick:this.props.onUploadRetryAll,disabled:0==i.length,children:(0,N.AP)("Retry All")}),(0,T.jsx)("button",{className:"btn btn-lg border-0 background-transparent px-0 ml-3",onClick:this.props.onCancelAllUploading,disabled:!l,children:(0,N.AP)("Cancel All")})]})]}),(0,T.jsxs)("table",{className:"table-thead-hidden",children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{width:"40%",children:(0,N.AP)("name")}),(0,T.jsx)("th",{width:"15%",children:(0,N.AP)("size")}),(0,T.jsx)("th",{width:"30%",children:(0,N.AP)("progress")}),(0,T.jsx)("th",{width:"15%",children:(0,N.AP)("state")})]})}),(0,T.jsxs)("tbody",{children:[this.props.forbidUploadFileList.map((function(e,t){return(0,T.jsx)(B,{file:e},t)})),this.props.uploadFileList.map((function(e,n){return(0,T.jsx)(E,{resumableFile:e,onUploadCancel:t.props.onUploadCancel,onUploadRetry:t.props.onUploadRetry},n)}))]})]})]})]})}}])}(p.Component),H=(n(89183),function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).componentWillUnmount=function(){window.onbeforeunload=null,!0===n.props.dragAndDrop&&n.resumable.disableDropOnDocument()},n.onbeforeunload=function(){if(window.uploader&&window.uploader.isUploadProgressDialogShow&&100!==window.uploader.totalProgress)return""},n.bindCallbackHandler=function(){var e=n.props,t=e.minFileSizeErrorCallback,a=e.fileTypeErrorCallback;n.maxFilesErrorCallback&&(n.resumable.opts.maxFilesErrorCallback=n.maxFilesErrorCallback),t&&(n.resumable.opts.minFileSizeErrorCallback=n.props.minFileSizeErrorCallback),n.maxFileSizeErrorCallback&&(n.resumable.opts.maxFileSizeErrorCallback=n.maxFileSizeErrorCallback),a&&(n.resumable.opts.fileTypeErrorCallback=n.props.fileTypeErrorCallback)},n.bindEventHandler=function(){n.resumable.on("chunkingComplete",n.onChunkingComplete.bind(n)),n.resumable.on("fileAdded",n.onFileAdded.bind(n)),n.resumable.on("filesAddedComplete",n.filesAddedComplete.bind(n)),n.resumable.on("fileProgress",n.onFileProgress.bind(n)),n.resumable.on("fileSuccess",n.onFileUploadSuccess.bind(n)),n.resumable.on("progress",n.onProgress.bind(n)),n.resumable.on("complete",n.onComplete.bind(n)),n.resumable.on("pause",n.onPause.bind(n)),n.resumable.on("fileRetry",n.onFileRetry.bind(n)),n.resumable.on("fileError",n.onFileError.bind(n)),n.resumable.on("error",n.onError.bind(n)),n.resumable.on("beforeCancel",n.onBeforeCancel.bind(n)),n.resumable.on("cancel",n.onCancel.bind(n)),n.resumable.on("dragstart",n.onDragStart.bind(n))},n.maxFilesErrorCallback=function(e,t){var n=N.YX,a=(0,N.AP)("Please upload no more than {maxFiles} files at a time.");a=a.replace("{maxFiles}",n),w.A.danger(a)},n.maxFileSizeErrorCallback=function(e){var t=n.state.forbidUploadFileList;t.push(e),n.setState({forbidUploadFileList:t})},n.onChunkingComplete=function(e){var t="/"===n.props.path?"/":n.props.path+"/",a=e.fileName,i=e.relativePath,s=a===i;if(e.formData={},s)e.formData={parent_dir:t};else{var o=i.slice(0,i.lastIndexOf("/")+1);e.formData={parent_dir:t,relative_path:o}}},n.onFileAdded=function(e,t){if(e.fileName===e.relativePath&&1===t.length){n.setUploadFileList(n.resumable.files);var a=n.props,i=a.token,s=a.relativePath;S.e.sharedLinkGetFileUploadUrl(i,s).then((function(t){n.resumable.opts.target=t.data.upload_link+"?ret-json=1",n.resumableUpload(e)})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))}else if(n.setUploadFileList(n.resumable.files),!n.isUploadLinkLoaded){n.isUploadLinkLoaded=!0;var o=n.props,r=o.token,l=o.relativePath;S.e.sharedLinkGetFileUploadUrl(r,l).then((function(e){n.resumable.opts.target=e.data.upload_link+"?ret-json=1",n.resumable.upload()})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))}},n.resumableUpload=function(e){var t=n.props,a=t.repoID,i=t.path;S.e.getFileUploadedBytes(a,i,e.fileName).then((function(t){var a=t.data.uploadedBytes,i=1024*parseInt(N.QV)*1024||1048576,s=Math.floor(a/i);e.markChunksCompleted(s),n.resumable.upload()})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))},n.filesAddedComplete=function(e,t){n.state.forbidUploadFileList.length>0&&0===t.length&&n.setState({isUploadProgressDialogShow:!0,totalProgress:100})},n.setUploadFileList=function(){var e=n.resumable.files;n.setState({uploadFileList:e,isUploadProgressDialogShow:!0}),y.Aq.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)},n.onFileProgress=function(e){var t=n.getBitrate(),a=n.state.uploadFileList.map((function(n){if(n.uniqueIdentifier===e.uniqueIdentifier&&t){var a=8*(n.size-n.size*n.progress()),i=Math.floor(a/t);n.remainingTime=i}return n}));n.setState({uploadBitrate:t,uploadFileList:a})},n.getBitrate=function(){var e=0,t=0,a=(new Date).getTime();if(n.resumable.files.forEach((function(t){e+=t.progress()*t.size})),n.timestamp){var i=a-n.timestamp;if(i<n.bitrateInterval)return n.state.uploadBitrate;(e<n.loaded||0===n.loaded)&&(n.loaded=e),t=(e-n.loaded)*(1e3/i)*8}return n.timestamp=a,n.loaded=e,t},n.onProgress=function(){var e=Math.round(100*n.resumable.progress());n.setState({totalProgress:e}),y.Aq.registerGlobalVariable("uploader","totalProgress",e)},n.onFileUploadSuccess=function(e,t){var a=e.formData,i=(new Date).getTime()/1e3;t=a.replace?t:JSON.parse(t)[0],a.relative_path;var s={id:t.id,type:"file",name:t.name,size:t.size,mtime:i};n.props.onFileUploadSuccess(s);var o=n.state.uploadFileList.map((function(n){return n.uniqueIdentifier===e.uniqueIdentifier&&(n.newFileName=t.name,n.isSaved=!0),n}));n.setState({uploadFileList:o})},n.onFileError=function(e,t){var a="";if(t){var i=t.replace(/\n/g,"");i=JSON.parse(i),"File locked by others."===(a=i.error)&&(a=(0,N.AP)("File is locked by others.")),"Internal error."===a&&(a=(0,N.AP)("Internal Server Error"))}else a=(0,N.AP)("Network error");var s=n.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(n.state.retryFileList.push(t),t.error=a),t}));n.loaded=0,n.setState({retryFileList:n.state.retryFileList,uploadFileList:s})},n.onComplete=function(){n.notifiedFolders=[],n.isUploadLinkLoaded=!1},n.onPause=function(){},n.onError=function(e){n.isUploadLinkLoaded=!1,y.Aq.registerGlobalVariable("uploader","totalProgress",100)},n.onFileRetry=function(){},n.onBeforeCancel=function(){},n.onCancel=function(){},n.setHeaders=function(e,t){var n=t.offset,a=t.getOpt("chunkSize"),i=0===e.size?1:e.size,s=0!==n?n*a:0,o=Math.min(i,(n+1)*a)-1;return i-t.endByte<a&&!t.getOpt("forceChunkSize")&&(o=i),{Accept:"application/json; text/javascript, */*; q=0.01","Content-Disposition":'attachment; filename="'+encodeURI(e.fileName)+'"',"Content-Range":"bytes "+s+"-"+o+"/"+i}},n.setQuery=function(e){return e.formData},n.generateUniqueIdentifier=function(e){var t=e.webkitRelativePath||e.relativePath||e.fileName||e.name;return L()(t+new Date)+t},n.onClick=function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},n.onFileUpload=function(){n.uploadInput.current.removeAttribute("webkitdirectory"),n.uploadInput.current.click()},n.onFolderUpload=function(){n.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory"),n.uploadInput.current.click()},n.onDragStart=function(){n.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory")},n.onCloseUploadDialog=function(){n.loaded=0,n.resumable.files=[],n.isUploadLinkLoaded=!1,n.setState({isUploadProgressDialogShow:!1,uploadFileList:[],forbidUploadFileList:[]}),y.Aq.registerGlobalVariable("uploader","isUploadProgressDialogShow",!1)},n.onUploadCancel=function(e){var t=n.state.uploadFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier||(t.cancel(),!1)}));n.resumable.isUploading()||(n.setState({totalProgress:100}),n.loaded=0),n.setState({uploadFileList:t})},n.onCancelAllUploading=function(){var e=n.state.uploadFileList.filter((function(e){return!Math.round(1!==e.progress())||(e.cancel(),!1)}));n.loaded=0,n.setState({totalProgress:100,uploadFileList:e}),n.isUploadLinkLoaded=!1},n.onUploadRetry=function(e){var t=n.props,a=t.token,i=t.relativePath;S.e.sharedLinkGetFileUploadUrl(a,i).then((function(t){n.resumable.opts.target=t.data.upload_link+"?ret-json=1";var a=n.state.retryFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier})),i=n.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(t.error=null,n.retryUploadFile(t)),t}));n.setState({retryFileList:a,uploadFileList:i})})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))},n.onUploadRetryAll=function(){var e=n.props,t=e.token,a=e.relativePath;S.e.sharedLinkGetFileUploadUrl(t,a).then((function(e){n.resumable.opts.target=e.data.upload_link+"?ret-json=1",n.state.retryFileList.forEach((function(e){e.error=!1,n.retryUploadFile(e)}));var t=n.state.uploadFileList.slice(0);n.setState({retryFileList:[],uploadFileList:t})})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))},n.retryUploadFile=function(e){var t=n.props,a=t.repoID,i=t.path,s=e.fileName;if(!(e.fileName===e.relativePath)){var o=e.formData.relative_path;s=("/"===i?i+o:i+"/"+o)+s}e.bootstrap();var r=!1;e.resumableObj.on("chunkingComplete",(function(){r||S.e.getFileUploadedBytes(a,i,s).then((function(t){var n=t.data.uploadedBytes,a=1024*parseInt(N.QV)*1024||1048576,i=Math.floor(n/a);e.markChunksCompleted(i),e.resumableObj.upload()})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)})),r=!0}))},n.uploadFile=function(){var e=n.resumable.files[n.resumable.files.length-1],t=n.props,a=t.token,i=t.relativePath;S.e.sharedLinkGetFileUploadUrl(a,i).then((function(t){n.resumable.opts.target=t.data.upload_link+"?ret-json=1",n.setState({isUploadRemindDialogShow:!1,isUploadProgressDialogShow:!0,uploadFileList:[].concat((0,o.A)(n.state.uploadFileList),[e])},(function(){n.resumable.upload()})),y.Aq.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))},n.cancelFileUpload=function(){n.resumable.files.pop(),n.setState({isUploadRemindDialogShow:!1})},n.state={retryFileList:[],uploadFileList:[],forbidUploadFileList:[],totalProgress:0,isUploadProgressDialogShow:!1,isUploadRemindDialogShow:!1,currentResumableFile:null,uploadBitrate:0},n.uploadInput=p.createRef(),n.notifiedFolders=[],n.timestamp=null,n.loaded=0,n.bitrateInterval=500,window.onbeforeunload=n.onbeforeunload,n.isUploadLinkLoaded=!1,n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"componentDidMount",value:function(){this.resumable=new(I())({target:"",query:this.setQuery||{},fileType:this.props.filetypes,maxFiles:N.YX||void 0,maxFileSize:1e3*N.hn*1e3||void 0,testMethod:this.props.testMethod||"post",testChunks:this.props.testChunks||!1,headers:this.setHeaders||{},withCredentials:this.props.withCredentials||!1,chunkSize:1024*parseInt(N.QV)*1024||1048576,simultaneousUploads:this.props.simultaneousUploads||1,fileParameterName:this.props.fileParameterName,generateUniqueIdentifier:this.generateUniqueIdentifier,forceChunkSize:!0,maxChunkRetries:3,minFileSize:0}),this.resumable.assignBrowse(this.uploadInput.current,!0),!0===this.props.dragAndDrop&&this.resumable.enableDropOnDocument(),this.bindCallbackHandler(),this.bindEventHandler()}},{key:"render",value:function(){return(0,T.jsxs)(p.Fragment,{children:[(0,T.jsx)("div",{className:"file-uploader-container",children:(0,T.jsx)("div",{className:"file-uploader",children:(0,T.jsx)("input",{className:"upload-input",type:"file",ref:this.uploadInput,onClick:this.onClick,"aria-label":(0,N.AP)("Upload")})})}),this.state.isUploadProgressDialogShow&&(0,T.jsx)(q,{retryFileList:this.state.retryFileList,uploadFileList:this.state.uploadFileList,forbidUploadFileList:this.state.forbidUploadFileList,totalProgress:this.state.totalProgress,uploadBitrate:this.state.uploadBitrate,onCloseUploadDialog:this.onCloseUploadDialog,onCancelAllUploading:this.onCancelAllUploading,onUploadCancel:this.onUploadCancel,onUploadRetry:this.onUploadRetry,onUploadRetryAll:this.onUploadRetryAll,isUploading:this.resumable.isUploading()})]})}}])}(p.Component)),Y=H,V=n(8081),G=n(10877),K=n(46882),J=n(6754),Z=n(34322),W=n(22695),Q=n(20338),X=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).onSaveSharedFile=function(){n.props.handleSaveSharedDir(n.state.repo.repo_id,n.state.selectedPath)},n.onDirentItemClick=function(e,t,a){"dir"===a.type?n.setState({repo:e,selectedPath:t}):n.setState({repo:null,selectedPath:""})},n.onRepoItemClick=function(e){n.setState({repo:e,selectedPath:"/"})},n.state={repo:null,selectedPath:"",errMessage:""},n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){return(0,T.jsxs)(V.A,{isOpen:!0,className:"sf-save-file",toggle:this.props.toggleCancel,children:[(0,T.jsx)(Q.A,{toggle:this.props.toggleCancel,children:(0,N.AP)("Save to:")}),(0,T.jsxs)(G.A,{children:[(0,T.jsx)(W.A,{isShowFile:!1,onDirentItemClick:this.onDirentItemClick,onRepoItemClick:this.onRepoItemClick,mode:"only_all_repos"}),this.state.errMessage&&(0,T.jsx)(K.A,{color:"danger",children:this.state.errMessage})]}),(0,T.jsxs)(J.A,{children:[(0,T.jsx)(Z.A,{color:"secondary",onClick:this.props.toggleCancel,children:(0,N.AP)("Cancel")}),this.state.selectedPath?(0,T.jsx)(Z.A,{color:"primary",onClick:this.onSaveSharedFile,children:(0,N.AP)("Submit")}):(0,T.jsx)(Z.A,{color:"primary",disabled:!0,children:(0,N.AP)("Submit")})]})]})}}])}(p.Component),$=n(88002),ee=n(93355),te=n(25531),ne=n(2949),ae=n(86040),ie=n(75299),se=n(72070),oe=function(){function e(t){t.path;var n=t.object,a=t.isLoaded,i=t.isPreload,s=t.isExpanded,o=t.parentNode;(0,r.A)(this,e),this.path=n.folder_path,this.object=n,this.isLoaded=a||!1,this.isPreload=i||!1,this.isExpanded=s||!1,this.children=[],this.parentNode=o||null}return(0,l.A)(e,[{key:"clone",value:function(t){var n=new e({path:this.path,object:this.object,isLoaded:this.isLoaded,isPreload:this.isPreload,isExpanded:this.isExpanded,parentNode:t||null});return n.children=this.children.map((function(e){return e.clone(n)})),n}},{key:"setParent",value:function(e){this.path=this.generatePath(e),this.parentNode=e,this.isLoaded=!1}},{key:"hasChildren",value:function(){return 0!==this.children.length}},{key:"addChild",value:function(e){e.setParent(this);var t=this.children;if(e.object.isDir())this.children.unshift(e);else{for(var n=-1,a=0;a<t.length;a++)if(!t[a].object.isDir()){n=a;break}-1===n?this.children.push(e):0===n?this.children.unshift(e):this.children.splice(n,0,e)}}},{key:"addChildren",value:function(e){var t=this;e.forEach((function(e){e.setParent(t)})),this.children=e}},{key:"deleteChild",value:function(e){var t=this.children.filter((function(t){return t!==e}));this.children=t}},{key:"rename",value:function(e){this.object.name=e,this.path=this.generatePath(this.parentNode),this.isExpanded?this.updateChildrenPath(this):this.isLoaded=!1}},{key:"updateChildrenPath",value:function(e){e.children.forEach((function(e){e.path=e.generatePath(e.parentNode),e.isExpanded?e.updateChildrenPath(e):e.isLoaded=!1}))}},{key:"updateObjectProperties",value:function(e,t){var n=this;Array.isArray(e)&&Array.isArray(t)?e.forEach((function(e,a){n.object[e]=t[a]})):this.object[e]=t}},{key:"generatePath",value:function(e){return this.path}},{key:"serializeToJson",value:function(){var e=[];return this.hasChildren&&(e=this.children.map((function(e){return e.serializeToJson()}))),{path:this.path,object:this.object.clone(),isLoaded:this.isLoaded,isPreload:this.isPreload,isExpanded:this.isExpanded,parentNode:this.parentNode,children:e}}}],[{key:"deserializefromJson",value:function(t){var n=t.path,a=t.object,i=t.isLoaded,s=t.isPreload,o=t.isExpanded,r=t.parentNode,l=t.children,d=void 0===l?[]:l;return new e({path:n,object:a=a.clone(),isLoaded:i,isPreload:s,isExpanded:o,parentNode:r,children:d.map((function(t){return e.deserializefromJson(t)}))})}}])}(),re=function(){function e(){(0,r.A)(this,e),this.root=null}return(0,l.A)(e,[{key:"clone",value:function(){var t=new e;return this.root&&(t.root=this.root.clone()),t}},{key:"setRoot",value:function(e){this.root=e}},{key:"getNodeByPath",value:function(e){var t=null;return this.traverseDF((function(n){return n.path===e&&(t=n,!0)})),t}},{key:"getNodeChildrenObject",value:function(e){return e.children.map((function(e){return e.object}))}},{key:"addNodeToParent",value:function(e,t){t.addChild(e)}},{key:"addNodeListToParent",value:function(e,t){e.forEach((function(e){t.addChild(e)}))}},{key:"deleteNode",value:function(e){this.getNodeByPath(e.parentNode.path).deleteChild(e)}},{key:"deleteNodeList",value:function(e){var t=this;e.forEach((function(e){t.deleteNode(e)}))}},{key:"renameNode",value:function(e,t){e.rename(t)}},{key:"updateNode",value:function(e,t,n){e.updateObjectProperties(t,n)}},{key:"moveNode",value:function(e,t){this.deleteNode(e),t.addChild(e)}},{key:"copyNode",value:function(e,t){t.addChild(e)}},{key:"traverseDF",value:function(e){var t=[],n=!1;t.unshift(this.root);for(var a=t.shift();!n&&a;)(n=1==e(a))||(t.unshift.apply(t,(0,o.A)(a.children)),a=t.shift())}},{key:"traverseBF",value:function(e){var t=[],n=!1;t.push(this.root);for(var a=t.shift();!n&&a;)(n=!0===e(a))||(t.push.apply(t,(0,o.A)(a.children)),a=t.shift())}},{key:"expandNode",value:function(e){for(e.isExpanded=!0;e.parentNode;)e.parentNode.isExpanded=!0,e=e.parentNode}},{key:"collapseNode",value:function(e){e.isExpanded=!1}},{key:"isNodeChild",value:function(e,t){return t.children.some((function(t){return t.path===e.path}))}},{key:"serializeToJson",value:function(){return this.root.serializeToJson()}},{key:"deserializefromJson",value:function(t){var n=oe.deserializefromJson(t),a=new e;return a.setRoot(n),a}}])}(),le=re,de=function(){return(0,l.A)((function e(){(0,r.A)(this,e)}),[{key:"expandNode",value:function(e,t){e.expandNode(t)}},{key:"collapseNode",value:function(e,t){var n=e.clone();return t=n.getNodeByPath(t.path),n.collapseNode(t),n}},{key:"findNodeByPath",value:function(e,t){return e.clone().getNodeByPath(t)}},{key:"getNodeChildrenObject",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"asc",i=e.getNodeChildrenObject(t);return i=y.Aq.sortDirents(i,n,a)}},{key:"addNodeToParent",value:function(e,t,n){return e.addNodeToParentNode(t,n),e}},{key:"addNodeListToParent",value:function(e,t,n){return e.addNodeListToParent(t,n),e}},{key:"addNodeToParentByPath",value:function(e,t,n){var a=e.clone(),i=a.getNodeByPath(n);return a.addNodeToParent(t,i),a}},{key:"deleteNodeByPath",value:function(e,t){var n=e.clone(),a=n.getNodeByPath(t);return a&&n.deleteNode(a),n}},{key:"deleteNodeListByPaths",value:function(e,t){var n=e.clone();return t.forEach((function(e){var t=n.getNodeByPath(e);t&&n.deleteNode(t)})),n}},{key:"renameNodeByPath",value:function(e,t,n){var a=e.clone(),i=a.getNodeByPath(t);return i?(a.renameNode(i,n),a):a}},{key:"updateNodeByPath",value:function(e,t,n,a){var i=e.clone(),s=i.getNodeByPath(t);return i.updateNode(s,n,a),i}},{key:"moveNodeByPath",value:function(e,t,n,a){var i=e.clone(),s=i.getNodeByPath(t),o=i.getNodeByPath(n);return o&&s&&(s.object.name=a,i.moveNode(s,o)),!o&&s&&i.deleteNode(s),i}},{key:"moveNodeListByPaths",value:function(e,t,n){var a=e.clone(),i=a.getNodeByPath(n);return i?t.forEach((function(e){var t=a.getNodeByPath(e);a.moveNode(t,i)})):t.forEach((function(e){var t=a.getNodeByPath(e);a.delete(t)})),a}},{key:"copyNodeByPath",value:function(e,t,n,a){var i=e.clone(),s=i.getNodeByPath(n),o=i.getNodeByPath(t);if(s){var r=o.clone();r.object.name=a,i.copyNode(r,s)}return i}},{key:"copyNodeListByPaths",value:function(e,t,n){var a=e.clone(),i=a.getNodeByPath(n);return i&&t.forEach((function(e){var t=a.getNodeByPath(e);a.copyNode(t,i)})),a}},{key:"buildTree",value:function(){var e=new le,t=new oe({object:{folder_path:"/",is_dir:!0},isLoaded:!1,isExpanded:!0});return e.setRoot(t),e}}])}(),ce=new de,pe=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).onMouseEnter=function(){n.setState({isHighlight:!0})},n.onMouseOver=function(){n.setState({isHighlight:!0})},n.onMouseLeave=function(){n.setState({isHighlight:!1})},n.onNodeClick=function(){var e=n.props.node;n.props.onNodeClick(e)},n.onLoadToggle=function(e){e.stopPropagation();var t=n.props.node;t.isExpanded?n.props.onNodeCollapse(t):n.props.onNodeExpanded(t)},n.getNodeTypeAndIcon=function(){var e=n.props.node,t="",a="";if(e.object.is_dir)t=(0,T.jsx)("i",{className:"sf3-font sf3-font-folder"}),a="dir";else{var i=e.object.file_name.lastIndexOf(".");if(-1===i)t=(0,T.jsx)("i",{className:"sf3-font sf3-font-file"}),a="file";else{var s=e.object.file_name.slice(i).toLowerCase();".png"===s||".jpg"===s||".jpeg"===s||".gif"===s||".bmp"===s?(t=(0,T.jsx)("i",{className:"sf3-font sf3-font-image"}),a="image"):".md"===s||".markdown"===s?(t=(0,T.jsx)("i",{className:"sf3-font sf3-font-files2"}),a="file"):(t=(0,T.jsx)("i",{className:"sf3-font sf3-font-file"}),a="file")}}return{icon:t,type:a}},n.renderChildren=function(){var e=n.props.node;return e.hasChildren()?(0,T.jsx)("div",{className:"children",children:e.children.map((function(e,a){return(0,T.jsx)(t,{node:e,leftIndent:n.props.leftIndent+20,currentPath:n.props.currentPath,onNodeClick:n.props.onNodeClick,onNodeCollapse:n.props.onNodeCollapse,onNodeExpanded:n.props.onNodeExpanded},a)}))}):""},n.state={isHighlight:!1},n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){var e=this.props,t=e.currentPath,n=e.node,a=e.leftIndent,i=this.getNodeTypeAndIcon(),s=i.type,o=i.icon,r=this.state.isHighlight?"tree-node-inner-hover":"";n.path===t&&(r="tree-node-hight-light");var l=n.object.folder_name||n.object.file_name;return(0,T.jsxs)("div",{className:"tree-node",children:[(0,T.jsxs)("div",{type:s,className:"tree-node-inner text-nowrap ".concat(r," ").concat("/"===n.path?"hide":""),title:l,onMouseEnter:this.onMouseEnter,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,onClick:this.onNodeClick,children:[(0,T.jsx)("div",{className:"tree-node-text",style:{paddingLeft:a+5},children:l}),(0,T.jsxs)("div",{className:"left-icon",style:{left:a-40},children:["dir"===s&&(!n.isLoaded||n.isLoaded&&n.hasChildren())&&(0,T.jsx)("i",{className:"folder-toggle-icon sf3-font sf3-font-down ".concat(n.isExpanded?"":"rotate-270"),onMouseDown:function(e){return e.stopPropagation()},onClick:this.onLoadToggle}),(0,T.jsx)("i",{className:"tree-node-icon",children:o})]})]}),n.isExpanded&&this.renderChildren()]})}}])}(p.Component),he=function(e){function t(){return(0,r.A)(this,t),(0,d.A)(this,t,arguments)}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){return(0,T.jsx)("div",{className:"tree-view tree",children:(0,T.jsx)(pe,{leftIndent:20,node:this.props.treeData.root,currentPath:this.props.currentPath,onNodeClick:this.props.onNodeClick,onNodeExpanded:this.props.onNodeExpanded,onNodeCollapse:this.props.onNodeCollapse})})}}])}(p.Component),ue=he,fe=n(91447),me=n(47842),ge=n(14522);n(16322),n(75243),n(47100);x().locale(window.app.config.lang),x().extend(A());var ve=window.app.pageOptions.name,xe=window.shared.pageOptions,je=xe.token,Ae=xe.dirName,be=xe.dirPath,Ne=xe.sharedBy,ye=xe.repoID,Se=xe.relativePath,ke=xe.mode,we=xe.thumbnailSize,Pe=xe.trafficOverLimit,Ce=xe.canDownload,Fe=xe.noQuota,De=xe.canUpload,Ie=xe.enableVideoThumbnail,Me=xe.enablePDFThumbnail,Le=!Pe&&Ce,Te=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).loadTreePanel=function(){S.e.listSharedDir(je,"/",we).then((function(e){var t=e.data.dirent_list,a=n.state.treeData;n.addResponseListToNode(t,a.root),n.setState({isTreeDataLoading:!1,treeData:a})})).catch((function(){n.setState({isTreeDataLoading:!1})}))},n.addResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var a=e.filter((function(e){return e.is_dir})),i=y.Aq.sortDirentsInSharedDir(a,n.state.sortBy,n.state.sortOrder).map((function(e){return new oe({object:e})}));t.addChildren(i)},n.listItems=function(){var e=n.state,t=e.path,a=e.currentMode,i=a==ne.Tb?N.dq:N.HJ;n.setState({isLoading:!0}),S.e.listSharedDir(je,t,i).then((function(e){var t=e.data.dirent_list.map((function(e){return e.isSelected=!1,e}));n.setState({isLoading:!1,errorMsg:"",items:y.Aq.sortDirentsInSharedDir(t,n.state.sortBy,n.state.sortOrder)},(function(){n.getThumbnails(i)}))})).catch((function(e){var t=y.Aq.getErrorMsg(e);n.setState({isLoading:!1,errorMsg:t})}));var s="";s="/"==t?t:"/"===t[t.length-1]?t.slice(0,t.length-1):t;var o=new URL(location.href),r=new URLSearchParams(o.search);r.set("p",s),r.set("mode",a),o.search=r.toString(),o=o.toString(),window.history.pushState({url:o,path:t},t,o)},n.sortItems=function(e,t){n.setState({sortBy:e,sortOrder:t,items:y.Aq.sortDirentsInSharedDir(n.state.items,e,t)})},n.getThumbnails=function(e){var t=n.state.items.filter((function(e){return!e.is_dir&&(y.Aq.imageCheck(e.file_name)||Ie&&y.Aq.videoCheck(e.file_name)||Me&&y.Aq.pdfCheck(e.file_name))&&!e.encoded_thumbnail_src}));if(0!=t.length){var a=t.length,i=n,s=function(n){var o=t[n];S.e.getShareLinkThumbnail(je,o.file_path,e).then((function(e){o.encoded_thumbnail_src=e.data.encoded_thumbnail_src})).catch((function(e){})).then((function(){n<a-1?s(++n):i.setState({items:i.state.items})}))};s(0)}},n.toggleDropdownMenu=function(){n.setState({isDropdownMenuOpen:!n.state.isDropdownMenuOpen})},n.onDropdownToggleKeyDown=function(e){"Enter"!=e.key&&"Space"!=e.key||n.toggleDropdownMenu()},n.onMenuItemKeyDown=function(e,t){"Enter"!=t.key&&"Space"!=t.key||e.onClick()},n.visitFolder=function(e){n.setState({path:e},(function(){n.listItems()}))},n.renderPath=function(){var e=[];Le&&(e.push({icon:"download1",text:(0,N.AP)("ZIP"),onClick:n.zipDownloadFolder.bind(n,n.state.path)}),Ce&&ve&&ve!==Ne&&e.push({icon:"save",text:(0,N.AP)("Save"),onClick:n.saveAllItems})),De&&e.push({icon:"upload-files",disabled:Fe,title:Fe?(0,N.AP)("The owner of this library has run out of space."):"",text:(0,N.AP)("Upload"),onClick:n.onUploadFile});var t=[],a={path:"/",name:Ae};t.push(a);var i=n.state.path;if("/"!=i){var s=("/"===i[i.length-1]?i.slice(0,i.length-1):i).split("/");s.shift();var r="",l=s.map((function(e,t){return{path:(r+="/"+e)+"/",name:e}}));t.push.apply(t,(0,o.A)(l))}return(0,T.jsxs)(p.Fragment,{children:[t.map((function(e,a){return a!=t.length-1?(0,T.jsxs)(p.Fragment,{children:[(0,T.jsx)("span",{className:"path-item",title:e.name,role:"button",onClick:n.visitFolder.bind(n,e.path),children:e.name}),(0,T.jsx)("span",{className:"path-split",children:" / "})]},a):null})),Le||De?(0,T.jsxs)(u.A,{isOpen:n.state.isDropdownMenuOpen,toggle:n.toggleDropdownMenu,children:[(0,T.jsxs)(f.A,{tag:"div",role:"button",className:"path-item path-item-dropdown-toggle",onClick:n.toggleDropdownMenu,onKeyDown:n.onDropdownToggleKeyDown,"data-toggle":"dropdown",children:[(0,T.jsx)("span",{title:t[t.length-1].name,children:t[t.length-1].name}),De?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("i",{className:"sf3-font-new sf3-font main-icon ml-2"}),(0,T.jsx)("i",{className:"sf3-font-down sf3-font"})]}):(0,T.jsx)("i",{className:"sf3-font-down sf3-font ml-1"})]}),(0,T.jsx)(m.A,{className:"position-fixed",children:e.map((function(e,t){return"Divider"==e?(0,T.jsx)(g.A,{divider:!0},t):(0,T.jsxs)(g.A,{onClick:e.onClick,onKeyDown:n.onMenuItemKeyDown.bind(n,e),disabled:e.disabled||!1,title:e.title||"",children:[(0,T.jsx)("i",{className:"sf3-font-".concat(e.icon," sf3-font mr-2 dropdown-item-icon")}),e.text]},t)}))})]}):(0,T.jsx)("span",{className:"path-item",title:t[t.length-1].name,children:t[t.length-1].name})]})},n.zipDownloadFolder=function(e){N.B$?S.e.getShareLinkZipTask(je,e).then((function(e){var t=e.data.zip_token;location.href="".concat(N.IX,"zip/").concat(t)})).catch((function(e){var t=y.Aq.getErrorMsg(e);n.setState({isLoading:!1,errorMsg:t})})):n.setState({isZipDialogOpen:!0,zipFolderPath:e})},n.zipDownloadSelectedItems=function(){var e=n.state.path;if(N.B$){var t=n.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}));S.e.getShareLinkDirentsZipTask(je,e,t).then((function(e){var t=e.data.zip_token;location.href="".concat(N.IX,"zip/").concat(t)})).catch((function(e){var t=y.Aq.getErrorMsg(e);n.setState({isLoading:!1,errorMsg:t})}))}else n.setState({isZipDialogOpen:!0,zipFolderPath:e,selectedItems:n.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},n.saveSelectedItems=function(){n.setState({isSaveSharedDirDialogShow:!0,itemsForSave:n.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},n.saveAllItems=function(){n.setState({isSaveSharedDirDialogShow:!0,itemsForSave:n.state.items.map((function(e){return e.file_name||e.folder_name}))})},n.toggleSaveSharedDirCancel=function(){n.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[]})},n.handleSaveSharedDir=function(e,t){var a=n.state,i=a.path,s=a.itemsForSave;S.e.saveSharedDir(e,t,je,i,s).then((function(e){n.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[],isCopyMoveProgressDialogShow:!0,asyncCopyMoveTaskId:e.data.task_id,asyncOperatedFilesLength:s.length},(function(){n.getAsyncCopyMoveProgress()}))})).catch((function(e){var t=y.Aq.getErrorMsg(e);n.setState({errMessage:t})}))},n.onProgressDialogToggle=function(){if(100!==n.state.asyncOperationProgress){var e=n.state.asyncCopyMoveTaskId;S.e.cancelCopyMoveOperation(e)}n.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1})},n.closeZipDialog=function(){n.setState({isZipDialogOpen:!1,zipFolderPath:"",selectedItems:[]})},n.prepareImageItem=function(e){var t,n=e.file_name,a=e.last_modified,i="gif"==n.substr(n.lastIndexOf(".")+1).toLowerCase(),s="".concat(N.Yc,"d/").concat(je,"/files/?p=").concat(encodeURIComponent(e.file_path));return t=i?"".concat(s,"&raw=1"):"".concat(N.Yc,"thumbnail/").concat(je,"/").concat(N.oC).concat(y.Aq.encodePath(e.file_path),"?mtime=").concat(a),{name:n,url:s,parentDir:e.file_path.slice(0,e.file_path.indexOf(n)),thumbnail:"".concat(N.Yc,"thumbnail/").concat(je,"/").concat(N.oC).concat(y.Aq.encodePath(e.file_path),"?mtime=").concat(a),src:t,downloadURL:s+"&dl=1"}},n.showImagePopup=function(e){var t=n.state.items.filter((function(e){return!e.is_dir&&y.Aq.imageCheck(e.file_name)})),a=t.map((function(e){return n.prepareImageItem(e)}));n.setState({isImagePopupOpen:!0,imageItems:a,imageIndex:t.indexOf(e)})},n.closeImagePopup=function(){n.setState({isImagePopupOpen:!1})},n.moveToPrevImage=function(){var e=n.state.imageItems.length;n.setState((function(t){return{imageIndex:(t.imageIndex+e-1)%e}}))},n.moveToNextImage=function(){var e=n.state.imageItems.length;n.setState((function(t){return{imageIndex:(t.imageIndex+1)%e}}))},n.unselectItems=function(){n.setState({isAllItemsSelected:!1,items:n.state.items.map((function(e){return e.isSelected=!1,e}))})},n.toggleAllSelected=function(){n.setState((function(e){return{isAllItemsSelected:!e.isAllItemsSelected,items:n.state.items.map((function(t){return t.isSelected=!e.isAllItemsSelected,t}))}}))},n.toggleItemSelected=function(e,t){n.setState({items:n.state.items.map((function(n){return n===e&&(n.isSelected=t),n}))},(function(){n.setState({isAllItemsSelected:!n.state.items.some((function(e){return!e.isSelected}))})}))},n.onUploadFile=function(e){e.nativeEvent.stopImmediatePropagation(),n.uploader.onFileUpload()},n.onFileUploadSuccess=function(e){var t=n.state.path,a=e.name,i=e.size,s={isSelected:!1,file_name:a,file_path:y.Aq.joinPath(t,a),is_dir:!1,last_modified:x()().format(),size:i},o=n.state.items.filter((function(e){return e.is_dir})),r=Array.from(n.state.items);r.splice(o.length,0,s),n.setState({items:r}),S.e.shareLinksUploadDone(je,y.Aq.joinPath(be,a))},n.getShareLinkRepoTags=function(){S.e.getShareLinkRepoTags(je).then((function(e){var t=[];e.data.repo_tags.forEach((function(e){var n=new te.A(e);n.fileCount>0&&t.push(n)})),n.setState({usedRepoTags:t})})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))},n.switchMode=function(e){e!=n.state.currentMode&&n.setState({currentMode:e},(function(){n.listItems()}))},n.onSelectSortOption=function(e){var t=e.value.split("-"),a=(0,s.A)(t,2),i=a[0],o=a[1];n.sortItems(i,o)},n.onTreeNodeCollapse=function(e){var t=ce.collapseNode(n.state.treeData,e);n.setState({treeData:t})},n.onTreeNodeExpanded=function(e){var t=n.state.treeData.clone();(e=t.getNodeByPath(e.path)).isLoaded?(t.expandNode(e),n.setState({treeData:t})):S.e.listSharedDir(je,e.path,we).then((function(a){var i=a.data.dirent_list;n.addResponseListToNode(i,e),n.setState({treeData:t})})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))},n.onTreeNodeClick=function(e){if(e.object.is_dir){if(e.isLoaded&&e.path===n.state.path)if(e.isExpanded){var t=ce.collapseNode(n.state.treeData,e);n.setState({treeData:t})}else{var a=n.state.treeData.clone();e=a.getNodeByPath(e.path),a.expandNode(e),n.setState({treeData:a})}if(!e.isLoaded){var i=n.state.treeData.clone();e=i.getNodeByPath(e.path),S.e.listSharedDir(je,e.path,we).then((function(t){var a=t.data.dirent_list;n.addResponseListToNode(a,e),i.collapseNode(e),n.setState({treeData:i})})).catch((function(e){var t=y.Aq.getErrorMsg(e);w.A.danger(t)}))}if(e.path===n.state.path)return;n.visitFolder(e.path)}},n.onResizeMouseUp=function(){n.state.inResizing&&n.setState({inResizing:!1}),localStorage.setItem("sf_side_panel_rate",n.state.sidePanelRate)},n.onResizeMouseDown=function(){n.setState({inResizing:!0})},n.onResizeMouseMove=function(e){var t=e.nativeEvent.clientX/window.innerWidth;n.setState({sidePanelRate:Math.max(Math.min(t,ge.Rx),ge.Pf)})},n.onResizeMouseOver=function(e){if(n.dragHandlerRef.current){var t=n.resizeBarRef.current.getBoundingClientRect().top,a=e.pageY-t-ge.gO/2;n.setDragHandlerTop(a)}},n.setDragHandlerTop=function(e){n.dragHandlerRef.current.style.top=e+"px"},n.state={isTreeDataLoading:!0,treeData:ce.buildTree(),inResizing:!1,sidePanelRate:parseFloat(localStorage.getItem("sf_side_panel_rate")||ge.nT),isLoading:!0,errorMsg:"",items:[],path:Se,isDropdownMenuOpen:!1,currentMode:ke,isAllItemsSelected:!1,selectedItems:[],sortBy:"name",sortOrder:"asc",isZipDialogOpen:!1,zipFolderPath:"",usedRepoTags:[],isSaveSharedDirDialogShow:!1,itemsForSave:[],asyncCopyMoveTaskId:"",asyncOperationProgress:0,asyncOperatedFilesLength:0,isCopyMoveProgressDialogShow:!1,isImagePopupOpen:!1,imageItems:[],imageIndex:0},n.resizeBarRef=p.createRef(),n.dragHandlerRef=p.createRef(),n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"componentDidMount",value:function(){Pe&&w.A.danger((0,N.AP)("File download is disabled: the share link traffic of owner is used up."),{duration:3}),this.loadTreePanel(),this.listItems(),this.getShareLinkRepoTags()}},{key:"getAsyncCopyMoveProgress",value:function(){var e=(0,i.A)((0,a.A)().mark((function e(){var t,n,i,s,o,r;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.asyncCopyMoveTaskId,e.prev=1,e.next=4,S.e.queryAsyncOperationProgress(t);case 4:if(n=e.sent,!(i=n.data).failed){e.next=11;break}return s=(0,N.AP)("Failed to copy files to another library."),w.A.danger(s),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),e.abrupt("return");case 11:if(!i.successful){e.next=16;break}return this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),o=(0,N.AP)("Successfully copied files to another library."),w.A.success(o),e.abrupt("return");case 16:r=i.total?parseInt((i.done/i.total*100).toFixed(2)):0,this.getAsyncCopyMoveProgress(),this.setState({asyncOperationProgress:r}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1});case 24:case"end":return e.stop()}}),e,this,[[1,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.usedRepoTags,a=t.currentMode,i=t.sortBy,s=t.sortOrder,o=t.isTreeDataLoading,r=t.treeData,l=t.path,d=t.sidePanelRate,c=t.inResizing,p={userSelect:c?"none":"",flex:d?"1 0 ".concat(100*(1-d),"%"):"0 0 ".concat(100-100*ge.nT,"%")},h={userSelect:c?"none":"",flex:"0 0 ".concat(d?100*d:100*ge.nT,"%")},u=y.Aq.isDesktop(),f=this.state.items.filter((function(e){return e.isSelected})).length,m=u&&"/"==l&&0!=n.length;return(0,T.jsxs)(ae.T,{repoID:ye,enableMetadata:!1,enableOCR:!1,repoInfo:{permission:"r"},children:[(0,T.jsxs)("div",{id:"shared-dir-view",className:"h-100 d-flex flex-column",children:[(0,T.jsxs)("div",{className:"top-header d-flex justify-content-between flex-shrink-0",children:[(0,T.jsx)("a",{href:N.Yc,children:(0,T.jsx)("img",{src:N.SG+N.VI,height:N.hM,width:N.gA,title:N.q0,alt:"logo"})}),ve&&(0,T.jsx)(b.A,{})]}),(0,T.jsxs)("div",{className:"flex-fill d-flex o-hidden position-relative",onMouseMove:c?this.onResizeMouseMove:null,onMouseUp:this.onResizeMouseUp,children:[(0,T.jsxs)("div",{className:"side-panel",style:h,children:[(0,T.jsxs)("div",{className:"meta-info py-4 mx-4",children:[(0,T.jsx)("h2",{className:"h3 text-truncate mb-4",title:Ae,children:Ae}),(0,T.jsxs)("p",{className:"m-0",children:[(0,N.AP)("Shared by: "),Ne]})]}),(0,T.jsx)("div",{className:"p-4 flex-fill o-auto",children:o?(0,T.jsx)(k.A,{}):(0,T.jsx)(ue,{currentPath:l,treeData:r,onNodeExpanded:this.onTreeNodeExpanded,onNodeCollapse:this.onTreeNodeCollapse,onNodeClick:this.onTreeNodeClick})})]}),u&&(0,T.jsx)(fe.A,{resizeBarRef:this.resizeBarRef,dragHandlerRef:this.dragHandlerRef,resizeBarStyle:{left:"calc(".concat(d?100*d+"%":"".concat(100*ge.nT,"%")," - 1px)")},dragHandlerStyle:{height:ge.gO},onResizeMouseDown:this.onResizeMouseDown,onResizeMouseOver:this.onResizeMouseOver}),(0,T.jsxs)("div",{className:"main-panel cur-view-container",style:p,children:[(0,T.jsxs)("div",{className:"cur-view-path d-flex justify-content-between align-items-center",children:[(0,T.jsx)("div",{className:"cur-view-path-left flex-fill o-hidden",children:Le&&this.state.items.some((function(e){return e.isSelected}))?(0,T.jsxs)("div",{className:"selected-items-toolbar",children:[(0,T.jsxs)("span",{className:"cur-view-path-btn px-1",onClick:this.unselectItems,children:[(0,T.jsx)("span",{className:"sf3-font-x-01 sf3-font mr-2","aria-label":(0,N.AP)("Unselect"),title:(0,N.AP)("Unselect")}),(0,T.jsx)("span",{children:"".concat(f," ").concat((0,N.AP)("selected"))})]}),(0,T.jsx)("span",{className:"cur-view-path-btn ml-4",onClick:this.zipDownloadSelectedItems,children:(0,T.jsx)("span",{className:"sf3-font-download1 sf3-font","aria-label":(0,N.AP)("Download"),title:(0,N.AP)("Download")})}),Ce&&ve&&ve!==Ne&&(0,T.jsx)("span",{className:"cur-view-path-btn ml-4",onClick:this.saveSelectedItems,children:(0,T.jsx)("span",{className:"sf3-font-save sf3-font","aria-label":(0,N.AP)("Save"),title:(0,N.AP)("Save")})})]}):(0,T.jsxs)("div",{className:"path-container",children:[(0,T.jsx)("span",{className:"mr-2",children:(0,N.AP)("Current path: ")}),this.renderPath()]})}),(0,T.jsx)("div",{className:"cur-view-path-right",children:u&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(ie.A,{currentViewMode:a,switchViewMode:this.switchMode}),(0,T.jsx)(se.A,{sortBy:i,sortOrder:s,onSelectSortOption:this.onSelectSortOption})]})})]}),!Fe&&De&&(0,T.jsx)(Y,{ref:function(t){return e.uploader=t},dragAndDrop:!1,token:je,path:"/"===be?be:be.replace(/\/+$/,""),relativePath:"/"===l?l:l.replace(/\/+$/,""),repoID:ye,onFileUploadSuccess:this.onFileUploadSuccess}),(0,T.jsxs)("div",{className:"cur-view-content p-0",children:[m&&(0,T.jsx)(ee.A,{repoID:ye,currentPath:"/",usedRepoTags:this.state.usedRepoTags,shareLinkToken:je,enableFileDownload:Le}),(0,T.jsx)(_e,{isDesktop:u,isLoading:this.state.isLoading,errorMsg:this.state.errorMsg,mode:a,items:this.state.items,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortItems:this.sortItems,isAllItemsSelected:this.state.isAllItemsSelected,toggleAllSelected:this.toggleAllSelected,toggleItemSelected:this.toggleItemSelected,visitFolder:this.visitFolder,zipDownloadFolder:this.zipDownloadFolder,showImagePopup:this.showImagePopup})]})]})]})]}),this.state.isZipDialogOpen&&(0,T.jsx)(P.A,{children:(0,T.jsx)(C.A,{token:je,path:this.state.zipFolderPath,target:this.state.selectedItems,toggleDialog:this.closeZipDialog})}),this.state.isSaveSharedDirDialogShow&&(0,T.jsx)(X,{sharedToken:je,parentDir:l,items:this.state.itemsForSave,toggleCancel:this.toggleSaveSharedDirCancel,handleSaveSharedDir:this.handleSaveSharedDir}),this.state.isCopyMoveProgressDialogShow&&(0,T.jsx)($.A,{type:"copy",asyncOperatedFilesLength:this.state.asyncOperatedFilesLength,asyncOperationProgress:this.state.asyncOperationProgress,toggleDialog:this.onProgressDialogToggle}),this.state.isImagePopupOpen&&(0,T.jsx)(P.A,{children:(0,T.jsx)(F.A,{repoID:ye,repoInfo:{permission:"r"},imageItems:this.state.imageItems,imageIndex:this.state.imageIndex,closeImagePopup:this.closeImagePopup,moveToPrevImage:this.moveToPrevImage,moveToNextImage:this.moveToNextImage,enableRotate:!1,isCustomPermission:!0})})]})}}])}(p.Component),_e=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).sortByName=function(e){e.preventDefault();var t="asc"==n.props.sortOrder?"desc":"asc";n.props.sortItems("name",t)},n.sortByTime=function(e){e.preventDefault();var t="asc"==n.props.sortOrder?"desc":"asc";n.props.sortItems("time",t)},n.sortBySize=function(e){e.preventDefault();var t="asc"==n.props.sortOrder?"desc":"asc";n.props.sortItems("size",t)},n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.isDesktop,a=t.isLoading,i=t.errorMsg,s=t.mode,o=t.items,r=t.sortBy,l=t.sortOrder,d=t.isAllItemsSelected;if(a)return(0,T.jsx)(k.A,{});if(i)return(0,T.jsx)("p",{className:"error mt-6 text-center",children:i});var c=(0,T.jsx)("tbody",{children:o.map((function(t,a){return(0,T.jsx)(Ue,{isDesktop:n,mode:s,item:t,visitFolder:e.props.visitFolder,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup,toggleItemSelected:e.props.toggleItemSelected},a)}))});if(!n)return(0,T.jsxs)("table",{className:"table-hover table-thead-hidden",children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{width:"12%"}),(0,T.jsx)("th",{width:"80%"}),(0,T.jsx)("th",{width:"8%"})]})}),c]});var p=(0,T.jsx)("span",{className:"sf3-font ".concat("asc"==l?"sf3-font-down rotate-180 d-inline-block":"sf3-font-down")});return s==ne.Tb?(0,T.jsx)("div",{className:"table-container",children:(0,T.jsxs)("table",{className:"table-hover",children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[Le&&(0,T.jsx)("th",{width:"3%",className:"text-center",children:(0,T.jsx)("input",{type:"checkbox",checked:d,onChange:this.props.toggleAllSelected})}),(0,T.jsx)("th",{width:"5%"}),(0,T.jsx)("th",{width:Le?"50%":"53%",children:(0,T.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByName,children:[(0,N.AP)("Name")," ","name"==r&&p]})}),(0,T.jsx)("th",{width:"8%"}),(0,T.jsx)("th",{width:"14%",children:(0,T.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortBySize,children:[(0,N.AP)("Size")," ","size"==r&&p]})}),(0,T.jsx)("th",{width:"13%",children:(0,T.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByTime,children:[(0,N.AP)("Last Update")," ","time"==r&&p]})}),(0,T.jsx)("th",{width:"7%"})]})}),c]})}):(0,T.jsx)("ul",{className:"grid-view",children:o.map((function(t,n){return(0,T.jsx)(Oe,{mode:s,item:t,visitFolder:e.props.visitFolder,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup},n)}))})}}])}(p.Component),Ue=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).toggleOpMenu=function(){n.setState({isOpMenuOpen:!n.state.isOpMenuOpen})},n.handleMouseOver=function(){n.setState({isIconShown:!0})},n.handleMouseOut=function(){n.setState({isIconShown:!1})},n.zipDownloadFolder=function(e){e.preventDefault(),n.props.zipDownloadFolder.bind(n,n.props.item.folder_path)()},n.handleFileClick=function(e){var t=n.props.item;y.Aq.imageCheck(t.file_name)&&(e.preventDefault(),n.props.showImagePopup(t))},n.toggleItemSelected=function(e){n.props.toggleItemSelected(n.props.item,e.target.checked)},n.onFolderItemClick=function(e){e.preventDefault();var t=n.props.item.folder_path;n.props.visitFolder(t)},n.state={isIconShown:!1,isOpMenuOpen:!1},n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.isDesktop,a=e.mode,i=this.state.isIconShown;if(t.is_dir)return n?(0,T.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Le&&(0,T.jsx)("td",{className:"text-center",children:(0,T.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),(0,T.jsx)("td",{className:"text-center",children:(0,T.jsx)("img",{src:y.Aq.getFolderIconUrl(),alt:"",width:"24"})}),(0,T.jsx)("td",{children:(0,T.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(a),onClick:this.onFolderItemClick,children:t.folder_name})}),(0,T.jsx)("td",{}),(0,T.jsx)("td",{}),(0,T.jsx)("td",{title:x()(t.last_modified).format("dddd, MMMM D, YYYY h:mm:ss A"),children:x()(t.last_modified).fromNow()}),(0,T.jsx)("td",{children:Le&&(0,T.jsx)("a",{role:"button",className:"op-icon sf3-font sf3-font-download1".concat(i?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:(0,N.AP)("Download"),"aria-label":(0,N.AP)("Download")})})]}):(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{className:"text-center",children:(0,T.jsx)("img",{src:y.Aq.getFolderIconUrl(),alt:"",width:"24"})}),(0,T.jsxs)("td",{children:[(0,T.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(a),onClick:this.onFolderItemClick,children:t.folder_name}),(0,T.jsx)("br",{}),(0,T.jsx)("span",{className:"item-meta-info",children:x()(t.last_modified).fromNow()})]}),(0,T.jsx)("td",{children:Le&&(0,T.jsx)(me.A,{children:(0,T.jsx)(g.A,{className:"mobile-menu-item",onClick:this.zipDownloadFolder,children:(0,N.AP)("Download")})})})]});var s="".concat(N.Yc,"d/").concat(je,"/files/?p=").concat(encodeURIComponent(t.file_path)),o=t.encoded_thumbnail_src?"".concat(N.Yc).concat(t.encoded_thumbnail_src,"?mtime=").concat(t.last_modified):"";return n?(0,T.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Le&&(0,T.jsx)("td",{className:"text-center",children:(0,T.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),(0,T.jsx)("td",{className:"text-center",children:o?(0,T.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,T.jsx)("img",{src:y.Aq.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,T.jsx)("td",{children:(0,T.jsx)("a",{href:s,onClick:this.handleFileClick,children:t.file_name})}),(0,T.jsx)("td",{className:"tag-list-title"}),(0,T.jsx)("td",{children:y.Aq.bytesToSize(t.size)}),(0,T.jsx)("td",{title:x()(t.last_modified).format("dddd, MMMM D, YYYY h:mm:ss A"),children:x()(t.last_modified).fromNow()}),(0,T.jsx)("td",{children:Le&&(0,T.jsx)("a",{className:"op-icon sf3-font sf3-font-download1".concat(i?"":" invisible"),href:"".concat(s,"&dl=1"),title:(0,N.AP)("Download"),"aria-label":(0,N.AP)("Download")})})]}):(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{className:"text-center",children:o?(0,T.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,T.jsx)("img",{src:y.Aq.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,T.jsxs)("td",{children:[(0,T.jsx)("a",{href:s,onClick:this.handleFileClick,children:t.file_name}),(0,T.jsx)("br",{}),(0,T.jsx)("span",{className:"item-meta-info",children:y.Aq.bytesToSize(t.size)}),(0,T.jsx)("span",{className:"item-meta-info",children:x()(t.last_modified).fromNow()})]}),(0,T.jsx)("td",{children:Le&&(0,T.jsx)(me.A,{children:(0,T.jsx)(g.A,{className:"mobile-menu-item",tag:"a",href:"".concat(s,"&dl=1"),children:(0,N.AP)("Download")})})})]})}}])}(p.Component),Oe=function(e){function t(e){var n;return(0,r.A)(this,t),(n=(0,d.A)(this,t,[e])).handleMouseOver=function(){n.setState({isIconShown:!0})},n.handleMouseOut=function(){n.setState({isIconShown:!1})},n.zipDownloadFolder=function(e){e.preventDefault(),n.props.zipDownloadFolder.bind(n,n.props.item.folder_path)()},n.handleFileClick=function(e){var t=n.props.item;y.Aq.imageCheck(t.file_name)&&(e.preventDefault(),n.props.showImagePopup(t))},n.onFolderItemClick=function(e){e.preventDefault();var t=n.props.item.folder_path;n.props.visitFolder(t)},n.state={isIconShown:!1},n}return(0,c.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.mode,a=this.state.isIconShown;if(t.is_dir){var i="?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(n);return(0,T.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,T.jsx)("a",{href:i,className:"grid-file-img-link d-block",onClick:this.onFolderItemClick,children:(0,T.jsx)("img",{src:y.Aq.getFolderIconUrl(!1,192),alt:"",width:"80",height:"80"})}),(0,T.jsx)("a",{href:i,className:"grid-file-name grid-file-name-link",onClick:this.onFolderItemClick,children:t.folder_name}),Le&&(0,T.jsx)("a",{role:"button",className:"action-icon sf3-font sf3-font-download1".concat(a?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:(0,N.AP)("Download"),"aria-label":(0,N.AP)("Download")})]})}var s="".concat(N.Yc,"d/").concat(je,"/files/?p=").concat(encodeURIComponent(t.file_path)),o=t.encoded_thumbnail_src?"".concat(N.Yc).concat(t.encoded_thumbnail_src,"?mtime=").concat(t.last_modified):"";return(0,T.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,T.jsx)("a",{href:s,className:"grid-file-img-link d-block",onClick:this.handleFileClick,children:o?(0,T.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,T.jsx)("img",{src:y.Aq.getFileIconUrl(t.file_name),alt:"",width:"80",height:"80"})}),(0,T.jsx)("a",{href:s,className:"grid-file-name grid-file-name-link",onClick:this.handleFileClick,children:t.file_name}),Le&&(0,T.jsx)("a",{className:"action-icon sf3-font sf3-font-download1".concat(a?"":" invisible"),href:"".concat(s,"&dl=1"),title:(0,N.AP)("Download"),"aria-label":(0,N.AP)("Download")})]})}}])}(p.Component);(0,h.createRoot)(document.getElementById("wrapper")).render((0,T.jsx)(Te,{}))},47100:function(){},75243:function(){}},function(e){e.O(0,[4223],(function(){return t=54901,e(e.s=t);var t}));e.O()}]);