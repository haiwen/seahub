"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[7866],{88002:function(e,t,a){a.d(t,{A:function(){return m}});var n=a(23029),i=a(92901),s=a(39874),o=a(85501),r=a(9950),l=a(8081),d=a(10877),c=a(40326),u=a(20338),p=a(44414),h=function(e){function t(){return(0,n.default)(this,t),(0,s.default)(this,t,arguments)}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.type,a=e.asyncOperationProgress,n=e.asyncOperatedFilesLength,i="move"===t?(0,c.APU)("Move {num} items"):(0,c.APU)("Copy {num} items");i=i.replace("{num}",n);var s={width:a+"%",lineHeight:"40px",textAlign:"left"};return(0,p.jsxs)(l.A,{isOpen:!0,toggle:this.props.toggleDialog,className:"copy-move-dirent-progress-dialog",children:[(0,p.jsx)(u.A,{toggle:this.props.toggleDialog,children:i}),(0,p.jsx)(d.A,{children:(0,p.jsx)("div",{className:"progress",children:(0,p.jsx)("div",{className:"progress-bar pl-2",role:"progressbar",style:s,"aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100",children:a+"%"})})})]})}}])}(r.Component),m=h},93355:function(e,t,a){a.d(t,{A:function(){return F}});var n=a(23029),i=a(92901),s=a(39874),o=a(85501),r=a(9950),l=a(40866),d=a(8081),c=a(10877),u=a(6754),p=a(34322),h=a(4159),m=a.n(h),f=a(40326),g=a(97011),v=a(65604),x=a(4086),b=a(20338),j=a(95754),y=a(44414),A=function(e){function t(e){var a;return(0,n.default)(this,t),(a=(0,s.default)(this,t,[e])).onFileTagChanged=function(e){var t=e.parent_path,n={name:e.filename},i="/"===t?t+e.filename:t+"/"+e.filename;a.props.onFileTagChanged(n,i)},a.onDeleteTaggedFile=function(e){var t=a.props.repoID,n=e.file_tag_id;g.e.deleteFileTag(t,n).then((function(t){a.getTaggedFiles(),a.props.updateUsedRepoTags(),a.props.onFileTagChanged&&!e.file_deleted&&a.onFileTagChanged(e)})).catch((function(e){var t=v.Aq.getErrorMsg(e);x.A.danger(t)}))},a.getTaggedFiles=function(){var e=a.props,t=e.repoID,n=e.currentTag,i=e.shareLinkToken;(i?g.e.getShareLinkTaggedFiles(i,n.id):g.e.listTaggedFiles(t,n.id)).then((function(e){var t=[];void 0!==e.data.tagged_files&&e.data.tagged_files.forEach((function(e){var a=e;t.push(a)})),a.setState({taggedFileList:t})})).catch((function(e){var t=v.Aq.getErrorMsg(e);x.A.danger(t)}))},a.state={taggedFileList:[]},a}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){this.getTaggedFiles()}},{key:"render",value:function(){var e=this,t=this.state.taggedFileList;return(0,y.jsxs)(d.A,{isOpen:!0,style:f.zG5,children:[(0,y.jsx)(b.A,{toggle:this.props.onClose,children:(0,f.APU)("Tagged Files")}),(0,y.jsx)(c.A,{className:"dialog-list-container",children:(0,y.jsxs)("table",{children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{width:"50%",className:"ellipsis",children:(0,f.APU)("Name")}),(0,y.jsx)("th",{width:"20%",children:(0,f.APU)("Size")}),(0,y.jsx)("th",{width:"22%",children:(0,f.APU)("Last Update")}),(0,y.jsx)("th",{width:"8%"})]})}),(0,y.jsx)("tbody",{children:t.map((function(t,a){return(0,y.jsx)(S,{repoID:e.props.repoID,taggedFile:t,onDeleteTaggedFile:e.onDeleteTaggedFile,shareLinkToken:e.props.shareLinkToken,enableFileDownload:e.props.enableFileDownload},a)}))})]})}),(0,y.jsx)(u.A,{children:(0,y.jsx)(p.A,{color:"secondary",onClick:this.props.toggleCancel,children:(0,f.APU)("Close")})})]})}}])}(r.Component),S=function(e){function t(e){var a;return(0,n.default)(this,t),(a=(0,s.default)(this,t,[e])).onMouseEnter=function(){a.setState({active:!0})},a.onMouseLeave=function(){a.setState({active:!1})},a.deleteFile=function(e){e.preventDefault(),a.props.onDeleteTaggedFile(a.props.taggedFile)},a.state={active:!1},a}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.taggedFile,a=e.shareLinkToken,n=e.enableFileDownload,i=t.parent_path?v.Aq.joinPath(t.parent_path,t.filename):"",s=a?f.YcY+"d/"+a+"/files/?p="+v.Aq.encodePath(i):f.YcY+"lib/"+this.props.repoID+"/file"+v.Aq.encodePath(i);return(0,y.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onMouseEnter,children:[t.file_deleted?(0,y.jsx)(r.Fragment,{children:(0,y.jsxs)("td",{colSpan:"3",className:"name",children:[t.filename," ",(0,y.jsx)("span",{style:{color:"red"},children:(0,f.APU)("deleted")})]})}):(0,y.jsxs)(r.Fragment,{children:[(0,y.jsx)("td",{children:(0,y.jsx)("a",{href:s,target:"_blank",className:"d-inline-block w-100 ellipsis",title:t.filename,rel:"noreferrer",children:t.filename})}),(0,y.jsx)("td",{children:v.Aq.bytesToSize(t.size)}),(0,y.jsx)("td",{children:m().unix(t.mtime).fromNow()})]}),(0,y.jsxs)("td",{children:[!a&&(0,y.jsx)("a",{href:"#",role:"button","aria-label":(0,f.APU)("Delete"),title:(0,f.APU)("Delete"),className:"action-icon".concat(this.state.active?"":" invisible"),onClick:this.deleteFile,children:(0,y.jsx)(j.A,{symbol:"close"})}),a&&n&&(0,y.jsx)("a",{className:"action-icon".concat(this.state.active?"":" invisible"),href:"".concat(s,"&dl=1"),title:(0,f.APU)("Download"),"aria-label":(0,f.APU)("Download"),children:(0,y.jsx)(j.A,{symbol:"download"})})]})]})}}])}(r.Component),N=a(75150),k=a(72249),w=a(3866),P=function(){var e=(0,N.nk)().enableMetadataManagement;return(0,y.jsx)("div",{className:"repo-info-bar-migrate mt-2",children:e?(0,y.jsxs)(y.Fragment,{children:[(0,f.APU)("Tips: There are tags of old version. Please migrate tags to new version."),(0,y.jsx)(p.A,{color:"link",size:"sm",tag:"a",onClick:function(){k.B.dispatch(w.T.OPEN_TREE_PANEL,(function(){return k.B.dispatch(w.T.OPEN_LIBRARY_SETTINGS_TAGS)}))},children:(0,f.APU)("Migrate")})]}):(0,y.jsx)(y.Fragment,{children:(0,f.APU)("Tips: These are tags of old version. The feature is deprecated and can no longer be used.")})})},F=function(e){function t(e){var a;return(0,n.default)(this,t),(a=(0,s.default)(this,t,[e])).onListTaggedFiles=function(e){a.setState({currentTag:e,isListTaggedFileShow:!a.state.isListTaggedFileShow})},a.onCloseDialog=function(){a.setState({isListTaggedFileShow:!1})},a.state={currentTag:null,isListTaggedFileShow:!1},a}return(0,o.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.repoID,n=t.usedRepoTags,i=t.className,s=t.shareLinkToken;return(0,y.jsxs)("div",{className:"repo-info-bar ".concat(i||""),children:[n.length>0&&(0,y.jsx)("ul",{className:"used-tag-list",children:n.map((function(t){return(0,y.jsxs)("li",{className:"used-tag-item",children:[(0,y.jsx)("span",{className:"used-tag",style:{backgroundColor:t.color}}),(0,y.jsx)("span",{className:"used-tag-name",title:t.name,children:t.name}),(0,y.jsx)("button",{type:"button",className:"used-tag-files border-0 bg-transparent",onClick:e.onListTaggedFiles.bind(e,t),children:t.fileCount>1?t.fileCount+" files":t.fileCount+" file"})]},t.id)}))}),this.state.isListTaggedFileShow&&(0,y.jsx)(l.A,{children:(0,y.jsx)(A,{repoID:a,currentTag:this.state.currentTag,onClose:this.onCloseDialog,toggleCancel:this.onListTaggedFiles,updateUsedRepoTags:this.props.updateUsedRepoTags,onFileTagChanged:this.props.onFileTagChanged,shareLinkToken:s,enableFileDownload:this.props.enableFileDownload})}),!s&&(0,y.jsx)(P,{})]})}}])}(r.Component)},75299:function(e,t,a){a.d(t,{A:function(){return v}});var n=a(23029),i=a(92901),s=a(39874),o=a(85501),r=a(9950),l=a(5495),d=a(69123),c=a(65276),u=a(34940),p=a(65604),h=a(40326),m=a(2949),f=a(95754),g=a(44414),v=function(e){function t(e){var a;return(0,n.default)(this,t),(a=(0,s.default)(this,t,[e])).onKeyDown=function(e){(e.ctrlKey||e.metaKey)&&e.shiftKey&&(49===e.keyCode?a.props.switchViewMode(m.Tb):50===e.keyCode&&a.props.switchViewMode(m.nj))},a.toggleDropdownMenu=function(){a.setState({isDropdownMenuOpen:!a.state.isDropdownMenuOpen})},a.state={isDropdownMenuOpen:!1},a}return(0,o.default)(t,e),(0,i.default)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown)}},{key:"render",value:function(){var e=this,t=this.state.isDropdownMenuOpen,a=this.props.currentViewMode,n=p.Aq.isMac()?"\u21e7 \u2318":"Ctrl + Shift +",i=[{icon:"list-view",text:(0,h.APU)("List view"),value:m.Tb,shortcut:"".concat(n," 1")},{icon:"grid-view",text:(0,h.APU)("Grid view"),value:m.nj,shortcut:"".concat(n," 2")}];return(0,g.jsxs)(l.A,{isOpen:t,toggle:this.toggleDropdownMenu,children:[(0,g.jsx)(d.A,{tag:"span",role:"button",tabIndex:"0",className:"cur-view-path-btn px-1",title:(0,h.APU)("Switch view mode"),"data-toggle":"dropdown","aria-label":(0,h.APU)("Switch view mode"),"aria-expanded":t,children:(0,g.jsx)(f.A,{symbol:a===m.Tb?"list-view":"grid-view"})}),(0,g.jsx)(c.A,{className:"mt-1",children:i.map((function(t,n){return(0,g.jsx)(u.A,{className:"p-0",onClick:e.props.switchViewMode.bind(e,t.value),children:(0,g.jsxs)("div",{className:"view-modes-dropdown-wrapper",children:[(0,g.jsx)("span",{className:"view-modes-dropdown-tick",children:a===t.value&&(0,g.jsx)(f.A,{symbol:"check-thin"})}),(0,g.jsxs)("span",{className:"view-modes-dropdown-content d-flex align-items-center",children:[(0,g.jsx)(f.A,{symbol:t.icon,className:"mr-2"}),(0,g.jsx)("span",{children:t.text})]}),(0,g.jsx)("span",{className:"view-modes-dropdown-shortcut ml-4 d-flex align-items-center",children:t.shortcut})]})},n)}))})]})}}])}(r.Component)},54901:function(e,t,a){var n=a(62822),i=a(10467),s=a(5544),o=a(89379),r=a(60436),l=a(23029),d=a(92901),c=a(39874),u=a(85501),p=a(9950),h=a(1352),m=a(5495),f=a(69123),g=a(65276),v=a(34940),x=a(4159),b=a.n(x),j=a(48738),y=a.n(j),A=a(37609),S=a.n(A),N=a(51925),k=a(40326),w=a(65604),P=a(97011),F=a(9961),C=a(4086),U=a(40866),D=a(16670),I=a(24778),L=a(68238),M=a.n(L),_=a(72517),T=a.n(_),O=a(95754),z=a(44414),E="uploading",R="error",q="isSaving",B="uploaded",H=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).onUploadCancel=function(e){e.preventDefault(),a.props.onUploadCancel(a.props.resumableFile)},a.onUploadRetry=function(e){e.preventDefault(),a.props.onUploadRetry(a.props.resumableFile)},a.formatFileSize=function(e){return"number"!==typeof e?"":e>=1e9?(e/1e9).toFixed(1)+" G":e>=1e6?(e/1e6).toFixed(1)+" M":e>=1e3?(e/1e3).toFixed(1)+" K":e.toFixed(1)+" B"},a.state={uploadState:E},a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.resumableFile,a=E;t.error?a=R:(0!==t.remainingTime||t.isSaved||(a=q),t.isSaved&&(a=B)),this.setState({uploadState:a})}},{key:"render",value:function(){var e=this.props.resumableFile,t=Math.round(100*e.progress()),a=e.error;return(0,z.jsxs)("tr",{className:"file-upload-item",children:[(0,z.jsx)("td",{className:"upload-name",children:(0,z.jsx)("div",{className:"ellipsis",children:e.newFileName})}),(0,z.jsx)("td",{children:(0,z.jsx)("span",{className:"file-size",children:this.formatFileSize(e.size)})}),(0,z.jsxs)("td",{className:"upload-progress",children:[(this.state.uploadState===E||this.state.uploadState===q)&&(0,z.jsxs)(p.Fragment,{children:[e.size>=1e8&&(0,z.jsxs)(p.Fragment,{children:[e.isUploading()&&(0,z.jsxs)("div",{className:"progress-container",children:[(0,z.jsx)("div",{className:"progress",children:(0,z.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})}),-1===e.remainingTime&&(0,z.jsx)("div",{className:"progress-text",children:(0,k.APU)("Preparing to upload...")}),e.remainingTime>0&&(0,z.jsxs)("div",{className:"progress-text",children:[(0,k.APU)("Remaining")," ",w.Aq.formatTime(e.remainingTime)]}),0===e.remainingTime&&(0,z.jsx)("div",{className:"progress-text",children:(0,k.APU)("Saving...")})]}),!e.isUploading()&&(0,z.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,z.jsx)("div",{className:"progress",children:(0,z.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),e.size<1e8&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,z.jsx)("div",{className:"progress",children:(0,z.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})}),this.state.uploadState===E&&(0,z.jsxs)(z.Fragment,{children:[0==t&&(0,z.jsx)("p",{className:"progress-text mb-0",children:(0,k.APU)("Waiting...")}),t>0&&(0,z.jsx)("p",{className:"progress-text mb-0",children:"".concat((0,k.APU)("Uploading...")," ").concat(t,"%")})]}),this.state.uploadState===q&&(0,z.jsx)("p",{className:"progress-text mb-0",children:(0,k.APU)("Saving...")})]})]}),this.state.uploadState===B&&(0,z.jsxs)("div",{className:"d-flex align-items-center",children:[(0,z.jsx)("span",{className:"upload-success-icon mr-2",children:(0,z.jsx)(O.A,{symbol:"check-thin"})}),(0,z.jsx)("span",{className:"upload-success-msg",children:(0,k.APU)("Uploaded")})]}),this.state.uploadState===R&&(0,z.jsxs)("div",{className:"d-flex align-items-center","aria-label":(0,k.APU)("Upload failed"),title:(0,k.APU)("Upload failed"),children:[(0,z.jsx)("span",{className:"upload-failure-icon mr-2","aria-hidden":"true",children:(0,z.jsx)(O.A,{symbol:"info"})}),(0,z.jsx)("span",{className:"upload-failure-msg",dangerouslySetInnerHTML:{__html:a}})]})]}),(0,z.jsx)("td",{className:"upload-operation",children:(0,z.jsxs)(p.Fragment,{children:[this.state.uploadState===E&&(0,z.jsx)("a",{href:"#",onClick:this.onUploadCancel,role:"button",children:(0,k.APU)("Cancel")}),this.state.uploadState===R&&(0,z.jsx)("a",{href:"#",onClick:this.onUploadRetry,role:"button",children:(0,k.APU)("Retry")})]})})]})}}])}(p.Component),Y=function(e){function t(){return(0,l.default)(this,t),(0,c.default)(this,t,arguments)}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props.file;return(0,z.jsxs)("tr",{className:"file-upload-item",children:[(0,z.jsx)("td",{className:"upload-name",children:(0,z.jsx)("div",{className:"ellipsis",title:e.name,children:e.name})}),(0,z.jsx)("td",{children:w.Aq.bytesToSize(e.size)}),(0,z.jsx)("td",{children:(0,z.jsxs)("div",{className:"d-flex align-items-center",children:[(0,z.jsx)("span",{className:"upload-failure-icon mr-2","aria-hidden":"true",children:(0,z.jsx)(O.A,{symbol:"info"})}),(0,z.jsx)("span",{className:"upload-failure-msg","aria-label":(0,k.APU)("File too large"),title:(0,k.APU)("File too large"),children:(0,k.APU)("File too large")})]})}),(0,z.jsx)("td",{})]})}}])}(p.Component),K=Y,G=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).onCancelAllUploading=function(){a.props.onCancelAllUploading()},a.onMinimizeUpload=function(e){e.nativeEvent.stopImmediatePropagation(),a.setState({isMinimized:!a.state.isMinimized})},a.onCloseUpload=function(e){e.nativeEvent.stopImmediatePropagation(),a.props.onCloseUploadDialog()},a.state={isMinimized:!1},a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e,t=this,a=this.props,n=a.totalProgress,i=a.retryFileList,s=a.uploadBitrate,o=a.uploadFileList,r=a.forbidUploadFileList,l=a.isUploading,d=(0,k.APU)("{uploaded_files_num}/{all_files_num} Files").replace("{uploaded_files_num}",o.filter((function(e){return e.isSaved})).length).replace("{all_files_num}",o.length);if(!l){var c=o.filter((function(e){return e.error})).length+r.length;c>0&&(e=(0,k.APU)("{failed_files_num} file(s) failed to upload").replace("{failed_files_num}",c))}return(0,z.jsxs)("div",{className:"uploader-list-view mw-100",style:{height:this.state.isMinimized?document.querySelector(".uploader-list-header").offsetHeight:"20rem"},children:[(0,z.jsxs)("div",{className:"uploader-list-header flex-shrink-0",children:[(0,z.jsx)("div",{children:l?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("span",{children:(0,k.APU)("File Uploading...")}),(0,z.jsx)("span",{className:"ml-2",children:"".concat(n,"% (").concat(w.Aq.formatBitRate(s),")")}),(0,z.jsx)("div",{className:"progress",children:(0,z.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(n,"%")},"aria-valuenow":n,"aria-valuemin":"0","aria-valuemax":"100"})})]}):(0,z.jsx)(z.Fragment,{children:e?(0,z.jsx)("p",{className:"m-0 error",children:e}):(0,z.jsx)("p",{className:"m-0",children:(0,k.APU)("All files uploaded")})})}),(0,z.jsxs)("div",{className:"upload-dialog-op-container",children:[(0,z.jsx)("span",{className:"upload-dialog-op",role:"button",tabIndex:"0",onClick:this.onMinimizeUpload,children:(0,z.jsx)(O.A,{symbol:"minus"})}),!l&&(0,z.jsx)("span",{className:"upload-dialog-op",role:"button",tabIndex:"0",onClick:this.onCloseUpload,children:(0,z.jsx)(O.A,{symbol:"close"})})]})]}),(0,z.jsxs)("div",{className:"uploader-list-content",children:[(0,z.jsxs)("div",{className:"d-flex justify-content-between align-items-center border-bottom uploader-content-bar",children:[o.length>0&&(0,z.jsx)("span",{children:d}),(0,z.jsxs)("div",{className:"ml-auto",children:[(0,z.jsx)("button",{className:"btn btn-lg border-0 background-transparent px-0",onClick:this.props.onUploadRetryAll,disabled:0==i.length,children:(0,k.APU)("Retry All")}),(0,z.jsx)("button",{className:"btn btn-lg border-0 background-transparent px-0 ml-3",onClick:this.props.onCancelAllUploading,disabled:!l,children:(0,k.APU)("Cancel All")})]})]}),(0,z.jsxs)("table",{className:"table-thead-hidden",children:[(0,z.jsx)("thead",{children:(0,z.jsxs)("tr",{children:[(0,z.jsx)("th",{width:"40%",children:(0,k.APU)("name")}),(0,z.jsx)("th",{width:"15%",children:(0,k.APU)("size")}),(0,z.jsx)("th",{width:"30%",children:(0,k.APU)("progress")}),(0,z.jsx)("th",{width:"15%",children:(0,k.APU)("state")})]})}),(0,z.jsxs)("tbody",{children:[this.props.forbidUploadFileList.map((function(e,t){return(0,z.jsx)(K,{file:e},t)})),this.props.uploadFileList.map((function(e,a){return(0,z.jsx)(H,{resumableFile:e,onUploadCancel:t.props.onUploadCancel,onUploadRetry:t.props.onUploadRetry},a)}))]})]})]})]})}}])}(p.Component),V=(a(89183),function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).componentWillUnmount=function(){window.onbeforeunload=null,!0===a.props.dragAndDrop&&a.resumable.disableDropOnDocument()},a.onbeforeunload=function(){if(window.uploader&&window.uploader.isUploadProgressDialogShow&&100!==window.uploader.totalProgress)return""},a.bindCallbackHandler=function(){var e=a.props,t=e.minFileSizeErrorCallback,n=e.fileTypeErrorCallback;a.maxFilesErrorCallback&&(a.resumable.opts.maxFilesErrorCallback=a.maxFilesErrorCallback),t&&(a.resumable.opts.minFileSizeErrorCallback=a.props.minFileSizeErrorCallback),a.maxFileSizeErrorCallback&&(a.resumable.opts.maxFileSizeErrorCallback=a.maxFileSizeErrorCallback),n&&(a.resumable.opts.fileTypeErrorCallback=a.props.fileTypeErrorCallback)},a.bindEventHandler=function(){a.resumable.on("chunkingComplete",a.onChunkingComplete.bind(a)),a.resumable.on("fileAdded",a.onFileAdded.bind(a)),a.resumable.on("filesAddedComplete",a.filesAddedComplete.bind(a)),a.resumable.on("fileProgress",a.onFileProgress.bind(a)),a.resumable.on("fileSuccess",a.onFileUploadSuccess.bind(a)),a.resumable.on("progress",a.onProgress.bind(a)),a.resumable.on("complete",a.onComplete.bind(a)),a.resumable.on("pause",a.onPause.bind(a)),a.resumable.on("fileRetry",a.onFileRetry.bind(a)),a.resumable.on("fileError",a.onFileError.bind(a)),a.resumable.on("error",a.onError.bind(a)),a.resumable.on("beforeCancel",a.onBeforeCancel.bind(a)),a.resumable.on("cancel",a.onCancel.bind(a)),a.resumable.on("dragstart",a.onDragStart.bind(a))},a.maxFilesErrorCallback=function(e,t){var a=k.YX7,n=(0,k.APU)("Please upload no more than {maxFiles} files at a time.");n=n.replace("{maxFiles}",a),C.A.danger(n)},a.maxFileSizeErrorCallback=function(e){var t=a.state.forbidUploadFileList;t.push(e),a.setState({forbidUploadFileList:t})},a.onChunkingComplete=function(e){var t="/"===a.props.path?"/":a.props.path+"/",n=e.fileName,i=e.relativePath,s=n===i;if(e.formData={},s)e.formData={parent_dir:t};else{var o=i.slice(0,i.lastIndexOf("/")+1);e.formData={parent_dir:t,relative_path:o}}},a.onFileAdded=function(e,t){if(a.isCancellingAll)try{a.resumable.removeFile(e)}catch(u){}else if(a.suppressAdds)try{a.resumable.removeFile(e)}catch(u){}else if(e.fileName===e.relativePath&&1===t.length){a.setUploadFileList(a.resumable.files);var n=a.props,i=n.token,s=n.relativePath,o=a.uploadSession;P.e.sharedLinkGetFileUploadUrl(i,s).then((function(t){a.isCancellingAll||a.suppressAdds||a.uploadSession!==o||(a.resumable.opts.target=t.data.upload_link+"?ret-json=1",a.resumableUpload(e))})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))}else if(a.setUploadFileList(a.resumable.files),!a.isUploadLinkLoaded){a.isUploadLinkLoaded=!0;var r=a.props,l=r.token,d=r.relativePath,c=a.uploadSession;P.e.sharedLinkGetFileUploadUrl(l,d).then((function(e){a.isCancellingAll||a.suppressAdds||a.uploadSession!==c||(a.resumable.opts.target=e.data.upload_link+"?ret-json=1",a.resumable.upload())})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))}},a.resumableUpload=function(e){var t=a.props,n=t.repoID,i=t.path,s=a.uploadSession;P.e.getFileUploadedBytes(n,i,e.fileName).then((function(t){if(!a.isCancellingAll&&!a.suppressAdds&&a.uploadSession===s){var n=t.data.uploadedBytes,i=1024*parseInt(k.QVk)*1024||1048576,o=Math.floor(n/i);e.markChunksCompleted(o),a.isCancellingAll||a.suppressAdds||a.uploadSession!==s||a.resumable.upload()}})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))},a.filesAddedComplete=function(e,t){if(!a.isCancellingAll&&!a.suppressAdds){var n="undefined"!==typeof k.YX7?k.YX7:void 0;if(n&&t&&t.length>n){var i=(0,k.APU)("Please upload no more than {maxFiles} files at a time.");i=i.replace("{maxFiles}",n),C.A.danger(i),t.forEach((function(t){try{e.removeFile(t)}catch(a){}}));var s=e.files||[];return a.setState({uploadFileList:s,isUploadProgressDialogShow:s.length>0&&a.state.isUploadProgressDialogShow}),void(0===s.length&&w.Aq.registerGlobalVariable("uploader","isUploadProgressDialogShow",!1))}a.state.forbidUploadFileList.length>0&&0===t.length&&a.setState({isUploadProgressDialogShow:!0,totalProgress:100}),a.setUploadFileList()}},a.setUploadFileList=function(){var e=a.resumable.files;a.setState({uploadFileList:e,isUploadProgressDialogShow:!0}),w.Aq.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)},a.onFileProgress=function(e){var t=a.getBitrate(),n=a.state.uploadFileList.map((function(a){if(a.uniqueIdentifier===e.uniqueIdentifier&&t){var n=8*(a.size-a.size*a.progress()),i=Math.floor(n/t);a.remainingTime=i}return a}));a.setState({uploadBitrate:t,uploadFileList:n})},a.getBitrate=function(){var e=0,t=0,n=(new Date).getTime();if(a.resumable.files.forEach((function(t){e+=t.progress()*t.size})),a.timestamp){var i=n-a.timestamp;if(i<a.bitrateInterval)return a.state.uploadBitrate;(e<a.loaded||0===a.loaded)&&(a.loaded=e),t=(e-a.loaded)*(1e3/i)*8}return a.timestamp=n,a.loaded=e,t},a.onProgress=function(){var e=Math.round(100*a.resumable.progress());a.setState({totalProgress:e}),w.Aq.registerGlobalVariable("uploader","totalProgress",e)},a.onFileUploadSuccess=function(e,t){var n=e.formData,i=(new Date).getTime()/1e3;if(t=n.replace?t:JSON.parse(t)[0],n.relative_path){var s=n.relative_path,o=s.slice(0,s.indexOf("/")),r={id:t.id,name:o,type:"dir",mtime:i};a.notifiedFolders.some((function(e){return e.name===r.name}))||(a.notifiedFolders.push(r),a.props.onFileUploadSuccess(r));var l=a.state.uploadFileList.map((function(a){return a.uniqueIdentifier===e.uniqueIdentifier&&(a.newFileName=s+t.name,a.isSaved=!0),a}));a.setState({uploadFileList:l})}else{var d={id:t.id,type:"file",name:t.name,size:t.size,mtime:i};a.props.onFileUploadSuccess(d);var c=a.state.uploadFileList.map((function(a){return a.uniqueIdentifier===e.uniqueIdentifier&&(a.newFileName=t.name,a.isSaved=!0),a}));a.setState({uploadFileList:c})}},a.onFileError=function(e,t){var n="";if(t){var i=t.replace(/\n/g,"");i=JSON.parse(i),"File locked by others."===(n=i.error)&&(n=(0,k.APU)("File is locked by others.")),"Internal error."===n&&(n=(0,k.APU)("Internal Server Error"))}else n=(0,k.APU)("Network error");var s=a.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(a.state.retryFileList.push(t),t.error=n),t}));a.loaded=0,a.setState({retryFileList:a.state.retryFileList,uploadFileList:s})},a.onComplete=function(){a.notifiedFolders=[],a.isUploadLinkLoaded=!1},a.onPause=function(){},a.onError=function(e){a.isUploadLinkLoaded=!1,w.Aq.registerGlobalVariable("uploader","totalProgress",100)},a.onFileRetry=function(){},a.onBeforeCancel=function(){},a.onCancel=function(){},a.setHeaders=function(e,t){var a=t.offset,n=t.getOpt("chunkSize"),i=0===e.size?1:e.size,s=0!==a?a*n:0,o=Math.min(i,(a+1)*n)-1;return i-t.endByte<n&&!t.getOpt("forceChunkSize")&&(o=i),{Accept:"application/json; text/javascript, */*; q=0.01","Content-Disposition":'attachment; filename="'+encodeURI(e.fileName)+'"',"Content-Range":"bytes "+s+"-"+o+"/"+i}},a.setQuery=function(e){return e.formData},a.generateUniqueIdentifier=function(e){var t=e.webkitRelativePath||e.relativePath||e.fileName||e.name;return T()(t+new Date)+t},a.onClick=function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},a.onFileUpload=function(){a.suppressAdds=!1,a.uploadInput.current.removeAttribute("webkitdirectory"),a.uploadInput.current.click()},a.onFolderUpload=function(){a.suppressAdds=!1,a.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory"),a.uploadInput.current.click()},a.onDragStart=function(){a.suppressAdds=!1,a.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory")},a.onCloseUploadDialog=function(){a.loaded=0,a.resumable.files=[],a.isUploadLinkLoaded=!1,a.setState({isUploadProgressDialogShow:!1,uploadFileList:[],forbidUploadFileList:[]}),w.Aq.registerGlobalVariable("uploader","isUploadProgressDialogShow",!1)},a.onUploadCancel=function(e){var t=a.state.uploadFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier||(t.cancel(),!1)}));a.resumable.isUploading()||(a.setState({totalProgress:100}),a.loaded=0),a.setState({uploadFileList:t})},a.onCancelAllUploading=function(){a.isCancellingAll=!0,a.uploadSession+=1,a.suppressAdds=!0;var e=a.state.uploadFileList.filter((function(e){return 1===Math.round(e.progress())}));try{a.resumable.cancel()}catch(t){}a.loaded=0,a.setState({totalProgress:100,uploadFileList:e}),a.isUploadLinkLoaded=!1,setTimeout((function(){a.isCancellingAll=!1}),0)},a.onUploadRetry=function(e){var t=a.props,n=t.token,i=t.relativePath;P.e.sharedLinkGetFileUploadUrl(n,i).then((function(t){a.resumable.opts.target=t.data.upload_link+"?ret-json=1";var n=a.state.retryFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier})),i=a.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(t.error=null,a.retryUploadFile(t)),t}));a.setState({retryFileList:n,uploadFileList:i})})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))},a.onUploadRetryAll=function(){var e=a.props,t=e.token,n=e.relativePath;P.e.sharedLinkGetFileUploadUrl(t,n).then((function(e){a.resumable.opts.target=e.data.upload_link+"?ret-json=1",a.state.retryFileList.forEach((function(e){e.error=!1,a.retryUploadFile(e)}));var t=a.state.uploadFileList.slice(0);a.setState({retryFileList:[],uploadFileList:t})})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))},a.retryUploadFile=function(e){var t=a.props,n=t.repoID,i=t.path,s=e.fileName;if(!(e.fileName===e.relativePath)){var o=e.formData.relative_path;s=("/"===i?i+o:i+"/"+o)+s}e.bootstrap();var r=!1;e.resumableObj.on("chunkingComplete",(function(){r||P.e.getFileUploadedBytes(n,i,s).then((function(t){var a=t.data.uploadedBytes,n=1024*parseInt(k.QVk)*1024||1048576,i=Math.floor(a/n);e.markChunksCompleted(i),e.resumableObj.upload()})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)})),r=!0}))},a.uploadFile=function(){var e=a.resumable.files[a.resumable.files.length-1],t=a.props,n=t.token,i=t.relativePath;P.e.sharedLinkGetFileUploadUrl(n,i).then((function(t){a.resumable.opts.target=t.data.upload_link+"?ret-json=1",a.setState({isUploadRemindDialogShow:!1,isUploadProgressDialogShow:!0,uploadFileList:[].concat((0,r.default)(a.state.uploadFileList),[e])},(function(){a.resumable.upload()})),w.Aq.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))},a.cancelFileUpload=function(){a.resumable.files.pop(),a.setState({isUploadRemindDialogShow:!1})},a.state={retryFileList:[],uploadFileList:[],forbidUploadFileList:[],totalProgress:0,isUploadProgressDialogShow:!1,isUploadRemindDialogShow:!1,currentResumableFile:null,uploadBitrate:0},a.uploadInput=p.createRef(),a.notifiedFolders=[],a.timestamp=null,a.loaded=0,a.bitrateInterval=500,window.onbeforeunload=a.onbeforeunload,a.isUploadLinkLoaded=!1,a.isCancellingAll=!1,a.uploadSession=0,a.suppressAdds=!1,a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){this.resumable=new(M())({target:"",query:this.setQuery||{},fileType:this.props.filetypes,maxFiles:void 0,maxFileSize:1e3*k.hnv*1e3||void 0,testMethod:this.props.testMethod||"post",testChunks:this.props.testChunks||!1,headers:this.setHeaders||{},withCredentials:this.props.withCredentials||!1,chunkSize:1024*parseInt(k.QVk)*1024||1048576,simultaneousUploads:this.props.simultaneousUploads||1,fileParameterName:this.props.fileParameterName,generateUniqueIdentifier:this.generateUniqueIdentifier,forceChunkSize:!0,maxChunkRetries:3,minFileSize:0}),this.resumable.assignBrowse(this.uploadInput.current,!0),!0===this.props.dragAndDrop&&this.resumable.enableDropOnDocument(),this.bindCallbackHandler(),this.bindEventHandler()}},{key:"render",value:function(){return(0,z.jsxs)(p.Fragment,{children:[(0,z.jsx)("div",{className:"file-uploader-container",children:(0,z.jsx)("div",{className:"file-uploader",children:(0,z.jsx)("input",{className:"upload-input",type:"file",ref:this.uploadInput,onClick:this.onClick,"aria-label":(0,k.APU)("Upload")})})}),this.state.isUploadProgressDialogShow&&(0,z.jsx)(G,{retryFileList:this.state.retryFileList,uploadFileList:this.state.uploadFileList,forbidUploadFileList:this.state.forbidUploadFileList,totalProgress:this.state.totalProgress,uploadBitrate:this.state.uploadBitrate,onCloseUploadDialog:this.onCloseUploadDialog,onCancelAllUploading:this.onCancelAllUploading,onUploadCancel:this.onUploadCancel,onUploadRetry:this.onUploadRetry,onUploadRetryAll:this.onUploadRetryAll,isUploading:this.resumable.isUploading()})]})}}])}(p.Component)),J=V,Z=a(8081),Q=a(10877),X=a(46882),W=a(6754),$=a(34322),ee=a(22695),te=a(20338),ae=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).onSaveSharedFile=function(){a.props.handleSaveSharedDir(a.state.repo.repo_id,a.state.selectedPath)},a.onDirentItemClick=function(e,t,n){"dir"===n.type?a.setState({repo:e,selectedPath:t}):a.setState({repo:null,selectedPath:""})},a.onRepoItemClick=function(e){a.setState({repo:e,selectedPath:"/"})},a.state={repo:null,selectedPath:"",errMessage:""},a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return(0,z.jsxs)(Z.A,{isOpen:!0,className:"sf-save-file",toggle:this.props.toggleCancel,children:[(0,z.jsx)(te.A,{toggle:this.props.toggleCancel,children:(0,k.APU)("Save to:")}),(0,z.jsxs)(Q.A,{children:[(0,z.jsx)(ee.A,{isShowFile:!1,onDirentItemClick:this.onDirentItemClick,onRepoItemClick:this.onRepoItemClick,mode:"only_all_repos"}),this.state.errMessage&&(0,z.jsx)(X.A,{color:"danger",children:this.state.errMessage})]}),(0,z.jsxs)(W.A,{children:[(0,z.jsx)($.A,{color:"secondary",onClick:this.props.toggleCancel,children:(0,k.APU)("Cancel")}),this.state.selectedPath?(0,z.jsx)($.A,{color:"primary",onClick:this.onSaveSharedFile,children:(0,k.APU)("Submit")}):(0,z.jsx)($.A,{color:"primary",disabled:!0,children:(0,k.APU)("Submit")})]})]})}}])}(p.Component),ne=a(88002),ie=a(93355),se=a(25531),oe=a(2949),re=a(75150),le=a(75299),de=a(72070),ce=function(){function e(t){t.path;var a=t.object,n=t.isLoaded,i=t.isPreload,s=t.isExpanded,o=t.parentNode;(0,l.default)(this,e),this.path=a.folder_path,this.object=a,this.isLoaded=n||!1,this.isPreload=i||!1,this.isExpanded=s||!1,this.children=[],this.parentNode=o||null}return(0,d.default)(e,[{key:"clone",value:function(t){var a=new e({path:this.path,object:this.object,isLoaded:this.isLoaded,isPreload:this.isPreload,isExpanded:this.isExpanded,parentNode:t||null});return a.children=this.children.map((function(e){return e.clone(a)})),a}},{key:"setParent",value:function(e){this.path=this.generatePath(e),this.parentNode=e,this.isLoaded=!1}},{key:"hasChildren",value:function(){return 0!==this.children.length}},{key:"addChild",value:function(e){e.setParent(this);var t=this.children;if(e.object.isDir())this.children.unshift(e);else{for(var a=-1,n=0;n<t.length;n++)if(!t[n].object.isDir()){a=n;break}-1===a?this.children.push(e):0===a?this.children.unshift(e):this.children.splice(a,0,e)}}},{key:"addChildren",value:function(e){var t=this;e.forEach((function(e){e.setParent(t)})),this.children=e}},{key:"deleteChild",value:function(e){var t=this.children.filter((function(t){return t!==e}));this.children=t}},{key:"rename",value:function(e){this.object.name=e,this.path=this.generatePath(this.parentNode),this.isExpanded?this.updateChildrenPath(this):this.isLoaded=!1}},{key:"updateChildrenPath",value:function(e){e.children.forEach((function(e){e.path=e.generatePath(e.parentNode),e.isExpanded?e.updateChildrenPath(e):e.isLoaded=!1}))}},{key:"updateObjectProperties",value:function(e,t){var a=this;Array.isArray(e)&&Array.isArray(t)?e.forEach((function(e,n){a.object[e]=t[n]})):this.object[e]=t}},{key:"generatePath",value:function(e){return this.path}},{key:"serializeToJson",value:function(){var e=[];return this.hasChildren&&(e=this.children.map((function(e){return e.serializeToJson()}))),{path:this.path,object:this.object.clone(),isLoaded:this.isLoaded,isPreload:this.isPreload,isExpanded:this.isExpanded,parentNode:this.parentNode,children:e}}}],[{key:"deserializefromJson",value:function(t){var a=t.path,n=t.object,i=t.isLoaded,s=t.isPreload,o=t.isExpanded,r=t.parentNode,l=t.children,d=void 0===l?[]:l;return new e({path:a,object:n=n.clone(),isLoaded:i,isPreload:s,isExpanded:o,parentNode:r,children:d.map((function(t){return e.deserializefromJson(t)}))})}}])}(),ue=function(){function e(){(0,l.default)(this,e),this.root=null}return(0,d.default)(e,[{key:"clone",value:function(){var t=new e;return this.root&&(t.root=this.root.clone()),t}},{key:"setRoot",value:function(e){this.root=e}},{key:"getNodeByPath",value:function(e){var t=null;return this.traverseDF((function(a){return a.path===e&&(t=a,!0)})),t}},{key:"getNodeChildrenObject",value:function(e){return e.children.map((function(e){return e.object}))}},{key:"addNodeToParent",value:function(e,t){t.addChild(e)}},{key:"addNodeListToParent",value:function(e,t){e.forEach((function(e){t.addChild(e)}))}},{key:"deleteNode",value:function(e){this.getNodeByPath(e.parentNode.path).deleteChild(e)}},{key:"deleteNodeList",value:function(e){var t=this;e.forEach((function(e){t.deleteNode(e)}))}},{key:"renameNode",value:function(e,t){e.rename(t)}},{key:"updateNode",value:function(e,t,a){e.updateObjectProperties(t,a)}},{key:"moveNode",value:function(e,t){this.deleteNode(e),t.addChild(e)}},{key:"copyNode",value:function(e,t){t.addChild(e)}},{key:"traverseDF",value:function(e){var t=[],a=!1;t.unshift(this.root);for(var n=t.shift();!a&&n;)(a=1==e(n))||(t.unshift.apply(t,(0,r.default)(n.children)),n=t.shift())}},{key:"traverseBF",value:function(e){var t=[],a=!1;t.push(this.root);for(var n=t.shift();!a&&n;)(a=!0===e(n))||(t.push.apply(t,(0,r.default)(n.children)),n=t.shift())}},{key:"expandNode",value:function(e){for(e.isExpanded=!0;e.parentNode;)e.parentNode.isExpanded=!0,e=e.parentNode}},{key:"collapseNode",value:function(e){e.isExpanded=!1}},{key:"isNodeChild",value:function(e,t){return t.children.some((function(t){return t.path===e.path}))}},{key:"serializeToJson",value:function(){return this.root.serializeToJson()}},{key:"deserializefromJson",value:function(t){var a=ce.deserializefromJson(t),n=new e;return n.setRoot(a),n}}])}(),pe=ue,he=function(){return(0,d.default)((function e(){(0,l.default)(this,e)}),[{key:"expandNode",value:function(e,t){e.expandNode(t)}},{key:"collapseNode",value:function(e,t){var a=e.clone();return t=a.getNodeByPath(t.path),a.collapseNode(t),a}},{key:"findNodeByPath",value:function(e,t){return e.clone().getNodeByPath(t)}},{key:"getNodeChildrenObject",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"asc",i=e.getNodeChildrenObject(t);return i=w.Aq.sortDirents(i,a,n)}},{key:"addNodeToParent",value:function(e,t,a){return e.addNodeToParentNode(t,a),e}},{key:"addNodeListToParent",value:function(e,t,a){return e.addNodeListToParent(t,a),e}},{key:"addNodeToParentByPath",value:function(e,t,a){var n=e.clone(),i=n.getNodeByPath(a);return n.addNodeToParent(t,i),n}},{key:"deleteNodeByPath",value:function(e,t){var a=e.clone(),n=a.getNodeByPath(t);return n&&a.deleteNode(n),a}},{key:"deleteNodeListByPaths",value:function(e,t){var a=e.clone();return t.forEach((function(e){var t=a.getNodeByPath(e);t&&a.deleteNode(t)})),a}},{key:"renameNodeByPath",value:function(e,t,a){var n=e.clone(),i=n.getNodeByPath(t);return i?(n.renameNode(i,a),n):n}},{key:"updateNodeByPath",value:function(e,t,a,n){var i=e.clone(),s=i.getNodeByPath(t);return i.updateNode(s,a,n),i}},{key:"moveNodeByPath",value:function(e,t,a,n){var i=e.clone(),s=i.getNodeByPath(t),o=i.getNodeByPath(a);return o&&s&&(s.object.name=n,i.moveNode(s,o)),!o&&s&&i.deleteNode(s),i}},{key:"moveNodeListByPaths",value:function(e,t,a){var n=e.clone(),i=n.getNodeByPath(a);return i?t.forEach((function(e){var t=n.getNodeByPath(e);n.moveNode(t,i)})):t.forEach((function(e){var t=n.getNodeByPath(e);n.delete(t)})),n}},{key:"copyNodeByPath",value:function(e,t,a,n){var i=e.clone(),s=i.getNodeByPath(a),o=i.getNodeByPath(t);if(s){var r=o.clone();r.object.name=n,i.copyNode(r,s)}return i}},{key:"copyNodeListByPaths",value:function(e,t,a){var n=e.clone(),i=n.getNodeByPath(a);return i&&t.forEach((function(e){var t=n.getNodeByPath(e);n.copyNode(t,i)})),n}},{key:"buildTree",value:function(){var e=new pe,t=new ce({object:{folder_path:"/",is_dir:!0},isLoaded:!1,isExpanded:!0});return e.setRoot(t),e}}])}(),me=new he,fe=a(45613),ge=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).onMouseEnter=function(){a.setState({isHighlight:!0})},a.onMouseOver=function(){a.setState({isHighlight:!0})},a.onMouseLeave=function(){a.setState({isHighlight:!1})},a.onNodeClick=function(){var e=a.props.node;a.props.onNodeClick(e)},a.onLoadToggle=function(e){e.stopPropagation();var t=a.props.node;t.isExpanded?a.props.onNodeCollapse(t):a.props.onNodeExpanded(t)},a.getNodeTypeAndIcon=function(){var e=a.props.node,t="",n="";if(e.object.is_dir)t=(0,z.jsx)(O.A,{symbol:"folder"}),n="dir";else{var i=e.object.file_name.lastIndexOf(".");if(-1===i)t=(0,z.jsx)(O.A,{symbol:"file"}),n="file";else{var s=e.object.file_name.slice(i).toLowerCase();".png"===s||".jpg"===s||".jpeg"===s||".gif"===s||".bmp"===s?(t=(0,z.jsx)(O.A,{symbol:"gallery"}),n="image"):".md"===s||".markdown"===s?(t=(0,z.jsx)(O.A,{symbol:"files"}),n="file"):(t=(0,z.jsx)(O.A,{symbol:"file"}),n="file")}}return{icon:t,type:n}},a.renderChildren=function(){var e=a.props.node;return e.hasChildren()?(0,z.jsx)("div",{className:"children",children:e.children.map((function(e,n){return(0,z.jsx)(t,{node:e,leftIndent:a.props.leftIndent+20,currentPath:a.props.currentPath,onNodeClick:a.props.onNodeClick,onNodeCollapse:a.props.onNodeCollapse,onNodeExpanded:a.props.onNodeExpanded},n)}))}):""},a.state={isHighlight:!1},a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.currentPath,a=e.node,n=e.leftIndent,i=this.getNodeTypeAndIcon(),s=i.type,o=i.icon,r=this.state.isHighlight?"tree-node-inner-hover":"";a.path===t&&(r="tree-node-hight-light");var l=a.object.folder_name||a.object.file_name;return(0,z.jsxs)("div",{className:"tree-node",children:[(0,z.jsxs)("div",{type:s,className:"tree-node-inner text-nowrap ".concat(r," ").concat("/"===a.path?"hide":""),title:l,onMouseEnter:this.onMouseEnter,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,onClick:this.onNodeClick,tabIndex:0,role:"treeitem","aria-selected":a.path==t,onKeyDown:w.Aq.onKeyDown,children:[(0,z.jsx)("div",{className:"tree-node-text",style:{paddingLeft:n+5},children:l}),(0,z.jsxs)("div",{className:"left-icon",style:{left:n-40},children:["dir"===s&&(!a.isLoaded||a.isLoaded&&a.hasChildren())&&(0,z.jsx)(fe.A,{className:"folder-toggle-icon ".concat(a.isExpanded?"":"rotate-270"),symbol:"down",title:a.isExpanded?(0,k.APU)("Fold"):(0,k.APU)("Unfold"),onMouseDown:function(e){return e.stopPropagation()},op:this.onLoadToggle}),(0,z.jsx)("i",{className:"tree-node-icon",children:o})]})]}),a.isExpanded&&this.renderChildren()]})}}])}(p.Component),ve=function(e){function t(){return(0,l.default)(this,t),(0,c.default)(this,t,arguments)}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return(0,z.jsx)("div",{className:"tree-view tree",children:(0,z.jsx)(ge,{leftIndent:20,node:this.props.treeData.root,currentPath:this.props.currentPath,onNodeClick:this.props.onNodeClick,onNodeExpanded:this.props.onNodeExpanded,onNodeCollapse:this.props.onNodeCollapse})})}}])}(p.Component),xe=ve,be=a(91447),je=a(47842),ye=a(14522),Ae=a(49434),Se=a(82046);a(16322),a(75243),a(47100);b().locale(window.app.config.lang),b().extend(S());var Ne=window.app.pageOptions.name,ke=window.shared.pageOptions,we=ke.token,Pe=ke.dirName,Fe=ke.sharedBy,Ce=ke.repoID,Ue=ke.relativePath,De=ke.mode,Ie=ke.thumbnailSize,Le=ke.trafficOverLimit,Me=ke.canDownload,_e=ke.noQuota,Te=ke.canUpload,Oe=ke.enableVideoThumbnail,ze=ke.enablePDFThumbnail,Ee=!Le&&Me,Re=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).loadTreePanel=function(){P.e.listSharedDir(we,"/",Ie).then((function(e){var t=e.data.dirent_list,n=a.state.treeData;a.addResponseListToNode(t,n.root),a.setState({isTreeDataLoading:!1,treeData:n})})).catch((function(){a.setState({isTreeDataLoading:!1})}))},a.addResponseListToNode=function(e,t){t.isLoaded=!0,t.isExpanded=!0;var n=e.filter((function(e){return e.is_dir})),i=w.Aq.sortDirentsInSharedDir(n,a.state.sortBy,a.state.sortOrder).map((function(e){return new ce({object:e})}));t.addChildren(i)},a.listItems=function(){var e=a.state,t=e.path,n=e.currentMode,i=n==oe.Tb?k.dqD:k.HJr;a.setState({isLoading:!0}),P.e.listSharedDir(we,t,i).then((function(e){var t=e.data.dirent_list.map((function(e){return e.isSelected=!1,e})),n=e.data.dir_path;a.setState({isLoading:!1,errorMsg:"",items:w.Aq.sortDirentsInSharedDir(t,a.state.sortBy,a.state.sortOrder),dirPath:n},(function(){a.getThumbnails(i)}))})).catch((function(e){var t=w.Aq.getErrorMsg(e);a.setState({isLoading:!1,errorMsg:t})}));var s="";s="/"==t?t:"/"===t[t.length-1]?t.slice(0,t.length-1):t;var o=new URL(location.href),r=new URLSearchParams(o.search);r.set("p",s),r.set("mode",n),o.search=r.toString(),o=o.toString(),window.history.pushState({url:o,path:t},t,o)},a.sortItems=function(e,t){a.setState({sortBy:e,sortOrder:t,items:w.Aq.sortDirentsInSharedDir(a.state.items,e,t)})},a.getThumbnails=function(e){var t=a.state.items.filter((function(e){return!e.is_dir&&(w.Aq.imageCheck(e.file_name)||Oe&&w.Aq.videoCheck(e.file_name)||ze&&w.Aq.pdfCheck(e.file_name))&&!e.encoded_thumbnail_src}));if(0!=t.length){var n=t.length,i=a,s=function(a){var o=t[a];P.e.getShareLinkThumbnail(we,o.file_path,e).then((function(e){o.encoded_thumbnail_src=e.data.encoded_thumbnail_src})).catch((function(e){})).then((function(){a<n-1?s(++a):i.setState({items:i.state.items})}))};s(0)}},a.toggleDropdownMenu=function(){a.setState({isDropdownMenuOpen:!a.state.isDropdownMenuOpen})},a.visitFolder=function(e){a.setState({path:e},(function(){a.listItems()}))},a.renderPath=function(){var e=[];Ee&&(e.push({icon:"download",text:(0,k.APU)("ZIP"),onClick:a.zipDownloadFolder.bind(a,a.state.path)}),Me&&Ne&&Ne!==Fe&&e.push({icon:"save",text:(0,k.APU)("Save"),onClick:a.saveAllItems})),Te&&(e.push({icon:"upload-files",disabled:_e,title:_e?(0,k.APU)("The owner of this library has run out of space."):"",text:(0,k.APU)("Upload Files"),onClick:a.onUploadFile}),e.push({icon:"upload-folder",disabled:_e,title:_e?(0,k.APU)("The owner of this library has run out of space."):"",text:(0,k.APU)("Upload Folder"),onClick:a.onUploadFolder}));var t=[],n={path:"/",name:Pe};t.push(n);var i=a.state.path;if("/"!=i){var s=("/"===i[i.length-1]?i.slice(0,i.length-1):i).split("/");s.shift();var o="",l=s.map((function(e,t){return{path:(o+="/"+e)+"/",name:e}}));t.push.apply(t,(0,r.default)(l))}return(0,z.jsxs)(p.Fragment,{children:[t.map((function(e,n){return n!=t.length-1?(0,z.jsxs)(p.Fragment,{children:[(0,z.jsx)("span",{className:"path-item",title:e.name,role:"button",tabIndex:0,onClick:a.visitFolder.bind(a,e.path),onKeyDown:w.Aq.onKeyDown,children:e.name}),(0,z.jsx)("span",{className:"path-split",children:" / "})]},n):null})),Ee||Te?(0,z.jsxs)(m.A,{isOpen:a.state.isDropdownMenuOpen,toggle:a.toggleDropdownMenu,children:[(0,z.jsxs)(f.A,{tag:"div",role:"button",tabIndex:0,className:"path-item path-item-dropdown-toggle",onClick:a.toggleDropdownMenu,onKeyDown:w.Aq.onKeyDown,"data-toggle":"dropdown",children:[(0,z.jsx)("span",{title:t[t.length-1].name,children:t[t.length-1].name}),Te?(0,z.jsxs)("span",{className:"d-flex align-items-center",children:[(0,z.jsx)(O.A,{symbol:"new",className:"main-icon ml-2"}),(0,z.jsx)(O.A,{symbol:"down"})]}):(0,z.jsx)(O.A,{symbol:"down",className:"ml-1"})]}),(0,z.jsx)(g.A,{className:"position-fixed",children:e.map((function(e,t){return"Divider"==e?(0,z.jsx)(v.A,{divider:!0},t):(0,z.jsxs)(v.A,{className:"d-flex align-items-center",onClick:e.onClick,disabled:e.disabled||!1,title:e.title||"",children:[(0,z.jsx)(O.A,{symbol:e.icon,className:"dropdown-item-icon mr-2"}),e.text]},t)}))})]}):(0,z.jsx)("span",{className:"path-item",title:t[t.length-1].name,children:t[t.length-1].name})]})},a.zipDownloadFolder=function(e){k.B$7?P.e.getShareLinkZipTask(we,e).then((function(e){var t=e.data.zip_token;location.href="".concat(k.IX4,"zip/").concat(t)})).catch((function(e){var t=w.Aq.getErrorMsg(e);a.setState({isLoading:!1,errorMsg:t})})):a.setState({isZipDialogOpen:!0,zipFolderPath:e})},a.zipDownloadSelectedItems=function(){var e=a.state.path,t=a.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}));k.B$7?P.e.getShareLinkDirentsZipTask(we,e,t).then((function(e){var t=e.data.zip_token;location.href="".concat(k.IX4,"zip/").concat(t)})).catch((function(e){var t=w.Aq.getErrorMsg(e);a.setState({isLoading:!1,errorMsg:t})})):a.setState({isZipDialogOpen:!0,zipFolderPath:e,selectedItems:t})},a.saveSelectedItems=function(){a.setState({isSaveSharedDirDialogShow:!0,itemsForSave:a.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},a.saveAllItems=function(){a.setState({isSaveSharedDirDialogShow:!0,itemsForSave:a.state.items.map((function(e){return e.file_name||e.folder_name}))})},a.toggleSaveSharedDirCancel=function(){a.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[]})},a.handleSaveSharedDir=function(e,t){var n=a.state,i=n.path,s=n.itemsForSave;P.e.saveSharedDir(e,t,we,i,s).then((function(e){a.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[],isCopyMoveProgressDialogShow:!0,asyncCopyMoveTaskId:e.data.task_id,asyncOperatedFilesLength:s.length},(function(){a.getAsyncCopyMoveProgress()}))})).catch((function(e){var t=w.Aq.getErrorMsg(e);a.setState({errMessage:t})}))},a.onProgressDialogToggle=function(){if(100!==a.state.asyncOperationProgress){var e=a.state.asyncCopyMoveTaskId;P.e.cancelCopyMoveOperation(e)}a.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1})},a.closeZipDialog=function(){a.setState({isZipDialogOpen:!1,zipFolderPath:"",selectedItems:[]})},a.prepareImageItem=function(e){var t,a=e.file_name,n=e.last_modified,i="gif"==a.substr(a.lastIndexOf(".")+1).toLowerCase(),s="".concat(k.YcY,"d/").concat(we,"/files/?p=").concat(encodeURIComponent(e.file_path));return t=i?"".concat(s,"&raw=1"):"".concat(k.YcY,"thumbnail/").concat(we,"/").concat(k.oCM).concat(w.Aq.encodePath(e.file_path),"?mtime=").concat(n),{name:a,url:s,parentDir:e.file_path.slice(0,e.file_path.indexOf(a)),thumbnail:"".concat(k.YcY,"thumbnail/").concat(we,"/").concat(k.oCM).concat(w.Aq.encodePath(e.file_path),"?mtime=").concat(n),src:t,downloadURL:s+"&dl=1"}},a.showImagePopup=function(e){var t=a.state.items.filter((function(e){return!e.is_dir&&w.Aq.imageCheck(e.file_name)})),n=t.map((function(e){return a.prepareImageItem(e)}));a.setState({isImagePopupOpen:!0,imageItems:n,imageIndex:t.indexOf(e)})},a.closeImagePopup=function(){a.setState({isImagePopupOpen:!1})},a.moveToPrevImage=function(){var e=a.state.imageItems.length;a.setState((function(t){return{imageIndex:(t.imageIndex+e-1)%e}}))},a.moveToNextImage=function(){var e=a.state.imageItems.length;a.setState((function(t){return{imageIndex:(t.imageIndex+1)%e}}))},a.unselectItems=function(){a.setState({isAllItemsSelected:!1,items:a.state.items.map((function(e){return e.isSelected=!1,e}))})},a.toggleAllSelected=function(){a.setState((function(e){return{isAllItemsSelected:!e.isAllItemsSelected,items:a.state.items.map((function(t){return t.isSelected=!e.isAllItemsSelected,t}))}}))},a.toggleItemSelected=function(e,t){a.setState({items:a.state.items.map((function(a){return a===e&&(a.isSelected=t),a}))},(function(){a.setState({isAllItemsSelected:!a.state.items.some((function(e){return!e.isSelected}))})}))},a.onUploadFile=function(e){e.nativeEvent.stopImmediatePropagation(),a.uploader.onFileUpload()},a.onUploadFolder=function(e){e.nativeEvent.stopImmediatePropagation(),a.uploader.onFolderUpload()},a.onFileUploadSuccess=function(e){var t=e.name,n=e.type,i=e.size,s=e.mtime;if(a.state.items.some((function(e){return("dir"===n?e.folder_name:e.file_name)===t&&e.is_dir===("dir"===n)}))){var r=a.state.items.map((function(e){return("dir"===n?e.folder_name:e.file_name)===t&&e.is_dir===("dir"===n)?(0,o.default)((0,o.default)({},e),{},{last_modified:b().unix(s).format()}):e}));a.setState({items:r})}else{var l="dir"===n?{isSelected:!1,folder_name:t,folder_path:w.Aq.joinPath(Ue,t)+"/",is_dir:!0,last_modified:b().unix(s).format()}:{isSelected:!1,file_name:t,file_path:w.Aq.joinPath(Ue,t),is_dir:!1,last_modified:b().unix(s).format(),size:i};a.setState((function(e){var t=Array.from(e.items);if("dir"===n)t.unshift(l),a.listItems(),a.loadTreePanel();else{var i=t.filter((function(e){return e.is_dir}));t.splice(i.length,0,l)}return{items:t}}))}P.e.shareLinksUploadDone(we,w.Aq.joinPath(a.state.dirPath,t),"dir"===n)},a.getShareLinkRepoTags=function(){P.e.getShareLinkRepoTags(we).then((function(e){var t=[];e.data.repo_tags.forEach((function(e){var a=new se.A(e);a.fileCount>0&&t.push(a)})),a.setState({usedRepoTags:t})})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))},a.switchMode=function(e){e!=a.state.currentMode&&a.setState({currentMode:e},(function(){a.listItems()}))},a.onSelectSortOption=function(e){var t=e.value.split("-"),n=(0,s.default)(t,2),i=n[0],o=n[1];a.sortItems(i,o)},a.onTreeNodeCollapse=function(e){var t=me.collapseNode(a.state.treeData,e);a.setState({treeData:t})},a.onTreeNodeExpanded=function(e){var t=a.state.treeData.clone();(e=t.getNodeByPath(e.path)).isLoaded?(t.expandNode(e),a.setState({treeData:t})):P.e.listSharedDir(we,e.path,Ie).then((function(n){var i=n.data.dirent_list;a.addResponseListToNode(i,e),a.setState({treeData:t})})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))},a.onTreeNodeClick=function(e){if(e.object.is_dir){if(e.isLoaded&&e.path===a.state.path)if(e.isExpanded){var t=me.collapseNode(a.state.treeData,e);a.setState({treeData:t})}else{var n=a.state.treeData.clone();e=n.getNodeByPath(e.path),n.expandNode(e),a.setState({treeData:n})}if(!e.isLoaded){var i=a.state.treeData.clone();e=i.getNodeByPath(e.path),P.e.listSharedDir(we,e.path,Ie).then((function(t){var n=t.data.dirent_list;a.addResponseListToNode(n,e),i.collapseNode(e),a.setState({treeData:i})})).catch((function(e){var t=w.Aq.getErrorMsg(e);C.A.danger(t)}))}if(e.path===a.state.path)return;a.visitFolder(e.path)}},a.onResizeMouseUp=function(){a.state.inResizing&&a.setState({inResizing:!1}),localStorage.setItem("sf_side_panel_rate",a.state.sidePanelRate)},a.onResizeMouseDown=function(){a.setState({inResizing:!0})},a.onResizeMouseMove=function(e){var t=e.nativeEvent.clientX/window.innerWidth;a.setState({sidePanelRate:Math.max(Math.min(t,ye.Rx),ye.Pf)})},a.onResizeMouseOver=function(e){if(a.dragHandlerRef.current){var t=a.resizeBarRef.current.getBoundingClientRect().top,n=e.pageY-t-ye.gO/2;a.setDragHandlerTop(n)}},a.setDragHandlerTop=function(e){a.dragHandlerRef.current.style.top=e+"px"},a.state={isTreeDataLoading:!0,treeData:me.buildTree(),inResizing:!1,sidePanelRate:parseFloat(localStorage.getItem("sf_side_panel_rate")||ye.nT),isLoading:!0,errorMsg:"",items:[],path:Ue,dirPath:"",isDropdownMenuOpen:!1,currentMode:De,isAllItemsSelected:!1,selectedItems:[],sortBy:"name",sortOrder:"asc",zipFolderPath:"",usedRepoTags:[],isSaveSharedDirDialogShow:!1,itemsForSave:[],asyncCopyMoveTaskId:"",asyncOperationProgress:0,asyncOperatedFilesLength:0,isCopyMoveProgressDialogShow:!1,isImagePopupOpen:!1,imageItems:[],imageIndex:0},a.resizeBarRef=p.createRef(),a.dragHandlerRef=p.createRef(),a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){Le&&C.A.danger((0,k.APU)("File download is disabled: the share link traffic of owner is used up."),{duration:3}),this.loadTreePanel(),this.listItems(),this.getShareLinkRepoTags()}},{key:"getAsyncCopyMoveProgress",value:function(){var e=(0,i.default)((0,n.A)().mark((function e(){var t,a,i,s,o,r;return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.asyncCopyMoveTaskId,e.prev=1,e.next=4,P.e.queryAsyncOperationProgress(t);case 4:if(a=e.sent,!(i=a.data).failed){e.next=11;break}return s=(0,k.APU)("Failed to copy files to another library."),C.A.danger(s),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),e.abrupt("return");case 11:if(!i.successful){e.next=16;break}return this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),o=(0,k.APU)("Successfully copied files to another library."),C.A.success(o),e.abrupt("return");case 16:r=i.total?parseInt((i.done/i.total*100).toFixed(2)):0,this.getAsyncCopyMoveProgress(),this.setState({asyncOperationProgress:r}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1});case 24:case"end":return e.stop()}}),e,this,[[1,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.usedRepoTags,n=t.currentMode,i=t.sortBy,s=t.sortOrder,o=t.isTreeDataLoading,r=t.treeData,l=t.path,d=t.sidePanelRate,c=t.inResizing,u=t.dirPath,p={userSelect:c?"none":"",flex:d?"1 0 ".concat(100*(1-d),"%"):"0 0 ".concat(100-100*ye.nT,"%")},h={userSelect:c?"none":"",flex:"0 0 ".concat(d?100*d:100*ye.nT,"%")},m=w.Aq.isDesktop(),f=this.state.items.filter((function(e){return e.isSelected})).length,g=m&&"/"==l&&0!=a.length;return(0,z.jsxs)(re.Tx,{repoID:Ce,enableMetadata:!1,repoInfo:{permission:"r"},children:[(0,z.jsxs)("div",{id:"shared-dir-view",className:"h-100 d-flex flex-column",children:[(0,z.jsxs)("div",{className:"top-header d-flex justify-content-between flex-shrink-0",children:[(0,z.jsx)("a",{href:k.YcY,children:(0,z.jsx)("img",{src:k.SGU+k.VIO,height:k.hMI,width:k.gAF,title:k.q0L,alt:"logo"})}),Ne&&(0,z.jsx)(N.A,{})]}),(0,z.jsxs)("div",{className:"flex-fill d-flex o-hidden position-relative",onMouseMove:c?this.onResizeMouseMove:null,onMouseUp:this.onResizeMouseUp,children:[(0,z.jsxs)("div",{className:"side-panel",style:h,children:[(0,z.jsxs)("div",{className:"meta-info py-4 mx-4",children:[(0,z.jsx)("h2",{className:"h3 text-truncate mb-4",title:Pe,children:Pe}),(0,z.jsxs)("p",{className:"m-0",children:[(0,k.APU)("Shared by: "),Fe]})]}),(0,z.jsx)("div",{className:"p-4 flex-fill o-auto",children:o?(0,z.jsx)(F.A,{}):(0,z.jsx)(xe,{currentPath:l,treeData:r,onNodeExpanded:this.onTreeNodeExpanded,onNodeCollapse:this.onTreeNodeCollapse,onNodeClick:this.onTreeNodeClick})})]}),m&&(0,z.jsx)(be.A,{resizeBarRef:this.resizeBarRef,dragHandlerRef:this.dragHandlerRef,resizeBarStyle:{left:"calc(".concat(d?100*d+"%":"".concat(100*ye.nT,"%")," - 1px)")},dragHandlerStyle:{height:ye.gO},onResizeMouseDown:this.onResizeMouseDown,onResizeMouseOver:this.onResizeMouseOver}),(0,z.jsxs)("div",{className:"main-panel cur-view-container",style:p,children:[(0,z.jsxs)("div",{className:"cur-view-path d-flex justify-content-between align-items-center",children:[(0,z.jsx)("div",{className:"cur-view-path-left flex-fill o-hidden",children:Ee&&this.state.items.some((function(e){return e.isSelected}))?(0,z.jsxs)("div",{className:"selected-items-toolbar",children:[(0,z.jsxs)(Se.A,{className:"cur-view-path-btn px-1",title:(0,k.APU)("Unselect"),op:this.unselectItems,children:[(0,z.jsx)(O.A,{symbol:"close",className:"mr-2"}),(0,z.jsx)("span",{children:"".concat(f," ").concat((0,k.APU)("selected"))})]}),(0,z.jsx)(fe.A,{className:"cur-view-path-btn ml-4",symbol:"download",title:(0,k.APU)("Download"),op:this.zipDownloadSelectedItems}),Me&&Ne&&Ne!==Fe&&(0,z.jsx)(fe.A,{className:"cur-view-path-btn ml-4",symbol:"save",op:this.saveSelectedItems,title:(0,k.APU)("Save")})]}):(0,z.jsxs)("div",{className:"path-container",children:[(0,z.jsx)("span",{className:"mr-2",children:(0,k.APU)("Current path: ")}),this.renderPath()]})}),m&&(0,z.jsxs)("div",{className:"cur-view-path-right ml-4",children:[(0,z.jsx)(le.A,{currentViewMode:n,switchViewMode:this.switchMode}),(0,z.jsx)(de.A,{className:"ml-2",sortBy:i,sortOrder:s,onSelectSortOption:this.onSelectSortOption})]})]}),!_e&&Te&&(0,z.jsx)(J,{ref:function(t){return e.uploader=t},dragAndDrop:!1,token:we,path:"/"===u?u:u.replace(/\/+$/,""),relativePath:"/"===l?l:l.replace(/\/+$/,""),repoID:Ce,onFileUploadSuccess:this.onFileUploadSuccess}),(0,z.jsxs)("div",{className:"cur-view-content p-0",children:[g&&(0,z.jsx)(ie.A,{repoID:Ce,currentPath:"/",usedRepoTags:this.state.usedRepoTags,shareLinkToken:we,enableFileDownload:Ee}),(0,z.jsx)(qe,{isDesktop:m,isLoading:this.state.isLoading,errorMsg:this.state.errorMsg,mode:n,items:this.state.items,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortItems:this.sortItems,isAllItemsSelected:this.state.isAllItemsSelected,toggleAllSelected:this.toggleAllSelected,toggleItemSelected:this.toggleItemSelected,visitFolder:this.visitFolder,zipDownloadFolder:this.zipDownloadFolder,showImagePopup:this.showImagePopup})]})]})]})]}),this.state.isZipDialogOpen&&(0,z.jsx)(U.A,{children:(0,z.jsx)(D.A,{token:we,path:this.state.zipFolderPath,target:this.state.selectedItems,toggleDialog:this.closeZipDialog})}),this.state.isSaveSharedDirDialogShow&&(0,z.jsx)(ae,{sharedToken:we,parentDir:l,items:this.state.itemsForSave,toggleCancel:this.toggleSaveSharedDirCancel,handleSaveSharedDir:this.handleSaveSharedDir}),this.state.isCopyMoveProgressDialogShow&&(0,z.jsx)(ne.A,{type:"copy",asyncOperatedFilesLength:this.state.asyncOperatedFilesLength,asyncOperationProgress:this.state.asyncOperationProgress,toggleDialog:this.onProgressDialogToggle}),this.state.isImagePopupOpen&&(0,z.jsx)(U.A,{children:(0,z.jsx)(I.A,{repoID:Ce,repoInfo:{permission:"r"},imageItems:this.state.imageItems,imageIndex:this.state.imageIndex,closeImagePopup:this.closeImagePopup,moveToPrevImage:this.moveToPrevImage,moveToNextImage:this.moveToNextImage,enableRotate:!1,isCustomPermission:!0})})]})}}])}(p.Component),qe=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).sortByName=function(e){e.preventDefault();var t="asc"==a.props.sortOrder?"desc":"asc";a.props.sortItems("name",t)},a.sortByTime=function(e){e.preventDefault();var t="asc"==a.props.sortOrder?"desc":"asc";a.props.sortItems("time",t)},a.sortBySize=function(e){e.preventDefault();var t="asc"==a.props.sortOrder?"desc":"asc";a.props.sortItems("size",t)},a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.isDesktop,n=t.isLoading,i=t.errorMsg,s=t.mode,o=t.items,r=t.sortBy,l=t.sortOrder,d=t.isAllItemsSelected;if(n)return(0,z.jsx)(F.A,{});if(i)return(0,z.jsx)("p",{className:"error mt-6 text-center",children:i});var c=(0,z.jsx)("tbody",{children:o.map((function(t,n){return(0,z.jsx)(Be,{isDesktop:a,mode:s,item:t,visitFolder:e.props.visitFolder,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup,toggleItemSelected:e.props.toggleItemSelected},n)}))});if(!a)return(0,z.jsxs)("table",{className:"table-hover table-thead-hidden",children:[(0,z.jsx)("thead",{children:(0,z.jsxs)("tr",{children:[(0,z.jsx)("th",{width:"12%"}),(0,z.jsx)("th",{width:"80%"}),(0,z.jsx)("th",{width:"8%"})]})}),c]});var u=(0,z.jsx)("span",{className:"d-flex align-items-center ml-1",children:(0,z.jsx)(O.A,{symbol:"down",className:"asc"==l?"rotate-180":""})});return s==oe.Tb?(0,z.jsx)("div",{className:"table-container",children:(0,z.jsxs)("table",{className:"table-hover",children:[(0,z.jsx)("thead",{children:(0,z.jsxs)("tr",{children:[Ee&&(0,z.jsx)("th",{width:"3%",className:"text-center",children:(0,z.jsx)("input",{type:"checkbox",className:"form-check-input",checked:d,onChange:this.props.toggleAllSelected,onKeyDown:w.Aq.onKeyDown})}),(0,z.jsx)("th",{width:"5%"}),(0,z.jsx)("th",{width:Ee?"50%":"53%",children:(0,z.jsxs)("a",{className:"d-flex align-items-center table-sort-op",href:"#",onClick:this.sortByName,children:[(0,k.APU)("Name")," ","name"==r&&u]})}),(0,z.jsx)("th",{width:"8%"}),(0,z.jsx)("th",{width:"14%",children:(0,z.jsxs)("a",{className:"d-flex align-items-center table-sort-op",href:"#",onClick:this.sortBySize,children:[(0,k.APU)("Size")," ","size"==r&&u]})}),(0,z.jsx)("th",{width:"13%",children:(0,z.jsxs)("a",{className:"d-flex align-items-center table-sort-op",href:"#",onClick:this.sortByTime,children:[(0,k.APU)("Last Update")," ","time"==r&&u]})}),(0,z.jsx)("th",{width:"7%"})]})}),c]})}):(0,z.jsx)("ul",{className:"grid-view",children:o.map((function(t,a){return(0,z.jsx)(He,{mode:s,item:t,visitFolder:e.props.visitFolder,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup},a)}))})}}])}(p.Component),Be=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).toggleOpMenu=function(){a.setState({isOpMenuOpen:!a.state.isOpMenuOpen})},a.handleMouseOver=function(){a.setState({isHighlighted:!0,isIconShown:!0})},a.handleMouseOut=function(){a.setState({isHighlighted:!1,isIconShown:!1})},a.zipDownloadFolder=function(){a.props.zipDownloadFolder.bind(a,a.props.item.folder_path)()},a.handleFileClick=function(e){var t=a.props.item;w.Aq.imageCheck(t.file_name)&&(e.preventDefault(),a.props.showImagePopup(t))},a.toggleItemSelected=function(e){a.props.toggleItemSelected(a.props.item,e.target.checked)},a.onFolderItemClick=function(e){e.preventDefault();var t=a.props.item.folder_path;a.props.visitFolder(t)},a.state={isHighlighted:!1,isIconShown:!1,isOpMenuOpen:!1},a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.isDesktop,n=e.mode,i=this.state,s=i.isIconShown,o=i.isHighlighted;if(t.is_dir)return a?(0,z.jsxs)("tr",{className:y()({"tr-highlight":o}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Ee&&(0,z.jsx)("td",{className:"text-center",children:(0,z.jsx)("input",{type:"checkbox",className:"form-check-input",checked:t.isSelected,onChange:this.toggleItemSelected,onKeyDown:w.Aq.onKeyDown})}),(0,z.jsx)("td",{className:"text-center",children:(0,z.jsx)("img",{src:w.Aq.getFolderIconUrl(),alt:"",width:"24"})}),(0,z.jsx)("td",{children:(0,z.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(n),onClick:this.onFolderItemClick,children:t.folder_name})}),(0,z.jsx)("td",{}),(0,z.jsx)("td",{}),(0,z.jsx)("td",{title:(0,Ae.l)(t.last_modified),children:b()(t.last_modified).fromNow()}),(0,z.jsx)("td",{children:Ee&&(0,z.jsx)(fe.A,{className:"op-icon ".concat(s?"":" invisible"),symbol:"download",title:(0,k.APU)("Download"),op:this.zipDownloadFolder})})]}):(0,z.jsxs)("tr",{children:[(0,z.jsx)("td",{className:"text-center",children:(0,z.jsx)("img",{src:w.Aq.getFolderIconUrl(),alt:"",width:"24"})}),(0,z.jsxs)("td",{children:[(0,z.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(n),onClick:this.onFolderItemClick,children:t.folder_name}),(0,z.jsx)("br",{}),(0,z.jsx)("span",{className:"item-meta-info",children:b()(t.last_modified).fromNow()})]}),(0,z.jsx)("td",{children:Ee&&(0,z.jsx)(je.A,{children:(0,z.jsx)(v.A,{className:"mobile-menu-item",onClick:this.zipDownloadFolder,children:(0,k.APU)("Download")})})})]});var r="".concat(k.YcY,"d/").concat(we,"/files/?p=").concat(encodeURIComponent(t.file_path)),l=t.encoded_thumbnail_src?"".concat(k.YcY).concat(t.encoded_thumbnail_src,"?mtime=").concat(t.last_modified):"";return a?(0,z.jsxs)("tr",{className:y()({"tr-highlight":o}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Ee&&(0,z.jsx)("td",{className:"text-center",children:(0,z.jsx)("input",{type:"checkbox",className:"form-check-input",checked:t.isSelected,onChange:this.toggleItemSelected,onKeyDown:w.Aq.onKeyDown})}),(0,z.jsx)("td",{className:"text-center",children:l?(0,z.jsx)("img",{className:"thumbnail",src:l,alt:""}):(0,z.jsx)("img",{src:w.Aq.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,z.jsx)("td",{children:(0,z.jsx)("a",{href:r,onClick:this.handleFileClick,children:t.file_name})}),(0,z.jsx)("td",{className:"tag-list-title"}),(0,z.jsx)("td",{children:w.Aq.bytesToSize(t.size)}),(0,z.jsx)("td",{title:(0,Ae.l)(t.last_modified),children:b()(t.last_modified).fromNow()}),(0,z.jsx)("td",{children:Ee&&(0,z.jsx)("a",{className:"op-icon ".concat(s?"":" invisible"),href:"".concat(r,"&dl=1"),title:(0,k.APU)("Download"),"aria-label":(0,k.APU)("Download"),children:(0,z.jsx)(O.A,{symbol:"download"})})})]}):(0,z.jsxs)("tr",{children:[(0,z.jsx)("td",{className:"text-center",children:l?(0,z.jsx)("img",{className:"thumbnail",src:l,alt:""}):(0,z.jsx)("img",{src:w.Aq.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,z.jsxs)("td",{children:[(0,z.jsx)("a",{href:r,onClick:this.handleFileClick,children:t.file_name}),(0,z.jsx)("br",{}),(0,z.jsx)("span",{className:"item-meta-info",children:w.Aq.bytesToSize(t.size)}),(0,z.jsx)("span",{className:"item-meta-info",children:b()(t.last_modified).fromNow()})]}),(0,z.jsx)("td",{children:Ee&&(0,z.jsx)(je.A,{children:(0,z.jsx)(v.A,{className:"mobile-menu-item",tag:"a",href:"".concat(r,"&dl=1"),children:(0,k.APU)("Download")})})})]})}}])}(p.Component),He=function(e){function t(e){var a;return(0,l.default)(this,t),(a=(0,c.default)(this,t,[e])).handleMouseOver=function(){a.setState({isIconShown:!0})},a.handleMouseOut=function(){a.setState({isIconShown:!1})},a.zipDownloadFolder=function(){a.props.zipDownloadFolder.bind(a,a.props.item.folder_path)()},a.handleFileClick=function(e){var t=a.props.item;w.Aq.imageCheck(t.file_name)&&(e.preventDefault(),a.props.showImagePopup(t))},a.onFolderItemClick=function(e){e.preventDefault();var t=a.props.item.folder_path;a.props.visitFolder(t)},a.state={isIconShown:!1},a}return(0,u.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.mode,n=this.state.isIconShown;if(t.is_dir){var i="?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(a);return(0,z.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,z.jsx)("a",{href:i,className:"grid-file-img-link d-block",onClick:this.onFolderItemClick,children:(0,z.jsx)("img",{src:w.Aq.getFolderIconUrl(!1,192),alt:"",width:"80",height:"80"})}),(0,z.jsx)("a",{href:i,className:"grid-file-name grid-file-name-link",onClick:this.onFolderItemClick,children:t.folder_name}),Ee&&(0,z.jsx)(fe.A,{className:"action-icon ".concat(n?"":" invisible"),symbol:"download",title:(0,k.APU)("Download"),op:this.zipDownloadFolder})]})}var s="".concat(k.YcY,"d/").concat(we,"/files/?p=").concat(encodeURIComponent(t.file_path)),o=t.encoded_thumbnail_src?"".concat(k.YcY).concat(t.encoded_thumbnail_src,"?mtime=").concat(t.last_modified):"";return(0,z.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,z.jsx)("a",{href:s,className:"grid-file-img-link d-block",onClick:this.handleFileClick,children:o?(0,z.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,z.jsx)("img",{src:w.Aq.getFileIconUrl(t.file_name),alt:"",width:"80",height:"80"})}),(0,z.jsx)("a",{href:s,className:"grid-file-name grid-file-name-link",onClick:this.handleFileClick,children:t.file_name}),Ee&&(0,z.jsx)("a",{className:"action-icon ".concat(n?"":" invisible"),href:"".concat(s,"&dl=1"),title:(0,k.APU)("Download"),"aria-label":(0,k.APU)("Download"),children:(0,z.jsx)(O.A,{symbol:"download"})})]})}}])}(p.Component);(0,h.createRoot)(document.getElementById("wrapper")).render((0,z.jsx)(Re,{}))},47100:function(){}},function(e){e.O(0,[4223],(function(){return t=54901,e(e.s=t);var t}));e.O()}]);