{"version":3,"sources":["../node_modules/unified/index.js","utils/seafile-markdown2html.js","components/review-list-view/review-comments.js","components/review-list-view/review-comment-dialog.js","components/dialog/add-reviewer-dialog.js","pages/review/history-list.js","models/review-comment.js","draft.js"],"names":["extend","require","bail","vfile","trough","string","plain","module","exports","unified","attachers","transformers","namespace","frozen","freezeIndex","processor","data","key","value","arguments","length","assertUnfrozen","own","call","freeze","use","settings","undefined","addPlugin","apply","Error","addList","addPreset","result","plugins","add","index","plugin","entry","find","push","slice","parse","doc","Parser","file","assertParser","newable","String","stringify","node","Compiler","assertCompiler","assertNode","compile","run","runSync","complete","done","assertDone","err","tree","process","processSync","destination","values","options","transformer","Infinity","cb","Promise","executor","resolve","reject","pipeline","hasOwnProperty","p","ctx","next","contents","keys","prototype","name","type","asyncName","markdown","slug","breaks","remark2rehype","format","raw","xtend","toHTML","sanitize","gh","deepmerge","default","commonmark","allowDangerousHTML","config","this","schema","hast","ReviewComments","props","handleCommentChange","event","setState","comment","target","submitComment","state","trim","seafileAPI","postComment","draftRepoID","draftFilePath","then","listComments","catch","error","errMessage","Utils","getErrorMsg","toaster","danger","resolveComment","updateComment","id","res","editComment","commentID","newComment","deleteComment","scrollToQuote","newIndex","oldIndex","quote","showResolvedComment","nextProps","commentsList","that","setTimeout","refs","scrollTo","className","ref","map","item","gettext","placeholder","onChange","clos","rows","warp","Button","color","size","onClick","React","Component","CommentItem","toggleDropDownMenu","dropdownOpen","convertComment","toggleEditComment","editable","resolved","src","avatarUrl","alt","time","Dropdown","isOpen","toggle","DropdownToggle","DropdownMenu","userEmail","username","DropdownItem","dangerouslySetInnerHTML","__html","ReviewCommentDialog","detail","JSON","onCommentAdded","setQuoteText","mdQuote","toggleCommentDialog","AddReviewerDialog","listReviewers","listDraftReviewers","draftID","reviewers","handleSelectChange","option","selectedOption","Options","addReviewers","reviewSelect","clearSelect","i","email","loading","errorMsg","addDraftReviewers","failed","success","deleteReviewer","reviewer","getAttribute","deleteDraftReviewer","newReviewers","user_email","toggleDialog","toggleAddReviewerDialog","Modal","ModalHeader","ModalBody","onSelectChange","isMulti","disabled","error_msg","avatar_url","user_name","ModalFooter","moment","locale","window","app","lang","HistoryList","preItem","currentItem","activeItem","onHistoryItemClick","onScroll","clientHeight","scrollHeight","scrollTop","totalReversionCount","perPage","currentPage","listFileHistoryRecords","currentHistoryList","Object","assign","historyList","onHistoryListChange","arr","preItemIndex","ctime","creator_name","HistoryItem","parseZone","reviewComment","oldTime","Date","created_at","getTime","URL","findRange","ReactEditor","toSlateRange","toDOMNode","Draft","initialContent","draftStatus","draftFileExists","isLoading","isShowDiff","originFileExists","getFileDownloadLink","getFileContent","draftContent","draftOriginContent","hash","location","indexOf","preItemFilePath","currentItemFilePath","currentCommitID","preCommitID","activeTab","total_count","commit_id","path","axios","all","getFileRevision","spread","res1","res2","content1","content2","setDiffViewerContent","draftOriginFilePath","getChangedNodes","dl0","siteRoot","draftPublishVersion","dl","originFileVersion","url","setURL","comments","forEach","addComment","e","stopPropagation","getQuote","isShowCommentDialog","getOriginRepoInfo","getRepoInfo","originRepoName","repo_name","getDraftInfo","getFileInfo","draftInfo","nodes","diffViewer","lastDiffState","diff_state","changedNodes","scrollToChangedNode","scroll","changeIndex","win","viewer","children","element","tagName","parentNode","scroller","findScrollContainer","document","body","documentElement","offsetTop","parent","OVERFLOWS","overflowY","getComputedStyle","includes","commentNode","showDiffViewer","scriptSource","mediaUrl","newMarkdownContent","oldMarkdownContent","onMouseDown","onSwitchShowDiff","toggleDiffTip","showDiffTip","showReviewerDialog","showDiffButton","checked","Tooltip","placement","onPublishDraft","publishDraft","draft_status","initialDiffViewerContent","content","newContent","prevContent","newurl","href","set","toString","tabItemClick","tab","showNavItem","showTab","commentsNumber","NavItem","NavLink","classnames","active","getDomNodeByPath","querySelector","shift","setBtnPosition","nativeSelection","getSelection","rangeCount","nativeRange","getRangeAt","selection","style","commentbtn","top","Range","isCollapsed","range","focusNodePath","anchor","pop","focusNode","right","serialize","Editor","fragment","renderDiffButton","renderNavItems","Nav","tabs","renderContent","addEventListener","removeEventListener","draftLink","showPublishedButton","showPublishButton","filePermission","showEditButton","mtime","encodeURIComponent","last_modifier_email","draftFileName","last_modifier_name","title","TabContent","TabPane","tabId","changedNumber","inResizing","SidePanelReviewers","SidePanelAuthor","authorAvatar","author","SidePanelOrigin","filePath","serviceURL","width","UnresolvedComments","unresolvedNumber","count","SidePanelChanges","ReactDom","render","getElementById"],"mappings":"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","file":"static/js/draft.chunk.js","sourcesContent":["'use strict'\n\nvar extend = require('extend')\nvar bail = require('bail')\nvar vfile = require('vfile')\nvar trough = require('trough')\nvar string = require('x-is-string')\nvar plain = require('is-plain-obj')\n\n// Expose a frozen processor.\nmodule.exports = unified().freeze()\n\nvar slice = [].slice\nvar own = {}.hasOwnProperty\n\n// Process pipeline.\nvar pipeline = trough()\n  .use(pipelineParse)\n  .use(pipelineRun)\n  .use(pipelineStringify)\n\nfunction pipelineParse(p, ctx) {\n  ctx.tree = p.parse(ctx.file)\n}\n\nfunction pipelineRun(p, ctx, next) {\n  p.run(ctx.tree, ctx.file, done)\n\n  function done(err, tree, file) {\n    if (err) {\n      next(err)\n    } else {\n      ctx.tree = tree\n      ctx.file = file\n      next()\n    }\n  }\n}\n\nfunction pipelineStringify(p, ctx) {\n  ctx.file.contents = p.stringify(ctx.tree, ctx.file)\n}\n\n// Function to create the first processor.\nfunction unified() {\n  var attachers = []\n  var transformers = trough()\n  var namespace = {}\n  var frozen = false\n  var freezeIndex = -1\n\n  // Data management.\n  processor.data = data\n\n  // Lock.\n  processor.freeze = freeze\n\n  // Plugins.\n  processor.attachers = attachers\n  processor.use = use\n\n  // API.\n  processor.parse = parse\n  processor.stringify = stringify\n  processor.run = run\n  processor.runSync = runSync\n  processor.process = process\n  processor.processSync = processSync\n\n  // Expose.\n  return processor\n\n  // Create a new processor based on the processor in the current scope.\n  function processor() {\n    var destination = unified()\n    var length = attachers.length\n    var index = -1\n\n    while (++index < length) {\n      destination.use.apply(null, attachers[index])\n    }\n\n    destination.data(extend(true, {}, namespace))\n\n    return destination\n  }\n\n  // Freeze: used to signal a processor that has finished configuration.\n  //\n  // For example, take unified itself.  Itâ€™s frozen.  Plugins should not be\n  // added to it.  Rather, it should be extended, by invoking it, before\n  // modifying it.\n  //\n  // In essence, always invoke this when exporting a processor.\n  function freeze() {\n    var values\n    var plugin\n    var options\n    var transformer\n\n    if (frozen) {\n      return processor\n    }\n\n    while (++freezeIndex < attachers.length) {\n      values = attachers[freezeIndex]\n      plugin = values[0]\n      options = values[1]\n      transformer = null\n\n      if (options === false) {\n        continue\n      }\n\n      if (options === true) {\n        values[1] = undefined\n      }\n\n      transformer = plugin.apply(processor, values.slice(1))\n\n      if (typeof transformer === 'function') {\n        transformers.use(transformer)\n      }\n    }\n\n    frozen = true\n    freezeIndex = Infinity\n\n    return processor\n  }\n\n  // Data management.  Getter / setter for processor-specific informtion.\n  function data(key, value) {\n    if (string(key)) {\n      // Set `key`.\n      if (arguments.length === 2) {\n        assertUnfrozen('data', frozen)\n\n        namespace[key] = value\n\n        return processor\n      }\n\n      // Get `key`.\n      return (own.call(namespace, key) && namespace[key]) || null\n    }\n\n    // Set space.\n    if (key) {\n      assertUnfrozen('data', frozen)\n      namespace = key\n      return processor\n    }\n\n    // Get space.\n    return namespace\n  }\n\n  // Plugin management.\n  //\n  // Pass it:\n  // *   an attacher and options,\n  // *   a preset,\n  // *   a list of presets, attachers, and arguments (list of attachers and\n  //     options).\n  function use(value) {\n    var settings\n\n    assertUnfrozen('use', frozen)\n\n    if (value === null || value === undefined) {\n      // Empty.\n    } else if (typeof value === 'function') {\n      addPlugin.apply(null, arguments)\n    } else if (typeof value === 'object') {\n      if ('length' in value) {\n        addList(value)\n      } else {\n        addPreset(value)\n      }\n    } else {\n      throw new Error('Expected usable value, not `' + value + '`')\n    }\n\n    if (settings) {\n      namespace.settings = extend(namespace.settings || {}, settings)\n    }\n\n    return processor\n\n    function addPreset(result) {\n      addList(result.plugins)\n\n      if (result.settings) {\n        settings = extend(settings || {}, result.settings)\n      }\n    }\n\n    function add(value) {\n      if (typeof value === 'function') {\n        addPlugin(value)\n      } else if (typeof value === 'object') {\n        if ('length' in value) {\n          addPlugin.apply(null, value)\n        } else {\n          addPreset(value)\n        }\n      } else {\n        throw new Error('Expected usable value, not `' + value + '`')\n      }\n    }\n\n    function addList(plugins) {\n      var length\n      var index\n\n      if (plugins === null || plugins === undefined) {\n        // Empty.\n      } else if (typeof plugins === 'object' && 'length' in plugins) {\n        length = plugins.length\n        index = -1\n\n        while (++index < length) {\n          add(plugins[index])\n        }\n      } else {\n        throw new Error('Expected a list of plugins, not `' + plugins + '`')\n      }\n    }\n\n    function addPlugin(plugin, value) {\n      var entry = find(plugin)\n\n      if (entry) {\n        if (plain(entry[1]) && plain(value)) {\n          value = extend(entry[1], value)\n        }\n\n        entry[1] = value\n      } else {\n        attachers.push(slice.call(arguments))\n      }\n    }\n  }\n\n  function find(plugin) {\n    var length = attachers.length\n    var index = -1\n    var entry\n\n    while (++index < length) {\n      entry = attachers[index]\n\n      if (entry[0] === plugin) {\n        return entry\n      }\n    }\n  }\n\n  // Parse a file (in string or vfile representation) into a unist node using\n  // the `Parser` on the processor.\n  function parse(doc) {\n    var file = vfile(doc)\n    var Parser\n\n    freeze()\n    Parser = processor.Parser\n    assertParser('parse', Parser)\n\n    if (newable(Parser)) {\n      return new Parser(String(file), file).parse()\n    }\n\n    return Parser(String(file), file) // eslint-disable-line new-cap\n  }\n\n  // Run transforms on a unist node representation of a file (in string or\n  // vfile representation), async.\n  function run(node, file, cb) {\n    assertNode(node)\n    freeze()\n\n    if (!cb && typeof file === 'function') {\n      cb = file\n      file = null\n    }\n\n    if (!cb) {\n      return new Promise(executor)\n    }\n\n    executor(null, cb)\n\n    function executor(resolve, reject) {\n      transformers.run(node, vfile(file), done)\n\n      function done(err, tree, file) {\n        tree = tree || node\n        if (err) {\n          reject(err)\n        } else if (resolve) {\n          resolve(tree)\n        } else {\n          cb(null, tree, file)\n        }\n      }\n    }\n  }\n\n  // Run transforms on a unist node representation of a file (in string or\n  // vfile representation), sync.\n  function runSync(node, file) {\n    var complete = false\n    var result\n\n    run(node, file, done)\n\n    assertDone('runSync', 'run', complete)\n\n    return result\n\n    function done(err, tree) {\n      complete = true\n      bail(err)\n      result = tree\n    }\n  }\n\n  // Stringify a unist node representation of a file (in string or vfile\n  // representation) into a string using the `Compiler` on the processor.\n  function stringify(node, doc) {\n    var file = vfile(doc)\n    var Compiler\n\n    freeze()\n    Compiler = processor.Compiler\n    assertCompiler('stringify', Compiler)\n    assertNode(node)\n\n    if (newable(Compiler)) {\n      return new Compiler(node, file).compile()\n    }\n\n    return Compiler(node, file) // eslint-disable-line new-cap\n  }\n\n  // Parse a file (in string or vfile representation) into a unist node using\n  // the `Parser` on the processor, then run transforms on that node, and\n  // compile the resulting node using the `Compiler` on the processor, and\n  // store that result on the vfile.\n  function process(doc, cb) {\n    freeze()\n    assertParser('process', processor.Parser)\n    assertCompiler('process', processor.Compiler)\n\n    if (!cb) {\n      return new Promise(executor)\n    }\n\n    executor(null, cb)\n\n    function executor(resolve, reject) {\n      var file = vfile(doc)\n\n      pipeline.run(processor, {file: file}, done)\n\n      function done(err) {\n        if (err) {\n          reject(err)\n        } else if (resolve) {\n          resolve(file)\n        } else {\n          cb(null, file)\n        }\n      }\n    }\n  }\n\n  // Process the given document (in string or vfile representation), sync.\n  function processSync(doc) {\n    var complete = false\n    var file\n\n    freeze()\n    assertParser('processSync', processor.Parser)\n    assertCompiler('processSync', processor.Compiler)\n    file = vfile(doc)\n\n    process(file, done)\n\n    assertDone('processSync', 'process', complete)\n\n    return file\n\n    function done(err) {\n      complete = true\n      bail(err)\n    }\n  }\n}\n\n// Check if `func` is a constructor.\nfunction newable(value) {\n  return typeof value === 'function' && keys(value.prototype)\n}\n\n// Check if `value` is an object with keys.\nfunction keys(value) {\n  var key\n  for (key in value) {\n    return true\n  }\n  return false\n}\n\n// Assert a parser is available.\nfunction assertParser(name, Parser) {\n  if (typeof Parser !== 'function') {\n    throw new Error('Cannot `' + name + '` without `Parser`')\n  }\n}\n\n// Assert a compiler is available.\nfunction assertCompiler(name, Compiler) {\n  if (typeof Compiler !== 'function') {\n    throw new Error('Cannot `' + name + '` without `Compiler`')\n  }\n}\n\n// Assert the processor is not frozen.\nfunction assertUnfrozen(name, frozen) {\n  if (frozen) {\n    throw new Error(\n      'Cannot invoke `' +\n        name +\n        '` on a frozen processor.\\nCreate a new processor first, by invoking it: use `processor()` instead of `processor`.'\n    )\n  }\n}\n\n// Assert `node` is a unist node.\nfunction assertNode(node) {\n  if (!node || !string(node.type)) {\n    throw new Error('Expected node, got `' + node + '`')\n  }\n}\n\n// Assert that `complete` is `true`.\nfunction assertDone(name, asyncName, complete) {\n  if (!complete) {\n    throw new Error(\n      '`' + name + '` finished async. Use `' + asyncName + '` instead'\n    )\n  }\n}\n","var unified = require('unified');\nvar markdown = require('remark-parse');\nvar slug = require('remark-slug');\nvar breaks = require('remark-breaks');\nvar remark2rehype = require('remark-rehype');\nvar format = require('rehype-format');\nvar raw = require('rehype-raw');\nvar xtend = require('xtend');\nvar toHTML = require('hast-util-to-html');\nvar sanitize = require('hast-util-sanitize');\nvar gh = require('hast-util-sanitize/lib/github');\nvar deepmerge = require('deepmerge').default;\n\nfunction stringify(config) {\n  var settings = xtend(config, this.data('settings'));\n  var schema = deepmerge(gh, {\n    'attributes': {\n      'input': [\n        'type',\n      ],\n      'li': [\n        'className'\n      ],\n      'code': [\n        'className',\n      ],\n    },\n    'tagNames': [\n      'input',\n      'code'\n    ]\n  });\n  this.Compiler = compiler;\n\n  function compiler(tree) {\n    // use sanity to remove dangerous html, the default is\n    var hast = sanitize(tree, schema);\n    return toHTML(hast, settings);\n  }\n}\n\n// markdown -> mdast -> html AST -> html\nvar processor = unified()\n  .use(markdown, {commonmark: true})\n  .use(breaks)\n  .use(slug)\n  .use(remark2rehype, {allowDangerousHTML: true})\n  .use(raw)\n  .use(format)\n  .use(stringify);\n\nvar processorGetAST = unified()\n  .use(markdown, {commonmark: true})\n  .use(slug);\n\nexport { processor, processorGetAST };\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { processor } from '../../utils/seafile-markdown2html';\nimport { Button, Dropdown, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext, draftFilePath, draftRepoID } from '../../utils/constants';\nimport { username } from '../../utils/constants.js';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\n\nimport '../../css/comments-list.css';\n\nconst commentPropTypes = {\n  listComments: PropTypes.func.isRequired,\n  commentsList: PropTypes.array.isRequired,\n  scrollToQuote: PropTypes.func.isRequired\n};\n\nclass ReviewComments extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      showResolvedComment: true,\n      comment: '',\n    };\n  }\n\n  handleCommentChange = (event) => {\n    this.setState({ comment: event.target.value });\n  }\n\n  submitComment = () => {\n    let comment = this.state.comment.trim();\n    if (comment.length > 0) {\n      seafileAPI.postComment(draftRepoID, draftFilePath, comment).then(() => {\n        this.props.listComments();\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n      this.setState({ comment: '' });\n    }\n  }\n\n  resolveComment = (event) => {\n    seafileAPI.updateComment(draftRepoID, event.target.id, 'true').then((res) => {\n      this.props.listComments();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  editComment = (commentID, newComment) => {\n    seafileAPI.updateComment(draftRepoID, commentID, null, null, newComment).then((res) => {\n      this.props.listComments();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  deleteComment = (event) => {\n    seafileAPI.deleteComment(draftRepoID, event.target.id).then((res) => {\n      this.props.listComments();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  scrollToQuote = (newIndex, oldIndex, quote) => {\n    this.props.scrollToQuote(newIndex, oldIndex, quote);\n    this.setState({ comment: '' });\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.commentsList.length < nextProps.commentsList.length) {\n      let that = this;\n      setTimeout(() => {\n        that.refs.commentsList.scrollTo(0, 10000);\n      }, 100);\n    }\n  }\n\n  render() {\n    const { commentsList } = this.props;\n    return (\n      <div className=\"seafile-comment h-100\">\n        <div className=\"flex-fill o-auto\">\n          {commentsList.length > 0 ? (\n            <ul className=\"seafile-comment-list\" ref='commentsList'>\n              {commentsList.map((item, index) => {\n                return (\n                  <CommentItem\n                    item={item}\n                    key={index}\n                    showResolvedComment={this.state.showResolvedComment}\n                    resolveComment={this.resolveComment}\n                    editComment={this.editComment}\n                    scrollToQuote={this.scrollToQuote}\n                    deleteComment={this.deleteComment}\n                  />\n                );\n              })}\n            </ul>\n          ) :\n            <p className=\"text-center my-4\">{gettext('No comment yet.')}</p>\n          }\n        </div>\n        <div className=\"seafile-comment-footer flex-shrink-0\">\n          <textarea\n            className=\"add-comment-input\"\n            value={this.state.comment}\n            placeholder={gettext('Add a comment...')}\n            onChange={this.handleCommentChange}\n            clos=\"100\" rows=\"3\" warp=\"virtual\"\n          ></textarea>\n          <div className=\"comment-submit-container\">\n            <Button className=\"submit-comment\" color=\"primary\" size=\"sm\" onClick={this.submitComment}>{gettext('Submit')}</Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReviewComments.propTypes = commentPropTypes;\n\nconst commentItemPropTypes = {\n  item: PropTypes.object.isRequired,\n  deleteComment: PropTypes.func.isRequired,\n  resolveComment: PropTypes.func.isRequired,\n  editComment: PropTypes.func.isRequired,\n  showResolvedComment: PropTypes.bool.isRequired,\n  scrollToQuote: PropTypes.func.isRequired\n};\n\nclass CommentItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      dropdownOpen: false,\n      comment: '',\n      quote: '',\n      newComment: this.props.item.comment,\n      editable: false,\n    };\n  }\n\n  toggleDropDownMenu = () => {\n    this.setState({ dropdownOpen: !this.state.dropdownOpen });\n  }\n\n  convertComment = (item) => {\n    processor.process(item.comment).then((result) => {\n      let comment = String(result);\n      this.setState({ comment: comment });\n    });\n    processor.process(item.quote).then((result) => {\n      let quote = String(result);\n      this.setState({ quote: quote });\n    });\n  }\n\n  scrollToQuote = () => {\n    const item = this.props.item;\n    this.props.scrollToQuote(item.newIndex, item.oldIndex, item.quote);\n  }\n\n  toggleEditComment = () => {\n    this.setState({ editable: !this.state.editable });\n  }\n\n  updateComment = (event) => {\n    const newComment = this.state.newComment;\n    if (this.props.item.comment !== newComment) {\n      this.props.editComment(event.target.id, newComment);\n    }\n    this.toggleEditComment();\n  }\n\n  handleCommentChange = (event) => {\n    this.setState({ newComment: event.target.value });\n  }\n\n  componentWillMount() {\n    this.convertComment(this.props.item);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.convertComment(nextProps.item);\n  }\n\n  render() {\n    const item = this.props.item;\n    if (item.resolved && !this.props.showResolvedComment) return null;\n    if (this.state.editable) {\n      return(\n        <li className=\"seafile-comment-item\" id={item.id}>\n          <div className=\"seafile-comment-info\">\n            <img className=\"avatar\" src={item.avatarUrl} alt=\"\"/>\n            <div className=\"reviewer-info\">\n              <div className=\"reviewer-name ellipsis\">{item.name}</div>\n              <div className=\"review-time\">{item.time}</div>\n            </div>\n          </div>\n          <div className=\"seafile-edit-comment\">\n            <textarea\n              className=\"edit-comment-input\"\n              value={this.state.newComment}\n              onChange={this.handleCommentChange}\n              clos=\"100\" rows=\"3\" warp=\"virtual\"\n            ></textarea>\n            <Button className=\"comment-btn\" color=\"primary\" size=\"sm\" onClick={this.updateComment} id={item.id}>\n              {gettext('Update')}</Button>{' '}\n            <Button className=\"comment-btn\" color=\"secondary\" size=\"sm\" onClick={this.toggleEditComment}>\n              {gettext('Cancel')}</Button>\n          </div>\n        </li>\n      );\n    }\n    return (\n      <li className={item.resolved ? 'seafile-comment-item seafile-comment-item-resolved'\n        : 'seafile-comment-item'} id={item.id}>\n        <div className=\"seafile-comment-info\">\n          <img className=\"avatar\" src={item.avatarUrl} alt=\"\"/>\n          <div className=\"reviewer-info\">\n            <div className=\"reviewer-name ellipsis\">{item.name}</div>\n            <div className=\"review-time\">{item.time}</div>\n          </div>\n          {!item.resolved &&\n            <Dropdown isOpen={this.state.dropdownOpen} size=\"sm\"\n              className=\"seafile-comment-dropdown\" toggle={this.toggleDropDownMenu}>\n              <DropdownToggle className=\"seafile-comment-dropdown-btn\">\n                <i className=\"fas fa-ellipsis-v\"></i>\n              </DropdownToggle>\n              <DropdownMenu>\n                {(item.userEmail === username) &&\n                  <DropdownItem onClick={this.props.deleteComment}\n                    className=\"delete-comment\" id={item.id}>{gettext('Delete')}</DropdownItem>}\n                {(item.userEmail === username) &&\n                  <DropdownItem onClick={this.toggleEditComment}\n                    className=\"edit-comment\" id={item.id}>{gettext('Edit')}</DropdownItem>}\n                <DropdownItem onClick={this.props.resolveComment}\n                  className=\"seafile-comment-resolved\" id={item.id}>{gettext('Mark as resolved')}</DropdownItem>\n              </DropdownMenu>\n            </Dropdown>\n          }\n        </div>\n        {(item.newIndex >= -1 && item.oldIndex >= -1) &&\n          <blockquote className=\"seafile-comment-content\">\n            <div onClick={this.scrollToQuote} dangerouslySetInnerHTML={{ __html: this.state.quote }}></div>\n          </blockquote>\n        }\n        <div className=\"seafile-comment-content\" dangerouslySetInnerHTML={{ __html: this.state.comment }}></div>\n      </li>\n    );\n  }\n}\n\nCommentItem.propTypes = commentItemPropTypes;\n\nexport default ReviewComments;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Button } from 'reactstrap';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext, name, draftRepoID, draftFilePath } from '../../utils/constants';\nimport { processor } from '../../utils/seafile-markdown2html';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\n\nimport '../../css/review-comment-dialog.css';\n\nconst commentDialogPropTypes = {\n  onCommentAdded: PropTypes.func.isRequired,\n  toggleCommentDialog: PropTypes.func.isRequired,\n  quote: PropTypes.string,\n  newIndex: PropTypes.number,\n  oldIndex: PropTypes.number,\n};\n\nclass ReviewCommentDialog extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      comment: '',\n      quote: '',\n    };\n  }\n\n  handleCommentChange = (event) => {\n    let comment = event.target.value;\n    this.setState({ comment: comment });\n  }\n\n  submitComment = () => {\n    const { quote, newIndex, oldIndex } = this.props;\n    const comment = this.state.comment.trim();\n    if (comment.length === 0) return;\n    if (quote.length > 0) {\n      let detail = {\n        quote: quote,\n        newIndex: newIndex,\n        oldIndex: oldIndex\n      };\n      seafileAPI.postComment(draftRepoID, draftFilePath, comment, JSON.stringify(detail)).then(() => {\n        this.props.onCommentAdded();\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    } else {\n      seafileAPI.postComment(draftRepoID, draftFilePath, comment).then(() => {\n        this.props.onCommentAdded();\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    }\n    this.setState({ comment: '' });\n  }\n\n  setQuoteText = (mdQuote) => {\n    processor.process(mdQuote).then(\n      (result) => {\n        let quote = String(result);\n        this.setState({ quote: quote });\n      }\n    );\n  }\n\n  componentDidMount() {\n    this.setQuoteText(this.props.quote);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.quote !== nextProps.quote) {\n      this.setQuoteText(nextProps.quote);\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"review-comment-dialog\">\n        <div>{name}</div>\n        <blockquote className=\"review-comment-dialog-quote\">\n          <div dangerouslySetInnerHTML={{ __html: this.state.quote}}></div>\n        </blockquote>\n        <textarea value={this.state.comment} onChange={this.handleCommentChange}></textarea>\n        <div className=\"button-group\">\n          <Button size=\"sm\" color=\"primary\" onClick={this.submitComment}>{gettext('Submit')}</Button>\n          <Button size=\"sm\" color=\"secondary\" onClick={this.props.toggleCommentDialog}>{gettext('Cancel')}</Button>\n        </div>\n        <span className=\"review-comment-dialog-triangle\"></span>\n      </div>\n    );\n  }\n}\n\nReviewCommentDialog.propTypes = commentDialogPropTypes;\n\nexport default ReviewCommentDialog;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext } from '../../utils/constants';\nimport { Button, Modal, ModalHeader, ModalBody, ModalFooter } from 'reactstrap';\nimport { seafileAPI } from '../../utils/seafile-api.js';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\nimport UserSelect from '../user-select.js';\nimport '../../css/add-reviewer-dialog.css';\n\nconst propTypes = {\n  showReviewerDialog: PropTypes.bool.isRequired,\n  draftID: PropTypes.string.isRequired,\n  toggleAddReviewerDialog: PropTypes.func.isRequired,\n  reviewers: PropTypes.array.isRequired\n};\n\nclass AddReviewerDialog extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      reviewers: this.props.reviewers,\n      selectedOption: null,\n      errorMsg: [],\n      loading: false,\n    };\n    this.Options = [];\n  }\n\n  listReviewers = () => {\n    seafileAPI.listDraftReviewers(this.props.draftID).then((res) => {\n      this.setState({ reviewers: res.data.reviewers });\n    });\n  }\n\n  handleSelectChange = (option) => {\n    this.setState({ selectedOption: option });\n    this.Options = [];\n  }\n\n  addReviewers = () => {\n    if (this.state.selectedOption.length > 0 ) {\n      this.refs.reviewSelect.clearSelect();\n      let reviewers = [];\n      for (let i = 0; i < this.state.selectedOption.length; i ++) {\n        reviewers[i] = this.state.selectedOption[i].email;\n      }\n      this.setState({\n        loading: true,\n        errorMsg: [],\n      });\n      seafileAPI.addDraftReviewers(this.props.draftID, reviewers).then((res) => {\n        if (res.data.failed.length > 0) {\n          let errorMsg = [];\n          for (let i = 0 ; i < res.data.failed.length ; i++) {\n            errorMsg[i] = res.data.failed[i];\n          }\n          this.setState({ errorMsg: errorMsg });\n        }\n        this.setState({\n          selectedOption: null,\n          loading: false\n        });\n        if (res.data.success.length > 0) {\n          this.listReviewers();\n        }\n      }).catch(error => {\n        let errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    }\n  }\n\n  deleteReviewer = (event) => {\n    let reviewer = event.target.getAttribute('name');\n    seafileAPI.deleteDraftReviewer(this.props.draftID, reviewer).then((res) => {\n      if (res.data === 200) {\n        let newReviewers = [];\n        for (let i = 0; i < this.state.reviewers.length; i ++) {\n          if (this.state.reviewers[i].user_email !== reviewer) {\n            newReviewers.push(this.state.reviewers[i]);\n          }\n        }\n        this.setState({ reviewers: newReviewers });\n      }\n    }).catch(error => {\n      let errorMsg = Utils.getErrorMsg(error);\n      toaster.danger(errorMsg);\n    });\n  }\n\n  render() {\n    const toggleDialog = this.props.toggleAddReviewerDialog;\n    const { reviewers, errorMsg } = this.state;\n    return (\n      <Modal isOpen={true} toggle={toggleDialog}>\n        <ModalHeader toggle={toggleDialog}>{gettext('Request a review')}</ModalHeader>\n        <ModalBody>\n          <p>{gettext('Add new reviewer')}</p>\n          <div className='add-reviewer'>\n            <UserSelect\n              placeholder={gettext('Search users...')}\n              onSelectChange={this.handleSelectChange}\n              ref=\"reviewSelect\"\n              isMulti={true}\n              className='reviewer-select'\n            />\n            {(this.state.selectedOption && !this.state.loading)?\n              <Button color=\"secondary\" onClick={this.addReviewers}>{gettext('Submit')}</Button> :\n              <Button color=\"secondary\" disabled>{gettext('Submit')}</Button>\n            }\n          </div>\n          {errorMsg.length > 0 &&\n            errorMsg.map((item, index = 0, arr) => {\n              return (\n                <p className=\"reviewer-select-error error\" key={index}>{errorMsg[index].email}\n                  {': '}{errorMsg[index].error_msg}</p>\n              );\n            })\n          }\n          {reviewers.length > 0 &&\n            reviewers.map((item, index = 0, arr) => {\n              return (\n                <div className=\"reviewer-select-info\" key={index}>\n                  <div className=\"d-flex\">\n                    <img className=\"avatar reviewer-select-avatar\" src={item.avatar_url} alt=\"\"/>\n                    <span className=\"reviewer-select-name ellipsis\">{item.user_name}</span>\n                  </div>\n                  <i className=\"fa fa-times\" name={item.user_email} onClick={this.deleteReviewer}></i>\n                </div>\n              );\n            })\n          }\n        </ModalBody>\n        <ModalFooter>\n          <Button color=\"secondary\" onClick={toggleDialog}>{gettext('Close')}</Button>\n        </ModalFooter>\n      </Modal>\n    );\n  }\n}\n\nAddReviewerDialog.propTypes = propTypes;\n\nexport default AddReviewerDialog;\n","/* eslint-disable linebreak-style */\nimport React from 'react';\nimport axios from 'axios';\nimport Loading from '../../components/loading';\nimport moment from 'moment';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { draftRepoID, draftFilePath, draftOriginFilePath } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../../components/toast';\n\nimport '../../css/file-history.css';\n\nmoment.locale(window.app.config.lang);\n\nclass HistoryList extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.perPage = 25;\n    this.state = {\n      currentPage: 1,\n      loading: false\n    };\n  }\n\n  onClick = (event, key, preItem, currentItem)=> {\n    if (key === this.state.activeItem) return false;\n    this.props.onHistoryItemClick(currentItem, preItem, key);\n  }\n\n  onScroll = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop    = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    if (isBottom) {\n      if (this.props.totalReversionCount > this.perPage * this.state.currentPage) {\n        let currentPage = this.state.currentPage + 1;\n        this.setState({\n          currentPage: currentPage,\n          loading : true\n        });\n        seafileAPI.listFileHistoryRecords(draftRepoID, draftFilePath, currentPage, this.perPage).then((res) => {\n          let currentHistoryList = Object.assign([], this.props.historyList);\n          this.props.onHistoryListChange([...currentHistoryList, ...res.data.data]);\n          this.setState({\n            loading : false\n          });\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"history-body\">\n        <ul onScroll={this.onScroll} className={'history-list-container'}>\n          {\n            this.props.historyList ?\n              this.props.historyList.map((item, index = 0, arr) => {\n                let preItemIndex = index + 1;\n                if (preItemIndex === arr.length) {\n                  preItemIndex = index;\n                }\n                return (\n                  <HistoryItem\n                    onClick={this.onClick}\n                    ctime={item.ctime}\n                    className={this.props.activeItem === index ? 'item-active': ''}\n                    name={item.creator_name}\n                    index={index}\n                    key={index}\n                    preItem={arr[preItemIndex]}\n                    currentItem={item}\n                  />\n                );\n              }) : <Loading/>\n          }\n          {\n            this.state.loading &&\n            <li className={'reloading-reversion'}><Loading /></li>\n          }\n        </ul>\n      </div>\n    );\n  }\n}\n\nclass HistoryItem extends React.Component {\n  render() {\n    let time = moment.parseZone(this.props.ctime).format('YYYY-MM-DD HH:mm');\n    return (\n      <li onClick={(event) => this.props.onClick(event, this.props.index, this.props.preItem, this.props.currentItem)} className={'history-list-item ' + this.props.className}>\n        <div className=\"history-info\">\n          <div className=\"time\">{time}</div>\n          <div className=\"owner\"><i className=\"squire-icon\"/><span>{this.props.name}</span></div>\n        </div>\n      </li>\n    );\n  }\n}\n\n\nexport default HistoryList;\n","import moment from 'moment';\n\nclass reviewComment {\n\n  constructor(item) {\n    let oldTime = (new Date(item.created_at)).getTime();\n    this.time = moment(oldTime).format('YYYY-MM-DD HH:mm');\n    this.id = item.id;\n    this.avatarUrl = item.avatar_url;\n    this.comment = item.comment;\n    this.name = item.user_name;\n    this.userEmail = item.user_email;\n    this.resolved = item.resolved;\n    if (item.detail) {\n      let detail = JSON.parse(item.detail);\n      this.newIndex = detail.newIndex;\n      this.oldIndex = detail.oldIndex;\n      this.quote = detail.quote;\n    }\n  }\n\n}\n\nexport default reviewComment;","import React from 'react';\nimport ReactDom from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { Button } from 'reactstrap';\n/* eslint-disable */\nimport Prism from 'prismjs';\n/* eslint-enable */\nimport { DiffViewer, serialize } from '@seafile/seafile-editor';\nimport { siteRoot, gettext, draftOriginFilePath, draftFilePath, author, authorAvatar, originFileExists, draftFileExists, draftID, draftFileName, draftRepoID, draftStatus, draftPublishVersion, originFileVersion, filePermission, serviceURL, mediaUrl } from './utils/constants';\nimport { seafileAPI } from './utils/seafile-api';\nimport axios from 'axios';\nimport Loading from './components/loading';\nimport ReviewComments from './components/review-list-view/review-comments';\nimport ReviewCommentDialog from './components/review-list-view/review-comment-dialog.js';\nimport { Tooltip } from 'reactstrap';\nimport AddReviewerDialog from './components/dialog/add-reviewer-dialog.js';\nimport  { ReactEditor }  from '@seafile/slate-react';\nimport { Nav, NavItem, NavLink, TabContent, TabPane } from 'reactstrap';\nimport classnames from 'classnames';\nimport HistoryList from './pages/review/history-list';\nimport { Range, Editor } from 'slate';\nimport ModalPortal from './components/modal-portal';\nimport reviewComment from './models/review-comment.js';\n\nimport './css/layout.css';\nimport './css/toolbar.css';\nimport './css/dirent-detail.css';\nimport './css/draft.css';\n\nconst URL = require('url-parse');\nvar moment = require('moment');\n\nconst { toSlateRange: findRange, toDOMNode } = ReactEditor;\n\nclass Draft extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      draftContent: '',\n      draftOriginContent: '',\n      draftInfo: {},\n      isLoading: true,\n      isShowDiff: true,\n      showDiffTip: false,\n      activeTab: 'reviewInfo',\n      commentsList: [],\n      changedNodes: [],\n      originRepoName: '',\n      isShowCommentDialog: false,\n      activeItem: null,\n      historyList: [],\n      showReviewerDialog: false,\n      reviewers: [],\n      draftStatus: draftStatus,\n    };\n    this.quote = '';\n    this.newIndex = null;\n    this.oldIndex = null;\n    this.changeIndex = -1;\n    this.range = null;\n  }\n\n  initialContent = () => {\n    switch(draftStatus) {\n      case 'open':\n        if (!draftFileExists) {\n          this.setState({\n            isLoading: false,\n            isShowDiff: false\n          });\n          return;\n        }\n\n        if (!originFileExists) {\n          seafileAPI.getFileDownloadLink(draftRepoID, draftFilePath)\n            .then(res => {\n              seafileAPI.getFileContent(res.data)\n                .then(res => {\n                  this.setState({\n                    draftContent: res.data,\n                    draftOriginContent: res.data,\n                    isLoading: false,\n                    isShowDiff: false\n                  });\n                });\n            });\n          return;\n        }\n\n        const hash = window.location.hash;\n        if (hash.indexOf('#history-') === 0) {\n          const currentCommitID = hash.slice(9, 49);\n          const preCommitID = hash.slice(50, 90);\n          let preItemFilePath, currentItemFilePath;\n          this.setState({\n            isLoading: false,\n            activeTab: 'history',\n          });\n          seafileAPI.listFileHistoryRecords(draftRepoID, draftFilePath, 1, 25).then((res) => {\n            const historyList = res.data.data;\n            this.setState({\n              historyList: historyList,\n              totalReversionCount: res.data.total_count\n            });\n            for (let i = 0, length = historyList.length; i < length; i++) {\n              if (preCommitID === historyList[i].commit_id) {\n                this.setState({\n                  activeItem: i\n                });\n                preItemFilePath = historyList[i].path;\n              }\n              if (currentCommitID === historyList[i].commit_id) {\n                currentItemFilePath = historyList[i].path;\n              }\n              if (preItemFilePath && currentItemFilePath) break;\n            }\n            axios.all([\n              seafileAPI.getFileRevision(draftRepoID, currentCommitID, currentItemFilePath),\n              seafileAPI.getFileRevision(draftRepoID, preCommitID, preItemFilePath)\n            ]).then(axios.spread((res1, res2) => {\n              axios.all([seafileAPI.getFileContent(res1.data), seafileAPI.getFileContent(res2.data)]).then(axios.spread((content1, content2) => {\n                this.setDiffViewerContent(content2.data, content1.data);\n              }));\n            }));\n            return;\n          });\n        } else {\n          axios.all([\n            seafileAPI.getFileDownloadLink(draftRepoID, draftFilePath),\n            seafileAPI.getFileDownloadLink(draftRepoID, draftOriginFilePath)\n          ]).then(axios.spread((res1, res2) => {\n            axios.all([\n              seafileAPI.getFileContent(res1.data),\n              seafileAPI.getFileContent(res2.data)\n            ]).then(axios.spread((draftContent, draftOriginContent) => {\n              this.setState({\n                draftContent: draftContent.data,\n                draftOriginContent: draftOriginContent.data,\n                isLoading: false\n              });\n              let that = this;\n              setTimeout(() => {\n                that.getChangedNodes();\n              }, 100);\n            }));\n          }));\n        }\n        break;\n      case 'published':\n        if (!originFileExists) {\n          this.setState({\n            isLoading: false,\n            isShowDiff: false\n          });\n          return;\n        }\n\n        let dl0 = siteRoot + 'repo/' + draftRepoID + '/' + draftPublishVersion + '/download?' + 'p=' + draftOriginFilePath;\n        let dl = siteRoot + 'repo/' + draftRepoID + '/' + originFileVersion + '/download?' + 'p=' + draftOriginFilePath;\n        axios.all([\n          seafileAPI.getFileContent(dl0),\n          seafileAPI.getFileContent(dl)\n        ]).then(axios.spread((draftContent, draftOriginContent) => {\n          this.setState({\n            draftContent: draftContent.data,\n            draftOriginContent: draftOriginContent.data,\n            isLoading: false,\n          });\n        }));\n        break;\n    }\n  }\n\n  onHistoryItemClick = (currentItem, preItem, activeItem) => {\n    const preCommitID = preItem.commit_id;\n    const currentCommitID = currentItem.commit_id;\n    const url = 'history-' + preCommitID + '-' + currentCommitID;\n    this.setURL(url);\n    this.setState({\n      activeItem: activeItem,\n      isLoading: true,\n    });\n    axios.all([\n      seafileAPI.getFileRevision(draftRepoID, currentCommitID, currentItem.path),\n      seafileAPI.getFileRevision(draftRepoID, preCommitID, preItem.path)\n    ]).then(axios.spread((res1, res2) => {\n      axios.all([seafileAPI.getFileContent(res1.data), seafileAPI.getFileContent(res2.data)]).then(axios.spread((content1,content2) => {\n        this.setDiffViewerContent(content1.data, content2.data);\n      }));\n    }));\n  }\n\n  onHistoryListChange = (historyList) => {\n    this.setState({historyList: historyList });\n  }\n\n  listComments = () => {\n    seafileAPI.listComments(draftRepoID, draftFilePath).then((res) => {\n      let commentsList = [];\n      res.data.comments.forEach((item) => {\n        commentsList.push(new reviewComment(item));\n      });\n      this.setState({ commentsList: commentsList });\n    });\n  }\n\n  addComment = (e) => {\n    e.stopPropagation();\n    this.getQuote();\n    if (!this.quote) return;\n    this.setState({ isShowCommentDialog: true });\n  }\n\n  onCommentAdded = () => {\n    this.listComments();\n    this.toggleCommentDialog();\n  }\n\n  toggleCommentDialog = () => {\n    this.setState({\n      isShowCommentDialog: !this.state.isShowCommentDialog\n    });\n  }\n\n  getOriginRepoInfo = () => {\n    seafileAPI.getRepoInfo(draftRepoID).then((res) => {\n      this.setState({ originRepoName: res.data.repo_name });\n    });\n  }\n\n  getDraftInfo = () => {\n    if (draftStatus === 'open') {\n      seafileAPI.getFileInfo(draftRepoID, draftFilePath).then((res) => {\n        this.setState({ draftInfo: res.data });\n      });\n    }\n  }\n\n  getChangedNodes = () => {\n    const nodes = this.refs.diffViewer.value;\n    let keys = [];\n    let lastDiffState = '';\n    nodes.map((node, index) => {\n      const diff_state = node.data['diff_state'];\n      if (diff_state === 'diff-added' && lastDiffState !== 'diff-added') {\n        keys.push(index);\n      } else if (diff_state === 'diff-removed' && lastDiffState !== 'diff-removed') {\n        keys.push(index);\n      } else if (diff_state === 'diff-replaced' && lastDiffState !== 'diff-replaced') {\n        keys.push(index);\n      }\n      lastDiffState = node.data.diff_state;\n    });\n    this.setState({\n      changedNodes: keys\n    });\n  }\n\n  scrollToChangedNode = (scroll) => {\n    if (this.state.changedNodes.length == 0) return;\n    if (scroll === 'up') { this.changeIndex++; } else { this.changeIndex--; }\n    if (this.changeIndex > this.state.changedNodes.length - 1) {\n      this.changeIndex = 0;\n    }\n    if (this.changeIndex < 0) {\n      this.changeIndex = this.state.changedNodes.length - 1;\n    }\n    const win = window;\n    let key = this.state.changedNodes[this.changeIndex];\n    let node = window.viewer.children[key];\n    let element = toDOMNode(window.viewer, node);\n    // fix code-block or tables\n    while (element.className.indexOf('diff-') === -1 && element.tagName !== 'BODY') {\n      element = element.parentNode;\n    }\n    const scroller = this.findScrollContainer(element, win);\n    const isWindow = scroller == win.document.body || scroller == win.document.documentElement;\n    if (isWindow) {\n      win.scrollTo(0, element.offsetTop);\n    } else {\n      scroller.scrollTop = element.offsetTop;\n    }\n  }\n\n  findScrollContainer = (element, window) => {\n    let parent = element.parentNode;\n    const OVERFLOWS = ['auto', 'overlay', 'scroll'];\n    let scroller;\n    while (!scroller) {\n      if (!parent.parentNode) break;\n      const style = window.getComputedStyle(parent);\n      const { overflowY } = style;\n      if (OVERFLOWS.includes(overflowY)) {\n        scroller = parent;\n        break;\n      }\n      parent = parent.parentNode;\n    }\n    if (!scroller) {\n      return window.document.body;\n    }\n    return scroller;\n  }\n\n  scrollToQuote = (newIndex, oldIndex, quote) => {\n    const nodes = this.refs.diffViewer.value;\n    let commentNode = nodes.find((node) => {\n      if (node.data['old_index'] == oldIndex && node.data['new_index'] == newIndex) {\n        return node;\n      }\n    });\n    if (commentNode) {\n      const element = toDOMNode(window.viewer, commentNode);\n      if (!element) return;\n      const win = window;\n      const scroller = this.findScrollContainer(element, win);\n      const isWindow = scroller == win.document.body || scroller == win.document.documentElement;\n      if (isWindow) {\n        win.scrollTo(0, element.offsetTop);\n      } else {\n        scroller.scrollTop = element.offsetTop;\n      }\n    }\n  }\n\n  showDiffViewer = () => {\n    return (\n      <div>\n        {this.state.isShowDiff ?\n          <DiffViewer\n            scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n            newMarkdownContent={this.state.draftContent}\n            oldMarkdownContent={this.state.draftOriginContent}\n            ref=\"diffViewer\"\n          /> :\n          <DiffViewer\n            scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n            newMarkdownContent={this.state.draftContent}\n            oldMarkdownContent={this.state.draftContent}\n            ref=\"diffViewer\"\n          />\n        }\n        <i className=\"fa fa-plus-square review-comment-btn\" ref=\"commentbtn\" onMouseDown={this.addComment}></i>\n      </div>\n    );\n  }\n\n  listReviewers = () => {\n    seafileAPI.listDraftReviewers(draftID).then((res) => {\n      this.setState({\n        reviewers: res.data.reviewers\n      });\n    });\n  }\n\n  onSwitchShowDiff = () => {\n    if (!this.state.isShowDiff) {\n      let that = this;\n      setTimeout(() => {\n        that.getChangedNodes();\n      }, 100);\n    }\n    this.setState({\n      isShowDiff: !this.state.isShowDiff,\n    });\n  }\n\n  toggleDiffTip = () => {\n    this.setState({\n      showDiffTip: !this.state.showDiffTip\n    });\n  }\n\n  toggleAddReviewerDialog = () => {\n    if (this.state.showReviewerDialog) {\n      this.listReviewers();\n    }\n    this.setState({\n      showReviewerDialog: !this.state.showReviewerDialog\n    });\n  }\n\n  showDiffButton = () => {\n    return (\n      <div className={'seafile-toggle-diff'}>\n        <label className=\"custom-switch\" id=\"toggle-diff\">\n          <input type=\"checkbox\" checked={this.state.isShowDiff && 'checked'}\n            name=\"option\" className=\"custom-switch-input\"\n            onChange={this.onSwitchShowDiff}/>\n          <span className=\"custom-switch-indicator\"></span>\n        </label>\n        <Tooltip placement=\"bottom\" isOpen={this.state.showDiffTip}\n          target=\"toggle-diff\" toggle={this.toggleDiffTip}>\n          {gettext('View diff')}</Tooltip>\n      </div>\n    );\n  }\n\n  onPublishDraft = () => {\n    seafileAPI.publishDraft(draftID).then(res => {\n      this.setState({\n        draftStatus: res.data.draft_status,\n      });\n    });\n  }\n\n  initialDiffViewerContent = () => {\n    seafileAPI.listFileHistoryRecords(draftRepoID, draftFilePath, 1, 25).then((res) => {\n      this.setState({\n        historyList: res.data.data,\n        totalReversionCount: res.data.total_count\n      });\n      if (res.data.data.length > 1) {\n        axios.all([\n          seafileAPI.getFileRevision(draftRepoID, res.data.data[0].commit_id, draftFilePath),\n          seafileAPI.getFileRevision(draftRepoID, res.data.data[1].commit_id, draftFilePath)\n        ]).then(axios.spread((res1, res2) => {\n          axios.all([seafileAPI.getFileContent(res1.data), seafileAPI.getFileContent(res2.data)]).then(axios.spread((content1,content2) => {\n            this.setState({\n              draftContent: content1.data,\n              draftOriginContent: content2.data\n            });\n          }));\n        }));\n      } else {\n        seafileAPI.getFileRevision(draftRepoID, res.data.data[0].commit_id, draftFilePath).then((res) => {\n          seafileAPI.getFileContent(res.data).then((content) => {\n            this.setState({\n              draftContent: content.data,\n              draftOriginContent: ''\n            });\n          });\n        });\n      }\n    });\n  }\n\n  setDiffViewerContent = (newContent, prevContent) => {\n    this.setState({\n      draftContent: newContent,\n      draftOriginContent: prevContent,\n      isLoading: false,\n    });\n  }\n\n  setURL = (newurl) => {\n    let url = new URL(window.location.href);\n    url.set('hash', newurl);\n    window.location.href = url.toString();\n  }\n\n  tabItemClick = (tab) => {\n    if (this.state.activeTab !== tab) {\n      if (tab !== 'history' && window.location.hash) {\n        this.setURL('#');\n      }\n      if (tab == 'reviewInfo') {\n        this.initialContent();\n      } else if (tab == 'history') {\n        this.initialDiffViewerContent();\n      }\n      this.setState({\n        activeTab: tab\n      });\n    }\n  }\n\n  showNavItem = (showTab) => {\n    const commentsNumber = this.state.commentsList.length;\n    switch(showTab) {\n      case 'info':\n        return (\n          <NavItem className=\"nav-item\">\n            <NavLink\n              className={classnames({ active: this.state.activeTab === 'reviewInfo' })}\n              onClick={() => { this.tabItemClick('reviewInfo');}}\n            >\n              <i className=\"fas fa-info-circle\"></i>\n            </NavLink>\n          </NavItem>\n        );\n      case 'comments':\n        return (\n          <NavItem className=\"nav-item\">\n            <NavLink\n              className={classnames({ active: this.state.activeTab === 'comments' })}\n              onClick={() => {this.tabItemClick('comments');}}\n            >\n              <i className=\"fa fa-comments\"></i>\n              {commentsNumber > 0 && <div className='comments-number'>{commentsNumber}</div>}\n            </NavLink>\n          </NavItem>\n        );\n      case 'history':\n        return (\n          <NavItem className=\"nav-item\">\n            <NavLink\n              className={classnames({ active: this.state.activeTab === 'history' })}\n              onClick={() => { this.tabItemClick('history');}}\n            >\n              <i className=\"fas fa-history\"></i>\n            </NavLink>\n          </NavItem>\n        );\n    }\n  }\n\n  getDomNodeByPath = (path) => {\n    let node, parent = document.querySelector('.viewer-component');\n    while(typeof path[0] === 'number' && parent) {\n      node = parent.children[path[0]];\n      if (!node.getAttribute('data-slate-node')) {\n        node = node.children[0];\n      }\n      path.shift();\n      parent = node;\n    }\n    return node;\n  }\n\n  setBtnPosition = () => {\n    const nativeSelection = window.getSelection();\n    if (!nativeSelection.rangeCount) {\n      return;\n    }\n    const nativeRange = nativeSelection.getRangeAt(0);\n    let selection = null;\n    let style = this.refs.commentbtn.style;\n    try {\n      selection = findRange(window.viewer, nativeRange);\n    } catch (err) {\n      style.top = '-1000px';\n      return;\n    }\n    if (!selection || Range.isCollapsed(selection)) {\n      style.top = '-1000px';\n      return;\n    }\n    this.range = selection;\n    const focusNodePath = selection.anchor.path.slice();\n    focusNodePath.pop();\n    const focusNode = this.getDomNodeByPath(focusNodePath);\n    style.right = '0px';\n\n    if (focusNode) {\n      style.top = `${focusNode.offsetTop}px`;\n    } else {\n      style.top = '-1000px';\n    }\n  }\n\n  getQuote = () => {\n    if (!this.range) return;\n    this.quote = serialize(Editor.fragment(window.viewer, this.range));\n    const node = window.viewer.children[this.range.anchor.path[0]];\n    this.newIndex = node.data['new_index'];\n    this.oldIndex = node.data['old_index'];\n  }\n\n  componentDidMount() {\n    this.getOriginRepoInfo();\n    this.getDraftInfo();\n    this.listReviewers();\n    this.listComments();\n    this.initialContent();\n    document.addEventListener('selectionchange', this.setBtnPosition);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('selectionchange', this.setBtnPosition);\n  }\n\n  renderDiffButton = () => {\n    switch(draftStatus) {\n      case 'open':\n        if (!draftFileExists || !originFileExists) {\n          return;\n        }\n        return this.showDiffButton();\n      case 'published':\n        if (!originFileExists) {\n          return;\n        }\n        return this.showDiffButton();\n    }\n  }\n\n  renderNavItems = () => {\n    switch (draftStatus) {\n      case 'open':\n        if (!draftFileExists) {\n          return (\n            <Nav tabs className=\"review-side-panel-nav\">\n              {this.showNavItem('info')}\n            </Nav>\n          );\n        }\n\n        return (\n          <Nav tabs className=\"review-side-panel-nav\">\n            {this.showNavItem('info')}\n            {this.showNavItem('comments')}\n            {this.showNavItem('history')}\n          </Nav>\n        );\n      case 'published':\n        if (!originFileExists) {\n          return (\n            <Nav tabs className=\"review-side-panel-nav\">\n              {this.showNavItem('info')}\n            </Nav>\n          );\n        }\n        return (\n          <Nav tabs className=\"review-side-panel-nav\">\n            {this.showNavItem('info')}\n            {this.showNavItem('comments')}\n          </Nav>\n        );\n    }\n  }\n\n  renderContent = () => {\n    switch(draftStatus) {\n      case 'open':\n        if (!draftFileExists) {\n          return <p className=\"error\">{gettext('Draft has been deleted.')}</p>;\n        }\n        return this.showDiffViewer();\n      case 'published':\n        if (!originFileExists) {\n          return <p className=\"error\">{gettext('Original file has been deleted.')}</p>;\n        }\n        return this.showDiffViewer();\n    }\n  }\n\n  render() {\n    const { draftInfo, reviewers, originRepoName, draftStatus } = this.state;\n    const draftLink = siteRoot + 'lib/' + draftRepoID + '/file' + draftFilePath + '?mode=edit';\n    const showPublishedButton = this.state.draftStatus == 'published';\n    const showPublishButton = this.state.draftStatus == 'open' && filePermission == 'rw';\n    const showEditButton = this.state.draftStatus == 'open' && filePermission == 'rw';\n    const time = moment(draftInfo.mtime * 1000).format('YYYY-MM-DD HH:mm');\n    const url = `${siteRoot}profile/${encodeURIComponent(draftInfo.last_modifier_email)}/`;\n    return(\n      <div className=\"wrapper\">\n        <div id=\"header\" className=\"header review\">\n          <div className=\"cur-file-info\">\n            <div className=\"info-item file-feature\">\n              <span className=\"sf2-icon-review\"></span>\n            </div>\n            <div>\n              <div className=\"info-item file-info\">\n                <span className=\"file-name\">{draftFileName}</span>\n                <span className=\"mx-2 file-review\">{gettext('Review')}</span>\n              </div>\n              {(!showPublishedButton && draftInfo.mtime) &&\n                <div className=\"last-modification\">\n                  <a href={url}>{draftInfo.last_modifier_name}</a><span className=\"mx-1\">{time}</span>\n                </div>\n              }\n            </div>\n          </div>\n          <div className=\"button-group\">\n            {this.renderDiffButton()}\n            {showEditButton &&\n              <a href={draftLink} className=\"mx-1\">\n                <Button className=\"file-operation-btn\" color=\"secondary\">{gettext('Edit Draft')}</Button>\n              </a>\n            }\n            {showPublishButton &&\n              <button className='btn btn-success file-operation-btn' title={gettext('Publish draft')} onClick={this.onPublishDraft}>\n                {gettext('Publish')}\n              </button>\n            }\n            {showPublishedButton &&\n              <button className='btn btn-success file-operation-btn' title={gettext('Published')} disabled>\n                {gettext('Published')}\n              </button>\n            }\n          </div>\n        </div>\n        <div id=\"main\" className=\"main\" ref=\"main\">\n          <div className=\"cur-view-container\">\n            <div className='cur-view-content' ref=\"viewContent\">\n              {this.state.isLoading ?\n                <div className=\"markdown-viewer-render-content article\">\n                  <Loading />\n                </div>\n                :\n                <div className=\"markdown-viewer-render-content article\">\n                  {this.renderContent()}\n                </div>\n              }\n            </div>\n            <div className=\"cur-view-right-part\">\n              <div className=\"review-side-panel\">\n                {this.renderNavItems()}\n                <TabContent activeTab={this.state.activeTab}>\n                  <TabPane tabId=\"reviewInfo\">\n                    <div className=\"review-side-panel-body\">\n                      <SidePanelReviewers\n                        reviewers={reviewers}\n                        toggleAddReviewerDialog={this.toggleAddReviewerDialog}/>\n                      <SidePanelAuthor/>\n                      {draftFileExists && <UnresolvedComments commentsList={this.state.commentsList}/>}\n                      {(this.state.isShowDiff === true && this.state.changedNodes.length > 0) &&\n                      <SidePanelChanges\n                        changedNumber={this.state.changedNodes.length}\n                        scrollToChangedNode={this.scrollToChangedNode}/>\n                      }\n                      <SidePanelOrigin originRepoName={originRepoName} draftInfo={draftInfo} draftStatus={draftStatus}/>\n                    </div>\n                  </TabPane>\n                  <TabPane tabId=\"comments\" className=\"comments\">\n                    <ReviewComments\n                      scrollToQuote={this.scrollToQuote}\n                      listComments={this.listComments}\n                      commentsList={this.state.commentsList}\n                      inResizing={false}\n                    />\n                  </TabPane>\n                  <TabPane tabId=\"history\" className=\"history\">\n                    <HistoryList\n                      activeItem={this.state.activeItem}\n                      historyList={this.state.historyList}\n                      totalReversionCount={this.state.totalReversionCount}\n                      onHistoryItemClick={this.onHistoryItemClick}\n                      onHistoryListChange={this.onHistoryListChange}\n                    />\n                  </TabPane>\n                </TabContent>\n              </div>\n            </div>\n          </div>\n        </div>\n        {this.state.showReviewerDialog &&\n          <ModalPortal>\n            <AddReviewerDialog\n              showReviewerDialog={this.state.showReviewerDialog}\n              toggleAddReviewerDialog={this.toggleAddReviewerDialog}\n              draftID={draftID}\n              reviewers={reviewers}\n            />\n          </ModalPortal>\n        }\n        {this.state.isShowCommentDialog &&\n          <ModalPortal>\n            <ReviewCommentDialog\n              toggleCommentDialog={this.toggleCommentDialog}\n              onCommentAdded={this.onCommentAdded}\n              quote={this.quote}\n              newIndex={this.newIndex}\n              oldIndex={this.oldIndex}\n            />\n          </ModalPortal>\n        }\n      </div>\n    );\n  }\n}\n\n\nclass SidePanelReviewers extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const { reviewers } = this.props;\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Reviewers')}\n          <i className=\"fa fa-cog\" onClick={this.props.toggleAddReviewerDialog}></i>\n        </div>\n        {reviewers.length > 0 ?\n          reviewers.map((item, index = 0, arr) => {\n            return (\n              <div className=\"reviewer-info\" key={index}>\n                <img className=\"avatar review-side-panel-avatar\" src={item.avatar_url} alt=\"\"/>\n                <span className=\"reviewer-name ellipsis\">{item.user_name}</span>\n              </div>\n            );\n          })\n          :\n          <span>{gettext('No reviewer yet.')}</span>\n        }\n      </div>\n    );\n  }\n}\n\nconst sidePanelReviewersPropTypes = {\n  reviewers: PropTypes.array.isRequired,\n  toggleAddReviewerDialog: PropTypes.func.isRequired\n};\n\nSidePanelReviewers.propTypes = sidePanelReviewersPropTypes;\n\nclass SidePanelAuthor extends React.Component {\n  render() {\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Author')}</div>\n        <div className=\"author-info\">\n          <img className=\"avatar review-side-panel-avatar\" src={authorAvatar} alt=\"\"/>\n          <span className=\"author-name ellipsis\">{author}</span>\n        </div>\n      </div>\n    );\n  }\n}\n\nclass SidePanelOrigin extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const { draftStatus, originRepoName } = this.props;\n    const filePath = serviceURL + '/lib/' + draftRepoID + '/file' + draftOriginFilePath;\n    return (\n      <div className=\"dirent-table-container\">\n        <table className=\"table-thead-hidden\">\n          <thead>\n            <tr><th width=\"25%\"></th><th width=\"75%\"></th></tr>\n          </thead>\n          <tbody>\n            <tr>\n              <th className=\"align-text-top\">{gettext('Location')}</th>\n              <td>\n                {draftStatus === 'open' ?\n                  <span>{originRepoName}{draftFilePath}</span> :\n                  <a href={filePath} className=\"text-dark\">{filePath}</a>\n                }\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    );\n  }\n}\n\nconst SidePanelOriginPropTypes = {\n  originRepoName: PropTypes.string.isRequired,\n  draftStatus: PropTypes.string.isRequired,\n};\n\nSidePanelOrigin.propTypes = SidePanelOriginPropTypes;\n\n\nclass UnresolvedComments extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const { commentsList } = this.props;\n    let unresolvedNumber = 0;\n    if (commentsList) {\n      for (let i = 0, count = commentsList.length; i < count; i++) {\n        if (commentsList[i].resolved === false) {\n          unresolvedNumber++;\n        }\n      }\n    }\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Comments')}</div>\n        <div className=\"changes-info\">\n          <span>{gettext('Unresolved comments:')}{' '}{unresolvedNumber}</span>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst UnresolvedCommentsPropTypes = {\n  commentsList: PropTypes.array.isRequired,\n};\n\nUnresolvedComments.propTypes = UnresolvedCommentsPropTypes;\n\n\nclass SidePanelChanges extends React.Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className=\"review-side-panel-item\">\n        <div className=\"review-side-panel-header\">{gettext('Changes')}</div>\n        <div className=\"changes-info\">\n          <span>{gettext('Number of changes:')}{' '}{this.props.changedNumber}</span>\n          {this.props.changedNumber > 0 &&\n            <div>\n              <i className=\"fa fa-arrow-circle-up\" onClick={() => { this.props.scrollToChangedNode('down');}}></i>\n              <i className=\"fa fa-arrow-circle-down\" onClick={() => { this.props.scrollToChangedNode('up');}}></i>\n            </div>\n          }\n        </div>\n      </div>\n    );\n  }\n}\n\nconst sidePanelChangesPropTypes = {\n  changedNumber: PropTypes.number.isRequired,\n  scrollToChangedNode: PropTypes.func.isRequired\n};\n\nSidePanelChanges.propTypes = sidePanelChangesPropTypes;\n\n\nReactDom.render(<Draft />, document.getElementById('wrapper'));\n"],"sourceRoot":""}