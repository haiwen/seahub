"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[7004],{99991:function(e,t,a){a.d(t,{A:function(){return v}});var n=a(5544),r=a(9950),o=a(40326),s=a(80415),i=a(12549),u=a(44414),l=function(e){var t=e.recordsCount,a=e.columnsCount,s=e.setHasSearchValue,i=e.searchCells,l=e.onKeyDown,c=(0,r.useState)(""),d=(0,n.default)(c,2),f=d[0],m=d[1],v=(0,r.useRef)(!1),w=(0,r.useRef)(null),p=function(e){w.current&&clearTimeout(w.current);var n=e.target.value,r=function(){var e=(t||0)*(a||0)*.1;return(e=e>500?500:Math.floor(e))<100&&(e=100),e}(),o=n||"",u=o.trim();m(o),s(!!u),v.current||(w.current=setTimeout((function(){i&&i(u)}),r))};return(0,u.jsx)("input",{className:"sf-table-searcher-input form-control",name:"sf-table-search-input",type:"text",autoFocus:!0,value:f,onChange:p,placeholder:(0,o.APU)("Search"),onKeyDown:l,onCompositionStart:function(){v.current=!0},onCompositionEnd:function(e){v.current=!1,p(e)}})},c=a(74361),d=a(61105),f=a(45613),m=a(95754),v=function(e){var t=e.recordsCount,a=e.columnsCount,v=e.searchResult,w=e.searchCells,p=e.closeSearcher,h=e.focusNextMatchedCell,C=e.focusPreviousMatchedCell,b=e.showResultNavigation,g=void 0===b||b,_=(0,r.useState)(!1),y=(0,n.default)(_,2),A=y[0],R=y[1],k=(0,r.useState)(!1),I=(0,n.default)(k,2),T=I[0],M=I[1],D=(0,r.useMemo)((function(){return(0,c.Y)(v)}),[v]),x=(0,r.useCallback)((function(){R(!1),p&&p()}),[p]);return(0,r.useEffect)((function(){var e=window.sfMetadataContext&&window.sfMetadataContext.eventBus,t=e&&e.subscribe(d.Tw.RESET_SEARCH_BAR,x);return function(){t&&t()}}),[x]),(0,u.jsxs)("div",{className:"sf-table-searcher-container",children:[!A&&(0,u.jsx)(f.A,{className:"sf-table-searcher-btn active-search m-0",symbol:"search",title:(0,o.APU)("Search"),op:function(){R(!A)}}),A&&(0,u.jsxs)("div",{className:"sf-table-searcher-input-wrapper",children:[(0,u.jsx)("span",{className:"input-icon-addon",children:(0,u.jsx)(m.A,{symbol:"search"})}),(0,u.jsx)(l,{recordsCount:t,columnsCount:a,onKeyDown:function(e){var t=!D;if(e.keyCode===s.cK.Escape)e.preventDefault(),x();else if((0,i.E5)(e)){if(e.preventDefault(),t)return;h&&h()}else if((0,i.ks)(e)){if(e.preventDefault(),t)return;C&&C()}},setHasSearchValue:M,searchCells:w}),g?(0,u.jsxs)("span",{className:"input-icon-addon search-poll-button",children:[T&&(0,u.jsx)("span",{className:"search-description",children:D?v.currentSelectIndex+1+" of "+v.matchedCells.length:"0 of 0"}),D&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"toolbar-search-btn",role:"button",onClick:C||function(){},children:(0,u.jsx)(m.A,{symbol:"down",className:"rotate-180"})}),(0,u.jsx)("span",{role:"button",className:"toolbar-search-btn",onClick:h||function(){},children:(0,u.jsx)(m.A,{symbol:"down"})})]})]}):null,(0,u.jsx)(f.A,{title:(0,o.APU)("Close"),className:"btn-close-searcher-wrapper input-icon-addon",symbol:"close",op:x})]})]})}},75904:function(e,t,a){a.d(t,{Q1:function(){return R},uR:function(){return w},Qg:function(){return M},EZ:function(){return N},Uy:function(){return P},vj:function(){return F},cw:function(){return I}});var n=a(5544),r=a(9950),o=a(61105),s=a(40326),i=a(48308),u=a(34322),l=a(65488),c=a(95754),d=a(65604),f=a(44414),m=function(e){var t=e.viewID,a=(0,r.useState)((function(){return window.sfMetadataContext.localStorage.getItem(o.fi,0)||0})),i=(0,n.default)(a,2),m=i[0],v=i[1];(0,r.useEffect)((function(){var e=window.sfMetadataContext.localStorage.getItem(o.fi,0);v(e||0)}),[t]);var w=(0,r.useCallback)((function(e){var t=parseInt(e.target.value,10);v(t),window.sfMetadataContext.eventBus.dispatch(o.Tw.MODIFY_GALLERY_ZOOM_GEAR,t)}),[]),p=(0,r.useCallback)((function(){if(!(m>=o.uK)){var e=Math.min(m+1,o.uK);v(e),window.sfMetadataContext.eventBus.dispatch(o.Tw.MODIFY_GALLERY_ZOOM_GEAR,e)}}),[m]),h=(0,r.useCallback)((function(){if(!(m<=o.yp)){var e=Math.max(m-1,o.yp);v(e),window.sfMetadataContext.eventBus.dispatch(o.Tw.MODIFY_GALLERY_ZOOM_GEAR,e)}}),[m]);return(0,f.jsxs)("div",{className:"metadata-slider-container",children:[(0,f.jsx)(u.A,{className:"metadata-slider-icon-button",onClick:h,disabled:m<=o.yp,"aria-label":(0,s.APU)("Zoom out"),title:(0,s.APU)("Zoom out"),onKeyDown:d.Aq.onKeyDown,children:(0,f.jsx)(c.A,{symbol:"minus-sign",className:"metadata-slider-icon"})}),(0,f.jsx)(l.A,{type:"range",tabIndex:-1,"aria-hidden":"true",min:o.yp,max:o.uK,step:"1",value:m,onChange:w,className:"metadata-slider"}),(0,f.jsx)(u.A,{className:"metadata-slider-icon-button",onClick:p,disabled:m>=o.uK,"aria-label":(0,s.APU)("Zoom in"),title:(0,s.APU)("Zoom in"),onKeyDown:d.Aq.onKeyDown,children:(0,f.jsx)(c.A,{symbol:"plus-sign",className:"metadata-slider-icon"})})]})},v=[{value:o._Y.YEAR,label:(0,s.APU)("Year")},{value:o._Y.MONTH,label:(0,s.APU)("Month")},{value:o._Y.DAY,label:(0,s.APU)("Day")},{value:o._Y.ALL,label:(0,s.APU)("All")}],w=function(e){var t=e.viewID,a=(0,r.useState)(o._Y.YEAR),s=(0,n.default)(a,2),u=s[0],l=s[1],c=(0,r.useCallback)((function(e){e!==u&&(window.sfMetadataContext.localStorage.setItem(o.Wr,e),window.sfMetadataContext.eventBus.dispatch(o.Tw.SWITCH_GALLERY_GROUP_BY,e))}),[u]);return(0,r.useEffect)((function(){var e=window.sfMetadataContext.eventBus.subscribe(o.Tw.SWITCH_GALLERY_GROUP_BY,(function(e){e!==u&&l(e)}));return function(){e()}}),[u]),(0,r.useEffect)((function(){var e=window.sfMetadataContext.localStorage.getItem(o.Wr,o._Y.DAY);l(e||o._Y.DAY)}),[t]),(0,f.jsxs)(f.Fragment,{children:[u===o._Y.ALL&&(0,f.jsx)(m,{viewID:t}),(0,f.jsx)(i.A,{className:"sf-metadata-gallery-groupby-setter",value:u,options:v,onChange:c})]})},p=a(48738),h=a.n(p),C=a(55097),b=a.n(C),g=a(49867),_=a(73737),y=a(42146),A=a(12549),R=function(e){var t=e.readOnly,a=e.columns,i=e.wrapperClass,u=e.filters,l=e.isPre,c=e.collaborators,d=e.filtersClassName,m=e.target,v=void 0===m?"sf-metadata-filter-popover":m,w=e.filterConjunction,p=e.basicFilters,C=void 0===p?[]:p,R=e.modifyFilters,k=e.viewType,I=void 0===k?o.rX.TABLE:k,T=(0,r.useState)(!1),M=(0,n.default)(T,2),D=M[0],x=M[1],E=(0,r.useMemo)((function(){return b()((0,y.a1)(u||[],a))}),[u,a]),S=(0,r.useMemo)((function(){return E.length+C.length}),[E,C]),O=(0,r.useMemo)((function(){return 1===S?(0,s.APU)("1 filter"):S>1?S+" "+(0,s.APU)("Filters"):(0,s.APU)("Filter")}),[S]),N=(0,r.useCallback)((function(){x(!D)}),[D]),L=(0,r.useCallback)((function(e){e.stopPropagation(),((0,A.RI)(e)||(0,A.xC)(e))&&N()}),[N]),P=(0,r.useCallback)((function(e){var t=e||{},n=t.filters,r=t.filter_conjunction,o=t.basic_filters,s=(0,y.a1)(n,a);R(s,r,o)}),[a,R]);if(!a)return null;var j=h()(i,{active:S>0});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(g.A,{symbol:"filter",size:24,className:j,onClick:N,role:"button",onKeyDown:L,title:O,"aria-label":O,tabIndex:0,id:v}),D&&(0,f.jsx)(_.Iz,{placement:"bottom-end",filtersClassName:d,target:v,readOnly:t,columns:a,collaborators:c,filterConjunction:w,filters:E,basicFilters:C,hidePopover:N,update:P,isPre:l,viewType:I})]})},k=a(12455),I=function(e){var t=e.target,a=void 0===t?"sf-metadata-sort-popover":t,i=e.type,u=e.sorts,l=e.readOnly,c=e.columns,m=e.wrapperClass,v=e.modifySorts,w=(0,r.useState)(!1),p=(0,n.default)(w,2),C=p[0],b=p[1],y=(0,r.useMemo)((function(){return(0,k.iW)(u||[],c)}),[u,c]),A=(0,r.useMemo)((function(){var e=y.length;return 1===e?(0,s.APU)("1 sort"):e>1?e+" "+(0,s.APU)("sorts"):(0,s.APU)("Sort")}),[y]),R=(0,r.useCallback)((function(){b(!0)}),[]);(0,r.useEffect)((function(){var e=window.sfMetadataContext.eventBus.subscribe(o.Tw.DISPLAY_SORTS,R);return function(){e()}}),[]);var I=(0,r.useCallback)((function(){b(!C)}),[C]),T=(0,r.useCallback)((function(e){var t=(e||{}).sorts;v(t)}),[v]);return c?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(g.A,{symbol:"sort",size:24,className:h()(m,{active:y.length>0}),onClick:I,tabIndex:0,role:"button",onKeyDown:d.Aq.onKeyDown,title:A,"aria-label":(0,s.APU)("Sort"),id:a}),C&&(0,f.jsx)(_.cu,{readOnly:l,type:i,target:a,columns:c,sorts:y,hidePopover:I,update:T})]}):null},T=a(3277),M=function(e){var t=e.target,a=void 0===t?"sf-metadata-groupby-popover":t,i=e.columns,u=e.readOnly,l=e.groupbys,c=e.wrapperClass,d=e.modifyGroupbys,m=(0,r.useState)(!1),v=(0,n.default)(m,2),w=v[0],p=v[1],C=(0,r.useMemo)((function(){return i.filter((function(e){return o.Ll.includes(e.type)}))}),[i]),b=(0,r.useMemo)((function(){return(0,T.YD)(l,C)||[]}),[C,l]),y=(0,r.useMemo)((function(){var e=b?b.length:0;return 1===e?(0,s.APU)("Grouped by 1 property"):e>1?(0,s.APU)("Grouped by {name_placeholder} properties").replace("{name_placeholder}",e):(0,s.APU)("Group by")}),[b]),R=(0,r.useCallback)((function(){p(!w)}),[w]),k=(0,r.useCallback)((function(e){e.stopPropagation(),((0,A.RI)(e)||(0,A.xC)(e))&&R()}),[R]),I=(0,r.useCallback)((function(e){var t=(0,T.YD)(e,C);d(t)}),[C,d]),M=h()(c,{active:b.length>0});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(g.A,{symbol:"groupby",size:24,className:M,onClick:R,role:"button",onKeyDown:k,title:y,"aria-label":y,tabIndex:0,id:a}),w&&(0,f.jsx)(_.D0,{readOnly:u,groupbys:b,target:a,placement:"bottom-end",columns:C,hidePopover:R,onChange:I})]})},D=a(23029),x=a(92901),E=a(39874),S=a(85501),O=(r.Component,a(75150)),N=function(e){var t=e.readOnly,a=e.columns,i=e.wrapperClass,u=e.target,l=e.hiddenColumns,c=e.modifyHiddenColumns,d=e.modifyColumnOrder,m=(0,r.useState)(!1),v=(0,n.default)(m,2),w=v[0],p=v[1],C=(0,O.nk)().globalHiddenColumns,b=(0,r.useMemo)((function(){return a.filter((function(e){return!o.of.includes(e.key)&&!C.includes(e.key)}))}),[a,C]),y=(0,r.useMemo)((function(){return l.filter((function(e){return a.find((function(t){return t.key===e}))}))}),[a,l]),R=(0,r.useMemo)((function(){var e=y.length;return 1===e?(0,s.APU)("1 hidden property"):e>1?(0,s.APU)("{name_placeholder} hidden properties").replace("{name_placeholder}",e):(0,s.APU)("Hide properties")}),[y]),k=(0,r.useCallback)((function(){p(!w)}),[w]),I=(0,r.useCallback)((function(e){e.stopPropagation(),((0,A.RI)(e)||(0,A.xC)(e))&&k()}),[k]),T=(0,r.useCallback)((function(e){c(e)}),[c]),M=h()(i,{active:y.length>0});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(g.A,{symbol:"hide",size:24,className:M,onClick:k,role:"button",onKeyDown:I,title:R,"aria-label":R,tabIndex:0,id:u}),w&&(0,f.jsx)(_.Oe,{readOnly:t,hiddenColumns:y,target:u,placement:"bottom-end",columns:b,hidePopover:k,onChange:T,modifyColumnOrder:d})]})},L=[{value:o.K$.MAP,label:(0,s.APU)("Map")},{value:o.K$.SATELLITE,label:(0,s.APU)("Satellite")}],P=function(e){var t=e.viewID,a=(0,r.useState)(o.K$.MAP),s=(0,n.default)(a,2),u=s[0],l=s[1];(0,r.useEffect)((function(){var e=window.sfMetadataContext.localStorage.getItem(o.q8)||o.K$.MAP;l(e)}),[t]);var c=(0,r.useCallback)((function(e){u!==e&&(l(e),window.sfMetadataContext.eventBus.dispatch(o.Tw.MODIFY_MAP_TYPE,e))}),[u]);return(0,f.jsx)(i.A,{className:"sf-metadata-map-type-setter",options:L,value:u,onChange:c})},j=a(99991),F=function(e){var t=e.viewId,a=e.columns,s=(0,r.useState)(null),i=(0,n.default)(s,2),u=i[0],l=i[1],c=(0,r.useState)(""),d=(0,n.default)(c,2),m=d[0],v=d[1],w=(0,r.useMemo)((function(){var e,t;return(null===(e=window.sfMetadataStore)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.records_count)||0}),[]),p=(0,r.useMemo)((function(){return(null===a||void 0===a?void 0:a.length)||0}),[a]),h=(0,r.useCallback)((function(e){v(e),window.sfMetadataContext.eventBus&&window.sfMetadataContext.eventBus.dispatch(o.Tw.SEARCH_ROWS,e,(function(e){l(e)}))}),[]),C=(0,r.useCallback)((function(){v(""),l(null),window.sfMetadataContext.eventBus&&window.sfMetadataContext.eventBus.dispatch(o.Tw.SEARCH_ROWS)}),[]);return(0,r.useEffect)((function(){var e;if(null!==(e=window.sfMetadataContext)&&void 0!==e&&e.eventBus)return window.sfMetadataContext.eventBus.subscribe(o.Tw.RESET_SEARCH_BAR,(function(){v(""),l(null)}))}),[]),(0,r.useEffect)((function(){var e;v(""),l(null),null!==(e=window.sfMetadataContext)&&void 0!==e&&e.eventBus&&window.sfMetadataContext.eventBus.dispatch(o.Tw.SEARCH_ROWS,"")}),[t]),(0,f.jsx)(j.A,{recordsCount:w,columnsCount:p,searchResult:u,searchCells:h,closeSearcher:C,showResultNavigation:!1,searchValue:m},t)}},15847:function(e,t,a){var n=a(9950),r=a(75904),o=a(61105),s=a(75150),i=a(44414);t.A=function(e){var t=e.readOnly,a=e.view,u=e.collaborators,l=e.modifyFilters,c=e.modifySorts,d=e.modifyGroupbys,f=e.modifyHiddenColumns,m=e.modifyColumnOrder,v=(0,s.nk)().globalHiddenColumns,w=(0,n.useMemo)((function(){return a.type}),[a]),p=(0,n.useMemo)((function(){return a?a.columns.filter((function(e){return!v.includes(e.key)})):[]}),[a,v]),h=(0,n.useMemo)((function(){return p.filter((function(e){return e.key!==o.L2.FILE_TYPE}))}),[p]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"sf-metadata-tool-left-operations",children:[(0,i.jsx)(r.vj,{viewId:a._id,columns:p}),(0,i.jsx)(r.Q1,{wrapperClass:"sf-metadata-view-tool-operation-btn sf-metadata-view-tool-filter",filtersClassName:"sf-metadata-filters",target:"sf-metadata-filter-popover",readOnly:t,filterConjunction:a.filter_conjunction,basicFilters:a.basic_filters,filters:a.filters,columns:h,modifyFilters:l,collaborators:u,viewType:w}),(0,i.jsx)(r.cw,{wrapperClass:"sf-metadata-view-tool-operation-btn sf-metadata-view-tool-sort",target:"sf-metadata-sort-popover",readOnly:t,sorts:a.sorts,type:w,columns:p,modifySorts:c}),(0,i.jsx)(r.Qg,{wrapperClass:"sf-metadata-view-tool-operation-btn sf-metadata-view-tool-groupby",target:"sf-metadata-groupby-popover",readOnly:t,columns:p,groupbys:a.groupbys,modifyGroupbys:d}),(0,i.jsx)(r.EZ,{wrapperClass:"sf-metadata-view-tool-operation-btn sf-metadata-view-tool-hide-column",target:"sf-metadata-hide-column-popover",readOnly:t,columns:p.slice(1),hiddenColumns:a.hidden_columns||[],modifyHiddenColumns:f,modifyColumnOrder:m})]}),(0,i.jsx)("div",{className:"sf-metadata-tool-right-operations"})]})}},28360:function(e,t,a){var n=a(9950),r=a(1352),o=a(5544),s=a(17065),i=a(72500),u=a(24765),l=a(64467),c=a(89379),d=a(80045),f=a(4086),m=a(51112),v=a(61105),w=a(65604),p=a(44049),h=a(10222),C=a(48621),b=a(87364),g=a(11037),_=a(1560),y=a(40326),A=a(27404),R=a(75150),k=a(74361),I=a(62822),T=a(10467),M=a(23029),D=a(92901),x=a(146),E=a(72249),S=a(11238),O=a(90287),N=a(49211),L=function(){return(0,D.default)((function e(){var t=this;(0,M.default)(this,e),this.getCollaborators=function(e){var a=t.server+"/api/v2.1/repos/"+e+"/related-users/";return t.req.get(a)},this.listUserInfo=function(e){var a=t.server+"/api/v2.1/user-list/",n={user_id_list:e};return t._sendPostRequest(a,n,{headers:{"Content-type":"application/json"}})}}),[{key:"init",value:function(e){var t=e.server,a=e.username,n=e.password,r=e.token;return this.server=t,this.username=a,this.password=n,this.token=r,this.token&&this.server&&(this.req=O.A.create({baseURL:this.server,headers:{Authorization:"Token "+this.token}})),this}},{key:"initForSeahubUsage",value:function(e){var t=e.siteRoot,a=e.xcsrfHeaders;if(t&&"/"===t.charAt(t.length-1)){var n=t.substring(0,t.length-1);this.server=n}else this.server=t;return this.req=O.A.create({headers:{"X-CSRFToken":a}}),this}},{key:"_sendPostRequest",value:function(e,t){return t.getHeaders?this.req.post(e,t,{headers:t.getHeaders()}):this.req.post(e,t)}},{key:"getMetadata",value:function(e,t,a){var n=this.server+"/api/v2.1/wiki2/"+e+"/views/"+t+"/records/";return this.req.get(n,{params:a})}},{key:"getView",value:function(e,t){var a=this.server+"/api/v2.1/wiki2/"+e+"/views/"+t+"/";return this.req.get(a)}},{key:"modifyView",value:function(e,t,a){var n=this.server+"/api/v2.1/wiki2/"+e+"/views/",r={view_id:t,view_data:a};return this.req.put(n,r)}}])}(),P=new L,j=N.A.get("sfcsrftoken");P.initForSeahubUsage({siteRoot:y.YcY,xcsrfHeaders:j});var F=P,B=window.app.pageOptions.wikiID,U=function(){return(0,D.default)((function e(){var t=this;(0,M.default)(this,e),this.destroy=function(){t.settings={},t.metadataAPI=null,t.tagsAPI=null,t.localStorage=null,t.eventBus=null,t.hasInit=!1,t.permission="r"},this.getSetting=function(e){return!1===t.settings[e]?t.settings[e]:t.settings[e]||""},this.setSetting=function(e,a){t.settings[e]=a},this.getUsername=function(){return y.Xh_},this.updateFileTags=function(e){var a=t.settings.repoID;return t.tagsAPI.updateFileTags(a,e)},this.getCollaborators=function(){var e=t.settings.repoID;return t.metadataAPI.getCollaborators(e)},this.getMetadata=function(e){if(!t.metadataAPI)return null;var a=e.view_id;return t.metadataAPI.getMetadata(B,a,e)},this.getView=function(e){return t.metadataAPI.getView(B,e)},this.modifyView=function(e,a,n){return t.metadataAPI.modifyView(B,a,n)},this.canInsertColumn=function(){return!1},this.canModify=function(){return!1},this.canModifyRow=function(){return!1},this.canModifyColumn=function(){return!1},this.canModifyColumnOrder=function(){return!1},this.canModifyRows=function(){return!1},this.canPreview=function(){return!1},this.canModifyView=function(){return"r"!==t.permission},this.settings={lang:y.vVe},this.metadataAPI=null,this.tagsAPI=null,this.localStorage=null,this.eventBus=null,this.hasInit=!1,this.permission="r",this.collaboratorsCache={}}),[{key:"init",value:function(){var e=(0,T.default)((0,I.A)().mark((function e(t){var a,n,r,o,s,i;return(0,I.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasInit){e.next=2;break}return e.abrupt("return");case 2:this.settings=(0,c.default)((0,c.default)({},this.settings),t),this.metadataAPI=F,this.tagsAPI=S.A,a=this.settings.repoInfo,this.permission="admin"!==a.permission&&"rw"!==a.permission?"r":"rw",n=this.settings,r=n.repoID,o=n.viewID,s=o?"sf-metadata-".concat(r,"-").concat(o):"sf-metadata-".concat(r),this.localStorage=new x.A(s),i=new E.A,this.eventBus=i,this.hasInit=!0;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}])}(),G=U,Y=a(44414),H=["children","repoID","viewID","renameFileCallback","deleteFilesCallback","moveFileCallback","copyFileCallback","toggleShowDirentToolbar"],V=["subgroups","row_ids"],q=n.createContext(null),K=function(e){var t=e.children,a=e.repoID,r=e.viewID,s=e.renameFileCallback,i=e.deleteFilesCallback,I=e.moveFileCallback,T=e.copyFileCallback,M=e.toggleShowDirentToolbar,D=(0,d.default)(e,H),x=(0,n.useState)(!0),E=(0,o.default)(x,2),S=E[0],O=E[1],N=(0,n.useState)({rows:[],columns:[],view:{}}),L=(0,o.default)(N,2),P=L[0],j=L[1],F=(0,n.useState)(null),B=(0,o.default)(F,2),U=B[0],K=B[1],Z=(0,A.PL)().modifyLocalFileTags,W=(0,n.useState)({searchValue:"",searchResult:null,isActive:!1,lastSearchMetadata:null}),z=(0,o.default)(W,2),Q=z[0],X=z[1],$=(0,h.D)(),J=$.collaborators,ee=$.collaboratorsCache,te=(0,p.p)(),ae=te.isBeingBuilt,ne=te.setIsBeingBuilt,re=(0,R.Tz)(),oe=re.onOCR,se=re.generateDescription,ie=re.extractFilesDetails,ue=re.faceRecognition,le=re.generateFileTags,ce=(0,R.nk)().globalHiddenColumns,de=(0,n.useRef)(null),fe=(0,n.useRef)(null),me=(0,n.useRef)(J),ve=(0,n.useCallback)((function(e){return!(!Q.isActive||!Q.searchValue)&&(0,v.yj)(e)}),[Q.isActive,Q.searchValue]),we=(0,n.useCallback)((function(){X({searchValue:"",searchResult:null,isActive:!1,lastSearchMetadata:null})}),[]),pe=(0,n.useCallback)((function(e){X((function(t){return(0,c.default)((0,c.default)({},t),e)}))}),[]),he=(0,n.useRef)(null),Ce=(0,n.useCallback)((function(e){var t,a;he.current?he.current(e):(null!==(t=de.current)&&void 0!==t&&t.data&&j(de.current.data),Q.isActive&&(we(),null!==(a=window.sfMetadataContext)&&void 0!==a&&a.eventBus&&window.sfMetadataContext.eventBus.dispatch(v.Tw.RESET_SEARCH_BAR)))}),[Q.isActive,we]),be=(0,n.useCallback)((function(){Ce(v.Tw.LOCAL_TABLE_CHANGED)}),[Ce]),ge=(0,n.useCallback)((function(){Ce(v.Tw.SERVER_TABLE_CHANGED)}),[Ce]),_e=(0,n.useCallback)((function(e){f.A.danger(e.error)}),[]),ye=(0,n.useCallback)((function(e){Ce(v.Tw.UPDATE_TABLE_ROWS)}),[Ce]),Ae=(0,n.useCallback)((function(){O(!0),de.current.reload(v.bK).then((function(){O(!1),fe.current=null,Ce(v.Tw.RELOAD_DATA)})).catch((function(e){var t=w.Aq.getErrorMsg(e);K(t),O(!1)}))}),[Ce]),Re=(0,n.useCallback)((function(){fe.current&&clearTimeout(fe.current),fe.current=setTimeout((function(){Ae()}),600)}),[Ae]),ke=(0,n.useCallback)((function(e,t,a){de.current.modifyFilters(t,e,a),setTimeout((function(){return Ce(v.Tw.MODIFY_FILTERS)}),0)}),[de,Ce]),Ie=(0,n.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];de.current.modifySorts(e,t),setTimeout((function(){return Ce(v.Tw.MODIFY_SORTS)}),0)}),[de,Ce]),Te=(0,n.useCallback)((function(e){de.current.modifyGroupbys(e),setTimeout((function(){return Ce(v.Tw.MODIFY_GROUPBYS)}),0)}),[de,Ce]),Me=(0,n.useCallback)((function(e){de.current.modifyHiddenColumns(e),setTimeout((function(){return Ce(v.Tw.MODIFY_HIDDEN_COLUMNS)}),0)}),[de,Ce]),De=(0,n.useCallback)((function(e){de.current.modifySettings(e),setTimeout((function(){return Ce(v.Tw.MODIFY_SETTINGS)}),0)}),[de,Ce]),xe=(0,n.useCallback)((function(e,t){var a=e.recordId,n=e.parentDir,r=e.fileName;de.current.modifyLocalRecord({record_id:a,parent_dir:n,file_name:r},t),setTimeout((function(){return Ce(v.Tw.LOCAL_RECORD_CHANGED)}),0)}),[de,Ce]),Ee=(0,n.useCallback)((function(e,t,a){de.current.modifyLocalColumnData(e,t,a),setTimeout((function(){return Ce(v.Tw.LOCAL_COLUMN_DATA_CHANGED)}),0)}),[Ce]),Se=(0,n.useCallback)((function(e,t,a,n,r){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},u=i.success_callback,l=i.fail_callback,c=de.current.checkIsRenameFileOperator(e,a),d=null;if(c){var m=e[0],v=(0,C.f)(P,m),p=a[m],h=v._parent_dir,g=v._name;d=(0,b.NZ)(p);var _=(0,w.yS)(d),A=_.isValid,R=_.errMessage;if(!A)return void f.A.danger(R);if(d===g)return;if(de.current.checkDuplicatedName(d,h)){var k=(0,y.APU)('The name "{name}" is already taken. Please choose a different name.');return k=k.replace("{name}",w.Aq.HTMLescape(d)),void f.A.danger(k)}}de.current.modifyRecords(e,t,a,n,r,o,c,{fail_callback:function(e){l&&l(e),e&&f.A.danger(e)},success_callback:function(e){if(e.is_rename){var t=e.row_ids[0],a=(0,C.f)(P,t),n=e.id_original_row_updates[t],r=e.id_original_old_row_data[t],o=(0,b.ND)(a),i=(0,b.NZ)(r),l=w.Aq.joinPath(o,i),c=(0,b.NZ)(n);s(l,c)}u&&u()}})}),[P,de,s]),Oe=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.success_callback,r=a.fail_callback;if(Array.isArray(e)&&0!==e.length){var o=[],s=[],u=(null===(t=de.current)||void 0===t?void 0:t.data)||P;e.forEach((function(e){var t=(0,C.f)(u,e)||{},a=t._parent_dir,n=t._name;if(a&&n){var r=w.Aq.joinPath(a,n);o.push(r),s.push(n)}})),de.current.deleteRecords(e,{fail_callback:function(e){r&&r(e),e&&f.A.danger(e)},success_callback:function(){i(o,s);var e=s.length>1?(0,y.APU)("Successfully deleted {name} and {n} other items"):(0,y.APU)("Successfully deleted {name}");e=e.replace("{name}",s[0]).replace("{n}",s.length-1),f.A.success(e),n&&n()}})}},Ne=function(e,t,n,r,o,s){var i=t.repo_id,u=(0,C.f)(P,e),c=P.rows,d=(0,_.o4)(u),m=n.name,p=w.Aq.joinPath(o,m),h=[],g=[],y={},A={};if(a===i){var R=(0,b.$5)(c,r,m);if(g.push(e),y[e]=(0,l.default)((0,l.default)({},v.L2.PARENT_DIR,r),v.L2.FILE_NAME,R),A[e]=(0,l.default)((0,l.default)({},v.L2.PARENT_DIR,o),v.L2.FILE_NAME,m),d){var k=w.Aq.joinPath(r,R);c.forEach((function(e){var t=(0,b.ND)(e);if(e&&t.startsWith(p)){var a=(0,b.sq)(e);g.push(a),y[a]=(0,l.default)({},v.L2.PARENT_DIR,t.replace(p,k)),A[a]=(0,l.default)({},v.L2.PARENT_DIR,t)}}))}}else h=[e],d&&c.forEach((function(e){var t=(0,b.ND)(e);if(e&&t.startsWith(p)){var a=(0,b.sq)(e);h.push(a)}}));de.current.moveRecord(e,i,n,r,o,{modify_row_ids:g,modify_id_row_updates:y,modify_id_old_row_data:A,delete_row_ids:h},{success_callback:function(e){I&&I(a,t,n,r,o,e.task_id,s)},fail_callback:function(e){e&&f.A.danger(e)}})},Le=function(e,t,n,r,o,s){de.current.duplicateRecord(e,t.repo_id,n,r,o,{success_callback:function(e){T&&T(a,t,n,r,o,e.task_id,s),a===t.repo_id&&Re()},fail_callback:function(e){e&&f.A.danger(e)}})},Pe=(0,n.useCallback)((function(e,t,a){de.current.renameColumn(e,t,a)}),[de]),je=(0,n.useCallback)((function(e,t){de.current.deleteColumn(e,t)}),[de]),Fe=(0,n.useCallback)((function(e,t,a){var n=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).optionModifyType;de.current.modifyColumnData(e,t,a,{optionModifyType:n})}),[de]),Be=(0,n.useCallback)((function(e,t){de.current.modifyColumnWidth(e,t)}),[de]),Ue=(0,n.useCallback)((function(e,t){de.current.modifyColumnOrder(e,t),setTimeout((function(){return Ce(v.Tw.MODIFY_COLUMN_ORDER)}),0)}),[de,Ce]),Ge=(0,n.useCallback)((function(e,t,a){var n=a.key,r=a.data;de.current.insertColumn(e,t,{key:n,data:r})}),[de]),Ye=(0,n.useCallback)((function(e){var t=e[0],a=t.record_id,n=t.tags;Z(a,n),de.current.updateFileTags(e)}),[de,Z]),He=(0,n.useCallback)((function(e,t){M(e.length>0),setTimeout((function(){window.sfMetadataContext&&window.sfMetadataContext.eventBus&&window.sfMetadataContext.eventBus.dispatch(v.Tw.SELECT_RECORDS,e,P,t)}),0)}),[P,M]),Ve=(0,n.useCallback)((function(e){var t=e.map((function(e){return(0,b.ql)(e)}));if(t.length>50)f.A.danger((0,y.APU)("Select up to 50 files"));else{var a=e.map((function(e){return(0,b.sq)(e)}));ie(t,{success_callback:function(t){var n,r=t.details,o={},s={},i={},u={},l=v.L2.CAPTURE_TIME,c=v.L2.LOCATION,d=(null===(n=de.current)||void 0===n?void 0:n.data)||P,f=(0,g.rm)(d.columns,v.L2.CAPTURE_TIME),m=(0,g.rm)(d.columns,v.L2.LOCATION);e.forEach((function(e){var t=e[v.L2.ID];o[t]={},s[t]={},f&&(o[t][l]=e[l],s[t][l]=e[l]),m&&(o[t][c]=e[c],s[t][c]=e[c],e._location_translated&&(o[t]._location_translated=e._location_translated,s[t]._location_translated=e._location_translated))})),r.forEach((function(e){var t=e[v.L2.ID];i[t]={},u[t]={},f&&(i[t][l]=e[l],u[t][l]=e[l]),m&&(i[t][c]=e[c],u[t][c]=e[c],e._location_translated&&(i[t]._location_translated=e._location_translated,u[t]._location_translated=e._location_translated))})),Se(a,i,u,o,s)}})}}),[P,ie,Se]),qe=(0,n.useCallback)((function(e){var t=e.map((function(e){return(0,b.ql)(e)}));t.length>50?f.A.danger((0,y.APU)("Select up to 50 files")):ue(t)}),[ue]),Ke=(0,n.useCallback)((function(e){var t=(0,b.ND)(e),a=(0,b.NZ)(e),n=(0,b.sq)(e);if(a&&t&&w.Aq.isDescriptionSupportedFile(a)){var r=v.L2.FILE_DESCRIPTION,o=(0,l.default)({},e[v.L2.ID],(0,l.default)({},r,e[r])),s=(0,l.default)({},e[v.L2.ID],(0,l.default)({},r,e[r]));se({parentDir:t,fileName:a,recordId:n},{success_callback:function(t){var a=t.description,n=e[v.L2.ID],i=[n],u={},c={};u[n]=(0,l.default)({},r,a),c[n]=(0,l.default)({},r,a),Se(i,u,c,o,s)}})}}),[Se,se]),Ze=(0,n.useCallback)((function(e,t){var a=(0,b.ND)(e);if((0,b.NZ)(e)&&a){var n=v.L2.FILE_DESCRIPTION,r=(0,l.default)({},e[v.L2.ID],(0,l.default)({},n,e[n])),o=(0,l.default)({},e[v.L2.ID],(0,l.default)({},n,e[n]));oe(e,{success_callback:function(t){if(t){var a=e[v.L2.ID],s=[a],i={},u={};i[a]=(0,l.default)({},n,t||null),u[a]=(0,l.default)({},n,t||null),Se(s,i,u,r,o)}}},t)}}),[Se,oe]),We=(0,n.useCallback)((function(e){var t=(0,b.ND)(e);(0,b.NZ)(e)&&t&&le(e,{success_callback:Ye})}),[Ye,le]),ze=(0,n.useCallback)((function(e,t,a,n,r){var o,s=t.type,i=(0,b.Te)(e,t);if(!i)return"";switch(s){case v.vZ.GEOLOCATION:return(null===(o=e._location_translated)||void 0===o?void 0:o.address)||"";case v.vZ.COLLABORATOR:return(0,b.LY)(a,i);case v.vZ.LAST_MODIFIER:case v.vZ.CREATOR:var u=a.find((function(e){return e.email===i}))||r[i];return(null===u||void 0===u?void 0:u.name)||i;case v.vZ.NUMBER:return(0,b.HL)(i,t.data);case v.vZ.TAGS:return(null===i||void 0===i?void 0:i.map((function(e){var t=null===n||void 0===n?void 0:n.rows.find((function(t){return t._id===e.row_id}));return null===t||void 0===t?void 0:t._tag_name})).filter(Boolean).join(", "))||"";default:return String(i)}}),[]),Qe=(0,n.useCallback)((function(e,t){return Array.isArray(e)?e.map((function(e){var a=e.subgroups,n=e.row_ids,r=(0,d.default)(e,V);if(a&&a.length>0){var o=Qe(a,t);return(0,c.default)((0,c.default)({},r),{},{subgroups:o.filter((function(e){return e.subgroups&&e.subgroups.length>0||e.row_ids&&e.row_ids.length>0}))})}if(n&&n.length>0){var s=n.filter((function(e){return t.includes(e)}));return(0,c.default)((0,c.default)({},r),{},{row_ids:s})}return e})).filter((function(e){return e.subgroups&&e.subgroups.length>0||e.row_ids&&e.row_ids.length>0})):e}),[]),Xe=(0,n.useCallback)((function(e,t,a,n,r,o){var s={matchedCells:[],matchedRows:{},currentSelectIndex:0},i=!1;return e.rows.forEach((function(e,l){var c,d=(0,u.default)(t);try{for(d.s();!(c=d.n()).done;){var f=c.value,m=ze(e,f,n,r,o);if(a.test(m)){i=!0,s.matchedRows[e._id]||(s.matchedRows[e._id]=[]),s.matchedRows[e._id].push(f.key),s.matchedCells.push({rowId:e._id,columnKey:f.key,value:m,rowIndex:l});break}}}catch(v){d.e(v)}finally{d.f()}})),{searchResult:s,hasMatches:i}}),[ze]),$e=(0,n.useCallback)((function(e,t,a){return a?(0,c.default)((0,c.default)({},e),{},{row_ids:t,rows:t.map((function(t){return e.id_row_map[t]})).filter(Boolean),view:(0,c.default)((0,c.default)({},e.view),{},{rows:t},e.view.groups&&{groups:Qe(e.view.groups,t)})}):(0,c.default)((0,c.default)({},e),{},{row_ids:[],rows:[],view:(0,c.default)((0,c.default)({},e.view),{},{rows:[]},e.view.groups&&{groups:[]})})}),[Qe]),Je=(0,n.useCallback)((function(e,t){var a;if(!e||!t)return t;var n=(0,k.R)(e);if(!n)return t;var r=t.view,o=r.columns,s=r.hidden_columns,i=o.filter((function(e){return!ce.includes(e.key)&&!s.includes(e.key)&&!v.of.includes(e.key)&&v.vz.includes(e.type)}));if(!i.length)return t;var u=me.current,l=null===(a=window.sfTagsDataStore)||void 0===a?void 0:a.data,d=Xe(t,i,n,u,l,ee),f=d.searchResult,m=d.hasMatches,w=Object.keys(f.matchedRows),p=$e(t,w,m);return X((function(e){return(0,c.default)((0,c.default)({},e),{},{searchResult:f,lastSearchMetadata:t})})),p}),[ce,ee,Xe,$e]),et=(0,n.useCallback)((function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"UNKNOWN";if(null!==(e=de.current)&&void 0!==e&&e.data){var a=de.current.data;if(ve(t))if(Q.searchValue){var n=Je(Q.searchValue,a);j(n)}else j(a);else j(a),Q.isActive&&(we(),window.sfMetadataContext.eventBus.dispatch(v.Tw.RESET_SEARCH_BAR))}}),[Q,ve,Je,we]);he.current=et;var tt=(0,n.useCallback)((function(e,t){var a,n,r=null===(a=de.current)||void 0===a?void 0:a.data,o=null===(n=window.sfTagsDataStore)||void 0===n?void 0:n.data;if(r&&r.rows&&r.view&&r.view.columns){if(!e||!r.rows.length)return X({searchValue:"",searchResult:null,isActive:!1,lastSearchMetadata:null}),j(r),void(t&&t(null));var s=(0,k.R)(e);if(!s)return X({searchValue:"",searchResult:null,isActive:!1,lastSearchMetadata:null}),j(r),void(t&&t(null));var i=r.view,u=i.columns,l=i.hidden_columns,c=u.filter((function(e){return!ce.includes(e.key)&&!l.includes(e.key)&&!v.of.includes(e.key)&&v.vz.includes(e.type)}));if(!c.length)return t&&t(null),void j(r);var d=me.current,f=Xe(r,c,s,d,o,ee),m=f.searchResult,w=f.hasMatches,p=Object.keys(m.matchedRows),h=$e(r,p,w);X({searchValue:e,searchResult:m,isActive:!0,lastSearchMetadata:r}),j(h),t&&t(m)}else t&&t(null)}),[ce,ee,$e,Xe]);return(0,n.useEffect)((function(){Q.isActive&&X({searchValue:"",searchResult:null,isActive:!1,lastSearchMetadata:null}),O(!0);var e=new G;window.sfMetadataContext=e,window.sfMetadataContext.init((0,c.default)((0,c.default)({},D),{},{repoID:a,viewID:r})),de.current=new m.A({context:window.sfMetadataContext,repoId:a,viewId:r,collaborators:J}),window.sfMetadataStore=de.current,de.current.initStartIndex(),de.current.load(v.bK,ae).then((function(){j(de.current.data),ne(!1),O(!1)})).catch((function(e){var t=w.Aq.getErrorMsg(e);f.A.danger(t)}));var t=window.sfMetadataContext.eventBus,n=t.subscribe(v.Tw.SERVER_TABLE_CHANGED,ge),o=t.subscribe(v.Tw.LOCAL_TABLE_CHANGED,be),s=t.subscribe(v.Tw.TABLE_ERROR,_e),i=t.subscribe(v.Tw.UPDATE_TABLE_ROWS,ye),u=t.subscribe(v.Tw.RELOAD_DATA,Ae),l=t.subscribe(v.Tw.MODIFY_FILTERS,ke),d=t.subscribe(v.Tw.MODIFY_SORTS,Ie),p=t.subscribe(v.Tw.MODIFY_GROUPBYS,Te),h=t.subscribe(v.Tw.MODIFY_HIDDEN_COLUMNS,Me),C=t.subscribe(v.Tw.MODIFY_COLUMN_ORDER,Ue),b=t.subscribe(v.Tw.MODIFY_SETTINGS,De),g=t.subscribe(v.Tw.LOCAL_RECORD_CHANGED,xe),_=t.subscribe(v.Tw.LOCAL_COLUMN_DATA_CHANGED,Ee),y=t.subscribe(v.Tw.UPDATE_SELECTED_RECORD_IDS,He),A=t.subscribe(v.Tw.MOVE_RECORD,Ne),R=t.subscribe(v.Tw.DUPLICATE_RECORD,Le),k=t.subscribe(v.Tw.DELETE_RECORDS,Oe),I=t.subscribe(v.Tw.UPDATE_RECORD_DETAILS,Ve),T=t.subscribe(v.Tw.UPDATE_FACE_RECOGNITION,qe),M=t.subscribe(v.Tw.GENERATE_DESCRIPTION,Ke),x=t.subscribe(v.Tw.EXTRACT_TEXT,Ze),E=t.subscribe(v.Tw.SEARCH_ROWS,tt),S=t.subscribe(v.Tw.GENERATE_FILE_TAGS,We);return function(){window.sfMetadataContext&&window.sfMetadataContext.destroy(),window.sfMetadataStore.destroy(),n(),o(),s(),i(),u(),l(),d(),p(),h(),C(),b(),g(),_(),y(),A(),R(),k(),I(),T(),M(),x(),E(),S(),fe.current&&clearTimeout(fe.current)}}),[a,r]),(0,n.useEffect)((function(){me.current&&(me.current=J)}),[J]),(0,Y.jsx)(q.Provider,{value:{isLoading:S,repoID:a,viewID:r,isBeingBuilt:ae,errorMessage:U,metadata:P,store:de.current,searchState:Q,updateSearchState:pe,isDirentDetailShow:D.isDirentDetailShow,updateCurrentDirent:D.updateCurrentDirent,deleteFilesCallback:i,renameFileCallback:s,modifySettings:De,modifyRecords:Se,deleteRecords:Oe,modifyRecord:function(e,t,a,n,r,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},i=s.success_callback,u=s.fail_callback,c=[e],d=(0,l.default)({},e,t),f=(0,l.default)({},e,n),m=(0,l.default)({},e,a),v=(0,l.default)({},e,r);Se(c,d,f,m,v,o,{success_callback:i,fail_callback:u})},moveRecord:Ne,duplicateRecord:Le,renameColumn:Pe,deleteColumn:je,modifyColumnOrder:Ue,modifyColumnData:Fe,modifyColumnWidth:Be,insertColumn:Ge,updateFileTags:Ye,updateCurrentPath:D.updateCurrentPath,updateSelectedRecordIds:He,updateRecordDetails:Ve,updateFaceRecognition:qe,updateRecordDescription:Ke,onOCR:Ze,generateFileTags:We},children:t})},Z=function(){var e=(0,n.useContext)(q);if(!e)throw new Error("'MetadataContext' is null");return e},W=a(28222),z=a(97011),Q=a(9961),X=a(4668),$=a(75168),J=a(3277),ee=a(12549),te=a(48738),ae=a.n(te),ne=a(56032),re=a(12562),oe=["metadata","modifyRecord","modifyRecords","loadMore","loadAll","searchResult","recordGetterByIndex","recordGetterById","insertColumn","modifyColumnData","updateFileTags"],se=function(e){var t,a,r=e.metadata,o=e.modifyRecord,s=e.modifyRecords,i=e.loadMore,u=e.loadAll,f=(e.searchResult,e.recordGetterByIndex),m=e.recordGetterById,w=e.insertColumn,p=e.modifyColumnData,h=e.updateFileTags,C=(0,d.default)(e,oe),b=(0,R.nk)().globalHiddenColumns,g=(0,n.useMemo)((function(){return new re.A(r,{modifyRecord:o,modifyRecords:s,recordGetterByIndex:f,recordGetterById:m,modifyColumnData:p,updateFileTags:h})}),[r,o,s,f,m,p,h]),_=(0,n.useMemo)((function(){var e;return((null===r||void 0===r||null===(e=r.view)||void 0===e?void 0:e.groupbys)||[]).length}),[r]),y=(0,n.useMemo)((function(){return _*v.ax}),[_]),A=(0,n.useMemo)((function(){var e=r.view,t=e.columns,a=e.hidden_columns;return t.filter((function(e){return!b.includes(e.key)&&!a.includes(e.key)&&!v.of.includes(e.key)}))}),[r,b]),k=(0,n.useCallback)((function(e){var t=e.type,a=e.copied,n=e.isGroupView;return g.getCopiedContent({type:t,copied:a,isGroupView:n,columns:A})}),[g,A]),I=(0,n.useCallback)((function(e){var t=e.rowId,a=e.updates,n=e.originalUpdates,r=e.oldRowData,s=e.originalOldRowData;o&&o(t,a,r,n,s)}),[o]),T=(0,n.useCallback)((function(e,t,a){var n=a.key,r=a.data;w&&w(e,t,{key:n,data:r})}),[w]),M=(0,n.useCallback)((function(e){var t=e.type,a=e.copied,n=e.multiplePaste,r=e.pasteRange,o=e.isGroupView,s=e.pasteSource,i=e.cutPosition,u=e.viewId;g.paste({type:t,copied:a,multiplePaste:n,pasteRange:r,isGroupView:o,columns:A,pasteSource:s,cutPosition:i,viewId:u})}),[g,A]);return(0,Y.jsx)("div",{className:ae()("table-main-container container-fluid p-0",(0,l.default)({},"group-level-".concat(_+1),_>0)),children:(0,Y.jsx)(ne.A,(0,c.default)({columns:A,metadata:r,recordIds:r.view.rows||[],groups:r.view.groups,groupbys:r.view.groupbys,recordsCount:(null===r||void 0===r||null===(t=r.view)||void 0===t||null===(a=t.rows)||void 0===a?void 0:a.length)||0,table:r,hasMore:r.hasMore,gridUtils:g,scrollToLoadMore:i,loadAll:u,paste:M,groupOffsetLeft:y,modifyRecord:I,deleteRecords:C.deleteRecords,getCopiedRecordsAndColumnsFromRange:k,recordGetterById:m,recordGetterByIndex:f,modifyColumnData:p,insertColumn:T,updateFileTags:h,modifyRecords:s},C))})},ie=function(){var e=(0,n.useState)(!1),t=(0,o.default)(e,2),a=t[0],r=t[1],s=Z(),i=s.isLoading,u=s.metadata,l=s.store,c=s.modifyRecords,d=s.deleteRecords,m=s.modifyRecord,p=s.renameColumn,h=s.deleteColumn,C=s.modifyColumnData,b=s.modifyColumnOrder,g=s.modifyColumnWidth,_=s.insertColumn,y=s.updateFileTags,A=s.updateSelectedRecordIds,R=s.updateRecordDetails,k=s.updateFaceRecognition,M=s.updateRecordDescription,D=s.onOCR,x=s.generateFileTags,E=(0,n.useRef)(null),S=!1,O=(0,n.useCallback)((function(){setTimeout((function(){return window.sfMetadataContext.eventBus.dispatch(v.Tw.FOCUS_CANVAS)}),0)}),[]),N=(0,n.useCallback)((function(e){if(e.keyCode!==(0,$.toKeyCode)("mod+shift")&&!e.target.className.includes("sf-metadata-editor-main")){var t=document.activeElement;E.current.contains(t)&&((0,ee.LQ)(e)||(0,ee.rd)(e))&&e.preventDefault()}}),[S,l,O]),L=(0,n.useCallback)((function(e){e.target.className.includes("sf-metadata-editor-main")}),[]),P=(0,n.useMemo)((function(){return!(i||!u)&&(0,J.YD)(u.view.groupbys,u.columns).length>0}),[i,u]),j=(0,n.useCallback)((0,T.default)((0,I.A)().mark((function e(){var t;return(0,I.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.hasMore){e.next=2;break}return e.abrupt("return");case 2:return r(!0),e.prev=3,e.next=6,l.loadMore(v.bK);case 6:r(!1),e.next=15;break;case 9:return e.prev=9,e.t0=e.catch(3),t=w.Aq.getErrorMsg(e.t0),f.A.danger(t),r(!1),e.abrupt("return");case 15:case"end":return e.stop()}}),e,null,[[3,9]])}))),[u,l]),F=(0,n.useCallback)(function(){var e=(0,T.default)((0,I.A)().mark((function e(t){var a,n,o;return(0,I.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.hasMore){e.next=2;break}return e.abrupt("return");case 2:return r(!0),a=u.row_ids.length,n=a%v.Hc!==0?v.Hc-a%v.Hc:v.Hc,e.prev=5,e.next=8,l.loadMore(n);case 8:r(!1),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(5),o=w.Aq.getErrorMsg(e.t0),f.A.danger(o),r(!1),e.abrupt("return");case 17:l.data.hasMore&&l.data.row_ids.length<t?F(t):r(!1);case 18:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}(),[u,l]),B=(0,n.useCallback)((function(e){var t=u.row_ids.length,a=[],n=[],r=[],o={};return e.forEach((function(e){return o[e]=e})),u.row_ids.forEach((function(e,s){if(o[e]){var i=0===s?null:u.row_ids[s-1],l=s===t-1?null:u.row_ids[s+1];a.push(e),n.push(i),r.push(l)}})),{rowIdsInOrder:a,upperRowIds:n,belowRowIds:r}}),[u]),U=(0,n.useCallback)((function(e){return u.id_row_map[e]}),[u]),G=(0,n.useCallback)((function(e){var t=u.view.rows[e];return t&&U(t)}),[u,U]),H=(0,n.useCallback)((function(e){if(!window.sfMetadataBody||!window.sfMetadataBody.getGroupRecordByIndex)return null;var t=window.sfMetadataBody.getGroupRecordByIndex(e).rowId;return t&&U(t)}),[U]),V=(0,n.useCallback)((function(e){var t=e.isGroupView,a=e.groupRecordIndex,n=e.recordIndex;return t?H(a):G(n)}),[H,G]),q=(0,n.useCallback)((function(){var e;return(null===E||void 0===E||null===(e=E.current)||void 0===e?void 0:e.getBoundingClientRect())||{x:0,right:window.innerWidth}}),[E]);return(0,Y.jsx)("div",{className:"sf-metadata-container sf-metadata-container-transform",ref:E,children:(0,Y.jsx)(se,{isGroupView:P,isLoadingMore:a,loadMore:j,metadata:u,modifyRecord:m,modifyRecords:c,deleteRecords:d,recordGetterById:U,recordGetterByIndex:V,getTableContentRect:q,getAdjacentRowsIds:B,loadAll:F,insertColumn:_,renameColumn:p,deleteColumn:h,modifyColumnData:C,modifyColumnWidth:g,modifyColumnOrder:b,updateFileTags:y,generateFileTags:x,onGridKeyDown:N,onGridKeyUp:L,updateSelectedRecordIds:A,updateRecordDetails:R,updateFaceRecognition:k,updateRecordDescription:M,onOCR:D})})},ue=function(){var e=Z(),t=e.isLoading,a=e.isBeingBuilt,n=e.errorMessage;return t?a?(0,Y.jsxs)("div",{className:"sf-metadata-loading-wrapper",children:[(0,Y.jsx)(Q.A,{className:"sf-metadata-loading-tip center"}),(0,Y.jsx)("span",{className:"sf-metadata-loading-tip",children:(0,y.APU)("Extended properties are being built.")})]}):(0,Y.jsx)(X.A,{}):(0,Y.jsx)("div",{className:"sf-metadata-wrapper",id:"sf-metadata-wrapper",children:(0,Y.jsxs)("div",{className:"sf-metadata-main",children:[n&&(0,Y.jsx)("div",{className:"d-center-middle error",children:n}),!n&&(0,Y.jsx)(ie,{})]})})},le=a(15847),ce=function(e){var t=e.viewId,a=(0,n.useState)(null),r=(0,o.default)(a,2),s=r[0],i=r[1],u=(0,n.useState)([]),l=(0,o.default)(u,2),c=l[0],d=l[1],f=(0,n.useCallback)((function(){window.sfMetadataContext.eventBus.dispatch(v.Tw.SELECT_NONE)}),[]),m=(0,n.useCallback)((function(e,t,a){window.sfMetadataContext.eventBus.dispatch(v.Tw.MODIFY_FILTERS,e,t,a)}),[]),w=(0,n.useCallback)((function(e){window.sfMetadataContext.eventBus.dispatch(v.Tw.MODIFY_SORTS,e)}),[]),p=(0,n.useCallback)((function(e){window.sfMetadataContext.eventBus.dispatch(v.Tw.MODIFY_GROUPBYS,e)}),[]),h=(0,n.useCallback)((function(e){window.sfMetadataContext.eventBus.dispatch(v.Tw.MODIFY_HIDDEN_COLUMNS,e)}),[]),C=(0,n.useCallback)((function(e,t){window.sfMetadataContext.eventBus.dispatch(v.Tw.MODIFY_COLUMN_ORDER,e,t)}),[]),b=(0,n.useCallback)((function(e){i(e)}),[]);if((0,n.useEffect)((function(){var e,t=setInterval((function(){var a;window.sfMetadataContext&&window.sfMetadataStore.data&&(t&&clearInterval(t),t=null,i(window.sfMetadataStore.data.view),d((null===(a=window.sfMetadataStore)||void 0===a?void 0:a.collaborators)||[]),e=window.sfMetadataContext.eventBus.subscribe(v.Tw.VIEW_CHANGED,b))}),300);return function(){t&&clearInterval(t),e&&e()}}),[t]),!s)return null;var g=!window.sfMetadataContext||!window.sfMetadataContext.canModifyView(s);return(0,Y.jsx)("div",{className:"sf-metadata-tool",onClick:f,children:(0,Y.jsx)(le.A,{readOnly:g,view:s,collaborators:c,modifyFilters:m,modifySorts:w,modifyGroupbys:p,modifyHiddenColumns:h,modifyColumnOrder:C})})},de=window.app.pageOptions,fe=de.repoID,me=de.wikiID,ve=de.viewID;function we(){var e=(0,n.useState)(!0),t=(0,o.default)(e,2),a=t[0],r=t[1],u=(0,n.useState)(null),l=(0,o.default)(u,2),c=l[0],d=l[1];return(0,n.useEffect)((function(){z.e.getRepoInfo(fe).then((function(e){d(e.data),r(!1)}))}),[]),a?null:(0,Y.jsx)(s.Q,{backend:i.HTML5Backend,children:(0,Y.jsx)(R.NH,{repoID:fe,currentPath:"/",repoInfo:c,hideMetadataView:!1,statusCallback:function(){},children:(0,Y.jsx)(W.Pf,{repoID:fe,repoInfo:c,currentPath:"/",selectTagsView:function(){},tagsChangedCallback:function(){},children:(0,Y.jsx)(W.Xj,{repoID:fe,currentPath:"/",repoInfo:c,selectMetadataView:function(){},children:(0,Y.jsx)(K,{repoID:fe,repoInfo:c,wikiID:me,viewID:ve,children:(0,Y.jsxs)("div",{className:"wiki-repo-view",children:[(0,Y.jsx)("div",{className:"wiki-repo-view-toolbar",children:(0,Y.jsx)(ce,{viewId:ve})}),(0,Y.jsx)("div",{className:"wiki-repo-view-content",children:(0,Y.jsx)(ue,{})})]})})})})})})}(0,r.createRoot)(document.getElementById("wrapper")).render((0,Y.jsx)(we,{}))}},function(e){e.O(0,[4223],(function(){return t=28360,e(e.s=t);var t}));e.O()}]);