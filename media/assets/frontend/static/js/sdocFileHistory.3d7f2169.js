"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[94],{99730:function(e,n,t){t.d(n,{A:function(){return r}});t(9950);var i=t(48738),s=t.n(i),o=t(44414);function a(e){var n=e.onChange,t=e.checked,i=e.placeholder,a=e.disabled,r=e.className,c=e.size,l=e.textPosition,d=e.setRef;return(0,o.jsx)("div",{className:s()("seahub-switch position-relative",r,c),ref:d,children:(0,o.jsxs)("label",{className:"custom-switch",children:[(0,o.jsx)("input",{className:"custom-switch-input",type:"checkbox",checked:t,onChange:n,name:"custom-switch-checkbox",disabled:a}),"left"===l&&(0,o.jsx)("span",{className:"custom-switch-description text-truncate",children:i}),(0,o.jsx)("span",{className:s()("custom-switch-indicator",{disabled:a})}),"right"===l&&(0,o.jsx)("span",{className:"custom-switch-description text-truncate",children:i})]})})}a.defaultProps={textPosition:"left"};var r=a},86274:function(e,n,t){var i=t(23029),s=t(92901),o=t(39874),a=t(85501),r=t(9950),c=t(40326),l=t(65604),d=t(4086),h=t(44414),u=function(e){function n(e){var t;return(0,i.A)(this,n),(t=(0,o.A)(this,n,[e])).onClick=function(e){t.inputRef.current.contains(e.target)||t.onRenameConfirm()},t.onChange=function(e){t.setState({name:e.target.value})},t.onKeyDown=function(e){e.keyCode===l.Aq.keyCodes.enter?t.onRenameConfirm(e):e.keyCode===l.Aq.keyCodes.esc&&t.onRenameCancel(e),e.nativeEvent.stopImmediatePropagation()},t.onRenameConfirm=function(e){e&&e.nativeEvent.stopImmediatePropagation();var n=t.state.name.trim();if(n!==t.props.name){var i=t.validateInput(),s=i.isValid,o=i.errMessage;s?t.props.onRenameConfirm(n):(d.A.danger(o),t.props.onRenameCancel())}else t.props.onRenameCancel()},t.onRenameCancel=function(e){e.nativeEvent.stopImmediatePropagation(),t.props.onRenameCancel()},t.validateInput=function(){var e=t.state.name.trim(),n=!0,i="";return e?e.indexOf("/")>-1?{isValid:n=!1,errMessage:i=(0,c.AP)("Name should not include '/'.")}:{isValid:n,errMessage:i}:{isValid:n=!1,errMessage:i=(0,c.AP)("Name is required.")}},t.state={name:e.name},t.inputRef=r.createRef(),t}return(0,a.A)(n,e),(0,s.A)(n,[{key:"componentDidMount",value:function(){var e=this;if(this.inputRef.current.focus(),this.props.hasSuffix){var n=this.props.name.lastIndexOf(".");this.inputRef.current.setSelectionRange(0,n,"forward")}else this.inputRef.current.setSelectionRange(0,-1);setTimeout((function(){document.addEventListener("click",e.onClick)}),1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.onClick)}},{key:"render",value:function(){return(0,h.jsx)("div",{className:"rename-container",children:(0,h.jsx)("input",{ref:this.inputRef,value:this.state.name,onChange:this.onChange,onKeyDown:this.onKeyDown})})}}])}(r.Component);n.A=u},60399:function(e,n,t){var i=t(60436),s=t(23029),o=t(92901),a=t(39874),r=t(85501),c=t(9950),l=t(17119),d=t(28321),h=t(97499),u=t(78297),f=t(48738),m=t.n(f),p=t(17),g=t(59051),v=t.n(g),y=t(97011),x=t(20989),C=t(40326),w=t(81446),j=t(44414),S=function(e){function n(){var e;(0,s.A)(this,n);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=(0,a.A)(this,n,[].concat(i))).onBackClick=function(e){e.preventDefault(),window.history.back()},e}return(0,r.A)(n,e),(0,o.A)(n,[{key:"render",value:function(){return(0,j.jsx)("div",{className:"go-back",onClick:this.onBackClick,children:(0,j.jsx)("span",{className:"sf3-font sf3-font-down rotate-90 d-inline-block"})})}}])}(c.Component),A=S,D=t(65604),N=t(75511),k=t(4086),M=t(58195),P=t(99308),I=t(19260),R=t(6030),V=t(33151),H=t(68879),b=t(57354),Y=t(86274);t(73424);v().locale(window.app.config.lang);var L=function(e){function n(e){var t;return(0,s.A)(this,n),(t=(0,a.A)(this,n,[e])).onMouseEnter=function(){var e=t.props,n=e.currentVersion,i=e.historyVersion;n.commit_id!==i.commit_id&&t.setState({isShowOperationIcon:!0})},t.onMouseLeave=function(){var e=t.props,n=e.currentVersion,i=e.historyVersion;n.commit_id!==i.commit_id&&t.setState({isShowOperationIcon:!1})},t.onToggleClick=function(e){t.setState({isMenuShow:!t.state.isMenuShow})},t.onClick=function(){t.setState({isShowOperationIcon:!1});var e=t.props,n=e.currentVersion,i=e.historyVersion,s=e.path;n.commit_id!==i.commit_id&&t.props.onSelectHistoryVersion(s)},t.onRestore=function(){var e=t.props.historyVersion;t.props.onRestore(e)},t.onItemDownload=function(){},t.onItemCopy=function(){var e=t.props.historyVersion;e.ctime_format=v()(e.ctime).format("YYYY-MM-DD HH:mm"),t.props.onCopy(e)},t.toggleRename=function(){t.isMobile&&t.setState({isMenuShow:!1}),t.setState({isRenameShow:!t.state.isRenameShow})},t.onRenameConfirm=function(e){var n=t.props.historyVersion.obj_id;t.props.renameHistoryVersion(n,e),t.toggleRename()},t.onRenameCancel=function(){t.toggleRename()},t.showDailyHistory=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();var n=t.props.path;t.props.showDailyHistory(n,(function(){t.props.onSelectHistoryVersion(n)}))},t.state={isShowOperationIcon:!1,isMenuShow:!1,isRenameShow:!1},t.isMobile=D.Fr,t}return(0,r.A)(n,e),(0,o.A)(n,[{key:"render",value:function(){var e=this.props,n=e.currentVersion,t=e.historyVersion,i=e.path,s=e.showDaily;if(!n||!t)return null;var o=t.ctime,a=t.commit_id,r=t.creator_name,c=t.obj_id,l=t.name,d=t.count,h=a===n.commit_id,u=b.A.getUrl({type:"download_historic_file",filePath:C.s$,objID:c});return(0,j.jsxs)("li",{className:"history-list-item ".concat(h?"item-active":""," ").concat(i[2]>0?"daily-history-detail":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick,children:[0===i[2]&&(0,j.jsx)("div",{className:"daily-history-detail-toggle-container",children:d>1&&(0,j.jsx)("div",{className:m()("daily-history-detail-toggle",{"daily-history-detail-show":s}),onClick:this.showDailyHistory,children:(0,j.jsx)("i",{className:"dropdown-toggle"})})}),i[2]>0&&(0,j.jsx)("div",{className:"daily-history-detail-no-more"}),(0,j.jsxs)("div",{className:"history-info",children:[this.state.isRenameShow?(0,j.jsx)(Y.A,{name:l,onRenameConfirm:this.onRenameConfirm,onRenameCancel:this.onRenameCancel}):(0,j.jsx)("div",{className:"name",children:l}),(0,j.jsx)("div",{className:"time",children:v()(o).format("YYYY-MM-DD HH:mm")}),(0,j.jsxs)("div",{className:"owner",children:[(0,j.jsx)("span",{className:"squire-icon"}),(0,j.jsx)("span",{children:r})]})]}),(0,j.jsx)("div",{className:"history-operation",children:this.isMobile?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("a",{className:"sf3-font sf3-font-more-vertical ".concat(this.state.isShowOperationIcon||h?"":"invisible"),title:(0,C.AP)("More operations"),"aria-label":(0,C.AP)("More operations"),"aria-expanded":this.state.isMenuShow,onClick:this.onToggleClick}),(0,j.jsx)(M.A,{className:"sdoc-mobile-history-options-modal",isOpen:this.state.isMenuShow,toggle:this.onToggleClick,children:(0,j.jsxs)(P.A,{className:"sdoc-operation-mobile-modal-body",children:[(0,j.jsxs)("div",{className:"option-item",children:[(0,j.jsx)("i",{className:"mr-3 sf3-font sf3-font-download1"}),(0,j.jsx)("a",{href:u,onClick:this.onItemDownLoad,children:(0,C.AP)("Download")})]}),0!==i[0]&&0!==i[1]&&0!==i[2]&&(0,j.jsxs)("div",{className:"option-item",children:[(0,j.jsx)("i",{className:"mr-3 sf3-font sf3-font-copy1"}),(0,j.jsx)("span",{href:u,onClick:this.onItemCopy,children:(0,C.AP)("Copy")})]}),(0,j.jsxs)("div",{className:"option-item",onClick:this.toggleRename,children:[(0,j.jsx)("i",{className:"mr-3 sf3-font sf3-font-rename"}),(0,j.jsx)("span",{children:(0,C.AP)("Rename")})]})]})})]}):(0,j.jsxs)(I.A,{isOpen:this.state.isMenuShow,toggle:this.onToggleClick,children:[(0,j.jsx)(R.A,{tag:"a",className:"sf3-font sf3-font-more-vertical ".concat(this.state.isShowOperationIcon||h?"":"invisible"),"data-toggle":"dropdown","aria-expanded":this.state.isMenuShow,title:(0,C.AP)("More operations"),"aria-label":(0,C.AP)("More operations")}),(0,j.jsxs)(V.A,{children:[i[0]+i[1]+i[2]!==0&&(0,j.jsx)(H.A,{onClick:this.onRestore,children:(0,C.AP)("Restore")}),(0,j.jsx)(H.A,{tag:"a",href:u,onClick:this.onItemDownLoad,children:(0,C.AP)("Download")}),0!==i[0]&&0!==i[1]&&0!==i[2]&&(0,j.jsx)(H.A,{onClick:this.onItemCopy,children:(0,C.AP)("Copy")}),(0,j.jsx)(H.A,{onClick:this.toggleRename,children:(0,C.AP)("Rename")})]})]})})]})}}])}(c.Component),E=t(99730),_=t(5544),T=function(e,n,t){var i=(0,_.A)(e,3),s=i[0],o=i[1],a=i[2],r=t[s],c=r.children[o],l="";if(n){var d,h,u;if(c.showDaily&&(l=c.children[a+1]),!l)l=null===(d=r.children[o+1])||void 0===d?void 0:d.children[0];if(!l)l=null===(h=t[s+1])||void 0===h||null===(u=h.children[0])||void 0===u?void 0:u.children[0];0!==s||l||(l="init")}return l},U=function(e,n,t){var i=(0,_.A)(e,3),s=i[0],o=i[1],a=i[2];return[n[s].children[o].children[a],T(e,t,n)]};v().locale(window.app.config.lang);var G=window.fileHistory.pageOptions.docUuid,O=function(e){function n(e){var t,o;(0,s.A)(this,n),(o=(0,a.A)(this,n,[e])).loadMore=function(){o.state.isReloadingData||(o.currentPage=o.currentPage+1,o.setState({isReloadingData:!0},(function(){y.e.listSdocHistory(G,o.currentPage,C.EK).then((function(e){o.updateResultState(e.data),o.setState({isReloadingData:!1})}))})))},o.renameHistoryVersion=function(e,n){y.e.renameSdocHistory(G,e,n).then((function(t){o.setState({historyGroups:o.state.historyGroups.map((function(t){return t.obj_id==e&&(t.name=n),t}))})})).catch((function(e){var n=D.Aq.getErrorMsg(e,!0);o.setState({isLoading:!1,errorMessage:n})}))},o.onScrollHandler=function(e){var n=e.target.clientHeight,t=e.target.scrollHeight;n+e.target.scrollTop+1>=t&&o.state.hasMore&&o.loadMore()},o.restoreVersion=function(e){var n=e.commit_id,t=e.path;N.A.revertFile(t,n).then((function(e){e.data.success&&o.props.reloadDocContent();var n=(0,C.AP)("Successfully restored.");k.A.success(n)})).catch((function(e){var n=D.Aq.getErrorMsg(e,!0);k.A.danger((0,C.AP)(n))}))},o.onSelectHistoryVersion=function(e){var n,t=o.state.historyGroups,s=o.props.isShowChanges;(n=o.props).onSelectHistoryVersion.apply(n,(0,i.A)(U(e,t,s)))},o.copyHistoryFile=function(e){var n=e.path,t=e.obj_id,i=e.ctime_format;y.e.sdocCopyHistoryFile(C.II,n,t,i).then((function(e){var n=(0,C.AP)("Successfully copied %(name)s."),t=e.data.file_name;n=n.replace("%(name)s",t),k.A.success(n)})).catch((function(e){var n=D.Aq.getErrorMsg(e,!0);k.A.danger((0,C.AP)(n))}))},o.showDailyHistory=function(e,n){var t=o.state.historyGroups.slice(0),s=t[e[0]].children[e[1]];return s.showDaily?(s.showDaily=!1,void o.setState({historyGroups:t},(function(){n&&n()}))):s.children.length>1?(s.showDaily=!0,void o.setState({historyGroups:t},(function(){n&&n()}))):void y.e.listSdocDailyHistoryDetail(G,s.children[0].ctime).then((function(e){var a,r=e.data.histories;(a=s.children).push.apply(a,(0,i.A)(r)),s.showDaily=!0,o.setState({historyGroups:t},(function(){n&&n()}))})).catch((function(e){var n=D.Aq.getErrorMsg(e,!0);k.A.danger((0,C.AP)(n))}))},o.renderHistoryVersions=function(){var e=o.state,n=e.isLoading,t=e.historyGroups,i=e.errorMessage;return 0===t.length?n?(0,j.jsx)("div",{className:"h-100 w-100 d-flex align-items-center justify-content-center",children:(0,j.jsx)(w.A,{})}):i?(0,j.jsx)("div",{className:"h-100 w-100 d-flex align-items-center justify-content-center error-message",children:(0,C.AP)(i)}):(0,j.jsx)("div",{className:"h-100 w-100 d-flex align-items-center justify-content-center empty-tip-color",children:(0,C.AP)("No version history")}):(0,j.jsxs)(j.Fragment,{children:[t.map((function(e,n){return(0,j.jsxs)(c.Fragment,{children:[(0,j.jsx)("div",{className:"history-list-item history-month-title",children:e.month},e.month),e.children.map((function(e,t){var i=e.children,s=e.showDaily;return(s?i:i.slice(0,1)).map((function(e,i){return(0,j.jsx)(L,{path:[n,t,i],showDaily:0===i&&s,currentVersion:o.props.currentVersion,historyVersion:e,onSelectHistoryVersion:o.onSelectHistoryVersion,onRestore:o.restoreVersion,onCopy:o.copyHistoryFile,renameHistoryVersion:o.renameHistoryVersion,showDailyHistory:o.showDailyHistory},e.commit_id)}))})).flat()]},e.month)})),n&&(0,j.jsx)("div",{className:"loading-more d-flex align-items-center justify-content-center w-100",children:(0,j.jsx)(w.A,{})})]})},o.onShowChanges=function(){var e,n=o.props,t=n.isShowChanges,i=n.currentVersion,s=o.state.historyGroups,a=!t;if(a){var r=i.date,c=v()(r),l=c.format("YYYY-MM"),d=c.format("YYYY-MM-DD"),h=s.findIndex((function(e){return e.month===l})),u=s[h].children.findIndex((function(e){return e.day===d})),f=s[h].children[u].children.findIndex((function(e){return e.date===r}));e=T([h,u,f],a,o.state.historyGroups)}o.props.onShowChanges(a,e)};var r=e.sidePanelInitData;return o.state={isLoading:null===(t=r.isLoading)||void 0===t||t,historyGroups:r.historyGroups||[],errorMessage:r.errorMessage||"",hasMore:r.hasMore||!1,isReloadingData:!1},o.currentPage=1,o}return(0,r.A)(n,e),(0,o.A)(n,[{key:"formatHistories",value:function(e){var n=this.state.historyGroups;if(!Array.isArray(e)||0===e.length)return n;var t=n.slice(0);return e.forEach((function(e){var n=e.date,i=v()(n),s=i.format("YYYY-MM"),o=t.find((function(e){return e.month===s}));o?o.children.push({day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}):t.push({month:s,children:[{day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}]})})),t}},{key:"updateResultState",value:function(e){var n=e.histories.length;this.setState({historyGroups:this.formatHistories(e.histories),hasMore:n>=C.EK,isLoading:!1})}},{key:"render",value:function(){var e=this.state.historyGroups;return(0,j.jsxs)("div",{className:"sdoc-file-history-panel d-flex flex-column",children:[(0,j.jsxs)("div",{className:"sdoc-file-history-select-range",children:[(0,j.jsx)("div",{className:"sdoc-file-history-select-range-title",children:(0,C.AP)("History Versions")}),(0,j.jsx)("div",{className:"sdoc-side-panel-close",children:(0,j.jsx)("i",{className:"sf3-font sf3-font-close",onClick:this.props.onClose})})]}),(0,j.jsx)("div",{className:m()("sdoc-file-history-versions",{"o-hidden":0===e.length}),onScroll:this.onScrollHandler,children:this.renderHistoryVersions()}),(0,j.jsx)("div",{className:"sdoc-file-history-diff-switch d-flex align-items-center",children:(0,j.jsx)(E.A,{checked:this.props.isShowChanges,placeholder:(0,C.AP)("Show changes"),className:"sdoc-history-show-changes w-100",size:"small",onChange:this.onShowChanges})})]})}}])}(c.Component),F=(t(16322),window.app.config),q=F.serviceURL,B=F.avatarURL,K=F.siteRoot,z=window.app.pageOptions,W=z.username,$=z.name,J=window.fileHistory.pageOptions,Q=J.repoID,X=J.fileName,Z=J.filePath,ee=J.docUuid,ne=J.assetsUrl,te=J.seadocAccessToken,ie=J.seadocServerUrl;window.seafile={repoID:Q,docPath:Z,docName:X,docUuid:ee,isOpenSocket:!1,serviceUrl:q,name:$,username:W,avatarURL:B,siteRoot:K,assetsUrl:ne};var se=function(e){function n(e){var t;(0,s.A)(this,n),(t=(0,a.A)(this,n,[e])).getInitContent=function(e){return e?{version:-1,children:[{id:e.id,type:"title",children:[{id:e.children[0].id,text:""}]}]}:t.getInitContentByPath()},t.getInitContentByPath=function(e){var n,t;return{version:-1,children:[{id:"1",type:"title",children:[{id:"2",text:e?null===(n=e.split("/"))||void 0===n||null===(t=n.pop())||void 0===t?void 0:t.slice(0,-5):""}]}]}},t.updateLastVersionContent=function(e,n,i){if(i)if("init"!==i)y.e.getFileRevision(C.II,i.commit_id,i.path).then((function(e){return e.data?y.e.getFileContent(e.data):{data:""}})).then((function(n){var s=n.data,o=e.children[0],a=i&&!s?t.getInitContent(o):s;t.setContent(e,a)})).catch((function(n){var i=D.Aq.getErrorMsg(n,!0);k.A.danger((0,C.AP)(i)),t.setContent(e,"")}));else{var s=e?t.getInitContent(e.children[0]):t.getInitContentByPath(n.path),o=e||t.getInitContentByPath(n.path);t.setContent(o,s)}else t.setContent(e,"")},t.onSelectHistoryVersion=function(e,n){t.setState({currentVersion:e,currentVersionContent:null}),y.e.getFileRevision(C.II,e.commit_id,e.path).then((function(e){return y.e.getFileContent(e.data)})).then((function(i){var s=i.data;t.updateLastVersionContent(s,e,n)})).catch((function(e){var n=D.Aq.getErrorMsg(e,!0);k.A.danger((0,C.AP)(n)),t.setContent("","")}))},t.setContent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t.setState({currentVersionContent:e,lastVersionContent:n,isLoading:!1,changes:[],currentDiffIndex:0})},t.onShowChanges=function(e,n){if(e){var i=t.state,s=i.currentVersionContent,o=i.currentVersion;t.setState({isLoading:!0,isShowChanges:e},(function(){localStorage.setItem("seahub-sdoc-history-show-changes",e+""),t.updateLastVersionContent(s,o,n)}))}else t.setState({isLoading:!0,isShowChanges:e},(function(){t.setState({isLoading:!1,lastVersionContent:""},(function(){localStorage.setItem("seahub-sdoc-history-show-changes",e+"")}))}))},t.getTopLevelChanges=function(e){var n=[];return e.forEach((function(e){var t=document.querySelectorAll('[data-id="'.concat(e,'"]'))[0];if(!t)return[];for(;"true"!==(null===(i=t)||void 0===i||null===(s=i.dataset)||void 0===s?void 0:s.root);){var i,s,o;if(null===(o=t)||void 0===o||!o.parentNode||t instanceof Document)break;var a=t.parentNode;if(a instanceof Document)break;t=a}n.push(t.dataset.id)})),Array.from(new Set(n))},t.getMergedChanges=function(e,n){var t=[],i=[];return n.forEach((function(n){if(e.includes(n.id)){var i={id:n.id,value:n};t.push(i)}})),t.forEach((function(e){var n,t=null===(n=i[i.length-1])||void 0===n?void 0:n.value,s=e.value;null!==s&&void 0!==s&&s.add&&null!==t&&void 0!==t&&t.add||null!==s&&void 0!==s&&s.delete&&null!==t&&void 0!==t&&t.delete||i.push(e)})),i.map((function(e){return e.id}))},t.setDiffCount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{value:[],changes:[]},n=e.changes,i=e.value,s=t.getTopLevelChanges(n),o=t.getMergedChanges(s,i);t.setState({changes:o,currentDiffIndex:0})},t.jumpToElement=function(e){t.setState({currentDiffIndex:e},(function(){var e=t.state,n=e.currentDiffIndex,i=e.changes[n],s=document.querySelectorAll('[data-id="'.concat(i,'"]'))[0];s&&(t.historyContentRef.scrollTop=s.offsetTop-10)}))},t.lastChange=function(){var e=t.state,n=e.currentDiffIndex,i=e.changes;0!==n?t.jumpToElement(n-1):t.jumpToElement(i.length-1)},t.nextChange=function(){var e=t.state,n=e.currentDiffIndex;n!==e.changes.length-1?t.jumpToElement(n+1):t.jumpToElement(0)},t.changeSidePanelStatus=function(){t.setState({showSidePanel:!t.state.showSidePanel})},t.renderChangesTip=function(e){var n=e.onChangeSidePanelDisplay,i=t.state,s=i.isShowChanges,o=i.changes,a=i.currentDiffIndex;if(i.isLoading)return null;if(!s)return(0,j.jsx)("div",{className:"sdoc-file-history-header-right d-flex align-items-center justify-content-end",children:(0,j.jsx)("div",{className:"sdoc-file-changes-switch",children:(0,j.jsx)("i",{className:"sf3-font sf3-font-history",onClick:n})})});var r=o?o.length:0;return 0===r?(0,j.jsxs)("div",{className:"sdoc-file-history-header-right d-flex align-items-center",children:[(0,j.jsx)("div",{className:"sdoc-file-changes-container d-flex align-items-center pl-2 pr-2",children:(0,C.AP)("No changes")}),(0,j.jsx)("div",{className:"sdoc-file-changes-switch ml-4",children:(0,j.jsx)("i",{className:"sf3-font sf3-font-history",onClick:n})})]}):(0,j.jsxs)("div",{className:"sdoc-file-history-header-right d-flex align-items-center",children:[(0,j.jsxs)("div",{className:"sdoc-file-changes-container d-flex align-items-center",children:[(0,j.jsx)("div",{className:"sdoc-file-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2",children:"".concat((0,C.AP)("Changes")," ").concat(a+1,"/").concat(r)}),(0,j.jsx)("div",{className:"sdoc-file-changes-divider"}),(0,j.jsx)("div",{className:"sdoc-file-changes-last d-flex align-items-center justify-content-center",id:"sdoc-file-changes-last",onClick:t.lastChange,children:(0,j.jsx)("span",{className:"sf3-font sf3-font-down rotate-180 d-inline-block"})}),(0,j.jsx)("div",{className:"sdoc-file-changes-divider"}),(0,j.jsx)("div",{className:"sdoc-file-changes-next d-flex align-items-center justify-content-center",id:"sdoc-file-changes-next",onClick:t.nextChange,children:(0,j.jsx)("span",{className:"sf3-font sf3-font-down"})}),(0,j.jsx)(u.A,{placement:"bottom",target:"sdoc-file-changes-last",delay:0,fade:!1,children:(0,C.AP)("Last modification")}),(0,j.jsx)(u.A,{placement:"bottom",target:"sdoc-file-changes-next",delay:0,fade:!1,children:(0,C.AP)("Next modification")})]}),(0,j.jsx)("div",{className:"sdoc-file-changes-switch d-flex align-items-center justify-content-center ml-4",id:"sdoc-file-changes-panel-switch",onClick:t.changeSidePanelStatus,children:(0,j.jsx)("i",{className:"sf3-font sf3-font-history"})})]})},t.reloadDocContent=function(){t.sdocServerApi.reloadDocContent(X).catch((function(e){throw Error("there has an error in server")}))};var i="false"!==localStorage.getItem("seahub-sdoc-history-show-changes");t.state={isLoading:!0,isShowChanges:i,currentVersion:{},currentVersionContent:"",lastVersionContent:"",changes:[],currentDiffIndex:0,isMobile:D.Fr,sidePanelInitData:{},showSidePanel:!0};var o={docUuid:ee,sdocServer:ie,accessToken:te};return t.sdocServerApi=new x.A(o),t}return(0,r.A)(n,e),(0,o.A)(n,[{key:"componentDidMount",value:function(){this.firstLoadSdocHistory()}},{key:"formatHistories",value:function(e){var n=[];if(!Array.isArray(e)||0===e.length)return n;var t=n.slice(0);return e.forEach((function(e){var n=e.date,i=v()(n),s=i.format("YYYY-MM"),o=t.find((function(e){return e.month===s}));o?o.children.push({day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}):t.push({month:s,children:[{day:i.format("YYYY-MM-DD"),showDaily:!1,children:[e]}]})})),t}},{key:"firstLoadSdocHistory",value:function(){var e=this;y.e.listSdocHistory(ee,1,C.EK).then((function(n){var t=n.data,s=t.histories.length,o=e.formatHistories(t.histories),a={historyGroups:o,hasMore:s>=C.EK,isLoading:!1};if(e.setState({sidePanelInitData:a}),o.length>0){var r=e.state.isShowChanges;e.onSelectHistoryVersion.apply(e,(0,i.A)(U([0,0,0],o,r)))}else e.setState({isLoading:!1})})).catch((function(n){var t="there has an error in server";throw e.setState({isLoading:!1,sidePanelInitData:{isLoading:!1,errorMessage:t}}),Error(t)}))}},{key:"render",value:function(){var e=this,n=this.state,t=n.currentVersion,i=n.isShowChanges,s=n.currentVersionContent,o=n.lastVersionContent,a=n.isLoading,r=n.isMobile,c=n.sidePanelInitData,l=n.showSidePanel;return(0,j.jsx)("div",{className:"sdoc-file-history d-flex ".concat(r?"mobile":""),children:(0,j.jsxs)("div",{className:"sdoc-file-history-container d-flex flex-column",children:[(0,j.jsxs)("div",{className:"sdoc-file-history-header pt-2 pb-2 pl-4 pr-4 d-flex justify-content-between w-100",children:[(0,j.jsxs)("div",{className:m()("sdoc-file-history-header-left d-flex align-items-center",{"pr-4":i}),children:[(0,j.jsx)(A,{}),(0,j.jsx)("div",{className:"file-name text-truncate",children:X})]}),this.renderChangesTip({onChangeSidePanelDisplay:this.changeSidePanelStatus})]}),(0,j.jsx)("div",{className:"sdoc-file-history-content d-flex",ref:function(n){return e.historyContentRef=n},children:a?(0,j.jsx)("div",{className:"sdoc-file-history-viewer d-flex align-items-center justify-content-center",children:(0,j.jsx)(w.A,{})}):(0,j.jsxs)(j.Fragment,{children:[null===s?(0,j.jsx)(w.A,{}):(0,j.jsx)(p.Mh,{currentContent:s,lastContent:i?o:"",didMountCallback:this.setDiffCount}),l&&(0,j.jsx)(O,{isShowChanges:i,currentVersion:t,onSelectHistoryVersion:this.onSelectHistoryVersion,onShowChanges:this.onShowChanges,sidePanelInitData:c,onClose:this.changeSidePanelStatus,reloadDocContent:this.reloadDocContent})]})})]})})}}])}(c.Component);l.render((0,j.jsx)(d.I18nextProvider,{i18n:h.A,children:(0,j.jsx)(se,{})}),document.getElementById("wrapper"))},20989:function(e,n,t){var i=t(23029),s=t(92901),o=t(26910),a=function(){return(0,s.A)((function e(n){(0,i.A)(this,e),this.server=n.sdocServer,this.docUuid=n.docUuid,this.accessToken=n.accessToken}),[{key:"getDocContent",value:function(){var e=this.server,n=this.docUuid,t=this.accessToken,i="".concat(e,"/api/v1/docs/").concat(n,"/");return o.A.get(i,{headers:{Authorization:"Token ".concat(t)}})}},{key:"reloadDocContent",value:function(e){var n=this.server,t=this.docUuid,i=this.accessToken,s="".concat(n,"/api/v1/docs/").concat(t,"/replace/"),a=new FormData;return a.append("doc_uuid",t),a.append("doc_name",e),o.A.post(s,a,{headers:{Authorization:"Token ".concat(i)}})}}])}();n.A=a},73424:function(){}},function(e){e.O(0,[4223],(function(){return n=60399,e(e.s=n);var n}));e.O()}]);