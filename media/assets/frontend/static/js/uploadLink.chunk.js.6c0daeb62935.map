{"version":3,"sources":["pages/upload-link/upload-list-item.js","pages/upload-link/forbid-upload-list-item.js","pages/upload-link/upload-progress-dialog.js","pages/upload-link/file-uploader.js","pages/upload-link/index.js"],"names":["UPLOAD_UPLOADING","UPLOAD_ERROR","UPLOAD_ISSAVING","UPLOAD_UPLOADED","UploadListItem","props","onUploadCancel","e","preventDefault","resumableFile","onUploadRetry","formatFileSize","size","toFixed","state","uploadState","nextProps","error","remainingTime","isSaved","this","setState","progress","Math","round","className","newFileName","isUploading","role","style","width","aria-valuenow","aria-valuemin","aria-valuemax","gettext","Utils","formatTime","dangerouslySetInnerHTML","__html","href","onClick","React","Component","ForbidUploadListItem","file","msg","replace","maxUploadFileSize","name","colSpan","UploadProgressDialog","toggleDropdown","dropdownOpen","allFilesUploaded","isOpen","toggle","color","caret","onFileUpload","onFolderUpload","outline","onCancelAllUploading","disabled","forbidUploadFileList","map","index","uploadFileList","reverse","FileUploader","componentWillUnmount","window","onbeforeunload","dragAndDrop","resumable","disableDropOnDocument","uploader","isUploadProgressDialogShow","totalProgress","bindCallbackHandler","minFileSizeErrorCallback","fileTypeErrorCallback","maxFilesErrorCallback","opts","maxFileSizeErrorCallback","bindEventHandler","on","onChunkingComplete","bind","onFileAdded","onFileProgress","onFileUploadSuccess","onFileError","onUploadStart","onProgress","onComplete","onError","onDragStart","files","errorCount","maxFiles","maxNumberOfFilesForFileupload","message","toaster","danger","push","path","fileName","relativePath","isFile","formData","parent_dir","relative_path","slice","lastIndexOf","length","setUploadFileList","seafileAPI","sharedUploadLinkGetFileUploadUrl","token","then","res","target","data","upload_link","resumableUpload","catch","errMessage","getErrorMsg","isUploadLinkLoaded","upload","repoID","getFileUploadedBytes","uploadedBytes","blockSize","parseInt","resumableUploadFileBlockSize","offset","floor","markChunksCompleted","filesAddedComplete","registerGlobalVariable","uploadBitrate","getBitrate","item","uniqueIdentifier","lastSize","time","loaded","now","Date","getTime","forEach","timestamp","timeDiff","bitrateInterval","notify","currentTime","JSON","parse","dir_name","indexOf","dirent","id","type","mtime","notifiedFolders","some","errorMessage","retryFileList","success","setHeaders","chunkSize","getOpt","fileSize","startByte","endByte","min","encodeURI","setQuery","generateUniqueIdentifier","webkitRelativePath","MD5","nativeEvent","stopImmediatePropagation","stopPropagation","uploadInput","current","removeAttribute","click","setAttribute","onCloseUploadDialog","uploadingItem","filter","cancel","retryUploadFile","bootstrap","firedRetry","resumableObj","replaceRepetitionFile","getUpdateLink","cancelFileUpload","pop","currentResumableFile","createRef","Resumablejs","query","fileType","filetypes","undefined","maxFileSize","testMethod","testChunks","headers","withCredentials","simultaneousUploads","fileParameterName","forceChunkSize","maxChunkRetries","minFileSize","assignBrowse","assignDrop","document","getElementById","ref","loggedUser","app","pageOptions","username","uploadLink","dirName","sharedBy","noQuota","SharedUploadLink","direntObject","shareLinksUploadDone","joinPath","HTMLescape","avatar","ReactDOM","render"],"mappings":"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","file":"static/js/uploadLink.chunk.js","sourcesContent":["import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\n\nconst propTypes = {\n  resumableFile: PropTypes.object.isRequired,\n  onUploadCancel: PropTypes.func.isRequired,\n  onUploadRetry: PropTypes.func.isRequired,\n};\n\nconst UPLOAD_UPLOADING = 'uploading';\nconst UPLOAD_ERROR = 'error';\nconst UPLOAD_ISSAVING = 'isSaving';\nconst UPLOAD_UPLOADED = 'uploaded';\n\nclass UploadListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      uploadState: UPLOAD_UPLOADING\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    let { resumableFile } = nextProps;\n    let uploadState = UPLOAD_UPLOADING;\n\n    if (resumableFile.error) {\n      uploadState = UPLOAD_ERROR;\n    } else {\n      if (resumableFile.remainingTime === 0 && !resumableFile.isSaved) {\n        uploadState = UPLOAD_ISSAVING;\n      }\n\n      if (resumableFile.isSaved) {\n        uploadState = UPLOAD_UPLOADED;\n      }\n    }\n\n    this.setState({uploadState: uploadState});\n  }\n\n  onUploadCancel = (e) => {\n    e.preventDefault();\n    this.props.onUploadCancel(this.props.resumableFile);\n  }\n\n  onUploadRetry = (e) => {\n    e.preventDefault();\n    this.props.onUploadRetry(this.props.resumableFile);\n  }\n\n  formatFileSize = (size) => {\n    if (typeof size !== 'number') {\n      return '';\n    }\n    if (size >= 1000 * 1000 * 1000) {\n      return (size / (1000 * 1000 * 1000)).toFixed(1) + ' G';\n    }\n    if (size >= 1000 * 1000) {\n      return (size / (1000 * 1000)).toFixed(1) + ' M';\n    }\n    if (size >= 1000) {\n      return (size / 1000).toFixed(1) + ' K';\n    }\n    return size.toFixed(1) + ' B';\n  }\n\n  render() {\n    let { resumableFile } = this.props;\n    let progress = Math.round(resumableFile.progress() * 100);\n    let error = resumableFile.error;\n\n    return (\n      <tr className=\"file-upload-item\">\n        <td className=\"upload-name\">\n          <div className=\"ellipsis\">{resumableFile.newFileName}</div>\n        </td>\n        <td>\n          <span className=\"file-size\">{this.formatFileSize(resumableFile.size)}</span>\n        </td>\n        <td className=\"upload-progress\">\n          {(this.state.uploadState === UPLOAD_UPLOADING || this.state.uploadState === UPLOAD_ISSAVING) &&\n            <Fragment>\n              {resumableFile.size >= (100 * 1000 * 1000) &&\n                <Fragment>\n                  {resumableFile.isUploading() && (\n                    <div className=\"progress-container\">\n                      <div className=\"progress\">\n                        <div className=\"progress-bar\" role=\"progressbar\" style={{width: `${progress}%`}} aria-valuenow={progress} aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                      </div>\n                      {(resumableFile.remainingTime === -1) && <div className=\"progress-text\">{gettext('Preparing to upload...')}</div>}\n                      {(resumableFile.remainingTime > 0) && <div className=\"progress-text\">{gettext('Remaining')}{' '}{Utils.formatTime(resumableFile.remainingTime)}</div>}\n                      {(resumableFile.remainingTime === 0) && <div className=\"progress-text\">{gettext('Indexing...')}</div>}\n                    </div>\n                  )}\n                  {!resumableFile.isUploading() && (\n                    <div className=\"progress-container d-flex align-items-center\">\n                      <div className=\"progress\">\n                        <div className=\"progress-bar\" role=\"progressbar\" style={{width: `${progress}%`}} aria-valuenow={progress} aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                      </div>\n                    </div>\n                  )}\n                </Fragment>\n              }\n              {(resumableFile.size < (100 * 1000 * 1000)) &&\n                <div className=\"progress-container d-flex align-items-center\">\n                  <div className=\"progress\">\n                    <div className=\"progress-bar\" role=\"progressbar\" style={{width: `${progress}%`}} aria-valuenow={progress} aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                  </div>\n                </div>\n              }\n            </Fragment>\n          }\n          {this.state.uploadState === UPLOAD_ERROR && (\n            <div className=\"message err-message ml-0\" dangerouslySetInnerHTML={{__html: error}}></div>\n          )}\n        </td>\n        <td className=\"upload-operation\">\n          <Fragment>\n            {this.state.uploadState === UPLOAD_UPLOADING && (\n              <a href=\"#\" onClick={this.onUploadCancel}>{gettext('Cancel')}</a>\n            )}\n            {this.state.uploadState === UPLOAD_ERROR && (\n              <a href=\"#\" onClick={this.onUploadRetry}>{gettext('Retry')}</a>\n            )}\n            {this.state.uploadState === UPLOAD_ISSAVING && (\n              <span className=\"saving\">{gettext('Saving...')}</span>\n            )}\n            {this.state.uploadState === UPLOAD_UPLOADED && (\n              <span className=\"uploaded\">{gettext('Uploaded')}</span>\n            )}\n          </Fragment>\n        </td>\n      </tr>\n    );\n  }\n}\n\nUploadListItem.propTypes = propTypes;\n\nexport default UploadListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, maxUploadFileSize } from '../../utils/constants';\n\nconst propTypes = {\n  file: PropTypes.object,\n};\n\nclass ForbidUploadListItem extends React.Component {\n\n  render() {\n    let { file } = this.props;\n    let msg = gettext('Please upload files less than {placeholder}M').replace('{placeholder}', maxUploadFileSize);\n    return (\n      <tr className=\"file-upload-item\">\n        <td className=\"upload-name\">\n          <div className=\"ellipsis\">{file.name}</div>\n        </td>\n\n        <td colSpan={3} className=\"error\">{msg}</td>\n      </tr>\n    );\n  }\n}\n\nForbidUploadListItem.propTypes = propTypes;\n\nexport default ForbidUploadListItem;\n","import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { Button, ButtonDropdown, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap';\nimport { gettext } from '../../utils/constants';\nimport UploadListItem from './upload-list-item';\nimport ForbidUploadListItem from './forbid-upload-list-item';\n\nconst propTypes = {\n  uploadFileList: PropTypes.array.isRequired,\n  forbidUploadFileList: PropTypes.array.isRequired,\n  onCancelAllUploading: PropTypes.func.isRequired,\n  onUploadCancel: PropTypes.func.isRequired,\n  onUploadRetry: PropTypes.func.isRequired,\n  onFileUpload: PropTypes.func.isRequired,\n  onFolderUpload: PropTypes.func.isRequired,\n  allFilesUploaded: PropTypes.bool.isRequired\n};\n\nclass UploadProgressDialog extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      dropdownOpen: false\n    };\n  }\n\n  toggleDropdown = () => {\n    this.setState({\n      dropdownOpen: !this.state.dropdownOpen\n    });\n  }\n\n  render() {\n    let { allFilesUploaded } = this.props;\n    return (\n      <Fragment>\n        <div className=\"text-center\">\n          <ButtonDropdown isOpen={this.state.dropdownOpen} toggle={this.toggleDropdown}>\n            <DropdownToggle color=\"primary\" caret>{gettext('Upload')}</DropdownToggle>\n            <DropdownMenu>\n              <DropdownItem onClick={this.props.onFileUpload}>{gettext('Upload Files')}</DropdownItem>\n              <DropdownItem onClick={this.props.onFolderUpload}>{gettext('Upload Folder')}</DropdownItem>\n            </DropdownMenu>\n          </ButtonDropdown>\n          <Button color=\"primary\" outline={true} className=\"ml-4\"\n            onClick={this.props.onCancelAllUploading}\n            disabled={allFilesUploaded}>\n            {gettext('Cancel All')}\n          </Button>\n        </div>\n        <div className=\"mt-4 mh-2\">\n          <table className=\"table-thead-hidden\">\n            <thead>\n              <tr>\n                <th width=\"35%\">{gettext('name')}</th>\n                <th width=\"15%\">{gettext('size')}</th>\n                <th width=\"35%\">{gettext('progress')}</th>\n                <th width=\"15%\">{gettext('state')}</th>\n              </tr>\n            </thead>\n            <tbody>\n              {this.props.forbidUploadFileList.map((file, index) => {\n                return (<ForbidUploadListItem key={index} file={file} />);\n              })}\n              {this.props.uploadFileList.map((resumableFile, index) => {\n                return (\n                  <UploadListItem\n                    key={index}\n                    resumableFile={resumableFile}\n                    onUploadCancel={this.props.onUploadCancel}\n                    onUploadRetry={this.props.onUploadRetry}\n                  />\n                );\n              }).reverse()\n              }\n            </tbody>\n          </table>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nUploadProgressDialog.propTypes = propTypes;\n\nexport default UploadProgressDialog;\n","// This file is copied from frontend/src/components/file-uploader/file-uploader.js,\n// and modified according to the requirements of this page.\nimport React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport Resumablejs from '@seafile/resumablejs';\nimport MD5 from 'MD5';\nimport { resumableUploadFileBlockSize, maxUploadFileSize, maxNumberOfFilesForFileupload } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport { gettext } from '../../utils/constants';\nimport UploadProgressDialog from './upload-progress-dialog';\nimport toaster from '../../components/toast';\n\nimport '../../css/file-uploader.css';\n\nconst propTypes = {\n  dragAndDrop: PropTypes.bool.isRequired,\n  token: PropTypes.string.isRequired,\n  repoID: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired,\n\n  filetypes: PropTypes.array,\n  chunkSize: PropTypes.number,\n  withCredentials: PropTypes.bool,\n  testMethod: PropTypes.string,\n  testChunks: PropTypes.number,\n  simultaneousUploads: PropTypes.number,\n  fileParameterName: PropTypes.string,\n  minFileSizeErrorCallback: PropTypes.func,\n  fileTypeErrorCallback: PropTypes.func,\n  onFileUploadSuccess: PropTypes.func.isRequired,\n};\n\nclass FileUploader extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      retryFileList: [],\n      uploadFileList: [],\n      forbidUploadFileList: [],\n      totalProgress: 0,\n      isUploadProgressDialogShow: false,\n      currentResumableFile: null,\n      uploadBitrate: 0,\n      allFilesUploaded: false,\n    };\n\n    this.uploadInput = React.createRef();\n\n    this.notifiedFolders = [];\n\n    this.timestamp = null;\n    this.loaded = 0;\n    this.bitrateInterval = 500; // Interval in milliseconds to calculate the bitrate\n    this.isUploadLinkLoaded = false;\n\n    window.onbeforeunload = this.onbeforeunload;\n  }\n\n  componentDidMount() {\n    this.resumable = new Resumablejs({\n      target: '',\n      query: this.setQuery || {},\n      fileType: this.props.filetypes,\n      maxFiles: maxNumberOfFilesForFileupload || undefined,\n      maxFileSize: maxUploadFileSize * 1000 * 1000 || undefined,\n      testMethod: this.props.testMethod || 'post',\n      testChunks: this.props.testChunks || false,\n      headers: this.setHeaders || {},\n      withCredentials: this.props.withCredentials || false,\n      chunkSize: parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1 * 1024 * 1024,\n      simultaneousUploads: this.props.simultaneousUploads || 1,\n      fileParameterName: this.props.fileParameterName,\n      generateUniqueIdentifier: this.generateUniqueIdentifier,\n      forceChunkSize: true,\n      maxChunkRetries: 3,\n      minFileSize: 0,\n    });\n\n    this.resumable.assignBrowse(this.uploadInput.current, true);\n    if (this.props.dragAndDrop) {\n      this.resumable.assignDrop(document.getElementById('upload-link-drop-zone'));\n    }\n\n    this.bindCallbackHandler();\n    this.bindEventHandler();\n  }\n\n  componentWillUnmount = () => {\n    window.onbeforeunload = null;\n    if (this.props.dragAndDrop === true) {\n      this.resumable.disableDropOnDocument();\n    }\n  }\n\n  onbeforeunload = () => {\n    if (window.uploader &&\n        window.uploader.isUploadProgressDialogShow &&\n        window.uploader.totalProgress !== 100) {\n      return '';\n    }\n  }\n\n  bindCallbackHandler = () => {\n    let { minFileSizeErrorCallback, fileTypeErrorCallback } = this.props;\n\n    if (this.maxFilesErrorCallback) {\n      this.resumable.opts.maxFilesErrorCallback = this.maxFilesErrorCallback;\n    }\n\n    if (minFileSizeErrorCallback) {\n      this.resumable.opts.minFileSizeErrorCallback = this.props.minFileSizeErrorCallback;\n    }\n\n    if (this.maxFileSizeErrorCallback) {\n      this.resumable.opts.maxFileSizeErrorCallback = this.maxFileSizeErrorCallback;\n    }\n\n    if (fileTypeErrorCallback) {\n      this.resumable.opts.fileTypeErrorCallback = this.props.fileTypeErrorCallback;\n    }\n\n  }\n\n  bindEventHandler = () => {\n    this.resumable.on('chunkingComplete', this.onChunkingComplete.bind(this));\n    this.resumable.on('fileAdded', this.onFileAdded.bind(this));\n    this.resumable.on('fileProgress', this.onFileProgress.bind(this));\n    this.resumable.on('fileSuccess', this.onFileUploadSuccess.bind(this));\n    this.resumable.on('fileError', this.onFileError.bind(this));\n    this.resumable.on('uploadStart', this.onUploadStart.bind(this));\n    this.resumable.on('progress', this.onProgress.bind(this));\n    this.resumable.on('complete', this.onComplete.bind(this));\n    this.resumable.on('error', this.onError.bind(this));\n    this.resumable.on('dragstart', this.onDragStart.bind(this));\n  }\n\n  maxFilesErrorCallback = (files, errorCount) => {\n    let maxFiles = maxNumberOfFilesForFileupload;\n    let message = gettext('Please upload no more than {maxFiles} files at a time.');\n    message = message.replace('{maxFiles}', maxFiles);\n    toaster.danger(message);\n  }\n\n  maxFileSizeErrorCallback = (file) => {\n    let { forbidUploadFileList } = this.state;\n    forbidUploadFileList.push(file);\n    this.setState({forbidUploadFileList: forbidUploadFileList});\n  }\n\n  onChunkingComplete = (resumableFile) => {\n\n    let allFilesUploaded = this.state.allFilesUploaded;\n    if (allFilesUploaded === true) {\n      this.setState({allFilesUploaded: false});\n    }\n\n    let path = this.props.path;\n    let fileName = resumableFile.fileName;\n    let relativePath = resumableFile.relativePath;\n    let isFile = fileName === relativePath;\n\n    resumableFile.formData = {};\n    if (isFile) { // upload file\n      resumableFile.formData  = {\n        parent_dir: path,\n      };\n    } else { // upload folder\n      let relative_path = relativePath.slice(0, relativePath.lastIndexOf('/') + 1);\n      resumableFile.formData  = {\n        parent_dir: path,\n        relative_path: relative_path\n      };\n    }\n  }\n\n  onFileAdded = (resumableFile, files) => {\n    let isFile = resumableFile.fileName === resumableFile.relativePath;\n    if (isFile && files.length === 1) {\n      let hasRepetition = false;\n      /*\n      let direntList = this.props.direntList;\n      for (let i = 0; i < direntList.length; i++) {\n        if (direntList[i].type === 'file' && direntList[i].name === resumableFile.fileName) {\n          hasRepetition = true;\n          break;\n        }\n      }\n      */\n      if (hasRepetition) {\n        this.setState({\n          isUploadRemindDialogShow: true,\n          currentResumableFile: resumableFile,\n        });\n      } else {\n        this.setUploadFileList(this.resumable.files);\n        seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n          this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n          this.resumableUpload(resumableFile);\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    } else {\n      this.setUploadFileList(this.resumable.files);\n      if (!this.isUploadLinkLoaded) {\n        this.isUploadLinkLoaded = true;\n        seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n          this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n          this.resumable.upload();\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    }\n  }\n\n  resumableUpload = (resumableFile) => {\n    let { repoID, path } = this.props;\n    seafileAPI.getFileUploadedBytes(repoID, path, resumableFile.fileName).then(res => {\n      let uploadedBytes = res.data.uploadedBytes;\n      let blockSize = parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1024 * 1024;\n      let offset = Math.floor(uploadedBytes / blockSize);\n      resumableFile.markChunksCompleted(offset);\n      this.resumable.upload();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  filesAddedComplete = (resumable, files) => {\n    let { forbidUploadFileList } = this.state;\n    if (forbidUploadFileList.length > 0 && files.length === 0) {\n      this.setState({\n        isUploadProgressDialogShow: true,\n        totalProgress: 100\n      });\n    }\n  }\n\n  setUploadFileList = () => {\n    let uploadFileList = this.resumable.files;\n    this.setState({\n      uploadFileList: uploadFileList,\n      isUploadProgressDialogShow: true,\n    });\n    Utils.registerGlobalVariable('uploader', 'isUploadProgressDialogShow', true);\n  }\n\n  onFileProgress = (resumableFile) => {\n    let uploadBitrate = this.getBitrate();\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        if (uploadBitrate) {\n          let lastSize = (item.size - (item.size * item.progress())) * 8;\n          let time = Math.floor(lastSize / uploadBitrate);\n          item.remainingTime = time;\n        }\n      }\n      return item;\n    });\n\n    this.setState({\n      uploadBitrate: uploadBitrate,\n      uploadFileList: uploadFileList\n    });\n  }\n\n  getBitrate = () => {\n    let loaded = 0;\n    let uploadBitrate = 0;\n    let now = new Date().getTime();\n\n    this.resumable.files.forEach(file => {\n      loaded += file.progress() * file.size;\n    });\n\n    if (this.timestamp) {\n      let timeDiff = (now - this.timestamp);\n      if (timeDiff < this.bitrateInterval) {\n        return this.state.uploadBitrate;\n      }\n\n      // 1. Cancel will produce loaded greater than this.loaded\n      // 2. reset can make this.loaded to be 0\n      if (loaded < this.loaded || this.loaded === 0) {\n        this.loaded = loaded; //\n      }\n\n      uploadBitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;\n    }\n\n    this.timestamp = now;\n    this.loaded = loaded;\n\n    return uploadBitrate;\n  }\n\n  // start uploading\n  onUploadStart = () => {\n    const message = gettext('File upload started');\n    toaster.notify(message);\n  }\n\n  onProgress = () => {\n    let progress = Math.round(this.resumable.progress() * 100);\n    this.setState({totalProgress: progress});\n    Utils.registerGlobalVariable('uploader', 'totalProgress', progress);\n  }\n\n  onFileUploadSuccess = (resumableFile, message) => {\n    let formData = resumableFile.formData;\n    let currentTime = new Date().getTime()/1000;\n    message = formData.replace ? message : JSON.parse(message)[0];\n    if (formData.relative_path) { // upload folder\n      let relative_path = formData.relative_path;\n      let dir_name = relative_path.slice(0, relative_path.indexOf('/'));\n      let dirent = {\n        id: message.id,\n        name: dir_name,\n        type: 'dir',\n        mtime: currentTime,\n      };\n\n      // update folders cache\n      let isExist = this.notifiedFolders.some(item => {return item.name === dirent.name;});\n      if (!isExist) {\n        this.notifiedFolders.push(dirent);\n        this.props.onFileUploadSuccess(dirent);\n      }\n\n      // update uploadFileList\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.newFileName = relative_path + message.name;\n          item.isSaved = true;\n        }\n        return item;\n      });\n      this.setState({uploadFileList: uploadFileList});\n\n      return;\n    }\n\n    if (formData.replace) { // upload file -- replace exist file\n      let fileName = resumableFile.fileName;\n      let dirent = {\n        id: message,\n        name: fileName,\n        type: 'file',\n        mtime: currentTime\n      };\n      this.props.onFileUploadSuccess(dirent); // this contance: just one file\n\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.newFileName = fileName;\n          item.isSaved = true;\n        }\n        return item;\n      });\n      this.setState({uploadFileList: uploadFileList});\n\n      return;\n    }\n\n    // upload file -- add files\n    let dirent = {\n      id: message.id,\n      type: 'file',\n      name: message.name,\n      size: message.size,\n      mtime: currentTime,\n    };\n    this.props.onFileUploadSuccess(dirent);\n\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        item.newFileName = message.name;\n        item.isSaved = true;\n      }\n      return item;\n    });\n    this.setState({uploadFileList: uploadFileList});\n  }\n\n  onFileError = (resumableFile, message) => {\n    let error = '';\n    if (!message) {\n      error = gettext('Network error');\n    } else {\n      // eg: '{\"error\": \"Internal error\" \\n }'\n      let errorMessage = message.replace(/\\n/g, '');\n      errorMessage  = JSON.parse(errorMessage);\n      error = errorMessage.error;\n      if (error === 'File locked by others.') {\n        error = gettext('File is locked by others.');\n      }\n      if (error === 'Internal error.') {\n        error = gettext('Internal Server Error');\n      }\n    }\n\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        this.state.retryFileList.push(item);\n        item.error = error;\n      }\n      return item;\n    });\n\n    this.loaded = 0;  // reset loaded data;\n    this.setState({\n      retryFileList: this.state.retryFileList,\n      uploadFileList: uploadFileList\n    });\n  }\n\n  onComplete = () => {\n    if (!this.error) {\n      const message = gettext('All files uploaded');\n      toaster.success(message);\n    }\n    this.error = false; // reset it\n\n    this.notifiedFolders = [];\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    this.setState({allFilesUploaded: true});\n  }\n\n  onError = (message, file) => {\n    let msg = gettext('Error');\n    if (file && file.fileName) {\n      msg = gettext('Failed to upload {file_name}.')\n        .replace('{file_name}', file.fileName);\n    }\n    toaster.danger(msg, {'id': 'file-error-msg'});\n    this.error = true;\n\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    // After the error, the user can switch windows\n    Utils.registerGlobalVariable('uploader', 'totalProgress', 100);\n  }\n\n  setHeaders = (resumableFile, resumable) => {\n    let offset = resumable.offset;\n    let chunkSize = resumable.getOpt('chunkSize');\n    let fileSize = resumableFile.size === 0 ? 1 : resumableFile.size;\n    let startByte = offset !== 0 ? offset * chunkSize : 0;\n    let endByte = Math.min(fileSize, (offset + 1) * chunkSize) - 1;\n\n    if (fileSize - resumable.endByte < chunkSize && !resumable.getOpt('forceChunkSize')) {\n      endByte = fileSize;\n    }\n\n    let headers = {\n      'Accept': 'application/json; text/javascript, */*; q=0.01',\n      'Content-Disposition': 'attachment; filename=\"' + encodeURI(resumableFile.fileName) + '\"',\n      'Content-Range': 'bytes ' + startByte + '-' + endByte + '/' + fileSize,\n    };\n\n    return headers;\n  }\n\n  setQuery = (resumableFile) => {\n    let formData = resumableFile.formData;\n    return formData;\n  }\n\n  generateUniqueIdentifier = (file) => {\n    let relativePath = file.webkitRelativePath||file.relativePath||file.fileName||file.name;\n    return MD5(relativePath + new Date()) + relativePath;\n  }\n\n  onClick = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    e.stopPropagation();\n  }\n\n  onFileUpload = () => {\n    this.uploadInput.current.removeAttribute('webkitdirectory');\n    this.uploadInput.current.click();\n  }\n\n  onFolderUpload = () => {\n    this.uploadInput.current.setAttribute('webkitdirectory', 'webkitdirectory');\n    this.uploadInput.current.click();\n  }\n\n  onDragStart = () => {\n    this.uploadInput.current.setAttribute('webkitdirectory', 'webkitdirectory');\n  }\n\n  onCloseUploadDialog = () => {\n    this.loaded = 0;\n    this.resumable.files = [];\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    this.setState({isUploadProgressDialogShow: false, uploadFileList: [], forbidUploadFileList: []});\n    Utils.registerGlobalVariable('uploader', 'isUploadProgressDialogShow', false);\n  }\n\n  onUploadCancel = (uploadingItem) => {\n\n    let uploadFileList = this.state.uploadFileList.filter(item => {\n      if (item.uniqueIdentifier === uploadingItem.uniqueIdentifier) {\n        item.cancel(); // execute cancel function will delete the file at the same time\n        return false;\n      }\n      return true;\n    });\n\n    if (!this.resumable.isUploading()) {\n      this.setState({\n        totalProgress: '100',\n        allFilesUploaded: true,\n      });\n      this.loaded = 0;\n    }\n\n    this.setState({uploadFileList: uploadFileList});\n  }\n\n  onCancelAllUploading = () => {\n    let uploadFileList = this.state.uploadFileList.filter(item => {\n      if (Math.round(item.progress() !== 1)) {\n        item.cancel();\n        return false;\n      }\n      return true;\n    });\n\n    this.loaded = 0;\n\n    this.setState({\n      allFilesUploaded: true,\n      totalProgress: '100',\n      uploadFileList: uploadFileList\n    });\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n  }\n\n  onUploadRetry = (resumableFile) => {\n    seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n      this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n      let retryFileList = this.state.retryFileList.filter(item => {\n        return item.uniqueIdentifier !== resumableFile.uniqueIdentifier;\n      });\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.error = null;\n          this.retryUploadFile(item);\n        }\n        return item;\n      });\n\n      this.setState({\n        retryFileList: retryFileList,\n        uploadFileList: uploadFileList\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  retryUploadFile = (resumableFile) => {\n    let { repoID, path } = this.props;\n    let fileName = resumableFile.fileName;\n    let isFile = resumableFile.fileName === resumableFile.relativePath;\n    if (!isFile) {\n      let relative_path = resumableFile.formData.relative_path;\n      let prefix = path === '/' ? (path + relative_path) : (path + '/' + relative_path);\n      fileName = prefix + fileName;\n    }\n\n    resumableFile.bootstrap();\n    var firedRetry = false;\n    resumableFile.resumableObj.on('chunkingComplete', () => {\n      if(!firedRetry) {\n        seafileAPI.getFileUploadedBytes(repoID, path, fileName).then(res => {\n          let uploadedBytes = res.data.uploadedBytes;\n          let blockSize = parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1024 * 1024;\n          let offset = Math.floor(uploadedBytes / blockSize);\n          resumableFile.markChunksCompleted(offset);\n\n          resumableFile.resumableObj.upload();\n\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n      firedRetry = true;\n    });\n\n  }\n\n  replaceRepetitionFile = () => {\n    let { repoID, path } = this.props;\n    seafileAPI.getUpdateLink(repoID, path).then(res => {\n      this.resumable.opts.target = res.data;\n\n      let resumableFile = this.resumable.files[this.resumable.files.length - 1];\n      resumableFile.formData['replace'] = 1;\n      resumableFile.formData['target_file'] = resumableFile.formData.parent_dir + resumableFile.fileName;\n      this.setUploadFileList(this.resumable.files);\n      this.resumable.upload();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  cancelFileUpload = () => {\n    this.resumable.files.pop(); //delete latest fileï¼›\n  }\n\n  render() {\n    return (\n      <Fragment>\n        <div className=\"file-uploader-container\">\n          <div className=\"file-uploader\">\n            <input className=\"upload-input\" type=\"file\" ref={this.uploadInput} onClick={this.onClick} />\n          </div>\n        </div>\n        <UploadProgressDialog\n          retryFileList={this.state.retryFileList}\n          uploadFileList={this.state.uploadFileList}\n          forbidUploadFileList={this.state.forbidUploadFileList}\n          totalProgress={this.state.totalProgress}\n          uploadBitrate={this.state.uploadBitrate}\n          allFilesUploaded={this.state.allFilesUploaded}\n          onCloseUploadDialog={this.onCloseUploadDialog}\n          onCancelAllUploading={this.onCancelAllUploading}\n          onUploadCancel={this.onUploadCancel}\n          onUploadRetry={this.onUploadRetry}\n          onFileUpload={this.onFileUpload}\n          onFolderUpload={this.onFolderUpload}\n        />\n      </Fragment>\n    );\n  }\n}\n\nFileUploader.propTypes = propTypes;\n\nexport default FileUploader;\n","import React, { Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Utils } from '../../utils/utils';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext } from '../../utils/constants';\nimport Logo from '../../components/logo';\nimport Account from '../../components/common/account';\nimport FileUploader from './file-uploader';\n\nimport '../../css/upload-link.css';\n\nconst loggedUser = window.app.pageOptions.username;\nconst {\n  dirName,\n  sharedBy,\n  noQuota,\n  maxUploadFileSize,\n  token,\n  repoID,\n  path\n} = window.uploadLink;\n\n\nclass SharedUploadLink extends React.Component {\n\n  onFileUploadSuccess = (direntObject) => {\n    const { name, size } = direntObject;\n    seafileAPI.shareLinksUploadDone(token, Utils.joinPath(path, name));\n  }\n\n  render() {\n    return (\n      <div className=\"h-100 d-flex flex-column\">\n        <div className=\"top-header d-flex justify-content-between\">\n          <Logo />\n          {loggedUser && <Account />}\n        </div>\n        <div className=\"o-auto\">\n          <div className=\"py-4 px-6 mx-auto rounded\" id=\"upload-link-panel\">\n            <h3 className=\"h5\" dangerouslySetInnerHTML={{__html: gettext('Upload files to {folder_name_placeholder}')\n              .replace('{folder_name_placeholder}', `<span class=\"op-target\">${Utils.HTMLescape(dirName)}</span>`)}}></h3>\n            <p className=\"small shared-by\" dangerouslySetInnerHTML={{__html: `${gettext('shared by:')} ${sharedBy.avatar} ${sharedBy.name}`}}></p>\n            {noQuota ? (\n              <div className=\"py-6 text-center\">\n                <span className=\"sf3-font sf3-font-tips warning-icon\"></span>\n                <p>{gettext('The owner of this library has run out of space.')}</p>\n              </div>\n            ) : (\n              <Fragment>\n                <ol className=\"small text-gray\">\n                  <li className=\"tip-list-item\">{gettext('Folder upload is limited to Chrome, Firefox 50+, and Microsoft Edge.')}</li>\n                  {maxUploadFileSize && <li className=\"tip-list-item\">{gettext('File size should be smaller than {max_size_placeholder}.').replace('{max_size_placeholder}', maxUploadFileSize)}</li>}\n                </ol>\n                <div id=\"upload-link-drop-zone\" className=\"text-center mt-2 mb-4\">\n                  <span className=\"sf3-font sf3-font-upload upload-icon\"></span>\n                  <p className=\"small text-gray mb-0\">{gettext('Drag and drop files or folders here.')}</p>\n                </div>\n                <FileUploader\n                  ref={uploader => this.uploader = uploader}\n                  dragAndDrop={true}\n                  token={token}\n                  repoID={repoID}\n                  path={path}\n                  onFileUploadSuccess={this.onFileUploadSuccess}\n                />\n              </Fragment>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReactDOM.render(\n  <SharedUploadLink />,\n  document.getElementById('wrapper')\n);\n"],"sourceRoot":""}