"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[53],{95714:function(e,t,n){var i=n(15671),s=n(43144),o=n(60136),r=n(29388),a=n(72791),c=n(54164),l=n(55294),h=n(53585),d=n(93433),u=n(39571),m=n(63446),p=n(72426),f=n.n(p),g=n(61599),v=n(20387),I=n(59508),k=n(52919),C=n(69498),x=(n(45020),n(80184));f().locale(window.app.config.lang);var w=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).onMouseEnter=function(){s.props.isItemFreezed||s.setState({isShowOperationIcon:!0})},s.onMouseLeave=function(){s.props.isItemFreezed||s.setState({isShowOperationIcon:!1})},s.onToggleClick=function(e){s.setState({isMenuShow:!s.state.isMenuShow}),s.props.onFreezedItemToggle()},s.onItemClick=function(){if(s.setState({isShowOperationIcon:!1}),s.props.item.commit_id!==s.props.currentItem.commit_id){var e=s.props.index;s.props.onItemClick(s.props.item,e)}},s.onItemRestore=function(){s.props.onItemRestore(s.props.currentItem)},s.onItemDownload=function(){},s.state={isShowOperationIcon:!1,isMenuShow:!1},s}return(0,s.Z)(n,[{key:"render",value:function(){if(!this.props.currentItem)return"";var e=this.props.item,t=f()(e.ctime).format("YYYY-MM-DD HH:mm"),n=!1;this.props.item&&this.props.currentItem&&(n=this.props.item.commit_id===this.props.currentItem.commit_id);var i=this.props.currentItem.rev_file_id,s=C.Z.getUrl({type:"download_historic_file",filePath:h.bc,objID:i});return(0,x.jsxs)("li",{className:"history-list-item ".concat(n?"item-active":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onItemClick,children:[(0,x.jsxs)("div",{className:"history-info",children:[(0,x.jsx)("div",{className:"time",children:t}),(0,x.jsxs)("div",{className:"owner",children:[(0,x.jsx)("span",{className:"squire-icon"}),(0,x.jsx)("span",{children:e.creator_name})]})]}),(0,x.jsx)("div",{className:"history-operation",children:(0,x.jsxs)(g.Z,{isOpen:this.state.isMenuShow,toggle:this.onToggleClick,children:[(0,x.jsx)(v.Z,{tag:"a",className:"fas fa-ellipsis-v ".concat(this.state.isShowOperationIcon||n?"":"invisible"),"data-toggle":"dropdown","aria-expanded":this.state.isMenuShow,alt:(0,h.ih)("More Operations")}),(0,x.jsxs)(I.Z,{children:[0!==this.props.index&&(0,x.jsx)(k.Z,{onClick:this.onItemRestore,children:(0,h.ih)("Restore")}),(0,x.jsx)(k.Z,{tag:"a",href:s,onClick:this.onItemDownLoad,children:(0,h.ih)("Download")})]})]})})]})}}]),n}(a.Component),y=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).componentDidMount=function(){var e=s.props.historyList;e.length>0&&(s.setState({currentItem:e[0]}),1===e?s.props.onItemClick(e[0]):s.props.onItemClick(e[0],e[1]))},s.onFreezedItemToggle=function(){s.setState({isItemFreezed:!s.state.isItemFreezed})},s.onScrollHandler=function(e){var t=e.target.clientHeight,n=e.target.scrollHeight,i=t+e.target.scrollTop+1>=n,o=s.props.hasMore;i&&o&&s.props.reloadMore()},s.onItemClick=function(e,t){if(s.setState({currentItem:e}),t!==s.props.historyList.length){var n=s.props.historyList[t+1];s.props.onItemClick(e,n)}else s.props.onItemClick(e)},s.state={isItemFreezed:!1,currentItem:null},s}return(0,s.Z)(n,[{key:"render",value:function(){var e=this;return(0,x.jsxs)("ul",{className:"history-list-container",onScroll:this.onScrollHandler,children:[this.props.historyList.map((function(t,n){return(0,x.jsx)(w,{item:t,index:n,currentItem:e.state.currentItem,isItemFreezed:e.state.isItemFreezed,onItemClick:e.onItemClick,onItemRestore:e.props.onItemRestore,onFreezedItemToggle:e.onFreezedItemToggle},n)})),this.props.isReloadingData&&(0,x.jsx)("li",{children:(0,x.jsx)(m.Z,{})})]})}}]),n}(a.Component),Z=n(51832),j=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).reloadMore=function(){if(!s.state.isReloadingData){var e=s.state.currentPage+1;s.setState({currentPage:e,isReloadingData:!0}),u.Z.listFileHistoryRecords(h.bc,e,h.LZ).then((function(e){s.updateResultState(e.data),s.setState({isReloadingData:!1})}))}},s.onItemRestore=function(e){var t=e.commit_id;u.Z.revertFile(h.bc,t).then((function(e){e.data.success&&(s.setState({isLoading:!0}),s.refershFileList());var t=(0,h.ih)("Successfully restored.");Z.Z.success(t)}))},s.onItemClick=function(e,t){s.props.onItemClick(e,t)},s.state={historyInfo:"",currentPage:1,hasMore:!1,isLoading:!0,isError:!1,fileOwner:"",isReloadingData:!1},s}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var e=this;u.Z.listFileHistoryRecords(h.bc,1,h.LZ).then((function(t){if(0===t.data.length)throw e.setState({isLoading:!1}),Error("there has an error in server");e.initResultState(t.data)}))}},{key:"refershFileList",value:function(){var e=this;u.Z.listFileHistoryRecords(h.bc,1,h.LZ).then((function(t){e.initResultState(t.data)}))}},{key:"initResultState",value:function(e){e.data.length&&this.setState({historyInfo:e.data,currentPage:e.page,hasMore:e.total_count>h.LZ*this.state.currentPage,isLoading:!1,isError:!1,fileOwner:e.data[0].creator_email})}},{key:"updateResultState",value:function(e){e.data.length&&this.setState({historyInfo:[].concat((0,d.Z)(this.state.historyInfo),(0,d.Z)(e.data)),currentPage:e.page,hasMore:e.total_count>h.LZ*this.state.currentPage,isLoading:!1,isError:!1,fileOwner:e.data[0].creator_email})}},{key:"render",value:function(){return(0,x.jsx)("div",{className:"side-panel history-side-panel",children:(0,x.jsxs)("div",{className:"side-panel-center",children:[(0,x.jsx)("div",{className:"history-side-panel-title",children:(0,h.ih)("History Versions")}),(0,x.jsxs)("div",{className:"history-body",children:[this.state.isLoading&&(0,x.jsx)(m.Z,{}),this.state.historyInfo&&(0,x.jsx)(y,{hasMore:this.state.hasMore,isReloadingData:this.state.isReloadingData,historyList:this.state.historyInfo,reloadMore:this.reloadMore,onItemClick:this.onItemClick,onItemRestore:this.onItemRestore})]})]})})}}]),n}(a.Component),S=n(4788),M=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onSearchedClick=function(){},e}return(0,s.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.renderingContent,n=e.newMarkdownContent;return(0,x.jsxs)("div",{className:"content-viewer flex-fill",children:[t&&(0,x.jsx)(m.Z,{}),!t&&(0,x.jsx)(S.av,{isFetching:t,value:n,isShowOutline:!1,mathJaxSource:h.si+"js/mathjax/tex-svg.js"})]})}}]),n}(a.Component),R=M,L=n(98015),F=(n(28421),function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).setDiffContent=function(e,t){s.setState({renderingContent:!1,newMarkdownContent:e,oldMarkdownContent:t})},s.onHistoryItemClick=function(e,t){s.setState({renderingContent:!0}),L.I.getFileRevision(h.y8,e.commit_id,e.path).then((function(e){l.Z.all([L.I.getFileContent(e.data)]).then(l.Z.spread((function(e){s.setDiffContent(e.data,"")})))}))},s.onBackClick=function(e){e.preventDefault(),window.history.back()},s.state={renderingContent:!0,newMarkdownContent:"",oldMarkdownContent:""},s}return(0,s.Z)(n,[{key:"render",value:function(){return(0,x.jsxs)("div",{className:"history-content flex-fill d-flex h-100",children:[(0,x.jsxs)("div",{className:"flex-fill d-flex flex-column",children:[(0,x.jsx)("div",{className:"history-header file-history-header flex-shrink-0",children:(0,x.jsxs)("div",{className:"title",children:[(0,x.jsx)("a",{href:"#",className:"go-back",title:"Back",onClick:this.onBackClick,children:(0,x.jsx)("span",{className:"fas fa-chevron-left"})}),(0,x.jsx)("span",{className:"name",children:h.Yp})]})}),(0,x.jsx)(R,{newMarkdownContent:this.state.newMarkdownContent,oldMarkdownContent:this.state.oldMarkdownContent,renderingContent:this.state.renderingContent})]}),(0,x.jsx)(j,{onItemClick:this.onHistoryItemClick})]})}}]),n}(a.Component));c.render((0,x.jsx)(F,{}),document.getElementById("wrapper"))},45020:function(){}},function(e){e.O(0,[351],(function(){return t=95714,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=fileHistory.5b15444d.js.map