{"version":3,"sources":["components/history-list-view/history-list-item.js","components/history-list-view/history-list-view.js","pages/file-history/side-panel.js","pages/file-history/main-panel.js","file-history.js"],"names":["moment","locale","window","app","config","lang","HistoryListItem","props","onMouseEnter","isItemFreezed","setState","isShowOperationIcon","onMouseLeave","onToggleClick","e","isMenuShow","state","onFreezedItemToggle","onItemClick","item","commit_id","currentItem","currentIndex","index","onItemRestore","onItemDownload","this","time","ctime","format","isHigtlightItem","objID","rev_file_id","url","URLDecorator","getUrl","type","filePath","className","onClick","creator_name","isOpen","toggle","tag","data-toggle","aria-expanded","alt","gettext","href","onItemDownLoad","React","Component","HistoryListView","componentDidMount","historyList","length","onScrollHandler","event","clientHeight","target","scrollHeight","isBottom","scrollTop","hasMore","reloadMore","preItem","onScroll","map","isReloadingData","SidePanel","currentPage","editUtilities","listFileHistoryRecords","PER_PAGE","then","res","updateResultState","data","commitId","revertFile","success","isLoading","refershFileList","message","toaster","historyInfo","isError","fileOwner","Error","initResultState","result","page","total_count","creator_email","MainPanel","onSearchedClick","Prism","highlightAll","renderingContent","scriptSource","mediaUrl","newMarkdownContent","oldMarkdownContent","FileHistory","searchedItem","Utils","handleSearchedItemClick","setDiffContent","onHistoryItemClick","axios","all","seafileAPI","getFileRevision","historyRepoID","path","spread","res1","getFileContent","content1","content2","id","title","fileName","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/fileHistory.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\n\nmoment.locale(window.app.config.lang);\n\nconst propTypes = {\n  index: PropTypes.number.isRequired,\n  item: PropTypes.object.isRequired,\n  currentItem: PropTypes.object,\n  isItemFreezed: PropTypes.bool.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n  onFreezedItemToggle: PropTypes.func.isRequired,\n};\n\nclass HistoryListItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: true});\n    }\n  }\n\n  onMouseLeave = () => {\n    if (!this.props.isItemFreezed) {\n      this.setState({isShowOperationIcon: false});\n    }\n  }\n\n  onToggleClick = (e) => {\n    this.setState({isMenuShow: !this.state.isMenuShow});\n    this.props.onFreezedItemToggle();\n  }\n\n  onItemClick = () => {\n    this.setState({isShowOperationIcon: false});  //restore to default state\n    if (this.props.item.commit_id === this.props.currentItem.commit_id) {\n      return;\n    }\n    let currentIndex = this.props.index;\n    this.props.onItemClick(this.props.item, currentIndex);\n  }\n\n  onItemRestore = () => {\n    this.props.onItemRestore(this.props.currentItem);\n  }\n\n  onItemDownload = () => {\n    // nothing todo\n  }\n\n  render() {\n    if (!this.props.currentItem) {\n      return '';\n    }\n    let item = this.props.item;\n    let time = moment(item.ctime).format('YYYY-MM-DD HH:mm');\n    let isHigtlightItem = false;\n    if (this.props.item && this.props.currentItem) {\n      isHigtlightItem = this.props.item.commit_id === this.props.currentItem.commit_id;\n    }\n    let objID = this.props.currentItem.rev_file_id;\n    let url = URLDecorator.getUrl({type: 'download_historic_file', filePath: filePath, objID: objID});\n    return (\n      <li\n        className={`history-list-item ${isHigtlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onItemClick}\n      >\n        <div className=\"history-info\">\n          <div className=\"time\">{time}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{item.creator_name}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHigtlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryListItem.propTypes = propTypes;\n\nexport default HistoryListItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport HisotyListItem from './history-list-item';\nimport Loading from '../loading';\n\nconst propTypes = {\n  hasMore: PropTypes.bool.isRequired,\n  isReloadingData: PropTypes.bool.isRequired,\n  historyList: PropTypes.array.isRequired,\n  reloadMore: PropTypes.func.isRequired,\n  onItemClick: PropTypes.func.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n};\n\nclass HistoryListView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isItemFreezed: false,\n      currentItem: null,\n    };\n  }\n\n  componentDidMount = () => {\n    let historyList = this.props.historyList;\n    if (historyList.length > 0) {\n      this.setState({currentItem: historyList[0]});\n      if (historyList === 1) {\n        this.props.onItemClick(historyList[0]);\n      } else {\n        this.props.onItemClick(historyList[0], historyList[1]);\n      }\n    }\n  }\n\n  onFreezedItemToggle = () => {\n    this.setState({isItemFreezed: !this.state.isItemFreezed});\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop    = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    let hasMore = this.props.hasMore;\n    if (isBottom && hasMore) {\n      this.props.reloadMore();\n    }\n  }\n\n  onItemClick = (item, currentIndex) => {\n    this.setState({currentItem: item});\n    if (currentIndex !== this.props.historyList.length) {\n      let preItem = this.props.historyList[currentIndex + 1];\n      this.props.onItemClick(item, preItem);\n    } else {\n      this.props.onItemClick(item);\n    }\n  }\n\n  render() {\n    return (\n      <ul className=\"history-list-container\" onScroll={this.onScrollHandler}>\n        {this.props.historyList.map((item, index) => {\n          return (\n            <HisotyListItem\n              key={index}\n              item={item}\n              index={index}\n              currentItem={this.state.currentItem}\n              isItemFreezed={this.state.isItemFreezed}\n              onItemClick={this.onItemClick}\n              onItemRestore={this.props.onItemRestore}\n              onFreezedItemToggle={this.onFreezedItemToggle}\n            />\n          );\n        })}\n        {this.props.isReloadingData && <li><Loading /></li>}\n      </ul>\n    );\n  }\n}\n\nHistoryListView.propTypes = propTypes;\n\nexport default HistoryListView;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, PER_PAGE, filePath } from '../../utils/constants';\nimport editUtilities from '../../utils/editor-utilities';\nimport Loading from '../../components/loading';\nimport HistoryListView from '../../components/history-list-view/history-list-view';\nimport toaster from '../../components/toast';\n\nconst propTypes = {\n  onItemClick: PropTypes.func.isRequired,\n};\n\nclass SidePanel extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      historyInfo: '',\n      currentPage: 1,\n      hasMore: false,\n      isLoading: true,\n      isError: false,\n      fileOwner: '',\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      let historyList = res.data;\n      if (historyList.length === 0) {\n        this.setState({isLoading: false});\n        throw Error('there has an error in server');\n      }\n      this.initResultState(res.data);\n    });\n  }\n\n  refershFileList() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      this.initResultState(res.data);\n    });\n  }\n\n  initResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: result.data,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email,\n      });\n    }\n  }\n\n  updateResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: [...this.state.historyInfo, ...result.data],\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email\n      });\n    }\n  }\n\n  reloadMore = () => {\n    if (!this.state.isReloadingData) {\n      let currentPage = this.state.currentPage + 1;\n      this.setState({\n        currentPage: currentPage,\n        isReloadingData: true,\n      });\n      editUtilities.listFileHistoryRecords(filePath, currentPage, PER_PAGE).then(res => {\n        this.updateResultState(res.data);\n        this.setState({isReloadingData: false});\n      });\n    }\n  }\n\n  onItemRestore = (currentItem) => {\n    let commitId = currentItem.commit_id;\n    editUtilities.revertFile(filePath, commitId).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n      let message = gettext('Successfully restored.');\n      toaster.success(message);\n    });\n  }\n\n  onItemClick =(item, preItem) => {\n    this.props.onItemClick(item, preItem);\n  }\n\n  render() {\n    return (\n      <div className=\"side-panel history-side-panel\">\n        <div className=\"side-panel-center\">\n          <div className=\"history-side-panel-title\">{gettext('History Versions')}</div>\n          <div className=\"history-body\">\n            {this.state.isLoading && <Loading />}\n            {this.state.historyInfo &&\n              <HistoryListView\n                hasMore={this.state.hasMore}\n                isReloadingData={this.state.isReloadingData}\n                historyList={this.state.historyInfo}\n                reloadMore={this.reloadMore}\n                onItemClick={this.onItemClick}\n                onItemRestore={this.onItemRestore}\n              />\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = propTypes;\n\nexport default SidePanel;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Prism from 'prismjs';\nimport { DiffViewer } from '@seafile/seafile-editor';\nimport Loading from '../../components/loading';\nimport { mediaUrl } from '../../utils/constants';\n\nconst contentClass = 'markdown-viewer-render-content';\nconst propTypes = {\n  renderingContent: PropTypes.bool.isRequired,\n  content: PropTypes.string,\n  newMarkdownContent: PropTypes.string.isRequired,\n  oldMarkdownContent: PropTypes.string.isRequired,\n};\n\nclass MainPanel extends React.Component {\n\n  componentDidMount() {\n    Prism.highlightAll();\n  }\n\n  onSearchedClick = () => {\n    //todos;\n  }\n\n  render() {\n    return (\n      <div className=\"main-panel\">\n        <div className=\"main-panel-center content-viewer\">\n          <div className={contentClass}>\n            {\n              this.props.renderingContent ?\n                (<Loading />) :\n                (<div className=\"diff-view article\">\n                  <DiffViewer\n                    scriptSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n                    newMarkdownContent={this.props.newMarkdownContent}\n                    oldMarkdownContent={this.props.oldMarkdownContent}\n                  />\n                </div>)\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nMainPanel.propTypes = propTypes;\n\nexport default MainPanel;\n","import React, { Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport axios from 'axios';\nimport { fileName, historyRepoID } from './utils/constants';\nimport { Utils } from './utils/utils';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport SidePanel from './pages/file-history/side-panel';\nimport MainPanel from './pages/file-history/main-panel';\nimport { seafileAPI } from './utils/seafile-api';\n\nimport './css/layout.css';\nimport './css/file-history.css';\nimport './css/toolbar.css';\nimport './css/search.css';\n\nclass FileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      renderingContent: true,\n      newMarkdownContent: '',\n      oldMarkdownContent: ''\n    };\n  }\n\n  onSearchedClick = (searchedItem) => {\n    Utils.handleSearchedItemClick(searchedItem);\n  }\n\n  setDiffContent = (newMarkdownContent, oldMarkdownContent)=> {\n    this.setState({\n      renderingContent: false,\n      newMarkdownContent: newMarkdownContent,\n      oldMarkdownContent: oldMarkdownContent,\n    });\n  }\n\n\n  onHistoryItemClick = (item, preItem)=> {\n    this.setState({renderingContent: true});\n    if (preItem) {\n      axios.all([\n        seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path),\n        seafileAPI.getFileRevision(historyRepoID, preItem.commit_id, preItem.path)\n      ]).then(axios.spread((res, res1) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n          seafileAPI.getFileContent(res1.data)\n        ]).then(axios.spread((content1, content2) => {\n          this.setDiffContent(content1.data, content2.data);\n        }));\n      }));\n    } else {\n      seafileAPI.getFileRevision(historyRepoID, item.commit_id, item.path).then((res) => {\n        axios.all([\n          seafileAPI.getFileContent(res.data),\n        ]).then(axios.spread((content1) => {\n          this.setDiffContent(content1.data, '');\n        }));\n      });\n    }\n  }\n\n  render() {\n    return(\n      <Fragment>\n        <div id=\"header\" className=\"history-header\">\n          <div className=\"title\">\n            <a href=\"javascript:window.history.back()\" className=\"go-back\" title=\"Back\">\n              <span className=\"fas fa-chevron-left\"></span>\n            </a>\n            <span className=\"name\">{fileName}</span>\n          </div>\n          <div className='toolbar'>\n            <CommonToolbar onSearchedClick={this.onSearchedClick} />\n          </div>\n        </div>\n        <div id=\"main\" className=\"history-content\">\n          <MainPanel\n            newMarkdownContent={this.state.newMarkdownContent}\n            oldMarkdownContent={this.state.oldMarkdownContent}\n            renderingContent={this.state.renderingContent}\n          />\n          <SidePanel onItemClick={this.onHistoryItemClick}/>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nReactDOM.render (\n  <FileHistory />,\n  document.getElementById('wrapper')\n);\n"],"sourceRoot":""}