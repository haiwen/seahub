{% extends 'group/group_base.html' %}

{% load seahub_tags i18n %}

{% block cur_library %}tab-cur{% endblock%}

{% block right_panel %}
<div id="tabs" class="tab-tabs">
    <div class="hd ovhd">
        <ul class="tab-tabs-nav fleft">
            <li class="tab"><a href="#grp-repos" class="a">{% trans "Libraries" %}</a></li>
            <li class="tab long-tab"><a href="#grp-repos-commits" class="a">{% trans "Recent Changes" %}</a></li>
        </ul>
        {% if user.permissions.can_add_repo %}
        <button id="repo-create" class="fright"><img src="{{ MEDIA_URL }}img/add.png" alt="" class="add vam" /><span class="vam">{% trans "New Library" %}</span></button>
        {% endif %}
    </div>
    <div id="grp-repos">
        <table style="display:none">
            <tr>
                <th width="4%"><!--icon--></th>
                <th width="20%">{% trans "Name" %} <span id="grp-repo-list-name-down" class="icon-caret-up cspt"></span> <span id="grp-repo-list-name-up" class="icon-caret-down cspt hide"></span></th>
                <th width="33%">{% trans "Description" %}</th>
                <th width="16%">{% trans "Last Update" %} <span id="grp-repo-list-time-up" class="icon-caret-up cspt hide"></span> <span id="grp-repo-list-time-down" class="icon-caret-down cspt"></span></th>
                <th width="14%">{% trans "Shared By" %}</th>
                <th width="13%">{% trans "Operations" %}</th>
            </tr>

            <p class="loading">{% trans "Loading ..." %}</p>
        </table>

        <div class="empty-tips" style="margin-bottom:150px; display:none;">
            <h2 class="alc">{% trans "No library is sharing to this group" %}</h2>
            <p>{% blocktrans %}You can share libraries by clicking the "New Library" button above or the "Share" icon on your libraries list.{% endblocktrans %}</p>
            <p>{% trans "Libraries shared as writable can be downloaded and synced by other group members. Read only libraries can only be downloaded, updates by others will not be uploaded." %}</p>
        </div>
    </div>

    <div id="grp-repos-commits" class="hide">
    {% if recent_commits|length > 0 %}
    <table>
    <tr>
        <th width="5%"></th>
        <th width="17%">{% trans "Library" %}</th>
        <th width="48%">{% trans "Description" %}</th>
        <th width="15%">{% trans "Modified at" %}</th>
        <th width="15%">{% trans "Modifier" %}</th>
    </tr>

    {% for cmt in recent_commits %}
    <tr>
        <td>
            {% if cmt.tp == 'Added' or cmt.tp == 'Deleted' or cmt.tp == 'Removed' %}
                {% if cmt.tp == 'Added' %}
                <span class="icon-plus"></span>
                {% else %}
                <span class="icon-minus"></span>
                {% endif %}
            {% else %}
                <span class="icon-pencil"></span>
            {% endif %}
        </td>
        <td><a href="{{ SITE_ROOT }}repo/{{ cmt.repo.props.id }}/">{{ cmt.repo.props.name }}</a></td>
        <td>
            {{cmt.props.desc|translate_commit_desc}}
            {% if cmt.repo.encrypted %}
                <a class="lsch-encrypted"{% if cmt.repo.password_set %} data-passwordset="true"{% endif %} href="#" data-url="{% url 'repo_history_changes' cmt.repo.id %}?commit_id={{ cmt.id }}" data-repoid="{{cmt.repo.id}}" data-reponame="{{cmt.repo.name}}" data-time="{{ cmt.props.ctime|tsstr_sec }}">{% trans 'Details' %}</a>
            {% else %}
                <a class="lsch" href="#" data-url="{% url 'repo_history_changes' cmt.repo.id %}?commit_id={{ cmt.id }}" data-time="{{ cmt.props.ctime|tsstr_sec }}">{% trans 'Details' %}</a>
            {% endif %}
        </td>
        <td>{{cmt.props.ctime|translate_seahub_time}}</td>
        <td>
        {% if cmt.creator_name %}
            {% if cmt.second_parent_id %}
                {% trans "None" %}
            {% else %}
                {{cmt.creator_name|email2nickname}}
            {% endif %}
        {% else %}
            {% trans "Unknown"%}
        {% endif %}
        </td>
    </tr>
    {% endfor %}
    </table>
    {% endif %}
    </div>
</div>

{% if user.permissions.can_add_repo %}
{% include "snippets/repo_create_form.html" %}
{% endif %}

<form id="repo-decrypt-form" class="hide">
    <h3>{% trans 'Library' %} <span class="op-target"></span> {% trans 'is encrypted' %}</h3>
    <input type="hidden" name="repo_id" value="" />
    <label>{% trans 'Passwordï¼š' %}</label><br />
    <input type="password" name="password" class="input" />
    <p class="tip">{% trans "The password will be kept in the server for only 1 hour." %}</p>
    <p class="error"></p>
    <input type="submit" class="submit" value="{% trans 'Submit' %}" />
    <button class="simplemodal-close">{% trans 'Cancel' %}</button>
</form>

{% endblock %}

{% block extra_script %}
<script>
 app["pageOptions"] = {
     groupId: {{ group.id }},
     groupReposUrl: "{% url "api2-grouprepos" group.id %}",
     isGroupStaff: (function() {
         if ("{{ is_staff }}" == "True")
             return true;
         return false;
     })(),
     csrfToken: "{{csrf_token}}"
 };
</script>
<script data-main="{{ MEDIA_URL }}scripts/group" src="{{ MEDIA_URL }}scripts/lib/require.js"></script>

{% endblock %}
