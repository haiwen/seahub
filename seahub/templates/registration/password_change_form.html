{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Password Modification" %}{% endblock %}

{% block extra_style %}
{% endblock %}

{% block main_content %}
<div class="page-form-panel">
  <h2 class="hd text-center mb-2">{% trans "Password Modification" %}</h2>
  {% if not force_passwd_change %}
  <p class="tip text-center mb-8">{% trans "Please update your password before continue." %}</p>
  {% endif %}
  <form action="" method="post" class="mx-auto form">{% csrf_token %}
    <div class="form-group">
      <label for="id_old_password" class="form-label">{% trans "Current Password" %}</label>
      <div class="input-group">
        <input type="password" name="old_password" required="" id="id_old_password" class="form-control" />
        <button type="button" class="btn btn-secondary"><svg t="1720504436505" class="seafile-multicolor-icon password-icon seafile-multicolor-icon-eye-slash" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6548" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" aria-hidden="true"><path d="M80.91936 102.4l156.8 124.8C311.31936 169.6 400.91936 128 512.91936 128c134.4 0 243.2 64 320 137.6 76.8 73.6 131.2 163.2 153.6 224 6.4 12.8 6.4 28.8 0 41.6-22.4 51.2-64 124.8-124.8 192l140.8 112c19.2 16 22.4 44.8 6.4 67.2-16 19.2-48 22.4-67.2 6.4l-928-736C-2.28064 160-5.48064 128 10.51936 108.8s48-22.4 70.4-6.4z m32 256L186.51936 416C160.91936 454.4 141.71936 486.4 128.91936 515.2c22.4 51.2 64 121.6 128 179.2 67.2 64 153.6 112 256 112 44.8 0 86.4-9.6 124.8-22.4l76.8 64c-57.6 32-124.8 51.2-201.6 51.2-134.4 0-243.2-64-320-137.6-76.8-73.6-131.2-163.2-153.6-224-6.4-12.8-6.4-28.8 0-41.6 12.8-41.6 38.4-89.6 73.6-137.6z m185.6 150.4l112 89.6c12.8 16 25.6 25.6 44.8 35.2l112 89.6c-16 3.2-35.2 6.4-51.2 6.4-121.6 3.2-217.6-96-217.6-220.8zM512.91936 224c-76.8 0-144 25.6-198.4 64l67.2 51.2c35.2-28.8 80-48 131.2-48 118.4 0 214.4 99.2 214.4 220.8 0 32-6.4 60.8-19.2 89.6l86.4 70.4c48-54.4 83.2-112 102.4-153.6-22.4-51.2-64-121.6-128-179.2C704.91936 272 618.51936 224 512.91936 224z m0 150.4h-3.2c3.2 9.6 3.2 19.2 3.2 28.8 0 12.8-3.2 25.6-6.4 38.4l134.4 108.8c3.2-12.8 3.2-22.4 3.2-35.2 3.2-80-57.6-140.8-131.2-140.8z" p-id="6549"></path></svg></button>
      </div>
      {{ form.old_password.errors }}
    </div>
    <div class="form-group">
      <label for="id_new_password1" class="form-label">{% trans "New Password" %}</label>
      <div class="input-group">
        <input type="password" name="new_password1" required="" id="id_new_password1" class="form-control" />
        <button type="button" class="btn btn-secondary"><svg t="1720504436505" class="seafile-multicolor-icon password-icon seafile-multicolor-icon-eye-slash" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6548" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" aria-hidden="true"><path d="M80.91936 102.4l156.8 124.8C311.31936 169.6 400.91936 128 512.91936 128c134.4 0 243.2 64 320 137.6 76.8 73.6 131.2 163.2 153.6 224 6.4 12.8 6.4 28.8 0 41.6-22.4 51.2-64 124.8-124.8 192l140.8 112c19.2 16 22.4 44.8 6.4 67.2-16 19.2-48 22.4-67.2 6.4l-928-736C-2.28064 160-5.48064 128 10.51936 108.8s48-22.4 70.4-6.4z m32 256L186.51936 416C160.91936 454.4 141.71936 486.4 128.91936 515.2c22.4 51.2 64 121.6 128 179.2 67.2 64 153.6 112 256 112 44.8 0 86.4-9.6 124.8-22.4l76.8 64c-57.6 32-124.8 51.2-201.6 51.2-134.4 0-243.2-64-320-137.6-76.8-73.6-131.2-163.2-153.6-224-6.4-12.8-6.4-28.8 0-41.6 12.8-41.6 38.4-89.6 73.6-137.6z m185.6 150.4l112 89.6c12.8 16 25.6 25.6 44.8 35.2l112 89.6c-16 3.2-35.2 6.4-51.2 6.4-121.6 3.2-217.6-96-217.6-220.8zM512.91936 224c-76.8 0-144 25.6-198.4 64l67.2 51.2c35.2-28.8 80-48 131.2-48 118.4 0 214.4 99.2 214.4 220.8 0 32-6.4 60.8-19.2 89.6l86.4 70.4c48-54.4 83.2-112 102.4-153.6-22.4-51.2-64-121.6-128-179.2C704.91936 272 618.51936 224 512.91936 224z m0 150.4h-3.2c3.2 9.6 3.2 19.2 3.2 28.8 0 12.8-3.2 25.6-6.4 38.4l134.4 108.8c3.2-12.8 3.2-22.4 3.2-35.2 3.2-80-57.6-140.8-131.2-140.8z" p-id="6549"></path></svg></button>
      </div>
      {{ form.new_password1.errors }}
    </div>
    <div class="form-group">
      <label for="id_new_password2" class="form-label">{% trans "Confirm Password" %}</label>
      <div class="input-group">
        <input type="password" name="new_password2" required="" id="id_new_password2" class="form-control" />
        <button type="button" class="btn btn-secondary"><svg t="1720504436505" class="seafile-multicolor-icon password-icon seafile-multicolor-icon-eye-slash" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6548" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" aria-hidden="true"><path d="M80.91936 102.4l156.8 124.8C311.31936 169.6 400.91936 128 512.91936 128c134.4 0 243.2 64 320 137.6 76.8 73.6 131.2 163.2 153.6 224 6.4 12.8 6.4 28.8 0 41.6-22.4 51.2-64 124.8-124.8 192l140.8 112c19.2 16 22.4 44.8 6.4 67.2-16 19.2-48 22.4-67.2 6.4l-928-736C-2.28064 160-5.48064 128 10.51936 108.8s48-22.4 70.4-6.4z m32 256L186.51936 416C160.91936 454.4 141.71936 486.4 128.91936 515.2c22.4 51.2 64 121.6 128 179.2 67.2 64 153.6 112 256 112 44.8 0 86.4-9.6 124.8-22.4l76.8 64c-57.6 32-124.8 51.2-201.6 51.2-134.4 0-243.2-64-320-137.6-76.8-73.6-131.2-163.2-153.6-224-6.4-12.8-6.4-28.8 0-41.6 12.8-41.6 38.4-89.6 73.6-137.6z m185.6 150.4l112 89.6c12.8 16 25.6 25.6 44.8 35.2l112 89.6c-16 3.2-35.2 6.4-51.2 6.4-121.6 3.2-217.6-96-217.6-220.8zM512.91936 224c-76.8 0-144 25.6-198.4 64l67.2 51.2c35.2-28.8 80-48 131.2-48 118.4 0 214.4 99.2 214.4 220.8 0 32-6.4 60.8-19.2 89.6l86.4 70.4c48-54.4 83.2-112 102.4-153.6-22.4-51.2-64-121.6-128-179.2C704.91936 272 618.51936 224 512.91936 224z m0 150.4h-3.2c3.2 9.6 3.2 19.2 3.2 28.8 0 12.8-3.2 25.6-6.4 38.4l134.4 108.8c3.2-12.8 3.2-22.4 3.2-35.2 3.2-80-57.6-140.8-131.2-140.8z" p-id="6549"></path></svg></button>
      </div>
      {{ form.new_password2.errors }}
    </div>
    <p class="error hide"></p>
    <div class="form-foot text-center">
      <button type="submit" class="btn btn-primary">{% trans "Submit" %}</button>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_script %}
<script type="text/javascript" src="{{MEDIA_URL}}bootstrap/bootstrap.popover.min.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}bootstrap/bootstrap.min.js"></script>
<script type="text/javascript">
  {% include "snippets/password_strength_js.html" %}

  $(function () {
    setupPasswordField("id_new_password1", passwd_tip, template);
  });

  var eyeSlashIcon = '<svg t="1720504436505" class="seafile-multicolor-icon password-icon seafile-multicolor-icon-eye-slash" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6548" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" aria-hidden="true"><path d="M80.91936 102.4l156.8 124.8C311.31936 169.6 400.91936 128 512.91936 128c134.4 0 243.2 64 320 137.6 76.8 73.6 131.2 163.2 153.6 224 6.4 12.8 6.4 28.8 0 41.6-22.4 51.2-64 124.8-124.8 192l140.8 112c19.2 16 22.4 44.8 6.4 67.2-16 19.2-48 22.4-67.2 6.4l-928-736C-2.28064 160-5.48064 128 10.51936 108.8s48-22.4 70.4-6.4z m32 256L186.51936 416C160.91936 454.4 141.71936 486.4 128.91936 515.2c22.4 51.2 64 121.6 128 179.2 67.2 64 153.6 112 256 112 44.8 0 86.4-9.6 124.8-22.4l76.8 64c-57.6 32-124.8 51.2-201.6 51.2-134.4 0-243.2-64-320-137.6-76.8-73.6-131.2-163.2-153.6-224-6.4-12.8-6.4-28.8 0-41.6 12.8-41.6 38.4-89.6 73.6-137.6z m185.6 150.4l112 89.6c12.8 16 25.6 25.6 44.8 35.2l112 89.6c-16 3.2-35.2 6.4-51.2 6.4-121.6 3.2-217.6-96-217.6-220.8zM512.91936 224c-76.8 0-144 25.6-198.4 64l67.2 51.2c35.2-28.8 80-48 131.2-48 118.4 0 214.4 99.2 214.4 220.8 0 32-6.4 60.8-19.2 89.6l86.4 70.4c48-54.4 83.2-112 102.4-153.6-22.4-51.2-64-121.6-128-179.2C704.91936 272 618.51936 224 512.91936 224z m0 150.4h-3.2c3.2 9.6 3.2 19.2 3.2 28.8 0 12.8-3.2 25.6-6.4 38.4l134.4 108.8c3.2-12.8 3.2-22.4 3.2-35.2 3.2-80-57.6-140.8-131.2-140.8z" p-id="6549"></path></svg>';
  var eyeIcon = '<svg t="1763029927156" class="seafile-multicolor-icon password-icon seafile-multicolor-icon-eye" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="14383" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" aria-hidden="true"><path d="M512 224c-105.6 0-192 48-256 112-60.8 60.8-105.6 131.2-128 179.2 22.4 51.2 64 121.6 128 179.2 67.2 64 153.6 112 256 112s192-48 256-112c60.8-60.8 105.6-131.2 128-179.2-22.4-51.2-64-121.6-128-179.2-64-64-150.4-112-256-112zM192 265.6C268.8 192 377.6 128 512 128s243.2 64 320 137.6c76.8 73.6 131.2 163.2 153.6 224 6.4 12.8 6.4 28.8 0 41.6-25.6 60.8-76.8 150.4-153.6 224C755.2 832 646.4 896 512 896s-243.2-64-320-137.6c-76.8-73.6-131.2-163.2-153.6-224-6.4-12.8-6.4-28.8 0-41.6 22.4-64 73.6-153.6 153.6-227.2z m320 384c73.6 0 134.4-60.8 134.4-137.6s-60.8-137.6-134.4-137.6h-3.2c3.2 9.6 3.2 19.2 3.2 28.8 0 60.8-48 108.8-105.6 108.8-9.6 0-19.2 0-25.6-3.2v3.2c-3.2 76.8 57.6 137.6 131.2 137.6z m0-358.4c118.4 0 214.4 99.2 214.4 220.8s-96 220.8-214.4 220.8-214.4-99.2-214.4-220.8 96-220.8 214.4-220.8z" fill="#999999" p-id="14384"></path></svg>';
  $('.input-group .btn').on('click', function() {
    var $prev = $(this).prev('input');
    var currentInputType = $prev.attr('type');
    var nextInputType = currentInputType == 'text' ? 'password' : 'text';
    $prev.attr('type', nextInputType)
    if (nextInputType == 'text') {
      $(this).html(eyeIcon);
    } else {
      $(this).html(eyeSlashIcon);
    }
  });

  $('form').on('submit', function(){
    var old_pwd = $('input[name="old_password"]').val().trim(),
      pwd1 = $('input[name="new_password1"]').val().trim(),
      pwd2 = $('input[name="new_password2"]').val().trim();

    if (!old_pwd) {
      $('.error').html("{% trans "Current password cannot be blank" %}").removeClass('hide');
      return false;
    }
    if (!pwd1) {
      $('.error').html("{% trans "Password cannot be blank" %}").removeClass('hide');
      return false;
    }
    if (!pwd2) {
      $('.error').html("{% trans "Please enter the password again" %}").removeClass('hide');
      return false;
    }
    if (pwd1 != pwd2) {
      $('.error').html("{% trans "Passwords don't match" %}").removeClass('hide');
      return false;
    }
    if (!checkPasswordStrength(pwd1, {{strong_pwd_required}})) {
      $('.error').html(passwd_tip).removeClass('hide');
      return false;
    }
  });
</script>
{% endblock %}
